Object DwarvenSiegeWorks

    SelectPortrait = BPDForgeWorks

    Draw = W3DScriptedModelDraw ModuleTag_Draw
        OkToChangeModelColor  = Yes
        UseStandardModelNames = Yes
        StaticModelLODMode = Yes

        ExtraPublicBone = ARROW01
        ExtraPublicBone = ARROW02
        ExtraPublicBone = ARROW03
        ExtraPublicBone = ARROW04
        ExtraPublicBone = FXBONE01
        ExtraPublicBone = FXBONE02
        ExtraPublicBone = FXBONE05
        ExtraPublicBone = FXBONE04

        DefaultModelConditionState
            Model = DBForge
            WeaponLaunchBone = PRIMARY ARROW
        End


        AnimationState = BUILD_PLACEMENT_CURSOR
            BeginScript
                CurDrawableHideSubObject("N_Window")
                CurDrawableHideSubObject("N_Glow")
                   CurDrawableHideSubObject("Anvil")
                   CurDrawableHideSubObject("V2")
            EndScript
        End

        AnimationState = PHANTOM_STRUCTURE
            BeginScript
                CurDrawableHideSubObject("N_Window")
                CurDrawableHideSubObject("N_Glow")
                   CurDrawableHideSubObject("Anvil")
                   CurDrawableHideSubObject("V2")
            EndScript
        End

        IdleAnimationState
        ParticleSysBone     = Smoke01 DwfForgeSmoke02 Followbone:Yes
    End



        ModelConditionState = SNOW AWAITING_CONSTRUCTION UPGRADE_NUMENOR_STONEWORK
            Model    = DBForge_A
            Texture = DBForge_snow.tga DBForge.tga
            Texture = dwarvenforge01_snow.tga dwarvenforge01.tga
            Texture = DBStoneA_snow.tga DBStoneA.tga
            Texture = DBFortress_snow1.tga DBFortress1.tga
        End

        ModelConditionState = SNOW AWAITING_CONSTRUCTION
            Model    = DBForge_A
            Texture = DBForge.tga DBForge_Snow.tga
            Texture = dwarvenforge01.tga dwarvenforge01_snow.tga
            Texture = DBStoneA.tga DBStoneA_Snow.tga
            Texture = DBFortress1.tga DBFortress1_Snow.tga
        End

        ModelConditionState   = AWAITING_CONSTRUCTION
            Model               = DBForge_A

        End
        AnimationState        = AWAITING_CONSTRUCTION
            Animation           =  DBForge_A
                AnimationName     =  DBForge_ASKL.DBForge_ABLD
                AnimationMode     = MANUAL
                AnimationBlendTime = 0
            End
            Flags                  = START_FRAME_FIRST



        End

        ModelConditionState = SNOW ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED UPGRADE_NUMENOR_STONEWORK
            Model    = DBForge_A
            Texture = DBForge_Snow.tga DBForge.tga
            Texture = dwarvenforge01_Snow.tga dwarvenforge01.tga
            Texture = DBStoneA_Snow.tga DBStoneA.tga
            Texture = DBFortress1_Snow.tga DBFortress1.tga
        End

        ModelConditionState = SNOW ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Model    = DBForge_A
            Texture = DBForge.tga DBForge_Snow.tga
            Texture = dwarvenforge01.tga dwarvenforge01_snow.tga
            Texture = DBStoneA.tga DBStoneA_Snow.tga
            Texture = DBFortress1.tga DBFortress1_Snow.tga
        End

        ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Model               = DBForge_A
        End
        AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Animation           = DBForge_A
                AnimationName     = DBForge_ASKL.DBForge_ABLD
                AnimationMode     = MANUAL
                AnimationBlendTime = 0
            End
            Flags                  = START_FRAME_FIRST
            StateName              = BeingConstructed
            BeginScript
                CurDrawablePlaySound("GondorBarracksBeginConstruction")
            EndScript
            ParticleSysBone   = CONSTDUSTBONE01 BuildingContructDust FollowBone:Yes
        End




    ModelConditionState  = DAMAGED
      Model         = DBForge_D1
        ParticleSysBone FireSmall01 FireBuildingLarge
        ParticleSysBone FireSmall02 FireBuildingMedium
        ParticleSysBone FireSmall03 FireBuildingMedium
        ParticleSysBone FireSmall04 FireBuildingSmall
        ParticleSysBone FireSmall05 SmokeBuildingLarge
    End
    AnimationState = DAMAGED
        EnteringStateFX    = FX_BuildingDamaged
    End

    ModelConditionState  = REALLYDAMAGED
      Model         = DBForge_D2
        ParticleSysBone FireSmall01 FireBuildingLarge
        ParticleSysBone FireSmall02 FireBuildingLarge
        ParticleSysBone FireSmall03 FireBuildingMedium
        ParticleSysBone FireSmall04 SmokeBuildingLarge
        ParticleSysBone FireSmall05 SmokeBuildingLarge
    End
    AnimationState = REALLYDAMAGED
          Animation                =    RubbleAnimation
            AnimationName        =    DBForge_D2SK.DBForge_D2AN
            AnimationMode        =    ONCE
          End
        EnteringStateFX    = FX_BuildingReallyDamaged
    End

    ModelConditionState  = RUBBLE
      Model         = DBForge_D3
      ParticleSysBone SmokeLarge01 SmokeBuildingLarge
    End

    AnimationState = RUBBLE
          Animation                =    RubbleAnimation
            AnimationName        =    DBForge_D3SK.DBForge_D3AN
            AnimationMode        =    ONCE
          End
      EnteringStateFX    = FX_StructureMediumCollapse
    End

    ModelConditionState  = POST_RUBBLE
      Model         = None
        ParticleSysBone NONE SmokeBuildingMediumRubble
    End

    ModelConditionState  = POST_COLLAPSE
      Model         = None
        ParticleSysBone NONE SmokeBuildingMediumRubble
    End

    ModelConditionState = SNOW UPGRADE_NUMENOR_STONEWORK
        Model    = DBForge
        Texture = DBForge_snow.tga DBForge.tga
        Texture = dwarvenforge01_snow.tga dwarvenforge01.tga
        Texture = DBStoneA_snow.tga DBStoneA.tga
        Texture = DBMineA_snow.tga DBMineA.tga
        Texture = DBFortress1_snow.tga DBFortress1.tga
    End

    ModelConditionState = SNOW
        Model    = DBForge
        Texture = DBForge.tga DBForge_Snow.tga
        Texture = dwarvenforge01.tga dwarvenforge01_snow.tga
        Texture = DBStoneA.tga DBStoneA_Snow.tga
        Texture = DBMineA.tga DBMineA_Snow.tga
        Texture = DBFortress1.tga DBFortress1_Snow.tga
    End

    End



    Draw = W3DScriptedModelDraw ModuleTag_DrawDoor
        OkToChangeModelColor  = Yes

        StaticModelLODMode = Yes

        DefaultModelConditionState
            Model = DBForgeDr_SKN
        End

        IdleAnimationState
            Animation           = IDLE
                AnimationName     = DBForgeDoor_SKL.DBForgeDoor_CL
                AnimationMode     = LOOP
            End
            Flags                  = START_FRAME_FIRST
        End

        AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Animation           = GBFDoor_DRA
                AnimationName     = DBForgeDoor_SKL.DBForgeDoor_BLD
                AnimationMode     = MANUAL
            End
            Flags                  = START_FRAME_FIRST
        End


        AnimationState            =    DOOR_1_OPENING
            Animation           =    DBForgeDoor_OPN
                AnimationName   =    DBForgeDoor_SKL.DBForgeDoor_OPN
                AnimationMode   =    ONCE
                AnimationBlendTime = 0
            End

            ParticleSysBone     = None DwfSiegeDoorOpen Followbone:Yes
        End

           AnimationState            =    DOOR_1_WAITING_OPEN
            Animation           =    DBForgeDoor_OP
                AnimationName   =    DBForgeDoor_SKL.DBForgeDoor_OP
                AnimationMode   =    LOOP
                AnimationBlendTime = 0
            End
            Flags            = START_FRAME_FIRST
            ParticleSysBone     = None DwfSiegeDoorOpen Followbone:Yes
        End


           AnimationState            =    DOOR_1_CLOSING
            Animation           =    DBForgeDoor_CLS
                AnimationName   =    DBForgeDoor_SKL.DBForgeDoor_CLS
                AnimationMode   =    ONCE
                AnimationBlendTime = 0
            End

        End

          AnimationState            =    DOOR_1_CLOSING
            Animation           =    DBForgeDoor_CLS
                AnimationName   =    DBForgeDoor_SKL.DBForgeDoor_CLS
                AnimationMode   =    ONCE
                AnimationBlendTime = 0
            End

        End


        ModelConditionState        = POST_RUBBLE
            Model                = None
        End

        ModelConditionState        = POST_COLLAPSE
            Model                = None
        End

    End


    Draw = W3DScriptedModelDraw ModuleTag_DrawRune
        DefaultModelConditionState
            Model        = exforgerune
        End

    AnimationState = BUILD_PLACEMENT_CURSOR
        BeginScript
            CurDrawableHideSubObject("GLOW01")
            CurDrawableHideSubObject("GLOW02")
            CurDrawableHideSubObject("GLOW03")
            CurDrawableHideSubObject("GLOW04")
            CurDrawableHideSubObject("GLOW05")
        EndScript
    End
    AnimationState = PHANTOM_STRUCTURE
        BeginScript
            CurDrawableHideSubObject("GLOW01")
            CurDrawableHideSubObject("GLOW02")
            CurDrawableHideSubObject("GLOW03")
            CurDrawableHideSubObject("GLOW04")
            CurDrawableHideSubObject("GLOW05")
        EndScript
    End
    End


    Draw = W3DFloorDraw DrawFloorV1
        StaticModelLODMode = Yes
        ModelName = DBForge_Bib

          HideIfModelConditions    =    AWAITING_CONSTRUCTION
          HideIfModelConditions    =    PARTIALLY_CONSTRUCTED
    End


  PlacementViewAngle  = 45



    DisplayName             = OBJECT:DwarvenForgeWorks
    Description             = OBJECT:DwarvenForgeWorksDescription

    Side                    = Dwarves
    EditorSorting           = STRUCTURE
    ThreatLevel             = FACTORY_THREAT_LEVEL

    CommandSet              = DwarvenForgeWorksCommandSet
    RefundValue             = 300
    BuildCost               = 450
    BuildTime               = 35
    BountyValue             = 80
    VisionRange             = 160
    ShroudClearingRange     = 180

    WeaponSet
        Conditions        = None
    End

    WeaponSet
        Conditions        = PLAYER_UPGRADE
        Weapon            = PRIMARY StructureAxeWeapon
        AutoChooseSources    = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End


  ArmorSet
    Conditions            = None
    Armor                 = TechnologyArmor

  End




    #include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

    VoiceFullyCreated        = EVA:ForgeWorksComplete
    VoiceSelect            = DwarvenForgeWorksSelect
    VoiceSelectUnderConstruction    = BuildingGoodVoiceSelectUnderConstruction

    SoundAmbientDamaged        = BuildingDamageFireMediumLoop
    SoundAmbientReallyDamaged    = BuildingDamageFireMediumLoop
    SoundOnDamaged            = BuildingLightDamageStone
    SoundOnReallyDamaged        = BuildingHeavyDamageStone

    UnitSpecificSounds
        UnderConstruction    = BuildingConstructionLoop

        UnderRepairFromRubble    = BuildingConstructionLoop
    End

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap     = 800
        AnimationSound         = Sound:StatueHeroicBuildStoneDebris2 Animation:DBFORGE_ASKL.DBFORGE_ABLD Frames:190
        AnimationSound         = Sound:StatueHeroicBuildStoneDebris1 Animation:DBFORGE_ASKL.DBFORGE_ABLD Frames:210
    End




    RadarPriority       = STRUCTURE
    KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE NEED_BASE_FOUNDATION AUTO_RALLYPOINT FS_FACTORY MP_COUNT_FOR_VICTORY LIVING_WORLD_BUILDING_MIRROR

    Behavior            = GettingBuiltBehavior GetBuiltBehaviorTag
        WorkerName    = DwarvenWorkerNoSelect
        SpawnTimer    = DEFAULT_STRUCTURE_HEALDELAY
    End

    Body                        = StructureBody ModuleTag_05
        MaxHealth             = 3500
        MaxHealthDamaged      = DWARVEN_FORGEWORKS_MAXHEALTHDAMAGED
        MaxHealthReallyDamaged     = DWARVEN_FORGEWORKS_MAXHEALTH_REALLYDAMAGED
    End



    Behavior = RefundDie ModuleTag_refund
        UpgradeRequired     = Upgrade_MarketplaceUpgradeDefiance
        BuildingRequired     = ANY +GondorMarketPlace
        RefundPercent         = 50%
    End

    Behavior                  = StructureCollapseUpdate ModuleTag_06
        MinCollapseDelay        = 000
        MaxCollapseDelay        = 000
        CollapseDamping         = .5
        MaxShudder              = 0.6
        MinBurstDelay           = 250
        MaxBurstDelay           = 800
        BigBurstFrequency       = 4
        FXList                  = INITIAL   FX_StructureMediumCollapse
        FXList                  = ALMOST_FINAL  FX_StructureAlmostCollapse
        DestroyObjectWhenDone    = Yes
        CollapseHeight        = 120
    End

    Behavior = AIUpdateInterface ModuleTag_SoWeCanUseWeapon
        AutoAcquireEnemiesWhenIdle    = Yes
        MoodAttackCheckRate        = 250
        AILuaEventsList            = AngmarStructuresFunctions
    End

    Behavior = PassiveAreaEffectBehavior ModuleTag_FeelGoodHero2
        EffectRadius            = 350
        PingDelay               = 2000
        UpgradeRequired         = Upgrade_TestBuilding_2
        ModifierName            = DainHallenUnitModifier
        AllowFilter             = GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
    End

    Behavior = SubObjectsUpgrade ModuleTag_HideAll
        TriggeredBy        = Upgrade_StructureLevel1
        HideSubObjects        = Anvil V2
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowWallsAndFlag
        TriggeredBy        = Upgrade_StructureLevel2
        HideSubObjects        = Anvil V2
        UpgradeTexture        = dwarvenforge01.TGA 0 dwarvenforge02.TGA
        RecolorHouse        = Yes
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowTowersAndHideFlag
        TriggeredBy        = Upgrade_StructureLevel3
        ShowSubObjects        = V2
        HideSubObjects        = Anvil
        UpgradeTexture        = dwarvenforge01.TGA 0 dwarvenforge02.TGA
        RecolorHouse        = No
    End


    Behavior = ProductionUpdate ProductionUpdateModuleTag

        GiveNoXP                                = Yes
        NumDoorAnimations       = 1
        DoorOpeningTime              =    7000
        DoorWaitOpenTime             =    6000
        DoorCloseTime                =    7000
        ConstructionCompleteDuration = 0
    End

    Behavior = QueueProductionExitUpdate QueueProductionModuleTag
        UnitCreatePoint        = X:0.0 Y:-80.0    Z:0.0
        NaturalRallyPoint    = X:0.0 Y:-80.0    Z:0.0
        PlacementViewAngle    = 270
        ExitDelay        = 50
    End

    Behavior = LevelUpUpgrade ModuleTag_LevelUpDwarvenForgeWorksLevel2
        TriggeredBy        = Upgrade_DwarvenForgeWorksLevel2
        LevelsToGain        = 1
        LevelCap        = 3
    End

    Behavior = LevelUpUpgrade ModuleTag_LevelUpDwarvenForgeWorksLevel3
        TriggeredBy        = Upgrade_DwarvenForgeWorksLevel3
        LevelsToGain        = 1
        LevelCap        = 3
    End

    Behavior = CommandSetUpgrade ModuleTag_DwarvenForgeWorksLevel2CommandSet
        TriggeredBy        = Upgrade_DwarvenForgeWorksLevel2
        ConflictsWith      = Upgrade_DwarvenForgeWorksLevel3
        CommandSet         = DwarvenForgeWorksCommandSetLevel2
    End

    Behavior = CommandSetUpgrade ModuleTag_DwarvenForgeWorksLevel3CommandSet
        TriggeredBy        = Upgrade_DwarvenForgeWorksLevel3
        CommandSet         = DwarvenForgeWorksCommandSetLevel3
    End

    Behavior = GeometryUpgrade Geom_ModuleTag_HideAll
        TriggeredBy        = Upgrade_StructureLevel1
        ShowGeometry        = Geom_Orig
        HideGeometry        = Geom_V2
    End
    Behavior = GeometryUpgrade Geom_ModuleTag_ShowWalls
        TriggeredBy        = Upgrade_StructureLevel2
        ShowGeometry        = Geom_Orig
        HideGeometry        = Geom_V2
    End
      Behavior = GeometryUpgrade Geom_ModuleTag_ShowFlagsAndTower
        TriggeredBy        = Upgrade_StructureLevel3
        ShowGeometry        = Geom_Orig Geom_V2
    End

    Behavior = TerrainResourceBehavior ModuleTag_NewMoneyDeadSpot
        Radius            = 100
        MaxIncome        = 0
        IncomeInterval        = 999999
        HighPriority        = Yes
        Visible         = No
    End

    Behavior                  = BuildingBehavior BuildingModuleTag
        NightWindowName         = N_Window N_Glow
    End

    Behavior = SubObjectsUpgrade Armor_Upgrade1
        TriggeredBy          = Upgrade_SubFactionIronHills
        UpgradeTexture       = EUDwarfmin.tga 0 EUDwarfmin_eisen.tga
        UpgradeTexture       = eudwarfeng.tga 0 eudwarfeng_eisen.tga
        UpgradeTexture       = eudwarfram_eng.tga 0 eudwarfram_eisen.tga
    End

    Behavior = SubObjectsUpgrade Armor_Upgrade2
        TriggeredBy          = Upgrade_SubFactionErebor
        UpgradeTexture       = EUDwarfmin.tga 0 EUDwarfmin_ereb.tga
        UpgradeTexture       = eudwarfeng.tga 0 eudwarfeng_ereb.tga
        UpgradeTexture       = eudwarfram_eng.tga 0 eudwarfram_ereb.tga
    End

    Behavior = SubObjectsUpgrade Armor_Upgrade3
        TriggeredBy          = Upgrade_SubFactionEredLuin
        UpgradeTexture       = EUDwarfmin.tga 0 EUDwarfmin_ered.tga
        UpgradeTexture       = eudwarfeng.tga 0 eudwarfeng_ered.tga
        UpgradeTexture       = eudwarfram_eng.tga 0 eudwarfram_ered.tga
    End

    Behavior = SubObjectsUpgrade Armor_Upgrade11
        TriggeredBy          = Upgrade_DwarvenForgeWorksLevel2
        UpgradeTexture       = EUDwarfmin.tga 0 EUDwarfmin_eisen.tga
        UpgradeTexture       = eudwarfeng.tga 0 eudwarfeng_eisen.tga
        UpgradeTexture       = eudwarfram_eng.tga 0 eudwarfram_eisen.tga
    End

    Behavior = SubObjectsUpgrade Armor_Upgrade22
        TriggeredBy          = Upgrade_DwarvenForgeWorksLevel2
        UpgradeTexture       = EUDwarfmin.tga 0 EUDwarfmin_ereb.tga
        UpgradeTexture       = eudwarfeng.tga 0 eudwarfeng_ereb.tga
        UpgradeTexture       = eudwarfram_eng.tga 0 eudwarfram_ereb.tga
    End

    Behavior = SubObjectsUpgrade Armor_Upgrade33
        TriggeredBy          = Upgrade_DwarvenForgeWorksLevel2
        UpgradeTexture       = EUDwarfmin.tga 0 EUDwarfmin_ered.tga
        UpgradeTexture       = eudwarfeng.tga 0 eudwarfeng_ered.tga
        UpgradeTexture       = eudwarfram_eng.tga 0 eudwarfram_ered.tga
    End

    Behavior = SubObjectsUpgrade Armor_Upgrade111
        TriggeredBy          = Upgrade_DwarvenForgeWorksLevel3
        UpgradeTexture       = EUDwarfmin.tga 0 EUDwarfmin_eisen.tga
        UpgradeTexture       = eudwarfeng.tga 0 eudwarfeng_eisen.tga
        UpgradeTexture       = eudwarfram_eng.tga 0 eudwarfram_eisen.tga
    End

    Behavior = SubObjectsUpgrade Armor_Upgrade222
        TriggeredBy          = Upgrade_DwarvenForgeWorksLevel3
        UpgradeTexture       = EUDwarfmin.tga 0 EUDwarfmin_ereb.tga
        UpgradeTexture       = eudwarfeng.tga 0 eudwarfeng_ereb.tga
        UpgradeTexture       = eudwarfram_eng.tga 0 eudwarfram_ereb.tga
    End

    Behavior = SubObjectsUpgrade Armor_Upgrade333
        TriggeredBy          = Upgrade_DwarvenForgeWorksLevel3
        UpgradeTexture       = EUDwarfmin.tga 0 EUDwarfmin_ered.tga
        UpgradeTexture       = eudwarfeng.tga 0 eudwarfeng_ered.tga
        UpgradeTexture       = eudwarfram_eng.tga 0 eudwarfram_ered.tga
    End









    Behavior = SubObjectsUpgrade ModuleTag_HideGlow
        TriggeredBy             = Upgrade_AllFactionUpgrade
        HideSubObjects          = GLOW01 GLOW02 GLOW03 GLOW04 GLOW05
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowRune1
        TriggeredBy             = Upgrade_Level_1
        ShowSubObjects          = GLOW01
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowRune2
        TriggeredBy             = Upgrade_Level_2
        ShowSubObjects          = GLOW02
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowRune3
        TriggeredBy             = Upgrade_Level_3
        ShowSubObjects          = GLOW03
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowRune4
        TriggeredBy             = Upgrade_Level_4
        ShowSubObjects          = GLOW04
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowRune5
        TriggeredBy             = Upgrade_Level_5
        ShowSubObjects          = GLOW05
    End

    Behavior = PassiveAreaEffectBehavior ModuleTag_MysticFountainsHealing
        UpgradeRequired         = Upgrade_Level_3
        EffectRadius            = 180
        PingDelay               = 2000
        HealPercentPerSecond    = 2%
        AllowFilter             = ANY +INFANTRY +CAVALRY +HERO -MACHINE +MONSTER -IMMOBILE +DOZER
        NonStackable            = Yes
        HealFX                  = FX_SpellHealUnitHealBuff
    End

    Behavior = PassiveAreaEffectBehavior ModuleTag_FeelGoodHero
        UpgradeRequired         = Upgrade_Level_2
        EffectRadius            = 180
        PingDelay               = 2000
        ModifierName            = RuneInspirationLeadership
        AllowFilter             = GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
    End

    Behavior = ObjectCreationUpgrade CreateTheEffecktSchrecken
        TriggeredBy             = Upgrade_Level_5
        Delay                   = 0.0
        ThingToSpawn            = DwarvenRuneSchrecken
        FadeInTime              = 200
    End

    Behavior = AttributeModifierUpgrade ModuleTag_Unantastbrakeit
        TriggeredBy             = Upgrade_Level_1
        AttributeModifier       = DwarvenRuneUnantastbarkeit
    End

    Behavior = AttributeModifierUpgrade ModuleTag_Produktivitat
        TriggeredBy             = Upgrade_Level_4
        AttributeModifier       = DwarvenRuneProduktivitat
    End






    Geometry            = BOX
    GeometryName            = Geom_Orig
      GeometryMajorRadius        = 50.0
    GeometryMinorRadius        = 60.0
    GeometryHeight            = 25.0
    GeometryOffset            = X:0 Y:6 Z:0

    AdditionalGeometry        = BOX
    GeometryName            = Geom_Orig
    GeometryMajorRadius        = 15.0
    GeometryMinorRadius        = 10.0
    GeometryHeight            = 50.0
    GeometryOffset            = X:-25 Y:40 Z:0

    AdditionalGeometry        = CYLINDER
    GeometryIsSmall            = No
    GeometryName            = Geom_Orig
      GeometryMajorRadius        = 11.0
    GeometryMinorRadius        = 11.0
    GeometryHeight            = 76.0
    GeometryOffset            = X:27 Y:37 Z:0

    AdditionalGeometry        = Box
    GeometryName            = Geom_V2
    GeometryMajorRadius        = 9.0
    GeometryMinorRadius        = 9.0
    GeometryHeight            = 70.0
    GeometryOffset            = X:-30 Y:40 Z:0

    GeometryIsSmall               = No
    Shadow                        = SHADOW_VOLUME
    BuildCompletion             = PLACED_BY_PLAYER

    GeometryContactPoint         = X:-81.4        Y:-36.3        Z:0        Repair
    GeometryContactPoint         = X:47.546        Y:36.435    Z:0
    GeometryContactPoint         = X:-32.763        Y:-46.121    Z:0
    GeometryContactPoint         = X:26.753        Y:26.753    Z:67.933    Swoop

End



ChildObject BFME1DwarvenSiegeWorks DwarvenSiegeWorks
    Behavior = CastleMemberBehavior ModuleTag_CMB
    End
End


Object DwarvenSiegeWorks_Eisenberge

    SelectPortrait = BPDForgeWorks

    Draw = W3DScriptedModelDraw ModuleTag_Draw
        OkToChangeModelColor  = Yes
        UseStandardModelNames = Yes
        StaticModelLODMode = Yes

        ExtraPublicBone = ARROW01
        ExtraPublicBone = ARROW02
        ExtraPublicBone = ARROW03
        ExtraPublicBone = ARROW04
        ExtraPublicBone = FXBONE01
        ExtraPublicBone = FXBONE02
        ExtraPublicBone = FXBONE05
        ExtraPublicBone = FXBONE04

        RandomTexture       = EUDwarfmin_eisen.tga 0 EUDwarfmin.tga
        RandomTexture       = eudwarfeng_eisen.tga 0 eudwarfeng.tga
        RandomTexture       = eudwarfram_eng_eisen.tga 0 eudwarfram.tga

        DefaultModelConditionState
            Model = DBForge
            WeaponLaunchBone = PRIMARY ARROW

        End


        AnimationState = BUILD_PLACEMENT_CURSOR
            BeginScript
                CurDrawableHideSubObject("N_Window")
                CurDrawableHideSubObject("N_Glow")
                   CurDrawableHideSubObject("Anvil")
                   CurDrawableHideSubObject("V2")
            EndScript
        End



        AnimationState = PHANTOM_STRUCTURE
            BeginScript
                CurDrawableHideSubObject("N_Window")
                CurDrawableHideSubObject("N_Glow")
                   CurDrawableHideSubObject("Anvil")
                   CurDrawableHideSubObject("V2")
            EndScript
        End

        IdleAnimationState
        ParticleSysBone     = Smoke01 DwfForgeSmoke02 Followbone:Yes
    End



        ModelConditionState = SNOW AWAITING_CONSTRUCTION UPGRADE_NUMENOR_STONEWORK
            Model    = DBForge_A
            Texture = DBForge_snow.tga DBForge.tga
            Texture = dwarvenforge01_snow.tga dwarvenforge01.tga
            Texture = DBStoneA_snow.tga DBStoneA.tga
            Texture = DBFortress_snow1.tga DBFortress1.tga
        End

        ModelConditionState = SNOW AWAITING_CONSTRUCTION
            Model    = DBForge_A
            Texture = DBForge.tga DBForge_Snow.tga
            Texture = dwarvenforge01.tga dwarvenforge01_snow.tga
            Texture = DBStoneA.tga DBStoneA_Snow.tga
            Texture = DBFortress1.tga DBFortress1_Snow.tga
        End

        ModelConditionState   = AWAITING_CONSTRUCTION
            Model               = DBForge_A

        End
        AnimationState        = AWAITING_CONSTRUCTION
            Animation           =  DBForge_A
                AnimationName     =  DBForge_ASKL.DBForge_ABLD
                AnimationMode     = MANUAL
                AnimationBlendTime = 0
            End
            Flags                  = START_FRAME_FIRST



        End

        ModelConditionState = SNOW ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED UPGRADE_NUMENOR_STONEWORK
            Model    = DBForge_A
            Texture = DBForge_Snow.tga DBForge.tga
            Texture = dwarvenforge01_Snow.tga dwarvenforge01.tga
            Texture = DBStoneA_Snow.tga DBStoneA.tga
            Texture = DBFortress1_Snow.tga DBFortress1.tga
        End

        ModelConditionState = SNOW ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Model    = DBForge_A
            Texture = DBForge.tga DBForge_Snow.tga
            Texture = dwarvenforge01.tga dwarvenforge01_snow.tga
            Texture = DBStoneA.tga DBStoneA_Snow.tga
            Texture = DBFortress1.tga DBFortress1_Snow.tga
        End

        ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Model               = DBForge_A
        End
        AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Animation           = DBForge_A
                AnimationName     = DBForge_ASKL.DBForge_ABLD
                AnimationMode     = MANUAL
                AnimationBlendTime = 0
            End
            Flags                  = START_FRAME_FIRST
            StateName              = BeingConstructed
            BeginScript
                CurDrawablePlaySound("GondorBarracksBeginConstruction")
            EndScript
            ParticleSysBone   = CONSTDUSTBONE01 BuildingContructDust FollowBone:Yes
        End




    ModelConditionState  = DAMAGED
      Model         = DBForge_D1
        ParticleSysBone FireSmall01 FireBuildingLarge
        ParticleSysBone FireSmall02 FireBuildingMedium
        ParticleSysBone FireSmall03 FireBuildingMedium
        ParticleSysBone FireSmall04 FireBuildingSmall
        ParticleSysBone FireSmall05 SmokeBuildingLarge
    End
    AnimationState = DAMAGED
        EnteringStateFX    = FX_BuildingDamaged
    End

    ModelConditionState  = REALLYDAMAGED
      Model         = DBForge_D2
        ParticleSysBone FireSmall01 FireBuildingLarge
        ParticleSysBone FireSmall02 FireBuildingLarge
        ParticleSysBone FireSmall03 FireBuildingMedium
        ParticleSysBone FireSmall04 SmokeBuildingLarge
        ParticleSysBone FireSmall05 SmokeBuildingLarge
    End
    AnimationState = REALLYDAMAGED
          Animation                =    RubbleAnimation
            AnimationName        =    DBForge_D2SK.DBForge_D2AN
            AnimationMode        =    ONCE
          End
        EnteringStateFX    = FX_BuildingReallyDamaged
    End

    ModelConditionState  = RUBBLE
      Model         = DBForge_D3
      ParticleSysBone SmokeLarge01 SmokeBuildingLarge
    End

    AnimationState = RUBBLE
          Animation                =    RubbleAnimation
            AnimationName        =    DBForge_D3SK.DBForge_D3AN
            AnimationMode        =    ONCE
          End
      EnteringStateFX    = FX_StructureMediumCollapse
    End

    ModelConditionState  = POST_RUBBLE
      Model         = None
        ParticleSysBone NONE SmokeBuildingMediumRubble
    End

    ModelConditionState  = POST_COLLAPSE
      Model         = None
        ParticleSysBone NONE SmokeBuildingMediumRubble
    End

    ModelConditionState = SNOW UPGRADE_NUMENOR_STONEWORK
        Model    = DBForge
        Texture = DBForge_snow.tga DBForge.tga
        Texture = dwarvenforge01_snow.tga dwarvenforge01.tga
        Texture = DBStoneA_snow.tga DBStoneA.tga
        Texture = DBMineA_snow.tga DBMineA.tga
        Texture = DBFortress1_snow.tga DBFortress1.tga
    End

    ModelConditionState = SNOW
        Model    = DBForge
        Texture = DBForge.tga DBForge_Snow.tga
        Texture = dwarvenforge01.tga dwarvenforge01_snow.tga
        Texture = DBStoneA.tga DBStoneA_Snow.tga
        Texture = DBMineA.tga DBMineA_Snow.tga
        Texture = DBFortress1.tga DBFortress1_Snow.tga
    End

    End


    Draw = W3DScriptedModelDraw ModuleTag_DrawDoor
        OkToChangeModelColor  = Yes

        StaticModelLODMode = Yes

        DefaultModelConditionState
            Model = DBForgeDr_SKN
        End

        IdleAnimationState
            Animation           = IDLE
                AnimationName     = DBForgeDoor_SKL.DBForgeDoor_CL
                AnimationMode     = LOOP
            End
            Flags                  = START_FRAME_FIRST
        End

        AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Animation           = GBFDoor_DRA
                AnimationName     = DBForgeDoor_SKL.DBForgeDoor_BLD
                AnimationMode     = MANUAL
            End
            Flags                  = START_FRAME_FIRST
        End


        AnimationState            =    DOOR_1_OPENING
            Animation           =    DBForgeDoor_OPN
                AnimationName   =    DBForgeDoor_SKL.DBForgeDoor_OPN
                AnimationMode   =    ONCE
                AnimationBlendTime = 0
            End

            ParticleSysBone     = None DwfSiegeDoorOpen Followbone:Yes
        End

           AnimationState            =    DOOR_1_WAITING_OPEN
            Animation           =    DBForgeDoor_OP
                AnimationName   =    DBForgeDoor_SKL.DBForgeDoor_OP
                AnimationMode   =    LOOP
                AnimationBlendTime = 0
            End
            Flags            = START_FRAME_FIRST
            ParticleSysBone     = None DwfSiegeDoorOpen Followbone:Yes
        End


           AnimationState            =    DOOR_1_CLOSING
            Animation           =    DBForgeDoor_CLS
                AnimationName   =    DBForgeDoor_SKL.DBForgeDoor_CLS
                AnimationMode   =    ONCE
                AnimationBlendTime = 0
            End

        End

          AnimationState            =    DOOR_1_CLOSING
            Animation           =    DBForgeDoor_CLS
                AnimationName   =    DBForgeDoor_SKL.DBForgeDoor_CLS
                AnimationMode   =    ONCE
                AnimationBlendTime = 0
            End

        End


        ModelConditionState        = POST_RUBBLE
            Model                = None
        End

        ModelConditionState        = POST_COLLAPSE
            Model                = None
        End

    End


    Draw = W3DScriptedModelDraw ModuleTag_DrawRune
        DefaultModelConditionState
            Model        = exforgerune
        End

    AnimationState = BUILD_PLACEMENT_CURSOR
        BeginScript
            CurDrawableHideSubObject("GLOW01")
            CurDrawableHideSubObject("GLOW02")
            CurDrawableHideSubObject("GLOW03")
            CurDrawableHideSubObject("GLOW04")
            CurDrawableHideSubObject("GLOW05")
        EndScript
    End
    AnimationState = PHANTOM_STRUCTURE
        BeginScript
            CurDrawableHideSubObject("GLOW01")
            CurDrawableHideSubObject("GLOW02")
            CurDrawableHideSubObject("GLOW03")
            CurDrawableHideSubObject("GLOW04")
            CurDrawableHideSubObject("GLOW05")
        EndScript
    End
    End


    Draw = W3DFloorDraw DrawFloorV1
        StaticModelLODMode = Yes
        ModelName = DBForge_Bib

          HideIfModelConditions    =    AWAITING_CONSTRUCTION
          HideIfModelConditions    =    PARTIALLY_CONSTRUCTED
    End


  PlacementViewAngle  = 45



    DisplayName             = OBJECT:DwarvenForgeWorks
    Description             = OBJECT:DwarvenForgeWorksDescription

    Side                    = Dwarves
    EditorSorting           = STRUCTURE
    ThreatLevel             = FACTORY_THREAT_LEVEL

    CommandSet              = DwarvenForgeWorksCommandSet_Eisenberge
    MaxSimultaneousOfType   = 4
    RefundValue             = 300
    BuildCost               = 600
    BuildTime               = 35
    BountyValue             = 80
    VisionRange             = 160
    ShroudClearingRange     = 180

    WeaponSet
        Conditions        = None
    End

    WeaponSet
        Conditions        = PLAYER_UPGRADE
        Weapon            = PRIMARY StructureAxeWeapon
        AutoChooseSources    = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End


  ArmorSet
    Conditions            = None
    Armor                 = TechnologyArmor

  End




    #include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

    VoiceFullyCreated        = EVA:ForgeWorksComplete
    VoiceSelect            = DwarvenForgeWorksSelect
    VoiceSelectUnderConstruction    = BuildingGoodVoiceSelectUnderConstruction

    SoundAmbientDamaged        = BuildingDamageFireMediumLoop
    SoundAmbientReallyDamaged    = BuildingDamageFireMediumLoop
    SoundOnDamaged            = BuildingLightDamageStone
    SoundOnReallyDamaged        = BuildingHeavyDamageStone

    UnitSpecificSounds
        UnderConstruction    = BuildingConstructionLoop

        UnderRepairFromRubble    = BuildingConstructionLoop
    End

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap     = 800
        AnimationSound         = Sound:StatueHeroicBuildStoneDebris2 Animation:DBFORGE_ASKL.DBFORGE_ABLD Frames:190
        AnimationSound         = Sound:StatueHeroicBuildStoneDebris1 Animation:DBFORGE_ASKL.DBFORGE_ABLD Frames:210
    End




    RadarPriority       = STRUCTURE
    KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE NEED_BASE_FOUNDATION AUTO_RALLYPOINT FS_FACTORY MP_COUNT_FOR_VICTORY LIVING_WORLD_BUILDING_MIRROR

    Behavior            = GettingBuiltBehavior GetBuiltBehaviorTag
        WorkerName    = DwarvenWorkerNoSelect
        SpawnTimer    = DEFAULT_STRUCTURE_HEALDELAY
    End

    Body                        = StructureBody ModuleTag_05
        MaxHealth             = 3500
        MaxHealthDamaged      = DWARVEN_FORGEWORKS_MAXHEALTHDAMAGED
        MaxHealthReallyDamaged     = DWARVEN_FORGEWORKS_MAXHEALTH_REALLYDAMAGED
    End



    Behavior = RefundDie ModuleTag_refund
        UpgradeRequired     = Upgrade_MarketplaceUpgradeDefiance
        BuildingRequired     = ANY +GondorMarketPlace
        RefundPercent         = 50%
    End

    Behavior                  = StructureCollapseUpdate ModuleTag_06
        MinCollapseDelay        = 000
        MaxCollapseDelay        = 000
        CollapseDamping         = .5
        MaxShudder              = 0.6
        MinBurstDelay           = 250
        MaxBurstDelay           = 800
        BigBurstFrequency       = 4
        FXList                  = INITIAL   FX_StructureMediumCollapse
        FXList                  = ALMOST_FINAL  FX_StructureAlmostCollapse
        DestroyObjectWhenDone    = Yes
        CollapseHeight        = 120
    End

    Behavior = AIUpdateInterface ModuleTag_SoWeCanUseWeapon
        AutoAcquireEnemiesWhenIdle    = Yes
        MoodAttackCheckRate        = 250
        AILuaEventsList            = AngmarStructuresFunctions
    End

    Behavior = PassiveAreaEffectBehavior ModuleTag_FeelGoodHero2
        EffectRadius            = 350
        PingDelay               = 2000
        UpgradeRequired         = Upgrade_TestBuilding_2
        ModifierName            = DainHallenUnitModifier
        AllowFilter             = GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
    End

    Behavior = SubObjectsUpgrade ModuleTag_HideAll
        TriggeredBy        = Upgrade_StructureLevel1
        HideSubObjects        = Anvil V2
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowWallsAndFlag
        TriggeredBy        = Upgrade_StructureLevel2
        HideSubObjects        = Anvil V2
        UpgradeTexture        = dwarvenforge01.TGA 0 dwarvenforge02.TGA
        UpgradeTexture       = EUDwarfmin.tga 0 EUDwarfmin_eisen.tga
        UpgradeTexture       = eudwarfeng.tga 0 eudwarfeng_eisen.tga
        UpgradeTexture       = eudwarfram_eng.tga 0 eudwarfram_eisen.tga
        RecolorHouse        = Yes
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowTowersAndHideFlag
        TriggeredBy        = Upgrade_StructureLevel3
        ShowSubObjects        = V2
        HideSubObjects        = Anvil
        UpgradeTexture        = dwarvenforge01.TGA 0 dwarvenforge02.TGA
        RecolorHouse        = No
    End


    Behavior = ProductionUpdate ProductionUpdateModuleTag

        GiveNoXP                                = Yes
        NumDoorAnimations       = 1
        DoorOpeningTime              =    7000
        DoorWaitOpenTime             =    6000
        DoorCloseTime                =    7000
        ConstructionCompleteDuration = 0
    End

    Behavior = QueueProductionExitUpdate QueueProductionModuleTag
        UnitCreatePoint        = X:0.0 Y:-80.0    Z:0.0
        NaturalRallyPoint    = X:0.0 Y:-80.0    Z:0.0
        PlacementViewAngle    = 270
        ExitDelay        = 50
    End

    Behavior = LevelUpUpgrade ModuleTag_LevelUpDwarvenForgeWorksLevel2
        TriggeredBy        = Upgrade_DwarvenForgeWorksLevel2
        LevelsToGain        = 1
        LevelCap        = 3
    End

    Behavior = LevelUpUpgrade ModuleTag_LevelUpDwarvenForgeWorksLevel3
        TriggeredBy        = Upgrade_DwarvenForgeWorksLevel3
        LevelsToGain        = 1
        LevelCap        = 3
    End

    Behavior = CommandSetUpgrade ModuleTag_DwarvenForgeWorksLevel2CommandSet
        TriggeredBy        = Upgrade_DwarvenForgeWorksLevel2
        ConflictsWith        = Upgrade_DwarvenForgeWorksLevel3
        CommandSet        = DwarvenForgeWorksCommandSetLevel2_Eisenberge
    End

    Behavior = CommandSetUpgrade ModuleTag_DwarvenForgeWorksLevel3CommandSet
        TriggeredBy        = Upgrade_DwarvenForgeWorksLevel3
        CommandSet        = DwarvenForgeWorksCommandSetLevel3_Eisenberge
    End
	
    Behavior = CommandSetUpgrade ModuleTag_DwarvenForgeWorksLevel1CommandSet_AI
        TriggeredBy        = Upgrade_ObjectUnderAIControl
        ConflictsWith        = Upgrade_DwarvenForgeWorksLevel2 Upgrade_DwarvenForgeWorksLevel3
        CommandSet        = DwarvenForgeWorksCommandSet_Eisenberge_AI
    End

    Behavior = CommandSetUpgrade ModuleTag_DwarvenForgeWorksLevel2CommandSet_AI
        TriggeredBy        = Upgrade_ObjectUnderAIControl Upgrade_DwarvenForgeWorksLevel2
		RequiresAllTriggers = Yes
        ConflictsWith        = Upgrade_DwarvenForgeWorksLevel3
        CommandSet        = DwarvenForgeWorksCommandSetLevel2_Eisenberge_AI
    End
	
    Behavior = CommandSetUpgrade ModuleTag_DwarvenForgeWorksLevel3CommandSet_AI
        TriggeredBy        = Upgrade_ObjectUnderAIControl Upgrade_DwarvenForgeWorksLevel3
		RequiresAllTriggers = Yes
        CommandSet        = DwarvenForgeWorksCommandSetLevel3_Eisenberge_AI
    End

    Behavior = GeometryUpgrade Geom_ModuleTag_HideAll
        TriggeredBy        = Upgrade_StructureLevel1
        ShowGeometry        = Geom_Orig
        HideGeometry        = Geom_V2
    End
    Behavior = GeometryUpgrade Geom_ModuleTag_ShowWalls
        TriggeredBy        = Upgrade_StructureLevel2
        ShowGeometry        = Geom_Orig
        HideGeometry        = Geom_V2
    End
      Behavior = GeometryUpgrade Geom_ModuleTag_ShowFlagsAndTower
        TriggeredBy        = Upgrade_StructureLevel3
        ShowGeometry        = Geom_Orig Geom_V2
    End

    Behavior = TerrainResourceBehavior ModuleTag_NewMoneyDeadSpot
        Radius            = 100
        MaxIncome        = 0
        IncomeInterval        = 999999
        HighPriority        = Yes
        Visible         = No
    End

    Behavior                  = BuildingBehavior BuildingModuleTag
        NightWindowName         = N_Window N_Glow
    End

    Behavior = SubObjectsUpgrade Armor_Upgrade1
        TriggeredBy          = Upgrade_SubFactionIronHills
        UpgradeTexture       = EUDwarfmin.tga 0 EUDwarfmin_eisen.tga
        UpgradeTexture       = eudwarfeng.tga 0 eudwarfeng_eisen.tga
        UpgradeTexture       = eudwarfram_eng.tga 0 eudwarfram_eisen.tga
    End

    Behavior = SubObjectsUpgrade Armor_Upgrade11
        TriggeredBy          = Upgrade_DwarvenForgeWorksLevel2
        UpgradeTexture       = EUDwarfmin.tga 0 EUDwarfmin_eisen.tga
        UpgradeTexture       = eudwarfeng.tga 0 eudwarfeng_eisen.tga
        UpgradeTexture       = eudwarfram_eng.tga 0 eudwarfram_eisen.tga
    End

    Behavior = SubObjectsUpgrade Armor_Upgrade111
        TriggeredBy          = Upgrade_DwarvenForgeWorksLevel3
        UpgradeTexture       = EUDwarfmin.tga 0 EUDwarfmin_eisen.tga
        UpgradeTexture       = eudwarfeng.tga 0 eudwarfeng_eisen.tga
        UpgradeTexture       = eudwarfram_eng.tga 0 eudwarfram_eisen.tga
    End







    Behavior = SubObjectsUpgrade ModuleTag_HideGlow
        TriggeredBy             = Upgrade_AllFactionUpgrade
        HideSubObjects          = GLOW01 GLOW02 GLOW03 GLOW04 GLOW05
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowRune1
        TriggeredBy             = Upgrade_Level_1
        ShowSubObjects          = GLOW01
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowRune2
        TriggeredBy             = Upgrade_Level_2
        ShowSubObjects          = GLOW02
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowRune3
        TriggeredBy             = Upgrade_Level_3
        ShowSubObjects          = GLOW03
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowRune4
        TriggeredBy             = Upgrade_Level_4
        ShowSubObjects          = GLOW04
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowRune5
        TriggeredBy             = Upgrade_Level_5
        ShowSubObjects          = GLOW05
    End

    Behavior = PassiveAreaEffectBehavior ModuleTag_MysticFountainsHealing
        UpgradeRequired         = Upgrade_Level_3
        EffectRadius            = 180
        PingDelay               = 2000
        HealPercentPerSecond    = 2%
        AllowFilter             = ANY +INFANTRY +CAVALRY +HERO -MACHINE +MONSTER -IMMOBILE +DOZER
        NonStackable            = Yes
        HealFX                  = FX_SpellHealUnitHealBuff
    End

    Behavior = PassiveAreaEffectBehavior ModuleTag_FeelGoodHero
        UpgradeRequired         = Upgrade_Level_2
        EffectRadius            = 180
        PingDelay               = 2000
        ModifierName            = RuneInspirationLeadership
        AllowFilter             = GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
    End

    Behavior = ObjectCreationUpgrade CreateTheEffecktSchrecken
        TriggeredBy             = Upgrade_Level_5
        Delay                   = 0.0
        ThingToSpawn            = DwarvenRuneSchrecken
        FadeInTime              = 200
    End

    Behavior = AttributeModifierUpgrade ModuleTag_Unantastbrakeit
        TriggeredBy             = Upgrade_Level_1
        AttributeModifier       = DwarvenRuneUnantastbarkeit
    End

    Behavior = AttributeModifierUpgrade ModuleTag_Produktivitat
        TriggeredBy             = Upgrade_Level_4
        AttributeModifier       = DwarvenRuneProduktivitat
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI1
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 480000
        GrantUpgrade = Upgrade_DwarvenForgeWorksLevel2
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI2
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 720000
        GrantUpgrade = Upgrade_DwarvenForgeWorksLevel3
    End


    Geometry            = BOX
    GeometryName            = Geom_Orig
      GeometryMajorRadius        = 50.0
    GeometryMinorRadius        = 60.0
    GeometryHeight            = 25.0
    GeometryOffset            = X:0 Y:6 Z:0

    AdditionalGeometry        = BOX
    GeometryName            = Geom_Orig
    GeometryMajorRadius        = 15.0
    GeometryMinorRadius        = 10.0
    GeometryHeight            = 50.0
    GeometryOffset            = X:-25 Y:40 Z:0

    AdditionalGeometry        = CYLINDER
    GeometryIsSmall            = No
    GeometryName            = Geom_Orig
      GeometryMajorRadius        = 11.0
    GeometryMinorRadius        = 11.0
    GeometryHeight            = 76.0
    GeometryOffset            = X:27 Y:37 Z:0

    AdditionalGeometry        = Box
    GeometryName            = Geom_V2
    GeometryMajorRadius        = 9.0
    GeometryMinorRadius        = 9.0
    GeometryHeight            = 70.0
    GeometryOffset            = X:-30 Y:40 Z:0

    GeometryIsSmall               = No
    Shadow                        = SHADOW_VOLUME
    BuildCompletion             = PLACED_BY_PLAYER

    GeometryContactPoint         = X:-81.4        Y:-36.3        Z:0        Repair
    GeometryContactPoint         = X:47.546        Y:36.435    Z:0
    GeometryContactPoint         = X:-32.763        Y:-46.121    Z:0
    GeometryContactPoint         = X:26.753        Y:26.753    Z:67.933    Swoop

End




Object DwarvenSiegeWorks_EredLuin

    SelectPortrait = BPDForgeWorks

    Draw = W3DScriptedModelDraw ModuleTag_Draw
        OkToChangeModelColor  = Yes
        UseStandardModelNames = Yes
        StaticModelLODMode = Yes

        ExtraPublicBone = ARROW01
        ExtraPublicBone = ARROW02
        ExtraPublicBone = ARROW03
        ExtraPublicBone = ARROW04
        ExtraPublicBone = FXBONE01
        ExtraPublicBone = FXBONE02
        ExtraPublicBone = FXBONE05
        ExtraPublicBone = FXBONE04

        RandomTexture       = EUDwarfmin_ered.tga 0 EUDwarfmin.tga
        RandomTexture       = eudwarfeng_ered.tga 0 eudwarfeng.tga
        RandomTexture       = eudwarfram_eng_ered.tga 0 eudwarfram.tga

        DefaultModelConditionState
            Model = DBForge
            WeaponLaunchBone = PRIMARY ARROW

        End


        AnimationState = BUILD_PLACEMENT_CURSOR
            BeginScript
                CurDrawableHideSubObject("N_Window")
                CurDrawableHideSubObject("N_Glow")
                   CurDrawableHideSubObject("Anvil")
                   CurDrawableHideSubObject("V2")
            EndScript
        End



        AnimationState = PHANTOM_STRUCTURE
            BeginScript
                CurDrawableHideSubObject("N_Window")
                CurDrawableHideSubObject("N_Glow")
                   CurDrawableHideSubObject("Anvil")
                   CurDrawableHideSubObject("V2")
            EndScript
        End

        IdleAnimationState
        ParticleSysBone     = Smoke01 DwfForgeSmoke02 Followbone:Yes
    End



        ModelConditionState = SNOW AWAITING_CONSTRUCTION UPGRADE_NUMENOR_STONEWORK
            Model    = DBForge_A
            Texture = DBForge_snow.tga DBForge.tga
            Texture = dwarvenforge01_snow.tga dwarvenforge01.tga
            Texture = DBStoneA_snow.tga DBStoneA.tga
            Texture = DBFortress_snow1.tga DBFortress1.tga
        End

        ModelConditionState = SNOW AWAITING_CONSTRUCTION
            Model    = DBForge_A
            Texture = DBForge.tga DBForge_Snow.tga
            Texture = dwarvenforge01.tga dwarvenforge01_snow.tga
            Texture = DBStoneA.tga DBStoneA_Snow.tga
            Texture = DBFortress1.tga DBFortress1_Snow.tga
        End

        ModelConditionState   = AWAITING_CONSTRUCTION
            Model               = DBForge_A

        End
        AnimationState        = AWAITING_CONSTRUCTION
            Animation           =  DBForge_A
                AnimationName     =  DBForge_ASKL.DBForge_ABLD
                AnimationMode     = MANUAL
                AnimationBlendTime = 0
            End
            Flags                  = START_FRAME_FIRST



        End

        ModelConditionState = SNOW ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED UPGRADE_NUMENOR_STONEWORK
            Model    = DBForge_A
            Texture = DBForge_Snow.tga DBForge.tga
            Texture = dwarvenforge01_Snow.tga dwarvenforge01.tga
            Texture = DBStoneA_Snow.tga DBStoneA.tga
            Texture = DBFortress1_Snow.tga DBFortress1.tga
        End

        ModelConditionState = SNOW ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Model    = DBForge_A
            Texture = DBForge.tga DBForge_Snow.tga
            Texture = dwarvenforge01.tga dwarvenforge01_snow.tga
            Texture = DBStoneA.tga DBStoneA_Snow.tga
            Texture = DBFortress1.tga DBFortress1_Snow.tga
        End

        ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Model               = DBForge_A
        End
        AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Animation           = DBForge_A
                AnimationName     = DBForge_ASKL.DBForge_ABLD
                AnimationMode     = MANUAL
                AnimationBlendTime = 0
            End
            Flags                  = START_FRAME_FIRST
            StateName              = BeingConstructed
            BeginScript
                CurDrawablePlaySound("GondorBarracksBeginConstruction")
            EndScript
            ParticleSysBone   = CONSTDUSTBONE01 BuildingContructDust FollowBone:Yes
        End




    ModelConditionState  = DAMAGED
      Model         = DBForge_D1
        ParticleSysBone FireSmall01 FireBuildingLarge
        ParticleSysBone FireSmall02 FireBuildingMedium
        ParticleSysBone FireSmall03 FireBuildingMedium
        ParticleSysBone FireSmall04 FireBuildingSmall
        ParticleSysBone FireSmall05 SmokeBuildingLarge
    End
    AnimationState = DAMAGED
        EnteringStateFX    = FX_BuildingDamaged
    End

    ModelConditionState  = REALLYDAMAGED
      Model         = DBForge_D2
        ParticleSysBone FireSmall01 FireBuildingLarge
        ParticleSysBone FireSmall02 FireBuildingLarge
        ParticleSysBone FireSmall03 FireBuildingMedium
        ParticleSysBone FireSmall04 SmokeBuildingLarge
        ParticleSysBone FireSmall05 SmokeBuildingLarge
    End
    AnimationState = REALLYDAMAGED
          Animation                =    RubbleAnimation
            AnimationName        =    DBForge_D2SK.DBForge_D2AN
            AnimationMode        =    ONCE
          End
        EnteringStateFX    = FX_BuildingReallyDamaged
    End

    ModelConditionState  = RUBBLE
      Model         = DBForge_D3
      ParticleSysBone SmokeLarge01 SmokeBuildingLarge
    End

    AnimationState = RUBBLE
          Animation                =    RubbleAnimation
            AnimationName        =    DBForge_D3SK.DBForge_D3AN
            AnimationMode        =    ONCE
          End
      EnteringStateFX    = FX_StructureMediumCollapse
    End

    ModelConditionState  = POST_RUBBLE
      Model         = None
        ParticleSysBone NONE SmokeBuildingMediumRubble
    End

    ModelConditionState  = POST_COLLAPSE
      Model         = None
        ParticleSysBone NONE SmokeBuildingMediumRubble
    End

    ModelConditionState = SNOW UPGRADE_NUMENOR_STONEWORK
        Model    = DBForge
        Texture = DBForge_snow.tga DBForge.tga
        Texture = dwarvenforge01_snow.tga dwarvenforge01.tga
        Texture = DBStoneA_snow.tga DBStoneA.tga
        Texture = DBMineA_snow.tga DBMineA.tga
        Texture = DBFortress1_snow.tga DBFortress1.tga
    End

    ModelConditionState = SNOW
        Model    = DBForge
        Texture = DBForge.tga DBForge_Snow.tga
        Texture = dwarvenforge01.tga dwarvenforge01_snow.tga
        Texture = DBStoneA.tga DBStoneA_Snow.tga
        Texture = DBMineA.tga DBMineA_Snow.tga
        Texture = DBFortress1.tga DBFortress1_Snow.tga
    End

    End


    Draw = W3DScriptedModelDraw ModuleTag_DrawDoor
        OkToChangeModelColor  = Yes

        StaticModelLODMode = Yes

        DefaultModelConditionState
            Model = DBForgeDr_SKN
        End

        IdleAnimationState
            Animation           = IDLE
                AnimationName     = DBForgeDoor_SKL.DBForgeDoor_CL
                AnimationMode     = LOOP
            End
            Flags                  = START_FRAME_FIRST
        End

        AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Animation           = GBFDoor_DRA
                AnimationName     = DBForgeDoor_SKL.DBForgeDoor_BLD
                AnimationMode     = MANUAL
            End
            Flags                  = START_FRAME_FIRST
        End


        AnimationState            =    DOOR_1_OPENING
            Animation           =    DBForgeDoor_OPN
                AnimationName   =    DBForgeDoor_SKL.DBForgeDoor_OPN
                AnimationMode   =    ONCE
                AnimationBlendTime = 0
            End

            ParticleSysBone     = None DwfSiegeDoorOpen Followbone:Yes
        End

           AnimationState            =    DOOR_1_WAITING_OPEN
            Animation           =    DBForgeDoor_OP
                AnimationName   =    DBForgeDoor_SKL.DBForgeDoor_OP
                AnimationMode   =    LOOP
                AnimationBlendTime = 0
            End
            Flags            = START_FRAME_FIRST
            ParticleSysBone     = None DwfSiegeDoorOpen Followbone:Yes
        End


           AnimationState            =    DOOR_1_CLOSING
            Animation           =    DBForgeDoor_CLS
                AnimationName   =    DBForgeDoor_SKL.DBForgeDoor_CLS
                AnimationMode   =    ONCE
                AnimationBlendTime = 0
            End

        End

          AnimationState            =    DOOR_1_CLOSING
            Animation           =    DBForgeDoor_CLS
                AnimationName   =    DBForgeDoor_SKL.DBForgeDoor_CLS
                AnimationMode   =    ONCE
                AnimationBlendTime = 0
            End

        End


        ModelConditionState        = POST_RUBBLE
            Model                = None
        End

        ModelConditionState        = POST_COLLAPSE
            Model                = None
        End

    End


    Draw = W3DScriptedModelDraw ModuleTag_DrawRune
        DefaultModelConditionState
            Model        = exforgerune
        End

    AnimationState = BUILD_PLACEMENT_CURSOR
        BeginScript
            CurDrawableHideSubObject("GLOW01")
            CurDrawableHideSubObject("GLOW02")
            CurDrawableHideSubObject("GLOW03")
            CurDrawableHideSubObject("GLOW04")
            CurDrawableHideSubObject("GLOW05")
        EndScript
    End
    AnimationState = PHANTOM_STRUCTURE
        BeginScript
            CurDrawableHideSubObject("GLOW01")
            CurDrawableHideSubObject("GLOW02")
            CurDrawableHideSubObject("GLOW03")
            CurDrawableHideSubObject("GLOW04")
            CurDrawableHideSubObject("GLOW05")
        EndScript
    End
    End


    Draw = W3DFloorDraw DrawFloorV1
        StaticModelLODMode = Yes
        ModelName = DBForge_Bib

          HideIfModelConditions    =    AWAITING_CONSTRUCTION
          HideIfModelConditions    =    PARTIALLY_CONSTRUCTED
    End

  PlacementViewAngle  = 45



    DisplayName             = OBJECT:DwarvenForgeWorks
    Description             = OBJECT:DwarvenForgeWorksDescription

    Side                    = Dwarves
    EditorSorting           = STRUCTURE
    ThreatLevel             = FACTORY_THREAT_LEVEL

    CommandSet              = DwarvenForgeWorksCommandSet_EredLuin

    RefundValue             = 300
    BuildCost               = 600
    BuildTime               = 35
    BountyValue             = 80
    VisionRange             = 160
    ShroudClearingRange     = 180
    MaxSimultaneousOfType   = 4

    WeaponSet
        Conditions        = None
    End

    WeaponSet
        Conditions        = PLAYER_UPGRADE
        Weapon            = PRIMARY StructureAxeWeapon
        AutoChooseSources    = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End


  ArmorSet
    Conditions            = None
    Armor                 = TechnologyArmor

  End




    #include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

    VoiceFullyCreated        = EVA:ForgeWorksComplete
    VoiceSelect            = DwarvenForgeWorksSelect
    VoiceSelectUnderConstruction    = BuildingGoodVoiceSelectUnderConstruction

    SoundAmbientDamaged        = BuildingDamageFireMediumLoop
    SoundAmbientReallyDamaged    = BuildingDamageFireMediumLoop
    SoundOnDamaged            = BuildingLightDamageStone
    SoundOnReallyDamaged        = BuildingHeavyDamageStone

    UnitSpecificSounds
        UnderConstruction    = BuildingConstructionLoop

        UnderRepairFromRubble    = BuildingConstructionLoop
    End

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap     = 800
        AnimationSound         = Sound:StatueHeroicBuildStoneDebris2 Animation:DBFORGE_ASKL.DBFORGE_ABLD Frames:190
        AnimationSound         = Sound:StatueHeroicBuildStoneDebris1 Animation:DBFORGE_ASKL.DBFORGE_ABLD Frames:210
    End




    RadarPriority       = STRUCTURE
    KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE NEED_BASE_FOUNDATION AUTO_RALLYPOINT FS_FACTORY MP_COUNT_FOR_VICTORY LIVING_WORLD_BUILDING_MIRROR

    Behavior            = GettingBuiltBehavior GetBuiltBehaviorTag
        WorkerName    = DwarvenWorkerNoSelect
        SpawnTimer    = DEFAULT_STRUCTURE_HEALDELAY
    End

    Body                        = StructureBody ModuleTag_05
        MaxHealth             = 3500
        MaxHealthDamaged      = DWARVEN_FORGEWORKS_MAXHEALTHDAMAGED
        MaxHealthReallyDamaged     = DWARVEN_FORGEWORKS_MAXHEALTH_REALLYDAMAGED
    End



    Behavior = RefundDie ModuleTag_refund
        UpgradeRequired     = Upgrade_MarketplaceUpgradeDefiance
        BuildingRequired     = ANY +GondorMarketPlace
        RefundPercent         = 50%
    End

    Behavior                  = StructureCollapseUpdate ModuleTag_06
        MinCollapseDelay        = 000
        MaxCollapseDelay        = 000
        CollapseDamping         = .5
        MaxShudder              = 0.6
        MinBurstDelay           = 250
        MaxBurstDelay           = 800
        BigBurstFrequency       = 4
        FXList                  = INITIAL   FX_StructureMediumCollapse
        FXList                  = ALMOST_FINAL  FX_StructureAlmostCollapse
        DestroyObjectWhenDone    = Yes
        CollapseHeight        = 120
    End

    Behavior = AIUpdateInterface ModuleTag_SoWeCanUseWeapon
        AutoAcquireEnemiesWhenIdle    = Yes
        MoodAttackCheckRate        = 250
        AILuaEventsList            = AngmarStructuresFunctions
    End

    Behavior = PassiveAreaEffectBehavior ModuleTag_FeelGoodHero2
        EffectRadius            = 350
        PingDelay               = 2000
        UpgradeRequired         = Upgrade_TestBuilding_2
        ModifierName            = DainHallenUnitModifier
        AllowFilter             = GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
    End

    Behavior = SubObjectsUpgrade ModuleTag_HideAll
        TriggeredBy        = Upgrade_StructureLevel1
        HideSubObjects        = Anvil V2
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowWallsAndFlag
        TriggeredBy        = Upgrade_StructureLevel2
        HideSubObjects        = Anvil V2
        UpgradeTexture        = dwarvenforge01.TGA 0 dwarvenforge02.TGA
        UpgradeTexture       = EUDwarfmin.tga 0 EUDwarfmin_ered.tga
        UpgradeTexture       = eudwarfeng.tga 0 eudwarfeng_ered.tga
        UpgradeTexture       = eudwarfram_eng.tga 0 eudwarfram_ered.tga
        RecolorHouse        = Yes
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowTowersAndHideFlag
        TriggeredBy        = Upgrade_StructureLevel3
        ShowSubObjects        = V2
        HideSubObjects        = Anvil
        UpgradeTexture        = dwarvenforge01.TGA 0 dwarvenforge02.TGA
        UpgradeTexture       = EUDwarfmin.tga 0 EUDwarfmin_ered.tga
        UpgradeTexture       = eudwarfeng.tga 0 eudwarfeng_ered.tga
        UpgradeTexture       = eudwarfram_eng.tga 0 eudwarfram_ered.tga
        RecolorHouse        = No
    End


    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP                                = Yes
        NumDoorAnimations       = 1
        DoorOpeningTime              =    7000
        DoorWaitOpenTime             =    6000
        DoorCloseTime                =    7000
        ConstructionCompleteDuration = 0
    End

    Behavior = QueueProductionExitUpdate QueueProductionModuleTag
        UnitCreatePoint        = X:0.0 Y:-80.0    Z:0.0
        NaturalRallyPoint    = X:0.0 Y:-80.0    Z:0.0
        PlacementViewAngle    = 270
        ExitDelay        = 50
    End

    Behavior = LevelUpUpgrade ModuleTag_LevelUpDwarvenForgeWorksLevel2
        TriggeredBy        = Upgrade_DwarvenForgeWorksLevel2
        LevelsToGain        = 1
        LevelCap        = 3
    End

    Behavior = LevelUpUpgrade ModuleTag_LevelUpDwarvenForgeWorksLevel3
        TriggeredBy        = Upgrade_DwarvenForgeWorksLevel3
        LevelsToGain        = 1
        LevelCap        = 3
    End

    Behavior = CommandSetUpgrade ModuleTag_DwarvenForgeWorksLevel2CommandSet
        TriggeredBy        = Upgrade_DwarvenForgeWorksLevel2
        ConflictsWith        = Upgrade_DwarvenForgeWorksLevel3
        CommandSet        = DwarvenForgeWorksCommandSetLevel2_EredLuin
    End

    Behavior = CommandSetUpgrade ModuleTag_DwarvenForgeWorksLevel3CommandSet
        TriggeredBy        = Upgrade_DwarvenForgeWorksLevel3
        CommandSet        = DwarvenForgeWorksCommandSetLevel3_EredLuin
    End
	
    Behavior = CommandSetUpgrade ModuleTag_DwarvenForgeWorksLevel1CommandSet_AI
        TriggeredBy        = Upgrade_ObjectUnderAIControl
        ConflictsWith        = Upgrade_DwarvenForgeWorksLevel2 Upgrade_DwarvenForgeWorksLevel3
        CommandSet        = DwarvenForgeWorksCommandSet_EredLuin_AI
    End
	
    Behavior = CommandSetUpgrade ModuleTag_DwarvenForgeWorksLevel2CommandSet_AI
        TriggeredBy        = Upgrade_ObjectUnderAIControl Upgrade_DwarvenForgeWorksLevel2
		RequiresAllTriggers = Yes
        ConflictsWith        = Upgrade_DwarvenForgeWorksLevel3
        CommandSet        = DwarvenForgeWorksCommandSetLevel2_EredLuin_AI
    End
	
    Behavior = CommandSetUpgrade ModuleTag_DwarvenForgeWorksLevel3CommandSet_AI
        TriggeredBy        = Upgrade_ObjectUnderAIControl Upgrade_DwarvenForgeWorksLevel3
		RequiresAllTriggers = Yes
        CommandSet        = DwarvenForgeWorksCommandSetLevel3_EredLuin_AI
    End

    Behavior = GeometryUpgrade Geom_ModuleTag_HideAll
        TriggeredBy        = Upgrade_StructureLevel1
        ShowGeometry        = Geom_Orig
        HideGeometry        = Geom_V2
    End
    Behavior = GeometryUpgrade Geom_ModuleTag_ShowWalls
        TriggeredBy        = Upgrade_StructureLevel2
        ShowGeometry        = Geom_Orig
        HideGeometry        = Geom_V2
    End
      Behavior = GeometryUpgrade Geom_ModuleTag_ShowFlagsAndTower
        TriggeredBy        = Upgrade_StructureLevel3
        ShowGeometry        = Geom_Orig Geom_V2
    End

    Behavior = TerrainResourceBehavior ModuleTag_NewMoneyDeadSpot
        Radius            = 100
        MaxIncome        = 0
        IncomeInterval        = 999999
        HighPriority        = Yes
        Visible         = No
    End

    Behavior                  = BuildingBehavior BuildingModuleTag
        NightWindowName         = N_Window N_Glow



    End



    Behavior = SubObjectsUpgrade Armor_Upgrade3
        TriggeredBy          = Upgrade_SubFactionEredLuin
        UpgradeTexture       = EUDwarfmin.tga 0 EUDwarfmin_ered.tga
        UpgradeTexture       = eudwarfeng.tga 0 eudwarfeng_ered.tga
        UpgradeTexture       = eudwarfram_eng.tga 0 eudwarfram_ered.tga
    End

    Behavior = SubObjectsUpgrade Armor_Upgrade33
        TriggeredBy          = Upgrade_DwarvenForgeWorksLevel2
        UpgradeTexture       = EUDwarfmin.tga 0 EUDwarfmin_ered.tga
        UpgradeTexture       = eudwarfeng.tga 0 eudwarfeng_ered.tga
        UpgradeTexture       = eudwarfram_eng.tga 0 eudwarfram_ered.tga
    End

    Behavior = SubObjectsUpgrade Armor_Upgrade333
        TriggeredBy          = Upgrade_DwarvenForgeWorksLevel3
        UpgradeTexture       = EUDwarfmin.tga 0 EUDwarfmin_ered.tga
        UpgradeTexture       = eudwarfeng.tga 0 eudwarfeng_ered.tga
        UpgradeTexture       = eudwarfram_eng.tga 0 eudwarfram_ered.tga
    End







    Behavior = SubObjectsUpgrade ModuleTag_HideGlow
        TriggeredBy             = Upgrade_AllFactionUpgrade
        HideSubObjects          = GLOW01 GLOW02 GLOW03 GLOW04 GLOW05
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowRune1
        TriggeredBy             = Upgrade_Level_1
        ShowSubObjects          = GLOW01
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowRune2
        TriggeredBy             = Upgrade_Level_2
        ShowSubObjects          = GLOW02
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowRune3
        TriggeredBy             = Upgrade_Level_3
        ShowSubObjects          = GLOW03
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowRune4
        TriggeredBy             = Upgrade_Level_4
        ShowSubObjects          = GLOW04
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowRune5
        TriggeredBy             = Upgrade_Level_5
        ShowSubObjects          = GLOW05
    End

    Behavior = PassiveAreaEffectBehavior ModuleTag_MysticFountainsHealing
        UpgradeRequired         = Upgrade_Level_3
        EffectRadius            = 180
        PingDelay               = 2000
        HealPercentPerSecond    = 2%
        AllowFilter             = ANY +INFANTRY +CAVALRY +HERO -MACHINE +MONSTER -IMMOBILE +DOZER
        NonStackable            = Yes
        HealFX                  = FX_SpellHealUnitHealBuff
    End

    Behavior = PassiveAreaEffectBehavior ModuleTag_FeelGoodHero
        UpgradeRequired         = Upgrade_Level_2
        EffectRadius            = 180
        PingDelay               = 2000
        ModifierName            = RuneInspirationLeadership
        AllowFilter             = GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
    End

    Behavior = ObjectCreationUpgrade CreateTheEffecktSchrecken
        TriggeredBy             = Upgrade_Level_5
        Delay                   = 0.0
        ThingToSpawn            = DwarvenRuneSchrecken
        FadeInTime              = 200
    End


    Behavior = AttributeModifierUpgrade ModuleTag_Unantastbrakeit
        TriggeredBy             = Upgrade_Level_1
        AttributeModifier       = DwarvenRuneUnantastbarkeit
    End

    Behavior = AttributeModifierUpgrade ModuleTag_Produktivitat
        TriggeredBy             = Upgrade_Level_4
        AttributeModifier       = DwarvenRuneProduktivitat
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI1
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 480000
        GrantUpgrade = Upgrade_DwarvenForgeWorksLevel2
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI2
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 680000
        GrantUpgrade = Upgrade_DwarvenForgeWorksLevel3
    End


    Geometry            = BOX
    GeometryName            = Geom_Orig
      GeometryMajorRadius        = 50.0
    GeometryMinorRadius        = 60.0
    GeometryHeight            = 25.0
    GeometryOffset            = X:0 Y:6 Z:0

    AdditionalGeometry        = BOX
    GeometryName            = Geom_Orig
    GeometryMajorRadius        = 15.0
    GeometryMinorRadius        = 10.0
    GeometryHeight            = 50.0
    GeometryOffset            = X:-25 Y:40 Z:0

    AdditionalGeometry        = CYLINDER
    GeometryIsSmall            = No
    GeometryName            = Geom_Orig
      GeometryMajorRadius        = 11.0
    GeometryMinorRadius        = 11.0
    GeometryHeight            = 76.0
    GeometryOffset            = X:27 Y:37 Z:0

    AdditionalGeometry        = Box
    GeometryName            = Geom_V2
    GeometryMajorRadius        = 9.0
    GeometryMinorRadius        = 9.0
    GeometryHeight            = 70.0
    GeometryOffset            = X:-30 Y:40 Z:0

    GeometryIsSmall               = No
    Shadow                        = SHADOW_VOLUME
    BuildCompletion             = PLACED_BY_PLAYER

    GeometryContactPoint         = X:-81.4        Y:-36.3        Z:0        Repair
    GeometryContactPoint         = X:47.546        Y:36.435    Z:0
    GeometryContactPoint         = X:-32.763        Y:-46.121    Z:0
    GeometryContactPoint         = X:26.753        Y:26.753    Z:67.933    Swoop

End



Object DwarvenSiegeWorks_Erebor

    SelectPortrait = BPDForgeWorks

    Draw = W3DScriptedModelDraw ModuleTag_Draw
        OkToChangeModelColor  = Yes
        UseStandardModelNames = Yes
        StaticModelLODMode = Yes

        ExtraPublicBone = ARROW01
        ExtraPublicBone = ARROW02
        ExtraPublicBone = ARROW03
        ExtraPublicBone = ARROW04
        ExtraPublicBone = FXBONE01
        ExtraPublicBone = FXBONE02
        ExtraPublicBone = FXBONE05
        ExtraPublicBone = FXBONE04

        RandomTexture       = EUDwarfmin_ereb.tga 0 EUDwarfmin.tga
        RandomTexture       = eudwarfeng_ereb.tga 0 eudwarfeng.tga
        RandomTexture       = eudwarfram_eng_ereb.tga 0 eudwarfram.tga

        DefaultModelConditionState
            Model = DBForge
            WeaponLaunchBone = PRIMARY ARROW

        End


        AnimationState = BUILD_PLACEMENT_CURSOR
            BeginScript
                CurDrawableHideSubObject("N_Window")
                CurDrawableHideSubObject("N_Glow")
                   CurDrawableHideSubObject("Anvil")
                   CurDrawableHideSubObject("V2")
            EndScript
        End



        AnimationState = PHANTOM_STRUCTURE
            BeginScript
                CurDrawableHideSubObject("N_Window")
                CurDrawableHideSubObject("N_Glow")
                   CurDrawableHideSubObject("Anvil")
                   CurDrawableHideSubObject("V2")
            EndScript
        End

        IdleAnimationState
        ParticleSysBone     = Smoke01 DwfForgeSmoke02 Followbone:Yes
    End



        ModelConditionState = SNOW AWAITING_CONSTRUCTION UPGRADE_NUMENOR_STONEWORK
            Model    = DBForge_A
            Texture = DBForge_snow.tga DBForge.tga
            Texture = dwarvenforge01_snow.tga dwarvenforge01.tga
            Texture = DBStoneA_snow.tga DBStoneA.tga
            Texture = DBFortress_snow1.tga DBFortress1.tga
        End

        ModelConditionState = SNOW AWAITING_CONSTRUCTION
            Model    = DBForge_A
            Texture = DBForge.tga DBForge_Snow.tga
            Texture = dwarvenforge01.tga dwarvenforge01_snow.tga
            Texture = DBStoneA.tga DBStoneA_Snow.tga
            Texture = DBFortress1.tga DBFortress1_Snow.tga
        End

        ModelConditionState   = AWAITING_CONSTRUCTION
            Model               = DBForge_A

        End
        AnimationState        = AWAITING_CONSTRUCTION
            Animation           =  DBForge_A
                AnimationName     =  DBForge_ASKL.DBForge_ABLD
                AnimationMode     = MANUAL
                AnimationBlendTime = 0
            End
            Flags                  = START_FRAME_FIRST



        End

        ModelConditionState = SNOW ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED UPGRADE_NUMENOR_STONEWORK
            Model    = DBForge_A
            Texture = DBForge_Snow.tga DBForge.tga
            Texture = dwarvenforge01_Snow.tga dwarvenforge01.tga
            Texture = DBStoneA_Snow.tga DBStoneA.tga
            Texture = DBFortress1_Snow.tga DBFortress1.tga
        End

        ModelConditionState = SNOW ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Model    = DBForge_A
            Texture = DBForge.tga DBForge_Snow.tga
            Texture = dwarvenforge01.tga dwarvenforge01_snow.tga
            Texture = DBStoneA.tga DBStoneA_Snow.tga
            Texture = DBFortress1.tga DBFortress1_Snow.tga
        End

        ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Model               = DBForge_A
        End
        AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Animation           = DBForge_A
                AnimationName     = DBForge_ASKL.DBForge_ABLD
                AnimationMode     = MANUAL
                AnimationBlendTime = 0
            End
            Flags                  = START_FRAME_FIRST
            StateName              = BeingConstructed
            BeginScript
                CurDrawablePlaySound("GondorBarracksBeginConstruction")
            EndScript
            ParticleSysBone   = CONSTDUSTBONE01 BuildingContructDust FollowBone:Yes
        End




    ModelConditionState  = DAMAGED
      Model         = DBForge_D1
        ParticleSysBone FireSmall01 FireBuildingLarge
        ParticleSysBone FireSmall02 FireBuildingMedium
        ParticleSysBone FireSmall03 FireBuildingMedium
        ParticleSysBone FireSmall04 FireBuildingSmall
        ParticleSysBone FireSmall05 SmokeBuildingLarge
    End
    AnimationState = DAMAGED
        EnteringStateFX    = FX_BuildingDamaged
    End

    ModelConditionState  = REALLYDAMAGED
      Model         = DBForge_D2
        ParticleSysBone FireSmall01 FireBuildingLarge
        ParticleSysBone FireSmall02 FireBuildingLarge
        ParticleSysBone FireSmall03 FireBuildingMedium
        ParticleSysBone FireSmall04 SmokeBuildingLarge
        ParticleSysBone FireSmall05 SmokeBuildingLarge
    End
    AnimationState = REALLYDAMAGED
          Animation                =    RubbleAnimation
            AnimationName        =    DBForge_D2SK.DBForge_D2AN
            AnimationMode        =    ONCE
          End
        EnteringStateFX    = FX_BuildingReallyDamaged
    End

    ModelConditionState  = RUBBLE
      Model         = DBForge_D3
      ParticleSysBone SmokeLarge01 SmokeBuildingLarge
    End

    AnimationState = RUBBLE
          Animation                =    RubbleAnimation
            AnimationName        =    DBForge_D3SK.DBForge_D3AN
            AnimationMode        =    ONCE
          End
      EnteringStateFX    = FX_StructureMediumCollapse
    End

    ModelConditionState  = POST_RUBBLE
      Model         = None
        ParticleSysBone NONE SmokeBuildingMediumRubble
    End

    ModelConditionState  = POST_COLLAPSE
      Model         = None
        ParticleSysBone NONE SmokeBuildingMediumRubble
    End

    ModelConditionState = SNOW UPGRADE_NUMENOR_STONEWORK
        Model    = DBForge
        Texture = DBForge_snow.tga DBForge.tga
        Texture = dwarvenforge01_snow.tga dwarvenforge01.tga
        Texture = DBStoneA_snow.tga DBStoneA.tga
        Texture = DBMineA_snow.tga DBMineA.tga
        Texture = DBFortress1_snow.tga DBFortress1.tga
    End

    ModelConditionState = SNOW
        Model    = DBForge
        Texture = DBForge.tga DBForge_Snow.tga
        Texture = dwarvenforge01.tga dwarvenforge01_snow.tga
        Texture = DBStoneA.tga DBStoneA_Snow.tga
        Texture = DBMineA.tga DBMineA_Snow.tga
        Texture = DBFortress1.tga DBFortress1_Snow.tga
    End

    End


    Draw = W3DScriptedModelDraw ModuleTag_DrawDoor
        OkToChangeModelColor  = Yes

        StaticModelLODMode = Yes

        DefaultModelConditionState
            Model = DBForgeDr_SKN
        End

        IdleAnimationState
            Animation           = IDLE
                AnimationName     = DBForgeDoor_SKL.DBForgeDoor_CL
                AnimationMode     = LOOP
            End
            Flags                  = START_FRAME_FIRST
        End

        AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Animation           = GBFDoor_DRA
                AnimationName     = DBForgeDoor_SKL.DBForgeDoor_BLD
                AnimationMode     = MANUAL
            End
            Flags                  = START_FRAME_FIRST
        End


        AnimationState            =    DOOR_1_OPENING
            Animation           =    DBForgeDoor_OPN
                AnimationName   =    DBForgeDoor_SKL.DBForgeDoor_OPN
                AnimationMode   =    ONCE
                AnimationBlendTime = 0
            End

            ParticleSysBone     = None DwfSiegeDoorOpen Followbone:Yes
        End

           AnimationState            =    DOOR_1_WAITING_OPEN
            Animation           =    DBForgeDoor_OP
                AnimationName   =    DBForgeDoor_SKL.DBForgeDoor_OP
                AnimationMode   =    LOOP
                AnimationBlendTime = 0
            End
            Flags            = START_FRAME_FIRST
            ParticleSysBone     = None DwfSiegeDoorOpen Followbone:Yes
        End


           AnimationState            =    DOOR_1_CLOSING
            Animation           =    DBForgeDoor_CLS
                AnimationName   =    DBForgeDoor_SKL.DBForgeDoor_CLS
                AnimationMode   =    ONCE
                AnimationBlendTime = 0
            End

        End

          AnimationState            =    DOOR_1_CLOSING
            Animation           =    DBForgeDoor_CLS
                AnimationName   =    DBForgeDoor_SKL.DBForgeDoor_CLS
                AnimationMode   =    ONCE
                AnimationBlendTime = 0
            End

        End


        ModelConditionState        = POST_RUBBLE
            Model                = None
        End

        ModelConditionState        = POST_COLLAPSE
            Model                = None
        End

    End


    Draw = W3DScriptedModelDraw ModuleTag_DrawRune
        DefaultModelConditionState
            Model        = exforgerune
        End

    AnimationState = BUILD_PLACEMENT_CURSOR
        BeginScript
            CurDrawableHideSubObject("GLOW01")
            CurDrawableHideSubObject("GLOW02")
            CurDrawableHideSubObject("GLOW03")
            CurDrawableHideSubObject("GLOW04")
            CurDrawableHideSubObject("GLOW05")
        EndScript
    End
    AnimationState = PHANTOM_STRUCTURE
        BeginScript
            CurDrawableHideSubObject("GLOW01")
            CurDrawableHideSubObject("GLOW02")
            CurDrawableHideSubObject("GLOW03")
            CurDrawableHideSubObject("GLOW04")
            CurDrawableHideSubObject("GLOW05")
        EndScript
    End
    End


    Draw = W3DFloorDraw DrawFloorV1
        StaticModelLODMode = Yes
        ModelName = DBForge_Bib

          HideIfModelConditions    =    AWAITING_CONSTRUCTION
          HideIfModelConditions    =    PARTIALLY_CONSTRUCTED
    End


  PlacementViewAngle  = 45



    DisplayName             = OBJECT:DwarvenForgeWorks
    Description             = OBJECT:DwarvenForgeWorksDescription

    Side                    = Dwarves
    EditorSorting           = STRUCTURE
    ThreatLevel             = FACTORY_THREAT_LEVEL

    CommandSet              = DwarvenForgeWorksCommandSet_Erebor
    RefundValue             = 300
    BuildCost               = 600
    BuildTime               = 35
    BountyValue             = 80
    VisionRange             = 160
    ShroudClearingRange     = 180
    MaxSimultaneousOfType   = 4

    WeaponSet
        Conditions        = None
    End

    WeaponSet
        Conditions        = PLAYER_UPGRADE
        Weapon            = PRIMARY StructureAxeWeapon
        AutoChooseSources = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End

    ArmorSet
   	 Conditions            = None
   	 Armor                 = TechnologyArmor
    End




    #include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

    VoiceFullyCreated        = EVA:ForgeWorksComplete
    VoiceSelect            = DwarvenForgeWorksSelect
    VoiceSelectUnderConstruction    = BuildingGoodVoiceSelectUnderConstruction

    SoundAmbientDamaged        = BuildingDamageFireMediumLoop
    SoundAmbientReallyDamaged    = BuildingDamageFireMediumLoop
    SoundOnDamaged            = BuildingLightDamageStone
    SoundOnReallyDamaged        = BuildingHeavyDamageStone

    UnitSpecificSounds
        UnderConstruction    = BuildingConstructionLoop

        UnderRepairFromRubble    = BuildingConstructionLoop
    End

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap     = 800
        AnimationSound         = Sound:StatueHeroicBuildStoneDebris2 Animation:DBFORGE_ASKL.DBFORGE_ABLD Frames:190
        AnimationSound         = Sound:StatueHeroicBuildStoneDebris1 Animation:DBFORGE_ASKL.DBFORGE_ABLD Frames:210
    End




    RadarPriority       = STRUCTURE
    KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE NEED_BASE_FOUNDATION AUTO_RALLYPOINT FS_FACTORY MP_COUNT_FOR_VICTORY LIVING_WORLD_BUILDING_MIRROR

    Behavior            = GettingBuiltBehavior GetBuiltBehaviorTag
        WorkerName    = DwarvenWorkerNoSelect
        SpawnTimer    = DEFAULT_STRUCTURE_HEALDELAY
    End

    Body                        = StructureBody ModuleTag_05
        MaxHealth             = 3500
        MaxHealthDamaged      = DWARVEN_FORGEWORKS_MAXHEALTHDAMAGED
        MaxHealthReallyDamaged     = DWARVEN_FORGEWORKS_MAXHEALTH_REALLYDAMAGED
    End



    Behavior = RefundDie ModuleTag_refund
        UpgradeRequired     = Upgrade_MarketplaceUpgradeDefiance
        BuildingRequired     = ANY +GondorMarketPlace
        RefundPercent         = 50%
    End

    Behavior                  = StructureCollapseUpdate ModuleTag_06
        MinCollapseDelay        = 000
        MaxCollapseDelay        = 000
        CollapseDamping         = .5
        MaxShudder              = 0.6
        MinBurstDelay           = 250
        MaxBurstDelay           = 800
        BigBurstFrequency       = 4
        FXList                  = INITIAL   FX_StructureMediumCollapse
        FXList                  = ALMOST_FINAL  FX_StructureAlmostCollapse
        DestroyObjectWhenDone    = Yes
        CollapseHeight        = 120
    End

    Behavior = AIUpdateInterface ModuleTag_SoWeCanUseWeapon
        AutoAcquireEnemiesWhenIdle    = Yes
        MoodAttackCheckRate        = 250
        AILuaEventsList            = AngmarStructuresFunctions
    End

    Behavior = SubObjectsUpgrade ModuleTag_HideAll
        TriggeredBy        = Upgrade_StructureLevel1
        HideSubObjects        = Anvil V2
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowWallsAndFlag
        TriggeredBy        = Upgrade_StructureLevel2
        HideSubObjects        = Anvil V2
        UpgradeTexture        = dwarvenforge01.TGA 0 dwarvenforge02.TGA
        UpgradeTexture       = EUDwarfmin.tga 0 EUDwarfmin_ereb.tga
        UpgradeTexture       = eudwarfeng.tga 0 eudwarfeng_ereb.tga
        UpgradeTexture       = eudwarfram_eng.tga 0 eudwarfram_ereb.tga
        RecolorHouse        = Yes
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowTowersAndHideFlag
        TriggeredBy        = Upgrade_StructureLevel3
        ShowSubObjects        = V2
        HideSubObjects        = Anvil
        UpgradeTexture        = dwarvenforge01.TGA 0 dwarvenforge02.TGA
        UpgradeTexture       = EUDwarfmin.tga 0 EUDwarfmin_ereb.tga
        UpgradeTexture       = eudwarfeng.tga 0 eudwarfeng_ereb.tga
        UpgradeTexture       = eudwarfram_eng.tga 0 eudwarfram_ereb.tga
        RecolorHouse        = No
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag

        GiveNoXP                                = Yes
        NumDoorAnimations       = 1
        DoorOpeningTime              =    7000
        DoorWaitOpenTime             =    6000
        DoorCloseTime                =    7000
        ConstructionCompleteDuration = 0
    End

    Behavior = QueueProductionExitUpdate QueueProductionModuleTag
        UnitCreatePoint        = X:0.0 Y:-80.0    Z:0.0
        NaturalRallyPoint    = X:0.0 Y:-80.0    Z:0.0
        PlacementViewAngle    = 270
        ExitDelay        = 50
    End

    Behavior = LevelUpUpgrade ModuleTag_LevelUpDwarvenForgeWorksLevel2
        TriggeredBy        = Upgrade_DwarvenForgeWorksLevel2
        LevelsToGain        = 1
        LevelCap        = 3
    End

    Behavior = LevelUpUpgrade ModuleTag_LevelUpDwarvenForgeWorksLevel3
        TriggeredBy        = Upgrade_DwarvenForgeWorksLevel3
        LevelsToGain        = 1
        LevelCap        = 3
    End

    Behavior = CommandSetUpgrade ModuleTag_DwarvenForgeWorksLevel2CommandSet
        TriggeredBy        = Upgrade_DwarvenForgeWorksLevel2
        ConflictsWith        = Upgrade_DwarvenForgeWorksLevel3
        CommandSet        = DwarvenForgeWorksCommandSetLevel2_Erebor
    End

    Behavior = CommandSetUpgrade ModuleTag_DwarvenForgeWorksLevel3CommandSet
        TriggeredBy        = Upgrade_DwarvenForgeWorksLevel3
        CommandSet        = DwarvenForgeWorksCommandSetLevel3_Erebor
    End
	
    Behavior = CommandSetUpgrade ModuleTag_DwarvenForgeWorksLevel1CommandSet_AI
        TriggeredBy        = Upgrade_ObjectUnderAIControl
        ConflictsWith      = Upgrade_DwarvenForgeWorksLevel2 Upgrade_DwarvenForgeWorksLevel3
        CommandSet        = DwarvenForgeWorksCommandSet_Erebor_AI
    End
	
    Behavior = CommandSetUpgrade ModuleTag_DwarvenForgeWorksLevel2CommandSet_AI
        TriggeredBy        = Upgrade_ObjectUnderAIControl Upgrade_DwarvenForgeWorksLevel2
		RequiresAllTriggers = Yes
        ConflictsWith        = Upgrade_DwarvenForgeWorksLevel3
        CommandSet        = DwarvenForgeWorksCommandSetLevel2_Erebor_AI
    End

    Behavior = CommandSetUpgrade ModuleTag_DwarvenForgeWorksLevel3CommandSet_AI
        TriggeredBy        = Upgrade_ObjectUnderAIControl Upgrade_DwarvenForgeWorksLevel3
		RequiresAllTriggers = Yes
        CommandSet        = DwarvenForgeWorksCommandSetLevel3_Erebor_AI
    End
	
    Behavior = GeometryUpgrade Geom_ModuleTag_HideAll
        TriggeredBy        = Upgrade_StructureLevel1
        ShowGeometry        = Geom_Orig
        HideGeometry        = Geom_V2
    End
    Behavior = GeometryUpgrade Geom_ModuleTag_ShowWalls
        TriggeredBy        = Upgrade_StructureLevel2
        ShowGeometry        = Geom_Orig
        HideGeometry        = Geom_V2
    End
      Behavior = GeometryUpgrade Geom_ModuleTag_ShowFlagsAndTower
        TriggeredBy        = Upgrade_StructureLevel3
        ShowGeometry        = Geom_Orig Geom_V2
    End

    Behavior = TerrainResourceBehavior ModuleTag_NewMoneyDeadSpot
        Radius            = 100
        MaxIncome        = 0
        IncomeInterval        = 999999
        HighPriority        = Yes
        Visible         = No
    End

    Behavior                  = BuildingBehavior BuildingModuleTag
        NightWindowName         = N_Window N_Glow



    End




    Behavior = SubObjectsUpgrade Armor_Upgrade2
        TriggeredBy          = Upgrade_SubFactionErebor
        UpgradeTexture       = EUDwarfmin.tga 0 EUDwarfmin_ereb.tga
        UpgradeTexture       = eudwarfeng.tga 0 eudwarfeng_ereb.tga
        UpgradeTexture       = eudwarfram_eng.tga 0 eudwarfram_ereb.tga
    End

    Behavior = SubObjectsUpgrade Armor_Upgrade22
        TriggeredBy          = Upgrade_DwarvenForgeWorksLevel2
        UpgradeTexture       = EUDwarfmin.tga 0 EUDwarfmin_ereb.tga
        UpgradeTexture       = eudwarfeng.tga 0 eudwarfeng_ereb.tga
        UpgradeTexture       = eudwarfram_eng.tga 0 eudwarfram_ereb.tga
    End

    Behavior = SubObjectsUpgrade Armor_Upgrade222
        TriggeredBy          = Upgrade_DwarvenForgeWorksLevel3
        UpgradeTexture       = EUDwarfmin.tga 0 EUDwarfmin_ereb.tga
        UpgradeTexture       = eudwarfeng.tga 0 eudwarfeng_ereb.tga
        UpgradeTexture       = eudwarfram_eng.tga 0 eudwarfram_ereb.tga
    End







    Behavior = SubObjectsUpgrade ModuleTag_HideGlow
        TriggeredBy             = Upgrade_AllFactionUpgrade
        HideSubObjects          = GLOW01 GLOW02 GLOW03 GLOW04 GLOW05
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowRune1
        TriggeredBy             = Upgrade_Level_1
        ShowSubObjects          = GLOW01
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowRune2
        TriggeredBy             = Upgrade_Level_2
        ShowSubObjects          = GLOW02
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowRune3
        TriggeredBy             = Upgrade_Level_3
        ShowSubObjects          = GLOW03
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowRune4
        TriggeredBy             = Upgrade_Level_4
        ShowSubObjects          = GLOW04
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowRune5
        TriggeredBy             = Upgrade_Level_5
        ShowSubObjects          = GLOW05
    End

    Behavior = PassiveAreaEffectBehavior ModuleTag_MysticFountainsHealing
        UpgradeRequired         = Upgrade_Level_3
        EffectRadius            = 180
        PingDelay               = 2000
        HealPercentPerSecond    = 2%
        AllowFilter             = ANY +INFANTRY +CAVALRY +HERO -MACHINE +MONSTER -IMMOBILE +DOZER
        NonStackable            = Yes
        HealFX                  = FX_SpellHealUnitHealBuff
    End

    Behavior = PassiveAreaEffectBehavior ModuleTag_FeelGoodHero
        UpgradeRequired         = Upgrade_Level_2
        EffectRadius            = 180
        PingDelay               = 2000
        ModifierName            = RuneInspirationLeadership
        AllowFilter             = GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
    End

    Behavior = ObjectCreationUpgrade CreateTheEffecktSchrecken
        TriggeredBy             = Upgrade_Level_5
        Delay                   = 0.0
        ThingToSpawn            = DwarvenRuneSchrecken
        FadeInTime              = 200
    End

    Behavior = AttributeModifierUpgrade ModuleTag_Unantastbrakeit
        TriggeredBy             = Upgrade_Level_1
        AttributeModifier       = DwarvenRuneUnantastbarkeit
    End

    Behavior = AttributeModifierUpgrade ModuleTag_Produktivitat
        TriggeredBy             = Upgrade_Level_4
        AttributeModifier       = DwarvenRuneProduktivitat
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI1
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 480000
        GrantUpgrade = Upgrade_DwarvenForgeWorksLevel2
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI2
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 680000
        GrantUpgrade = Upgrade_DwarvenForgeWorksLevel3
    End

    Geometry            = BOX
    GeometryName            = Geom_Orig
      GeometryMajorRadius        = 50.0
    GeometryMinorRadius        = 60.0
    GeometryHeight            = 25.0
    GeometryOffset            = X:0 Y:6 Z:0

    AdditionalGeometry        = BOX
    GeometryName            = Geom_Orig
    GeometryMajorRadius        = 15.0
    GeometryMinorRadius        = 10.0
    GeometryHeight            = 50.0
    GeometryOffset            = X:-25 Y:40 Z:0

    AdditionalGeometry        = CYLINDER
    GeometryIsSmall            = No
    GeometryName            = Geom_Orig
      GeometryMajorRadius        = 11.0
    GeometryMinorRadius        = 11.0
    GeometryHeight            = 76.0
    GeometryOffset            = X:27 Y:37 Z:0

    AdditionalGeometry        = Box
    GeometryName            = Geom_V2
    GeometryMajorRadius        = 9.0
    GeometryMinorRadius        = 9.0
    GeometryHeight            = 70.0
    GeometryOffset            = X:-30 Y:40 Z:0

    GeometryIsSmall               = No
    Shadow                        = SHADOW_VOLUME
    BuildCompletion             = PLACED_BY_PLAYER

    GeometryContactPoint         = X:-81.4        Y:-36.3        Z:0        Repair
    GeometryContactPoint         = X:47.546        Y:36.435    Z:0
    GeometryContactPoint         = X:-32.763        Y:-46.121    Z:0
    GeometryContactPoint         = X:26.753        Y:26.753    Z:67.933    Swoop

End

