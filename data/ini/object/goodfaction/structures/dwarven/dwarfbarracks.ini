Object DwarfBarracks

    SelectPortrait = BPDHallOfWarriors

  Draw = W3DScriptedModelDraw ModuleTag_Draw

    OkToChangeModelColor  = No
    UseStandardModelNames = Yes
    StaticModelLODMode    = Yes

	ExtraPublicBone = ARROW01
	ExtraPublicBone = ARROW02
	ExtraPublicBone = ARROW03
	ExtraPublicBone = ARROW04

	RandomTexture  = dbminea_erebor.tga 0 dbminea.tga
	RandomTexture  = dbstonea_erebor.tga 0 dbstonea.tga
	RandomTexture  = ebbarracks_erebor.tga 0 ebbarracks.tga
	RandomTexture  = dbfortress1_erebor.tga 0 dbfortress1.tga

    DefaultModelConditionState
		Model = EBBarracks_SKN
		WeaponLaunchBone = PRIMARY ARROW
    End


	AnimationState = BUILD_PLACEMENT_CURSOR
		BeginScript
			CurDrawableHideSubObject("N_Window")
			CurDrawableHideSubObject("N_Glow")
   			CurDrawableHideSubObject("V1")
			CurDrawableHideSubObject("V2")
		EndScript
	End


	AnimationState = PHANTOM_STRUCTURE
		BeginScript
			CurDrawableHideSubObject("N_Window")
			CurDrawableHideSubObject("N_Glow")
   			CurDrawableHideSubObject("V1")
			CurDrawableHideSubObject("V2")
		EndScript
	End

   IdleAnimationState
		Animation = IDLA
			AnimationName		=	EBBarracks_SKL.EBBarracks_IDLA
			AnimationMode			=	ONCE
			AnimationBlendTime = 0
		End
		Animation = IDLB
			AnimationName		=	EBBarracks_SKL.EBBarracks_IDLB
			AnimationMode			=	ONCE
			AnimationBlendTime = 0
		End
	End

		ModelConditionState = SNOW AWAITING_CONSTRUCTION
			Model	= EBBarracks_ASKN
			Texture = EBBarracks.tga EBBarracks_Snow.tga
			Texture = DBStoneA.tga DBStoneA_Snow.tga
			Texture = DBFortress1.tga DBFortress1_Snow.tga
		End

		ModelConditionState   = AWAITING_CONSTRUCTION
			Model               = EBBarracks_ASKN
		End
		AnimationState        = AWAITING_CONSTRUCTION
			Animation           =  EBBarracks_A
				AnimationName     =  EBBarracks_ASKL.EBBarracks_ABLD
				AnimationMode     = MANUAL
				AnimationBlendTime = 0
			End
			Flags				  = START_FRAME_FIRST
		End

		ModelConditionState = SNOW ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Model	= EBBarracks_ASKN
			Texture = EBBarracks.tga EBBarracks_Snow.tga
			Texture = DBStoneA.tga DBStoneA_Snow.tga
			Texture = DBFortress1.tga DBFortress1_Snow.tga
		End

		ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Model               = EBBarracks_ASKN
		End

		AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Animation           = EBBarracks_A
				AnimationName     = EBBarracks_ASKL.EBBarracks_ABLD
				AnimationMode     = MANUAL
				AnimationBlendTime = 0
			End
			Flags				  = START_FRAME_FIRST
			StateName			  = BeingConstructed
			BeginScript
				CurDrawablePlaySound("GondorBarracksBeginConstruction")
			EndScript
			ParticleSysBone   = CONSTDUSTBONE01 BuildingContructDust FollowBone:Yes
		End




    ModelConditionState  = DAMAGED
      Model         = EBBarracks_D1
		ParticleSysBone FireSmall01 FireBuildingLarge
		ParticleSysBone FireSmall02 FireBuildingMedium
		ParticleSysBone FireSmall03 FireBuildingMedium
		ParticleSysBone FireSmall04 FireBuildingSmall
		ParticleSysBone FireSmall05 SmokeBuildingLarge
    End
    AnimationState = DAMAGED
		EnteringStateFX	= FX_BuildingDamaged
    End

    ModelConditionState  = REALLYDAMAGED
      Model         = EBBarracks_D2
		ParticleSysBone FireSmall01 FireBuildingLarge
		ParticleSysBone FireSmall02 FireBuildingLarge
		ParticleSysBone FireSmall03 FireBuildingMedium
		ParticleSysBone FireSmall04 SmokeBuildingLarge
		ParticleSysBone FireSmall05 SmokeBuildingLarge
    End
    AnimationState = REALLYDAMAGED
      	Animation				=	RubbleAnimation
			AnimationName		=	EBBarracks_D2SK.EBBarracks_D2AN
			AnimationMode		=	ONCE
  		End
		EnteringStateFX	= FX_BuildingReallyDamaged
    End

    ModelConditionState  = RUBBLE
      Model         = EBBarracks_D3
      ParticleSysBone SmokeLarge01 SmokeBuildingLarge
    End

    AnimationState = RUBBLE
      	Animation				=	RubbleAnimation
			AnimationName		=	EBBarracks_D3SK.EBBarracks_D3AN
			AnimationMode		=	ONCE
  		End
	  EnteringStateFX	= FX_StructureMediumCollapse
	End

    ModelConditionState  = POST_RUBBLE
      Model         = None
		ParticleSysBone NONE SmokeBuildingMediumRubble
    End

    ModelConditionState  = POST_COLLAPSE
      Model         = None
		ParticleSysBone NONE SmokeBuildingMediumRubble
    End



	ModelConditionState = SNOW
		Model	= EBBarracks_SKN
		Texture = EBBarracks.tga EBBarracks_Snow.tga
		Texture = DBStoneA.tga DBStoneA_Snow.tga
		Texture = DBMineA.tga DBMineA_Snow.tga
		Texture = DBFortress1.tga DBFortress1_Snow.tga
    End

End

  Draw = W3DFloorDraw ModuleTag_DrawFloor
     StaticModelLODMode = Yes
     ModelName 		= EBBarracks_Bib
     WeatherTexture	= SNOWY EBBarracks_Bib_snow.tga
     HideIfModelConditions	= AWAITING_CONSTRUCTION
     HideIfModelConditions	= PARTIALLY_CONSTRUCTED
  End

  Draw = W3DScriptedModelDraw ModuleTag_Draw_HCBanner
	OkToChangeModelColor  = Yes
	DefaultModelConditionState
		Model = EBHCBarracks
	End
	MultiPlayerOnly = Yes
  End

  PlacementViewAngle  = 0



  DisplayName         = OBJECT:DwarvenBarracks
  Description         = OBJECT:DwarvenBarracksDescription
  Side                = Dwarves
  EditorSorting       = STRUCTURE
  ThreatLevel         = FACTORY_THREAT_LEVEL
  MaxSimultaneousOfType   = 4
  RefundValue             = 200
  BuildCost               = 350
  BuildTime               = 40
  BountyValue             = 80
  VisionRange             = 160
  ShroudClearingRange     = 180
  CommandSet              = DwarvenBarracksCommandSet


  ArmorSet
    Conditions            = None
    Armor                 = FactoryArmor
  End

    WeaponSet
        Conditions        = None
    End

    WeaponSet
        Conditions        = PLAYER_UPGRADE
        Weapon            = PRIMARY StructureAxeWeapon
        AutoChooseSources = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End




    #include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

    VoiceSelect        = DwarfBarracksSelect

    SoundOnDamaged        = BuildingLightDamageStone
    SoundOnReallyDamaged    = BuildingHeavyDamageStone

    VoiceSelectUnderConstruction    = BuildingGoodVoiceSelectUnderConstruction
    VoiceFullyCreated        = EVA:HallOfWarriorsComplete

    UnitSpecificSounds
        UnderConstruction    = BuildingConstructionLoop

        UnderRepairFromRubble    = BuildingConstructionLoop
    End

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800


        AnimationSound     = Sound:StatueHeroicBuildStoneDebris2 Animation:EBBarracks_ASKL.EBBarracks_ABLD Frames:247
        AnimationSound     = Sound:StatueHeroicBuildStoneDebris1 Animation:EBBarracks_ASKL.EBBarracks_ABLD Frames:257

    End





  RadarPriority       = STRUCTURE
  KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE FS_FACTORY AUTO_RALLYPOINT MP_COUNT_FOR_VICTORY NEED_BASE_FOUNDATION ATTACK_NEEDS_LINE_OF_SIGHT CAN_ATTACK MADE_OF_STONE LIVING_WORLD_BUILDING_MIRROR

  Behavior            = GettingBuiltBehavior ModuleTag_04
    WorkerName        = DwarvenWorkerNoSelect
    SpawnTimer        = DEFAULT_STRUCTURE_HEALDELAY
  End

    Behavior = TerrainResourceBehavior ModuleTag_NewMoneyDeadSpot
        Radius            = 100
        MaxIncome        = 0
        IncomeInterval        = 999999
        HighPriority        = Yes
        Visible         = No
    End

    Behavior = AIUpdateInterface ModuleTag_SoWeCanUseWeapon
        AutoAcquireEnemiesWhenIdle    = Yes
        MoodAttackCheckRate        = 250
        AILuaEventsList            = AngmarStructuresFunctions
    End

    Behavior = PassiveAreaEffectBehavior ModuleTag_FeelGoodHero2
        EffectRadius            = 350
        PingDelay               = 2000
        UpgradeRequired         = Upgrade_TestBuilding_2
        ModifierName            = DainHallenUnitModifier
        AllowFilter             = GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
    End










  Body                        = ActiveBody ModuleTag_05
    MaxHealth                 = 3500
    MaxHealthDamaged         = DWARVEN_BARRACKS_HEALTH_DAMAGED
    MaxHealthReallyDamaged  = DWARVEN_BARRACKS_HEALTH_REALLY_DAMAGED
    DamageCreationList         = OCL_BuildingDamageList01 CATAPULT_ROCK

    DamageCreationList = OCL_GBBarracksN2D2_Chunk1 CATAPULT_ROCK FRONT_DESTROYED
    DamageCreationList = OCL_GBBarracksN2D2_Chunk2 CATAPULT_ROCK RIGHT_DESTROYED
    DamageCreationList = OCL_GBBarracksN2D2_Chunk3 CATAPULT_ROCK BACK_DESTROYED
    DamageCreationList = OCL_GBBarracksN2D2_Chunk4 CATAPULT_ROCK LEFT_DESTROYED

  End

    Behavior = RefundDie ModuleTag_refund
        UpgradeRequired     = Upgrade_MarketplaceUpgradeDefiance
        BuildingRequired     = ANY +GondorMarketPlace
        RefundPercent         = 50%
    End

  Behavior = ProductionUpdate ModuleTag_06
    GiveNoXP = Yes
  End

  Behavior = QueueProductionExitUpdate ModuleTag_07
    UnitCreatePoint            = X:0.0 Y:0.0 Z:0.0
    NaturalRallyPoint            = X:75.0 Y:-70.0 Z:0.0
    ExitDelay                = STANDARD_HORDE_EXIT_DELAY
    UseReturnToFormation        = No
    PlacementViewAngle        = -45
  End

  Behavior                  = StructureCollapseUpdate ModuleTag_08
    MinCollapseDelay        = 000
    MaxCollapseDelay        = 000
    CollapseDamping         = .5
    MaxShudder              = 0.6
    MinBurstDelay           = 250
    MaxBurstDelay           = 800
    BigBurstFrequency       = 4
    FXList                  = INITIAL   FX_StructureMediumCollapse
    FXList                  = ALMOST_FINAL  FX_StructureAlmostCollapse
    DestroyObjectWhenDone    = Yes
    CollapseHeight        = 155
  End



















    Behavior = SubObjectsUpgrade ModuleTag_HideAll
        TriggeredBy        = Upgrade_StructureLevel1
        HideSubObjects        = V1 V2
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowWallsAndFlag
        TriggeredBy        = Upgrade_DwarvenBarracksLevel2
        ShowSubObjects     = V1
        HideSubObjects     = V2
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowTowersAndHideFlag
        TriggeredBy        = Upgrade_DwarvenBarracksLevel3
        ShowSubObjects     = V1 V2
    End

    Behavior = CommandSetUpgrade ModuleTag_DwarvenBarracksLevel2
        TriggeredBy        = Upgrade_DwarvenBarracksLevel2
        ConflictsWith      = Upgrade_DwarvenBarracksLevel3
        CommandSet         = DwarvenBarracksCommandSetLevel2
    End

    Behavior = CommandSetUpgrade ModuleTag_DwarvenBarracksLevel3
        TriggeredBy        = Upgrade_DwarvenBarracksLevel3
        CommandSet         = DwarvenBarracksCommandSetLevel3
    End

    Behavior = LevelUpUpgrade ModuleTag_LevelUpDwarvenHallOfWarriorsLevel2
        TriggeredBy        = Upgrade_DwarvenBarracksLevel2
        LevelsToGain       = 1
        LevelCap           = 3
    End

    Behavior = LevelUpUpgrade ModuleTag_LevelUpDwarvenHallOfWarriorsLevel3
        TriggeredBy        = Upgrade_DwarvenBarracksLevel3
        LevelsToGain       = 1
        LevelCap           = 3
    End

    Behavior = GeometryUpgrade Geom_ModuleTag_HideAll
        TriggeredBy        = Upgrade_StructureLevel1
        ShowGeometry        = Geom_Orig
        HideGeometry        = Geom_V2
    End


    Behavior = GeometryUpgrade Geom_ModuleTag_ShowWalls
        TriggeredBy        = Upgrade_DwarvenBarracksLevel2
        ShowGeometry        = Geom_Orig
        HideGeometry        = Geom_V2
    End

    Behavior = GeometryUpgrade Geom_ModuleTag_ShowFlagsAndTower
        TriggeredBy        = Upgrade_DwarvenBarracksLevel3
        ShowGeometry        = Geom_V2 Geom_Orig
    End

    Behavior                      = BuildingBehavior BuildingModuleTag
        NightWindowName         = N_Window N_Glow
    End





    Behavior = SubObjectsUpgrade ModuleTag_HideGlow
        TriggeredBy             = Upgrade_AllFactionUpgrade
        HideSubObjects          = GLOW01 GLOW02 GLOW03 GLOW04 GLOW05
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowRune1
        TriggeredBy             = Upgrade_Level_1
        ShowSubObjects          = GLOW01
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowRune2
        TriggeredBy             = Upgrade_Level_2
        ShowSubObjects          = GLOW02
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowRune3
        TriggeredBy             = Upgrade_Level_3
        ShowSubObjects          = GLOW03
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowRune4
        TriggeredBy             = Upgrade_Level_4
        ShowSubObjects          = GLOW04
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowRune5
        TriggeredBy             = Upgrade_Level_5
        ShowSubObjects          = GLOW05
    End

    Behavior = PassiveAreaEffectBehavior ModuleTag_MysticFountainsHealing
        UpgradeRequired         = Upgrade_Level_3
        EffectRadius            = 180
        PingDelay               = 2000
        HealPercentPerSecond    = 2%
        AllowFilter             = ANY +INFANTRY +CAVALRY +HERO -MACHINE +MONSTER -IMMOBILE +DOZER
        NonStackable            = Yes
        HealFX                  = FX_SpellHealUnitHealBuff
    End

    Behavior = PassiveAreaEffectBehavior ModuleTag_FeelGoodHero
        UpgradeRequired         = Upgrade_Level_2
        EffectRadius            = 180
        PingDelay               = 2000
        ModifierName            = RuneInspirationLeadership
        AllowFilter             = GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
    End

    Behavior = ObjectCreationUpgrade CreateTheEffecktSchrecken
        TriggeredBy             = Upgrade_Level_5
        Delay                   = 0.0
        ThingToSpawn            = DwarvenRuneSchrecken
        FadeInTime              = 200
    End


    Behavior = AttributeModifierUpgrade ModuleTag_Unantastbrakeit
        TriggeredBy             = Upgrade_Level_1
        AttributeModifier       = DwarvenRuneUnantastbarkeit
    End

    Behavior = AttributeModifierUpgrade ModuleTag_Produktivitat
        TriggeredBy             = Upgrade_Level_4
        AttributeModifier       = DwarvenRuneProduktivitat
    End





    Behavior = ObjectCreationUpgrade ModuleTag_IamAI1
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 380000
        GrantUpgrade = Upgrade_DwarvenBarracksLevel2
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI2
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 650000
        GrantUpgrade = Upgrade_DwarvenBarracksLevel3
    End



  Geometry        = BOX
  GeometryName        = Geom_Orig
  GeometryMajorRadius   = 32.0
  GeometryMinorRadius   = 32.0
  GeometryHeight        = 22.5
  GeometryOffset    = X:4 Y:-4 Z:0

  AdditionalGeometry    = BOX
  GeometryName        = Geom_Orig
  GeometryMajorRadius   = 22.5
  GeometryMinorRadius   = 45.0
  GeometryHeight        = 30.0
  GeometryOffset    = X:-10 Y:-15 Z:0

  AdditionalGeometry    = BOX
  GeometryName        = Geom_Orig
  GeometryMajorRadius   = 45.0
  GeometryMinorRadius   = 22.5
  GeometryHeight        = 30.0
  GeometryOffset    = X:15 Y:10 Z:0

  AdditionalGeometry    = BOX
  GeometryName        = Geom_V2
  GeometryMajorRadius   = 9.0
  GeometryMinorRadius   = 9.0
  GeometryHeight        = 70.0
  GeometryOffset    = X:-26 Y:-6 Z:0


  GeometryIsSmall       = No

  Shadow                = SHADOW_VOLUME
  BuildCompletion    = PLACED_BY_PLAYER

    AttackContactPoint     = X:-24     Y:-24         Z:92
    GeometryContactPoint     = X:-80.1    Y:-18.9        Z:0    Repair
    GeometryContactPoint     = X:-9.861    Y:51.413    Z:0
    GeometryContactPoint     = X:-33.314    Y:-54.902    Z:0
    GeometryContactPoint     = X:-20.106    Y:-25.298    Z:89.3    Swoop
    GeometryContactPoint     = X:10         Y: 10         Z:0     Bomb

End

Object DwarfBarracks_Langbarte

    SelectPortrait = BREreborBarracks

  Draw = W3DScriptedModelDraw ModuleTag_Draw

    OkToChangeModelColor  = Yes
    UseStandardModelNames = Yes
    StaticModelLODMode    = Yes

    ExtraPublicBone = ARROW01
    ExtraPublicBone = ARROW02
    ExtraPublicBone = ARROW03
    ExtraPublicBone = ARROW04
    ExtraPublicBone = FXBONE01
    ExtraPublicBone = FXBONE02
    ExtraPublicBone = FXBONE05
    ExtraPublicBone = FXBONE04

    RandomTexture = dbereborbarracks.tga  0 dberbarracks.tga

    DefaultModelConditionState
        Model = DBErebor
        WeaponLaunchBone = PRIMARY ARROW
    End

    ModelConditionState = WORLD_BUILDER
            Model = DBErebor
    End

    AnimationState = BUILD_PLACEMENT_CURSOR
        BeginScript
            CurDrawableHideSubObject("DWARF")
            CurDrawableHideSubObject("Object03")
            CurDrawableHideSubObject("OBJECT02")
        EndScript
    End


    AnimationState = PHANTOM_STRUCTURE
        BeginScript
            CurDrawableHideSubObject("DWARF")
            CurDrawableHideSubObject("Object03")
            CurDrawableHideSubObject("OBJECT02")
        EndScript
    End


        IdleAnimationState
            StateName                = STATE_Idle
            Animation                 = DBErebor
                AnimationName            = DBErebor.DBErebor
                    AnimationMode        = ONCE
                End
                Flags                = RESTART_ANIM_WHEN_COMPLETE
        End


    ModelConditionState  = SNOW JUST_BUILT
        Model = DBErebor_a
            Texture = dberbarracks.tga dbereborbarracks_Snow.tga
            Texture = dbereborbarracks.tga dbereborbarracks_Snow.tga
            Texture = DBStoneA.tga DBStoneA_Snow.tga
            Texture = DBFortress1.tga DBFortress1_Snow.tga
    End

    ModelConditionState  = JUST_BUILT
        Model = DBErebor_a
    End

    AnimationState            = JUST_BUILT
            Animation           = DBErebor_a
                AnimationName     = DBErebor_a.DBErebor_a
                AnimationMode     = MANUAL
                AnimationBlendTime = 0
        End
    End




        ModelConditionState = SNOW AWAITING_CONSTRUCTION UPGRADE_NUMENOR_STONEWORK
            Model    = DBErebor_a
            Texture = dberbarracks_Snow.tga dbereborbarracks.tga
            Texture = dbereborbarracks_Snow.tga dbereborbarracks.tga
            Texture = DBStoneA_Snow.tga DBStoneA.tga
            Texture = DBFortress1_Snow.tga DBFortress1.tga
        End


        ModelConditionState = SNOW AWAITING_CONSTRUCTION
            Model    = DBErebor_a
            Texture = dberbarracks.tga dbereborbarracks_Snow.tga
            Texture = dbereborbarracks.tga dbereborbarracks_Snow.tga
            Texture = DBStoneA.tga DBStoneA_Snow.tga
            Texture = DBFortress1.tga DBFortress1_Snow.tga
        End

        ModelConditionState   = AWAITING_CONSTRUCTION
            Model               = DBErebor_a

        End
        AnimationState        = AWAITING_CONSTRUCTION
            Animation           =  DBErebor_a
                AnimationName     =  DBErebor_a.DBErebor_a
                AnimationMode     = MANUAL
                AnimationBlendTime = 0
            End
            Flags                  = START_FRAME_FIRST
        End


        ModelConditionState = SNOW ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED UPGRADE_NUMENOR_STONEWORK
            Model    = DBErebor_a
            Texture = dberbarracks_Snow.tga dbereborbarracks.tga
            Texture = dbereborbarracks_Snow.tga dbereborbarracks.tga
            Texture = DBStoneA_Snow.tga DBStoneA.tga
            Texture = DBFortress1_Snow.tga DBFortress1.tga
        End

        ModelConditionState = SNOW ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Model    = DBErebor_a
            Texture = dberbarracks.tga dbereborbarracks_Snow.tga
            Texture = dbereborbarracks.tga dbereborbarracks_Snow.tga
            Texture = DBStoneA.tga DBStoneA_Snow.tga
            Texture = DBFortress1.tga DBFortress1_Snow.tga
        End


        ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Model               = DBErebor_a
        End

        AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Animation           = DBErebor_a
                AnimationName     = DBErebor_a.DBErebor_a
                AnimationMode     = MANUAL
                AnimationBlendTime = 0
            End
            Flags                  = START_FRAME_FIRST
            StateName              = BeingConstructed
            BeginScript
                CurDrawablePlaySound("GondorBarracksBeginConstruction")
            EndScript
            ParticleSysBone   = CONSTDUSTBONE01 BuildingContructDust FollowBone:Yes
        End




    ModelConditionState  = DAMAGED
      Model         = DBErebor
        Texture = DBStoneA.tga DBStoneA_d1.tga
        Texture = dberbarracks.tga dbereborbarracks_d.tga
        Texture = dbereborbarracks.tga dbereborbarracks_d.tga
        ParticleSysBone FireSmall01 FireBuildingLarge
        ParticleSysBone FireSmall02 FireBuildingMedium
        ParticleSysBone FireSmall03 FireBuildingMedium
        ParticleSysBone FireSmall04 FireBuildingSmall
        ParticleSysBone FireSmall05 SmokeBuildingLarge
    End
    AnimationState = DAMAGED
        EnteringStateFX    = FX_BuildingDamaged
    End

    ModelConditionState  = REALLYDAMAGED
      Model         = DBErebor
        Texture = DBStoneA.tga DBStoneA_d1.tga
        Texture = dberbarracks.tga dbereborbarracks_d.tga
        Texture = dbereborbarracks.tga dbereborbarracks_d.tga
        ParticleSysBone FireSmall01 FireBuildingLarge
        ParticleSysBone FireSmall02 FireBuildingLarge
        ParticleSysBone FireSmall03 FireBuildingMedium
        ParticleSysBone FireSmall04 SmokeBuildingLarge
        ParticleSysBone FireSmall05 SmokeBuildingLarge
    End
    AnimationState = REALLYDAMAGED
          Animation                =    RubbleAnimation
            AnimationName        =    DBErebor.DBErebor
            AnimationMode        =    ONCE
          End
        EnteringStateFX    = FX_BuildingReallyDamaged
    End

    ModelConditionState  = RUBBLE
      Model         = DBErebor
      Texture = DBStoneA.tga DBStoneA_d1.tga
      Texture = dberbarracks.tga dbereborbarracks_d.tga
      Texture = dbereborbarracks.tga dbereborbarracks_d.tga
      ParticleSysBone SmokeLarge01 SmokeBuildingLarge
    End

    AnimationState = RUBBLE
          Animation                =    RubbleAnimation
            AnimationName        =    DBErebor.DBErebor
            AnimationMode        =    ONCE
          End
      EnteringStateFX    = FX_StructureMediumCollapse
    End

    ModelConditionState  = POST_RUBBLE
      Model         = None
        ParticleSysBone NONE SmokeBuildingMediumRubble
    End

    ModelConditionState  = POST_COLLAPSE
      Model         = None
        ParticleSysBone NONE SmokeBuildingMediumRubble
    End

    ModelConditionState = SNOW UPGRADE_NUMENOR_STONEWORK
        Model   = DBErebor
            Texture = dberbarracks_Snow.tga dbereborbarracks.tga
            Texture = dbereborbarracks_Snow.tga dbereborbarracks.tga
            Texture = DBStoneA_Snow.tga DBStoneA.tga
            Texture = DBFortress1_Snow.tga DBFortress1.tga
    End

    ModelConditionState = SNOW
        Model   = DBErebor
        Texture = dberbarracks.tga dbereborbarracks_Snow.tga
        Texture = dbereborbarracks.tga dbereborbarracks_Snow.tga
        Texture = DBStoneA.tga DBStoneA_Snow.tga
        Texture = DBFortress1.tga DBFortress1_Snow.tga
    End


End

    Draw = W3DScriptedModelDraw ModuleTag_DrawRune
        DefaultModelConditionState
            Model        = exerebrune
        End

    AnimationState = BUILD_PLACEMENT_CURSOR
        BeginScript
            CurDrawableHideSubObject("GLOW01")
            CurDrawableHideSubObject("GLOW02")
            CurDrawableHideSubObject("GLOW03")
            CurDrawableHideSubObject("GLOW04")
            CurDrawableHideSubObject("GLOW05")
        EndScript
    End
    AnimationState = PHANTOM_STRUCTURE
        BeginScript
            CurDrawableHideSubObject("GLOW01")
            CurDrawableHideSubObject("GLOW02")
            CurDrawableHideSubObject("GLOW03")
            CurDrawableHideSubObject("GLOW04")
            CurDrawableHideSubObject("GLOW05")
        EndScript
    End
    End

  Draw = W3DFloorDraw ModuleTag_DrawFloor
        StaticModelLODMode = Yes
     ModelName = DBErebor_Bib

          HideIfModelConditions    =    AWAITING_CONSTRUCTION
          HideIfModelConditions    =    PARTIALLY_CONSTRUCTED
  End

  PlacementViewAngle      = 45

  DisplayName             = OBJECT:DwarvenBarracksLangbarte
  Description             = OBJECT:DwarvenBarracksLangbarteDescription
  Side                    = Dwarves
  EditorSorting           = STRUCTURE
  ThreatLevel             = FACTORY_THREAT_LEVEL
  MaxSimultaneousOfType   = 4
  RefundValue             = 200
  BuildCost               = 350
  BuildTime               = 40
  BountyValue             = 80
  VisionRange             = 160
  ShroudClearingRange     = 180
  CommandSet              = DwarvenBarracksLangbarteCommandSet


  ArmorSet
    Conditions            = None
    Armor                 = FactoryArmor
  End

    WeaponSet
        Conditions        = None
    End

    WeaponSet
        Conditions        = PLAYER_UPGRADE
        Weapon            = PRIMARY StructureAxeWeapon
        AutoChooseSources = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End


    #include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

    VoiceSelect                  = DwarfBarracksSelect

    SoundOnDamaged               = BuildingLightDamageStone
    SoundOnReallyDamaged         = BuildingHeavyDamageStone

    VoiceSelectUnderConstruction = BuildingGoodVoiceSelectUnderConstruction
    VoiceFullyCreated            = EVA:HallOfWarriorsComplete

    UnitSpecificSounds
        UnderConstruction        = BuildingConstructionLoop
        UnderRepairFromRubble    = BuildingConstructionLoop
    End

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound     = Sound:StatueHeroicBuildStoneDebris2 Animation:EBBarracks_ASKL.EBBarracks_ABLD Frames:247
        AnimationSound     = Sound:StatueHeroicBuildStoneDebris1 Animation:EBBarracks_ASKL.EBBarracks_ABLD Frames:257
    End


  RadarPriority       = STRUCTURE
  KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE FS_FACTORY AUTO_RALLYPOINT MP_COUNT_FOR_VICTORY NEED_BASE_FOUNDATION ATTACK_NEEDS_LINE_OF_SIGHT CAN_ATTACK MADE_OF_STONE LIVING_WORLD_BUILDING_MIRROR

  Behavior            = GettingBuiltBehavior ModuleTag_04
    WorkerName        = DwarvenWorkerNoSelect
    SpawnTimer        = DEFAULT_STRUCTURE_HEALDELAY
  End

    Behavior = TerrainResourceBehavior ModuleTag_NewMoneyDeadSpot
        Radius            = 100
        MaxIncome         = 0
        IncomeInterval    = 999999
        HighPriority      = Yes
        Visible           = No
    End

    Behavior = AIUpdateInterface ModuleTag_SoWeCanUseWeapon
        AutoAcquireEnemiesWhenIdle = Yes
        MoodAttackCheckRate        = 250
        AILuaEventsList            = AngmarStructuresFunctions
    End

    Behavior = PassiveAreaEffectBehavior ModuleTag_FeelGoodHero2
        EffectRadius            = 350
        PingDelay               = 2000
        UpgradeRequired         = Upgrade_TestBuilding_2
        ModifierName            = DainHallenUnitModifier
        AllowFilter             = GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
    End

  Body                        = ActiveBody ModuleTag_05
    MaxHealth                 = 3500
    MaxHealthDamaged          = DWARVEN_BARRACKS_HEALTH_DAMAGED
    MaxHealthReallyDamaged    = DWARVEN_BARRACKS_HEALTH_REALLY_DAMAGED
    DamageCreationList        = OCL_BuildingDamageList01 CATAPULT_ROCK

    DamageCreationList = OCL_GBBarracksN2D2_Chunk1 CATAPULT_ROCK FRONT_DESTROYED
    DamageCreationList = OCL_GBBarracksN2D2_Chunk2 CATAPULT_ROCK RIGHT_DESTROYED
    DamageCreationList = OCL_GBBarracksN2D2_Chunk3 CATAPULT_ROCK BACK_DESTROYED
    DamageCreationList = OCL_GBBarracksN2D2_Chunk4 CATAPULT_ROCK LEFT_DESTROYED

  End

    Behavior = RefundDie ModuleTag_refund
        UpgradeRequired     = Upgrade_MarketplaceUpgradeDefiance
        BuildingRequired     = ANY +GondorMarketPlace
        RefundPercent         = 50%
    End

  Behavior = ProductionUpdate ModuleTag_06
    GiveNoXP = Yes
  End

  Behavior = QueueProductionExitUpdate ModuleTag_07
    UnitCreatePoint           = X:-11.0 Y:-13.0 Z:0.0
    NaturalRallyPoint         = X:-11.0 Y:-90.0 Z:0.0
    ExitDelay                 = STANDARD_HORDE_EXIT_DELAY
    UseReturnToFormation      = No
    PlacementViewAngle        = 45
  End

  Behavior                  = StructureCollapseUpdate ModuleTag_08
    MinCollapseDelay        = 000
    MaxCollapseDelay        = 000
    CollapseDamping         = .5
    MaxShudder              = 0.6
    MinBurstDelay           = 250
    MaxBurstDelay           = 800
    BigBurstFrequency       = 4
    FXList                  = INITIAL   FX_StructureMediumCollapse
    FXList                  = ALMOST_FINAL  FX_StructureAlmostCollapse
    DestroyObjectWhenDone    = Yes
    CollapseHeight        = 155
  End


    Behavior = SubObjectsUpgrade ModuleTag_HideAll
        TriggeredBy        = Upgrade_StructureLevel1
        HideSubObjects     = Object03 DWARF V1 V2 Object02
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowWallsAndFlag
        TriggeredBy        = Upgrade_DwarvenBarracksLevel2
        ShowSubObjects     = V1 DWARF
        HideSubObjects     = V2
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowTowersAndHideFlag
        TriggeredBy        = Upgrade_DwarvenBarracksLevel3
        ShowSubObjects     = V1 V2 DWARF Object03 Object02
    End

    Behavior = CommandSetUpgrade ModuleTag_DwarvenBarracksLevel2
        TriggeredBy        = Upgrade_DwarvenBarracksLevel2
        ConflictsWith      = Upgrade_DwarvenBarracksLevel3
        CommandSet         = DwarvenBarracksLangbarteCommandSetLevel2
    End

    Behavior = CommandSetUpgrade ModuleTag_DwarvenBarracksLevel3
        TriggeredBy        = Upgrade_DwarvenBarracksLevel3
        CommandSet         = DwarvenBarracksLangbarteCommandSetLevel3
    End

    Behavior = LevelUpUpgrade ModuleTag_LevelUpDwarvenHallOfWarriorsLevel2
        TriggeredBy        = Upgrade_DwarvenBarracksLevel2
        LevelsToGain       = 1
        LevelCap           = 3
    End

    Behavior = LevelUpUpgrade ModuleTag_LevelUpDwarvenHallOfWarriorsLevel3
        TriggeredBy        = Upgrade_DwarvenBarracksLevel3
        LevelsToGain       = 1
        LevelCap           = 3
    End

    Behavior                      = BuildingBehavior BuildingModuleTag
        NightWindowName         = N_Window N_Glow
    End


    Behavior = SubObjectsUpgrade ModuleTag_HideGlow
        TriggeredBy             = Upgrade_AllFactionUpgrade
        HideSubObjects          = GLOW01 GLOW02 GLOW03 GLOW04 GLOW05
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowRune1
        TriggeredBy             = Upgrade_Level_1
        ShowSubObjects          = GLOW01
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowRune2
        TriggeredBy             = Upgrade_Level_2
        ShowSubObjects          = GLOW02
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowRune3
        TriggeredBy             = Upgrade_Level_3
        ShowSubObjects          = GLOW03
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowRune4
        TriggeredBy             = Upgrade_Level_4
        ShowSubObjects          = GLOW04
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowRune5
        TriggeredBy             = Upgrade_Level_5
        ShowSubObjects          = GLOW05
    End

    Behavior = PassiveAreaEffectBehavior ModuleTag_MysticFountainsHealing
        UpgradeRequired         = Upgrade_Level_3
        EffectRadius            = 180
        PingDelay               = 2000
        HealPercentPerSecond    = 2%
        AllowFilter             = ANY +INFANTRY +CAVALRY +HERO -MACHINE +MONSTER -IMMOBILE +DOZER
        NonStackable            = Yes
        HealFX                  = FX_SpellHealUnitHealBuff
    End

    Behavior = PassiveAreaEffectBehavior ModuleTag_FeelGoodHero
        UpgradeRequired         = Upgrade_Level_2
        EffectRadius            = 180
        PingDelay               = 2000
        ModifierName            = RuneInspirationLeadership
        AllowFilter             = GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
    End

    Behavior = ObjectCreationUpgrade CreateTheEffecktSchrecken
        TriggeredBy             = Upgrade_Level_5
        Delay                   = 0.0
        ThingToSpawn            = DwarvenRuneSchrecken
        FadeInTime              = 200
    End


    Behavior = AttributeModifierUpgrade ModuleTag_Unantastbrakeit
        TriggeredBy             = Upgrade_Level_1
        AttributeModifier       = DwarvenRuneUnantastbarkeit
    End

    Behavior = AttributeModifierUpgrade ModuleTag_Produktivitat
        TriggeredBy             = Upgrade_Level_4
        AttributeModifier       = DwarvenRuneProduktivitat
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI1
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 380000
        GrantUpgrade = Upgrade_DwarvenBarracksLevel2
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI2
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 650000
        GrantUpgrade = Upgrade_DwarvenBarracksLevel3
    End

    Behavior = GeometryUpgrade Geom_ModuleTag_HideAll
        TriggeredBy        = Upgrade_StructureLevel1
        ShowGeometry        = Geom_Orig
        HideGeometry        = Geom_V2
    End
    Behavior = GeometryUpgrade Geom_ModuleTag_ShowWalls
        TriggeredBy        = Upgrade_DwarvenBarracksLevel2
        ShowGeometry        = Geom_Orig
        HideGeometry        = Geom_V2
    End
    Behavior = GeometryUpgrade Geom_ModuleTag_ShowFlagsAndTower
        TriggeredBy        = Upgrade_DwarvenBarracksLevel3
        ShowGeometry        = Geom_V2 Geom_Orig
    End

  Scale = 0.92
  Geometry        = BOX
  GeometryName        = Geom_Orig
  GeometryMajorRadius   = 32.0
  GeometryMinorRadius   = 32.0
  GeometryHeight        = 62.5
  GeometryOffset    = X:4 Y:-4 Z:0

  AdditionalGeometry    = BOX
  GeometryName        = Geom_Orig
  GeometryMajorRadius   = 22.5
  GeometryMinorRadius   = 45.0
  GeometryHeight        = 30.0
  GeometryOffset    = X:-10 Y:-15 Z:0

  AdditionalGeometry    = BOX
  GeometryName        = Geom_Orig
  GeometryMajorRadius   = 45.0
  GeometryMinorRadius   = 22.5
  GeometryHeight        = 30.0
  GeometryOffset    = X:15 Y:10 Z:0

  AdditionalGeometry    = BOX
  GeometryName        = Geom_V2
  GeometryMajorRadius   = 9.0
  GeometryMinorRadius   = 9.0
  GeometryHeight        = 70.0
  GeometryOffset    = X:-26 Y:-6 Z:0


  GeometryIsSmall       = No

  Shadow                = SHADOW_VOLUME
  BuildCompletion    = PLACED_BY_PLAYER

    AttackContactPoint     = X:-24     Y:-24         Z:92
    GeometryContactPoint     = X:-80.1    Y:-18.9        Z:0    Repair
    GeometryContactPoint     = X:-9.861    Y:51.413    Z:0
    GeometryContactPoint     = X:-33.314    Y:-54.902    Z:0
    GeometryContactPoint     = X:-20.106    Y:-25.298    Z:89.3    Swoop
    GeometryContactPoint     = X:10         Y: 10         Z:0     Bomb
End

ChildObject DwarfBarracks_Langbarte_Summoned DwarfBarracks_Langbarte

  Behavior = GrantUpgradeCreate ModuleTag_ActLikeAnOldUpgrade
     UpgradeToGrant = Upgrade_DwarvenBarracksLevel2 Upgrade_DwarvenBarracksLevel3
  End

    Behavior = ObjectCreationUpgrade MakeTheGeom
        TriggeredBy      = Upgrade_AllFactionUpgrade
        Delay            = 1000
        GrantUpgrade     = Upgrade_PlantShield
    End

    Behavior = GeometryUpgrade ModueTag_TowerGeom
        TriggeredBy      = Upgrade_PlantShield
        ShowGeometry     = Geom_Orig1 Geom_Orig2 Geom_Orig3 Geom_V2
        HideGeometry     = DummyGeom
    End

    Geometry              = BOX
    GeometryMajorRadius   = 1.0
    GeometryMinorRadius   = 1.0
    GeometryHeight        = 1.0
    GeometryName          = DummyGeom
    GeometryActive         = Yes

  Geometry        = BOX
  GeometryName        = Geom_Orig1
  GeometryMajorRadius   = 32.0
  GeometryMinorRadius   = 32.0
  GeometryHeight        = 22.5
  GeometryOffset    = X:4 Y:-4 Z:0
    GeometryActive         = No

  AdditionalGeometry    = BOX
  GeometryName        = Geom_Orig2
  GeometryMajorRadius   = 22.5
  GeometryMinorRadius   = 45.0
  GeometryHeight        = 30.0
  GeometryOffset    = X:-10 Y:-15 Z:0
    GeometryActive         = No

  AdditionalGeometry    = BOX
  GeometryName        = Geom_Orig3
  GeometryMajorRadius   = 45.0
  GeometryMinorRadius   = 22.5
  GeometryHeight        = 30.0
  GeometryOffset    = X:15 Y:10 Z:0
    GeometryActive         = No

  AdditionalGeometry    = BOX
  GeometryName        = Geom_V2
  GeometryMajorRadius   = 9.0
  GeometryMinorRadius   = 9.0
  GeometryHeight        = 70.0
  GeometryOffset    = X:-26 Y:-6 Z:0
  GeometryActive         = No

  GeometryIsSmall       = No

  Shadow                = SHADOW_VOLUME
  BuildCompletion    = PLACED_BY_PLAYER

    AttackContactPoint     = X:-24     Y:-24         Z:92
    GeometryContactPoint     = X:-80.1    Y:-18.9        Z:0    Repair
    GeometryContactPoint     = X:-9.861    Y:51.413    Z:0
    GeometryContactPoint     = X:-33.314    Y:-54.902    Z:0
    GeometryContactPoint     = X:-20.106    Y:-25.298    Z:89.3    Swoop
    GeometryContactPoint     = X:10         Y: 10         Z:0     Bomb
End


ChildObject BFME1DwarfBarracks_Langbarte DwarfBarracks_Langbarte

    Behavior = CastleMemberBehavior ModuleTag_CMB
    End
End


Object DwarfBarracks_Feuerbarte

    SelectPortrait = BPDHallOfWarriors

  Draw = W3DScriptedModelDraw ModuleTag_Draw

    OkToChangeModelColor  = Yes
    UseStandardModelNames = Yes
    StaticModelLODMode = Yes

    ExtraPublicBone = ARROW01
    ExtraPublicBone = ARROW02
    ExtraPublicBone = ARROW03
    ExtraPublicBone = ARROW04
    ExtraPublicBone = FXBONE01
    ExtraPublicBone = FXBONE02
    ExtraPublicBone = FXBONE05
    ExtraPublicBone = FXBONE04

    RandomTexture = eudwarfgua_r.tga  0 eudwarfgua.tga

    DefaultModelConditionState
        Model = EBBarracks_SKN
        WeaponLaunchBone = PRIMARY ARROW
    End

	ModelConditionState = WORLD_BUILDER
            Model = EBBarracks_SKN
    End


    AnimationState = BUILD_PLACEMENT_CURSOR
        BeginScript
            CurDrawableHideSubObject("N_Window")
            CurDrawableHideSubObject("N_Glow")
               CurDrawableHideSubObject("V1")
            CurDrawableHideSubObject("V2")
        EndScript
    End


    AnimationState = PHANTOM_STRUCTURE
        BeginScript
            CurDrawableHideSubObject("N_Window")
            CurDrawableHideSubObject("N_Glow")
               CurDrawableHideSubObject("V1")
            CurDrawableHideSubObject("V2")

        EndScript
    End

   IdleAnimationState
        Animation = IDLA
            AnimationName        =    EBBarracks_SKL.EBBarracks_IDLA
            AnimationMode            =    ONCE
            AnimationBlendTime = 0
        End
        Animation = IDLB
            AnimationName        =    EBBarracks_SKL.EBBarracks_IDLB
            AnimationMode            =    ONCE
            AnimationBlendTime = 0
        End




    End


    ModelConditionState  = SNOW JUST_BUILT
        Model = EBBarracks_ASKN
            Texture = EBBarracks.tga EBBarracks_Snow.tga
            Texture = DBStoneA.tga DBStoneA_Snow.tga
            Texture = DBFortress1.tga DBFortress1_Snow.tga
    End

    ModelConditionState  = JUST_BUILT
        Model = EBBarracks_ASKN
    End

    AnimationState            = JUST_BUILT
            Animation           = EBBarracks_A
                AnimationName     = EBBarracks_ASKL.EBBarracks_ABLD
                AnimationMode     = MANUAL
                AnimationBlendTime = 0
        End
    End




        ModelConditionState = SNOW AWAITING_CONSTRUCTION UPGRADE_NUMENOR_STONEWORK
            Model    = EBBarracks_ASKN
            Texture = EBBarracks_Snow.tga EBBarracks.tga
            Texture = DBStoneA_Snow.tga DBStoneA.tga
            Texture = DBFortress1_Snow.tga DBFortress1.tga
        End

        ModelConditionState = SNOW AWAITING_CONSTRUCTION
            Model    = EBBarracks_ASKN
            Texture = EBBarracks.tga EBBarracks_Snow.tga
            Texture = DBStoneA.tga DBStoneA_Snow.tga
            Texture = DBFortress1.tga DBFortress1_Snow.tga
        End

        ModelConditionState   = AWAITING_CONSTRUCTION
            Model               = EBBarracks_ASKN

        End
        AnimationState        = AWAITING_CONSTRUCTION
            Animation           =  EBBarracks_A
                AnimationName     =  EBBarracks_ASKL.EBBarracks_ABLD
                AnimationMode     = MANUAL
                AnimationBlendTime = 0
            End
            Flags                  = START_FRAME_FIRST
        End

        ModelConditionState = SNOW ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED UPGRADE_NUMENOR_STONEWORK
            Model    = EBBarracks_ASKN
            Texture = EBBarracks_Snow.tga EBBarracks.tga
            Texture = DBStoneA_Snow.tga DBStoneA.tga
            Texture = DBFortress1_Snow.tga DBFortress1.tga
        End

        ModelConditionState = SNOW ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Model    = EBBarracks_ASKN
            Texture = EBBarracks.tga EBBarracks_Snow.tga
            Texture = DBStoneA.tga DBStoneA_Snow.tga
            Texture = DBFortress1.tga DBFortress1_Snow.tga
        End

        ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Model               = EBBarracks_ASKN
        End

        AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Animation           = EBBarracks_A
                AnimationName     = EBBarracks_ASKL.EBBarracks_ABLD
                AnimationMode     = MANUAL
                AnimationBlendTime = 0
            End
            Flags                  = START_FRAME_FIRST
            StateName              = BeingConstructed
            BeginScript
                CurDrawablePlaySound("GondorBarracksBeginConstruction")
            EndScript
            ParticleSysBone   = CONSTDUSTBONE01 BuildingContructDust FollowBone:Yes
        End





    ModelConditionState  = DAMAGED
      Model         = EBBarracks_D1
        ParticleSysBone FireSmall01 FireBuildingLarge
        ParticleSysBone FireSmall02 FireBuildingMedium
        ParticleSysBone FireSmall03 FireBuildingMedium
        ParticleSysBone FireSmall04 FireBuildingSmall
        ParticleSysBone FireSmall05 SmokeBuildingLarge
    End
    AnimationState = DAMAGED
        EnteringStateFX    = FX_BuildingDamaged
    End

    ModelConditionState  = REALLYDAMAGED
      Model         = EBBarracks_D2
        ParticleSysBone FireSmall01 FireBuildingLarge
        ParticleSysBone FireSmall02 FireBuildingLarge
        ParticleSysBone FireSmall03 FireBuildingMedium
        ParticleSysBone FireSmall04 SmokeBuildingLarge
        ParticleSysBone FireSmall05 SmokeBuildingLarge
    End
    AnimationState = REALLYDAMAGED
          Animation                =    RubbleAnimation
            AnimationName        =    EBBarracks_D2SK.EBBarracks_D2AN
            AnimationMode        =    ONCE
          End
        EnteringStateFX    = FX_BuildingReallyDamaged
    End

    ModelConditionState  = RUBBLE
      Model         = EBBarracks_D3
      ParticleSysBone SmokeLarge01 SmokeBuildingLarge
    End

    AnimationState = RUBBLE
          Animation                =    RubbleAnimation
            AnimationName        =    EBBarracks_D3SK.EBBarracks_D3AN
            AnimationMode        =    ONCE
          End
      EnteringStateFX    = FX_StructureMediumCollapse
    End

    ModelConditionState  = POST_RUBBLE
      Model         = None
        ParticleSysBone NONE SmokeBuildingMediumRubble
    End

    ModelConditionState  = POST_COLLAPSE
      Model         = None
        ParticleSysBone NONE SmokeBuildingMediumRubble
    End

    ModelConditionState = SNOW UPGRADE_NUMENOR_STONEWORK
        Model    = EBBarracks_SKN
        Texture = EBBarracks_Snow.tga EBBarracks.tga
        Texture = DBStoneA_Snow.tga DBStoneA.tga
        Texture = DBMineA_Snow.tga DBMineA.tga
        Texture = DBFortress1_Snow.tga DBFortress1.tga
    End

    ModelConditionState = SNOW
        Model    = EBBarracks_SKN
        Texture = EBBarracks.tga EBBarracks_Snow.tga
        Texture = DBStoneA.tga DBStoneA_Snow.tga
        Texture = DBMineA.tga DBMineA_Snow.tga
        Texture = DBFortress1.tga DBFortress1_Snow.tga
    End


End

    Draw = W3DScriptedModelDraw ModuleTag_DrawRune
        DefaultModelConditionState
            Model        = exrunek
        End

    AnimationState = BUILD_PLACEMENT_CURSOR
        BeginScript
            CurDrawableHideSubObject("GLOW01")
            CurDrawableHideSubObject("GLOW02")
            CurDrawableHideSubObject("GLOW03")
            CurDrawableHideSubObject("GLOW04")
            CurDrawableHideSubObject("GLOW05")
        EndScript
    End
    AnimationState = PHANTOM_STRUCTURE
        BeginScript
            CurDrawableHideSubObject("GLOW01")
            CurDrawableHideSubObject("GLOW02")
            CurDrawableHideSubObject("GLOW03")
            CurDrawableHideSubObject("GLOW04")
            CurDrawableHideSubObject("GLOW05")
        EndScript
    End
    End


  Draw = W3DFloorDraw ModuleTag_DrawFloor
        StaticModelLODMode = Yes
     ModelName = EBBarracks_Bib

          HideIfModelConditions    =    AWAITING_CONSTRUCTION
          HideIfModelConditions    =    PARTIALLY_CONSTRUCTED
  End

  DisplayName             = OBJECT:DwarvenBarracksFeuerbarte
  Description             = OBJECT:DwarvenBarracksFeuerbarteDescription
  Side                    = Dwarves
  EditorSorting           = STRUCTURE
  ThreatLevel             = FACTORY_THREAT_LEVEL
  MaxSimultaneousOfType   = 4
  RefundValue             = 200
  BuildCost               = 350
  BuildTime               = 40
  BountyValue             = 80
  VisionRange             = 160
  ShroudClearingRange     = 180
  CommandSet              = DwarvenBarracksFeuerbarteCommandSet


  ArmorSet
    Conditions            = None
    Armor                 = FactoryArmor
  End

    WeaponSet
        Conditions        = None
    End

    WeaponSet
        Conditions        = PLAYER_UPGRADE
        Weapon            = PRIMARY StructureAxeWeapon
        AutoChooseSources = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End


    #include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

    VoiceSelect                  = DwarfBarracksSelect

    SoundOnDamaged               = BuildingLightDamageStone
    SoundOnReallyDamaged         = BuildingHeavyDamageStone

    VoiceSelectUnderConstruction = BuildingGoodVoiceSelectUnderConstruction
    VoiceFullyCreated            = EVA:HallOfWarriorsComplete

    UnitSpecificSounds
        UnderConstruction        = BuildingConstructionLoop
        UnderRepairFromRubble    = BuildingConstructionLoop
    End

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound     = Sound:StatueHeroicBuildStoneDebris2 Animation:EBBarracks_ASKL.EBBarracks_ABLD Frames:247
        AnimationSound     = Sound:StatueHeroicBuildStoneDebris1 Animation:EBBarracks_ASKL.EBBarracks_ABLD Frames:257
    End


  RadarPriority       = STRUCTURE
  KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE FS_FACTORY AUTO_RALLYPOINT MP_COUNT_FOR_VICTORY NEED_BASE_FOUNDATION ATTACK_NEEDS_LINE_OF_SIGHT CAN_ATTACK MADE_OF_STONE LIVING_WORLD_BUILDING_MIRROR

  Behavior            = GettingBuiltBehavior ModuleTag_04
    WorkerName        = DwarvenWorkerNoSelect
    SpawnTimer        = DEFAULT_STRUCTURE_HEALDELAY
  End

    Behavior = TerrainResourceBehavior ModuleTag_NewMoneyDeadSpot
        Radius            = 100
        MaxIncome         = 0
        IncomeInterval    = 999999
        HighPriority      = Yes
        Visible           = No
    End

    Behavior = AIUpdateInterface ModuleTag_SoWeCanUseWeapon
        AutoAcquireEnemiesWhenIdle = Yes
        MoodAttackCheckRate        = 250
        AILuaEventsList            = AngmarStructuresFunctions
    End

    Behavior = PassiveAreaEffectBehavior ModuleTag_FeelGoodHero2
        EffectRadius            = 350
        PingDelay               = 2000
        UpgradeRequired         = Upgrade_TestBuilding_2
        ModifierName            = DainHallenUnitModifier
        AllowFilter             = GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
    End

  Body                        = ActiveBody ModuleTag_05
    MaxHealth                 = 3500
    MaxHealthDamaged          = DWARVEN_BARRACKS_HEALTH_DAMAGED
    MaxHealthReallyDamaged    = DWARVEN_BARRACKS_HEALTH_REALLY_DAMAGED
    DamageCreationList        = OCL_BuildingDamageList01 CATAPULT_ROCK

    DamageCreationList = OCL_GBBarracksN2D2_Chunk1 CATAPULT_ROCK FRONT_DESTROYED
    DamageCreationList = OCL_GBBarracksN2D2_Chunk2 CATAPULT_ROCK RIGHT_DESTROYED
    DamageCreationList = OCL_GBBarracksN2D2_Chunk3 CATAPULT_ROCK BACK_DESTROYED
    DamageCreationList = OCL_GBBarracksN2D2_Chunk4 CATAPULT_ROCK LEFT_DESTROYED

  End

    Behavior = RefundDie ModuleTag_refund
        UpgradeRequired     = Upgrade_MarketplaceUpgradeDefiance
        BuildingRequired     = ANY +GondorMarketPlace
        RefundPercent         = 50%
    End

  Behavior = ProductionUpdate ModuleTag_06
    GiveNoXP = Yes
  End

  Behavior = QueueProductionExitUpdate ModuleTag_07
    UnitCreatePoint		= X:0.0 Y:0.0 Z:0.0
    NaturalRallyPoint		= X:75.0 Y:-70.0 Z:0.0
    ExitDelay			= STANDARD_HORDE_EXIT_DELAY
    UseReturnToFormation	= No
    PlacementViewAngle		= -45
  End

  Behavior                  = StructureCollapseUpdate ModuleTag_08
    MinCollapseDelay        = 000
    MaxCollapseDelay        = 000
    CollapseDamping         = .5
    MaxShudder              = 0.6
    MinBurstDelay           = 250
    MaxBurstDelay           = 800
    BigBurstFrequency       = 4
    FXList                  = INITIAL   FX_StructureMediumCollapse
    FXList                  = ALMOST_FINAL  FX_StructureAlmostCollapse
    DestroyObjectWhenDone    = Yes
    CollapseHeight        = 155
  End

    Behavior = SubObjectsUpgrade ModuleTag_HideAll
        TriggeredBy        = Upgrade_StructureLevel1
        HideSubObjects     = V1 V2
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowWallsAndFlag
        TriggeredBy        = Upgrade_DwarvenBarracksLevel2
        ShowSubObjects     = V1
        HideSubObjects     = V2
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowTowersAndHideFlag
        TriggeredBy        = Upgrade_DwarvenBarracksLevel3
        ShowSubObjects     = V1 V2
    End

    Behavior = CommandSetUpgrade ModuleTag_DwarvenBarracksLevel2
        TriggeredBy        = Upgrade_DwarvenBarracksLevel2
        ConflictsWith        = Upgrade_DwarvenBarracksLevel3
        CommandSet        = DwarvenBarracksFeuerbarteCommandSetLevel2
    End

    Behavior = CommandSetUpgrade ModuleTag_DwarvenBarracksLevel3
        TriggeredBy        = Upgrade_DwarvenBarracksLevel3
        CommandSet        = DwarvenBarracksFeuerbarteCommandSetLevel3
    End

    Behavior = LevelUpUpgrade ModuleTag_LevelUpDwarvenHallOfWarriorsLevel2
        TriggeredBy        = Upgrade_DwarvenBarracksLevel2
        LevelsToGain       = 1
        LevelCap           = 3
    End

    Behavior = LevelUpUpgrade ModuleTag_LevelUpDwarvenHallOfWarriorsLevel3
        TriggeredBy        = Upgrade_DwarvenBarracksLevel3
        LevelsToGain       = 1
        LevelCap           = 3
    End

    Behavior                      = BuildingBehavior BuildingModuleTag
        NightWindowName    = N_Window N_Glow
    End


    Behavior = SubObjectsUpgrade ModuleTag_HideGlow
        TriggeredBy             = Upgrade_AllFactionUpgrade
        HideSubObjects          = GLOW01 GLOW02 GLOW03 GLOW04 GLOW05
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowRune1
        TriggeredBy             = Upgrade_Level_1
        ShowSubObjects          = GLOW01
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowRune2
        TriggeredBy             = Upgrade_Level_2
        ShowSubObjects          = GLOW02
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowRune3
        TriggeredBy             = Upgrade_Level_3
        ShowSubObjects          = GLOW03
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowRune4
        TriggeredBy             = Upgrade_Level_4
        ShowSubObjects          = GLOW04
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowRune5
        TriggeredBy             = Upgrade_Level_5
        ShowSubObjects          = GLOW05
    End

    Behavior = PassiveAreaEffectBehavior ModuleTag_MysticFountainsHealing
        UpgradeRequired         = Upgrade_Level_3
        EffectRadius            = 180
        PingDelay               = 2000
        HealPercentPerSecond    = 2%
        AllowFilter             = ANY +INFANTRY +CAVALRY +HERO -MACHINE +MONSTER -IMMOBILE +DOZER
        NonStackable            = Yes
        HealFX                  = FX_SpellHealUnitHealBuff
    End

    Behavior = PassiveAreaEffectBehavior ModuleTag_FeelGoodHero
        UpgradeRequired         = Upgrade_Level_2
        EffectRadius            = 180
        PingDelay               = 2000
        ModifierName            = RuneInspirationLeadership
        AllowFilter             = GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
    End

    Behavior = ObjectCreationUpgrade CreateTheEffecktSchrecken
        TriggeredBy             = Upgrade_Level_5
        Delay                   = 0.0
        ThingToSpawn            = DwarvenRuneSchrecken
        FadeInTime              = 200
    End

    Behavior = AttributeModifierUpgrade ModuleTag_Unantastbrakeit
        TriggeredBy             = Upgrade_Level_1
        AttributeModifier       = DwarvenRuneUnantastbarkeit
    End

    Behavior = AttributeModifierUpgrade ModuleTag_Produktivitat
        TriggeredBy             = Upgrade_Level_4
        AttributeModifier       = DwarvenRuneProduktivitat
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI1
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 380000
        GrantUpgrade = Upgrade_DwarvenBarracksLevel2
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI2
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 650000
        GrantUpgrade = Upgrade_DwarvenBarracksLevel3
    End

    Behavior = GeometryUpgrade Geom_ModuleTag_HideAll
        TriggeredBy        = Upgrade_StructureLevel1
        ShowGeometry        = Geom_Orig
        HideGeometry        = Geom_V2
    End
    Behavior = GeometryUpgrade Geom_ModuleTag_ShowWalls
        TriggeredBy        = Upgrade_DwarvenBarracksLevel2
        ShowGeometry        = Geom_Orig
        HideGeometry        = Geom_V2
    End
    Behavior = GeometryUpgrade Geom_ModuleTag_ShowFlagsAndTower
        TriggeredBy        = Upgrade_DwarvenBarracksLevel3
        ShowGeometry        = Geom_V2 Geom_Orig
    End

  Geometry        = BOX
  GeometryName        = Geom_Orig
  GeometryMajorRadius   = 32.0
  GeometryMinorRadius   = 32.0
  GeometryHeight        = 62.5
  GeometryOffset    = X:4 Y:-4 Z:0

  AdditionalGeometry    = BOX
  GeometryName        = Geom_Orig
  GeometryMajorRadius   = 22.5
  GeometryMinorRadius   = 45.0
  GeometryHeight        = 30.0
  GeometryOffset    = X:-10 Y:-15 Z:0

  AdditionalGeometry    = BOX
  GeometryName        = Geom_Orig
  GeometryMajorRadius   = 45.0
  GeometryMinorRadius   = 22.5
  GeometryHeight        = 30.0
  GeometryOffset    = X:15 Y:10 Z:0

  AdditionalGeometry    = BOX
  GeometryName        = Geom_V2
  GeometryMajorRadius   = 9.0
  GeometryMinorRadius   = 9.0
  GeometryHeight        = 70.0
  GeometryOffset    = X:-26 Y:-6 Z:0


  GeometryIsSmall       = No

  Shadow                = SHADOW_VOLUME
  BuildCompletion       = PLACED_BY_PLAYER

    AttackContactPoint     = X:-24     Y:-24         Z:92
    GeometryContactPoint     = X:-80.1    Y:-18.9        Z:0    Repair
    GeometryContactPoint     = X:-9.861    Y:51.413    Z:0
    GeometryContactPoint     = X:-33.314    Y:-54.902    Z:0
    GeometryContactPoint     = X:-20.106    Y:-25.298    Z:89.3    Swoop
    GeometryContactPoint     = X:10         Y: 10         Z:0     Bomb
End

ChildObject DwarfBarracks_Feuerbarte_Summoned DwarfBarracks_Feuerbarte

  Behavior = GrantUpgradeCreate ModuleTag_ActLikeAnOldUpgrade
     UpgradeToGrant = Upgrade_DwarvenBarracksLevel2 Upgrade_DwarvenBarracksLevel3
  End

    Behavior = ObjectCreationUpgrade MakeTheGeom
        TriggeredBy      = Upgrade_AllFactionUpgrade
        Delay            = 1000
        GrantUpgrade     = Upgrade_PlantShield
    End

    Behavior = GeometryUpgrade ModueTag_TowerGeom
        TriggeredBy      = Upgrade_PlantShield
        ShowGeometry     = Geom_Orig1 Geom_Orig2 Geom_Orig3 Geom_V2
        HideGeometry     = DummyGeom
    End

    Geometry              = BOX
    GeometryMajorRadius   = 1.0
    GeometryMinorRadius   = 1.0
    GeometryHeight        = 1.0
    GeometryName          = DummyGeom
    GeometryActive         = Yes

  Geometry        = BOX
  GeometryName        = Geom_Orig1
  GeometryMajorRadius   = 32.0
  GeometryMinorRadius   = 32.0
  GeometryHeight        = 22.5
  GeometryOffset    = X:4 Y:-4 Z:0
    GeometryActive         = No

  AdditionalGeometry    = BOX
  GeometryName        = Geom_Orig2
  GeometryMajorRadius   = 22.5
  GeometryMinorRadius   = 45.0
  GeometryHeight        = 30.0
  GeometryOffset    = X:-10 Y:-15 Z:0
    GeometryActive         = No

  AdditionalGeometry    = BOX
  GeometryName        = Geom_Orig3
  GeometryMajorRadius   = 45.0
  GeometryMinorRadius   = 22.5
  GeometryHeight        = 30.0
  GeometryOffset    = X:15 Y:10 Z:0
    GeometryActive         = No

  AdditionalGeometry    = BOX
  GeometryName        = Geom_V2
  GeometryMajorRadius   = 9.0
  GeometryMinorRadius   = 9.0
  GeometryHeight        = 70.0
  GeometryOffset    = X:-26 Y:-6 Z:0
    GeometryActive         = No


  GeometryIsSmall       = No

  Shadow                = SHADOW_VOLUME
  BuildCompletion    = PLACED_BY_PLAYER

    AttackContactPoint     = X:-24     Y:-24         Z:92
    GeometryContactPoint     = X:-80.1    Y:-18.9        Z:0    Repair
    GeometryContactPoint     = X:-9.861    Y:51.413    Z:0
    GeometryContactPoint     = X:-33.314    Y:-54.902    Z:0
    GeometryContactPoint     = X:-20.106    Y:-25.298    Z:89.3    Swoop
    GeometryContactPoint     = X:10         Y: 10         Z:0     Bomb
End


ChildObject BFME1DwarfBarracks_Feuerbarte DwarfBarracks_Feuerbarte
    Behavior = CastleMemberBehavior ModuleTag_CMB
    End
End

Object DwarfBarracks_Breitschultern

  SelectPortrait = BREredluinBar

  Draw = W3DScriptedModelDraw ModuleTag_Draw

    OkToChangeModelColor  = Yes
    UseStandardModelNames = Yes
    StaticModelLODMode = Yes

    ExtraPublicBone = ARROW01
    ExtraPublicBone = ARROW02
    ExtraPublicBone = ARROW03
    ExtraPublicBone = ARROW04
    ExtraPublicBone = FXBONE01
    ExtraPublicBone = FXBONE02
    ExtraPublicBone = FXBONE05
    ExtraPublicBone = FXBONE04


    DefaultModelConditionState
        Model = dberedluinmine
        WeaponLaunchBone = PRIMARY ARROW
    End

	ModelConditionState = WORLD_BUILDER
            Model = dberedluinmine
    End

    AnimationState = BUILD_PLACEMENT_CURSOR
      BeginScript
        CurDrawableHideSubObject("LVL2")
        CurDrawableHideSubObject("LVL3")
      EndScript
    End


    AnimationState = PHANTOM_STRUCTURE
      BeginScript
        CurDrawableHideSubObject("LVL2")
        CurDrawableHideSubObject("LVL3")
      EndScript
    End

   IdleAnimationState
        Animation = dberedluinmine
            AnimationName        =    dberedluinmine.dberedluinmine
            AnimationMode            =    LOOP
            AnimationBlendTime = 0
        End
    End


    ModelConditionState  = SNOW JUST_BUILT
        Model = dberedluin_b
            Texture = dbeisenberg_stone.tga dbeisenberg_stone_snow.tga
            Texture = dbeisenberg.tga dbeisenberg_snow.tga
    End

    ModelConditionState  = JUST_BUILT
        Model = dberedluin_b
    End

    AnimationState            = JUST_BUILT
            Animation           = dberedluin_b
                AnimationName     = dberedluin_b.dberedluin_b
                AnimationMode     = MANUAL
                AnimationBlendTime = 0
        End
    End




        ModelConditionState = SNOW AWAITING_CONSTRUCTION UPGRADE_NUMENOR_STONEWORK
            Model    = dberedluin_b
            Texture = dbeisenberg_stone.tga dbeisenberg_stone_snow.tga
            Texture = dbeisenberg.tga dbeisenberg_snow.tga
        End

        ModelConditionState = SNOW AWAITING_CONSTRUCTION
            Model    = dberedluin_b
            Texture = dbeisenberg_stone.tga dbeisenberg_stone_snow.tga
            Texture = dbeisenberg.tga dbeisenberg_snow.tga
        End

        ModelConditionState   = AWAITING_CONSTRUCTION
            Model               = dberedluin_b

        End
        AnimationState        = AWAITING_CONSTRUCTION
            Animation           =  dberedluin_b
                AnimationName     =  dberedluin_b.dberedluin_b
                AnimationMode     = MANUAL
                AnimationBlendTime = 0
            End
            Flags                  = START_FRAME_FIRST
        End

        ModelConditionState = SNOW ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED UPGRADE_NUMENOR_STONEWORK
            Model    = dberedluin_b
            Texture = dbeisenberg_stone.tga dbeisenberg_stone_snow.tga
            Texture = dbeisenberg.tga dbeisenberg_snow.tga
        End

        ModelConditionState = SNOW ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Model    = dberedluin_b
            Texture = dbeisenberg_stone.tga dbeisenberg_stone_snow.tga
            Texture = dbeisenberg.tga dbeisenberg_snow.tga
        End

        ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Model               = dberedluin_b
        End

        AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Animation           = dberedluin_b
                AnimationName     = dberedluin_b.dberedluin_b
                AnimationMode     = MANUAL
                AnimationBlendTime = 0
            End
            Flags                  = START_FRAME_FIRST
            StateName              = BeingConstructed
            BeginScript
                CurDrawablePlaySound("GondorBarracksBeginConstruction")
            EndScript
            ParticleSysBone   = CONSTDUSTBONE01 BuildingContructDust FollowBone:Yes
        End





    ModelConditionState  = DAMAGED
      Model         = dberedluinmine
      Texture = dbeisenberg_stone.tga dbeisenberg_stone_d.tga
      Texture = dbeisenberg.tga dbeisenberg_d.tga
        ParticleSysBone FireSmall01 FireBuildingLarge
        ParticleSysBone FireSmall02 FireBuildingMedium
        ParticleSysBone FireSmall03 FireBuildingMedium
        ParticleSysBone FireSmall04 FireBuildingSmall
        ParticleSysBone FireSmall05 SmokeBuildingLarge
    End
    AnimationState = DAMAGED
        EnteringStateFX    = FX_BuildingDamaged
    End

    ModelConditionState  = REALLYDAMAGED
      Model         = dberedluinmine
      Texture = dbeisenberg_stone.tga dbeisenberg_stone_d.tga
      Texture = dbeisenberg.tga dbeisenberg_d.tga
        ParticleSysBone FireSmall01 FireBuildingLarge
        ParticleSysBone FireSmall02 FireBuildingLarge
        ParticleSysBone FireSmall03 FireBuildingMedium
        ParticleSysBone FireSmall04 SmokeBuildingLarge
        ParticleSysBone FireSmall05 SmokeBuildingLarge
    End
    AnimationState = REALLYDAMAGED
          Animation                =    RubbleAnimation
            AnimationName        =    dberedluinmine.dberedluinmine
            AnimationMode        =    ONCE
          End
        EnteringStateFX    = FX_BuildingReallyDamaged
    End

    ModelConditionState  = RUBBLE
      Model         = dberedluinmine
      Texture = dbeisenberg_stone.tga dbeisenberg_stone_d.tga
      Texture = dbeisenberg.tga dbeisenberg_d.tga
      ParticleSysBone SmokeLarge01 SmokeBuildingLarge
    End

    AnimationState = RUBBLE
          Animation                =    RubbleAnimation
            AnimationName        =    dberedluinmine.dberedluinmine
            AnimationMode        =    ONCE
          End
      EnteringStateFX    = FX_StructureMediumCollapse
    End

    ModelConditionState  = POST_RUBBLE
      Model         = None
        ParticleSysBone NONE SmokeBuildingMediumRubble
    End

    ModelConditionState  = POST_COLLAPSE
      Model         = None
        ParticleSysBone NONE SmokeBuildingMediumRubble
    End

    ModelConditionState = SNOW UPGRADE_NUMENOR_STONEWORK
        Model    = dberedluinmine
        Texture = dbeisenberg_stone_snow.tga dbeisenberg_stone.tga
        Texture = dbeisenberg_snow.tga dbeisenberg.tga
    End

    ModelConditionState = SNOW
        Model    = dberedluinmine
            Texture = dbeisenberg_stone.tga dbeisenberg_stone_snow.tga
            Texture = dbeisenberg.tga dbeisenberg_snow.tga
    End


End


  Draw = W3DFloorDraw ModuleTag_DrawFloor
        StaticModelLODMode = Yes
     ModelName = None
  End




    Draw = W3DScriptedModelDraw ModuleTag_DrawRune
        DefaultModelConditionState
            Model        = exeredrune
        End

    AnimationState = BUILD_PLACEMENT_CURSOR
        BeginScript
            CurDrawableHideSubObject("GLOW01")
            CurDrawableHideSubObject("GLOW02")
            CurDrawableHideSubObject("GLOW03")
            CurDrawableHideSubObject("GLOW04")
            CurDrawableHideSubObject("GLOW05")
        EndScript
    End
    AnimationState = PHANTOM_STRUCTURE
        BeginScript
            CurDrawableHideSubObject("GLOW01")
            CurDrawableHideSubObject("GLOW02")
            CurDrawableHideSubObject("GLOW03")
            CurDrawableHideSubObject("GLOW04")
            CurDrawableHideSubObject("GLOW05")
        EndScript
    End
    End

  PlacementViewAngle  = -45

  DisplayName             = OBJECT:DwarvenBarracksBreitschultern
  Description             = OBJECT:DwarvenBarracksBreitschulternDescription
  Side                    = Dwarves
  EditorSorting           = STRUCTURE
  ThreatLevel             = FACTORY_THREAT_LEVEL
  MaxSimultaneousOfType   = 4
  RefundValue             = 200
  BuildCost               = 350
  BuildTime               = 40
  BountyValue             = 80
  VisionRange             = 160
  ShroudClearingRange     = 180
  CommandSet              = DwarvenBarracksBreitschulternCommandSet
  ArmorSet
    Conditions            = None
    Armor                 = FactoryArmor
  End

    WeaponSet
        Conditions        = None
    End

    WeaponSet
        Conditions        = PLAYER_UPGRADE
        Weapon            = PRIMARY StructureAxeWeapon
        AutoChooseSources = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End

    #include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

    VoiceSelect                  = DwarfBarracksSelect

    SoundOnDamaged               = BuildingLightDamageStone
    SoundOnReallyDamaged         = BuildingHeavyDamageStone

    VoiceSelectUnderConstruction = BuildingGoodVoiceSelectUnderConstruction
    VoiceFullyCreated            = EVA:HallOfWarriorsComplete

    UnitSpecificSounds
        UnderConstruction        = BuildingConstructionLoop
        UnderRepairFromRubble    = BuildingConstructionLoop
    End

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound     = Sound:StatueHeroicBuildStoneDebris2 Animation:EBBarracks_ASKL.EBBarracks_ABLD Frames:247
        AnimationSound     = Sound:StatueHeroicBuildStoneDebris1 Animation:EBBarracks_ASKL.EBBarracks_ABLD Frames:257
    End

  RadarPriority       = STRUCTURE
  KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE FS_FACTORY AUTO_RALLYPOINT MP_COUNT_FOR_VICTORY NEED_BASE_FOUNDATION ATTACK_NEEDS_LINE_OF_SIGHT CAN_ATTACK MADE_OF_STONE LIVING_WORLD_BUILDING_MIRROR

  Behavior            = GettingBuiltBehavior ModuleTag_04
    WorkerName        = DwarvenWorkerNoSelect
    SpawnTimer        = DEFAULT_STRUCTURE_HEALDELAY
  End

    Behavior = TerrainResourceBehavior ModuleTag_NewMoneyDeadSpot
        Radius            = 100
        MaxIncome        = 0
        IncomeInterval        = 999999
        HighPriority        = Yes
        Visible         = No
    End

    Behavior = AIUpdateInterface ModuleTag_SoWeCanUseWeapon
        AutoAcquireEnemiesWhenIdle    = Yes
        MoodAttackCheckRate        = 250
        AILuaEventsList            = AngmarStructuresFunctions
    End

    Behavior = PassiveAreaEffectBehavior ModuleTag_FeelGoodHero2
        EffectRadius            = 350
        PingDelay               = 2000
        UpgradeRequired         = Upgrade_TestBuilding_2
        ModifierName            = DainHallenUnitModifier
        AllowFilter             = GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
    End

  Body                        = ActiveBody ModuleTag_05
    MaxHealth                 = 3500
    MaxHealthDamaged          = 3000
    MaxHealthReallyDamaged    = 1500
    DamageCreationList        = OCL_BuildingDamageList01 CATAPULT_ROCK

    DamageCreationList = OCL_GBBarracksN2D2_Chunk1 CATAPULT_ROCK FRONT_DESTROYED
    DamageCreationList = OCL_GBBarracksN2D2_Chunk2 CATAPULT_ROCK RIGHT_DESTROYED
    DamageCreationList = OCL_GBBarracksN2D2_Chunk3 CATAPULT_ROCK BACK_DESTROYED
    DamageCreationList = OCL_GBBarracksN2D2_Chunk4 CATAPULT_ROCK LEFT_DESTROYED
  End

    Behavior = RefundDie ModuleTag_refund
        UpgradeRequired     = Upgrade_MarketplaceUpgradeDefiance
        BuildingRequired     = ANY +GondorMarketPlace
        RefundPercent         = 50%
    End

  Behavior = ProductionUpdate ModuleTag_06
    GiveNoXP = Yes
  End

  Behavior = QueueProductionExitUpdate ModuleTag_07
    UnitCreatePoint           = X:.15.0 Y:0.0 Z:0.0
    NaturalRallyPoint         = X:70.0 Y:0.0 Z:0.0
    ExitDelay                 = STANDARD_HORDE_EXIT_DELAY
    UseReturnToFormation      = No
  End

  Behavior                  = StructureCollapseUpdate ModuleTag_08
    MinCollapseDelay        = 000
    MaxCollapseDelay        = 000
    CollapseDamping         = .5
    MaxShudder              = 0.6
    MinBurstDelay           = 250
    MaxBurstDelay           = 800
    BigBurstFrequency       = 4
    FXList                  = INITIAL   FX_StructureMediumCollapse
    FXList                  = ALMOST_FINAL  FX_StructureAlmostCollapse
    DestroyObjectWhenDone    = Yes
    CollapseHeight        = 155
  End


    Behavior = SubObjectsUpgrade ModuleTag_HideAll
        TriggeredBy        = Upgrade_StructureLevel1
        HideSubObjects     = LVL2 LVL3
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowWallsAndFlag
        TriggeredBy        = Upgrade_DwarvenBarracksLevel2
        ShowSubObjects     = LVL2
        HideSubObjects     = LVL3
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowTowersAndHideFlag
        TriggeredBy        = Upgrade_DwarvenBarracksLevel3
        ShowSubObjects     = LVL2 LVL3
    End

    Behavior = CommandSetUpgrade ModuleTag_DwarvenBarracksLevel2
        TriggeredBy       = Upgrade_DwarvenBarracksLevel2
        ConflictsWith     = Upgrade_DwarvenBarracksLevel3
        CommandSet        = DwarvenBarracksBreitschulternCommandSetLevel2
    End

    Behavior = CommandSetUpgrade ModuleTag_DwarvenBarracksLevel3
        TriggeredBy       = Upgrade_DwarvenBarracksLevel3
        CommandSet        = DwarvenBarracksBreitschulternCommandSetLevel3
    End

    Behavior = LevelUpUpgrade ModuleTag_LevelUpDwarvenHallOfWarriorsLevel2
        TriggeredBy        = Upgrade_DwarvenBarracksLevel2
        LevelsToGain       = 1
        LevelCap           = 3
    End

    Behavior = LevelUpUpgrade ModuleTag_LevelUpDwarvenHallOfWarriorsLevel3
        TriggeredBy        = Upgrade_DwarvenBarracksLevel3
        LevelsToGain       = 1
        LevelCap           = 3
    End

    Behavior                      = BuildingBehavior BuildingModuleTag
        NightWindowName         = N_Window N_Glow
    End


    Behavior = SubObjectsUpgrade ModuleTag_HideGlow
        TriggeredBy             = Upgrade_AllFactionUpgrade
        HideSubObjects          = GLOW01 GLOW02 GLOW03 GLOW04 GLOW05
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowRune1
        TriggeredBy             = Upgrade_Level_1
        ShowSubObjects          = GLOW01
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowRune2
        TriggeredBy             = Upgrade_Level_2
        ShowSubObjects          = GLOW02
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowRune3
        TriggeredBy             = Upgrade_Level_3
        ShowSubObjects          = GLOW03
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowRune4
        TriggeredBy             = Upgrade_Level_4
        ShowSubObjects          = GLOW04
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowRune5
        TriggeredBy             = Upgrade_Level_5
        ShowSubObjects          = GLOW05
    End

    Behavior = PassiveAreaEffectBehavior ModuleTag_MysticFountainsHealing
        UpgradeRequired         = Upgrade_Level_3
        EffectRadius            = 180
        PingDelay               = 2000
        HealPercentPerSecond    = 2%
        AllowFilter             = ANY +INFANTRY +CAVALRY +HERO -MACHINE +MONSTER -IMMOBILE +DOZER
        NonStackable            = Yes
        HealFX                  = FX_SpellHealUnitHealBuff
    End

    Behavior = PassiveAreaEffectBehavior ModuleTag_FeelGoodHero
        UpgradeRequired         = Upgrade_Level_2
        EffectRadius            = 180
        PingDelay               = 2000
        ModifierName            = RuneInspirationLeadership
        AllowFilter             = GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
    End

    Behavior = ObjectCreationUpgrade CreateTheEffecktSchrecken
        TriggeredBy             = Upgrade_Level_5
        Delay                   = 0.0
        ThingToSpawn            = DwarvenRuneSchrecken
        FadeInTime              = 200
    End


    Behavior = AttributeModifierUpgrade ModuleTag_Unantastbrakeit
        TriggeredBy             = Upgrade_Level_1
        AttributeModifier       = DwarvenRuneUnantastbarkeit
    End

    Behavior = AttributeModifierUpgrade ModuleTag_Produktivitat
        TriggeredBy             = Upgrade_Level_4
        AttributeModifier       = DwarvenRuneProduktivitat
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI1
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 380000
        GrantUpgrade = Upgrade_DwarvenBarracksLevel2
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI2
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 650000
        GrantUpgrade = Upgrade_DwarvenBarracksLevel3
    End

    Behavior = GeometryUpgrade Geom_ModuleTag_HideAll
        TriggeredBy        = Upgrade_StructureLevel1
        ShowGeometry        = Geom_Orig
        HideGeometry        = Geom_V2
    End
    Behavior = GeometryUpgrade Geom_ModuleTag_ShowWalls
        TriggeredBy        = Upgrade_DwarvenBarracksLevel2
        ShowGeometry        = Geom_Orig
        HideGeometry        = Geom_V2
    End
      Behavior = GeometryUpgrade Geom_ModuleTag_ShowFlagsAndTower
        TriggeredBy        = Upgrade_DwarvenBarracksLevel3
        ShowGeometry        = Geom_V2 Geom_Orig
    End

  Scale	 = 1.05
  Geometry        = BOX
  GeometryName        = Geom_Orig
  GeometryMajorRadius   = 32.0
  GeometryMinorRadius   = 32.0
  GeometryHeight        = 22.5
  GeometryOffset    = X:4 Y:-4 Z:0

  AdditionalGeometry    = BOX
  GeometryName        = Geom_Orig
  GeometryMajorRadius   = 22.5
  GeometryMinorRadius   = 45.0
  GeometryHeight        = 30.0
  GeometryOffset    = X:-10 Y:-15 Z:0

  AdditionalGeometry    = BOX
  GeometryName        = Geom_Orig
  GeometryMajorRadius   = 45.0
  GeometryMinorRadius   = 22.5
  GeometryHeight        = 30.0
  GeometryOffset    = X:15 Y:10 Z:0

  AdditionalGeometry    = BOX
  GeometryName        = Geom_V2
  GeometryMajorRadius   = 9.0
  GeometryMinorRadius   = 9.0
  GeometryHeight        = 70.0
  GeometryOffset    = X:-26 Y:-6 Z:0


  GeometryIsSmall       = No

  Shadow                = SHADOW_VOLUME
  BuildCompletion    = PLACED_BY_PLAYER

    AttackContactPoint     = X:-24     Y:-24         Z:92
    GeometryContactPoint     = X:-80.1    Y:-18.9        Z:0    Repair
    GeometryContactPoint     = X:-9.861    Y:51.413    Z:0
    GeometryContactPoint     = X:-33.314    Y:-54.902    Z:0
    GeometryContactPoint     = X:-20.106    Y:-25.298    Z:89.3    Swoop
    GeometryContactPoint     = X:10         Y: 10         Z:0     Bomb
End

ChildObject DwarfBarracks_Breitschultern_Summoned DwarfBarracks_Breitschultern

  Behavior = GrantUpgradeCreate ModuleTag_ActLikeAnOldUpgrade
     UpgradeToGrant = Upgrade_DwarvenBarracksLevel2 Upgrade_DwarvenBarracksLevel3
  End

    Behavior = ObjectCreationUpgrade MakeTheGeom
        TriggeredBy      = Upgrade_AllFactionUpgrade
        Delay            = 1000
        GrantUpgrade     = Upgrade_PlantShield
    End

    Behavior = GeometryUpgrade ModueTag_TowerGeom
        TriggeredBy      = Upgrade_PlantShield
        ShowGeometry     = Geom_Orig1 Geom_Orig2 Geom_Orig3 Geom_V2
        HideGeometry     = DummyGeom
    End

    Geometry              = BOX
    GeometryMajorRadius   = 1.0
    GeometryMinorRadius   = 1.0
    GeometryHeight        = 1.0
    GeometryName          = DummyGeom
    GeometryActive         = Yes

  Geometry        = BOX
  GeometryName        = Geom_Orig1
  GeometryMajorRadius   = 32.0
  GeometryMinorRadius   = 32.0
  GeometryHeight        = 22.5
  GeometryOffset    = X:4 Y:-4 Z:0
    GeometryActive         = No

  AdditionalGeometry    = BOX
  GeometryName        = Geom_Orig2
  GeometryMajorRadius   = 22.5
  GeometryMinorRadius   = 45.0
  GeometryHeight        = 30.0
  GeometryOffset    = X:-10 Y:-15 Z:0
    GeometryActive         = No

  AdditionalGeometry    = BOX
  GeometryName        = Geom_Orig3
  GeometryMajorRadius   = 45.0
  GeometryMinorRadius   = 22.5
  GeometryHeight        = 30.0
  GeometryOffset    = X:15 Y:10 Z:0
    GeometryActive         = No

  AdditionalGeometry    = BOX
  GeometryName        = Geom_V2
  GeometryMajorRadius   = 9.0
  GeometryMinorRadius   = 9.0
  GeometryHeight        = 70.0
  GeometryOffset    = X:-26 Y:-6 Z:0
    GeometryActive         = No


  GeometryIsSmall       = No

  Shadow                = SHADOW_VOLUME
  BuildCompletion    = PLACED_BY_PLAYER

    AttackContactPoint     = X:-24     Y:-24         Z:92
    GeometryContactPoint     = X:-80.1    Y:-18.9        Z:0    Repair
    GeometryContactPoint     = X:-9.861    Y:51.413    Z:0
    GeometryContactPoint     = X:-33.314    Y:-54.902    Z:0
    GeometryContactPoint     = X:-20.106    Y:-25.298    Z:89.3    Swoop
    GeometryContactPoint     = X:10         Y: 10         Z:0     Bomb

End


ChildObject BFME1DwarfBarracks_Breitschultern DwarfBarracks_Breitschultern

    Behavior = CastleMemberBehavior ModuleTag_CMB
    End
End



Object DwarfBarracks_Kampagne

    SelectPortrait = BPDHallOfWarriors

  Draw = W3DScriptedModelDraw ModuleTag_Draw

    OkToChangeModelColor  = Yes
    UseStandardModelNames = Yes
    StaticModelLODMode = Yes

    ExtraPublicBone = ARROW01
    ExtraPublicBone = ARROW02
    ExtraPublicBone = ARROW03
    ExtraPublicBone = ARROW04
    ExtraPublicBone = FXBONE01
    ExtraPublicBone = FXBONE02
    ExtraPublicBone = FXBONE05
    ExtraPublicBone = FXBONE04

    DefaultModelConditionState
        Model = EBBarracks_SKN
        WeaponLaunchBone = PRIMARY ARROW
    End

    AnimationState = BUILD_PLACEMENT_CURSOR
        BeginScript
            CurDrawableHideSubObject("N_Window")
            CurDrawableHideSubObject("N_Glow")
            CurDrawableHideSubObject("V1")
            CurDrawableHideSubObject("V2")
        EndScript
    End


    AnimationState = PHANTOM_STRUCTURE
        BeginScript
            CurDrawableHideSubObject("N_Window")
            CurDrawableHideSubObject("N_Glow")
            CurDrawableHideSubObject("V1")
            CurDrawableHideSubObject("V2")
        EndScript
    End

   IdleAnimationState
        Animation = IDLA
            AnimationName        =    EBBarracks_SKL.EBBarracks_IDLA
            AnimationMode            =    ONCE
            AnimationBlendTime = 0
        End
        Animation = IDLB
            AnimationName        =    EBBarracks_SKL.EBBarracks_IDLB
            AnimationMode            =    ONCE
            AnimationBlendTime = 0
        End




    End

    ModelConditionState  = SNOW JUST_BUILT
        Model = EBBarracks_ASKN
            Texture = EBBarracks.tga EBBarracks_Snow.tga
            Texture = DBStoneA.tga DBStoneA_Snow.tga
            Texture = DBFortress1.tga DBFortress1_Snow.tga
    End

    ModelConditionState  = JUST_BUILT
        Model = EBBarracks_ASKN
    End

    AnimationState            = JUST_BUILT
        Animation           = EBBarracks_A
            AnimationName        = EBBarracks_ASKL.EBBarracks_ABLD
            AnimationMode        = ONCE
            AnimationBlendTime    = 0
            AnimationSpeedFactorRange = 4.5 4.5
        End
    End



        ModelConditionState = SNOW AWAITING_CONSTRUCTION
            Model    = EBBarracks_ASKN
            Texture = EBBarracks.tga EBBarracks_Snow.tga
            Texture = DBStoneA.tga DBStoneA_Snow.tga
            Texture = DBFortress1.tga DBFortress1_Snow.tga
        End

        ModelConditionState   = AWAITING_CONSTRUCTION
            Model               = EBBarracks_ASKN

        End
        AnimationState        = AWAITING_CONSTRUCTION
            Animation           =  EBBarracks_A
                AnimationName     =  EBBarracks_ASKL.EBBarracks_ABLD
                AnimationMode     = MANUAL
                AnimationBlendTime = 0
            End
            Flags                  = START_FRAME_FIRST
        End

        ModelConditionState = SNOW ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Model    = EBBarracks_ASKN
            Texture = EBBarracks.tga EBBarracks_Snow.tga
            Texture = DBStoneA.tga DBStoneA_Snow.tga
            Texture = DBFortress1.tga DBFortress1_Snow.tga
        End

        ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Model               = EBBarracks_ASKN
        End

        AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Animation           = EBBarracks_A
                AnimationName     = EBBarracks_ASKL.EBBarracks_ABLD
                AnimationMode     = MANUAL
                AnimationBlendTime = 0
            End
            Flags                  = START_FRAME_FIRST
            StateName              = BeingConstructed
            BeginScript
                CurDrawablePlaySound("GondorBarracksBeginConstruction")
            EndScript
            ParticleSysBone   = CONSTDUSTBONE01 BuildingContructDust FollowBone:Yes
        End




    ModelConditionState  = DAMAGED
      Model         = EBBarracks_D1
        ParticleSysBone FireSmall01 FireBuildingLarge
        ParticleSysBone FireSmall02 FireBuildingMedium
        ParticleSysBone FireSmall03 FireBuildingMedium
        ParticleSysBone FireSmall04 FireBuildingSmall
        ParticleSysBone FireSmall05 SmokeBuildingLarge
    End
    AnimationState = DAMAGED
        EnteringStateFX    = FX_BuildingDamaged
    End

    ModelConditionState  = REALLYDAMAGED
      Model         = EBBarracks_D2
        ParticleSysBone FireSmall01 FireBuildingLarge
        ParticleSysBone FireSmall02 FireBuildingLarge
        ParticleSysBone FireSmall03 FireBuildingMedium
        ParticleSysBone FireSmall04 SmokeBuildingLarge
        ParticleSysBone FireSmall05 SmokeBuildingLarge
    End
    AnimationState = REALLYDAMAGED
          Animation                =    RubbleAnimation
            AnimationName        =    EBBarracks_D2SK.EBBarracks_D2AN
            AnimationMode        =    ONCE
          End
        EnteringStateFX    = FX_BuildingReallyDamaged
    End

    ModelConditionState  = RUBBLE
      Model         = EBBarracks_D3
      ParticleSysBone SmokeLarge01 SmokeBuildingLarge
    End

    AnimationState = RUBBLE
          Animation                =    RubbleAnimation
            AnimationName        =    EBBarracks_D3SK.EBBarracks_D3AN
            AnimationMode        =    ONCE
          End
      EnteringStateFX    = FX_StructureMediumCollapse
    End

    ModelConditionState  = POST_RUBBLE
      Model         = None
        ParticleSysBone NONE SmokeBuildingMediumRubble
    End

    ModelConditionState  = POST_COLLAPSE
      Model         = None
        ParticleSysBone NONE SmokeBuildingMediumRubble
    End

    ModelConditionState = SNOW
        Model    = EBBarracks_SKN
        Texture = EBBarracks.tga EBBarracks_Snow.tga
        Texture = DBStoneA.tga DBStoneA_Snow.tga
        Texture = DBMineA.tga DBMineA_Snow.tga
        Texture = DBFortress1.tga DBFortress1_Snow.tga
    End

End

    Draw = W3DScriptedModelDraw ModuleTag_DrawRune
        DefaultModelConditionState
            Model        = exrunek
        End

    AnimationState = BUILD_PLACEMENT_CURSOR
        BeginScript
            CurDrawableHideSubObject("GLOW01")
            CurDrawableHideSubObject("GLOW02")
            CurDrawableHideSubObject("GLOW03")
            CurDrawableHideSubObject("GLOW04")
            CurDrawableHideSubObject("GLOW05")
        EndScript
    End
    AnimationState = PHANTOM_STRUCTURE
        BeginScript
            CurDrawableHideSubObject("GLOW01")
            CurDrawableHideSubObject("GLOW02")
            CurDrawableHideSubObject("GLOW03")
            CurDrawableHideSubObject("GLOW04")
            CurDrawableHideSubObject("GLOW05")
        EndScript
    End
   End




  Draw = W3DFloorDraw ModuleTag_DrawFloor
        StaticModelLODMode = Yes
     ModelName = EBBarracks_Bib

          HideIfModelConditions    =    AWAITING_CONSTRUCTION
          HideIfModelConditions    =    PARTIALLY_CONSTRUCTED
  End


  PlacementViewAngle  = 0



  DisplayName         = OBJECT:DwarvenBarracks
  Description           = OBJECT:DwarvenBarracksDescription
  Side                = Dwarves
  EditorSorting       = STRUCTURE
  ThreatLevel         = FACTORY_THREAT_LEVEL

    RefundValue             = 150
    BuildCost               = 350
    BuildTime               = 40
    BountyValue             = 80
    VisionRange             = 160
    ShroudClearingRange     = 180


  ArmorSet
    Conditions            = None
    Armor                 = FactoryArmor

  End
  CommandSet              = DwarvenBarracksCommandSet_Kampagne

    WeaponSet
        Conditions        = None
    End

    WeaponSet
        Conditions        = PLAYER_UPGRADE
        Weapon            = PRIMARY StructureAxeWeapon
        AutoChooseSources    = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End




    #include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

    VoiceSelect        = DwarfBarracksSelect

    SoundOnDamaged        = BuildingLightDamageStone
    SoundOnReallyDamaged    = BuildingHeavyDamageStone

    VoiceSelectUnderConstruction    = BuildingGoodVoiceSelectUnderConstruction
    VoiceFullyCreated        = EVA:HallOfWarriorsComplete

    UnitSpecificSounds
        UnderConstruction    = BuildingConstructionLoop

        UnderRepairFromRubble    = BuildingConstructionLoop
    End

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800


        AnimationSound     = Sound:StatueHeroicBuildStoneDebris2 Animation:EBBarracks_ASKL.EBBarracks_ABLD Frames:247
        AnimationSound     = Sound:StatueHeroicBuildStoneDebris1 Animation:EBBarracks_ASKL.EBBarracks_ABLD Frames:257

    End





  RadarPriority       = STRUCTURE
  KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE FS_FACTORY AUTO_RALLYPOINT MP_COUNT_FOR_VICTORY NEED_BASE_FOUNDATION ATTACK_NEEDS_LINE_OF_SIGHT CAN_ATTACK MADE_OF_STONE LIVING_WORLD_BUILDING_MIRROR

  Behavior            = GettingBuiltBehavior ModuleTag_04
    WorkerName        = DwarvenWorkerNoSelect
    SpawnTimer        = DEFAULT_STRUCTURE_HEALDELAY
  End

    Behavior = TerrainResourceBehavior ModuleTag_NewMoneyDeadSpot
        Radius            = 100
        MaxIncome        = 0
        IncomeInterval        = 999999
        HighPriority        = Yes
        Visible         = No
    End

    Behavior = AIUpdateInterface ModuleTag_SoWeCanUseWeapon
        AutoAcquireEnemiesWhenIdle    = Yes
        MoodAttackCheckRate        = 250
        AILuaEventsList            = AngmarStructuresFunctions
    End


    Behavior = PassiveAreaEffectBehavior ModuleTag_FeelGoodHero2
        EffectRadius            = 350
        PingDelay               = 2000
        UpgradeRequired         = Upgrade_TestBuilding_2
        ModifierName            = DainHallenUnitModifier
        AllowFilter             = GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
    End








  Body                        = ActiveBody ModuleTag_05
    MaxHealth                 = 3500
    MaxHealthDamaged         = DWARVEN_BARRACKS_HEALTH_DAMAGED
    MaxHealthReallyDamaged  = DWARVEN_BARRACKS_HEALTH_REALLY_DAMAGED
    DamageCreationList         = OCL_BuildingDamageList01 CATAPULT_ROCK

    DamageCreationList = OCL_GBBarracksN2D2_Chunk1 CATAPULT_ROCK FRONT_DESTROYED
    DamageCreationList = OCL_GBBarracksN2D2_Chunk2 CATAPULT_ROCK RIGHT_DESTROYED
    DamageCreationList = OCL_GBBarracksN2D2_Chunk3 CATAPULT_ROCK BACK_DESTROYED
    DamageCreationList = OCL_GBBarracksN2D2_Chunk4 CATAPULT_ROCK LEFT_DESTROYED

  End

    Behavior = RefundDie ModuleTag_refund
        UpgradeRequired     = Upgrade_MarketplaceUpgradeDefiance
        BuildingRequired     = ANY +GondorMarketPlace
        RefundPercent         = 50%
    End

  Behavior = ProductionUpdate ModuleTag_06
    GiveNoXP = Yes
  End

  Behavior = QueueProductionExitUpdate ModuleTag_07
    UnitCreatePoint            = X:0.0 Y:0.0 Z:0.0
    NaturalRallyPoint            = X:75.0 Y:-70.0 Z:0.0
    ExitDelay                = STANDARD_HORDE_EXIT_DELAY
    UseReturnToFormation        = No
    PlacementViewAngle        = -45
  End

  Behavior                  = StructureCollapseUpdate ModuleTag_08
    MinCollapseDelay        = 000
    MaxCollapseDelay        = 000
    CollapseDamping         = .5
    MaxShudder              = 0.6
    MinBurstDelay           = 250
    MaxBurstDelay           = 800
    BigBurstFrequency       = 4
    FXList                  = INITIAL   FX_StructureMediumCollapse
    FXList                  = ALMOST_FINAL  FX_StructureAlmostCollapse
    DestroyObjectWhenDone    = Yes
    CollapseHeight        = 155
  End



















    Behavior = SubObjectsUpgrade ModuleTag_HideAll
        TriggeredBy        = Upgrade_StructureLevel1
        HideSubObjects        = V1 V2
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowWallsAndFlag
        TriggeredBy        = Upgrade_DwarvenBarracksLevel2
        ShowSubObjects        = V1
        HideSubObjects        = V2
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowTowersAndHideFlag
        TriggeredBy        = Upgrade_DwarvenBarracksLevel3
        ShowSubObjects        = V1 V2
    End

      Behavior = WeaponSetUpgrade ModuleTag_ThirdLevelBuildingArrows
        TriggeredBy        = Upgrade_DwarvenBarracksLevel3

    End

    Behavior = CommandSetUpgrade ModuleTag_DwarvenBarracksLevel2
        TriggeredBy        = Upgrade_DwarvenBarracksLevel2
        ConflictsWith        = Upgrade_DwarvenBarracksLevel3
        CommandSet        = DwarvenBarracksCommandSetLevel2_Kampagne
    End

    Behavior = CommandSetUpgrade ModuleTag_DwarvenBarracksLevel3
        TriggeredBy        = Upgrade_DwarvenBarracksLevel3
        CommandSet        = DwarvenBarracksCommandSetLevel3_Kampagne
    End

    Behavior = LevelUpUpgrade ModuleTag_LevelUpDwarvenHallOfWarriorsLevel2
        TriggeredBy        = Upgrade_DwarvenBarracksLevel2
        LevelsToGain        = 1
        LevelCap        = 3
    End

    Behavior = LevelUpUpgrade ModuleTag_LevelUpDwarvenHallOfWarriorsLevel3
        TriggeredBy        = Upgrade_DwarvenBarracksLevel3
        LevelsToGain        = 1
        LevelCap        = 3
    End


    Behavior = GeometryUpgrade Geom_ModuleTag_HideAll
        TriggeredBy        = Upgrade_StructureLevel1
        ShowGeometry        = Geom_Orig
        HideGeometry        = Geom_V2
    End

    Behavior = GeometryUpgrade Geom_ModuleTag_ShowWalls
        TriggeredBy        = Upgrade_DwarvenBarracksLevel2
        ShowGeometry        = Geom_Orig
        HideGeometry        = Geom_V2
    End

    Behavior = GeometryUpgrade Geom_ModuleTag_ShowFlagsAndTower
        TriggeredBy        = Upgrade_DwarvenBarracksLevel3
        ShowGeometry        = Geom_V2 Geom_Orig
    End

    Behavior                      = BuildingBehavior BuildingModuleTag
        NightWindowName         = N_Window N_Glow



    End






    Behavior = SubObjectsUpgrade ModuleTag_HideGlow
        TriggeredBy             = Upgrade_AllFactionUpgrade
        HideSubObjects          = GLOW01 GLOW02 GLOW03 GLOW04 GLOW05
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowRune1
        TriggeredBy             = Upgrade_Level_1
        ShowSubObjects          = GLOW01
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowRune2
        TriggeredBy             = Upgrade_Level_2
        ShowSubObjects          = GLOW02
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowRune3
        TriggeredBy             = Upgrade_Level_3
        ShowSubObjects          = GLOW03
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowRune4
        TriggeredBy             = Upgrade_Level_4
        ShowSubObjects          = GLOW04
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowRune5
        TriggeredBy             = Upgrade_Level_5
        ShowSubObjects          = GLOW05
    End

    Behavior = PassiveAreaEffectBehavior ModuleTag_MysticFountainsHealing
        UpgradeRequired         = Upgrade_Level_3
        EffectRadius            = 180
        PingDelay               = 2000
        HealPercentPerSecond    = 2%
        AllowFilter             = ANY +INFANTRY +CAVALRY +HERO -MACHINE +MONSTER -IMMOBILE +DOZER
        NonStackable            = Yes
        HealFX                  = FX_SpellHealUnitHealBuff
    End

    Behavior = PassiveAreaEffectBehavior ModuleTag_FeelGoodHero
        UpgradeRequired         = Upgrade_Level_2
        EffectRadius            = 180
        PingDelay               = 2000
        ModifierName            = RuneInspirationLeadership
        AllowFilter             = GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
    End

    Behavior = ObjectCreationUpgrade CreateTheEffecktSchrecken
        TriggeredBy             = Upgrade_Level_5
        Delay                   = 0.0
        ThingToSpawn            = DwarvenRuneSchrecken
        FadeInTime              = 200
    End

    Behavior = AttributeModifierUpgrade ModuleTag_Unantastbrakeit
        TriggeredBy             = Upgrade_Level_1
        AttributeModifier       = DwarvenRuneUnantastbarkeit
    End

    Behavior = AttributeModifierUpgrade ModuleTag_Produktivitat
        TriggeredBy             = Upgrade_Level_4
        AttributeModifier       = DwarvenRuneProduktivitat
    End







  Geometry        = BOX
  GeometryName        = Geom_Orig
  GeometryMajorRadius   = 32.0
  GeometryMinorRadius   = 32.0
  GeometryHeight        = 22.5
  GeometryOffset    = X:4 Y:-4 Z:0

  AdditionalGeometry    = BOX
  GeometryName        = Geom_Orig
  GeometryMajorRadius   = 22.5
  GeometryMinorRadius   = 45.0
  GeometryHeight        = 30.0
  GeometryOffset    = X:-10 Y:-15 Z:0

  AdditionalGeometry    = BOX
  GeometryName        = Geom_Orig
  GeometryMajorRadius   = 45.0
  GeometryMinorRadius   = 22.5
  GeometryHeight        = 30.0
  GeometryOffset    = X:15 Y:10 Z:0

  AdditionalGeometry    = BOX
  GeometryName        = Geom_V2
  GeometryMajorRadius   = 9.0
  GeometryMinorRadius   = 9.0
  GeometryHeight        = 70.0
  GeometryOffset    = X:-26 Y:-6 Z:0


  GeometryIsSmall       = No

  Shadow                = SHADOW_VOLUME
  BuildCompletion    = PLACED_BY_PLAYER

    AttackContactPoint     = X:-24     Y:-24         Z:92
    GeometryContactPoint     = X:-80.1    Y:-18.9        Z:0    Repair
    GeometryContactPoint     = X:-9.861    Y:51.413    Z:0
    GeometryContactPoint     = X:-33.314    Y:-54.902    Z:0
    GeometryContactPoint     = X:-20.106    Y:-25.298    Z:89.3    Swoop
    GeometryContactPoint     = X:10         Y: 10         Z:0     Bomb

End


ChildObject DwarfBarracks_Kampagne_Summoned DwarfBarracks_Kampagne
  Behavior = GrantUpgradeCreate ModuleTag_ActLikeAnOldUpgrade
     UpgradeToGrant = Upgrade_DwarvenBarracksLevel2 Upgrade_DwarvenBarracksLevel3
  End

    Behavior = ObjectCreationUpgrade MakeTheGeom
        TriggeredBy      = Upgrade_AllFactionUpgrade
        Delay            = 1000
        GrantUpgrade     = Upgrade_PlantShield
    End

    Behavior = GeometryUpgrade ModueTag_TowerGeom
        TriggeredBy      = Upgrade_PlantShield
        ShowGeometry     = Geom_Orig1 Geom_Orig2 Geom_Orig3 Geom_V2
        HideGeometry     = DummyGeom
    End

    Geometry              = BOX
    GeometryMajorRadius   = 1.0
    GeometryMinorRadius   = 1.0
    GeometryHeight        = 1.0
    GeometryName          = DummyGeom
    GeometryActive         = Yes

  Geometry        = BOX
  GeometryName        = Geom_Orig1
  GeometryMajorRadius   = 32.0
  GeometryMinorRadius   = 32.0
  GeometryHeight        = 22.5
  GeometryOffset    = X:4 Y:-4 Z:0
    GeometryActive         = No

  AdditionalGeometry    = BOX
  GeometryName        = Geom_Orig2
  GeometryMajorRadius   = 22.5
  GeometryMinorRadius   = 45.0
  GeometryHeight        = 30.0
  GeometryOffset    = X:-10 Y:-15 Z:0
    GeometryActive         = No

  AdditionalGeometry    = BOX
  GeometryName        = Geom_Orig3
  GeometryMajorRadius   = 45.0
  GeometryMinorRadius   = 22.5
  GeometryHeight        = 30.0
  GeometryOffset    = X:15 Y:10 Z:0
    GeometryActive         = No

  AdditionalGeometry    = BOX
  GeometryName        = Geom_V2
  GeometryMajorRadius   = 9.0
  GeometryMinorRadius   = 9.0
  GeometryHeight        = 70.0
  GeometryOffset    = X:-26 Y:-6 Z:0
    GeometryActive         = No


  GeometryIsSmall       = No

  Shadow                = SHADOW_VOLUME
  BuildCompletion    = PLACED_BY_PLAYER

    AttackContactPoint     = X:-24     Y:-24         Z:92
    GeometryContactPoint     = X:-80.1    Y:-18.9        Z:0    Repair
    GeometryContactPoint     = X:-9.861    Y:51.413    Z:0
    GeometryContactPoint     = X:-33.314    Y:-54.902    Z:0
    GeometryContactPoint     = X:-20.106    Y:-25.298    Z:89.3    Swoop
    GeometryContactPoint     = X:10         Y: 10         Z:0     Bomb

End



Object DwarfBarracks_Dain

    SelectPortrait = BRDainsKaserne

  Draw = W3DScriptedModelDraw ModuleTag_Draw

    OkToChangeModelColor  = Yes
    UseStandardModelNames = Yes
    StaticModelLODMode = Yes

    ExtraPublicBone = ARROW01
    ExtraPublicBone = ARROW02
    ExtraPublicBone = ARROW03
    ExtraPublicBone = ARROW04
    ExtraPublicBone = FXBONE01
    ExtraPublicBone = FXBONE02
    ExtraPublicBone = FXBONE05
    ExtraPublicBone = FXBONE04

    DefaultModelConditionState
        Model = dbesbarracks
        WeaponLaunchBone = PRIMARY ARROW
    End


    AnimationState = BUILD_PLACEMENT_CURSOR
        BeginScript
            CurDrawableHideSubObject("N_Window")
            CurDrawableHideSubObject("N_Glow")
            CurDrawableHideSubObject("V1")
            CurDrawableHideSubObject("V2")
        EndScript
    End


    AnimationState = PHANTOM_STRUCTURE
        BeginScript
            CurDrawableHideSubObject("N_Window")
            CurDrawableHideSubObject("N_Glow")
            CurDrawableHideSubObject("V1")
            CurDrawableHideSubObject("V2")
        EndScript
    End

   IdleAnimationState
        Animation = dbesbarracks
            AnimationName        =    dbesbarracks.dbesbarracks
            AnimationMode            =    LOOP
            AnimationBlendTime = 0
        End
    End

    ModelConditionState  = SNOW JUST_BUILT
        Model = dbesbarracks_A
            Texture = dberbarracks.tga dbereborbarracks_Snow.tga
            Texture = dbereborbarracks.tga dbereborbarracks_Snow.tga
            Texture = DBStoneA.tga DBStoneA_Snow.tga
            Texture = DBFortress1.tga DBFortress1_Snow.tga
    End

    ModelConditionState  = JUST_BUILT
        Model = dbesbarracks_A
    End

    AnimationState            = JUST_BUILT
        Animation           = dbesbarracks_A
            AnimationName        = dbesbarracks_A.dbesbarracks_A
            AnimationMode        = ONCE
            AnimationBlendTime    = 0
            AnimationSpeedFactorRange = 4.5 4.5
        End
    End



        ModelConditionState = SNOW AWAITING_CONSTRUCTION
            Model    = dbesbarracks_A
            Texture = dberbarracks.tga dbereborbarracks_Snow.tga
            Texture = dbereborbarracks.tga dbereborbarracks_Snow.tga
            Texture = DBStoneA.tga DBStoneA_Snow.tga
            Texture = DBFortress1.tga DBFortress1_Snow.tga
        End

        ModelConditionState   = AWAITING_CONSTRUCTION
            Model               = dbesbarracks_A

        End
        AnimationState        = AWAITING_CONSTRUCTION
            Animation           =  dbesbarracks_A
                AnimationName     =  dbesbarracks_A.dbesbarracks_A
                AnimationMode     = MANUAL
                AnimationBlendTime = 0
            End
            Flags                  = START_FRAME_FIRST
        End

        ModelConditionState = SNOW ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Model    = dbesbarracks_A
            Texture = dberbarracks.tga dbereborbarracks_Snow.tga
            Texture = dbereborbarracks.tga dbereborbarracks_Snow.tga
            Texture = DBStoneA.tga DBStoneA_Snow.tga
            Texture = DBFortress1.tga DBFortress1_Snow.tga
        End

        ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Model               = dbesbarracks_A
        End

        AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Animation           = dbesbarracks_A
                AnimationName     = dbesbarracks_A.dbesbarracks_A
                AnimationMode     = MANUAL
                AnimationBlendTime = 0
            End
            Flags                  = START_FRAME_FIRST
            StateName              = BeingConstructed
            BeginScript
                CurDrawablePlaySound("GondorBarracksBeginConstruction")
            EndScript
            ParticleSysBone   = CONSTDUSTBONE01 BuildingContructDust FollowBone:Yes
        End




    ModelConditionState  = DAMAGED
      Model         = dbesbarracks
        Texture = DBStoneA.tga DBStoneA_d1.tga
        Texture = dberbarracks.tga dbereborbarracks_d.tga
        Texture = dbereborbarracks.tga dbereborbarracks_d.tga
        ParticleSysBone FireSmall01 FireBuildingLarge
        ParticleSysBone FireSmall02 FireBuildingMedium
        ParticleSysBone FireSmall03 FireBuildingMedium
        ParticleSysBone FireSmall04 FireBuildingSmall
        ParticleSysBone FireSmall05 SmokeBuildingLarge
    End
    AnimationState = DAMAGED
        EnteringStateFX    = FX_BuildingDamaged
    End

    ModelConditionState  = REALLYDAMAGED
      Model         = dbesbarracks
        Texture = DBStoneA.tga DBStoneA_d1.tga
        Texture = dberbarracks.tga dbereborbarracks_d.tga
        Texture = dbereborbarracks.tga dbereborbarracks_d.tga
        ParticleSysBone FireSmall01 FireBuildingLarge
        ParticleSysBone FireSmall02 FireBuildingLarge
        ParticleSysBone FireSmall03 FireBuildingMedium
        ParticleSysBone FireSmall04 SmokeBuildingLarge
        ParticleSysBone FireSmall05 SmokeBuildingLarge
    End
    AnimationState = REALLYDAMAGED
          Animation                =    RubbleAnimation
            AnimationName        =    dbesbarracks.dbesbarracks
            AnimationMode        =    ONCE
          End
        EnteringStateFX    = FX_BuildingReallyDamaged
    End

    ModelConditionState  = RUBBLE
      Model         = dbesbarracks
        Texture = DBStoneA.tga DBStoneA_d1.tga
        Texture = dberbarracks.tga dbereborbarracks_d.tga
        Texture = dbereborbarracks.tga dbereborbarracks_d.tga
      ParticleSysBone SmokeLarge01 SmokeBuildingLarge
    End

    AnimationState = RUBBLE
          Animation                =    RubbleAnimation
            AnimationName        =    dbesbarracks.dbesbarracks
            AnimationMode        =    ONCE
          End
      EnteringStateFX    = FX_StructureMediumCollapse
    End

    ModelConditionState  = POST_RUBBLE
      Model         = None
        ParticleSysBone NONE SmokeBuildingMediumRubble
    End

    ModelConditionState  = POST_COLLAPSE
      Model         = None
        ParticleSysBone NONE SmokeBuildingMediumRubble
    End

    ModelConditionState = SNOW
        Model    = dbesbarracks
        Texture = EBBarracks.tga EBBarracks_Snow.tga
        Texture = DBStoneA.tga DBStoneA_Snow.tga
        Texture = DBMineA.tga DBMineA_Snow.tga
        Texture = DBFortress1.tga DBFortress1_Snow.tga
    End

End

    Draw = W3DScriptedModelDraw ModuleTag_DrawRune
        DefaultModelConditionState
            Model        = exrunek
        End

    AnimationState = BUILD_PLACEMENT_CURSOR
        BeginScript
            CurDrawableHideSubObject("GLOW01")
            CurDrawableHideSubObject("GLOW02")
            CurDrawableHideSubObject("GLOW03")
            CurDrawableHideSubObject("GLOW04")
            CurDrawableHideSubObject("GLOW05")
        EndScript
    End
    AnimationState = PHANTOM_STRUCTURE
        BeginScript
            CurDrawableHideSubObject("GLOW01")
            CurDrawableHideSubObject("GLOW02")
            CurDrawableHideSubObject("GLOW03")
            CurDrawableHideSubObject("GLOW04")
            CurDrawableHideSubObject("GLOW05")
        EndScript
    End
   End



  PlacementViewAngle            = -45



  DisplayName         = OBJECT:DwarvenBarracksDain
  Description         = OBJECT:DwarvenBarracksDainDescription
  Side                = Dwarves
  EditorSorting       = STRUCTURE
  ThreatLevel         = FACTORY_THREAT_LEVEL

  BuildCost           = 350
  BuildTime           = 40
  BountyValue         = DWARVEN_BARRACKS_BOUNTY_VALUE
  VisionRange         = 160.0
  ShroudClearingRange = DWARVEN_BARRACKS_SHROUD_CLEAR
  MaxSimultaneousOfType     = 1

  ArmorSet
    Conditions            = None
    Armor                 = FactoryArmor

  End
  CommandSet              = DwarvenBarracksCommandSet

    WeaponSet
        Conditions        = None
    End

    WeaponSet
        Conditions        = PLAYER_UPGRADE
        Weapon            = PRIMARY StructureAxeWeapon
        AutoChooseSources    = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End




    #include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

    VoiceSelect        = DwarfBarracksSelect

    SoundOnDamaged        = BuildingLightDamageStone
    SoundOnReallyDamaged    = BuildingHeavyDamageStone

    VoiceSelectUnderConstruction    = BuildingGoodVoiceSelectUnderConstruction
    VoiceFullyCreated        = EVA:HallOfWarriorsComplete

    UnitSpecificSounds
        UnderConstruction    = BuildingConstructionLoop

        UnderRepairFromRubble    = BuildingConstructionLoop
    End

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800


        AnimationSound     = Sound:StatueHeroicBuildStoneDebris2 Animation:EBBarracks_ASKL.EBBarracks_ABLD Frames:247
        AnimationSound     = Sound:StatueHeroicBuildStoneDebris1 Animation:EBBarracks_ASKL.EBBarracks_ABLD Frames:257

    End





  RadarPriority       = STRUCTURE
  KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE FS_FACTORY AUTO_RALLYPOINT MP_COUNT_FOR_VICTORY NEED_BASE_FOUNDATION ATTACK_NEEDS_LINE_OF_SIGHT CAN_ATTACK MADE_OF_STONE LIVING_WORLD_BUILDING_MIRROR

  Behavior            = GettingBuiltBehavior ModuleTag_04
    WorkerName        = DwarvenWorkerNoSelect
    SpawnTimer        = DEFAULT_STRUCTURE_HEALDELAY
  End

    Behavior = TerrainResourceBehavior ModuleTag_NewMoneyDeadSpot
        Radius            = 100
        MaxIncome        = 0
        IncomeInterval        = 999999
        HighPriority        = Yes
        Visible         = No
    End

    Behavior = AIUpdateInterface ModuleTag_SoWeCanUseWeapon
        AutoAcquireEnemiesWhenIdle    = Yes
        MoodAttackCheckRate        = 250
        AILuaEventsList            = AngmarStructuresFunctions
    End


    Behavior = PassiveAreaEffectBehavior ModuleTag_FeelGoodHero2
        EffectRadius            = 350
        PingDelay               = 2000
        UpgradeRequired         = Upgrade_TestBuilding_2
        ModifierName            = DainHallenUnitModifier
        AllowFilter             = GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
    End








  Body                        = ActiveBody ModuleTag_05
    MaxHealth                 = 3500
    MaxHealthDamaged         = DWARVEN_BARRACKS_HEALTH_DAMAGED
    MaxHealthReallyDamaged  = DWARVEN_BARRACKS_HEALTH_REALLY_DAMAGED
    DamageCreationList         = OCL_BuildingDamageList01 CATAPULT_ROCK

    DamageCreationList = OCL_GBBarracksN2D2_Chunk1 CATAPULT_ROCK FRONT_DESTROYED
    DamageCreationList = OCL_GBBarracksN2D2_Chunk2 CATAPULT_ROCK RIGHT_DESTROYED
    DamageCreationList = OCL_GBBarracksN2D2_Chunk3 CATAPULT_ROCK BACK_DESTROYED
    DamageCreationList = OCL_GBBarracksN2D2_Chunk4 CATAPULT_ROCK LEFT_DESTROYED

  End

    Behavior = RefundDie ModuleTag_refund
        UpgradeRequired     = Upgrade_MarketplaceUpgradeDefiance
        BuildingRequired     = ANY +GondorMarketPlace
        RefundPercent         = 50%
    End

  Behavior = ProductionUpdate ModuleTag_06
    GiveNoXP = Yes
  End

    Behavior = QueueProductionExitUpdate ModuleTag_07
       UnitCreatePoint           = X:0.0 Y:-30.0 Z:0.0
       NaturalRallyPoint         = X:80.0 Y:-30.0 Z:0.0
       ExitDelay                 = STANDARD_HORDE_EXIT_DELAY
       UseReturnToFormation      = No
    End

  Behavior                  = StructureCollapseUpdate ModuleTag_08
    MinCollapseDelay        = 000
    MaxCollapseDelay        = 000
    CollapseDamping         = .5
    MaxShudder              = 0.6
    MinBurstDelay           = 250
    MaxBurstDelay           = 800
    BigBurstFrequency       = 4
    FXList                  = INITIAL   FX_StructureMediumCollapse
    FXList                  = ALMOST_FINAL  FX_StructureAlmostCollapse
    DestroyObjectWhenDone    = Yes
    CollapseHeight        = 155
  End



















    Behavior = SubObjectsUpgrade ModuleTag_HideAll
        TriggeredBy        = Upgrade_StructureLevel1
        HideSubObjects        = AXE DWARF
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowWallsAndFlag
        TriggeredBy        = Upgrade_DwarvenBarracksLevel2
        ShowSubObjects        = DWARF
        HideSubObjects        = AXE
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowTowersAndHideFlag
        TriggeredBy        = Upgrade_DwarvenBarracksLevel3
        ShowSubObjects        = AXE DWARF
    End

      Behavior = WeaponSetUpgrade ModuleTag_ThirdLevelBuildingArrows
        TriggeredBy        = Upgrade_DwarvenBarracksLevel3

    End

    Behavior = CommandSetUpgrade ModuleTag_DwarvenBarracksLevel2
        TriggeredBy        = Upgrade_DwarvenBarracksLevel2
        ConflictsWith        = Upgrade_DwarvenBarracksLevel3
        CommandSet        = DwarvenBarracksCommandSetLevel2
    End

    Behavior = CommandSetUpgrade ModuleTag_DwarvenBarracksLevel3
        TriggeredBy        = Upgrade_DwarvenBarracksLevel3
        CommandSet        = DwarvenBarracksCommandSetLevel3
    End

    Behavior = LevelUpUpgrade ModuleTag_LevelUpDwarvenHallOfWarriorsLevel2
        TriggeredBy        = Upgrade_DwarvenBarracksLevel2
        LevelsToGain        = 1
        LevelCap        = 3
    End

    Behavior = LevelUpUpgrade ModuleTag_LevelUpDwarvenHallOfWarriorsLevel3
        TriggeredBy        = Upgrade_DwarvenBarracksLevel3
        LevelsToGain        = 1
        LevelCap        = 3
    End


    Behavior = GrantUpgradeCreate ModuleTag_ActLikeAnOldUpgrade
        UpgradeToGrant          = Upgrade_TrebuchetTurret
        GiveOnBuildComplete     = Yes
    End

    Behavior = ObjectCreationUpgrade MakeTheFreeTreb1
        TriggeredBy             = Upgrade_TrebuchetTurret
        Delay                   = 0.0
        ThingToSpawn            = DwarvenBow_Slaved
        Offset                  = X:9 Y:31 Z:48
        FadeInTime              = 600
    End

    Behavior = ObjectCreationUpgrade MakeTheFreeTreb2
        TriggeredBy             = Upgrade_TrebuchetTurret
        Delay                   = 0.0
        ThingToSpawn            = DwarvenBow_Slaved
        Offset                  = X:-5 Y:43 Z:48
        FadeInTime              = 600
    End

    Behavior = ObjectCreationUpgrade MakeTheFreeTreb3
        TriggeredBy             = Upgrade_TrebuchetTurret
        Delay                   = 0.0
        ThingToSpawn            = DwarvenBow_Slaved
        Offset                  = X:-5 Y:16 Z:48
        FadeInTime              = 600
    End


    Behavior = GeometryUpgrade Geom_ModuleTag_HideAll
        TriggeredBy        = Upgrade_StructureLevel1
        ShowGeometry        = Geom_Orig
        HideGeometry        = Geom_V2
    End

    Behavior = GeometryUpgrade Geom_ModuleTag_ShowWalls
        TriggeredBy        = Upgrade_DwarvenBarracksLevel2
        ShowGeometry        = Geom_Orig
        HideGeometry        = Geom_V2
    End

    Behavior = GeometryUpgrade Geom_ModuleTag_ShowFlagsAndTower
        TriggeredBy        = Upgrade_DwarvenBarracksLevel3
        ShowGeometry        = Geom_V2 Geom_Orig
    End

    Behavior                      = BuildingBehavior BuildingModuleTag
        NightWindowName         = N_Window N_Glow



    End






    Behavior = SubObjectsUpgrade ModuleTag_HideGlow
        TriggeredBy             = Upgrade_AllFactionUpgrade
        HideSubObjects          = GLOW01 GLOW02 GLOW03 GLOW04 GLOW05
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowRune1
        TriggeredBy             = Upgrade_Level_1
        ShowSubObjects          = GLOW01
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowRune2
        TriggeredBy             = Upgrade_Level_2
        ShowSubObjects          = GLOW02
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowRune3
        TriggeredBy             = Upgrade_Level_3
        ShowSubObjects          = GLOW03
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowRune4
        TriggeredBy             = Upgrade_Level_4
        ShowSubObjects          = GLOW04
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowRune5
        TriggeredBy             = Upgrade_Level_5
        ShowSubObjects          = GLOW05
    End

    Behavior = PassiveAreaEffectBehavior ModuleTag_MysticFountainsHealing
        UpgradeRequired         = Upgrade_Level_3
        EffectRadius            = 180
        PingDelay               = 2000
        HealPercentPerSecond    = 2%
        AllowFilter             = ANY +INFANTRY +CAVALRY +HERO -MACHINE +MONSTER -IMMOBILE +DOZER
        NonStackable            = Yes
        HealFX                  = FX_SpellHealUnitHealBuff
    End

    Behavior = PassiveAreaEffectBehavior ModuleTag_FeelGoodHero
        UpgradeRequired         = Upgrade_Level_2
        EffectRadius            = 180
        PingDelay               = 2000
        ModifierName            = RuneInspirationLeadership
        AllowFilter             = GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
    End

    Behavior = ObjectCreationUpgrade CreateTheEffecktSchrecken
        TriggeredBy             = Upgrade_Level_5
        Delay                   = 0.0
        ThingToSpawn            = DwarvenRuneSchrecken
        FadeInTime              = 200
    End

    Behavior = AttributeModifierUpgrade ModuleTag_Unantastbrakeit
        TriggeredBy             = Upgrade_Level_1
        AttributeModifier       = DwarvenRuneUnantastbarkeit
    End

    Behavior = AttributeModifierUpgrade ModuleTag_Produktivitat
        TriggeredBy             = Upgrade_Level_4
        AttributeModifier       = DwarvenRuneProduktivitat
    End







  Geometry        = BOX
  GeometryName        = Geom_Orig
  GeometryMajorRadius   = 32.0
  GeometryMinorRadius   = 32.0
  GeometryHeight        = 22.5
  GeometryOffset    = X:4 Y:-4 Z:0

  AdditionalGeometry    = BOX
  GeometryName        = Geom_Orig
  GeometryMajorRadius   = 22.5
  GeometryMinorRadius   = 45.0
  GeometryHeight        = 30.0
  GeometryOffset    = X:-10 Y:-15 Z:0

  AdditionalGeometry    = BOX
  GeometryName        = Geom_Orig
  GeometryMajorRadius   = 45.0
  GeometryMinorRadius   = 22.5
  GeometryHeight        = 30.0
  GeometryOffset    = X:15 Y:10 Z:0

  AdditionalGeometry    = BOX
  GeometryName        = Geom_V2
  GeometryMajorRadius   = 9.0
  GeometryMinorRadius   = 9.0
  GeometryHeight        = 70.0
  GeometryOffset    = X:-26 Y:-6 Z:0


  GeometryIsSmall       = No

  Shadow                = SHADOW_VOLUME
  BuildCompletion    = PLACED_BY_PLAYER

    AttackContactPoint     = X:-24     Y:-24         Z:92
    GeometryContactPoint     = X:-80.1    Y:-18.9        Z:0    Repair
    GeometryContactPoint     = X:-9.861    Y:51.413    Z:0
    GeometryContactPoint     = X:-33.314    Y:-54.902    Z:0
    GeometryContactPoint     = X:-20.106    Y:-25.298    Z:89.3    Swoop
    GeometryContactPoint     = X:10         Y: 10         Z:0     Bomb

End


ChildObject DwarfBarracks_Dain_Summoned DwarfBarracks_Dain
  Behavior = GrantUpgradeCreate ModuleTag_ActLikeAnOldUpgrade
     UpgradeToGrant = Upgrade_DwarvenBarracksLevel3
  End

  MaxSimultaneousOfType     = 1

    Behavior = ObjectCreationUpgrade MakeTheGeom
        TriggeredBy      = Upgrade_AllFactionUpgrade
        Delay            = 1000
        GrantUpgrade     = Upgrade_PlantShield
    End

    Behavior = GeometryUpgrade ModueTag_TowerGeom
        TriggeredBy      = Upgrade_PlantShield
        ShowGeometry     = Geom_Orig1 Geom_Orig2 Geom_Orig3 Geom_V2
        HideGeometry     = DummyGeom
    End

    Geometry              = BOX
    GeometryMajorRadius   = 1.0
    GeometryMinorRadius   = 1.0
    GeometryHeight        = 1.0
    GeometryName          = DummyGeom
    GeometryActive         = Yes

  Geometry        = BOX
  GeometryName        = Geom_Orig1
  GeometryMajorRadius   = 32.0
  GeometryMinorRadius   = 32.0
  GeometryHeight        = 22.5
  GeometryOffset    = X:4 Y:-4 Z:0
    GeometryActive         = No

  AdditionalGeometry    = BOX
  GeometryName        = Geom_Orig2
  GeometryMajorRadius   = 22.5
  GeometryMinorRadius   = 45.0
  GeometryHeight        = 30.0
  GeometryOffset    = X:-10 Y:-15 Z:0
    GeometryActive         = No

  AdditionalGeometry    = BOX
  GeometryName        = Geom_Orig3
  GeometryMajorRadius   = 45.0
  GeometryMinorRadius   = 22.5
  GeometryHeight        = 30.0
  GeometryOffset    = X:15 Y:10 Z:0
    GeometryActive         = No

  AdditionalGeometry    = BOX
  GeometryName        = Geom_V2
  GeometryMajorRadius   = 9.0
  GeometryMinorRadius   = 9.0
  GeometryHeight        = 70.0
  GeometryOffset    = X:-26 Y:-6 Z:0
    GeometryActive         = No


  GeometryIsSmall       = No

  Shadow                = SHADOW_VOLUME
  BuildCompletion    = PLACED_BY_PLAYER

    AttackContactPoint     = X:-24     Y:-24         Z:92
    GeometryContactPoint     = X:-80.1    Y:-18.9        Z:0    Repair
    GeometryContactPoint     = X:-9.861    Y:51.413    Z:0
    GeometryContactPoint     = X:-33.314    Y:-54.902    Z:0
    GeometryContactPoint     = X:-20.106    Y:-25.298    Z:89.3    Swoop
    GeometryContactPoint     = X:10         Y: 10         Z:0     Bomb


    Behavior = CommandSetUpgrade ModuleTag_DwarvenBarracksDiplomacy
        TriggeredBy        = Upgrade_GimliDiplomacyUpgrade
        CommandSet        = DwarvenBarracksDiplomacyCommandSet
    End

    Behavior = ObjectCreationUpgrade ModuleTag_Level2
        TriggeredBy  = Upgrade_AllFactionUpgrade
        Delay        = 1
        GrantUpgrade = Upgrade_DwarvenBarracksLevel2
    End

    Behavior = ObjectCreationUpgrade ModuleTag_Level3
        TriggeredBy  = Upgrade_DwarvenBarracksLevel2
        Delay        = 1
        GrantUpgrade = Upgrade_DwarvenBarracksLevel3
    End

    Behavior = SubObjectsUpgrade ModuleTag_HideGlow
        TriggeredBy             = Upgrade_AllFactionUpgrade
        HideSubObjects          = GLOW01 GLOW02 GLOW03 GLOW04 GLOW05
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowRune1
        TriggeredBy             = Upgrade_Level_1
        ShowSubObjects          = GLOW01
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowRune2
        TriggeredBy             = Upgrade_Level_2
        ShowSubObjects          = GLOW02
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowRune3
        TriggeredBy             = Upgrade_Level_3
        ShowSubObjects          = GLOW03
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowRune4
        TriggeredBy             = Upgrade_Level_4
        ShowSubObjects          = GLOW04
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowRune5
        TriggeredBy             = Upgrade_Level_5
        ShowSubObjects          = GLOW05
    End

    Behavior = PassiveAreaEffectBehavior ModuleTag_MysticFountainsHealing
        UpgradeRequired         = Upgrade_Level_3
        EffectRadius            = 180
        PingDelay               = 2000
        HealPercentPerSecond    = 2%
        AllowFilter             = ANY +INFANTRY +CAVALRY +HERO -MACHINE +MONSTER -IMMOBILE +DOZER
        NonStackable            = Yes
        HealFX                  = FX_SpellHealUnitHealBuff
    End

    Behavior = PassiveAreaEffectBehavior ModuleTag_FeelGoodHero
        UpgradeRequired         = Upgrade_Level_2
        EffectRadius            = 180
        PingDelay               = 2000
        ModifierName            = RuneInspirationLeadership
        AllowFilter             = GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
    End

    Behavior = ObjectCreationUpgrade CreateTheEffecktSchrecken
        TriggeredBy             = Upgrade_Level_5
        Delay                   = 0.0
        ThingToSpawn            = DwarvenRuneSchrecken
        FadeInTime              = 200
    End

    Behavior = AttributeModifierUpgrade ModuleTag_Unantastbrakeit
        TriggeredBy             = Upgrade_Level_1
        AttributeModifier       = DwarvenRuneUnantastbarkeit
    End

    Behavior = AttributeModifierUpgrade ModuleTag_Produktivitat
        TriggeredBy             = Upgrade_Level_4
        AttributeModifier       = DwarvenRuneProduktivitat
    End
	
End


