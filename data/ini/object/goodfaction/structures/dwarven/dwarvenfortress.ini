Object DwarvenFortressCenterGeneric

    SelectPortrait = BPDFortress

    Draw = W3DScriptedModelDraw ModuleTag_01

        DefaultModelConditionState
              Model = None
        End

        ModelConditionState = WORLD_BUILDER
            Model = NBasePin
        End
    End

    Side            = Dwarves
    EditorSorting   = STRUCTURE
    KindOf          = IMMOBILE BASE_FOUNDATION CASTLE_CENTER

    Behavior = CastleBehavior ModuleTag_castle
        FilterValidOwnedEntries = ANY +STRUCTURE +WALK_ON_TOP_OF_WALL +BASE_FOUNDATION +TACTICAL_MARKER
    End
End


Object DwarvenFortressExpansionPadCorner


	SelectPortrait = BPDFortress_BuildPlot



	Draw = W3DScriptedModelDraw ModuleTag_DrawFoundation
    		DefaultModelConditionState
    		Model= DBFoundationn
        End

	End


	Draw = W3DScriptedModelDraw ModuleTag_DrawMain
		DefaultModelConditionState
			Model = WBFoundationP
		End

		ModelConditionState = CONSTRUCTION_COMPLETE
			Model = None
		End
	End




	DisplayName         = OBJECT:DwarvenBuildingFoundation
	Side                = Dwarves
	EditorSorting       = STRUCTURE
	ThreatLevel 	    = 1.0

	BuildCost           = 1
	BuildTime           = 5.0
	VisionRange         = 0.0
	ShroudClearingRange = 0

	CommandSet = DwarvenFortressExpansionPadCornerCommandSet



	VoiceSelect = Gui_PlotSelect2


	KindOf              = STRUCTURE SELECTABLE IMMOBILE BASE_FOUNDATION UNATTACKABLE MP_COUNT_FOR_VICTORY NO_COLLIDE DO_NOT_CLASSIFY EXPANSION_PAD

	Behavior            = FoundationAIUpdate ModuleTag_foundationAI
		BuildVariation = 1
	End

	Behavior = CastleMemberBehavior ModuleTag_CMB
	End

	Body                = ImmortalBody ModuleTag_05
		MaxHealth         = 15000.0
	End

	Geometry              = BOX
	GeometryMajorRadius   = 5.0
	GeometryMinorRadius   = 5.0
	GeometryHeight        = 0.8
	GeometryIsSmall       = No
	Shadow                = NONE
	BuildCompletion			= PLACED_BY_PLAYER
End

ChildObject DwarvenFortressExpansionPadSide DwarvenFortressExpansionPadCorner

    CommandSet = DwarvenFortressExpansionPadSideCommandSet

    Behavior            = FoundationAIUpdate ModuleTag_foundationAI
        BuildVariation = 1
    End
End



ChildObject DwarvenFortressPadforFortressExpansionBuildings DwarvenFortressExpansionPadCorner

    CommandSet = DwarvenFortressPadforFortressExpansionBuildingsCommandSet

    Behavior            = FoundationAIUpdate ModuleTag_foundationAI
        BuildVariation = 1
    End
End

ChildObject DwarvenFortressPadforInnerBuildings DwarvenFortressExpansionPadCorner

    CommandSet = DwarvenFortressPadforInnerBuildingsCommandSet

    Behavior            = FoundationAIUpdate ModuleTag_foundationAI
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSet1
        TriggeredBy       = Upgrade_SubFactionErebor
        CommandSet        = DwarvenFortressPadforLangbarteCommandSet
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSet2
        TriggeredBy       = Upgrade_SubFactionIronHills
        CommandSet        = DwarvenFortressPadforFeuerbarteCommandSet
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSet3
        TriggeredBy       = Upgrade_SubFactionEredLuin
        CommandSet        = DwarvenFortressPadforBreitschulternCommandSet
    End

End

ChildObject DwarvenFortressPadforOuterBuildings DwarvenFortressExpansionPadCorner

    CommandSet = DwarvenFortressExpansionPadSideCommandSet

    Behavior            = FoundationAIUpdate ModuleTag_foundationAI
        BuildVariation = 1
    End
End


ChildObject DwarvenFortressExpansionPad_Mountain DwarvenFortressExpansionPadCorner

    CommandSet = DwarvenFortressPadMountainCommandSet

    Behavior            = FoundationAIUpdate ModuleTag_foundationAI
        BuildVariation = 1
    End
End



Object  DwarvenWallHubSmallExpansion



      SelectPortrait = BPDFortress_WallHub

    Draw = W3DScriptedModelDraw ModuleTag_Draw
        OkToChangeModelColor  = Yes
        UseStandardModelNames = Yes

        DefaultModelConditionState
            Model = DBGFWHUB
        End


        ModelConditionState = UPGRADE_NUMENOR_STONEWORK ACTIVELY_BEING_CONSTRUCTED
            Model        = DBGFWHUB_A
            Texture        = DBFortress1.tga DBFortress_U.tga
        End

        ModelConditionState = SNOW ACTIVELY_BEING_CONSTRUCTED
            Model    = DBGFWHub_A
            Texture = DBFortress1.tga DBFortress1_Snow.tga
        End

        ModelConditionState = ACTIVELY_BEING_CONSTRUCTED
            Model            = DBGFWHub_A
        End

        AnimationState = ACTIVELY_BEING_CONSTRUCTED
            Animation                    = UpAndStill
                AnimationName            = DBGFWHub_A.DBGFWHub_A
                AnimationMode            = MANUAL
            End
            ParticleSysBone = NONE BuildingContructDust
            BeginScript
                CurDrawablePlaySound("GondorBarracksBeginConstruction")
            EndScript
        End

        ModelConditionState = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Model = DBGFWHub_A
        End

        AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Animation           = DBGFWHub_A
                AnimationName     = DBGFWHub_A.DBGFWHub_A
                AnimationMode     = ONCE
            End
        End


        ModelConditionState  = DAMAGED
            Model         = DBGFWHub_D1
        End
        AnimationState = DAMAGED
            EnteringStateFX    = FX_FortressDamaged
        End

        ModelConditionState  = REALLYDAMAGED
            Model       = DBGFWHub_D2
        End

        AnimationState = REALLYDAMAGED
              Animation                = RubbleAnimation
                AnimationName        = DBGFWHub_D2.DBGFWHub_D2
                AnimationMode        = ONCE
              End
            EnteringStateFX    = FX_FortressReallyDamaged
        End

        ModelConditionState  = RUBBLE
            Model         = DBGFWHub_D3
        End

        AnimationState = RUBBLE
              Animation                = RubbleAnimation
                AnimationName        = DBGFWHub_D3.DBGFWHub_D3
                AnimationMode        = ONCE
              End
              EnteringStateFX    = FX_FortressCollapse
        End


        ModelConditionState = UPGRADE_NUMENOR_STONEWORK
            Model        = DBGFWHUB
            Texture        = DBFortress1.tga DBFortress_U.tga
        End


        ModelConditionState = SNOW
            Model    = DBGFWHUB
            Texture = DBFortress1.tga DBFortress1_Snow.tga
        End
    End

    Draw = W3DFloorDraw ModuleTag_DrawFloor
        StaticModelLODMode = Yes
         ModelName = GBWallRmprtNBib
    End


    DisplayName             = OBJECT:DwarvenCastleWallHubExpansion
    Description             = OBJECT:DwarvenFortressDescription

    Side                    = Dwarves
    EditorSorting           = STRUCTURE
    ThreatLevel             = WALL_THREAT_LEVEL

    BuildCost               = DWARVEN_WALLHUB_SMALL_BUILDCOST
    BuildTime               = DWARVEN_WALLHUB_SMALL_BUILDTIME
    VisionRange         = DEFAULT_FORTRESS_VISION_RANGE
    ShroudClearingRange = DEFAULT_FORTRESS_SHROUD_CLEAR

    CommandSet = DwarvenCastleWallHubSmallCommandSet

    ArmorSet
        Conditions        = None
        Armor             = DwarvenWallArmor
    End



    #include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

    VoiceSelect                    = NeutralWallHubSelect

    SoundOnDamaged                = BuildingLightDamageStone
    SoundOnReallyDamaged        = BuildingHeavyDamageStone

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound:StatueHeroicBuildStoneDebris2 Animation:DBGFWHUB_A.DBGFWHUB_A Frames:120
        AnimationSound = Sound:StatueHeroicBuildStoneDebris1 Animation:DBGFWHUB_A.DBGFWHUB_A Frames:135
    End

    UnitSpecificSounds
        UnderConstruction            = BuildingConstructionLoop

        UnderRepairFromRubble        = BuildingConstructionLoop
    End

    CampnessValue = CAMPNESS_FORTRESS_EXPANSION



    KindOf  = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE NEED_BASE_FOUNDATION FS_BASE_DEFENSE MADE_OF_STONE WALL_HUB

    Behavior            = GettingBuiltBehavior ModuleTag_04
        WorkerName                    = DwarvenWorkerNoSelect
        SpawnTimer    = DEFAULT_STRUCTURE_HEALDELAY
    End

    Body                = StructureBody ModuleTag_05
        MaxHealth         = 10000.0
    End

    Behavior = CastleMemberBehavior ModuleTag_CMB
    End

    Behavior = WallHubBehavior ModuleTag_Build_A_Span
        Options                            = OPTION_ONE

        StaggeredBuildFactor = STANDARD_WALL_STAGGERED_BUILD_FACTOR

        MaxBuildoutDistance = DEFAULT_FORTRESS_WALL_EFFECTIVE_RADIUS


        SegmentTemplateName                = DwarvenWallSegmentSmall
        SegmentTemplateName                = DwarvenWallSegmentSmall
        SegmentTemplateName                = DwarvenWallSegmentSmall
        SegmentTemplateName                = DwarvenWallSegmentSmall
        SegmentTemplateName                = DwarvenWallSegmentSmall
        SegmentTemplateName                = DwarvenWallSegmentSmall
        SegmentTemplateName                = DwarvenWallSegmentSmall
        SegmentTemplateName                = DwarvenWallSegmentSmall
        SegmentTemplateName                = DwarvenWallHubSmall

        BuilderRadius = 20

        HubCapTemplateName                 = DwarvenWallHubSmall
        DefaultSegmentTemplateName         = DwarvenWallSegmentSmall

        CliffCapTemplateName               = DwarvenWallCliffCap
    End

    Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
        TriggeredBy                = Upgrade_DwarvenFortressDwarvenStonework
        AttributeModifier        = DwarvenStoneworkExpansion_Bonus
    End
    Behavior = ModelConditionUpgrade ModuleTag_ShowTheStones
        TriggeredBy            = Upgrade_DwarvenFortressDwarvenStonework
        AddConditionFlags    = UPGRADE_NUMENOR_STONEWORK
        Permanent            = Yes
    End

    Behavior = StructureCollapseUpdate ModuleTag_Collapse
        MinCollapseDelay        = 000
        MaxCollapseDelay        = 000
        CollapseDamping         = .5
        MaxShudder              = 0.6
        MinBurstDelay           = 250
        MaxBurstDelay           = 800
        BigBurstFrequency       = 4
        FXList                  = INITIAL   FX_StructureMediumCollapse
        FXList                  = ALMOST_FINAL  FX_StructureAlmostCollapse
        DestroyObjectWhenDone    = Yes
        CollapseHeight            = 120
    End

    Behavior = TerrainResourceBehavior ModuleTag_NewMoneyDeadSpot
        Radius            = 100
        MaxIncome        = 0
        IncomeInterval    = 999999
        HighPriority    = Yes
        Visible = No
    End

    GeometryIsSmall        = No

    Geometry            = CYLINDER
    GeometryMajorRadius    = 25.0
    GeometryHeight        = 60.0

    AdditionalGeometry    = BOX
    GeometryMajorRadius    = 20.0
    GeometryMinorRadius    = 10.0
    GeometryHeight        = 50.0
    GeometryOffset        = X:-20 Y:0 Z:0

    GeometryContactPoint = X:35        Y:0        Z:0            Repair
    GeometryContactPoint     = X:22.954        Y:15.951    Z:0
    GeometryContactPoint     = X:5.435        Y:-23.279    Z:0
    GeometryContactPoint    = X:-0.459        Y:-0.275    Z:116.828    Swoop

    Shadow                    = SHADOW_VOLUME
    BuildCompletion            = PLACED_BY_PLAYER
End


Object DwarvenFortressCitadel



    SelectPortrait         = BPDFortress
    ButtonImage            = BDFortress




    Draw = W3DScriptedModelDraw ModuleTag_MainDraw
        ExtraPublicBone = ARROW_01
        ExtraPublicBone = ARROW_02
        ExtraPublicBone = ARROW_03
        ExtraPublicBone = ARROW_04
        ExtraPublicBone = ARROW_05
        ExtraPublicBone = ARROW_06
        ExtraPublicBone = ARROW_07
        ExtraPublicBone = ARROW_08
        ExtraPublicBone = ARROW_09
        ExtraPublicBone = ARROW_10
        ExtraPublicBone = ARROW_11
        ExtraPublicBone = ARROW_12
        ExtraPublicBone = ARROW_13
        ExtraPublicBone = ARROW_14
        ExtraPublicBone = ARROW_15
        ExtraPublicBone = ARROW_16
        ExtraPublicBone = ARROW_17
        ExtraPublicBone = ARROW_18
        ExtraPublicBone = ARROW_19
        ExtraPublicBone = ARROW_20
        ExtraPublicBone = ARROW_21
        ExtraPublicBone = ARROW_22
        ExtraPublicBone = ARROW_23
        ExtraPublicBone = ARROW_24

        OkToChangeModelColor    = Yes
        StaticModelLODMode      = Yes

        DefaultModelConditionState
            Model               = DBFortress
            WeaponLaunchBone    = PRIMARY        ARROW_
            WeaponLaunchBone    = SECONDARY        BARRELOUT1
            WeaponLaunchBone    = TERTIARY        BARRELOUT2
            WeaponLaunchBone    = QUATERNARY    BARRELOUT3
            WeaponLaunchBone    = QUINARY        BARRELOUT4
        End


        AnimationState = BUILD_PLACEMENT_CURSOR
            BeginScript
                   CurDrawableHideSubObject("DBFBANNER")
                   CurDrawableHideSubObject("DBFSKEGS")
            EndScript
        End


        AnimationState = PHANTOM_STRUCTURE
            BeginScript
                   CurDrawableHideSubObject("DBFBANNER")
                   CurDrawableHideSubObject("DBFSKEGS")
            EndScript
        End


        ModelConditionState  = DAMAGED
            Model        = DBFortress
            Texture        = DBFortress1.tga DBFortress1_D.tga
        End

        AnimationState = DAMAGED
            EnteringStateFX    = FX_FortressDamaged
        End

        ModelConditionState  = REALLYDAMAGED
            Model            = DBFortress_D2
        End

        AnimationState    = REALLYDAMAGED
            Animation    = Fortress_ReallyDamaged
                AnimationName        = DBFortress_D2SK.DBFortress_D2AN
                AnimationMode        = ONCE
            End
            EnteringStateFX    = FX_FortressReallyDamaged
        End

        ModelConditionState  = RUBBLE
            Model            = DBFortress_D3
        End

        AnimationState    = RUBBLE
            Animation    = Fortress_ReallyDamaged
                AnimationName        = DBFortress_D3SK.DBFortress_D3AN
                AnimationMode        = ONCE
            End
            EnteringStateFX    = FX_FortressCollapse
        End


        ModelConditionState = UPGRADE_NUMENOR_STONEWORK
            Model        = DBFortress
            Texture        = DBFortress1.tga DBFortress_U.tga
        End






    End





    Draw = W3DScriptedModelDraw ModuleTag_MunitionsDraw
        OkToChangeModelColor    = Yes
        StaticModelLODMode        = Yes

        DefaultModelConditionState
            Model           = None
        End


        ModelConditionState = FORTRESS_IMPROVEMENT_1 USER_2 DAMAGED
            Model           = DBFFlam_A
            Texture            = DBFortress1.tga DBFortress1_D.tga
        End

        ModelConditionState = FORTRESS_IMPROVEMENT_1 USER_2 REALLYDAMAGED
            Model           = DBFFlam_A
            Texture            = DBFortress1.tga DBFortress1_D.tga
        End

        ModelConditionState = FORTRESS_IMPROVEMENT_1 USER_2
            Model           = DBFFlam_A
        End

        AnimationState = FORTRESS_IMPROVEMENT_1 USER_2
            Animation                    = RiseUp
                AnimationName            = DBFFlam_ASKL.DBFFlam_ABLD
                AnimationMode            = ONCE
            End
            ParticleSysBone     = SP001 DwfFortFlameDust
            Flags = START_FRAME_FIRST
        End


        ModelConditionState  = FORTRESS_IMPROVEMENT_1 DAMAGED
            Model        = DBFFlam
            Texture        = DBFortress1.tga DBFortress1_D.tga
        End

        ModelConditionState  = FORTRESS_IMPROVEMENT_1 REALLYDAMAGED
            Model            = DBFFlam_D2
        End

        AnimationState    = FORTRESS_IMPROVEMENT_1 REALLYDAMAGED
            Animation    = DBFFlam_ReallyDamaged
                AnimationName        = DBFFlam_D2SK.DBFFlam_D2AN
                AnimationMode        = ONCE
            End
        End

        ModelConditionState  = FORTRESS_IMPROVEMENT_1 RUBBLE
            Model            = DBFFlam_D3
        End

        AnimationState    = FORTRESS_IMPROVEMENT_1 RUBBLE
            Animation    = DBFFlam_ReallyDamaged
                AnimationName        = DBFFlam_D3SK.DBFFlam_D3AN
                AnimationMode        = ONCE
            End
        End


        ModelConditionState = FORTRESS_IMPROVEMENT_1
            Model                = DBFFlam
            ParticleSysBone     = glowBone01 SmokeDwfFort FollowBone:Yes
            ParticleSysBone     = glowBone02 SmokeDwfFort FollowBone:Yes
            ParticleSysBone     = glowBone01 SmokeDwfFire FollowBone:Yes
            ParticleSysBone     = glowBone02 SmokeDwfFire FollowBone:Yes
        End
    End



    Draw = W3DScriptedModelDraw ModuleTag_MainOilStruct

        StaticModelLODMode        = Yes

        DefaultModelConditionState
            Model           = None
        End


        ModelConditionState = FORTRESS_IMPROVEMENT_2 USER_3 DAMAGED
            Model           = DBFRBarrel_A
            Texture            = DBFortress1.tga DBFortress1_D.tga
        End

        ModelConditionState = FORTRESS_IMPROVEMENT_2 USER_3 REALLYDAMAGED
            Model           = DBFRBarrel_A
            Texture            = DBFortress1.tga DBFortress1_D.tga
        End

        ModelConditionState = FORTRESS_IMPROVEMENT_2 USER_3
            Model           = DBFRBarrel_A
        End

        AnimationState = FORTRESS_IMPROVEMENT_2 USER_3
            Animation                    = RiseUp
                AnimationName            = DBFRBarrel_ASK.DBFRBarrel_ABL
                AnimationMode            = ONCE
            End
        End


        ModelConditionState  = FORTRESS_IMPROVEMENT_2 DAMAGED
            Model        = DBFRBarrel
            Texture        = DBFortress1.tga DBFortress1_D.tga
        End

        ModelConditionState  = FORTRESS_IMPROVEMENT_2 REALLYDAMAGED
            Model            = DBFRBarrel_D2
        End

        AnimationState    = FORTRESS_IMPROVEMENT_2 REALLYDAMAGED
            Animation    = DBFRBarrel_ReallyDamaged
                AnimationName        = DBFRBarrel_D2S.DBFRBarrel_D2A
                AnimationMode        = ONCE
            End
        End

        ModelConditionState  = FORTRESS_IMPROVEMENT_2 RUBBLE
            Model            = DBFRBarrel_D3
        End

        AnimationState    = FORTRESS_IMPROVEMENT_2 RUBBLE
            Animation    = DBFRBarrel_ReallyDamaged
                AnimationName        = DBFRBarrel_D3S.DBFRBarrel_D3A
                AnimationMode        = ONCE
            End
        End


        ModelConditionState    = FORTRESS_IMPROVEMENT_2
            Model        = DBFRBarrel
        End
    End

    Draw = W3DScriptedModelDraw ModuleTag_OilDwarfDraw1
        AttachToBoneInAnotherModule = BARRELIN1

        DefaultModelConditionState
            Model           = None
        End

        ModelConditionState = FORTRESS_IMPROVEMENT_2
            Model           = DUBarrl_SKN
        End

        AnimationState            = SPECIAL_WEAPON_ONE UNPACKING FORTRESS_IMPROVEMENT_2
            Animation            = Pouring
                AnimationName    = DUBarrl_SKL.DUBarrl_BRLA
                AnimationMode   = ONCE
            End
            EnteringStateFX        = FX_OilCaskDropSound
        End

        AnimationState = FORTRESS_IMPROVEMENT_2
            Animation                    = UpAndStill
                AnimationName            = DUBarrl_SKL.DUBarrl_IDLA
                AnimationMode            = LOOP
            End
        End
    End

    Draw = W3DScriptedModelDraw ModuleTag_OilDwarfDraw2
        AttachToBoneInAnotherModule = BARRELIN2

        DefaultModelConditionState
            Model           = None
        End

        ModelConditionState = FORTRESS_IMPROVEMENT_2
            Model           = DUBarrl_SKN
        End

        AnimationState            = SPECIAL_WEAPON_ONE UNPACKING FORTRESS_IMPROVEMENT_2
            Animation            = Pouring
                AnimationName    = DUBarrl_SKL.DUBarrl_BRLA
                AnimationMode   = ONCE
            End
        End

        AnimationState = FORTRESS_IMPROVEMENT_2
            Animation                    = UpAndStill
                AnimationName            = DUBarrl_SKL.DUBarrl_IDLA
                AnimationMode            = LOOP
            End
        End
    End

    Draw = W3DScriptedModelDraw ModuleTag_OilDwarfDraw3
        AttachToBoneInAnotherModule = BARRELIN3

        DefaultModelConditionState
            Model           = None
        End

        ModelConditionState = FORTRESS_IMPROVEMENT_2
            Model           = DUBarrl_SKN
        End

        AnimationState            = SPECIAL_WEAPON_ONE UNPACKING FORTRESS_IMPROVEMENT_2
            Animation            = Pouring
                AnimationName    = DUBarrl_SKL.DUBarrl_BRLA
                AnimationMode   = ONCE
            End
        End

        AnimationState = FORTRESS_IMPROVEMENT_2
            Animation                    = UpAndStill
                AnimationName            = DUBarrl_SKL.DUBarrl_IDLA
                AnimationMode            = LOOP
            End
        End
    End

    Draw = W3DScriptedModelDraw ModuleTag_OilDwarfDraw4
        AttachToBoneInAnotherModule = BARRELIN4

        DefaultModelConditionState
            Model           = None
        End

        ModelConditionState = FORTRESS_IMPROVEMENT_2
            Model           = DUBarrl_SKN
        End

        AnimationState            = SPECIAL_WEAPON_ONE UNPACKING FORTRESS_IMPROVEMENT_2
            Animation            = Pouring
                AnimationName    = DUBarrl_SKL.DUBarrl_BRLA
                AnimationMode   = ONCE
            End
        End

        AnimationState = FORTRESS_IMPROVEMENT_2
            Animation                    = UpAndStill
                AnimationName            = DUBarrl_SKL.DUBarrl_IDLA
                AnimationMode            = LOOP
            End
        End
    End





    Draw = W3DScriptedModelDraw ModuleTag_MightyCatapultTowerDraw
        OkToChangeModelColor    = Yes
        StaticModelLODMode        = Yes

        DefaultModelConditionState
            Model           = None
        End


        ModelConditionState = UPGRADE_FORTRESS_MONUMENT USER_1 DAMAGED
            Model        = DBFGCap_A
            Texture        = DBFortress1.tga DBFortress1_D.tga
        End

        ModelConditionState = UPGRADE_FORTRESS_MONUMENT USER_1 REALLYDAMAGED
            Model        = DBFGCap_A
            Texture        = DBFortress1.tga DBFortress1_D.tga
        End

        ModelConditionState = UPGRADE_NUMENOR_STONEWORK UPGRADE_FORTRESS_MONUMENT USER_1
            Model        = DBFGCap_A
            Texture    = DBFortress1.tga DBFortress_U.tga
        End

        ModelConditionState = UPGRADE_FORTRESS_MONUMENT USER_1
            Model        = DBFGCap_A
        End

        AnimationState = UPGRADE_FORTRESS_MONUMENT USER_1
            Animation                        = RiseUp
                AnimationName                = DBFGCap_ASKL.DBFGCap_ABLD
                AnimationMode                = ONCE
                AnimationSpeedFactorRange    = 4.0 4.0
            End
        End


        ModelConditionState  = UPGRADE_FORTRESS_MONUMENT DAMAGED
            Model        = DBFGCap
            Texture        = DBFortress1.tga DBFortress1_D.tga
        End

        ModelConditionState  = UPGRADE_FORTRESS_MONUMENT REALLYDAMAGED
            Model            = DBFGCap_D2
        End

        AnimationState    = UPGRADE_FORTRESS_MONUMENT REALLYDAMAGED
            Animation    = DBFGCap_ReallyDamaged
                AnimationName        = DBFGCap_D2SKL.DBFGCap_D2AN
                AnimationMode        = ONCE
            End
        End

        ModelConditionState  = UPGRADE_FORTRESS_MONUMENT RUBBLE
            Model            = DBFGCap_D3
        End

        AnimationState    = UPGRADE_FORTRESS_MONUMENT RUBBLE
            Animation    = DBFGCap_ReallyDamaged
                AnimationName        = DBFGCap_D3SKL.DBFGCap_D3AN
                AnimationMode        = ONCE
            End
        End


        ModelConditionState = UPGRADE_NUMENOR_STONEWORK UPGRADE_FORTRESS_MONUMENT
            Model    = DBFGCap
            Texture    = DBFortress1.tga DBFortress_U.tga
        End


        ModelConditionState = UPGRADE_FORTRESS_MONUMENT
            Model           = DBFGCap
        End
    End



    Draw = W3DScriptedModelDraw ModuleTag_WahlDraw
        OkToChangeModelColor    = Yes
        StaticModelLODMode        = Yes

        DefaultModelConditionState
            Model           = None
        End


        ModelConditionState = FORTRESS_IMPROVEMENT_6 USER_6 DAMAGED
            Model           = dbfstatus_A
            Texture            = DBFortress1.tga DBFortress1_D.tga
        End

        ModelConditionState = FORTRESS_IMPROVEMENT_6 USER_6 REALLYDAMAGED
            Model           = dbfstatus_A
            Texture            = DBFortress1.tga DBFortress1_D.tga
        End

        ModelConditionState = FORTRESS_IMPROVEMENT_6 USER_6
            Model           = dbfstatus_A
        End

        AnimationState = FORTRESS_IMPROVEMENT_6 USER_6
            Animation                    = RiseUp
                AnimationName            = dbfstatus_ASKL.dbfstatus_ABLD
                AnimationMode            = ONCE
            End
            Flags = START_FRAME_FIRST
        End


        ModelConditionState  = FORTRESS_IMPROVEMENT_6 DAMAGED
            Model        = dbfstatus_D1
            Texture        = DBFortress1.tga DBFortress1_D.tga
        End

        ModelConditionState  = FORTRESS_IMPROVEMENT_6 REALLYDAMAGED
            Model            = dbfstatus_D2
        End

        AnimationState    = FORTRESS_IMPROVEMENT_6 REALLYDAMAGED
            Animation    = DBFFlam_ReallyDamaged
                AnimationName        = dbfstatus_D2SK.dbfstatus_D2AN
                AnimationMode        = ONCE
            End
        End

        ModelConditionState  = FORTRESS_IMPROVEMENT_6 RUBBLE
            Model            = dbfstatus_D3
        End

        AnimationState    = FORTRESS_IMPROVEMENT_6 RUBBLE
            Animation    = DBFFlam_ReallyDamaged
                AnimationName        = dbfstatus_D3SK.dbfstatus_D3AN
                AnimationMode        = ONCE
            End
        End


        ModelConditionState = FORTRESS_IMPROVEMENT_6
            Model                = dbfstatus
        End
    End



    Draw = W3DScriptedModelDraw ModuleTag_DrawDoor

        DefaultModelConditionState
            Model = DBFDoor_DRC
        End


        ModelConditionState   = DAMAGED DOOR_1_WAITING_OPEN
            Model        = DBFDoor_DRO
            Texture        = DBFortress1.tga DBFortress1_D.tga
        End

        ModelConditionState   = REALLYDAMAGED DOOR_1_WAITING_OPEN
            Model        = DBFDoor_DRO
            Texture        = DBFortress1.tga DBFortress1_D.tga
        End

        ModelConditionState = DAMAGED
            Model        = DBFDoor_DRC
            Texture        = DBFortress1.tga DBFortress1_D.tga
        End

        ModelConditionState = REALLYDAMAGED
            Model        = DBFDoor_DRC
            Texture        = DBFortress1.tga DBFortress1_D.tga
        End

        ModelConditionState = RUBBLE
            Model        = DBFDoor_D3
        End

        AnimationState    = RUBBLE
            Animation    = Door_ReallyDamaged
                AnimationName        = DBFDoor_D3.DBFDoor_D3
                AnimationMode        = ONCE
                AnimationBlendTime    = 50
            End
        End


        ModelConditionState   = DOOR_1_OPENING
            Model               = DBFDoor_DROA
        End

        AnimationState            =    DOOR_1_OPENING
            Animation           =    DBFDoor_DRO
                AnimationName   =    DBFDoor_DROA.DBFDoor_DROA
                AnimationMode   =    ONCE
                AnimationBlendTime = 0
            End

        End


        ModelConditionState   = DOOR_1_CLOSING
            Model               = DBFDoor_DRCA
                ParticleSysBone      = NONE trollCageDust
            End

               AnimationState            =    DOOR_1_CLOSING
                Animation           =    DBFDoor_DRCA
                    AnimationName   =    DBFDoor_DRCA.DBFDoor_DRCA
                    AnimationMode   =    ONCE
                    AnimationBlendTime = 0
                End

        End


        ModelConditionState   = DOOR_1_WAITING_OPEN
        Model               = DBFDoor_DRO

        End

        AnimationState            =    DOOR_1_WAITING_OPEN
        End

        ModelConditionState  = POST_RUBBLE
            Model         = None
        End

        ModelConditionState  = POST_COLLAPSE
            Model         = None
        End

    End


Draw = W3DFloorDraw ModuleTag_DrawFloor
	ModelName		= DBFortress_NBib
End



    DisplayName             = OBJECT:DwarvenFortress
    Description             = OBJECT:IsengardFortressDescription
    Side                    = Dwarves
    EditorSorting           = STRUCTURE
    ThreatLevel             = FORTRESS_THREAT_LEVEL
    CommandPointBonus       = MAIN_FORTRESS_COMMAND_POINT
    MaxSimultaneousOfType   = NEW_FORTRESS_RATIO
    BuildCost               = 5000
    BuildTime               = DEFAULT_FORTRESS_BUILDTIME
    VisionRange             = DEFAULT_FORTRESS_VISION_RANGE
    ShroudClearingRange     = DEFAULT_FORTRESS_SHROUD_CLEAR

    CommandSet              = DwarvenThronFortressCommandSet

    WeaponSet
        Conditions          = None
        Weapon              = PRIMARY  FortressStructureAxeWeapon
        AutoChooseSources   = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End

    ArmorSet
        Conditions          = None
        Armor               = DefaultFortressArmor
    End

    ArmorSet
        Conditions = PLAYER_UPGRADE
        Armor      = DefaultFortressArmorUpgraded
    End




    #include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

    EvaEventDieOwner         = EvaFortressDie

    SoundAmbient            = AmbientZwergeBerg

    VoiceSelect            = DwarvenFortressSelect

    SoundOnDamaged            = BuildingLightDamageStone
    SoundOnReallyDamaged        = BuildingHeavyDamageStone

    VoiceSelectUnderConstruction    = BuildingGoodVoiceSelectUnderConstruction

    UnitSpecificSounds
        UnderConstruction    = BuildingBigConstructionLoop

        UnderRepairFromRubble        = BuildingBigConstructionLoop
    End

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound:StatueHeroicBuildStoneDebris2 Animation:DBFGCAP_A.DBFGCAP_A Frames:116
        AnimationSound = Sound:StatueHeroicBuildStoneDebris1 Animation:DBFGCAP_A.DBFGCAP_A Frames:130
    End

    CampnessValue = CAMPNESS_FORTRESS



    RadarPriority       = STRUCTURE
     KindOf                = PRELOAD COMMANDCENTER VITAL_FOR_BASE_SURVIVAL STRUCTURE IMMOBILE CASTLE_KEEP MP_COUNT_FOR_VICTORY SELECTABLE FS_FACTORY AUTO_RALLYPOINT MADE_OF_WOOD SCORE DOZER_FACTORY
	
    Behavior            = GettingBuiltBehavior ModuleTag_GettingBuiltBehavior
        WorkerName    = DwarvenWorkerNoSelect
        SpawnTimer    = DEFAULT_STRUCTURE_HEALDELAY
    End

    Behavior = CastleMemberBehavior ModuleTag_CMB
        BeingBuiltSound = BuildingBigConstructionLoop
    End


    Behavior = AIUpdateInterface ModuleTag_SoWeCanUseWeapon
        AutoAcquireEnemiesWhenIdle    = Yes
        MoodAttackCheckRate        = 250
        AILuaEventsList            = AngmarStructuresFunctions
    End

    Behavior = PassiveAreaEffectBehavior ModuleTag_FeelGoodHero2
        EffectRadius            = 350
        PingDelay               = 2000
        UpgradeRequired         = Upgrade_TestBuilding_2
        ModifierName            = DainHallenUnitModifier
        AllowFilter             = GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
    End


    Behavior = ProductionUpdate ProductionUpdateModuleTag
		ProductionModifier
		RequiredUpgrade = Upgrade_ObjectUnderAIControl
		TimeMultiplier  = TIME_MULTIPLIER_AI_HEROES
		HeroRevive      = Yes
		ModifierFilter  = NONE +HERO
	End
	ProductionModifier
		RequiredUpgrade = Upgrade_BrutalAIMultiPlayer Upgrade_BrutalAISinglePlayer
		CostMultiplier  = COST_MULTIPLIER_AI_HEROES
		HeroPurchase    = Yes
		HeroRevive      = Yes
		ModifierFilter  = NONE +HERO
	End
        ProductionModifier
            RequiredUpgrade  = Upgrade_DwarvenFortressBanners
            CostMultiplier   = 0.80
            ModifierFilter   = NONE +DwarvenMinerMod_Dozer +DwarvenMinerMod_Festung
        End
        ProductionModifier
            RequiredUpgrade = Upgrade_DwarvenFortressBanners
            CostMultiplier  = 0.90
            TimeMultiplier  = 0.90
            HeroPurchase    = Yes
            ModifierFilter  = NONE +HERO
        End
        NumDoorAnimations            = 1
        DoorOpeningTime              = 3000
        DoorWaitOpenTime             = 3000
        DoorCloseTime                = 3000
    End

    Behavior = ObjectCreationUpgrade CreateTheDiscount
        TriggeredBy        = Upgrade_DwarvenFortressBanners
        Delay              = 0.0
        ThingToSpawn       = DiscountHeroObjectDwarves
        FadeInTime         = 100
    End

    Behavior = QueueProductionExitUpdate ModuleTag_QueuePEU
        UnitCreatePoint      = X:57.0 Y:0.0 Z:0.0
        NaturalRallyPoint    = X:109.0 Y:0.0 Z:0.0
        ExitDelay            = STANDARD_HERO_EXIT_DELAY
    End


    Body                = StructureBody ModuleTag_05
        MaxHealth                     = DEFAULT_FORTRESS_HEALTH
        MaxHealthDamaged              = DEFAULT_FORTRESS_HEALTH_DAMAGED
        MaxHealthReallyDamaged        = DEFAULT_FORTRESS_HEALTH_REALLY_DAMAGED
    End

    Behavior                  = StructureCollapseUpdate ModuleTag_08
        MinCollapseDelay        = 000
        MaxCollapseDelay        = 000
        CollapseDamping         = .5
        MaxShudder              = 0.6
        MinBurstDelay           = 250
        MaxBurstDelay           = 800
        BigBurstFrequency       = 4
        FXList                  = INITIAL   FX_StructureMediumCollapseNoSound
        FXList                  = ALMOST_FINAL  FX_StructureAlmostCollapse
        DestroyObjectWhenDone   = Yes
        CollapseHeight          = 155
    End

    Behavior = CitadelSlaughterHordeContain ModuleTag_SlaughterMe
	PassengerFilter			= GENERIC_FACTION_SLAUGHTERABLE
	ObjectStatusOfContained		= UNSELECTABLE ENCLOSED
	CashBackPercent			= 200%
	ContainMax			= 99
	AllowEnemiesInside		= No
	AllowAlliesInside		= No
 	AllowNeutralInside		= No
 	AllowOwnPlayerInsideOverride	= Yes
	EnterSound			= GUI_RingReturned
	EntryOffset			= X:125.0 Y:0.0 Z:0.0
	EntryPosition			= X:30.0 Y:0.0 Z:0.0
	ExitOffset			= X:125.0 Y:0.0 Z:0.0
     End

	#include "..\..\..\FortressRingFunc.inc"


    Behavior = SubObjectsUpgrade ModuleTag_HideAll
        TriggeredBy       = Upgrade_StructureLevel1
        HideSubObjects    = DBFSKEGS DBFRBARREL
    End

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_OilEnabler
        SpecialPowerTemplate = SpecialAbilityDwarvenFortressOilCasks
        TriggeredBy 	     = Upgrade_DwarvenFortressOilCasks
    End

    Behavior = SpecialPowerModule ModuleTag_OilStarter
        SpecialPowerTemplate      = SpecialAbilityDwarvenFortressOilCasks
        UpdateModuleStartsAttack  = Yes
        StartsPaused              = Yes
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_OilWeaponFireUpdate
        SpecialPowerTemplate     = SpecialAbilityDwarvenFortressOilCasks
        WhichSpecialWeapon       = 1
        UnpackTime               = 4600
        PackTime                 = 4600
        SpecialWeapon            = DwarvenFortressOilCasksWeapon
    End

    Behavior = AudioLoopUpgrade ModuleTag_OilCasksBuildLoop
        TriggeredBy          = Upgrade_DwarvenFortressOilCasks
        SoundToPlay          = BuildingConstructionLoop
        KillOnDeath          = Yes
        KillAfterMS          = 2500
        RequiresAllTriggers  = Yes
    End

    Behavior = ModelConditionUpgrade ModuleTag_ShowTheOil
        TriggeredBy            = Upgrade_DwarvenFortressOilCasks
        AddConditionFlags      = FORTRESS_IMPROVEMENT_2
        AddTempConditionFlag   = ModelConditionState:USER_3
        TempConditionTime      = 8.0
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowCasks
        TriggeredBy          = Upgrade_DwarvenFortressOilCasks
        ShowSubObjects       = DBFRBARREL
    End

    Behavior = AutoAbilityBehavior ModuleTag_AutoAbilityMurderOfCrowsBehavior
        SpecialAbility       = SpecialAbilityDwarvenFortressOilCasks
    End

    Behavior = CastleUpgrade ModuleTag_PassOutDwarvenStoneworkUpgrade
        TriggeredBy          = Upgrade_DwarvenFortressDwarvenStoneworkTrigger
        Upgrade              = Upgrade_DwarvenFortressDwarvenStonework
        WallUpgradeRadius    = DWARVEN_FORTRESS_WALL_EFFECTIVE_RADIUS
    End

    Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
        TriggeredBy          = Upgrade_DwarvenFortressDwarvenStonework
        AttributeModifier    = DwarvenStoneworkKeep_Bonus
    End

    Behavior = ModelConditionUpgrade ModuleTag_ShowTheStones
        TriggeredBy        = Upgrade_DwarvenFortressDwarvenStonework
        AddConditionFlags  = UPGRADE_NUMENOR_STONEWORK
        Permanent          = Yes
    End

    Behavior = ArmorUpgrade ModuleTag_ArmorUpgrade
        TriggeredBy             = Upgrade_DwarvenFortressDwarvenStonework
    End

    Behavior = ModelConditionUpgrade ModuleTag_ShowFlamingMunitions
        TriggeredBy          = Upgrade_DwarvenFortressFlamingMunitionsTrigger
        AddConditionFlags    = FORTRESS_IMPROVEMENT_1
        AddTempConditionFlag = ModelConditionState:USER_2
        TempConditionTime    = 8.0
    End
    Behavior = CastleUpgrade ModuleTag_PassOutFlamingMunitionsUpgrade
        TriggeredBy        = Upgrade_DwarvenFortressFlamingMunitionsTrigger
        Upgrade            = Upgrade_GoodFortressFlamingMunitions
    End

    Behavior = AudioLoopUpgrade ModuleTag_FlamingMunitionsBuildLoop
        TriggeredBy        = Upgrade_DwarvenFortressFlamingMunitionsTrigger
        SoundToPlay        = BuildingConstructionLoop
        KillOnDeath        = Yes
        KillAfterMS        = 3500
        RequiresAllTriggers = Yes
    End

    Behavior = StatusBitsUpgrade ModuleTag_FakeOut
        TriggeredBy        = Upgrade_GoodFortressFlamingMunitions
    End

    Behavior = AttributeModifierAuraUpdate ModuleTag_BannerLeadership
        StartsActive       = No
        BonusName          = MenFortressBannersLeadershipMod
        TriggeredBy        = Upgrade_DwarvenFortressBanners
        RefreshDelay       = 2000
        Range              = 300
        ObjectFilter       = GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowBanners
        TriggeredBy        = Upgrade_DwarvenFortressBanners
        ShowSubObjects     = DBFBANNER
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowKegs
        TriggeredBy        = Upgrade_DwarvenFortressSiegeKegs
        ShowSubObjects     = DBFSKEGS
    End

    Behavior = AttributeModifierUpgrade ModuleTag_KegsBonus
        TriggeredBy          = Upgrade_DwarvenFortressSiegeKegs
        AttributeModifier    = SiegeKegsKeep_Bonus
    End

    Behavior = PassiveAreaEffectBehavior ModuleTag_MysticFountainsHealing
        UpgradeRequired        = Upgrade_DwarvenFortressSiegeKegs
        EffectRadius           = 300
        PingDelay              = 2000
        HealPercentPerSecond   = 3%
        AllowFilter            = ANY +INFANTRY +CAVALRY +HERO -MACHINE +MONSTER -IMMOBILE +DOZER
        NonStackable           = Yes
        HealFX                 = FX_SpellHealUnitHealBuff
    End

    Behavior = BannerCarrierUpdate BannerCarrierUpdateModuleTag
        UpgradeRequired         = Upgrade_DwarvenFortressSiegeKegs
        IdleSpawnRate           = 5000
        UnitSpawnFX             = FX_BannerCarrierSpawnUnit

        ReplenishNearbyHorde    = Yes
        ScanHordeDistance       = 300
    End




    Behavior = ModelConditionUpgrade ModuleTag_ShowTheTower
        TriggeredBy            = Upgrade_DwarvenFortressMightyCatapult Upgrade_DwarvenFortressDwarvenStonework
        RequiresAllTriggers    = Yes
        AddConditionFlags      = UPGRADE_FORTRESS_MONUMENT
        AddTempConditionFlag   = ModelConditionState:USER_1
        TempConditionTime      = 10.0
    End


    Behavior = ObjectCreationUpgrade CatapultReady
        TriggeredBy          = Upgrade_DwarvenFortressMightyCatapult Upgrade_DwarvenFortressDwarvenStonework
        RequiresAllTriggers  = Yes
        Delay                = 8500
        GrantUpgrade         = Upgrade_DwarvenFortressMightyCatapultReady
    End

    Behavior = AudioLoopUpgrade ModuleTag_MightyCatapultBuildLoop
        TriggeredBy            = Upgrade_DwarvenFortressMightyCatapult Upgrade_DwarvenFortressDwarvenStonework
        SoundToPlay            = BuildingBigConstructionLoop
        KillOnDeath            = Yes
        KillAfterMS            = 8500
        RequiresAllTriggers    = Yes
    End

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_CatapultEnabler
        SpecialPowerTemplate    = SpecialAbilityMightyCatapultLauncher
        TriggeredBy             = Upgrade_DwarvenFortressMightyCatapultReady
    End

    Behavior = SpecialPowerModule ModuleTag_CatapultStarter
        SpecialPowerTemplate      = SpecialAbilityMightyCatapultLauncher
        UpdateModuleStartsAttack  = Yes
        StartsPaused              = Yes
        InitiateSound             = MightyCatapultStarterMS
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_SpireWeaponFireUpdate
        SpecialPowerTemplate    = SpecialAbilityMightyCatapultLauncher
        WhichSpecialWeapon      = 1
        UnpackTime              = 10
        PackTime                = 10
        SpecialWeapon           = DwarvenMightyCatapultFortressWeapon
        TriggerSound            = MightyCatapultRotateMS
        ApproachRequiresLOS     = No
    End

    Behavior = AutoAbilityBehavior ModuleTag_AutoAbilityLightningBehavior
	SpecialAbility		= SpecialAbilityMightyCatapultLauncher
	Query			= 30 ANY ENEMIES +INFANTRY +CAVALRY +STRUCTURE -WALL_UPGRADE -WALL_HUB -WALL_SEGMENT -DEFENSIVE_WALL
	Query			= 3 ANY ENEMIES +STRUCTURE -WALL_UPGRADE -WALL_HUB -WALL_SEGMENT -DEFENSIVE_WALL
	MaxScanRange		= DWARVEN_MIGHTYCATAPULT_RANGE
    End

    Behavior = GeometryUpgrade ModueTag_CatapultGeom
        TriggeredBy            = Upgrade_DwarvenFortressMightyCatapult Upgrade_DwarvenFortressDwarvenStonework
        RequiresAllTriggers    = Yes
        WallBoundsMesh         = P1
    End

    Behavior = ObjectCreationUpgrade FirstCatapult
        TriggeredBy            = Upgrade_DwarvenFortressMightyCatapult Upgrade_DwarvenFortressDwarvenStonework
        RequiresAllTriggers    = Yes
        Delay                  = 9000
        ThingToSpawn           = DwarvenFortressMightyCatapult
        Offset                 = X:0.0 Y:0.0 Z:155.0
        FadeInTime             = 600
    End

    Behavior = SlaveWatcherBehavior WatchTheTreb
    End

    Behavior = AISpecialPowerUpdate Fireball_AI
        CommandButtonName  = Command_FireWeaponMightyCatapult
        SpecialPowerAIType = AI_SPELLBOOK_ASSIST_BATTLE_DEBUFF
        SpecialPowerRadius = 100
        RandomizeTargetLocation = Yes
    End

    Behavior = GeometryUpgrade TowerGeom
        TriggeredBy         = Upgrade_DwarvenFortressMightyCatapult Upgrade_DwarvenFortressDwarvenStonework
        RequiresAllTriggers = Yes
        ShowGeometry        = HighTowerGeom
    End






    Behavior = ModelConditionUpgrade ModuleTag_ShowZwergenwahl
        TriggeredBy          = Upgrade_SubFactionIronHills Upgrade_SubFactionErebor Upgrade_SubFactionEredLuin
        AddConditionFlags    = FORTRESS_IMPROVEMENT_6
        AddTempConditionFlag = ModelConditionState:USER_6
        TempConditionTime    = 11.0
    End

    Behavior = AudioLoopUpgrade ModuleTag_WahlBuildLoop
        TriggeredBy            = Upgrade_SubFactionIronHills Upgrade_SubFactionErebor Upgrade_SubFactionEredLuin
        SoundToPlay            = BuildingConstructionLoop
        KillOnDeath            = Yes
        KillAfterMS            = 5000
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSet1
        TriggeredBy       = Upgrade_SubFactionErebor
        CommandSet        = DwarvenFortressmitZwergenreichCommandSet_Erebor
    End
    Behavior = CommandSetUpgrade ModuleTag_CommandSet2
        TriggeredBy       = Upgrade_SubFactionIronHills
        CommandSet        = DwarvenFortressmitZwergenreichCommandSet_Eisenberge
    End
    Behavior = CommandSetUpgrade ModuleTag_CommandSet3
        TriggeredBy       = Upgrade_SubFactionEredLuin
        CommandSet        = DwarvenFortressmitZwergenreichCommandSet_EredLuin
    End
	
    Behavior = ObjectCreationUpgrade ModuleTag_DwarvenRiches
        TriggeredBy  = Upgrade_SubFactionIronHills            
        Delay        = 600000
        GrantUpgrade = Upgrade_DwarvenRiches
    End
	
	Behavior = CommandSetUpgrade ModuleTag_CommandSet4
        TriggeredBy       = Upgrade_DwarvenRiches
        CommandSet        = DwarvenFortressmitZwergenreichCommandSet_Eisenberge2
    End
	
	Behavior = SpecialPowerModule ModuleTag_DwarvenRichesStarter
        SpecialPowerTemplate     = SpecialAbilityDwarvenRiches
        StartsPaused             = No
        UpdateModuleStartsAttack = Yes
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_DwarvenRichesWeapon
        SpecialPowerTemplate       = SpecialAbilityDwarvenRiches
        WhichSpecialWeapon         = 3
        SkipContinue               = Yes
        UnpackTime                 = 700
        PreparationTime            = 1
        PackTime                   = 100
        AwardXPForTriggering       = 0
        StartAbilityRange          = 99999
        SpecialWeapon              = DwarvenRichesWeapon
        TriggerSound               = SpellSunflare2
    End

	Behavior = ObjectCreationUpgrade ModuleTag_MinesOfMoria
        TriggeredBy  = Upgrade_SubFactionErebor
		Delay		 = 1000
        GrantUpgrade = Upgrade_MinesOfMoria
    End
	Behavior = CostModifierUpgrade ModuleTag_CostModifier
		StartsActive			  = No
        TriggeredBy               = Upgrade_MinesOfMoria
        ObjectFilter              = ANY +KhazadMine_Independant +KhazadMine +KhazadMine_Interface +DwarvenWerkstatt +DwarvenWerkstattWallSegment 
        Percentage                = -50%
    End
	
    Behavior = SubObjectsUpgrade Armor_Upgrade1
        TriggeredBy          = Upgrade_SubFactionIronHills
        UpgradeTexture       = EUDwarfmin.tga 0 EUDwarfmin_eisen.tga
        UpgradeTexture       = eudwarfeng.tga 0 eudwarfeng_eisen.tga
        UpgradeTexture       = eudwarfram_eng.tga 0 eudwarfram_eisen.tga
    End

    Behavior = SubObjectsUpgrade Armor_Upgrade2
        TriggeredBy          = Upgrade_SubFactionErebor
        UpgradeTexture       = EUDwarfmin.tga 0 EUDwarfmin_ereb.tga
        UpgradeTexture       = eudwarfeng.tga 0 eudwarfeng_ereb.tga
        UpgradeTexture       = eudwarfram_eng.tga 0 eudwarfram_ereb.tga
    End

    Behavior = SubObjectsUpgrade Armor_Upgrade3
        TriggeredBy          = Upgrade_SubFactionEredLuin
        UpgradeTexture       = EUDwarfmin.tga 0 EUDwarfmin_ered.tga
        UpgradeTexture       = eudwarfeng.tga 0 eudwarfeng_ered.tga
        UpgradeTexture       = eudwarfram_eng.tga 0 eudwarfram_ered.tga
    End

    Behavior = SubObjectsUpgrade Armor_UpgradeLangbarte
        TriggeredBy       = Upgrade_SubFactionErebor
        UpgradeTexture    = duaxdban1.tga 0 duereborban.tga
    End

    Behavior = SubObjectsUpgrade Armor_UpgradeFeuerbarte
        TriggeredBy       = Upgrade_SubFactionIronHills
        UpgradeTexture    = duaxdban1.tga 0 dueisenban.tga
    End

    Behavior = SubObjectsUpgrade Armor_UpgradeBreitschultern
        TriggeredBy       = Upgrade_SubFactionEredLuin
        UpgradeTexture    = duaxdban1.tga 0 dueredluinban.tga
    End


    Behavior = AutoDepositUpdate AutoDepositModuleTag
        DepositTiming           = GENERIC_KEEP_MONEY_TIME
        DepositAmount           = GENERIC_KEEP_MONEY_AMOUNT
        InitialCaptureBonus     = 0
    End

    Behavior = TerrainResourceBehavior ModuleTag_NewMoneyDeadSpot
        Radius            = GENERIC_KEEP_MONEY_RANGE
        MaxIncome         = 0
        IncomeInterval    = 999999
        HighPriority      = Yes
        Visible           = No
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI1
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 320000
        GrantUpgrade = Upgrade_DwarvenFortressBanners
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI2
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 700000
        GrantUpgrade = Upgrade_DwarvenFortressSiegeKegs
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI3
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 1000000
        GrantUpgrade = Upgrade_GoodFortressFlamingMunitionsTrigger
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI4
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 1400000
        GrantUpgrade = Upgrade_DwarvenFortressOilCasks
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI5
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 1700000
        GrantUpgrade = Upgrade_DwarvenFortressDwarvenStoneworkTrigger
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI6
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 2000000
        GrantUpgrade = Upgrade_DwarvenFortressMightyCatapult
    End

    Behavior = FireWeaponUpdate FireWeaponUpdateModuleTagWOTR
        FireWeaponNugget
            WeaponName = DwarvesFortressWotrWeapon
            FireDelay  = 0
            OneShot    = No
        End
    End

    Geometry                  = BOX
    GeometryMajorRadius       = 66
    GeometryMinorRadius       = 50
    GeometryHeight            = 60

    AdditionalGeometry        = BOX
    GeometryMajorRadius       = 16
    GeometryMinorRadius       = 14
    GeometryHeight            = 115
    GeometryOffset            = X:-38 Y:-38 Z:0

    AdditionalGeometry        = BOX
    GeometryMajorRadius       = 16
    GeometryMinorRadius       = 14
    GeometryHeight            = 115
    GeometryOffset            = X:35 Y:-38 Z:0

    AdditionalGeometry        = BOX
    GeometryMajorRadius       = 16
    GeometryMinorRadius       = 14
    GeometryHeight            = 115
    GeometryOffset            = X:-38 Y:38 Z:0

    AdditionalGeometry        = BOX
    GeometryMajorRadius       = 16
    GeometryMinorRadius       = 14
    GeometryHeight            = 115
    GeometryOffset            = X:35 Y:38 Z:0

    AdditionalGeometry        = BOX
    GeometryMajorRadius       = 12
    GeometryMinorRadius       = 30
    GeometryHeight            = 50
    GeometryOffset            = X:78 Y:0 Z:0

    AdditionalGeometry        = BOX
    GeometryMajorRadius       = 12
    GeometryMinorRadius       = 30
    GeometryHeight            = 50
    GeometryOffset            = X:-78 Y:0 Z:0

    AdditionalGeometry        = BOX
    GeometryName              = HighTowerGeom
    GeometryMajorRadius       = 12
    GeometryMinorRadius       = 12
    GeometryHeight            = 150
    GeometryOffset            = X:0 Y:0 Z:0
    GeometryUsedForHealthBox  = No

    GeometryIsSmall           = No
    Shadow                    = SHADOW_VOLUME
    BuildCompletion           = PLACED_BY_PLAYER

    GeometryContactPoint = X:-104    Y:79     Z:0      Repair
    GeometryContactPoint = X:41      Y:-42    Z:0
    GeometryContactPoint = X:41      Y:-42    Z:45
    GeometryContactPoint = X:-41     Y:-42    Z:45
    GeometryContactPoint = X:-41     Y:-42    Z:0
    GeometryContactPoint = X:-80     Y:0      Z:0
    GeometryContactPoint = X:-80     Y:0      Z:45
    GeometryContactPoint = X:-41     Y:42     Z:45
    GeometryContactPoint = X:-41     Y:42     Z:0
    GeometryContactPoint = X:41      Y:42     Z:0
    GeometryContactPoint = X:41      Y:42     Z:45
    GeometryContactPoint = X:80      Y:0      Z:45
    GeometryContactPoint = X:80      Y:0      Z:0
    GeometryContactPoint = X:0       Y:0      Z:180    Swoop
End


Object DBFortressFloor


    Draw = W3DFloorDraw ModuleTag_01
        ModelName = dwarfboden
        ForceToBack = Yes
    End




  DisplayName       = OBJECT:CastFloor
  Side              = Dwarves
  EditorSorting     = STRUCTURE

  ArmorSet
    Conditions      = None
    Armor           = NoArmor
    DamageFX        = None
  End



  KindOf            = STRUCTURE IMMOBILE NO_COLLIDE UNATTACKABLE INERT
  RadarPriority     = NOT_ON_RADAR

  Body              = ImmortalBody ModuleTag_03
    MaxHealth       = 6000.0
  End

  Behavior          = CastleMemberBehavior ModuleTag_CMB
  End




  Behavior          = SlowDeathBehavior ModuleTag_SlowDeathWithoutRubble
      DestructionDelay  = 1000
  End

  Geometry              = BOX
  GeometryMajorRadius   = 0.8
  GeometryMinorRadius   = 0.8
  GeometryHeight        = 0.8
  GeometryIsSmall       = Yes
End






Object DwarvenFortress

    SelectPortrait = BPDFortress

    Draw   = W3DScriptedModelDraw ModuleTag_01
        OkToChangeModelColor    = Yes
        StaticModelLODMode        = Yes

        DefaultModelConditionState
            Model           = None
        End

        IdleAnimationState
        End


        ModelConditionState = WORLD_BUILDER
            Model    = DBFortress
        End


        ModelConditionState = BUILD_PLACEMENT_CURSOR
            Model    = None
        End


        ModelConditionState =  PHANTOM_STRUCTURE
            Model    = DBFortress
        End


        AnimationState = BUILD_PLACEMENT_CURSOR
            BeginScript
                   CurDrawableHideSubObject("DBFBANNER")
                   CurDrawableHideSubObject("DBFSKEGS")
            EndScript
        End


        AnimationState = PHANTOM_STRUCTURE
            BeginScript
                   CurDrawableHideSubObject("DBFBANNER")
                   CurDrawableHideSubObject("DBFSKEGS")
            EndScript
        End

        ModelConditionState  = RUBBLE
            Model            = DBFortress_D3
        End

        AnimationState    = RUBBLE
            Animation    = Fortress_ReallyDamaged
                AnimationName        = DBFortress_D3SK.DBFortress_D3AN
                AnimationMode        = ONCE
            End
            EnteringStateFX    = FX_FortressCollapse
        End






        ModelConditionState = ACTIVELY_BEING_CONSTRUCTED
            Model            = DBFortress_A
        End

        AnimationState = ACTIVELY_BEING_CONSTRUCTED
            Animation                    = UpAndStill
                AnimationName            = DBFortress_ASK.DBFortress_ABL
                AnimationMode            = MANUAL
            End
            ParticleSysBone = NONE BuildingContructDustCastles FollowBone:Yes
            ParticleSysBone = NONE FortressDwarves FollowBone:Yes
            StateName        = BeingConstructed
            BeginScript
                CurDrawablePlaySound("GondorBarracksBeginConstruction")
            EndScript
        End
    End


    Draw = W3DScriptedModelDraw ModuleTag_DrawDoor

        DefaultModelConditionState
            Model = None
        End


        ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED
            Model               = DBFDoor_A
        End

        AnimationState        = ACTIVELY_BEING_CONSTRUCTED
            Animation           = DBFDoor_A
                AnimationName     = DBFDoor_A.DBFDoor_A
                AnimationMode     = MANUAL
            End
        End
    End

    ArmorSet
        Conditions      = None
        Armor           = DefaultFortressArmor
        DamageFX        = EmptyDamageFX
    End

    Side                = Dwarves
    EditorSorting       = STRUCTURE

    PlacementViewAngle    = -45
    MaxSimultaneousOfType = NEW_FORTRESS_RATIO
    BuildCost           = DWARVEN_FORTRESS_BUILDCOST
    BuildTime           = DEFAULT_FORTRESS_BUILDTIME




    AutoResolveUnitType = AutoResolveUnit_Fortress

        AutoResolveBody = AutoResolve_DwarvenFortressBody

        AutoResolveArmor
            Armor = AutoResolve_DwarvenFortressArmor
        End

        AutoResolveWeapon
            Weapon = AutoResolve_DwarvenFortressWeapon
        End

    DisplayName         = OBJECT:DwarvenFortress



    #include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

    VoiceSelect                        = DwarvenFortressSelect

    SoundOnDamaged                    = BuildingLightDamageStone
    SoundOnReallyDamaged            = BuildingHeavyDamageStone

    VoiceSelectUnderConstruction    = BuildingGoodVoiceSelectUnderConstruction
    VoiceFullyCreated                = EVA:FortressComplete-Builder-Dwarf

    UnitSpecificSounds
        UnderConstruction            = BuildingBigConstructionLoop

        UnderRepairFromRubble        = BuildingBigConstructionLoop
    End

    ClientBehavior = ModelConditionAudioLoopClientBehavior ModuleTag_PlayCollapseSound
        ModelCondition = REQUIRED:RUBBLE Sound:BuildingSink
    End


    RadarPriority       = STRUCTURE
    KindOf              = STRUCTURE WALK_ON_TOP_OF_WALL INERT NO_COLLIDE SELECTABLE IMMOBILE BASE_FOUNDATION MP_COUNT_FOR_VICTORY BASE_SITE CAN_SEE_THROUGH_STRUCTURE LIVING_WORLD_BUILDING_MIRROR

    Body                = StructureBody ModuleTag_05
        MaxHealth                    = DEFAULT_FORTRESS_HEALTH
    End

    Behavior = CastleBehavior ModuleTag_castle

        CastleToUnpackForFaction    = Dwarves FORTRESS_DWARVEN
        CastleToUnpackForFaction    = Dwarves FORTRESS_DWARVEN
        CastleToUnpackForFaction    = Arnor FORTRESS_DWARVEN
        CastleToUnpackForFaction    = Rohan FORTRESS_DWARVEN
        CastleToUnpackForFaction    = Elves FORTRESS_DWARVEN
        CastleToUnpackForFaction    = Imladris FORTRESS_DWARVEN
        CastleToUnpackForFaction    = Mordor FORTRESS_DWARVEN
        CastleToUnpackForFaction    = Isengard FORTRESS_DWARVEN
        CastleToUnpackForFaction    = Wild FORTRESS_DWARVEN
        CastleToUnpackForFaction    = Angmar FORTRESS_DWARVEN


        FilterValidOwnedEntries        = ANY +STRUCTURE +WALK_ON_TOP_OF_WALL +BASE_FOUNDATION +TACTICAL_MARKER

        MaxCastleRadius             = 130.0
        InstantUnpack                = Yes
        KeepDeathKillsEverything    = Yes
        UnpackDelayTime                = 0.0

        EvaEnemyCastleSightedEvent = EnemyFortressSighted
    End

    Behavior = StructureCollapseUpdate ModuleTag_Collapse
        MinCollapseDelay        = 000
        MaxCollapseDelay        = 000
        CollapseDamping         = .5
        MaxShudder              = 0.6
        MinBurstDelay           = 250
        MaxBurstDelay           = 800
        BigBurstFrequency       = 4
        FXList                  = INITIAL   FX_StructureMediumCollapse
        FXList                  = ALMOST_FINAL  FX_StructureAlmostCollapse
        DestroyObjectWhenDone    = Yes
        CollapseHeight            = 120
    End

    Behavior            = GettingBuiltBehavior ModuleTag_GettingBuiltBehavior
        WorkerName    = DwarvenWorkerNoSelect
        SpawnTimer    = DEFAULT_STRUCTURE_HEALDELAY
    End

    Behavior = AIUpdateInterface ModuleTag_AI
        AILuaEventsList        =    FortressFunctions
    End

End



Object DwarvenFortressKampagne

    SelectPortrait = BPDFortress

    Draw   = W3DScriptedModelDraw ModuleTag_01
        OkToChangeModelColor    = Yes
        StaticModelLODMode        = Yes

        DefaultModelConditionState
            Model           = None
        End

        IdleAnimationState
        End


        ModelConditionState = WORLD_BUILDER
            Model    = DBFortress
        End


        ModelConditionState = BUILD_PLACEMENT_CURSOR
            Model    = None
        End


        ModelConditionState =  PHANTOM_STRUCTURE
            Model    = DBFortress
        End


        AnimationState = BUILD_PLACEMENT_CURSOR
            BeginScript
                   CurDrawableHideSubObject("DBFBANNER")
                   CurDrawableHideSubObject("DBFSKEGS")
            EndScript
        End


        AnimationState = PHANTOM_STRUCTURE
            BeginScript
                   CurDrawableHideSubObject("DBFBANNER")
                   CurDrawableHideSubObject("DBFSKEGS")
            EndScript
        End

        ModelConditionState  = RUBBLE
            Model            = DBFortress_D3
        End

        AnimationState    = RUBBLE
            Animation    = Fortress_ReallyDamaged
                AnimationName        = DBFortress_D3SK.DBFortress_D3AN
                AnimationMode        = ONCE
            End
            EnteringStateFX    = FX_FortressCollapse
        End

        ModelConditionState = ACTIVELY_BEING_CONSTRUCTED
            Model            = DBFortress_A
        End

        AnimationState = ACTIVELY_BEING_CONSTRUCTED
            Animation                    = UpAndStill
                AnimationName            = DBFortress_ASK.DBFortress_ABL
                AnimationMode            = MANUAL
            End
            ParticleSysBone = NONE BuildingContructDustCastles FollowBone:Yes
            ParticleSysBone = NONE FortressDwarves FollowBone:Yes
            StateName        = BeingConstructed
            BeginScript
                CurDrawablePlaySound("GondorBarracksBeginConstruction")
            EndScript
        End
    End


    Draw = W3DScriptedModelDraw ModuleTag_DrawDoor

        DefaultModelConditionState
            Model = None
        End


        ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED
            Model               = DBFDoor_A
        End

        AnimationState        = ACTIVELY_BEING_CONSTRUCTED
            Animation           = DBFDoor_A
                AnimationName     = DBFDoor_A.DBFDoor_A
                AnimationMode     = MANUAL
            End
        End
    End

    ArmorSet
        Conditions      = None
        Armor           = DefaultFortressArmor
        DamageFX        = EmptyDamageFX
    End

    Side                  = Dwarves
    EditorSorting         = STRUCTURE
    MaxSimultaneousOfType = NEW_FORTRESS_RATIO
    PlacementViewAngle    = -45

    BuildCost             = DWARVEN_FORTRESS_BUILDCOST
    BuildTime             = DEFAULT_FORTRESS_BUILDTIME



    AutoResolveUnitType = AutoResolveUnit_Fortress

        AutoResolveBody = AutoResolve_DwarvenFortressBody

        AutoResolveArmor
            Armor = AutoResolve_DwarvenFortressArmor
        End

        AutoResolveWeapon
            Weapon = AutoResolve_DwarvenFortressWeapon
        End

    DisplayName         = OBJECT:DwarvenFortress



    #include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

    VoiceSelect                      = DwarvenFortressSelect

    SoundOnDamaged                   = BuildingLightDamageStone
    SoundOnReallyDamaged             = BuildingHeavyDamageStone

    VoiceSelectUnderConstruction     = BuildingGoodVoiceSelectUnderConstruction
    VoiceFullyCreated                = EVA:FortressComplete-Builder-Dwarf

    UnitSpecificSounds
        UnderConstruction            = BuildingBigConstructionLoop
        UnderRepairFromRubble        = BuildingBigConstructionLoop
    End

    ClientBehavior = ModelConditionAudioLoopClientBehavior ModuleTag_PlayCollapseSound
        ModelCondition = REQUIRED:RUBBLE Sound:BuildingSink
    End


    RadarPriority       = STRUCTURE
    KindOf              = STRUCTURE SELECTABLE IMMOBILE BASE_FOUNDATION MP_COUNT_FOR_VICTORY BASE_SITE CAN_SEE_THROUGH_STRUCTURE LIVING_WORLD_BUILDING_MIRROR

    Body                = StructureBody ModuleTag_05
        MaxHealth                    = DEFAULT_FORTRESS_HEALTH
    End

    Behavior = CastleBehavior ModuleTag_castle
        CastleToUnpackForFaction    = Dwarves zwergenfestung
        CastleToUnpackForFaction    = Dwarves zwergenfestung
        CastleToUnpackForFaction    = Arnor zwergenfestung
        CastleToUnpackForFaction    = Rohan zwergenfestung
        CastleToUnpackForFaction    = Elves zwergenfestung
        CastleToUnpackForFaction    = Imladris zwergenfestung
        CastleToUnpackForFaction    = Mordor zwergenfestung
        CastleToUnpackForFaction    = Isengard zwergenfestung
        CastleToUnpackForFaction    = Wild zwergenfestung
        CastleToUnpackForFaction    = Angmar zwergenfestung

        FilterValidOwnedEntries        = ANY +STRUCTURE +WALK_ON_TOP_OF_WALL +BASE_FOUNDATION +TACTICAL_MARKER

        MaxCastleRadius             = 130.0
        InstantUnpack               = Yes
        KeepDeathKillsEverything    = Yes
        UnpackDelayTime             = 0.0

        EvaEnemyCastleSightedEvent = EnemyFortressSighted
    End

    Behavior = StructureCollapseUpdate ModuleTag_Collapse
        MinCollapseDelay        = 000
        MaxCollapseDelay        = 000
        CollapseDamping         = .5
        MaxShudder              = 0.6
        MinBurstDelay           = 250
        MaxBurstDelay           = 800
        BigBurstFrequency       = 4
        FXList                  = INITIAL   FX_StructureMediumCollapse
        FXList                  = ALMOST_FINAL  FX_StructureAlmostCollapse
        DestroyObjectWhenDone    = Yes
        CollapseHeight            = 120
    End

    Behavior            = GettingBuiltBehavior ModuleTag_GettingBuiltBehavior
        WorkerName    = DwarvenWorkerNoSelect
        SpawnTimer    = DEFAULT_STRUCTURE_HEALDELAY
    End



    Behavior = AIUpdateInterface ModuleTag_AI
        AILuaEventsList        =    FortressFunctions
    End


    Geometry                  = BOX
    GeometryMajorRadius       = 81
    GeometryMinorRadius       = 65
    GeometryHeight            = 60


    AdditionalGeometry        = BOX
    GeometryName            = Plots
    GeometryMajorRadius        = 10.0
    GeometryMinorRadius        = 10.0
    GeometryHeight            = 0.8
    GeometryOffset            = X:94.80 Y:-61.75 Z:0

    AdditionalGeometry        = BOX
    GeometryName            = Plots
    GeometryMajorRadius        = 10.0
    GeometryMinorRadius        = 10.0
    GeometryHeight            = 0.8
    GeometryOffset            = X:0 Y:-90.0 Z:0

    AdditionalGeometry        = BOX
    GeometryName            = Plots
    GeometryMajorRadius        = 10.0
    GeometryMinorRadius        = 10.0
    GeometryHeight            = 0.8
    GeometryOffset            = X:-94.80 Y:-61.75 Z:0

    AdditionalGeometry        = BOX
    GeometryName            = Plots
    GeometryMajorRadius        = 10.0
    GeometryMinorRadius        = 10.0
    GeometryHeight            = 0.8
    GeometryOffset            = X:-94.80 Y:61.75 Z:0

    AdditionalGeometry        = BOX
    GeometryName            = Plots
    GeometryMajorRadius        = 10.0
    GeometryMinorRadius        = 10.0
    GeometryHeight            = 0.8
    GeometryOffset            = X:0 Y:90.0 Z:0

    AdditionalGeometry        = BOX
    GeometryName            = Plots
    GeometryMajorRadius        = 10.0
    GeometryMinorRadius        = 10.0
    GeometryHeight            = 0.8
    GeometryOffset            = X:94.80 Y:61.75 Z:0

    GeometryIsSmall            = No
    Shadow                    = SHADOW_VOLUME

    GeometryContactPoint = X:-104    Y:79    Z:0            Repair

End

