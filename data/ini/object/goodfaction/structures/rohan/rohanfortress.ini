Object RohanFortressCenterGeneric

    SelectPortrait = BRRohanfestung

    Draw = W3DScriptedModelDraw ModuleTag_01

        DefaultModelConditionState
              Model = None
        End

        ModelConditionState = WORLD_BUILDER
            Model = NBasePin
        End
    End

    Side            = Rohan
    EditorSorting    = STRUCTURE
    KindOf            = IMMOBILE BASE_FOUNDATION CASTLE_CENTER

    Behavior = CastleBehavior ModuleTag_castle

        FilterValidOwnedEntries = ANY +STRUCTURE +WALK_ON_TOP_OF_WALL +BASE_FOUNDATION +TACTICAL_MARKER
    End
End


Object RohanFortressExpansionPadCorner

    SelectPortrait = BPRCamp_Plot

    Draw = W3DFloorDraw DrawFloorBase
        ModelName = rbfoundation
    End

    Draw = W3DScriptedModelDraw ModuleTag_DrawMain
        DefaultModelConditionState
            Model = WBFoundationP
        End

        ModelConditionState = CONSTRUCTION_COMPLETE
            Model = None
        End
    End

    PlacementViewAngle  = 45


    DisplayName         = OBJECT:ElvenBuildingFoundation
    Side                = Rohan
    EditorSorting       = STRUCTURE
    ThreatLevel            = 1.0

    BuildCost           = 1
    BuildTime           = 5.0
    VisionRange         = 0.0
    ShroudClearingRange = 0

    CommandSet = RohanFortressExpansionPadCornerCommandSet



    VoiceSelect = Gui_PlotSelect2



    KindOf              = STRUCTURE SELECTABLE IMMOBILE BASE_FOUNDATION UNATTACKABLE MP_COUNT_FOR_VICTORY NO_COLLIDE DO_NOT_CLASSIFY EXPANSION_PAD

    Behavior        = FoundationAIUpdate ModuleTag_foundationAI
        BuildVariation    = 2
    End

    Behavior = CastleMemberBehavior ModuleTag_CMB
    End

    Body                = ImmortalBody ModuleTag_05
        MaxHealth         = DEFAULT_FORTRESS_HEALTH
    End

    Geometry                = CYLINDER
    GeometryMajorRadius        = 15.0
    GeometryMinorRadius        = 15.0
    GeometryHeight            = 0.8
    GeometryIsSmall            = No
    Shadow                    = SHADOW_VOLUME
    BuildCompletion            = PLACED_BY_PLAYER
End

ChildObject RohanFortressExpansionPadSide RohanFortressExpansionPadCorner

    CommandSet = RohanFortressExpansionPadSideCommandSet

End


Object RohanCitadel

Draw = W3DFloorDraw ModuleTag_DrawFortressFloor
    ModelName			= FL_ROHAN
    StartHidden 		= No
    HideIfModelConditions	= AWAITING_CONSTRUCTION
    HideIfModelConditions	= PARTIALLY_CONSTRUCTED
    ForceToBack 		= Yes
    FloorFadeRateOnObjectDeath  = -0.01
End

    SelectPortrait = BRRohanfestung

  Draw = W3DScriptedModelDraw ModuleTag_Draw
        ExtraPublicBone         = ARROW_01
        ExtraPublicBone         = ARROW_02
        ExtraPublicBone         = ARROW_03
        ExtraPublicBone         = ARROW_04
        ExtraPublicBone         = ARROW_05
        ExtraPublicBone         = ARROW_06
        ExtraPublicBone         = ARROW_07
        ExtraPublicBone         = ARROW_08
        ExtraPublicBone         = ARROW_09
        ExtraPublicBone         = ARROW_10
        ExtraPublicBone         = ARROW_11
        ExtraPublicBone         = ARROW_12
        ExtraPublicBone         = ARROW_13
        ExtraPublicBone         = ARROW_14
        ExtraPublicBone         = ARROW_15
        ExtraPublicBone         = ARROW_16
        ExtraPublicBone         = ARROW_17
        ExtraPublicBone         = ARROW_18
        ExtraPublicBone         = ARROW_19
        ExtraPublicBone         = ARROW_20
        OkToChangeModelColor = Yes
        StaticModelLODMode   = Yes

    DefaultModelConditionState
      Model = rbrohfestunga
    End

        AnimationState = BUILD_PLACEMENT_CURSOR
            BeginScript
                   CurDrawableHideSubObject("FLAGGEN")
                   CurDrawableHideSubObject("GBFFLAMING")
                   CurDrawableHideSubObject("STONEWALL")
                   CurDrawableHideSubObject("FLAMES")
            EndScript
        End

        AnimationState = PHANTOM_STRUCTURE
            BeginScript
                   CurDrawableHideSubObject("FLAGGEN")
                   CurDrawableHideSubObject("GBFFLAMING")
                   CurDrawableHideSubObject("STONEWALL")
                   CurDrawableHideSubObject("FLAMES")
            EndScript
        End

    ModelConditionState   = AWAITING_CONSTRUCTION SNOW
      Model = rbrohfestung_b
        Texture  = exfiretorchseq.tga exfiretorchseq.tga
        Texture  = gbhd1.tga gbhd1_snow.tga
        Texture  = gbwall_bib.tga gbwall_bib_snow.tga
        Texture  = rbcastkeep.tga rbcastkeep_snow.tga
        Texture  = rbhdgate.tga rbhdgate.tga
        Texture  = rbwatchtow.tga rbwatchtow_snow.tga
        Texture  = ru_banr_house.tga ru_banr_house.tga
        Texture  = iuscaffs.tga iuscaffs.tga
    End
    ModelConditionState   = AWAITING_CONSTRUCTION
      Model = rbrohfestung_b
    End
    AnimationState        = AWAITING_CONSTRUCTION
      Animation           =  rbrohfestung_b
        AnimationName     =  rbrohfestung_b.rbrohfestung_b
        AnimationMode     = MANUAL
        AnimationBlendTime = 0
      End
      Flags                  = START_FRAME_FIRST
    End

    ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED SNOW
      Model = rbrohfestung_b
        Texture  = exfiretorchseq.tga exfiretorchseq.tga
        Texture  = gbhd1.tga gbhd1_snow.tga
        Texture  = gbwall_bib.tga gbwall_bib_snow.tga
        Texture  = rbcastkeep.tga rbcastkeep_snow.tga
        Texture  = rbhdgate.tga rbhdgate.tga
        Texture  = rbwatchtow.tga rbwatchtow_snow.tga
        Texture  = ru_banr_house.tga ru_banr_house.tga
        Texture  = iuscaffs.tga iuscaffs.tga
        ParticleSysBone   = CONSTDUSTBONE01 BuildingContructDust FollowBone:Yes
    End
    ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
      Model               = rbrohfestung_b
        ParticleSysBone   = CONSTDUSTBONE01 BuildingContructDust FollowBone:Yes
    End
    AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
        Animation           = rbrohfestung_b
            AnimationName     = rbrohfestung_b.rbrohfestung_b
            AnimationMode     = MANUAL
            AnimationBlendTime = 0
        End
        Flags                  = START_FRAME_FIRST
        StateName              = BeingConstructed
        BeginScript
            CurDrawablePlaySound("GondorBarracksBeginConstruction")
        EndScript
    End

    ModelConditionState  = DAMAGED
      Model         = rbrohfestunga
        Texture  = exfiretorchseq.tga exfiretorchseq.tga
        Texture  = gbhd1.tga gbhd1_d.tga
        Texture  = gbwall_bib.tga gbwall_bib.tga
        Texture  = rbcastkeep.tga rbcastkeep_d.tga
        Texture  = rbhdgate.tga rbhdgate.tga
        Texture  = rbwatchtow.tga rbwatchtow_d.tga
        Texture  = ru_banr_house.tga ru_banr_house.tga

        Texture     = rbarchrnge.tga rbarchrnge_d.tga
        Texture     = rbarchrngec.tga rbarchrngec_d.tga
        Texture     = rbwatchtow.tga rbwatchtow_d.tga
        Texture     = rbcastkeep.tga rbgoldhall_d.tga
        ParticleSysBone FireSmall01 FireBuildingLarge
        ParticleSysBone FireSmall02 FireBuildingMedium
        ParticleSysBone FireSmall03 FireBuildingMedium
        ParticleSysBone FireSmall04 FireBuildingMedium
        ParticleSysBone FireSmall05 SmokeBuildingLarge
    End
    AnimationState = DAMAGED
        EnteringStateFX    = FX_BuildingDamaged
    End

    ModelConditionState  = REALLYDAMAGED
      Model         = rbrohfestunga
        Texture  = exfiretorchseq.tga exfiretorchseq.tga
        Texture  = gbhd1.tga gbhd1_d.tga
        Texture  = gbwall_bib.tga gbwall_bib.tga
        Texture  = rbcastkeep.tga rbcastkeep_d.tga
        Texture  = rbhdgate.tga rbhdgate.tga
        Texture  = rbwatchtow.tga rbwatchtow_d.tga
        Texture  = ru_banr_house.tga ru_banr_house.tga

        Texture     = rbarchrnge.tga rbarchrnge_d.tga
        Texture     = rbarchrngec.tga rbarchrngec_d.tga
        Texture     = rbwatchtow.tga rbwatchtow_d.tga
        Texture     = rbcastkeep.tga rbgoldhall_d.tga
       Texture     = gbhd1.tga gbhd1_d.tga
        ParticleSysBone FireSmall01 FireBuildingLarge
        ParticleSysBone FireSmall02 FireBuildingLarge
        ParticleSysBone FireSmall03 FireBuildingLarge
        ParticleSysBone FireSmall04 FireBuildingLarge
        ParticleSysBone FireSmall05 FireBuildingLarge
        ParticleSysBone FireSmall01 SmokeBuildingLarge
        ParticleSysBone FireSmall02 SmokeBuildingLarge
        ParticleSysBone FireSmall03 SmokeBuildingLarge
        ParticleSysBone FireSmall04 SmokeBuildingLarge
        ParticleSysBone FireSmall05 SmokeBuildingLarge
    End
    AnimationState = REALLYDAMAGED
        EnteringStateFX    = FX_BuildingReallyDamaged
    End

    ModelConditionState  = RUBBLE
      Model         = rbrohfestunga
        Texture  = exfiretorchseq.tga exfiretorchseq.tga
        Texture  = gbhd1.tga gbhd1_d.tga
        Texture  = gbwall_bib.tga gbwall_bib.tga
        Texture  = rbcastkeep.tga rbcastkeep_d.tga
        Texture  = rbhdgate.tga rbhdgate.tga
        Texture  = rbwatchtow.tga rbwatchtow_d.tga
        Texture  = ru_banr_house.tga ru_banr_house.tga

        Texture     = rbarchrnge.tga rbarchrnge_d.tga
        Texture     = rbarchrngec.tga rbarchrngec_d.tga
        Texture     = rbwatchtow.tga rbwatchtow_d.tga
        Texture     = rbcastkeep.tga rbgoldhall_d.tga
       Texture     = gbhd1.tga gbhd1_d.tga
      ParticleSysBone SmokeLarge01 SmokeBuildingLarge
    End

    AnimationState = RUBBLE
    EnteringStateFX = FX_WallDie
    End

    ModelConditionState  = POST_RUBBLE
      Model         = None
        ParticleSysBone NONE SmokeBuildingMediumRubble
    End

    ModelConditionState  = POST_COLLAPSE
      Model         = None
        ParticleSysBone NONE SmokeBuildingMediumRubble
    End

    ModelConditionState = SNOW
        Model   = rbrohfestunga
        Texture  = exfiretorchseq.tga exfiretorchseq.tga
        Texture  = gbhd1.tga gbhd1_snow.tga
        Texture  = gbwall_bib.tga gbwall_bib_snow.tga
        Texture  = rbcastkeep.tga rbcastkeep_snow.tga
        Texture  = rbhdgate.tga rbhdgate.tga
        Texture  = rbwatchtow.tga rbwatchtow_snow.tga
        Texture  = ru_banr_house.tga ru_banr_house.tga

        Texture  = GBFarm.tga GBFarm_Snow.tga
        Texture  = GBVet.tga GBVet_snow.tga
        Texture  = rbarchrnge.tga rbarchrnge_snow.tga
        Texture  = rbarmory2.tga rbarmory2_snow.tga
        Texture  = rbarmory.tga rbarmory_snow.tga
        Texture  = rbbib.tga rbbib_snow.tga
        Texture  = rbcastkeep.tga rbcastkeep_snow.tga
        Texture  = rbgate.tga rbgate_snow.tga
        Texture  = rbgoldhall.tga rbgoldhall_snow.tga
        Texture  = rbgoldhallbib.tga rbgoldhallbib_snow.tga
        Texture  = rbstable.tga rbstable_snow.tga
        Texture  = rbwatchtow.tga rbwatchtow_snow.tga
        Texture  = rbwell.tga rbwell_snow.tga
        Texture  = tdirt_dma14.tga tdirt_dma14_snow.tga
        Texture  = pfence01.tga pfence01_snow.tga
        Texture  = rpherostat.tga rpherostat_snow.tga
        Texture  = gbhd1.tga gbhd1_snow.tga
    End
  End

   Draw = W3DScriptedModelDraw ModuleTag_IvoryTowerDraw
        OkToChangeModelColor    = Yes
        StaticModelLODMode      = Yes

        DefaultModelConditionState
            Model           = None
        End

        ModelConditionState = UPGRADE_IVORY_TOWER DAMAGED
            Model        = rbruhmhalle_b
            Texture        = GBFortress1.tga GBFortress1D.tga
        End

        ModelConditionState        = UPGRADE_IVORY_TOWER REALLYDAMAGED
            Model        = rbruhmhalle
        End

        AnimationState            = UPGRADE_IVORY_TOWER REALLYDAMAGED
            Animation            = ReallyDamaged
                AnimationName    = rbruhmhalle.rbruhmhalle
                AnimationMode   = ONCE
            End
        End

        ModelConditionState        = UPGRADE_IVORY_TOWER RUBBLE
            Model        = rbruhmhalle
        End

        AnimationState            = UPGRADE_IVORY_TOWER RUBBLE
            Animation            = Destroyed
                AnimationName    = rbruhmhalle.rbruhmhalle
                AnimationMode   = ONCE
            End
        End


        ModelConditionState = UPGRADE_IVORY_TOWER USER_2
            Model           = rbruhmhalle_b
        End


        AnimationState = UPGRADE_IVORY_TOWER USER_2
            Animation                    = RiseUp
                AnimationName                = rbruhmhalle_b.rbruhmhalle_b
                AnimationMode                = ONCE
                AnimationSpeedFactorRange    = 5.0 5.0
            End
        End


        ModelConditionState = SNOW UPGRADE_IVORY_TOWER
            Model            = rbruhmhalle
        Texture  = GBFarm.tga GBFarm_Snow.tga
        Texture  = GBVet.tga GBVet_snow.tga
        Texture  = rbarchrnge.tga rbarchrnge_snow.tga
        Texture  = rbarmory2.tga rbarmory2_snow.tga
        Texture  = rbarmory.tga rbarmory_snow.tga
        Texture  = rbbib.tga rbbib_snow.tga
        Texture  = rbcastkeep.tga rbcastkeep_snow.tga
        Texture  = rbgate.tga rbgate_snow.tga
        Texture  = rbgoldhall.tga rbgoldhall_snow.tga
        Texture  = rbgoldhallbib.tga rbgoldhallbib_snow.tga
        Texture  = rbstable.tga rbstable_snow.tga
        Texture  = rbwatchtow.tga rbwatchtow_snow.tga
        Texture  = rbwell.tga rbwell_snow.tga
        Texture  = tdirt_dma14.tga tdirt_dma14_snow.tga
        Texture  = pfence01.tga pfence01_snow.tga
        Texture  = rpherostat.tga rpherostat_snow.tga
        Texture  = gbhd1.tga gbhd1_snow.tga
        End

        ModelConditionState = UPGRADE_IVORY_TOWER
            Model           = rbruhmhalle
        End

    End


    Draw = W3DScriptedModelDraw ModuleTag_DrawDoor

        RandomTexture = rbfortress1.tga 0 gbfortress1.tga
        RandomTexture = rbfortress1_nrm.tga 0 gbfortress1_nrm.tga

        DefaultModelConditionState
            Model = GBFDoor_DRC
        End


        ModelConditionState   = DAMAGED DOOR_1_WAITING_OPEN
            Model        = GBFDoor_DRO

        End

        ModelConditionState   = REALLYDAMAGED DOOR_1_WAITING_OPEN
            Model        = GBFDoor_DRO

        End

        ModelConditionState = DAMAGED DOOR_1_CLOSING
            Model        = GBFDoor_DRCA

        End

        ModelConditionState = REALLYDAMAGED DOOR_1_CLOSING
            Model        = GBFDoor_DRCA

        End

        ModelConditionState = DAMAGED
            Model        = GBFDoor_DRC

        End

        ModelConditionState = REALLYDAMAGED
            Model        = GBFDoor_DRC

        End

        ModelConditionState = RUBBLE
            Model        = GBFDoor_D3
        End

        AnimationState    = RUBBLE
            Animation    = Door_Destroyed
                AnimationName        = GBFDoor_D3.GBFDoor_D3
                AnimationMode        = ONCE
                AnimationBlendTime    = 50
            End
        End


        ModelConditionState   = DOOR_1_OPENING
            Model               = GBFDoor_DROA
        End

        AnimationState            =    DOOR_1_OPENING
            Animation           =    GBFDoor_DRO
                AnimationName   =    GBFDoor_DROA.GBFDoor_DROA
                AnimationMode   =    ONCE
            End
        End

        ModelConditionState   = DOOR_1_CLOSING
            Model               = GBFDoor_DRCA
            ParticleSysBone        = NONE trollCageDust
        End

           AnimationState            =    DOOR_1_CLOSING
            Animation           =    GBFDoor_DRCA
                AnimationName   =    GBFDoor_DRCA.GBFDoor_DRCA
                AnimationMode   =    ONCE
            End
        End

        ModelConditionState   = DOOR_1_WAITING_OPEN
            Model               = GBFDoor_DRO
        End

        AnimationState            =    DOOR_1_WAITING_OPEN
        End

        ModelConditionState  = POST_RUBBLE
            Model         = None
        End

        ModelConditionState  = POST_COLLAPSE
            Model         = None
        End
    End

  PlacementViewAngle  = -45


    DisplayName         = OBJECT:RohanFortress
    Description         = OBJECT:MenFortressDescription
    Side                = Rohan
    EditorSorting       = STRUCTURE
    ThreatLevel         = 1.0
    CommandPointBonus   = MAIN_FORTRESS_COMMAND_POINT
    MaxSimultaneousOfType   = NEW_FORTRESS_RATIO
    BuildCost           = MEN_FORTRESS_BUILDCOST
    BuildTime           = DEFAULT_FORTRESS_BUILDTIME
    VisionRange         = DEFAULT_FORTRESS_VISION_RANGE
    ShroudClearingRange = DEFAULT_FORTRESS_SHROUD_CLEAR

    WeaponSet
        Weapon               = PRIMARY FortressArrowTowerBow
        AutoChooseSources    = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End

    ArmorSet
        Conditions        = None
        Armor             = DefaultFortressArmor
    End

    CommandSet     = RohanFortressCommandSet



    EvaEventDamagedOwner       	    = StructureUnderAttack
    EvaEnemyObjectSightedEvent 	    = EnemyCampSighted

    EvaEventDieOwner                = EvaFortressDie

    VoiceSelect                     = RohanCitadelSelect
    VoiceSelectUnderConstruction    = BuildingGoodVoiceSelectUnderConstruction

    SoundOnDamaged                  = BuildingLightDamageStone
    SoundOnReallyDamaged            = BuildingHeavyDamageStone

    UnitSpecificSounds
        UnderConstruction           = BuildingBigConstructionLoop
        UnderRepairFromRubble       = BuildingBigConstructionLoop
    End

    CampnessValue = CAMPNESS_FORTRESS


    RadarPriority       = STRUCTURE
    KindOf              = PRELOAD COMMANDCENTER VITAL_FOR_BASE_SURVIVAL STRUCTURE IMMOBILE CASTLE_KEEP MP_COUNT_FOR_VICTORY SELECTABLE FS_FACTORY AUTO_RALLYPOINT MADE_OF_WOOD SCORE DOZER_FACTORY

    Behavior = CitadelSlaughterHordeContain ModuleTag_SlaughterMe
		PassengerFilter			= GENERIC_FACTION_SLAUGHTERABLE
		ObjectStatusOfContained		= UNSELECTABLE ENCLOSED
		CashBackPercent			= 200%
		ContainMax			= 99
		AllowEnemiesInside		= No
		AllowAlliesInside		= No
		AllowNeutralInside		= No
		AllowOwnPlayerInsideOverride	= Yes
		EnterSound			= GUI_RingReturned
		EntryOffset			= X:125.0 Y:0.0 Z:0.0
		EntryPosition			= X:30.0 Y:0.0 Z:0.0
		ExitOffset			= X:125.0 Y:0.0 Z:0.0
    End

    Behavior = FXListDie ModuleTag_AnnounceWeLostTheRing
        DeathFX             	= AnnounceFortressDeathLostRingFX
    End

    Behavior = CreateObjectDie ModuleTag_DropTheRing
        CreationList        	= OCL_TheOneRing
        UpgradeRequired     	= Upgrade_SauronSilmarilArrive
    End

    Behavior = ModelConditionUpgrade ModuleTag_ForFX
        TriggeredBy            	= Upgrade_SauronSilmarilArrive
        RequiresAllTriggers    	= Yes
        AddConditionFlags      	= ONE_RING
    End

    Draw = W3DScriptedModelDraw ModuleTag_RingFX
            DefaultModelConditionState
                  Model = None
            End

        ModelConditionState = ONE_RING UPGRADE_IVORY_TOWER
            Model = exsileffectr
            Shadow                       = SHADOW_ADDITIVE_DECAL_DYNAMIC
            ShadowSizeX                  = 400
            ShadowSizeY                  = 400
            ShadowTexture                = EXGandalfGlow
            ShadowOpacityStart           = 0
            ShadowOpacityFadeInTime      = 1000
            ShadowOpacityPeak            = 255
            ShadowOpacityFadeOutTime     = 1000
            ShadowOpacityEnd             = 0
            ShadowOverrideLODVisibility  = Yes
        End

        ModelConditionState = ONE_RING
            Model = exsileffect
            Shadow                       = SHADOW_ADDITIVE_DECAL_DYNAMIC
            ShadowSizeX                  = 400
            ShadowSizeY                  = 400
            ShadowTexture                = EXGandalfGlow
            ShadowOpacityStart           = 0
            ShadowOpacityFadeInTime      = 1000
            ShadowOpacityPeak            = 255
            ShadowOpacityFadeOutTime     = 1000
            ShadowOpacityEnd             = 0
            ShadowOverrideLODVisibility  = Yes
        End

        IdleAnimationState
            Animation
                AnimationName = EXSILEFFECT.EXSILEFFECT
                AnimationMode = LOOP
                AnimationSpeedFactorRange = 0.35 0.35
            End
        End
    End

    Behavior = RemoveUpgradeUpgrade ModuleTag_RemoveSilmaril
        TriggeredBy                   = Upgrade_SauronSilmarilArrive
        UpgradeToRemove               = Upgrade_FortressRingHero Upgrade_RingHero
        RemoveFromAllPlayerObjects    = Yes
        SuppressEvaEventForRemoval    = Yes
    End





    Behavior = CastleUpgrade ModuleTag_PassOutRohanFestungsBanner
        TriggeredBy    = Upgrade_RohanFestungsBannerTrigger
        Upgrade        = Upgrade_RohanFestungsBanner
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
		ProductionModifier
		RequiredUpgrade = Upgrade_ObjectUnderAIControl
		TimeMultiplier  = TIME_MULTIPLIER_AI_HEROES
		HeroRevive      = Yes
		ModifierFilter  = NONE +HERO
	End
	ProductionModifier
		RequiredUpgrade = Upgrade_BrutalAIMultiPlayer Upgrade_BrutalAISinglePlayer
		CostMultiplier  = COST_MULTIPLIER_AI_HEROES
		HeroPurchase    = Yes
		HeroRevive      = Yes
		ModifierFilter  = NONE +HERO
	End
        ProductionModifier
            RequiredUpgrade = Upgrade_RohanFestungsBanner
            CostMultiplier  = 0.80
            ModifierFilter  = NONE +RohanPorter
        End
        NumDoorAnimations            = 1
        DoorOpeningTime              = 3000
        DoorWaitOpenTime             = 3000
        DoorCloseTime                = 3000
        GiveNoXP 		     = Yes
    End

    Behavior = CostModifierUpgrade ModuleTag_CostModifier
        LabelForPalantirString    = GUI:HERO_DISCOUNT
        TriggeredBy               = Upgrade_RohanFestungsBanner
        ObjectFilter              = ANY +HERO
        Percentage                = -10%
        Percentage                = -20%
        Percentage                = -25%
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowBanner
        TriggeredBy        = Upgrade_RohanFestungsBanner
        ShowSubObjects     = FLAGGEN
    End

    Behavior = FireWeaponUpdate FireWeaponUpdateModuleTag
        FireWeaponNugget
            WeaponName = DiscountRohanHeroObjectDestroyWeapon
            FireDelay  = 1000
            OneShot    = Yes
        End
    End

    Behavior = ObjectCreationUpgrade ModuleTag_ObjectRohanHeroDiscount
        TriggeredBy     = Upgrade_RohanFestungsBanner
        ThingToSpawn    = DiscountRohanHeroObject
    End


    Behavior = AutoDepositUpdate AutoDepositModuleTag
        DepositTiming           = GENERIC_KEEP_MONEY_TIME
        DepositAmount           = GENERIC_KEEP_MONEY_AMOUNT
        InitialCaptureBonus     = 0
    End

    Behavior = TerrainResourceBehavior ModuleTag_NewMoneyDeadSpot
        Radius            = GENERIC_KEEP_MONEY_RANGE
        MaxIncome         = 0
        IncomeInterval    = 999999
        HighPriority      = Yes
    End






    Behavior = ObjectCreationUpgrade MakeTheFreeTreb1
        TriggeredBy             = Upgrade_RohanFortressMilizen
        Delay                   = 0.0
        ThingToSpawn            = RohanSpeerwerfer_Slaved
        Offset                  = X:46 Y:-43 Z:73.5
        FadeInTime              = 100
    End

    Behavior = ObjectCreationUpgrade MakeTheFreeTreb2
        TriggeredBy             = Upgrade_RohanFortressMilizen
        Delay                   = 0.0
        ThingToSpawn            = RohanSpeerwerfer_Slaved
        Offset                  = X:-53 Y:-44 Z:73.5
        FadeInTime              = 100
    End

    Behavior = ObjectCreationUpgrade MakeTheFreeTreb3
        TriggeredBy             = Upgrade_RohanFortressMilizen
        Delay                   = 0.0
        ThingToSpawn            = RohanSpeerwerfer_Slaved
        Offset                  = X:48 Y:43 Z:73.5
        FadeInTime              = 100
    End

    Behavior = ObjectCreationUpgrade MakeTheFreeTreb4
        TriggeredBy             = Upgrade_RohanFortressMilizen
        Delay                   = 0.0
        ThingToSpawn            = RohanSpeerwerfer_Slaved
        Offset                  = X:-42 Y:43 Z:73.5
        FadeInTime              = 100
    End

    Behavior = ObjectCreationUpgrade MakeTheFreeTreb6
        TriggeredBy             = Upgrade_RohanFortressMilizen
        Delay                   = 0.0
        ThingToSpawn            = RohanStonethrower_Slaved
        Offset                  = X:38 Y:-45 Z:73.5
        FadeInTime              = 100
    End

    Behavior = ObjectCreationUpgrade MakeTheFreeTreb7
        TriggeredBy             = Upgrade_RohanFortressMilizen
        Delay                   = 0.0
        ThingToSpawn            = RohanStonethrower_Slaved
        Offset                  = X:-45 Y:-44 Z:73.5
        FadeInTime              = 100
    End

    Behavior = ObjectCreationUpgrade MakeTheFreeTreb8
        TriggeredBy             = Upgrade_RohanFortressMilizen
        Delay                   = 0.0
        ThingToSpawn            = RohanStonethrower_Slaved
        Offset                  = X:39 Y:43 Z:73.5
        FadeInTime              = 100
    End

    Behavior = ObjectCreationUpgrade MakeTheFreeTreb9
        TriggeredBy             = Upgrade_RohanFortressMilizen
        Delay                   = 0.0
        ThingToSpawn            = RohanStonethrower_Slaved
        Offset                  = X:-52 Y:43 Z:73.5
        FadeInTime              = 100
    End







    Behavior = CastleUpgrade ModuleTag_PassOutFlamingMunitionsUpgrade
        TriggeredBy    = Upgrade_GoodFortressFlamingMunitionsTrigger
        Upgrade        = Upgrade_GoodFortressFlamingMunitions
    End

    Behavior = StatusBitsUpgrade ModuleTag_FakeOut
        TriggeredBy    = Upgrade_GoodFortressFlamingMunitions
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowTorches
        TriggeredBy        = Upgrade_GoodFortressFlamingMunitions
        ShowSubObjects     = GBFFLAMING FLAMES
    End







    Behavior = CastleUpgrade ModuleTag_PassOutRohanFortressHolzUpgrade
        TriggeredBy            = Upgrade_RohanFortressStoneworkTrigger
        Upgrade                = Upgrade_RohanFortressStonework
        WallUpgradeRadius      = MEN_FORTRESS_WALL_EFFECTIVE_RADIUS
    End

    Behavior = AttributeModifierUpgrade ModuleTag_FortressHolz
        TriggeredBy            = Upgrade_RohanFortressStonework
        AttributeModifier      = NumenorStoneworkKeep_Bonus
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowStonework
        TriggeredBy            = Upgrade_RohanFortressStonework
        ShowSubObjects         = STONEWALL
    End

    Behavior = ArmorUpgrade ModuleTag_ArmorUpgrade
        TriggeredBy            = Upgrade_RohanFortressStonework
    End







    Behavior = GeometryUpgrade TowerGeom
        TriggeredBy               = Upgrade_RohanFortressHelmsHorn
        ShowGeometry              = HighTowerGeom
    End

    Behavior = AttributeModifierUpgrade ModuleTag_IvoryTowerBonus
        AttributeModifier      = MenFortressIvoryTowerBonus
        TriggeredBy            = Upgrade_RohanFortressHelmsHorn Upgrade_RohanFortressStonework
        RequiresAllTriggers    = Yes
    End

    Behavior = AudioLoopUpgrade ModuleTag_IvoryTowerBuildLoop
        TriggeredBy            = Upgrade_RohanFortressHelmsHorn
        SoundToPlay            = BuildingBigConstructionLoop
        KillOnDeath            = Yes
        KillAfterMS            = 2500
    End

    Behavior = ModelConditionUpgrade ModuleTag_ShowTheTower
        TriggeredBy              = Upgrade_RohanFortressHelmsHorn Upgrade_RohanFortressStonework
        RequiresAllTriggers      = Yes
        AddConditionFlags        = UPGRADE_IVORY_TOWER
        AddTempConditionFlag     = ModelConditionState:USER_2
        TempConditionTime        = 10.0
        Permanent                = Yes
    End


    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_RuhmeshalleEnabler
        SpecialPowerTemplate        = SpecialAbilityFortressKingsFavor
        TriggeredBy                 = Upgrade_RohanFortressHelmsHorn Upgrade_RohanFortressStonework
        RequiresAllTriggers         = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_RuhmeshalleSpecialPowerModule
        SpecialPowerTemplate        = SpecialAbilityFortressKingsFavor
        StartsPaused                = Yes
        UpdateModuleStartsAttack    = Yes
    End

    Behavior = LevelGrantSpecialPower ModuleTag_Ruhmeshalle
        SpecialPowerTemplate        = SpecialAbilityFortressKingsFavor
        UnpackingVariation          = 2
        StartAbilityRange           = 500.0
        LevelFX                     = FX_LevelUp
        Experience                  = 10000
        RadiusEffect                = 70
        AcceptanceFilter            = KINGSFAVOR_OBJECTFILTER
        UnpackTime                  = 3000
        PreparationTime             = 0
        FreezeAfterTriggerDuration  = 2000
    End

    Behavior = AISpecialPowerUpdate GiveXPAoE_AI
        CommandButtonName  = Command_SpecialAbilityRuhmundEhre
        SpecialPowerAIType = AI_SPECIAL_POWER_GIVEXP_AOE
        SpecialPowerRadius = 100.0
    End

    Behavior = AIUpdateInterface ModuleTag_AI
        AILuaEventsList             = FortressFunctions
        AutoAcquireEnemiesWhenIdle  = Yes
        MoodAttackCheckRate         = 250
    End

    Behavior = QueueProductionExitUpdate ModuleTag_QueuePEU
        UnitCreatePoint   = X:0.0 Y:-20.0 Z:0.0
        NaturalRallyPoint = X:80.0 Y:0.0 Z:0.0
        ExitDelay 	  = STANDARD_HERO_EXIT_DELAY
    End

    Behavior            = GettingBuiltBehavior ModuleTag_GettingBuiltBehavior
        WorkerName    = RohanWorkerEdainNoSelect
        SpawnTimer    = DEFAULT_STRUCTURE_HEALDELAY
    End

    Behavior = CastleMemberBehavior ModuleTag_CMB
        BeingBuiltSound = BuildingBigConstructionLoop
    End

    Body                = StructureBody ModuleTag_05
        MaxHealth               = DEFAULT_FORTRESS_HEALTH
        MaxHealthDamaged        = DEFAULT_FORTRESS_HEALTH_DAMAGED
        MaxHealthReallyDamaged  = DEFAULT_FORTRESS_HEALTH_REALLY_DAMAGED
    End

    Behavior                  = StructureCollapseUpdate ModuleTag_08
        MinCollapseDelay        = 000
        MaxCollapseDelay        = 000
        CollapseDamping         = .5
        MaxShudder              = 0.6
        MinBurstDelay           = 250
        MaxBurstDelay           = 800
        BigBurstFrequency       = 4
        FXList                  = INITIAL   FX_FortressCollapse
        DestroyObjectWhenDone   = Yes
        CollapseHeight          = 155
    End

    Behavior = SubObjectsUpgrade ModuleTag_HideAll
        TriggeredBy        = Upgrade_StructureLevel1
        HideSubObjects     = FLAGGEN FLAMES STONEWALL GBFFLAMING STEEL BOX02 BOX03 BOX04
    End

    Behavior = PassiveAreaEffectBehavior ModuleTag_FeelGoodTheoden
        EffectRadius            = 200
        PingDelay               = 2000
        ModifierName            = AllowedTheodenButtons
        AllowFilter             = NONE +RohanOldMan +RohanOldManKill ALLIES
    End

    Behavior = PassiveAreaEffectBehavior ModuleTag_FeelGoodArcher
        EffectRadius            = 400
        PingDelay               = 2000
        UpgradeRequired         = Upgrade_GoodFortressFlamingMunitions
        ModifierName            = RohanFortressArcherModifier
        AllowFilter             = ANY +RohanArcher_mod_Slaved +RohanArcherTower_Slaved ALLIES
    End

    Behavior = FireWeaponUpdate FireWeaponUpdateModuleTag2
        FireWeaponNugget
            WeaponName = RohanKillOldManWeapon
            FireDelay  = 0
            OneShot    = No
        End
    End

    Behavior = CommandSetUpgrade ModueTag_CommandSet_Theoden
        TriggeredBy    		= Upgrade_RuhmdesKonigsUpgrade
        CommandSet     		= RohanFortressCommandSet_Theoden
    End

    Behavior = CommandSetUpgrade ModueTag_CommandSet_AI
        TriggeredBy    		= Upgrade_ObjectUnderAIControl
	ConflictsWith  		= Upgrade_RuhmdesKonigsUpgrade
        CommandSet     		= RohanFortressCommandSet_AI
    End

    Behavior = CommandSetUpgrade ModueTag_CommandSet_Theoden_AI
        TriggeredBy    		= Upgrade_ObjectUnderAIControl Upgrade_RuhmdesKonigsUpgrade
	RequiresAllTriggers     = Yes
        CommandSet     		= RohanFortressCommandSet_Theoden_AI
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI1
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 320000
        GrantUpgrade = Upgrade_RohanFestungsBannerTrigger
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI2
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 700000
        GrantUpgrade = Upgrade_RohanFortressMilizen
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI3
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 1000000
        GrantUpgrade = Upgrade_GoodFortressFlamingMunitionsTrigger
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI4
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 1400000
        GrantUpgrade = Upgrade_RohanFortressStoneworkTrigger
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI5
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 1700000
        GrantUpgrade = Upgrade_RohanFortressHelmsHorn
    End

    GeometryIsSmall       = No
    Geometry              = BOX
    GeometryMajorRadius   = 49
    GeometryMinorRadius   = 49
    GeometryHeight        = 50

    AdditionalGeometry    = BOX
    GeometryMajorRadius   = 12.0
    GeometryMinorRadius   = 12.0
    GeometryHeight        = 100.0
    GeometryOffset        = X:-40 Y:-40 Z:0

    AdditionalGeometry    = BOX
    GeometryMajorRadius   = 12.0
    GeometryMinorRadius   = 12.0
    GeometryHeight        = 100.0
    GeometryOffset        = X:-40 Y:40 Z:0

    AdditionalGeometry    = BOX
    GeometryMajorRadius   = 12.0
    GeometryMinorRadius   = 12.0
    GeometryHeight        = 100.0
    GeometryOffset        = X:40 Y:-40 Z:0

    AdditionalGeometry    = BOX
    GeometryMajorRadius   = 12.0
    GeometryMinorRadius   = 12.0
    GeometryHeight        = 100.0
    GeometryOffset        = X:40 Y:40 Z:0

    AdditionalGeometry      = BOX
    GeometryName            = HighTowerGeom
    GeometryMajorRadius     = 12
    GeometryMinorRadius     = 12
    GeometryHeight          = 175
    GeometryOffset          = X:0 Y:0 Z:0
    GeometryUsedForHealthBox = No

    GeometryContactPoint = X:-57         Y:57         Z:0          Repair
    GeometryContactPoint = X:57          Y:-57        Z:0          Repair
    GeometryContactPoint = X:49          Y:36.435     Z:0
    GeometryContactPoint = X:-32.763     Y:-46.121    Z:0
    GeometryContactPoint = X:0           Y:0          Z:180        Swoop

    Shadow               = SHADOW_VOLUME
    BuildCompletion      = PLACED_BY_PLAYER
End


Object RohanFortress

    SelectPortrait = BRRohanfestung

    Draw    = W3DScriptedModelDraw ModuleTag_01
        OkToChangeModelColor    = Yes
        StaticModelLODMode        = Yes

        DefaultModelConditionState
            Model           = None
        End

        IdleAnimationState
        End

        ModelConditionState = WORLD_BUILDER
            Model    = rbrohfestunga
        End


        ModelConditionState = BUILD_PLACEMENT_CURSOR
            Model    = None
        End


        ModelConditionState =  PHANTOM_STRUCTURE
            Model    = rbrohfestunga
        End

        ModelConditionState = RUBBLE
            Model        = rbrohfestunga
        End

        AnimationState    = RUBBLE
            Animation    = Fortress_Rubble
                AnimationName        = rbrohfestunga.rbrohfestunga
                AnimationMode        = ONCE
            End
            EnteringStateFX    = FX_FortressCollapse
        End

        ModelConditionState = ACTIVELY_BEING_CONSTRUCTED SNOW
            Model            = rbrohfestung_b
        End
        ModelConditionState = ACTIVELY_BEING_CONSTRUCTED
            Model            = rbrohfestung_b
        End

        AnimationState = ACTIVELY_BEING_CONSTRUCTED
            Animation                    = rbrohfestung_b
                AnimationName            = rbrohfestung_b.rbrohfestung_b
                AnimationMode            = MANUAL
            End
            ParticleSysBone = NONE BuildingContructDustCastles FollowBone:Yes
            StateName = BeingConstructed
            BeginScript
                CurDrawablePlaySound("GondorBarracksBeginConstruction")
            EndScript
        End
    End

      ArmorSet
        Conditions        = None
          Armor             = DefaultFortressArmor
      End

    Side                = Rohan
    EditorSorting       = STRUCTURE
    MaxSimultaneousOfType = NEW_FORTRESS_RATIO
    PlacementViewAngle = -45

    BuildCost           = ELVEN_FORTRESS_BUILDCOST
    BuildTime           = DEFAULT_FORTRESS_BUILDTIME

    DisplayName         = OBJECT:RohanFortress


    #include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

    VoiceFullyCreated                = EVA:FortressComplete-Builder-Elf
    VoiceSelect                        = ElfFortressSelect
    VoiceSelectUnderConstruction    = BuildingGoodVoiceSelectUnderConstruction

    SoundOnDamaged                    = BuildingLightDamageStone
    SoundOnReallyDamaged            = BuildingHeavyDamageStone

    UnitSpecificSounds
        UnderConstruction            = BuildingBigConstructionLoop

        UnderRepairFromRubble        = BuildingBigConstructionLoop
    End

    ClientBehavior = ModelConditionAudioLoopClientBehavior ModuleTag_PlayCollapseSound
        ModelCondition = REQUIRED:RUBBLE Sound:BuildingSink
    End



    AutoResolveUnitType = AutoResolveUnit_Fortress

        AutoResolveBody = AutoResolve_ElvenFortressBody

        AutoResolveArmor
            Armor = AutoResolve_ElvenFortressArmor
        End

        AutoResolveWeapon
            Weapon = AutoResolve_ElvenFortressWeapon
        End



    RadarPriority       = STRUCTURE
    KindOf              = STRUCTURE SELECTABLE IMMOBILE BASE_FOUNDATION MP_COUNT_FOR_VICTORY BASE_SITE CAN_SEE_THROUGH_STRUCTURE LIVING_WORLD_BUILDING_MIRROR CAN_CAST_REFLECTIONS


    Body                        = StructureBody ModuleTag_05
        MaxHealth                     = DEFAULT_FORTRESS_HEALTH
    End

    Behavior = CastleBehavior ModuleTag_castle
        CastleToUnpackForFaction    = Rohan fortress_rohan
        CastleToUnpackForFaction    = Men gondor_castle
        CastleToUnpackForFaction    = Arnor fortress_rohan
        CastleToUnpackForFaction    = Elves fortress_rohan
        CastleToUnpackForFaction    = Imladris fortress_rohan
        CastleToUnpackForFaction    = Dwarves fortress_rohan
        CastleToUnpackForFaction    = Mordor fortress_rohan
        CastleToUnpackForFaction    = Isengard fortress_rohan
        CastleToUnpackForFaction    = Wild fortress_rohan
        CastleToUnpackForFaction    = Angmar fortress_rohan


        FilterValidOwnedEntries        = ANY +STRUCTURE +WALK_ON_TOP_OF_WALL +BASE_FOUNDATION +TACTICAL_MARKER

        MaxCastleRadius             = 130.0
        InstantUnpack               = Yes
        KeepDeathKillsEverything    = Yes

        EvaEnemyCastleSightedEvent = EnemyFortressSighted
    End

    Behavior                  = StructureCollapseUpdate ModuleTag_06
        MinCollapseDelay        = 000
        MaxCollapseDelay        = 000
        CollapseDamping         = .5
        MaxShudder              = 0.6
        MinBurstDelay           = 250
        MaxBurstDelay           = 800
        BigBurstFrequency       = 4
        FXList                  = INITIAL   FX_FortressCollapse

        DestroyObjectWhenDone    = Yes
        CollapseHeight            = 120
    End

    Behavior            = GettingBuiltBehavior ModuleTag_GettingBuiltBehavior
        WorkerName    = RohanWorkerEdainNoSelect
        SpawnTimer    = DEFAULT_STRUCTURE_HEALDELAY
    End

    Behavior = AIUpdateInterface ModuleTag_AI
        AILuaEventsList        =    FortressFunctions
    End


    Geometry                = CYLINDER
    GeometryName            = Geom_Orig
      GeometryMajorRadius        = 85.0
    GeometryHeight            = 55.0


    AdditionalGeometry        = BOX
    GeometryName            = Plots
    GeometryMajorRadius        = 10.0
    GeometryMinorRadius        = 10.0
    GeometryHeight            = 0.8
    GeometryOffset            = X:66.49 Y:-66.49 Z:0

    AdditionalGeometry        = BOX
    GeometryName            = Plots
    GeometryMajorRadius        = 10.0
    GeometryMinorRadius        = 10.0
    GeometryHeight            = 0.8
    GeometryOffset            = X:0 Y:-94.0 Z:0

    AdditionalGeometry        = BOX
    GeometryName            = Plots
    GeometryMajorRadius        = 10.0
    GeometryMinorRadius        = 10.0
    GeometryHeight            = 0.8
    GeometryOffset            = X:-66.49 Y:-66.49 Z:0

    AdditionalGeometry        = BOX
    GeometryName            = Plots
    GeometryMajorRadius        = 10.0
    GeometryMinorRadius        = 10.0
    GeometryHeight            = 0.8
    GeometryOffset            = X:-94.0 Y:0 Z:0

    AdditionalGeometry        = BOX
    GeometryName            = Plots
    GeometryMajorRadius        = 10.0
    GeometryMinorRadius        = 10.0
    GeometryHeight            = 0.8
    GeometryOffset            = X:-66.49 Y:66.49 Z:0

    AdditionalGeometry        = BOX
    GeometryName            = Plots
    GeometryMajorRadius        = 10.0
    GeometryMinorRadius        = 10.0
    GeometryHeight            = 0.8
    GeometryOffset            = X:0 Y:94.0 Z:0

    AdditionalGeometry        = BOX
    GeometryName            = Plots
    GeometryMajorRadius        = 10.0
    GeometryMinorRadius        = 10.0
    GeometryHeight            = 0.8
    GeometryOffset            = X:66.49 Y:66.49 Z:0


    AdditionalGeometry        = BOX
    GeometryMajorRadius        = 12.0
     GeometryMinorRadius        = 16.0
     GeometryHeight            = 22.0
    GeometryOffset            = X:85 Y:0 Z:0

    GeometryIsSmall         = No
    Shadow                    = SHADOW_VOLUME
End

