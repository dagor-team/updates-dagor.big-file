




Object RohanCastleWallSegment


      SelectPortrait = BRRohanWall

    Draw = W3DScriptedModelDraw ModuleTag_Draw
        OkToChangeModelColor  = Yes
        UseStandardModelNames = Yes
        DefaultModelConditionState
            Model = rbmauer
        End

        ModelConditionState = BUILD_PLACEMENT_CURSOR
            Model = rbmauer
        End


        IdleAnimationState
            StateName = STATE_None
        End


        ModelConditionState = SNOW AWAITING_CONSTRUCTION
            Model = rbmauer_b
            Texture  = rbgate.tga rbgate_snow.tga
        End

        ModelConditionState   = AWAITING_CONSTRUCTION
            Model               = rbmauer_b
        End
        AnimationState                = AWAITING_CONSTRUCTION
            Animation            = rbmauer_b
                AnimationName        = rbmauer_b.rbmauer_b
                AnimationMode        = MANUAL
                AnimationBlendTime    = 0
            End
            Flags                = START_FRAME_FIRST
        End


        ModelConditionState = SNOW ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Model   = rbmauer_b
            Texture  = rbgate.tga rbgate_snow.tga
        End

        ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Model               = rbmauer_b
        End

        AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Animation           = rbmauer_b
                AnimationName     = rbmauer_b.rbmauer_b
                AnimationMode     = MANUAL
                AnimationBlendTime = 0
            End
            Flags                  = START_FRAME_FIRST
            StateName              = BeingConstructed
            ParticleSysBone   = NONE WallConstructDust FollowBone:Yes
        End


        ModelConditionState  = DAMAGED
            Model         = rbmauer
        Texture     = rbarchrnge.tga rbarchrnge_d.tga
        Texture     = rbarchrngec.tga rbarchrngec_d.tga
        Texture     = rbwatchtow.tga rbwatchtow_d.tga
        End
        AnimationState = DAMAGED
            EnteringStateFX    = FX_WallDamaged
        End

        ModelConditionState  = REALLYDAMAGED
            Model         = rbmauer
        Texture     = rbarchrnge.tga rbarchrnge_d.tga
        Texture     = rbarchrngec.tga rbarchrngec_d.tga
        Texture     = rbwatchtow.tga rbwatchtow_d.tga
        End

        AnimationState = REALLYDAMAGED
              Animation                =    RubbleAnimation
                AnimationName        =     rbmauer.rbmauer
                AnimationMode        =    ONCE
              End
            EnteringStateFX    = FX_WallDamaged
        End

        ModelConditionState  = COLLAPSING
            Model         = rbmauer
        Texture     = rbarchrnge.tga rbarchrnge_d.tga
        Texture     = rbarchrngec.tga rbarchrngec_d.tga
        Texture     = rbwatchtow.tga rbwatchtow_d.tga
        End

        AnimationState = COLLAPSING
              Animation                =    RubbleAnimation
               AnimationName        =     rbmauer.rbmauer
                AnimationMode        =    ONCE
              End
              ParticleSysBone NONE WallDestructionDust
        End

        ModelConditionState  = RUBBLE
            Model         = None
        End

        AnimationState                = RUBBLE
            BeginScript
                CurDrawableHideSubObject("ModuleTag_DrawFloor")
            EndScript
        End

        ModelConditionState  = POST_RUBBLE
            Model         = None
        End
        AnimationState = POST_RUBBLE
        End

        ModelConditionState  = POST_COLLAPSE
        Model         = None
        End
        AnimationState = POST_COLLAPSE
        End

        ModelConditionState = SNOW
            Model = rbmauer
            Texture = rbgate.tga rbgate_snow.tga
        End

    End


    Draw = W3DScriptedModelDraw ModuleTag_Draw_Rubble
        OkToChangeModelColor            = Yes
        UseStandardModelNames            = Yes

        DefaultModelConditionState
            Model                = None
        End

        ModelConditionState      = COLLAPSING
            Model                = GBWall_Rubble
        End

        ModelConditionState      = RUBBLE
            Model                = GBWall_Rubble
        End

        ModelConditionState      = POST_RUBBLE
            Model                = GBWall_Rubble
        End

        ModelConditionState      = POST_COLLAPSE
            Model                = None
        End
    End

    Draw = W3DFloorDraw ModuleTag_DrawFloor

        ModelName                = RBSmlWll_Bib
        WeatherTexture                = SNOWY GBWall_Bib_Snow.tga
    End





    DisplayName         = OBJECT:ElvenCastleWallSegment
    Side                = Rohan
    EditorSorting       = STRUCTURE
    ThreatLevel         = 1.0

    BuildCost           = ELVEN_CASTLE_WALLSEGMENT_BUILDCOST
    BuildTime           = ELVEN_CASTLE_WALLSEGMENT_BUILDTIME
    VisionRange         = 160.0
    ShroudClearingRange = 160
    CommandSet            = RohanWallUpgradeNodeCommandSet

    ArmorSet
        Conditions        = None
        Armor             = ElvenWallArmor
    End



    EvaEventDamagedOwner       = StructureUnderAttack
    EvaEnemyObjectSightedEvent = EnemyCampSighted

    VoiceSelect                        = Gui_PlotSelect2
    VoiceSelectUnderConstruction    = BuildingGoodVoiceSelectUnderConstruction

    SoundOnDamaged                    = BuildingLightDamageStone
    SoundOnReallyDamaged            = BuildingHeavyDamageStone

    UnitSpecificSounds
        UnderConstruction        = WallConstructionLoop

        UnderRepairFromRubble    = WallConstructionLoop
    End

    ClientBehavior = ModelConditionAudioLoopClientBehavior ModuleTag_PlayCollapseSound
        ModelCondition = REQUIRED:RUBBLE Sound:BuildingSink
    End

    CampnessValue = CAMPNESS_WALL


    RadarPriority       = STRUCTURE
    KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE WALL_SEGMENT SCALEABLE_WALL MADE_OF_STONE
    ThreatBreakdown ThreatBreakdown_ModuleTag
        AIKindOf = WALL
    End


    KeepSelectableWhenDead    = Yes


    Behavior            = GettingBuiltBehavior ModuleTag_04
        SelfBuildingLoop            = WallConstructionLoop
        SelfRepairFromDamageLoop    = NoSound
        SelfRepairFromRubbleLoop    = WallConstructionLoop
        UseSpawnTimerWithoutWorker         = Yes
        SpawnTimer    = DEFAULT_STRUCTURE_HEALDELAY
        RebuildTimeSeconds            = ELVEN_CASTLE_WALLSEGMENT_BUILDTIME
    End

    Body                = StructureBody ModuleTag_05
        MaxHealth                = 2000
        MaxHealthDamaged        = 1000
        MaxHealthReallyDamaged    = 500
    End


    Behavior = KeepObjectDie ModuleTag_IWantRubble
        DeathTypes            = ALL -SUICIDED
    End
    Behavior            = SlowDeathBehavior ModuleTag_SlowDeath
        DeathTypes            = NONE +SUICIDED
        DestructionDelay = 5000
    End


    Behavior = ReplaceSelfUpgrade ModuleTag_Replace_With_Hub
        ReplaceWith = RohanCastleWallHub
        TriggeredBy = Upgrade_RohanWallHub
        ConflictsWith = Upgrade_RohanWallRegularGate Upgrade_RohanWallCatapult Upgrade_RohanWallTower Upgrade_RohanWallBanner Upgrade_RohanWallSeiteneingang
    End

    Behavior = ReplaceSelfUpgrade ModuleTag_Replace_With_Gate
        ReplaceWith = RohanCastleWallGate
        TriggeredBy = Upgrade_RohanWallRegularGate
        ConflictsWith = Upgrade_RohanWallHub Upgrade_RohanWallCatapult Upgrade_RohanWallTower Upgrade_RohanWallBanner Upgrade_RohanWallSeiteneingang
    End

    Behavior = ReplaceSelfUpgrade ModuleTag_Replace_With_Catapult
        ReplaceWith = RohanCastleWallCatapult
        TriggeredBy = Upgrade_RohanWallCatapult
        ConflictsWith = Upgrade_RohanWallHub Upgrade_RohanWallRegularGate Upgrade_RohanWallTower Upgrade_RohanWallBanner Upgrade_RohanWallSeiteneingang
    End

    Behavior = ReplaceSelfUpgrade ModuleTag_Replace_With_Tower
        ReplaceWith = RohanCastleWallTower
        TriggeredBy = Upgrade_RohanWallTower
        ConflictsWith = Upgrade_RohanWallHub Upgrade_RohanWallRegularGate Upgrade_RohanWallCatapult Upgrade_RohanWallBanner Upgrade_RohanWallSeiteneingang
    End

    Behavior = ReplaceSelfUpgrade ModuleTag_Replace_With_Banner
        ReplaceWith = RohanCastleWallBanner
        TriggeredBy = Upgrade_RohanWallBanner
        ConflictsWith = Upgrade_RohanWallHub Upgrade_RohanWallRegularGate Upgrade_RohanWallCatapult Upgrade_RohanWallTower Upgrade_RohanWallSeiteneingang
    End

    Behavior = ReplaceSelfUpgrade ModuleTag_Replace_With_Seiteneingang
        ReplaceWith = RohanCastleWallSeiteneingang
        TriggeredBy = Upgrade_RohanWallSeiteneingang
        ConflictsWith = Upgrade_RohanWallHub Upgrade_RohanWallRegularGate Upgrade_RohanWallCatapult Upgrade_RohanWallTower Upgrade_RohanWallBanner
    End



    Behavior = ProductionUpdate ModuleTag_RequiredForUpgradeProduction
    End


    Behavior = InheritUpgradeCreate ModuleTag_InheritStonework
        Radius = ELVEN_FORTRESS_WALL_EFFECTIVE_RADIUS
        Upgrade = Upgrade_RohanFortressStonework
        ObjectFilter = ANY +RohanCitadel
    End

    Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
        TriggeredBy                = Upgrade_RohanFortressStonework
        AttributeModifier        = EncasingVinesExpansion_Bonus
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowTorches
        TriggeredBy            = Upgrade_RohanFortressStonework
        ShowSubObjects         = STONEWALL
    End

    Behavior = SubObjectsUpgrade ModuleTag_HideAll
        TriggeredBy            = Upgrade_StructureLevel1
        HideSubObjects         = STONEWALL
    End



    Geometry                  = BOX
    GeometryMajorRadius       = 5.0
    GeometryMinorRadius       = 20.0
    GeometryHeight            = 40.0

    GeometryIsSmall           = No

    Shadow                    = SHADOW_VOLUME
    BuildCompletion           = PLACED_BY_PLAYER
End


Object RohanCastleWallHub



      SelectPortrait  =  BRRohanWallhub

    Draw = W3DScriptedModelDraw ModuleTag_Draw
        OkToChangeModelColor  = Yes
        UseStandardModelNames = Yes

        DefaultModelConditionState
            Model = rbwallhubb
        End

        IdleAnimationState
            StateName = STATE_None
        End



        ModelConditionState = SNOW AWAITING_CONSTRUCTION
            Model = rbwallhubb_b
        Texture  = GBFarm.tga GBFarm_Snow.tga
        Texture  = GBVet.tga GBVet_snow.tga
        Texture  = rbarchrnge.tga rbarchrnge_snow.tga
        Texture  = rbarmory2.tga rbarmory2_snow.tga
        Texture  = rbarmory.tga rbarmory_snow.tga
        Texture  = rbbib.tga rbbib_snow.tga
        Texture  = rbcastkeep.tga rbcastkeep_snow.tga
        Texture  = rbgate.tga rbgate_snow.tga
        Texture  = rbgoldhall.tga rbgoldhall_snow.tga
        Texture  = rbgoldhallbib.tga rbgoldhallbib_snow.tga
        Texture  = rbstable.tga rbstable_snow.tga
        Texture  = rbwatchtow.tga rbwatchtow_snow.tga
        Texture  = rbwell.tga rbwell_snow.tga
        Texture  = tdirt_dma14.tga tdirt_dma14_snow.tga
        Texture  = pfence01.tga pfence01_snow.tga
        Texture  = rpherostat.tga rpherostat_snow.tga
        Texture  = gbhd1.tga gbhd1_snow.tga
        End

        ModelConditionState   = AWAITING_CONSTRUCTION
            Model               = rbwallhubb_b
        End
        AnimationState        = AWAITING_CONSTRUCTION
            Animation           =  rbwallhubb_b
                AnimationName     =  rbwallhubb_b.rbwallhubb_b
                AnimationMode     = MANUAL
                AnimationBlendTime = 0
            End
            Flags                  = START_FRAME_FIRST
        End

        ModelConditionState = SNOW ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Model = rbwallhubb_b
        Texture  = GBFarm.tga GBFarm_Snow.tga
        Texture  = GBVet.tga GBVet_snow.tga
        Texture  = rbarchrnge.tga rbarchrnge_snow.tga
        Texture  = rbarmory2.tga rbarmory2_snow.tga
        Texture  = rbarmory.tga rbarmory_snow.tga
        Texture  = rbbib.tga rbbib_snow.tga
        Texture  = rbcastkeep.tga rbcastkeep_snow.tga
        Texture  = rbgate.tga rbgate_snow.tga
        Texture  = rbgoldhall.tga rbgoldhall_snow.tga
        Texture  = rbgoldhallbib.tga rbgoldhallbib_snow.tga
        Texture  = rbstable.tga rbstable_snow.tga
        Texture  = rbwatchtow.tga rbwatchtow_snow.tga
        Texture  = rbwell.tga rbwell_snow.tga
        Texture  = tdirt_dma14.tga tdirt_dma14_snow.tga
        Texture  = pfence01.tga pfence01_snow.tga
        Texture  = rpherostat.tga rpherostat_snow.tga
        Texture  = gbhd1.tga gbhd1_snow.tga
        End

        ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Model               = rbwallhubb_b
        End

        AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Animation           = rbwallhubb_b
                AnimationName     = rbwallhubb_b.rbwallhubb_b
                AnimationMode     = MANUAL
                AnimationBlendTime = 0
            End
            Flags                  = START_FRAME_FIRST
            StateName              = BeingConstructed
            ParticleSysBone   = NONE WallConstructDust FollowBone:Yes
            BeginScript
                CurDrawablePlaySound("GondorBarracksBeginConstruction")
            EndScript
        End



        ModelConditionState  = DAMAGED
            Model         = rbwallhubb
        Texture     = rbarchrnge.tga rbarchrnge_d.tga
        Texture     = rbarchrngec.tga rbarchrngec_d.tga
        Texture     = rbwatchtow.tga rbwatchtow_d.tga
        End
        AnimationState = DAMAGED
            EnteringStateFX    = FX_BuildingDamaged
        End

        ModelConditionState  = REALLYDAMAGED
            Model         = rbwallhubb
        Texture     = rbarchrnge.tga rbarchrnge_d.tga
        Texture     = rbarchrngec.tga rbarchrngec_d.tga
        Texture     = rbwatchtow.tga rbwatchtow_d.tga
        End

        AnimationState = REALLYDAMAGED
              Animation                =    RubbleAnimation
                AnimationName        =     rbwallhubb.rbwallhubb
                AnimationMode        =    ONCE
              End
            EnteringStateFX    = FX_BuildingReallyDamaged
        End

        ModelConditionState  = COLLAPSING
            Model         = rbwallhubb
        Texture     = rbarchrnge.tga rbarchrnge_d.tga
        Texture     = rbarchrngec.tga rbarchrngec_d.tga
        Texture     = rbwatchtow.tga rbwatchtow_d.tga
        End

        AnimationState = COLLAPSING
              Animation                =    RubbleAnimation
                AnimationName        =     rbwallhubb.rbwallhubb
                AnimationMode        =    ONCE
              End
              EnteringStateFX    = FX_StructureMediumCollapse
              ParticleSysBone NONE HubDestructionDust
        End

        ModelConditionState  = DYING
            Model         = rbwallhubb
        Texture     = rbarchrnge.tga rbarchrnge_d.tga
        Texture     = rbarchrngec.tga rbarchrngec_d.tga
        Texture     = rbwatchtow.tga rbwatchtow_d.tga
        End

        AnimationState = DYING
              Animation                =    RubbleAnimation
                AnimationName        =     rbwallhubb.rbwallhubb
                AnimationMode        =    ONCE
              End
              EnteringStateFX    = FX_StructureMediumCollapse
              ParticleSysBone NONE HubDestructionDust
        End



        ModelConditionState  = RUBBLE
            Model         = None
        End

        ModelConditionState  = POST_RUBBLE
            Model         = NONE
        End
        AnimationState = POST_RUBBLE
        End


        ModelConditionState  = POST_COLLAPSE
            Model         = None
        End

        AnimationState = POST_COLLAPSE
        End


        ModelConditionState = SNOW
            Model = rbwallhubb
        Texture  = GBFarm.tga GBFarm_Snow.tga
        Texture  = GBVet.tga GBVet_snow.tga
        Texture  = rbarchrnge.tga rbarchrnge_snow.tga
        Texture  = rbarmory2.tga rbarmory2_snow.tga
        Texture  = rbarmory.tga rbarmory_snow.tga
        Texture  = rbbib.tga rbbib_snow.tga
        Texture  = rbcastkeep.tga rbcastkeep_snow.tga
        Texture  = rbgate.tga rbgate_snow.tga
        Texture  = rbgoldhall.tga rbgoldhall_snow.tga
        Texture  = rbgoldhallbib.tga rbgoldhallbib_snow.tga
        Texture  = rbstable.tga rbstable_snow.tga
        Texture  = rbwatchtow.tga rbwatchtow_snow.tga
        Texture  = rbwell.tga rbwell_snow.tga
        Texture  = tdirt_dma14.tga tdirt_dma14_snow.tga
        Texture  = pfence01.tga pfence01_snow.tga
        Texture  = rpherostat.tga rpherostat_snow.tga
        Texture  = gbhd1.tga gbhd1_snow.tga
        End
    End


    DisplayName         = OBJECT:RohanWallHub
    Side                = Rohan
    EditorSorting       = STRUCTURE
    ThreatLevel = 1.0
    BuildCost           = ELVEN_CASTLE_WALLHUB_BUILDCOST
    BuildTime           = ELVEN_CASTLE_WALLHUB_BUILDTIME
    VisionRange         = ELVEN_CASTLE_WALLHUB_VISION_RANGE
    ShroudClearingRange = ELVEN_CASTLE_WALLHUB_SHROUD_CLEAR

    CommandSet = RohanCastleWallHubCommandSet


    ArmorSet
        Conditions        = None
        Armor             = ElvenWallArmor
    End



    EvaEventDamagedOwner       = StructureUnderAttack
    EvaEnemyObjectSightedEvent = EnemyCampSighted

    VoiceSelect                        = NeutralWallHubSelect
    VoiceSelectUnderConstruction    = BuildingGoodVoiceSelectUnderConstruction

    SoundOnDamaged                    = BuildingLightDamageStone
    SoundOnReallyDamaged            = BuildingHeavyDamageStone

    UnitSpecificSounds
        UnderConstruction        = BuildingConstructionLoop

        UnderRepairFromRubble    = BuildingConstructionLoop
    End





    CampnessValue = CAMPNESS_WALL


    RadarPriority       = STRUCTURE
    KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE WALL_HUB MADE_OF_STONE WALL_UPGRADE
    ThreatBreakdown ThreatBreakdown_ModuleTag
        AIKindOf = WALL
    End

    Behavior = TerrainResourceBehavior ModuleTag_NewMoneyDeadSpot
        Radius            = 60
        MaxIncome        = 0
        IncomeInterval    = 999999
        HighPriority    = Yes
        Visible = No
    End

    Behavior            = GettingBuiltBehavior ModuleTag_04
        UseSpawnTimerWithoutWorker         = Yes

        SelfRepairFromDamageLoop    = WallConstructionLoop
        SelfRepairFromRubbleLoop    = BuildingConstructionLoop
        SpawnTimer    = DEFAULT_STRUCTURE_HEALDELAY
    End

    Body                = StructureBody ModuleTag_05
        MaxHealth                = 3000
        MaxHealthDamaged        = 1500
        MaxHealthReallyDamaged    = 750
    End

    Behavior                = SlowDeathBehavior ModuleTag_SlowDeath
        DeathTypes            = ALL
        DestructionDelay    = 5000
    End

    Behavior = WallHubBehavior ModuleTag_WALL_HUB

        Options = OPTION_ONE
        MaxBuildoutDistance = DEFAULT_FORTRESS_WALL_EFFECTIVE_RADIUS

        StaggeredBuildFactor = STANDARD_WALL_STAGGERED_BUILD_FACTOR


        SegmentTemplateName = RohanCastleWallSegment
        SegmentTemplateName = RohanCastleWallSegment
        SegmentTemplateName = RohanCastleWallSegment
        SegmentTemplateName = RohanCastleWallSegment
        SegmentTemplateName = RohanCastleWallSegment
        SegmentTemplateName = RohanCastleWallSegment
        SegmentTemplateName = RohanCastleWallSegment
        SegmentTemplateName = RohanCastleWallSegment
        SegmentTemplateName = RohanCastleWallHub

        BuilderRadius = 20

        HubCapTemplateName = RohanCastleWallHub
        DefaultSegmentTemplateName = RohanCastleWallSegment

        CliffCapTemplateName = RohanWallCliffCap




    End


    Behavior = InheritUpgradeCreate ModuleTag_InheritStonework
        Radius = ELVEN_FORTRESS_WALL_EFFECTIVE_RADIUS
        Upgrade = Upgrade_RohanFortressStonework
        ObjectFilter = ANY +RohanCitadel
    End

    Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
        TriggeredBy                = Upgrade_RohanFortressStonework
        AttributeModifier        = EncasingVinesExpansion_Bonus
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowTorches
        TriggeredBy            = Upgrade_RohanFortressStonework
        ShowSubObjects         = STONEWALL
    End



    Geometry              = CYLINDER
    GeometryMajorRadius   = 20.0
    GeometryMinorRadius   = 20.0
    GeometryHeight        = 70.0
    GeometryIsSmall       = No


    AdditionalGeometry      = BOX
    GeometryMajorRadius       = 5.0
    GeometryMinorRadius       = 20.0
    GeometryHeight            = 40.0

    Shadow                = SHADOW_VOLUME
    BuildCompletion     = PLACED_BY_PLAYER

End



Object RohanCastleWallGate


       SelectPortrait = BRRohanGate

     Draw = W3DScriptedModelDraw ModuleTag_Draw
         OkToChangeModelColor  = Yes
         UseStandardModelNames = Yes

         DefaultModelConditionState
            Model                = rbwallgate
        End

        AnimationState = DOOR_1_OPENING
            StateName            = STATE_Open
            Animation            = Open
                AnimationName        = rbwallgate.rbwallgate
                AnimationMode        = ONCE
                AnimationBlendTime     = 0
            End
            Flags = START_FRAME_LAST
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Closed" then CurDrawableSetTransitionAnimState("TRANS_Closed_To_Open") end
            EndScript
        End

        TransitionState = TRANS_Closed_To_Open
            Animation             = Open
                AnimationName        = rbwallgate.rbwallgate
                AnimationMode        = ONCE
            End
        End

        AnimationState = DOOR_1_CLOSING
            StateName             = STATE_Closed
            Animation             = Close
                AnimationName        = rbwallgate.rbwallgate
                AnimationMode        = ONCE_BACKWARDS
                AnimationBlendTime     = 0
            End
            Flags                = START_FRAME_FIRST
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Open" then CurDrawableSetTransitionAnimState("TRANS_Open_To_Closed") end
            EndScript
        End

        TransitionState = TRANS_Open_To_Closed
            Animation            = Open
                AnimationName        = rbwallgate.rbwallgate
                AnimationMode        = ONCE_BACKWARDS
            End
            Flags                = START_FRAME_LAST
        End
    End


    DisplayName         = OBJECT:ElvenCastleWallGate
    Side                = Rohan
    EditorSorting       = STRUCTURE
    ThreatLevel         = 1.0
    Scale               = 0.9

    BuildCost           = ELVEN_CASTLE_WALLGATE_BUILDCOST
    BuildTime           = ELVEN_CASTLE_WALLGATE_BUILDTIME
    VisionRange         = ELVEN_CASTLE_WALLGATE_VISION_RANGE
    ShroudClearingRange = ELVEN_CASTLE_WALLGATE_SHROUD_CLEAR

    CommandSet            = CastleGateCommandSet



    EvaEventDamagedOwner       = StructureUnderAttack
    EvaEnemyObjectSightedEvent = EnemyCampSighted

    VoiceSelect                        = GateSelect
    VoiceSelectUnderConstruction    = BuildingGoodVoiceSelectUnderConstruction

     SoundOnDamaged                    = BuildingLightDamageStone
     SoundOnReallyDamaged            = BuildingHeavyDamageStone

    UnitSpecificSounds
        UnderConstruction        = BuildingConstructionLoop

        UnderRepairFromRubble    = BuildingConstructionLoop
    End

    ClientBehavior = ModelConditionAudioLoopClientBehavior ModuleTag_PlayCollapseSound
        ModelCondition = REQUIRED:RUBBLE Sound:BuildingSink
    End

    CampnessValue = CAMPNESS_WALL


    RadarPriority       = STRUCTURE
    KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE WALL_UPGRADE MADE_OF_STONE BLOCKING_GATE WALL_GATE
    ThreatBreakdown ThreatBreakdown_ModuleTag
        AIKindOf = WALL
    End

    Behavior            = GettingBuiltBehavior ModuleTag_04
        SelfBuildingLoop            = WallConstructionLoop
        SelfRepairFromDamageLoop    = NoSound
        SelfRepairFromRubbleLoop    = WallConstructionLoop
        SpawnTimer                    = -1.0
        RebuildTimeSeconds            = ELVEN_CASTLE_WALLGATE_BUILDTIME
    End

    ArmorSet
        Conditions        = None
        Armor             = ElvenWallArmor
    End

    Body                = StructureBody ModuleTag_05
        MaxHealth                = 3000
        MaxHealthDamaged        = 3000
        MaxHealthReallyDamaged    = 3000
    End

    Behavior            = SlowDeathBehavior ModuleTag_SlowDeath
        DeathTypes            = ALL
        DestructionDelay = 5000
    End

    Behavior = GateOpenAndCloseBehavior ModuleTag_GATE
        ResetTimeInMilliseconds        = 12200
        OpenByDefault            = Yes
        PercentOpenForPathing        = 50
        SoundOpeningGateLoop        = GateOpenStart
        SoundClosingGateLoop        = GateCloseStart
        SoundFinishedOpeningGate    = GateOpenEnd
        SoundFinishedClosingGate    = GateCloseEnd
        TimeBeforePlayingOpenSound    = 9500
        TimeBeforePlayingClosedSound    = 9500
    End



    Behavior = FakePathfindPortalBehaviour ModuleTag_FAKEPATHFIND
        AllowEnemies            = No
        AllowNonSkirmishAIUnits = No
    End

    Behavior = AIGateUpdate ModuleTage_AIGateUpdate
        TriggerWidthX = 200.0
        TriggerWidthY = 100.0
    End




    GeometryIsSmall            = No


    Geometry                  = BOX
    GeometryMajorRadius       = 10.0
    GeometryMinorRadius       = 10.0
    GeometryHeight            = 75
    GeometryOffset            = X:0 Y:50 Z:0


    AdditionalGeometry        = BOX
    GeometryMajorRadius       = 10.0
    GeometryMinorRadius       = 10.0
    GeometryHeight            = 75
    GeometryOffset            = X:0 Y:-50 Z:0


    AdditionalGeometry        = BOX
    GeometryName              = "Closed"
    GeometryMajorRadius       = 9.0
    GeometryMinorRadius       = 50.0
    GeometryHeight            = 50


    AdditionalGeometry        = BOX
    GeometryName              = "OpenLeft"
    GeometryMajorRadius       = 9.0
    GeometryMinorRadius       = 10.0
    GeometryHeight            = 40
    GeometryOffset            = X:0 Y:-30 Z:0


    AdditionalGeometry        = BOX
    GeometryName              = "OpenRight"
    GeometryMajorRadius       = 9.0
    GeometryMinorRadius       = 10.0
    GeometryHeight            = 40
    GeometryOffset            = X:0 Y:30 Z:0

    GeometryContactPoint    = X:0 Y:-50 Z:75
    GeometryContactPoint    = X:0 Y:-50 Z:10
    GeometryContactPoint    = X:0 Y:50 Z:10
    GeometryContactPoint    = X:0 Y:50 Z:75

    Shadow                    = SHADOW_VOLUME
    BuildCompletion            = PLACED_BY_PLAYER
End



Object RohanWallCliffCap


    SelectPortrait      =  BRRohanWall


    Draw = W3DScriptedModelDraw ModuleTag_Draw
        OkToChangeModelColor  = Yes
        UseStandardModelNames = Yes
        DefaultModelConditionState
            Model = rbmauer
        End


        ModelConditionState = SNOW ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Model = rbmauer_b
        Texture  = GBFarm.tga GBFarm_Snow.tga
        Texture  = GBVet.tga GBVet_snow.tga
        Texture  = rbarchrnge.tga rbarchrnge_snow.tga
        Texture  = rbarmory2.tga rbarmory2_snow.tga
        Texture  = rbarmory.tga rbarmory_snow.tga
        Texture  = rbbib.tga rbbib_snow.tga
        Texture  = rbcastkeep.tga rbcastkeep_snow.tga
        Texture  = rbgate.tga rbgate_snow.tga
        Texture  = rbgoldhall.tga rbgoldhall_snow.tga
        Texture  = rbgoldhallbib.tga rbgoldhallbib_snow.tga
        Texture  = rbstable.tga rbstable_snow.tga
        Texture  = rbwatchtow.tga rbwatchtow_snow.tga
        Texture  = rbwell.tga rbwell_snow.tga
        Texture  = tdirt_dma14.tga tdirt_dma14_snow.tga
        Texture  = pfence01.tga pfence01_snow.tga
        Texture  = rpherostat.tga rpherostat_snow.tga
        Texture  = gbhd1.tga gbhd1_snow.tga
            ParticleSysBone   = NONE WallConstructDust FollowBone:Yes
        End
        ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Model               = rbmauer_b
            ParticleSysBone   = NONE WallConstructDust FollowBone:Yes
        End
        AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
              Animation                =    rbmauer_b
                AnimationName        =     rbmauer_b.rbmauer_b
                AnimationMode     = MANUAL
                AnimationBlendTime = 0
            End
            Flags                  = START_FRAME_FIRST
        End

        IdleAnimationState

               StateName = STATE_None
        End




        ModelConditionState  = DAMAGED
            Model         = rbmauer
        Texture     = rbarchrnge.tga rbarchrnge_d.tga
        Texture     = rbarchrngec.tga rbarchrngec_d.tga
        Texture     = rbwatchtow.tga rbwatchtow_d.tga
        End

        AnimationState = DAMAGED
            EnteringStateFX    = FX_WallDamaged
        End

        ModelConditionState  = REALLYDAMAGED
            Model         = rbmauer
        Texture     = rbarchrnge.tga rbarchrnge_d.tga
        Texture     = rbarchrngec.tga rbarchrngec_d.tga
        Texture     = rbwatchtow.tga rbwatchtow_d.tga
        End

        AnimationState = REALLYDAMAGED
              Animation                =    RubbleAnimation
                AnimationName        =     rbmauer.rbmauer
                AnimationMode        =    ONCE
              End
            EnteringStateFX    = FX_WallDamaged
        End

        ModelConditionState  = COLLAPSING
            Model         = rbmauer
        Texture     = rbarchrnge.tga rbarchrnge_d.tga
        Texture     = rbarchrngec.tga rbarchrngec_d.tga
        Texture     = rbwatchtow.tga rbwatchtow_d.tga
        End

        AnimationState = COLLAPSING
              Animation                =    RubbleAnimation
                AnimationName        =     rbmauer.rbmauer
                AnimationMode        =    ONCE
              End
              ParticleSysBone NONE WallDestructionDust
            EnteringStateFX            = FX_StructureMediumCollapse
        End

        ModelConditionState  = RUBBLE
            Model         = None
        End
        AnimationState = RUBBLE
        End

        ModelConditionState  = POST_RUBBLE
            Model         = None
        End
        AnimationState = POST_RUBBLE
        End

        ModelConditionState  = POST_COLLAPSE
            Model         = None
        End
        AnimationState = POST_COLLAPSE
        End


        ModelConditionState = SNOW
            Model = rbmauer
        Texture  = GBFarm.tga GBFarm_Snow.tga
        Texture  = GBVet.tga GBVet_snow.tga
        Texture  = rbarchrnge.tga rbarchrnge_snow.tga
        Texture  = rbarmory2.tga rbarmory2_snow.tga
        Texture  = rbarmory.tga rbarmory_snow.tga
        Texture  = rbbib.tga rbbib_snow.tga
        Texture  = rbcastkeep.tga rbcastkeep_snow.tga
        Texture  = rbgate.tga rbgate_snow.tga
        Texture  = rbgoldhall.tga rbgoldhall_snow.tga
        Texture  = rbgoldhallbib.tga rbgoldhallbib_snow.tga
        Texture  = rbstable.tga rbstable_snow.tga
        Texture  = rbwatchtow.tga rbwatchtow_snow.tga
        Texture  = rbwell.tga rbwell_snow.tga
        Texture  = tdirt_dma14.tga tdirt_dma14_snow.tga
        Texture  = pfence01.tga pfence01_snow.tga
        Texture  = rpherostat.tga rpherostat_snow.tga
        Texture  = gbhd1.tga gbhd1_snow.tga
        End

    End









    DisplayName         = OBJECT:ElvenCastleWallSegment
    Side                = Rohan
    EditorSorting       = STRUCTURE
    ThreatLevel            = 1.0

    CommandSet            = ElvenWallCliffCapCommandSet

    BuildCost           = MEN_WALLSEGMENT_SMALL_BUILDCOST
    BuildTime           = MEN_WALLSEGMENT_SMALL_BUILDTIME
    VisionRange         = MEN_WALLSEGMENT_SMALL_VISION_RANGE
    ShroudClearingRange = MEN_WALLSEGMENT_SMALL_SHROUD_CLEAR



    EvaEventDamagedOwner       = StructureUnderAttack
    EvaEnemyObjectSightedEvent = EnemyCampSighted

    VoiceSelectUnderConstruction    = BuildingGoodVoiceSelectUnderConstruction

    SoundOnDamaged                    = BuildingLightDamageStone
    SoundOnReallyDamaged            = BuildingHeavyDamageStone

    UnitSpecificSounds
        UnderConstruction        = WallConstructionLoop

        UnderRepairFromRubble    = WallConstructionLoop
    End

    ClientBehavior = ModelConditionAudioLoopClientBehavior ModuleTag_PlayCollapseSound
        ModelCondition = REQUIRED:RUBBLE Sound:BuildingSink
    End

    CampnessValue = CAMPNESS_WALL


    RadarPriority       = STRUCTURE
    KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE DEFENSIVE_WALL MADE_OF_STONE CAN_CAST_REFLECTIONS
    ThreatBreakdown ThreatBreakdown_ModuleTag
        AIKindOf = WALL
    End

    ArmorSet
        Conditions        = None
        Armor             = ElvenWallArmor
    End

    Behavior            = GettingBuiltBehavior ModuleTag_04
        UseSpawnTimerWithoutWorker         = Yes

        SelfBuildingLoop            = WallConstructionLoop

        SelfRepairFromRubbleLoop    = WallConstructionLoop
        SpawnTimer    = DEFAULT_STRUCTURE_HEALDELAY
    End

    Body                = StructureBody ModuleTag_05
        MaxHealth                = 2500
        MaxHealthDamaged        = 1250
        MaxHealthReallyDamaged    = 625
    End






    Behavior = KeepObjectDie ModuleTag_IWantRubble
        DeathTypes            = ALL -SUICIDED
    End
    Behavior            = SlowDeathBehavior ModuleTag_SlowDeath
        DeathTypes            = NONE +SUICIDED
        DestructionDelay = 5000
    End



    Behavior = InheritUpgradeCreate ModuleTag_InheritStonework
        Radius = ELVEN_FORTRESS_WALL_EFFECTIVE_RADIUS
        Upgrade = Upgrade_RohanFortressStonework
        ObjectFilter = ANY +RohanCitadel
    End

    Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
        TriggeredBy                = Upgrade_RohanFortressStonework
        AttributeModifier        = EncasingVinesExpansion_Bonus
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowTorches
        TriggeredBy            = Upgrade_RohanFortressStonework
        ShowSubObjects         = STONEWALL
    End

    Behavior = SubObjectsUpgrade ModuleTag_HideAll
        TriggeredBy            = Upgrade_StructureLevel1
        HideSubObjects         = STONEWALL
    End


    Geometry                  = BOX
    GeometryMajorRadius       = 5.0
    GeometryMinorRadius       = 20.0
    GeometryHeight            = 40.0

    GeometryIsSmall                = No

    Shadow                    = SHADOW_VOLUME
    BuildCompletion                = PLACED_BY_PLAYER
End



Object RohanCastleWallCatapult



  SelectPortrait  =  UPGondor_Trebuchet

    Draw = W3DScriptedModelDraw ModuleTag_Draw
        OkToChangeModelColor  = Yes
        UseStandardModelNames = Yes

        DefaultModelConditionState
            Model = rbsmlhub
        End

        WallBoundsMesh = P1


        ModelConditionState = SNOW AWAITING_CONSTRUCTION
            Model = rbsmlhub_b
        Texture  = GBFarm.tga GBFarm_Snow.tga
        Texture  = GBVet.tga GBVet_snow.tga
        Texture  = rbarchrnge.tga rbarchrnge_snow.tga
        Texture  = rbarmory2.tga rbarmory2_snow.tga
        Texture  = rbarmory.tga rbarmory_snow.tga
        Texture  = rbbib.tga rbbib_snow.tga
        Texture  = rbcastkeep.tga rbcastkeep_snow.tga
        Texture  = rbgate.tga rbgate_snow.tga
        Texture  = rbgoldhall.tga rbgoldhall_snow.tga
        Texture  = rbgoldhallbib.tga rbgoldhallbib_snow.tga
        Texture  = rbstable.tga rbstable_snow.tga
        Texture  = rbwatchtow.tga rbwatchtow_snow.tga
        Texture  = rbwell.tga rbwell_snow.tga
        Texture  = tdirt_dma14.tga tdirt_dma14_snow.tga
        Texture  = pfence01.tga pfence01_snow.tga
        Texture  = rpherostat.tga rpherostat_snow.tga
        Texture  = gbhd1.tga gbhd1_snow.tga
        End

        ModelConditionState   = AWAITING_CONSTRUCTION
            Model               = rbsmlhub_a
        End
        AnimationState        = AWAITING_CONSTRUCTION
            Animation           =  rbsmlhub_a
                AnimationName     =  rbsmlhub_a.rbsmlhub_a
                AnimationMode     = MANUAL
                AnimationBlendTime = 0
            End
            Flags                  = START_FRAME_FIRST
        End

        ModelConditionState = SNOW ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Model = rbsmlhub_a
        Texture  = GBFarm.tga GBFarm_Snow.tga
        Texture  = GBVet.tga GBVet_snow.tga
        Texture  = rbarchrnge.tga rbarchrnge_snow.tga
        Texture  = rbarmory2.tga rbarmory2_snow.tga
        Texture  = rbarmory.tga rbarmory_snow.tga
        Texture  = rbbib.tga rbbib_snow.tga
        Texture  = rbcastkeep.tga rbcastkeep_snow.tga
        Texture  = rbgate.tga rbgate_snow.tga
        Texture  = rbgoldhall.tga rbgoldhall_snow.tga
        Texture  = rbgoldhallbib.tga rbgoldhallbib_snow.tga
        Texture  = rbstable.tga rbstable_snow.tga
        Texture  = rbwatchtow.tga rbwatchtow_snow.tga
        Texture  = rbwell.tga rbwell_snow.tga
        Texture  = tdirt_dma14.tga tdirt_dma14_snow.tga
        Texture  = pfence01.tga pfence01_snow.tga
        Texture  = rpherostat.tga rpherostat_snow.tga
        Texture  = gbhd1.tga gbhd1_snow.tga
        End

        ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Model               = rbsmlhub_a
        End

        AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Animation           = rbsmlhub_a
                AnimationName     = rbsmlhub_a.rbsmlhub_a
                AnimationMode     = MANUAL
                AnimationBlendTime = 0
            End
            Flags                  = START_FRAME_FIRST
            StateName              = BeingConstructed
            ParticleSysBone   = NONE WallConstructDust FollowBone:Yes
        End



        ModelConditionState  = DAMAGED
            Model         = rbsmlhub
        End
        AnimationState = DAMAGED
            EnteringStateFX    = FX_BuildingDamaged
        End

        ModelConditionState  = REALLYDAMAGED
        Model         = rbsmlhub
            ParticleSysBone FireSmall01 SmokeBuildingMedium
            ParticleSysBone FireSmall02 FireBuildingLarge
            ParticleSysBone FireSmall03 FireBuildingMedium
            ParticleSysBone FireSmall04 FireBuildingMedium
            ParticleSysBone FireSmall05 FireBuildingLarge
        End

        AnimationState = REALLYDAMAGED
            EnteringStateFX    = FX_BuildingReallyDamaged
            Animation                =    RubbleAnimation
                    AnimationName        =    rbsmlhub.rbsmlhub
                    AnimationMode        =    ONCE
              End
        End

        ModelConditionState  = RUBBLE
        Model         = rbsmlhub
        ParticleSysBone SmokeLarge01 SmokeBuildingLarge
        End

        AnimationState = RUBBLE
            EnteringStateFX    = FX_StructureMediumCollapse
            Animation                =    RubbleAnimation
                    AnimationName        =    rbsmlhub.rbsmlhub
                    AnimationMode        =    ONCE
              End
        End

        ModelConditionState  = POST_RUBBLE
            Model         = None
        End

        ModelConditionState  = POST_COLLAPSE
            Model         = None
        End

        ModelConditionState  = SNOW
            Model         = rbsmlhub
        Texture  = GBFarm.tga GBFarm_Snow.tga
        Texture  = GBVet.tga GBVet_snow.tga
        Texture  = rbarchrnge.tga rbarchrnge_snow.tga
        Texture  = rbarmory2.tga rbarmory2_snow.tga
        Texture  = rbarmory.tga rbarmory_snow.tga
        Texture  = rbbib.tga rbbib_snow.tga
        Texture  = rbcastkeep.tga rbcastkeep_snow.tga
        Texture  = rbgate.tga rbgate_snow.tga
        Texture  = rbgoldhall.tga rbgoldhall_snow.tga
        Texture  = rbgoldhallbib.tga rbgoldhallbib_snow.tga
        Texture  = rbstable.tga rbstable_snow.tga
        Texture  = rbwatchtow.tga rbwatchtow_snow.tga
        Texture  = rbwell.tga rbwell_snow.tga
        Texture  = tdirt_dma14.tga tdirt_dma14_snow.tga
        Texture  = pfence01.tga pfence01_snow.tga
        Texture  = rpherostat.tga rpherostat_snow.tga
        Texture  = gbhd1.tga gbhd1_snow.tga
        End
    End




    DisplayName         = OBJECT:DwarvenCastleWallCatapultSmall
    Side                = Rohan
    EditorSorting       = STRUCTURE
    ThreatLevel         = 1.0
    Scale               = 1.3
    BuildCost           = DWARVEN_WALLCATAPULT_SMALL_BUILDCOST
    BuildTime           = DWARVEN_WALLCATAPULT_SMALL_BUILDTIME
    VisionRange         = DWARVEN_WALLCATAPULT_SMALL_VISION_RANGE
    ShroudClearingRange = DWARVEN_WALLCATAPULT_SMALL_SHROUD_CLEAR

    ArmorSet
        Conditions        = None
        Armor             = ElvenWallArmor
    End



    EvaEventDamagedOwner       = StructureUnderAttack
    EvaEnemyObjectSightedEvent = EnemyCampSighted

    VoiceSelect                        = DwarvenCatapultExpansionSelect
    VoiceSelectUnderConstruction    = BuildingEvilVoiceSelectUnderConstruction

    SoundOnDamaged                    = BuildingLightDamageStone
    SoundOnReallyDamaged            = BuildingHeavyDamageStone

    UnitSpecificSounds
        UnderConstruction        = WallConstructionLoop

        UnderRepairFromRubble    = WallConstructionLoop
    End

    CampnessValue = CAMPNESS_WALL


    RadarPriority       = STRUCTURE
    KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE MADE_OF_STONE IGNORE_FOR_VICTORY WALL_UPGRADE

    Behavior                        = GettingBuiltBehavior ModuleTag_04
        UseSpawnTimerWithoutWorker         = Yes
        SpawnTimer    = DEFAULT_STRUCTURE_HEALDELAY
        RebuildTimeSeconds            = 30
        SelfBuildingLoop            = WallConstructionLoop
        SelfRepairFromDamageLoop     = NoSound
        SelfRepairFromRubbleLoop    = WallConstructionLoop
    End

    Body                = StructureBody ModuleTag_05
        MaxHealth                = 1500
        MaxHealthDamaged        = 1500
        MaxHealthReallyDamaged    = 1500
    End




    Behavior = ProductionUpdate ProductionUpdateModuleTag
    End
    Behavior = GrantUpgradeCreate ModuleTag_ActLikeAnOldUpgrade
        UpgradeToGrant = Upgrade_TrebuchetTurret
        GiveOnBuildComplete = Yes
    End
    Behavior = CommandSetUpgrade ModueTag_TrebCommandSet
        TriggeredBy            = Upgrade_TrebuchetTurret
        ConflictsWith        = Upgrade_HasWallTrebuchet
        CommandSet            = RohanUpgradeCommandSetBuyNewCatapult
    End
    Behavior = CommandSetUpgrade ModueTag_TrebCommandSet3
        TriggeredBy            = Upgrade_HasWallTrebuchet Upgrade_TrebuchetTurret
        CommandSet            = SellableCommandSet
        RequiresAllTriggers    = Yes
    End
    Behavior = ObjectCreationUpgrade MakeTheFreeTreb
        TriggeredBy        = Upgrade_TrebuchetTurret
        Delay            = 0.0

        RemoveUpgrade    = Upgrade_WallTrebuchetButtonEnable
        GrantUpgrade    = Upgrade_HasWallTrebuchet
        DestroyWhenSold = Yes
        DeathAnimAndDuration = AnimState:DEATH_2 AnimTime:999999
        Offset            = X:0.0 Y:0.0 Z:60.0
    End
    Behavior = ObjectCreationUpgrade MakeTheFreeTreb2
        TriggeredBy        = Upgrade_HasWallTrebuchet
        ConflictsWith    = Upgrade_OpenGarrison Upgrade_PosternGate
        Delay            = 0.0

        RemoveUpgrade    = Upgrade_WallTrebuchetButtonEnable
        ThingToSpawn    = RohanTrebuchetFortress
        Offset            = X:0.0 Y:0.0 Z:60.0
        FadeInTime        = 600
    End
    Behavior = SlaveWatcherBehavior WatchTheTreb
        RemoveUpgrade        = Upgrade_HasWallTrebuchet
        GrantUpgrade        = Upgrade_WallTrebuchetButtonEnable
        ShareUpgrades        = Yes
    End

    Behavior                = SlowDeathBehavior ModuleTag_SlowDeath
        DeathTypes            = ALL
        DestructionDelay    = 5000
    End


    Behavior = InheritUpgradeCreate ModuleTag_InheritStonework
        Radius = ELVEN_FORTRESS_WALL_EFFECTIVE_RADIUS
        Upgrade = Upgrade_RohanFortressStonework
        ObjectFilter = ANY +RohanCitadel
    End

    Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
        TriggeredBy                = Upgrade_RohanFortressStonework
        AttributeModifier        = EncasingVinesExpansion_Bonus
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowTorches
        TriggeredBy            = Upgrade_RohanFortressStonework
        ShowSubObjects         = STONEWALL
    End

    Behavior = SubObjectsUpgrade ModuleTag_HideAll
        TriggeredBy            = Upgrade_StructureLevel1
        HideSubObjects         = STONEWALL
    End






    Geometry                  = BOX
    GeometryMajorRadius       = 5.0
    GeometryMinorRadius       = 20.0
    GeometryHeight            = 40.0

    GeometryIsSmall           = No

    Shadow                    = SHADOW_VOLUME
    BuildCompletion           = PLACED_BY_PLAYER
End



Object RohanCastleWallTower


    SelectPortrait = BRRohanGarrision


  Draw = W3DScriptedModelDraw ModuleTag_Draw
        OkToChangeModelColor  = Yes
        UseStandardModelNames = Yes

        ExtraPublicBone = ARROW_01
        ExtraPublicBone = ARROW_02
        ExtraPublicBone = ARROW_03
        ExtraPublicBone = ARROW_04

        DefaultModelConditionState
            Model                = rbsmlturma
        End



        ModelConditionState   = AWAITING_CONSTRUCTION
            Model               = rbsmlturma_a
        End
        ModelConditionState   = AWAITING_CONSTRUCTION SNOW
            Model               = rbsmlturma_a
        Texture  = GBFarm.tga GBFarm_Snow.tga
        Texture  = GBVet.tga GBVet_snow.tga
        Texture  = rbarchrnge.tga rbarchrnge_snow.tga
        Texture  = rbarmory2.tga rbarmory2_snow.tga
        Texture  = rbarmory.tga rbarmory_snow.tga
        Texture  = rbbib.tga rbbib_snow.tga
        Texture  = rbcastkeep.tga rbcastkeep_snow.tga
        Texture  = rbgate.tga rbgate_snow.tga
        Texture  = rbgoldhall.tga rbgoldhall_snow.tga
        Texture  = rbgoldhallbib.tga rbgoldhallbib_snow.tga
        Texture  = rbstable.tga rbstable_snow.tga
        Texture  = rbwatchtow.tga rbwatchtow_snow.tga
        Texture  = rbwell.tga rbwell_snow.tga
        Texture  = tdirt_dma14.tga tdirt_dma14_snow.tga
        Texture  = pfence01.tga pfence01_snow.tga
        Texture  = rpherostat.tga rpherostat_snow.tga
        Texture  = gbhd1.tga gbhd1_snow.tga
        End
        AnimationState        = AWAITING_CONSTRUCTION
            Animation           =  rbsmlturma_a
                AnimationName     =  rbsmlturma_a.rbsmlturma_a
                AnimationMode     = MANUAL
                AnimationBlendTime = 0
            End
            Flags                  = START_FRAME_FIRST
        End


        ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Model               = rbsmlturma_a
            ParticleSysBone   = NONE WallConstructDust FollowBone:Yes
        End

        ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED SNOW
            Model               = rbsmlturma_a
        Texture  = GBFarm.tga GBFarm_Snow.tga
        Texture  = GBVet.tga GBVet_snow.tga
        Texture  = rbarchrnge.tga rbarchrnge_snow.tga
        Texture  = rbarmory2.tga rbarmory2_snow.tga
        Texture  = rbarmory.tga rbarmory_snow.tga
        Texture  = rbbib.tga rbbib_snow.tga
        Texture  = rbcastkeep.tga rbcastkeep_snow.tga
        Texture  = rbgate.tga rbgate_snow.tga
        Texture  = rbgoldhall.tga rbgoldhall_snow.tga
        Texture  = rbgoldhallbib.tga rbgoldhallbib_snow.tga
        Texture  = rbstable.tga rbstable_snow.tga
        Texture  = rbwatchtow.tga rbwatchtow_snow.tga
        Texture  = rbwell.tga rbwell_snow.tga
        Texture  = tdirt_dma14.tga tdirt_dma14_snow.tga
        Texture  = pfence01.tga pfence01_snow.tga
        Texture  = rpherostat.tga rpherostat_snow.tga
        Texture  = gbhd1.tga gbhd1_snow.tga
            ParticleSysBone   = NONE WallConstructDust FollowBone:Yes
        End

        AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Animation           = rbsmlturma_a
                AnimationName     = rbsmlturma_a.rbsmlturma_a
                AnimationMode     = MANUAL
                AnimationBlendTime = 0
            End
            Flags                  = START_FRAME_FIRST




        End




        ModelConditionState  = DAMAGED
            Model         = rbsmlturma
        Texture     = rbarchrnge.tga rbarchrnge_d.tga
        Texture     = rbarchrngec.tga rbarchrngec_d.tga
        Texture     = rbwatchtow.tga rbwatchtow_d.tga
        End
        AnimationState = DAMAGED
        End

        ModelConditionState  = REALLYDAMAGED
            Model         = rbsmlturma
        Texture     = rbarchrnge.tga rbarchrnge_d.tga
        Texture     = rbarchrngec.tga rbarchrngec_d.tga
        Texture     = rbwatchtow.tga rbwatchtow_d.tga
        End

        AnimationState = REALLYDAMAGED
              Animation                =    RubbleAnimation
                AnimationName        =     rbsmlturma.rbsmlturma
                AnimationMode        =    ONCE
              End
            EnteringStateFX    = FX_BuildingReallyDamaged
        End

        ModelConditionState  = COLLAPSING
            Model         = rbsmlturma
        Texture     = rbarchrnge.tga rbarchrnge_d.tga
        Texture     = rbarchrngec.tga rbarchrngec_d.tga
        Texture     = rbwatchtow.tga rbwatchtow_d.tga
        End
        AnimationState = COLLAPSING
              Animation                =    RubbleAnimation
                AnimationName        =     rbsmlturma.rbsmlturma
                AnimationMode        =    ONCE
              End
            EnteringStateFX            = FX_StructureMediumCollapse
        End

        ModelConditionState  = DYING
            Model         = rbsmlturma
        Texture     = rbarchrnge.tga rbarchrnge_d.tga
        Texture     = rbarchrngec.tga rbarchrngec_d.tga
        Texture     = rbwatchtow.tga rbwatchtow_d.tga
        End
        AnimationState = DYING
              Animation                =    RubbleAnimation
                AnimationName        =     rbsmlturma.rbsmlturma
                AnimationMode        =    ONCE
              End
            EnteringStateFX            = FX_StructureMediumCollapse
        End

        ModelConditionState  = RUBBLE
            Model         = None
        End

        ModelConditionState  = POST_RUBBLE
            Model         = NONE
            ParticleSysBone NONE SmokeBuildingMediumRubble
        End
        AnimationState = POST_RUBBLE
        End

        ModelConditionState  = POST_COLLAPSE
        Model         = None
            ParticleSysBone NONE SmokeBuildingMediumRubble
        End
        AnimationState = POST_COLLAPSE
        End

        ModelConditionState    = UPGRADE_NUMENOR_STONEWORK
            Model    = rbsmlturma
            Texture    = DBFortress1.tga DBFortress_U.tga
        End

        ModelConditionState = SNOW
            Model = rbsmlturma
        Texture  = GBFarm.tga GBFarm_Snow.tga
        Texture  = GBVet.tga GBVet_snow.tga
        Texture  = rbarchrnge.tga rbarchrnge_snow.tga
        Texture  = rbarmory2.tga rbarmory2_snow.tga
        Texture  = rbarmory.tga rbarmory_snow.tga
        Texture  = rbbib.tga rbbib_snow.tga
        Texture  = rbcastkeep.tga rbcastkeep_snow.tga
        Texture  = rbgate.tga rbgate_snow.tga
        Texture  = rbgoldhall.tga rbgoldhall_snow.tga
        Texture  = rbgoldhallbib.tga rbgoldhallbib_snow.tga
        Texture  = rbstable.tga rbstable_snow.tga
        Texture  = rbwatchtow.tga rbwatchtow_snow.tga
        Texture  = rbwell.tga rbwell_snow.tga
        Texture  = tdirt_dma14.tga tdirt_dma14_snow.tga
        Texture  = pfence01.tga pfence01_snow.tga
        Texture  = rpherostat.tga rpherostat_snow.tga
        Texture  = gbhd1.tga gbhd1_snow.tga
        End
    End



    DisplayName         = OBJECT:RohanCastleWallTower
    Side                = Rohan
    EditorSorting       = STRUCTURE
    ThreatLevel            = 1.0
    ThreatBreakdown ModuleTag_DetailedThreat
        AIKindOf = WALL
    End

    BuildCost           = DWARVEN_WALLTOWER_SMALL_BUILDCOST
    BuildTime           = DWARVEN_WALLTOWER_SMALL_BUILDTIME
    VisionRange         = DWARVEN_WALLTOWER_SMALL_VISION_RANGE
    ShroudClearingRange = DWARVEN_WALLTOWER_SMALL_SHROUD_CLEAR

    ArmorSet
        Conditions        = None
        Armor             = ElvenWallArmor
    End

    CommandSet    = SellableCommandSet



    EvaEventDamagedOwner       = StructureUnderAttack
    EvaEnemyObjectSightedEvent = EnemyCampSighted

    VoiceSelect                        = DwarfTowerWallSelect
    VoiceSelectUnderConstruction    = BuildingEvilVoiceSelectUnderConstruction

    SoundOnDamaged                    = BuildingLightDamageStone
    SoundOnReallyDamaged            = BuildingHeavyDamageStone

    UnitSpecificSounds
        UnderConstruction        = WallConstructionLoop

        UnderRepairFromRubble    = WallConstructionLoop
    End

    CampnessValue = CAMPNESS_WALL


    RadarPriority       = STRUCTURE
    KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE MADE_OF_STONE CAN_ATTACK IGNORE_FOR_VICTORY WALL_UPGRADE

    Behavior                        = GettingBuiltBehavior ModuleTag_04
        UseSpawnTimerWithoutWorker         = Yes
        SpawnTimer    = DEFAULT_STRUCTURE_HEALDELAY
        RebuildTimeSeconds            = 30
        SelfBuildingLoop            = WallConstructionLoop
        SelfRepairFromDamageLoop     = WallConstructionLoop
        SelfRepairFromRubbleLoop    = WallConstructionLoop
    End


    Behavior = AIUpdateInterface ModuleTag_SoWeCanUseWeapon
         AutoAcquireEnemiesWhenIdle    = Yes
         MoodAttackCheckRate            = 250
     End

    Body = StructureBody ModuleTag_05
        MaxHealth = 2500
    End


    Behavior = SpawnPointProductionExitUpdate ModuleTag_ProductionExit
        SpawnPointBoneName = ARROW_
    End


    Behavior = SpawnBehavior ModuleTag_Spawn
        SpawnNumber                             = 5
        InitialBurst                            = 5
        SpawnTemplateName                       = RohanArcherTower_Slaved
        KillSpawnsBasedOnModelConditionState    = Yes
        SpawnReplaceDelay                       = 999999
        CanReclaimOrphans                       = No
        SpawnedRequireSpawner                   = Yes
        ShareUpgrades                           = Yes
    End

    Behavior            = SlowDeathBehavior ModuleTag_SlowDeath
        DeathTypes            = ALL
        DestructionDelay    = 5000
    End


    Behavior = InheritUpgradeCreate ModuleTag_InheritStonework
        Radius = ELVEN_FORTRESS_WALL_EFFECTIVE_RADIUS
        Upgrade = Upgrade_RohanFortressStonework
        ObjectFilter = ANY +RohanCitadel
    End

    Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
        TriggeredBy                = Upgrade_RohanFortressStonework
        AttributeModifier        = EncasingVinesExpansion_Bonus
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowTorches
        TriggeredBy            = Upgrade_RohanFortressStonework
        ShowSubObjects         = STONEWALL
    End


    Geometry                  = BOX
    GeometryMajorRadius       = 5.0
    GeometryMinorRadius       = 20.0
    GeometryHeight            = 40.0

    GeometryIsSmall           = No

    Shadow                    = SHADOW_VOLUME
    BuildCompletion           = PLACED_BY_PLAYER
End



Object RohanCastleWallBanner


    SelectPortrait = BRPWall_Upgrade


  Draw = W3DScriptedModelDraw ModuleTag_Draw
        OkToChangeModelColor  = Yes
        UseStandardModelNames = Yes

        DefaultModelConditionState
            Model                = rbmauerban
        End

        ModelConditionState = BUILD_PLACEMENT_CURSOR
            Model                = rbmauerban
        End


        IdleAnimationState
            BeginScript
                CurDrawableShowSubObject("ModuleTag_DrawFloor")
            EndScript
        End


        ModelConditionState = DAMAGED
            Model                = rbmauerban
        Texture     = rbarchrnge.tga rbarchrnge_d.tga
        Texture     = rbarchrngec.tga rbarchrngec_d.tga
        Texture     = rbwatchtow.tga rbwatchtow_d.tga
        End


        AnimationState = DAMAGED
            Animation            = DamagedAnimation
                AnimationName        = rbmauerban.rbmauerban
                AnimationMode        = ONCE
               End
            EnteringStateFX            = FX_WallDamaged
        End


        ModelConditionState = REALLYDAMAGED
            Model                = rbmauerban
        Texture     = rbarchrnge.tga rbarchrnge_d.tga
        Texture     = rbarchrngec.tga rbarchrngec_d.tga
        Texture     = rbwatchtow.tga rbwatchtow_d.tga
        End

        AnimationState = REALLYDAMAGED
            Animation            = DamagedAnimation
                AnimationName        = rbmauerban.rbmauerban
                AnimationMode        = ONCE
               End
            EnteringStateFX            = FX_WallDamaged
        End

        ModelConditionState = COLLAPSING
            Model                = rbmauerban
        Texture     = rbarchrnge.tga rbarchrnge_d.tga
        Texture     = rbarchrngec.tga rbarchrngec_d.tga
        Texture     = rbwatchtow.tga rbwatchtow_d.tga
        End

        AnimationState = COLLAPSING
              Animation                = RubbleAnimation
                AnimationName        = rbmauerban.rbmauerban
                AnimationMode        = ONCE
              End
              ParticleSysBone NONE WallDestructionDust
            EnteringStateFX            = FX_StructureMediumCollapse
        End

        ModelConditionState = SNOW
            Model                = rbmauerban
        Texture  = GBFarm.tga GBFarm_Snow.tga
        Texture  = GBVet.tga GBVet_snow.tga
        Texture  = rbarchrnge.tga rbarchrnge_snow.tga
        Texture  = rbarmory2.tga rbarmory2_snow.tga
        Texture  = rbarmory.tga rbarmory_snow.tga
        Texture  = rbbib.tga rbbib_snow.tga
        Texture  = rbcastkeep.tga rbcastkeep_snow.tga
        Texture  = rbgate.tga rbgate_snow.tga
        Texture  = rbgoldhall.tga rbgoldhall_snow.tga
        Texture  = rbgoldhallbib.tga rbgoldhallbib_snow.tga
        Texture  = rbstable.tga rbstable_snow.tga
        Texture  = rbwatchtow.tga rbwatchtow_snow.tga
        Texture  = rbwell.tga rbwell_snow.tga
        Texture  = tdirt_dma14.tga tdirt_dma14_snow.tga
        Texture  = pfence01.tga pfence01_snow.tga
        Texture  = rpherostat.tga rpherostat_snow.tga
        Texture  = gbhd1.tga gbhd1_snow.tga
        End
    End




    DisplayName         = OBJECT:RohanCastleWallBanner
    Side                = Rohan
    EditorSorting       = STRUCTURE
    ThreatLevel            = 1.0
    ThreatBreakdown ModuleTag_DetailedThreat
        AIKindOf = WALL
    End
    Scale = 1.01

    BuildCost           = DWARVEN_WALLTOWER_SMALL_BUILDCOST
    BuildTime           = DWARVEN_WALLTOWER_SMALL_BUILDTIME
    VisionRange         = DWARVEN_WALLTOWER_SMALL_VISION_RANGE
    ShroudClearingRange = DWARVEN_WALLTOWER_SMALL_SHROUD_CLEAR

    ArmorSet
        Conditions        = None
        Armor             = ElvenWallArmor
    End

    CommandSet    = SellableCommandSet



    EvaEventDamagedOwner       = StructureUnderAttack
    EvaEnemyObjectSightedEvent = EnemyCampSighted

    VoiceSelect                        = Gui_PlotSelect2
    VoiceSelectUnderConstruction    = BuildingEvilVoiceSelectUnderConstruction

    SoundOnDamaged                    = BuildingLightDamageStone
    SoundOnReallyDamaged            = BuildingHeavyDamageStone

    UnitSpecificSounds
        UnderConstruction        = WallConstructionLoop

        UnderRepairFromRubble    = WallConstructionLoop
    End

    CampnessValue = CAMPNESS_WALL


    RadarPriority       = STRUCTURE
    KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE MADE_OF_STONE CAN_ATTACK IGNORE_FOR_VICTORY WALL_UPGRADE

    Behavior                        = GettingBuiltBehavior ModuleTag_04
        UseSpawnTimerWithoutWorker         = Yes
        SpawnTimer    = DEFAULT_STRUCTURE_HEALDELAY
        RebuildTimeSeconds            = 30
        SelfBuildingLoop            = WallConstructionLoop
        SelfRepairFromDamageLoop     = WallConstructionLoop
        SelfRepairFromRubbleLoop    = WallConstructionLoop
    End



    Behavior = PassiveAreaEffectBehavior ModuleTag_FeelGoodHero
        EffectRadius             = GONDOR_STATUE_AOE_RADIUS
        PingDelay                = 2000
        ModifierName             = RohanHeroLeadership
        AntiCategories           = BUFF
        AllowFilter              = GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
    End



    Behavior = InheritUpgradeCreate ModuleTag_InheritStonework
        Radius = ELVEN_FORTRESS_WALL_EFFECTIVE_RADIUS
        Upgrade = Upgrade_RohanFortressStonework
        ObjectFilter = ANY +RohanCitadel
    End

    Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
        TriggeredBy                = Upgrade_RohanFortressStonework
        AttributeModifier        = EncasingVinesExpansion_Bonus
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowTorches
        TriggeredBy            = Upgrade_RohanFortressStonework
        ShowSubObjects         = STONEWALL
    End


    Body = StructureBody ModuleTag_05
        MaxHealth = 2000
    End


    Behavior            = SlowDeathBehavior ModuleTag_SlowDeath
        DeathTypes            = ALL
        DestructionDelay    = 5000
    End

    Behavior = ProductionUpdate ModuleTag_RequiredForUpgradeProduction
    End


    Geometry                  = BOX
    GeometryMajorRadius       = 5.0
    GeometryMinorRadius       = 20.0
    GeometryHeight            = 40.0

    GeometryIsSmall           = No

    Shadow                = SHADOW_VOLUME
    BuildCompletion            = PLACED_BY_PLAYER
End


Object RohanCastleWallSeiteneingang


      SelectPortrait  =  BRRohanWall


    Draw = W3DScriptedModelDraw ModuleTag_Draw
        OkToChangeModelColor            = Yes
        UseStandardModelNames            = Yes

        DefaultModelConditionState
            Model                = rbmauer
        End

        ModelConditionState = BUILD_PLACEMENT_CURSOR
            Model                = rbmauer
        End


        IdleAnimationState
            BeginScript
                CurDrawableShowSubObject("ModuleTag_DrawFloor")
            EndScript
        End



        ModelConditionState = AWAITING_CONSTRUCTION
            Model                = rbmauer_b
        End

        AnimationState = AWAITING_CONSTRUCTION
            Animation            = rbmauer_b
                AnimationName        = rbmauer_b.rbmauer_b
                AnimationMode        = MANUAL
                AnimationBlendTime    = 0
            AnimationSpeedFactorRange    = 10.0 10.0
            End
            Flags                = START_FRAME_FIRST
        End

        ModelConditionState = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Model                = rbmauer_b
            ParticleSysBone            = NONE WallConstructDust FollowBone:Yes
        End

        AnimationState = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Animation            = rbmauer_b
                AnimationName        = rbmauer_b.rbmauer_b
                AnimationMode        = MANUAL
                AnimationBlendTime    = 0
                AnimationSpeedFactorRange = 10.0 10.0
            End
            Flags                = START_FRAME_FIRST
            StateName            = BeingConstructed
            BeginScript
                CurDrawableHideSubObject("ModuleTag_DrawFloor")
            EndScript
        End


        ModelConditionState = DAMAGED
            Model                = rbmauer
        Texture     = rbarchrnge.tga rbarchrnge_d.tga
        Texture     = rbarchrngec.tga rbarchrngec_d.tga
        Texture     = rbwatchtow.tga rbwatchtow_d.tga
        End


        AnimationState = DAMAGED
            EnteringStateFX            = FX_WallDamaged
        End


        ModelConditionState = REALLYDAMAGED
            Model                = rbmauer
        Texture     = rbarchrnge.tga rbarchrnge_d.tga
        Texture     = rbarchrngec.tga rbarchrngec_d.tga
        Texture     = rbwatchtow.tga rbwatchtow_d.tga
        End

        AnimationState = REALLYDAMAGED
            EnteringStateFX            = FX_WallDamaged
        End

        ModelConditionState = COLLAPSING
            Model                = rbmauer
        Texture     = rbarchrnge.tga rbarchrnge_d.tga
        Texture     = rbarchrngec.tga rbarchrngec_d.tga
        Texture     = rbwatchtow.tga rbwatchtow_d.tga
        End

        AnimationState = COLLAPSING
            ParticleSysBone NONE WallDestructionDust
            EnteringStateFX            = FX_StructureMediumCollapse
        End

        ModelConditionState = RUBBLE
            Model                = None
        End

        AnimationState = RUBBLE
            BeginScript
                CurDrawableHideSubObject("ModuleTag_DrawFloor")
            EndScript
        End

        ModelConditionState = POST_RUBBLE
            Model                = None
        End

        ModelConditionState = POST_COLLAPSE
            Model                = None
        End

        ModelConditionState = SNOW
            Model                = rbmauer
        Texture  = GBFarm.tga GBFarm_Snow.tga
        Texture  = GBVet.tga GBVet_snow.tga
        Texture  = rbarchrnge.tga rbarchrnge_snow.tga
        Texture  = rbarmory2.tga rbarmory2_snow.tga
        Texture  = rbarmory.tga rbarmory_snow.tga
        Texture  = rbbib.tga rbbib_snow.tga
        Texture  = rbcastkeep.tga rbcastkeep_snow.tga
        Texture  = rbgate.tga rbgate_snow.tga
        Texture  = rbgoldhall.tga rbgoldhall_snow.tga
        Texture  = rbgoldhallbib.tga rbgoldhallbib_snow.tga
        Texture  = rbstable.tga rbstable_snow.tga
        Texture  = rbwatchtow.tga rbwatchtow_snow.tga
        Texture  = rbwell.tga rbwell_snow.tga
        Texture  = tdirt_dma14.tga tdirt_dma14_snow.tga
        Texture  = pfence01.tga pfence01_snow.tga
        Texture  = rpherostat.tga rpherostat_snow.tga
        Texture  = gbhd1.tga gbhd1_snow.tga
        End
    End

    Draw = W3DScriptedModelDraw ModuleTag_Draw_Rubble
        OkToChangeModelColor            = Yes
        UseStandardModelNames            = Yes

        DefaultModelConditionState
            Model                = None
        End

        ModelConditionState = COLLAPSING
            Model                = GBWall_Rubble
        End

        ModelConditionState = RUBBLE
            Model                = GBWall_Rubble
        End

        ModelConditionState = POST_RUBBLE
            Model                = GBWall_Rubble
        End

        ModelConditionState = POST_COLLAPSE
            Model                = None
        End
    End

    Draw = W3DScriptedModelDraw ModuleTag_DoorDraw

        OkToChangeModelColor            = Yes
        UseStandardModelNames            = Yes

        ExtraPublicBone                = Post01
        ExtraPublicBone                = Post02
        ExtraPublicBone                = Post03
        ExtraPublicBone                = Post04

        DefaultModelConditionState
            Model                = rbwallpst
        End

        IdleAnimationState
            Flags = ADJUST_HEIGHT_BY_CONSTRUCTION_PERCENT
            Animation            = ReallyDamagedanimation
                AnimationName        = rbwallpst.rbwallpst
                AnimationMode        = LOOP
               End
               StateName = STATE_None
        End



        ModelConditionState = DAMAGED
            Model                = rbwallpst
        Texture     = rbarchrnge.tga rbarchrnge_d.tga
        Texture     = rbarchrngec.tga rbarchrngec_d.tga
        Texture     = rbwatchtow.tga rbwatchtow_d.tga
        End

        AnimationState = DAMAGED
        End

        ModelConditionState = REALLYDAMAGED
            Model                = rbwallpst
        Texture     = rbarchrnge.tga rbarchrnge_d.tga
        Texture     = rbarchrngec.tga rbarchrngec_d.tga
        Texture     = rbwatchtow.tga rbwatchtow_d.tga
        End

        AnimationState = REALLYDAMAGED
            EnteringStateFX            = FX_BuildingReallyDamaged
        End

        ModelConditionState = COLLAPSING
            Model                = rbwallpst
        Texture     = rbarchrnge.tga rbarchrnge_d.tga
        Texture     = rbarchrngec.tga rbarchrngec_d.tga
        Texture     = rbwatchtow.tga rbwatchtow_d.tga
        End
        AnimationState                = COLLAPSING
                  Animation            = RubbleAnimation
                AnimationName        = rbwallpst.rbwallpst
                AnimationMode        = ONCE
              End
              EnteringStateFX            = FX_StructureMediumCollapse
        End

        ModelConditionState = DYING
            Model                = rbwallpst
        Texture     = rbarchrnge.tga rbarchrnge_d.tga
        Texture     = rbarchrngec.tga rbarchrngec_d.tga
        Texture     = rbwatchtow.tga rbwatchtow_d.tga
        End
        AnimationState                = DYING




              EnteringStateFX            = FX_StructureMediumCollapse
        End

        ModelConditionState = RUBBLE
            Model                = None
            ParticleSysBone SmokeLarge01 SmokeBuildingLarge
        End

        AnimationState = RUBBLE
        End

        ModelConditionState = POST_RUBBLE
            Model                = None
            ParticleSysBone NONE SmokeBuildingMediumRubble
        End

        ModelConditionState = POST_COLLAPSE
            Model                = None
            ParticleSysBone NONE SmokeBuildingMediumRubble
        End
    End

    DisplayName                    = OBJECT:RohanPosternGate
    DisplayNameInvisibleForEnemy   = OBJECT:GondorCastleWallSegment
    Side                           = Rohan
    EditorSorting                  = STRUCTURE
    ThreatLevel                    = 1.0
    VisionRange                    = 160.0
    ShroudClearingRange            = 160
    CommandSet                     = SellableCommandSet




    EvaEventDamagedOwner       = StructureUnderAttack
    EvaEnemyObjectSightedEvent = EnemyCampSighted

    VoiceSelect                = GondorPosternGateSelect
    VoiceSelectUnderConstruction        = BuildingGoodVoiceSelectUnderConstruction

    SoundOnDamaged                = BuildingLightDamageStone
    SoundOnReallyDamaged            = BuildingHeavyDamageStone

    UnitSpecificSounds
        UnderConstruction        = WallConstructionLoop

        UnderRepairFromRubble        = WallConstructionLoop
    End

    CampnessValue                = CAMPNESS_WALL


    RadarPriority                = STRUCTURE
    KindOf = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE MADE_OF_STONE WALL_UPGRADE WALL_GATE IGNORE_FOR_VICTORY

    Behavior = GettingBuiltBehavior ModuleTag_04
        UseSpawnTimerWithoutWorker    = Yes
        SpawnTimer            = DEFAULT_STRUCTURE_HEALDELAY

        SelfBuildingLoop        = BuildingConstructionLoop
        SelfRepairFromDamageLoop    = WallConstructionLoop
        SelfRepairFromRubbleLoop    = BuildingConstructionLoop
    End

    Body = StructureBody ModuleTag_05
        MaxHealth            = 2500.0
    End

    Behavior = SlowDeathBehavior ModuleTag_SlowDeath
        DeathTypes            = ALL
        DestructionDelay        = 5000
    End


    Behavior = InheritUpgradeCreate ModuleTag_InheritStonework
        Radius = ELVEN_FORTRESS_WALL_EFFECTIVE_RADIUS
        Upgrade = Upgrade_RohanFortressStonework
        ObjectFilter = ANY +RohanCitadel
    End

    Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
        TriggeredBy                = Upgrade_RohanFortressStonework
        AttributeModifier        = EncasingVinesExpansion_Bonus
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowTorches
        TriggeredBy            = Upgrade_RohanFortressStonework
        ShowSubObjects         = STONEWALL
    End

    Behavior = SubObjectsUpgrade ModuleTag_HideAll
        TriggeredBy            = Upgrade_StructureLevel1
        HideSubObjects         = STONEWALL
    End



    ArmorSet
        Conditions        = None
        Armor             = ElvenWallArmor
    End

    Behavior = DynamicPortalBehaviour PosternGatePortal
        ActivationDelaySeconds = 0.0
        GenerateNow            = Yes

        ObjectFilter        = POSTERNGATE_ALLOWABLE_OBJECTFILTER
        BonePrefix          = Post
        NumberOfBones       = 4
        WayPoint            = Index:0    Type:Walk
        WayPoint            = Index:1    Type:Walk
        WayPoint            = Index:2    Type:Walk
        WayPoint            = Index:3    Type:Walk
        WayPoint            = Index:2    Type:Walk
        WayPoint            = Index:1    Type:Walk
        Link                = From:0 Via:4 Via:5 To:3
        Link                = From:3 Via:1 Via:2 To:0
    End

    #include "..\..\..\includes\DefaultPosternGateInvisibilityUpdate.inc"

    Geometry                  = BOX
    GeometryMajorRadius       = 5.0
    GeometryMinorRadius       = 20.0
    GeometryHeight            = 40.0

    GeometryIsSmall           = No

    Shadow                    = SHADOW_VOLUME
    BuildCompletion           = PLACED_BY_PLAYER
End



