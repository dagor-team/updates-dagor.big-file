Object ArnorFortressCenterGeneric

    SelectPortrait = BPGFortress

    Draw = W3DScriptedModelDraw ModuleTag_01

        DefaultModelConditionState
              Model = None
        End

        ModelConditionState = WORLD_BUILDER
            Model = NBasePin
        End
    End

    Side = Arnor
    EditorSorting = STRUCTURE
    KindOf = IMMOBILE BASE_FOUNDATION CASTLE_CENTER CAN_CAST_REFLECTIONS CAN_CAST_REFLECTIONS

    Behavior = CastleBehavior ModuleTag_castle
        FilterValidOwnedEntries = ANY +STRUCTURE +WALK_ON_TOP_OF_WALL +BASE_FOUNDATION +TACTICAL_MARKER
    End
End


Object ArnorFortressExpansionPadCorner

    SelectPortrait = BRArnorFoundation


    Draw = W3DFloorDraw DrawFloorBase  
        ModelName = abfoundationb
    End
        
    Draw = W3DScriptedModelDraw ModuleTag_DrawMain
        DefaultModelConditionState
            Model = WBFoundationP
        End
        ;//Remove the buildplot when it's been constructed on
        ModelConditionState = CONSTRUCTION_COMPLETE
            Model = None
        End    
    End




    DisplayName         = OBJECT:ArnorBuildingFoundation
    Side                = Arnor
    EditorSorting       = STRUCTURE
    ThreatLevel         = 1.0

    BuildCost           = 1
    BuildTime           = 5.0
    VisionRange         = 0.0
    ShroudClearingRange = 0

    CommandSet = ArnorFortressExpansionPadCornerCommandSet


    VoiceSelect = Gui_PlotSelect



    KindOf              = STRUCTURE SELECTABLE IMMOBILE BASE_FOUNDATION UNATTACKABLE MP_COUNT_FOR_VICTORY NO_COLLIDE DO_NOT_CLASSIFY CAN_CAST_REFLECTIONS EXPANSION_PAD

    Behavior            = FoundationAIUpdate ModuleTag_foundationAI
        BuildVariation = 2
    End

    Behavior = CastleMemberBehavior ModuleTag_CMB
    End

    Body                = ImmortalBody ModuleTag_05
        MaxHealth         = 25000.0
    End

    Geometry              = BOX
    GeometryMajorRadius   = 5.0
    GeometryMinorRadius   = 5.0
    GeometryHeight        = 0.8
    GeometryIsSmall       = No
    Shadow                = SHADOW_VOLUME
    BuildCompletion       = PLACED_BY_PLAYER
End



ChildObject ArnorFortressExpansionPadSide ArnorFortressExpansionPadCorner

    CommandSet = ArnorFortressExpansionPadSideCommandSet

    Behavior            = FoundationAIUpdate ModuleTag_foundationAI
        BuildVariation = 1
    End
End

ChildObject ArnorFortressExpansionPadBack ArnorFortressExpansionPadCorner

    CommandSet = ArnorFortressExpansionPadBackCommandSet

    Behavior            = FoundationAIUpdate ModuleTag_foundationAI
        BuildVariation = 1
    End
End



Object ArnorFortressCitadel

 Draw = W3DFloorDraw ModuleTag_DrawFortressFloor
     ModelName            	= FL_ARNOR
     StartHidden 		= No
     HideIfModelConditions	= AWAITING_CONSTRUCTION
     HideIfModelConditions	= PARTIALLY_CONSTRUCTED
     ForceToBack 		= Yes
     FloorFadeRateOnObjectDeath = -0.01
 End

    ButtonImage        	= HPAmonSulCitadel
    SelectPortrait  	= BPArnorFortressNew

    Draw = W3DScriptedModelDraw ModuleTag_MainDraw
        ExtraPublicBone         = ARROW_01
        ExtraPublicBone         = ARROW_02
        ExtraPublicBone         = ARROW_03
        ExtraPublicBone         = ARROW_04
        ExtraPublicBone         = ARROW_05
        ExtraPublicBone         = ARROW_06
        ExtraPublicBone         = ARROW_07
        ExtraPublicBone         = ARROW_08

        ExtraPublicBone         = ARROW01
        ExtraPublicBone         = ARROW02
        ExtraPublicBone         = ARROW03
        ExtraPublicBone         = ARROW04
        ExtraPublicBone         = ARROW05
        ExtraPublicBone         = ARROW06
        ExtraPublicBone         = ARROW07
        ExtraPublicBone         = ARROW08
        ExtraPublicBone         = ARROW09
        ExtraPublicBone         = ARROW10
        ExtraPublicBone         = ARROW11
        ExtraPublicBone         = ARROW12
        ExtraPublicBone         = ARROW13
        ExtraPublicBone         = ARROW14
        ExtraPublicBone         = ARROW15
        ExtraPublicBone         = ARROW16

        DefaultModelConditionState
            Model            = arnorfor;arfortress
            WeaponLaunchBone    = PRIMARY ARROW
        End


        AnimationState = BUILD_PLACEMENT_CURSOR
            BeginScript
                   CurDrawableHideSubObject("LEVEL1")
                   CurDrawableHideSubObject("LEVEL1_ROOF")
                   CurDrawableHideSubObject("LEVEL2")
                   CurDrawableHideSubObject("LEVEL2_ROOF")
                   CurDrawableHideSubObject("FLAMES")
                   CurDrawableHideSubObject("BANNERS")
                   CurDrawableHideSubObject("TORCH")
            EndScript
        End
        
        ;//    Animation state for phantom structure
        AnimationState = PHANTOM_STRUCTURE
            BeginScript
                   CurDrawableHideSubObject("LEVEL1")
                   CurDrawableHideSubObject("LEVEL1_ROOF")
                   CurDrawableHideSubObject("LEVEL2")
                   CurDrawableHideSubObject("LEVEL2_ROOF")
                   CurDrawableHideSubObject("FLAMES")
                   CurDrawableHideSubObject("BANNERS")
                   CurDrawableHideSubObject("TORCH")
            EndScript
        End


        ModelConditionState    = DAMAGED
            Model        = arnorfor;arfortress
            Texture        = amonsulcentraltower_d.tga amonsul_d1.tga
        End

        AnimationState = DAMAGED
            EnteringStateFX    = FX_FortressDamaged            
        End

        ModelConditionState    = REALLYDAMAGED
            Model        = arnorfor;arfortress
            Texture        = amonsulcentraltower_d.tga amonsul_d1.tga        
        End

        AnimationState            = REALLYDAMAGED
            Animation        = Fortress_ReallyDamaged
                AnimationName    = arfortress.arfortress
                AnimationMode    = ONCE                
            End            
            EnteringStateFX    = FX_FortressReallyDamaged
        End

        ModelConditionState    = RUBBLE
            Model        = arnorfor;arfortress
            Texture        = amonsulcentraltower_d.tga amonsul_d1.tga
        End
    
        AnimationState            = RUBBLE
            Animation        = Fortress_Rubble
                AnimationName    = arnorfor.arnorfor
                AnimationMode    = ONCE                
            End    
            EnteringStateFX    = FX_FortressCollapse        
        End

        
        ModelConditionState        = UPGRADE_NUMENOR_STONEWORK
            Model            = arnorfor;arfortress
            Texture        = amonsulcentraltower_d.tga amonsulcentraltower_dha.tga
        End
        
       
        ModelConditionState        = SNOW
            Model            = arnorfor;arfortress
            Texture            = GBFortress1.tga GBFortress1_Snow.tga
        End

    End



    


    Draw = W3DScriptedModelDraw ModuleTag_IvoryTowerDraw
        OkToChangeModelColor    = Yes
        StaticModelLODMode        = Yes

        DefaultModelConditionState
            Model           = None
        End


        ModelConditionState        = UPGRADE_IVORY_TOWER DAMAGED
            Model        = GBFITower_A
            Texture        = GBFortress1.tga GBFortress1D.tga
        End

        ModelConditionState        = UPGRADE_IVORY_TOWER REALLYDAMAGED
            Model        = GBFITower_D2
        End

        AnimationState            = UPGRADE_IVORY_TOWER REALLYDAMAGED
            Animation            = ReallyDamaged
                AnimationName    = GBFITower_D2SK.GBFITower_D2AN
                AnimationMode   = ONCE
            End
        End

        ModelConditionState        = UPGRADE_IVORY_TOWER RUBBLE
            Model        = GBFITower_D3
        End

        AnimationState            = UPGRADE_IVORY_TOWER RUBBLE
            Animation            = Destroyed
                AnimationName    = GBFITower_D3SK.GBFITower_D3AN
                AnimationMode   = ONCE
            End
        End


        ModelConditionState = UPGRADE_IVORY_TOWER USER_2
            Model           = GBFITower_A
        End


        AnimationState = UPGRADE_IVORY_TOWER USER_2
            Animation                    = RiseUp
                AnimationName                = GBFITower_ASKL.GBFITower_ABLD
                AnimationMode                = ONCE
                AnimationSpeedFactorRange    = 8.0 8.0
            End
        End


        ModelConditionState = SNOW UPGRADE_IVORY_TOWER
            Model            = GBFITower
            Texture            = GBFortress1.tga GBFortress1_Snow.tga
        End

        ModelConditionState = UPGRADE_IVORY_TOWER
            Model           = GBFITower
        End

    End


    Draw = W3DScriptedModelDraw ModuleTag_HouseOfHealingDraw
        OkToChangeModelColor    = Yes
        StaticModelLODMode        = Yes // Will append M or L to the skin name depending on GameLOD

        DefaultModelConditionState
            Model           = None
        End
        
        //---Build Up---
        ModelConditionState = UPGRADE_HOUSE_OF_HEALING USER_3 DAMAGED
            Model        = arfort_stat_a
            Texture        = amonsulcentraltower_d.tga amonsul_d1.tga
        End

        ModelConditionState = UPGRADE_HOUSE_OF_HEALING USER_3 REALLYDAMAGED
            Model        = arfort_stat_a
            Texture        = amonsulcentraltower_d.tga amonsul_d1.tga
        End

        ModelConditionState = UPGRADE_HOUSE_OF_HEALING USER_3 UPGRADE_NUMENOR_STONEWORK
            Model        = arfort_stat_a
            Texture        = amonsulcentraltower_d.tga amonsulcentraltower_dha.tga
        End
        ModelConditionState = UPGRADE_HOUSE_OF_HEALING USER_3 SNOW
            Model        = arfort_stat_a
            Texture        = GBFortress1.tga GBFortress1_Snow.tga
        End
        ModelConditionState = UPGRADE_HOUSE_OF_HEALING USER_3
            Model        = arfort_stat_a
        End
        AnimationState = UPGRADE_HOUSE_OF_HEALING USER_3
            Animation                    = RiseUp
                AnimationName                = arfort_stat_a.arfort_stat_a
                AnimationMode                = ONCE                
                AnimationSpeedFactorRange    = 5.0 5.0
            End
        End

        //---Damage States---
        ModelConditionState        = UPGRADE_HOUSE_OF_HEALING DAMAGED
            Model        = arfort_statd ;;arfort_statue
            Texture        = amonsulcentraltower_d.tga amonsul_d1.tga
        End

        ModelConditionState        = UPGRADE_HOUSE_OF_HEALING REALLYDAMAGED
            Model        = arfort_statd ;;arfort_statue
            Texture        = amonsulcentraltower_d.tga amonsul_d1.tga
        End

        AnimationState            = UPGRADE_HOUSE_OF_HEALING REALLYDAMAGED
            Animation            = ReallyDamaged
                AnimationName    = arfort_statue.arfort_statue
                AnimationMode   = ONCE
            End
        End

        ModelConditionState        = UPGRADE_HOUSE_OF_HEALING RUBBLE
            Model        = arfort_statd ;;arfort_statue
            Texture        = amonsulcentraltower_d.tga amonsul_d1.tga
        End

        AnimationState            = UPGRADE_HOUSE_OF_HEALING RUBBLE
            Animation            = Destroyed
                AnimationName    = arfort_statue.arfort_statue
                AnimationMode   = ONCE
            End
        End

        //---Stonework upgrade
        ModelConditionState = UPGRADE_NUMENOR_STONEWORK UPGRADE_HOUSE_OF_HEALING
            Model        = arfort_statue
            Texture        = amonsulcentraltower_d.tga amonsulcentraltower_dha.tga
        End
                
        //---Snow---
        ModelConditionState = SNOW UPGRADE_HOUSE_OF_HEALING
            Model            = arfort_statue
            Texture            = GBFortress1.tga GBFortress1_Snow.tga
        End
                
        //---Default Purchased States
        ModelConditionState = UPGRADE_HOUSE_OF_HEALING
            Model           = arfort_statue
        End
        
    End
	
	;-------------------------------------
    Draw = W3DScriptedModelDraw ModuleTag_MoatDraw
        OkToChangeModelColor    = Yes
        StaticModelLODMode        = Yes 

        DefaultModelConditionState
            Model           = None
        End
        
        //---Build Up---
        ModelConditionState = FORTRESS_IMPROVEMENT_1 DAMAGED
            Model        = arnorfor_upga
          ;  Texture        = amonsulcentraltower_d.tga amonsul_d1.tga
        End

        ModelConditionState = FORTRESS_IMPROVEMENT_1 REALLYDAMAGED
            Model        = arnorfor_upga
        ;    Texture        = amonsulcentraltower_d.tga amonsul_d1.tga
        End

        ModelConditionState = FORTRESS_IMPROVEMENT_1 UPGRADE_NUMENOR_STONEWORK
            Model        = arnorfor_upga
;            Texture        = amonsulcentraltower_d.tga amonsulcentraltower_dha.tga
        End
        ModelConditionState = FORTRESS_IMPROVEMENT_1 SNOW
            Model        = arnorfor_upga
           ; Texture        = GBFortress1.tga GBFortress1_Snow.tga
        End
		
		ModelConditionState = FORTRESS_IMPROVEMENT_1 UPGRADE_NUMENOR_STONEWORK UPGRADE_HOUSE_OF_HEALING
            Model        = arnorfor_upga
;            Texture        = amonsulcentraltower_d.tga amonsulcentraltower_dha.tga
        End
    ;    ModelConditionState = UPGRADE_HOUSE_OF_HEALING USER_3
     ;       Model        = arfort_stat_a
      ;  End
      ;  AnimationState = UPGRADE_HOUSE_OF_HEALING USER_3
       ;     Animation                    = RiseUp
        ;        AnimationName                = arfort_stat_a.arfort_stat_a
         ;       AnimationMode                = ONCE                
          ;      AnimationSpeedFactorRange    = 5.0 5.0
           ; End
        ;End

        //---Damage States---
     ;   ModelConditionState        = UPGRADE_HOUSE_OF_HEALING DAMAGED
      ;      Model        = arfort_statd ;;arfort_statue
       ;     Texture        = amonsulcentraltower_d.tga amonsul_d1.tga
        ;End

        ;ModelConditionState        = UPGRADE_HOUSE_OF_HEALING REALLYDAMAGED
         ;   Model        = arfort_statd ;;arfort_statue
          ;  Texture        = amonsulcentraltower_d.tga amonsul_d1.tga
        ;End

       ; AnimationState            = UPGRADE_HOUSE_OF_HEALING REALLYDAMAGED
        ;    Animation            = ReallyDamaged
         ;       AnimationName    = arfort_statue.arfort_statue
          ;      AnimationMode   = ONCE
           ; End
        ;End

        ModelConditionState        = FORTRESS_IMPROVEMENT_1 RUBBLE
            Model        = arnorfor_upga
        ;    Texture        = amonsulcentraltower_d.tga amonsul_d1.tga
        End

       ; AnimationState            = FORTRESS_IMPROVEMENT_1 RUBBLE
        ;    Animation            = Destroyed
         ;       AnimationName    = None
          ;      AnimationMode   = ONCE
           ; End
        ;End

        //---Stonework upgrade
        ;ModelConditionState = UPGRADE_NUMENOR_STONEWORK FORTRESS_IMPROVEMENT_1
            ;Model        = arnorfor_upga
            ;Texture        = amonsulcentraltower_d.tga amonsulcentraltower_dha.tga
        ;End
                
        //---Snow---
     ;   ModelConditionState = SNOW FORTRESS_IMPROVEMENT_1
      ;      Model            = arnorfor_upga
;            Texture            = GBFortress1.tga GBFortress1_Snow.tga
       ; End
                
        //---Default Purchased States
        ModelConditionState = FORTRESS_IMPROVEMENT_1
            Model           = arnorfor_upga
        End
        
    End
;-------------------------------------

;--------------------------------

    Draw = W3DScriptedModelDraw ModuleTag_DrawTower2
        
        OkToChangeModelColor    = Yes
        StaticModelLODMode        = Yes // Will append M or L to the skin name depending on GameLOD

        DefaultModelConditionState
            Model           = None
        End

        //---Damage States---
        ModelConditionState        = UPGRADE_HOUSE_OF_HEALING DAMAGED
            Model        = abfortbalk
            Texture        = GBFortress1.tga GBFortress1D.tga
        End

        ModelConditionState        = UPGRADE_HOUSE_OF_HEALING REALLYDAMAGED
            Model        = abfortbalk
        End

        AnimationState            = UPGRADE_HOUSE_OF_HEALING REALLYDAMAGED
        End

        ModelConditionState        = UPGRADE_HOUSE_OF_HEALING RUBBLE
            Model        = abfortbalk
        End

        AnimationState            = UPGRADE_HOUSE_OF_HEALING RUBBLE
        End
        
        //---Default Purchased States---
        ModelConditionState = UPGRADE_HOUSE_OF_HEALING USER_3
            Model           = abfortbalk_a
        End
        
        //---Build Up---
        AnimationState = UPGRADE_HOUSE_OF_HEALING USER_3
            Animation                    = RiseUp
                AnimationName                = abfortbalk_a.abfortbalk_a
                AnimationMode                = ONCE
                AnimationSpeedFactorRange    = 6.0 6.0
            End
        End

        //---Snow---
        ModelConditionState = SNOW UPGRADE_HOUSE_OF_HEALING
            Model           = abfortbalk
            Texture         = GBFortress1.tga GBFortress1_Snow.tga
        End
        
        ModelConditionState = UPGRADE_HOUSE_OF_HEALING
            Model           = abfortbalk
        End

    End


    PlacementViewAngle = 90


    DisplayName           = OBJECT:ArnorFortress
    Side                  = Arnor
    EditorSorting         = STRUCTURE
    ThreatLevel           = 1.0
    CommandPointBonus     = MAIN_FORTRESS_COMMAND_POINT
    MaxSimultaneousOfType = NEW_FORTRESS_RATIO

    BuildCost             = MEN_FORTRESS_BUILDCOST
    BuildTime             = DEFAULT_FORTRESS_BUILDTIME
    VisionRange           = DEFAULT_FORTRESS_VISION_RANGE
    ShroudClearingRange   = DEFAULT_FORTRESS_SHROUD_CLEAR

    WeaponSet
        Weapon               = PRIMARY FortressArrowTowerBow
        AutoChooseSources    = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End

    ArmorSet
        Conditions        = None
        Armor             = DefaultFortressArmor
    End

    CommandSet            = ArnorFortressModCommandSet



    #include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

    EvaEventDieOwner                = EvaFortressDie

    VoiceSelect                     = MenFortressSelect
    VoiceSelectUnderConstruction    = BuildingGoodVoiceSelectUnderConstruction

    SoundOnDamaged                  = BuildingLightDamageStone
    SoundOnReallyDamaged            = BuildingHeavyDamageStone

    UnitSpecificSounds
        UnderConstruction           = BuildingBigConstructionLoop
        UnderRepairFromRubble       = BuildingBigConstructionLoop
    End

    CampnessValue = CAMPNESS_FORTRESS


    RadarPriority       = STRUCTURE
     KindOf             = PRELOAD COMMANDCENTER VITAL_FOR_BASE_SURVIVAL STRUCTURE IMMOBILE CASTLE_KEEP MP_COUNT_FOR_VICTORY SELECTABLE FS_FACTORY AUTO_RALLYPOINT MADE_OF_WOOD SCORE DOZER_FACTORY CAN_CAST_REFLECTIONS

    Behavior           = GettingBuiltBehavior ModuleTag_GettingBuiltBehavior
        WorkerName    = GondorWorkerNoSelect
        SpawnTimer    = DEFAULT_STRUCTURE_HEALDELAY
    End

     Behavior = CastleMemberBehavior ModuleTag_CMB
        BeingBuiltSound = BuildingBigConstructionLoop
     End




    Behavior = ModelConditionUpgrade ModuleTag_ShowHouseOfHealing
        TriggeredBy              = Upgrade_FortressPalaceoftheSteward
        AddConditionFlags        = UPGRADE_HOUSE_OF_HEALING
        AddTempConditionFlag     = ModelConditionState:USER_3
        TempConditionTime        = 7.0
        Permanent                = Yes
    End

    Behavior = AudioLoopUpgrade ModuleTag_HouseOfHealingBuildLoop
        TriggeredBy            = Upgrade_FortressPalaceoftheSteward
        SoundToPlay            = BuildingConstructionLoop
        KillOnDeath            = Yes
        KillAfterMS            = 5000
    End

    Behavior = CastleUpgrade ModuleTag_PassOutHouseOfHealingUpgrade
        TriggeredBy    = Upgrade_FortressPalaceoftheSteward
        Upgrade        = Upgrade_FortressPalaceoftheSteward
    End

    Behavior = StatusBitsUpgrade ModuleTag_FakeOutMysticFountains
        TriggeredBy    = Upgrade_FortressPalaceoftheSteward
    End

	Behavior = AttributeModifierAuraUpdate ModuleTag_HouseOfLamentation
        StartsActive            = No ;If no, requires upgrade to turn on.
        BonusName            = DeathMaskModifier
        TriggeredBy            = Upgrade_ArnorFortressCrystalMoat
        RefreshDelay            = 2000
        Range                = ANGMAR_FORTRESS_DEATH_MASK_RANGE
        TargetEnemy            = Yes
        AntiCategory            = LEADERSHIP BUFF ; This means cancel all previous leadership bonuses
        ObjectFilter            = ANY +INFANTRY +CAVALRY -STRUCTURE -BASE_FOUNDATION -MACHINE +HERO +HORDE
    End
	
	Behavior = SubObjectsUpgrade ModuleTag_HideAll
        TriggeredBy            = Upgrade_StructureLevel1
        HideSubObjects            = BANNERS FLAMES LEVEL1 LEVEL1_ROOF LEVEL2 LEVEL2_ROOF TORCH
    End

    Behavior = SubObjectsUpgrade ModuleTag_SecondLevelUpgrade
        TriggeredBy            = Upgrade_MenFortressIvoryTower ;Upgrade_ArnorFortressDunedainAlliance Upgrade_ArnorFortressElvenAlliance
        RequiresAllTriggers         = Yes
        ShowSubObjects            = LEVEL1 LEVEL2 LEVEL2_ROOF
        HideSubObjects            = START_ROOF LEVEL1_ROOF
		
    End

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_IvoryTowerVisionEnabler
        SpecialPowerTemplate = SpecialAbilityMenFortressIvoryTowerVision
        TriggeredBy 	     = Upgrade_MenFortressIvoryTower Upgrade_FortressPalaceoftheSteward
        RequiresAllTriggers  = Yes
    End

    Behavior = OCLSpecialPower ModuleTag_IvoryTowerVision
        SpecialPowerTemplate = SpecialAbilityMenFortressIvoryTowerVision
        StartsPaused         = Yes
        OCL                  = SpecialPowerIvoryTowerVision
        CreateLocation       = CREATE_AT_LOCATION
    End

    Behavior = AudioLoopUpgrade ModuleTag_IvoryTowerBuildLoop
        TriggeredBy            = Upgrade_MenFortressIvoryTower
        SoundToPlay            = BuildingBigConstructionLoop
        KillOnDeath            = Yes
        KillAfterMS            = 2500
    End

    ;Behavior = ModelConditionUpgrade ModuleTag_ShowTheTower
        ;TriggeredBy              = Upgrade_MenFortressIvoryTower Upgrade_FortressPalaceoftheSteward
        ;RequiresAllTriggers      = Yes
        ;AddConditionFlags        = UPGRADE_IVORY_TOWER
        ;AddTempConditionFlag     = ModelConditionState:USER_2
        ;TempConditionTime        = 10.0
        ;Permanent                = Yes
    ;End


    Behavior = CommandSetUpgrade ModueTag_LevelCommandSet_WithoutMalbeth
        TriggeredBy            = Upgrade_FortressPalaceoftheSteward
        CommandSet             = ArnorFortressModCommandSet_WithoutMalbeth
    End

    Behavior = ObjectCreationUpgrade MakeTheFreeTreb2
        TriggeredBy             = Upgrade_FortressPalaceoftheSteward
		RequiresAllTriggers		= Yes
        Delay                   = 3000.0
        RemoveUpgrade           = Upgrade_WallTrebuchetButtonEnable
        ThingToSpawn            = ArnorMalbeth
        Offset                  = X:0 Y:-85 Z:63
        FadeInTime              = 500
    End

    Behavior = SlaveWatcherBehavior WatchTheTreb
        RemoveUpgrade           = Upgrade_FortressPalaceoftheSteward
        GrantUpgrade            = Upgrade_WallTrebuchetButtonEnable
        ShareUpgrades           = Yes
    End

	#include "..\..\..\..\includes\FortressAIHeroRespawnUpgrade_SEE.inc"

    Behavior = QueueProductionExitUpdate ModuleTag_QueuePEU
        UnitCreatePoint        = X:0.0 Y:0.0 Z:0.0
        NaturalRallyPoint    = X:0.0 Y:-100.0 Z:0.0;NaturalRallyPointX must always match GeometryMajorRadius!
        ExitDelay        = 400 ; Mainly for the multiple produced Red Guard.  Make them come out one at a time.
    End  

    Body                = StructureBody ModuleTag_05
        MaxHealth               = DEFAULT_FORTRESS_HEALTH
        MaxHealthDamaged        = DEFAULT_FORTRESS_HEALTH_DAMAGED
        MaxHealthReallyDamaged  = DEFAULT_FORTRESS_HEALTH_REALLY_DAMAGED
    End

    Behavior                  = StructureCollapseUpdate ModuleTag_08
        MinCollapseDelay        = 000
        MaxCollapseDelay        = 000
        CollapseDamping         = .5
        MaxShudder              = 0.6
        MinBurstDelay           = 250
        MaxBurstDelay           = 800
        BigBurstFrequency       = 4
        FXList                  = INITIAL   FX_FortressCollapse
        DestroyObjectWhenDone   = Yes
        CollapseHeight          = 155
    End

    Behavior = CitadelSlaughterHordeContain ModuleTag_SlaughterMe
	PassengerFilter			= GENERIC_FACTION_SLAUGHTERABLE
	ObjectStatusOfContained		= UNSELECTABLE ENCLOSED
	CashBackPercent			= 200%
	ContainMax			= 99
	AllowEnemiesInside		= No
	AllowAlliesInside		= No
 	AllowNeutralInside		= No
 	AllowOwnPlayerInsideOverride	= Yes
	EnterSound			= GUI_RingReturned
	EntryOffset			= X:125.0 Y:0.0 Z:0.0
	EntryPosition			= X:30.0 Y:0.0 Z:0.0
	ExitOffset			= X:125.0 Y:0.0 Z:0.0
     End

	#include "..\..\..\FortressRingFunc.inc"


    ;Behavior = SubObjectsUpgrade ModuleTag_HideAll
        ;TriggeredBy       = Upgrade_StructureLevel1
        ;HideSubObjects    = GBFFLAMING GBFFLAG
    ;End


   
   Behavior = CastleUpgrade ModuleTag_PassOutNumenorStoneworkUpgrade
        TriggeredBy       = Upgrade_MenFortressNumenorStoneworkTrigger
        Upgrade           = Upgrade_MenFortressNumenorStonework
        WallUpgradeRadius = MEN_FORTRESS_WALL_EFFECTIVE_RADIUS
    End

    Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
        TriggeredBy              = Upgrade_MenFortressNumenorStonework
        AttributeModifier        = NumenorStoneworkKeep_Bonus
    End

    Behavior = ModelConditionUpgrade ModuleTag_ShowTheStones
        TriggeredBy          = Upgrade_MenFortressNumenorStonework
        AddConditionFlags    = UPGRADE_NUMENOR_STONEWORK
        Permanent            = Yes
    End
	   ;Behavior = ModelConditionUpgrade ModuleTag_ShowMoat
        ;TriggeredBy            = Upgrade_MenFortressNumenorStoneworkTrigger       
        ;AddConditionFlags    = FORTRESS_IMPROVEMENT_1
        ;Permanent            = Yes
;	End
    

   
	
	Behavior = ModelConditionUpgrade ModuleTag_ShowMoat
        TriggeredBy            = Upgrade_ArnorFortressCrystalMoat       
        AddConditionFlags    = FORTRESS_IMPROVEMENT_1
        Permanent            = Yes
    End

    Behavior = CastleUpgrade ModuleTag_PassOutFlamingMunitionsUpgrade
        TriggeredBy    = Upgrade_GoodFortressFlamingMunitionsTrigger
        Upgrade        = Upgrade_GoodFortressFlamingMunitions
    End

    Behavior = StatusBitsUpgrade ModuleTag_FakeOut
        TriggeredBy    = Upgrade_GoodFortressFlamingMunitions
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowTorches
        TriggeredBy            = Upgrade_GoodFortressFlamingMunitions
        ShowSubObjects            = TORCH FLAMES
	    End

	Behavior = SubObjectsUpgrade ModuleTag_ShowBanners
        TriggeredBy            = Upgrade_MenFortressBanners
        ShowSubObjects            = BANNERS
    End

    ;Behavior = SubObjectsUpgrade ModuleTag_ShowBanners
        ;TriggeredBy        = Upgrade_MenFortressBanners
        ;ShowSubObjects     = GBFFLAG
    ;End

    Behavior = ObjectCreationUpgrade CreateTheDiscount
        TriggeredBy        = Upgrade_MenFortressBanners
        Delay              = 0.0
        ThingToSpawn       = DiscountHeroObjectArnor
        FadeInTime         = 100
    End

    Behavior = AttributeModifierAuraUpdate ModuleTag_BannerLeadership
        StartsActive       = No
        BonusName          = MenFortressBannersLeadership
        TriggeredBy        = Upgrade_MenFortressBanners
        RefreshDelay       = 2000
        Range              = 300
        ObjectFilter       = GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
    End

    Behavior = CastleUpgrade ModuleTag_PassOutHouseOfHealingUpgrade0110
        TriggeredBy    = Upgrade_FortressPalaceoftheSteward
        Upgrade        = Upgrade_FortressPalaceoftheSteward
    End

    Behavior = StatusBitsUpgrade ModuleTag_WellFix
        TriggeredBy    = Upgrade_MenFortressHouseOfHealing
    End

    Behavior = FireWeaponUpdate ModuleTag_WeaponFiring
        FireWeaponNugget
            WeaponName = ArnorFortressHealWeapon
            Offset = X:0 Y:0 Z:0
            FireDelay = 0
            OneShot = No
        End
    End


    Behavior = SpawnBehavior ModuleTag_SpawnFighters
        TriggeredBy          = Upgrade_MountAI
        SpawnNumber          = 2
        InitialBurst         = 2
        SpawnTemplateName    = ArnorPalantirwachterBattletower
        SpawnReplaceDelay    = 30000
        CanReclaimOrphans    = Yes
    End

    Behavior = SpawnBehavior ModuleTag_SpawnAbwehrrepair
        TriggeredBy          = Upgrade_FavourArvedui
        SpawnNumber          = 1
        InitialBurst         = 1
        SpawnTemplateName    = AraphantAbwehrRepairPing
        SpawnReplaceDelay    = 30000
        CanReclaimOrphans    = Yes
    End



    Behavior = AIUpdateInterface ModuleTag_AI
        AILuaEventsList                = FortressFunctions
        AutoAcquireEnemiesWhenIdle     = Yes
        MoodAttackCheckRate            = 250
    End


    Behavior = AutoDepositUpdate AutoDepositModuleTag
        DepositTiming           = GENERIC_KEEP_MONEY_TIME
        DepositAmount           = GENERIC_KEEP_MONEY_AMOUNT
        InitialCaptureBonus     = 0
    End

    Behavior = TerrainResourceBehavior ModuleTag_NewMoneyDeadSpot
        Radius            = GENERIC_KEEP_MONEY_RANGE
        MaxIncome         = 0
        IncomeInterval    = 999999
        HighPriority      = Yes
    End

    

    

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI1
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 320000
        GrantUpgrade = Upgrade_MenFortressBanners
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI2
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 700000
        GrantUpgrade = Upgrade_GoodFortressFlamingMunitionsTrigger
    End

    

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI4
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 1400000
        GrantUpgrade = Upgrade_ArnorFortressNumenorStonework
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI5
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 1600000
        GrantUpgrade = Upgrade_MenFortressHouseOfHealing
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI6
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 1750000
        GrantUpgrade = Upgrade_FortressPalaceoftheSteward
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI7
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 2000000
        GrantUpgrade = Upgrade_MenFortressIvoryTower
    End

    GeometryIsSmall       = No
    
    Geometry              = BOX                        // Main body
    GeometryMajorRadius   = 80
    GeometryMinorRadius   = 80
    GeometryHeight        = 100
    
    AdditionalGeometry    = BOX                        // 4 towers
    GeometryMajorRadius    = 12.0
    GeometryMinorRadius    = 12.0
    GeometryHeight        = 100.0
    GeometryOffset        = X:-40 Y:-40 Z:0
    
    AdditionalGeometry    = BOX
    GeometryMajorRadius    = 12.0
    GeometryMinorRadius    = 12.0
    GeometryHeight        = 100.0
    GeometryOffset        = X:-40 Y:40 Z:0
    
    AdditionalGeometry    = BOX
    GeometryMajorRadius    = 12.0
    GeometryMinorRadius    = 12.0
    GeometryHeight        = 100.0
    GeometryOffset        = X:40 Y:-40 Z:0    
    
    AdditionalGeometry    = BOX
    GeometryMajorRadius    = 12.0
    GeometryMinorRadius    = 12.0
    GeometryHeight        = 100.0
    GeometryOffset        = X:40 Y:40 Z:0
    
    AdditionalGeometry        = BOX
    GeometryName            = HighTowerGeom
    GeometryMajorRadius       = 12
    GeometryMinorRadius       = 12
    GeometryHeight            = 175
    GeometryOffset            = X:0 Y:0 Z:0
    GeometryUsedForHealthBox = No
    
    GeometryContactPoint = X:-57        Y:57        Z:0            Repair
    GeometryContactPoint = X:57            Y:-57        Z:0            Repair
    GeometryContactPoint = X:49            Y:36.435    Z:0
    GeometryContactPoint = X:-32.763    Y:-46.121    Z:0
    GeometryContactPoint = X:0            Y:0            Z:180        Swoop
    
    Shadow                = SHADOW_VOLUME
    BuildCompletion     = PLACED_BY_PLAYER
End


Object ArnorFortress

    SelectPortrait = BPArnorFortressNew ;;;BPGFortress
    
    Draw                = W3DScriptedModelDraw ModuleTag_01
        OkToChangeModelColor    = Yes
        StaticModelLODMode        = Yes ;// Will append M or L to the skin name depending on GameLOD

        DefaultModelConditionState
            Model           = None
        End

        IdleAnimationState
        End

        ;//Need this since the default condition is none
        ModelConditionState = WORLD_BUILDER
            Model    = arnorfor;arfortress
        End

        ;//Phantom structure when placing a new building to be build
        ModelConditionState = BUILD_PLACEMENT_CURSOR
            Model    = None    ; arfortress
        End

        ;//Structure that stays where you will be building until the porter reaches the place to start building.
        ModelConditionState =  PHANTOM_STRUCTURE
            Model    = arnorfor;arfortress
        End        

        ;//    Animation state for build placement cursor
        AnimationState = BUILD_PLACEMENT_CURSOR
            BeginScript
                   CurDrawableHideSubObject("LEVEL1")
                   CurDrawableHideSubObject("LEVEL1_ROOF")
                   CurDrawableHideSubObject("LEVEL2")
                   CurDrawableHideSubObject("LEVEL2_ROOF")
                   CurDrawableHideSubObject("FLAMES")
                   CurDrawableHideSubObject("BANNERS")
                   CurDrawableHideSubObject("TORCH")
            EndScript
        End
        
        ;//    Animation state for phantom structure
        AnimationState = PHANTOM_STRUCTURE
            BeginScript
                   CurDrawableHideSubObject("LEVEL1")
                   CurDrawableHideSubObject("LEVEL1_ROOF")
                   CurDrawableHideSubObject("LEVEL2")
                   CurDrawableHideSubObject("LEVEL2_ROOF")
                   CurDrawableHideSubObject("FLAMES")
                   CurDrawableHideSubObject("BANNERS")
                   CurDrawableHideSubObject("TORCH")
            EndScript
        End

        ModelConditionState  = RUBBLE
            Model         = arnorfor;arfortress
        End
    
        AnimationState    = RUBBLE
        ;    Animation    = Fortress_Rubble
        ;        AnimationName        = arnorfor.arnorfor
        ;        AnimationMode        = ONCE                
        ;    End    
            EnteringStateFX    = FX_FortressCollapse        
        End

        ModelConditionState = ACTIVELY_BEING_CONSTRUCTED SNOW    ; UNPACKING
            Model            = arnorfor_a;arfortress_1
;            Texture            = GBFortress1.tga GBFortress1_Snow.tga        
        End
        ModelConditionState = ACTIVELY_BEING_CONSTRUCTED    ; UNPACKING
            Model            = arnorfor_a;arfortress
        End

        AnimationState = ACTIVELY_BEING_CONSTRUCTED
            Animation                    = UpAndStill
                AnimationName            = arnorfor_a.arnorfor_a
                AnimationMode            = MANUAL
            End
            BeginScript
                CurDrawablePlaySound("GondorBarracksBeginConstruction")
            EndScript
            ParticleSysBone = NONE BuildingContructDustCastles FollowBone:YES
            StateName = BeingConstructed
        End
    End

    //Door
;    Draw = W3DScriptedModelDraw ModuleTag_DrawDoor
;         
;        DefaultModelConditionState
;            Model = None
;        End
;
;        //---Build Up---
;        ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED
;            Model               = GBFDoor_A
;        End
;        
;        AnimationState        = ACTIVELY_BEING_CONSTRUCTED
;            Animation           = GBFDoor_A
;                AnimationName     = GBFDoor_A.GBFDoor_A
;                AnimationMode     = MANUAL
;            End
;        End
;    End


    ;Draw = W3DScriptedModelDraw ModuleTag_DrawDoor

        ;DefaultModelConditionState
            ;Model = None
        ;End


        ;ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED
           ; Model               = GBFDoor_A
        ;End

        ;AnimationState        = ACTIVELY_BEING_CONSTRUCTED
          ;  Animation           = GBFDoor_A
            ;    AnimationName     = GBFDoor_A.GBFDoor_A
           ;     AnimationMode     = MANUAL
           ; End
       ; End
    ;End

 PlacementViewAngle = -45
	
    ArmorSet
        Conditions      = None
        Armor           = DefaultFortressArmor
        DamageFX        = EmptyDamageFX
    End

    Side                = Arnor
    EditorSorting       = STRUCTURE

    BuildCost           = MEN_FORTRESS_BUILDCOST
    BuildTime           = DEFAULT_FORTRESS_BUILDTIME
    MaxSimultaneousOfType = NEW_FORTRESS_RATIO


    DisplayName         = OBJECT:ArnorFortress



    AutoResolveUnitType = AutoResolveUnit_Fortress

        AutoResolveBody = AutoResolve_MenFortressBody

        AutoResolveArmor
            Armor = AutoResolve_MenFortressArmor
        End

        AutoResolveWeapon
            Weapon = AutoResolve_MenFortressWeapon
        End


    #include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

    VoiceFullyCreated                = EVA:FortressComplete-Builder
    VoiceSelect                     = MenFortressSelect
    VoiceSelectUnderConstruction    = BuildingGoodVoiceSelectUnderConstruction

    SoundOnDamaged                    = BuildingLightDamageStone
    SoundOnReallyDamaged            = BuildingHeavyDamageStone

    UnitSpecificSounds
        UnderConstruction            = BuildingBigConstructionLoop
        UnderRepairFromRubble        = BuildingBigConstructionLoop
    End

    ClientBehavior = ModelConditionAudioLoopClientBehavior ModuleTag_PlayCollapseSound
        ModelCondition = REQUIRED:RUBBLE Sound:BuildingSink
    End


    RadarPriority       = STRUCTURE
    KindOf              = STRUCTURE SELECTABLE IMMOBILE BASE_FOUNDATION MP_COUNT_FOR_VICTORY BASE_SITE CAN_SEE_THROUGH_STRUCTURE LIVING_WORLD_BUILDING_MIRROR CAN_CAST_REFLECTIONS

    Body                = StructureBody ModuleTag_05
        MaxHealth         = DEFAULT_FORTRESS_HEALTH
    End

    Behavior = CastleBehavior ModuleTag_castle
        CastleToUnpackForFaction    = Arnor Fortress_Arnor
        CastleToUnpackForFaction    = Men Fortress_Arnor
        CastleToUnpackForFaction    = Rohan Fortress_Arnor
        CastleToUnpackForFaction    = Elves Fortress_Arnor
        CastleToUnpackForFaction    = Imladris Fortress_Arnor
        CastleToUnpackForFaction    = Dwarves Fortress_Arnor
        CastleToUnpackForFaction    = Mordor Fortress_Arnor
        CastleToUnpackForFaction    = Isengard Fortress_Arnor
        CastleToUnpackForFaction    = Wild Fortress_Arnor
        CastleToUnpackForFaction    = Angmar Fortress_Arnor


        FilterValidOwnedEntries = ANY +STRUCTURE +WALK_ON_TOP_OF_WALL +BASE_FOUNDATION +TACTICAL_MARKER

        MaxCastleRadius              = 130.0
        InstantUnpack                = Yes
        KeepDeathKillsEverything     = Yes

        EvaEnemyCastleSightedEvent = EnemyFortressSighted
    End
	
	;Behavior                 = SubObjectsUpgrade Armor_Upgrade
       ;TriggeredBy            = Upgrade_ArnorFortressNumenorStonework
       ;UpgradeTexture             = amonsulcentraltower_d.tga amonsulcentraltower_dha.tga
       ;RecolorHouse            = No
    ;End

    Behavior                  = StructureCollapseUpdate ModuleTag_08
        MinCollapseDelay        = 000
        MaxCollapseDelay        = 000
        CollapseDamping         = .5
        MaxShudder              = 0.6
        MinBurstDelay           = 250
        MaxBurstDelay           = 800
        BigBurstFrequency       = 4
        FXList                  = INITIAL   FX_FortressCollapse
        DestroyObjectWhenDone    = Yes
        CollapseHeight            = 155
    End

    Behavior            = GettingBuiltBehavior ModuleTag_GettingBuiltBehavior
        WorkerName    = ArnorWorkerNoSelect
        SpawnTimer    = DEFAULT_STRUCTURE_HEALDELAY
    End

    Behavior = AIUpdateInterface ModuleTag_AI
        AILuaEventsList                = FortressFunctions
    End


    //Main
    Geometry                  = BOX
    GeometryMajorRadius       = 64
    GeometryMinorRadius       = 64
    GeometryHeight            = 50

    //Plot locations
    AdditionalGeometry        = BOX
    GeometryName            = Plots
    GeometryMajorRadius        = 10.0
    GeometryMinorRadius        = 10.0
    GeometryHeight            = 0.8
    GeometryOffset            = X:64.0 Y:-64.0 Z:0    

    AdditionalGeometry        = BOX
    GeometryName            = Plots
    GeometryMajorRadius        = 10.0
    GeometryMinorRadius        = 10.0
    GeometryHeight            = 0.8
    GeometryOffset            = X:00 Y:-62.0 Z:0    

    AdditionalGeometry        = BOX
    GeometryName            = Plots
    GeometryMajorRadius        = 10.0
    GeometryMinorRadius        = 10.0
    GeometryHeight            = 0.8
    GeometryOffset            = X:-64.0 Y:-64.0 Z:0    

    AdditionalGeometry        = BOX
    GeometryName            = Plots
    GeometryMajorRadius        = 10.0
    GeometryMinorRadius        = 10.0
    GeometryHeight            = 0.8
    GeometryOffset            = X:-64.0 Y:64.0 Z:0

    AdditionalGeometry        = BOX
    GeometryName            = Plots
    GeometryMajorRadius        = 10.0
    GeometryMinorRadius        = 10.0
    GeometryHeight            = 0.8
    GeometryOffset            = X:0 Y:62.0 Z:0

    AdditionalGeometry        = BOX
    GeometryName            = Plots
    GeometryMajorRadius        = 10.0
    GeometryMinorRadius        = 10.0
    GeometryHeight            = 0.8
    GeometryOffset            = X:64.0 Y:64.0 Z:0

    GeometryIsSmall            = No
    Shadow                    = SHADOW_VOLUME

    GeometryContactPoint = X:-90        Y:82        Z:0            Repair
    GeometryContactPoint = X:84        Y:-79        Z:0            Repair
    GeometryContactPoint = X:5.576        Y:44.987    Z:0
    GeometryContactPoint = X:-38.348    Y:-42.113    Z:0
    GeometryContactPoint = X:-28.448    Y:-0.003    Z:75.14        Swoop

End


ChildObject    ArnorFortressDarkEye ArnorFortress
End

