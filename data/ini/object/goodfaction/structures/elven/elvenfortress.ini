Object ElvenFortressCenterGeneric

    SelectPortrait = BRImladrisFestung

    Draw = W3DScriptedModelDraw ModuleTag_01

        DefaultModelConditionState
              Model = None
        End

        ModelConditionState = WORLD_BUILDER
            Model = NBasePin
        End
    End

    Side              = Imladris
    EditorSorting     = STRUCTURE
    KindOf            = IMMOBILE BASE_FOUNDATION CASTLE_CENTER

    Behavior = CastleBehavior ModuleTag_castle
        FilterValidOwnedEntries = ANY +STRUCTURE +WALK_ON_TOP_OF_WALL +BASE_FOUNDATION +TACTICAL_MARKER
    End
End




Object ElvenFortressExpansionPadCorner

    SelectPortrait = BRImladrisSlot

    Draw = W3DFloorDraw DrawFloorBase
        ModelName = imlafoundatn
    End

    Draw = W3DScriptedModelDraw ModuleTag_DrawMain
        DefaultModelConditionState
            Model = WBFoundationP
        End
        ModelConditionState = CONSTRUCTION_COMPLETE
            Model = None
        End
    End


    DisplayName         = OBJECT:ElvenBuildingFoundation
    Side                = Imladris
    EditorSorting       = STRUCTURE
    ThreatLevel         = 1.0

    BuildCost           = 1
    BuildTime           = 5.0
    VisionRange         = 0.0
    ShroudClearingRange = 0

    CommandSet = ElvenFortressExpansionPadCornerCommandSet
	
	


    VoiceSelect = Gui_PlotSelect2


    KindOf              = STRUCTURE SELECTABLE IMMOBILE BASE_FOUNDATION UNATTACKABLE MP_COUNT_FOR_VICTORY NO_COLLIDE DO_NOT_CLASSIFY EXPANSION_PAD

    Behavior        = FoundationAIUpdate ModuleTag_foundationAI
        BuildVariation    = 2
    End

    Behavior = CastleMemberBehavior ModuleTag_CMB
    End

    Body                = ImmortalBody ModuleTag_05
        MaxHealth       = DEFAULT_FORTRESS_HEALTH
    End

    Geometry                = CYLINDER
    GeometryMajorRadius     = 15.0
    GeometryMinorRadius     = 15.0
    GeometryHeight          = 0.8
    GeometryIsSmall         = No
    Shadow                  = SHADOW_VOLUME
    BuildCompletion         = PLACED_BY_PLAYER
End

ChildObject ElvenFortressExpansionPadSide ElvenFortressExpansionPadCorner

    CommandSet = ElvenFortressExpansionPadSideCommandSet

    Behavior           = FoundationAIUpdate ModuleTag_foundationAI
        BuildVariation = 1
    End
End




Object ElvenCitadel

Draw = W3DFloorDraw ModuleTag_DrawFortressFloor
    ModelName            	= FL_IMLADRIS
    StartHidden 		= No
    HideIfModelConditions	= AWAITING_CONSTRUCTION
    HideIfModelConditions	= PARTIALLY_CONSTRUCTED
    ForceToBack 		= Yes
    FloorFadeRateOnObjectDeath  = -0.01
End

    SelectPortrait = BRImladrisFestung

    Draw = W3DScriptedModelDraw ModuleTag_Draw
        ExtraPublicBone         = ARROW_01
        ExtraPublicBone         = ARROW_02
        ExtraPublicBone         = ARROW_03
        ExtraPublicBone         = ARROW_04
        ExtraPublicBone         = ARROW_05
        ExtraPublicBone         = ARROW_06
        ExtraPublicBone         = ARROW_07
        ExtraPublicBone         = ARROW_08
        ExtraPublicBone         = ARROW_09
        ExtraPublicBone         = ARROW_10
        ExtraPublicBone         = ARROW_11
        ExtraPublicBone         = ARROW_12
        ExtraPublicBone         = ARROW_13
        ExtraPublicBone         = ARROW_14
        ExtraPublicBone         = ARROW_15
        ExtraPublicBone         = ARROW_16
        ExtraPublicBone         = ARROW_17
        ExtraPublicBone         = ARROW_18
        ExtraPublicBone         = ARROW_19
        ExtraPublicBone         = ARROW_20
        ExtraPublicBone         = ARROW_21
        ExtraPublicBone         = ARROW_22
        ExtraPublicBone         = ARROW_23
        ExtraPublicBone         = ARROW_24
        ExtraPublicBone         = ARROW_25
        ExtraPublicBone         = ARROW_26
        ExtraPublicBone         = ARROW_27
        ExtraPublicBone         = ARROW_28
        ExtraPublicBone         = ARROW_29
        ExtraPublicBone         = ARROW_30
        ExtraPublicBone         = ARROW_31
        ExtraPublicBone         = ARROW_32

        OkToChangeModelColor    = Yes
        UseStandardModelNames   = Yes
        StaticModelLODMode      = Yes

        DefaultModelConditionState
            Model = ebrivfortress
            WeaponLaunchBone    = PRIMARY ARROW_
        End

        ModelConditionState = DAMAGED
            Model        = ebrivfortress
        Texture = rivbuilding1.tga rivbuilding1_d1.tga
        End

        AnimationState    = DAMAGED
            Animation    = Fortress_ReallyDamaged
                AnimationName        = ebrivfortress .rivfortress
                AnimationMode        = ONCE
            End
            EnteringStateFX    = FX_FortressDamaged
        End

        ModelConditionState = REALLYDAMAGED
            Model        = ebrivfortress
        Texture = rivbuilding1.tga rivbuilding1_d1.tga
        End

        AnimationState    = REALLYDAMAGED
            Animation    = Fortress_ReallyDamaged
                AnimationName        = ebrivfortress.ebrivfortress
                AnimationMode        = ONCE
            End
            EnteringStateFX    = FX_FortressReallyDamaged
        End

        ModelConditionState = RUBBLE
            Model        = ebrivfortress
        Texture = rivbuilding1.tga rivbuilding1_d1.tga
        End

        AnimationState    = RUBBLE
            Animation    = Fortress_Rubble
                AnimationName        = ebrivfortress.ebrivfortress
                AnimationMode        = ONCE
            End
            EnteringStateFX    = FX_FortressCollapse
        End

        ModelConditionState  = POST_RUBBLE
            Model         = None
            ParticleSysBone NONE SmokeBuildingMediumRubble
        End

        AnimationState = POST_RUBBLE
        End

        ModelConditionState  = POST_COLLAPSE
            Model         = None
            ParticleSysBone NONE SmokeBuildingMediumRubble
        End

        AnimationState = POST_COLLAPSE
        End


        ModelConditionState = SNOW UPGRADE_NUMENOR_STONEWORK
            Model    = ebrivfortress
        Texture = rivbuilding1.tga rivbuilding1_Snow.tga
        End

        ModelConditionState = UPGRADE_NUMENOR_STONEWORK
            Model    = ebrivfortress
        End


        ModelConditionState = SNOW
            Model = ebrivfortress
            Texture = rivbuilding1.tga rivbuilding1_Snow.tga
        End
    End


    Draw = W3DScriptedModelDraw ModuleTag_EaglesNestDraw
        OkToChangeModelColor    = Yes
        StaticModelLODMode      = Yes

        DefaultModelConditionState
            Model           = None
        End


        ModelConditionState = UPGRADE_FORTRESS_MONUMENT USER_2 DAMAGED
            Model           = EBFENest_A
            Texture            = EBFortress.tga EBFortress_D.tga
        End

        ModelConditionState = UPGRADE_FORTRESS_MONUMENT USER_2 REALLYDAMAGED
            Model           = EBFENest_A
            Texture            = EBFortress.tga EBFortress_D.tga
        End

        ModelConditionState = UPGRADE_FORTRESS_MONUMENT USER_2 SNOW
            Model           = EBFENest_A
            Texture            = EBFortress.tga EBFortress_snow.tga
        End
        ModelConditionState = UPGRADE_FORTRESS_MONUMENT USER_2
            Model           = EBFENest_A
        End

        AnimationState = UPGRADE_FORTRESS_MONUMENT USER_2
            Animation                    = RiseUp
                AnimationName            = EBFENest_ASKL.EBFENest_ABLD
                AnimationMode            = ONCE
                AnimationSpeedFactorRange = 5.0 5.0
            End
        End

        ModelConditionState = UPGRADE_FORTRESS_MONUMENT DAMAGED
            Model        = EBFENest
            Texture        = EBFortress.tga EBFortress_D.tga
        End

        ModelConditionState = UPGRADE_FORTRESS_MONUMENT REALLYDAMAGED
            Model        = EBFENest_D2
        End

        AnimationState    = UPGRADE_FORTRESS_MONUMENT REALLYDAMAGED
            Animation    = EBFENest_ReallyDamaged
                AnimationName        = EBFENest_D2SKL.EBFENest_D2AN
                AnimationMode        = ONCE
            End
        End

        ModelConditionState = UPGRADE_FORTRESS_MONUMENT RUBBLE
            Model        = EBFENest_D3
        End

        AnimationState    = UPGRADE_FORTRESS_MONUMENT RUBBLE
            Animation    = EBFENest_Rubble
                AnimationName        = EBFENest_D3SKL.EBFENest_D3AN
                AnimationMode        = ONCE
            End
        End

        ModelConditionState = SNOW UPGRADE_FORTRESS_MONUMENT
            Model            = EBFENest
            Texture          = EBFortress.tga EBFortress_snow.tga
        End

        ModelConditionState = UPGRADE_FORTRESS_MONUMENT
            Model           = EBFENest
        End
    End


    Draw = W3DScriptedModelDraw ModuleTag_DrawEagle
        StaticModelLODMode        = Yes

        DefaultModelConditionState
            Model            = None
        End

        IdleAnimationState
            StateName        = NoEagle
        End


        ModelConditionState = UPGRADE_FORTRESS_MONUMENT FORTRESS_MONUMENT_CREATURE_AVAILABLE USER_2 DAMAGED
            Model            = EBFE_A
            Texture            = EBFortress.tga EBFortress_D.tga
            ParticleSysBone = NONE EaglesNestbuildleaves
            ParticleSysBone = NONE EaglesNestbuilddust
        End

        ModelConditionState = UPGRADE_FORTRESS_MONUMENT FORTRESS_MONUMENT_CREATURE_AVAILABLE USER_2 REALLYDAMAGED
            Model            = EBFE_A
            Texture            = EBFortress.tga EBFortress_D.tga
            ParticleSysBone = NONE EaglesNestbuildleaves
            ParticleSysBone = NONE EaglesNestbuilddust
        End

        ModelConditionState = UPGRADE_FORTRESS_MONUMENT FORTRESS_MONUMENT_CREATURE_AVAILABLE USER_2
            Model            = EBFE_A
            ParticleSysBone = NONE EaglesNestbuildleaves
            ParticleSysBone = NONE EaglesNestbuilddust
        End

        AnimationState = UPGRADE_FORTRESS_MONUMENT FORTRESS_MONUMENT_CREATURE_AVAILABLE USER_2
            Animation                    = RiseUp
                AnimationName            = EBFE_ASKL.EBFE_ABLD
                AnimationMode            = ONCE
                AnimationSpeedFactorRange = 5.0 5.0
            End
            StateName = BeingConstructed
        End


        ModelConditionState = UPGRADE_FORTRESS_MONUMENT FORTRESS_MONUMENT_CREATURE_AVAILABLE DAMAGED
            Model        = EBFE
            Texture        = EBFortress.tga EBFortress_D.tga
        End

        ModelConditionState = UPGRADE_FORTRESS_MONUMENT FORTRESS_MONUMENT_CREATURE_AVAILABLE REALLYDAMAGED
            Model        = EBFE_D2
        End

        AnimationState    = UPGRADE_FORTRESS_MONUMENT FORTRESS_MONUMENT_CREATURE_AVAILABLE REALLYDAMAGED
            Animation    = EBFENest_ReallyDamaged
                AnimationName        = EBFE_D2SKL.EBFE_D2AN
                AnimationMode        = ONCE
            End
        End

        ModelConditionState = UPGRADE_FORTRESS_MONUMENT FORTRESS_MONUMENT_CREATURE_AVAILABLE RUBBLE
            Model        = EBFE_D3
        End

        AnimationState    = UPGRADE_FORTRESS_MONUMENT FORTRESS_MONUMENT_CREATURE_AVAILABLE RUBBLE
            Animation    = EBFENest_Rubble
                AnimationName        = EBFE_D3SKL.EBFE_D3AN
                AnimationMode        = ONCE
            End
        End


        ModelConditionState = UPGRADE_FORTRESS_MONUMENT FORTRESS_MONUMENT_CREATURE_AVAILABLE
           Model            = EBFE
        End

        ModelConditionState = UPGRADE_FORTRESS_MONUMENT FORTRESS_MONUMENT_CREATURE_UNAVAILABLE
            Model            = EBFE
        End

        AnimationState = UPGRADE_FORTRESS_MONUMENT FORTRESS_MONUMENT_CREATURE_UNAVAILABLE
            StateName    = EagleGone
        End
    End


    Draw = W3DScriptedModelDraw ModuleTag_DrawMysticFountains
        OkToChangeModelColor    = Yes
        StaticModelLODMode      = Yes

        DefaultModelConditionState
            Model           = None
        End


        ModelConditionState = FORTRESS_IMPROVEMENT_2 USER_3 DAMAGED
            Model           = rivbecken
            Texture            = EBFortress.tga EBFortress_D.tga
        End

        ModelConditionState = FORTRESS_IMPROVEMENT_2 USER_3 REALLYDAMAGED
            Model           = rivbecken
            Texture            = EBFortress.tga EBFortress_D.tga
        End

        ModelConditionState = FORTRESS_IMPROVEMENT_2 USER_3
            Model           = rivbecken
        End

        AnimationState = FORTRESS_IMPROVEMENT_2 USER_3
            Animation                    = UpAndStill
                AnimationName            = rivbecken.rivbecken
                AnimationMode            = ONCE
                AnimationSpeedFactorRange = 30.0 30.0
            End
        End


        ModelConditionState      = FORTRESS_IMPROVEMENT_2 DAMAGED
            Model        = rivbecken
            Texture        = EBFortress.tga EBFortress_D.tga
        End

        ModelConditionState      = FORTRESS_IMPROVEMENT_2 REALLYDAMAGED
            Model        = rivbecken
            Texture        = EBFortress.tga EBFortress_D.tga
        End

        AnimationState    = FORTRESS_IMPROVEMENT_2 REALLYDAMAGED
            Animation    = MysticFountains_ReallyDamaged
                AnimationName        = rivbecken.rivbecken
                AnimationMode        = ONCE
            End
        End

        ModelConditionState      = FORTRESS_IMPROVEMENT_2 RUBBLE
            Model        = rivbecken
            Texture        = EBFortress.tga EBFortress_D.tga
        End

        AnimationState    = FORTRESS_IMPROVEMENT_2 RUBBLE
            Animation    = MysticFountains_ReallyDamaged
                AnimationName        = rivbecken.rivbecken
                AnimationMode        = ONCE
            End
        End


        ModelConditionState = FORTRESS_IMPROVEMENT_2
            Model           = rivbecken
        End
    End


    Draw = W3DScriptedModelDraw ModuleTag_DrawEnchantedAnvil
        OkToChangeModelColor    = Yes
        StaticModelLODMode      = Yes
        ExtraPublicBone         = ANVILBONE
        AttachToBoneInAnotherModule = ANVILBONE

        DefaultModelConditionState
            Model           = None
        End


        ModelConditionState      = FORTRESS_IMPROVEMENT_3 DAMAGED USER_1
            Model        = EBFAnvil_A
            Texture        = EBFortress.tga EBFortress_D.tga
        End

        ModelConditionState      = FORTRESS_IMPROVEMENT_3 REALLYDAMAGED USER_1
            Model        = EBFAnvil_A
            Texture        = EBFortress.tga EBFortress_D.tga
        End


        ModelConditionState = FORTRESS_IMPROVEMENT_3 USER_1
            Model    = EBFAnvil_A
        End

        AnimationState = FORTRESS_IMPROVEMENT_3 USER_1
            Animation                        = RiseUp
                AnimationName                = EBFAnvil_ASKL.EBFAnvil_ABLD
                AnimationMode                = ONCE
                AnimationSpeedFactorRange    = 7.0 7.0
            End
        End


        ModelConditionState      = FORTRESS_IMPROVEMENT_3 DAMAGED
            Model        = EBFAnvil
            Texture        = EBFortress.tga EBFortress_D.tga
        End

        ModelConditionState      = FORTRESS_IMPROVEMENT_3 REALLYDAMAGED
            Model        = EBFAnvil_D2
        End

        AnimationState    = FORTRESS_IMPROVEMENT_3 REALLYDAMAGED
            Animation    = EBFAnvil_ReallyDamaged
                AnimationName        = EBFAnvil_D2SKL.EBFAnvil_D2AN
                AnimationMode        = ONCE
            End
        End

        ModelConditionState      = FORTRESS_IMPROVEMENT_3 RUBBLE
            Model        = EBFAnvil_D3
        End

        AnimationState    = FORTRESS_IMPROVEMENT_3 RUBBLE
            Animation    = EBFAnvil_ReallyDamaged
                AnimationName        = EBFAnvil_D3SKL.EBFAnvil_D3AN
                AnimationMode        = ONCE
            End
        End

        ModelConditionState = FORTRESS_IMPROVEMENT_3
            Model           = EBFAnvil
        End
    End

    Draw = W3DScriptedModelDraw ModuleTag_DrawAnvilGuy
        AttachToBoneInAnotherModule = POSITIONBONE


        DefaultModelConditionState
            Model           = None
        End

        ModelConditionState = FORTRESS_IMPROVEMENT_3 USER_1
           Model            = None
        End

        ModelConditionState      = FORTRESS_IMPROVEMENT_3 RUBBLE
            Model        = None
        End

        ModelConditionState = FORTRESS_IMPROVEMENT_3
            Model           = EBFAnvlGuy_SKN
        End

        AnimationState = FORTRESS_IMPROVEMENT_3
            Animation                = IDLA
                AnimationName        = EBFAnvlGuy_SKL.EBFAnvlGuy_IDLA
                AnimationMode        = ONCE
                AnimationPriority   = 20
            End
            Animation                = IDLB
                AnimationName        = EBFAnvlGuy_SKL.EBFAnvlGuy_IDLB
                AnimationMode        = ONCE
                AnimationPriority   = 1
            End
            Animation                = IDLC
                AnimationName        = EBFAnvlGuy_SKL.EBFAnvlGuy_IDLC
                AnimationMode        = ONCE
                AnimationPriority   = 1
            End
            Flags                    = RESTART_ANIM_WHEN_COMPLETE
        End
    End


    Draw = W3DScriptedModelDraw ModuleTag_DrawMist

        DefaultModelConditionState
            Model                = None
        End

        ModelConditionState   = FORTRESS_IMPROVEMENT_8
            Model                = None
            ParticleSysBone        = NONE EnshroudingMist
        End
    End

    DisplayName         = OBJECT:ElvenFortress
    Description         = OBJECT:ElvenFortressDescription
    MaxSimultaneousOfType = NEW_FORTRESS_RATIO
    Side                = Imladris
    EditorSorting       = STRUCTURE
    ThreatLevel         = 1.0
    CommandPointBonus   = MAIN_FORTRESS_COMMAND_POINT
    CommandSet          = ImladrisFortressCommandset
	Behavior = CommandSetUpgrade ModuleTag_CommandSetForess1
        TriggeredBy    = Upgrade_HouseofTheSilverFountup
        CommandSet    = HouseofTheSilverFountCommandSet
    End
	
	Behavior = CommandSetUpgrade ModuleTag_CommandSetForess2
        TriggeredBy    = Upgrade_HouseofTheGoldenFlowerup
        CommandSet    = HouseofTheGoldenFlowerCommandSet
    End
    BuildCost           = ELVEN_FORTRESS_BUILDCOST
    BuildTime           = DEFAULT_FORTRESS_BUILDTIME
    BountyValue         = ELVEN_FORTRESS_BOUNTY_VALUE
    VisionRange         = DEFAULT_FORTRESS_VISION_RANGE
    ShroudClearingRange = DEFAULT_FORTRESS_SHROUD_CLEAR
	
	
	 

	

    WeaponSet
        Weapon               = PRIMARY GoodStructureBow
        AutoChooseSources    = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End

    ArmorSet
        Conditions           = None
        Armor                = DefaultFortressArmor
    End

    ArmorSet
        Conditions 	= PLAYER_UPGRADE
        Armor      	= DefaultFortressArmorUpgraded
    End



    #include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

    EvaEventDieOwner                 = EvaFortressDie

    VoiceSelect                      = ElfFortressSelect
    VoiceSelectUnderConstruction     = BuildingGoodVoiceSelectUnderConstruction

    SoundOnDamaged                   = BuildingLightDamageStone
    SoundOnReallyDamaged             = BuildingHeavyDamageStone

    UnitSpecificSounds
        UnderConstruction            = BuildingBigConstructionLoop
        UnderRepairFromRubble        = BuildingBigConstructionLoop
    End

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound:UpgradeElfFortressEaglesNest        Animation:EBFE_ASKL.EBFE_ABLD    Frames:1250
    End

    CampnessValue = CAMPNESS_FORTRESS


    RadarPriority       = STRUCTURE
    KindOf              = PRELOAD COMMANDCENTER VITAL_FOR_BASE_SURVIVAL STRUCTURE IMMOBILE CASTLE_KEEP MP_COUNT_FOR_VICTORY SELECTABLE FS_FACTORY AUTO_RALLYPOINT MADE_OF_WOOD SCORE DOZER_FACTORY

    Behavior            = GettingBuiltBehavior GetBuiltBehaviorTag
        WorkerName    = ElvenWorkerNoSelect
        SpawnTimer    = DEFAULT_STRUCTURE_HEALDELAY
    End

    Behavior = CastleMemberBehavior ModuleTag_CMB
    End

    Body                        = StructureBody ModuleTag_05
        MaxHealth                     = DEFAULT_FORTRESS_HEALTH
        MaxHealthDamaged              = DEFAULT_FORTRESS_HEALTH_DAMAGED
        MaxHealthReallyDamaged        = DEFAULT_FORTRESS_HEALTH_REALLY_DAMAGED
    End

    Behavior                  = BuildingBehavior BuildingModuleTag
    End

    Behavior                  = StructureCollapseUpdate ModuleTag_06
        MinCollapseDelay        = 000
        MaxCollapseDelay        = 000
        CollapseDamping         = .5
        MaxShudder              = 0.6
        MinBurstDelay           = 250
        MaxBurstDelay           = 800
        BigBurstFrequency       = 4
        FXList                  = INITIAL   FX_FortressCollapse
        DestroyObjectWhenDone   = Yes
        CollapseHeight          = 120
    End

    Behavior = CostModifierUpgrade ModuleTag_CostModifierGwaihir
        LabelForPalantirString    = GUI:GWAIHIR_DISCOUNT
        TriggeredBy               = Upgrade_ElvenFortressEaglesNest
        ObjectFilter              = NONE +ImladrisGwaihirFortressEagle +ImladrisGwaihir +ImladrisGwaihir_WOTR ALLIES
        Percentage                = -0%
        Percentage                = -10%
        Percentage                = -20%
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        ProductionModifier
            RequiredUpgrade = Upgrade_ElvenFortressMysticFountains
            TimeMultiplier  = 0.75
            HeroRevive      = Yes
        End
	ProductionModifier
		RequiredUpgrade = Upgrade_ObjectUnderAIControl
		TimeMultiplier  = TIME_MULTIPLIER_AI_HEROES
		HeroRevive      = Yes
		ModifierFilter  = NONE +HERO
	End
	ProductionModifier
		RequiredUpgrade = Upgrade_BrutalAIMultiPlayer Upgrade_BrutalAISinglePlayer
		CostMultiplier  = COST_MULTIPLIER_AI_HEROES
		HeroPurchase    = Yes
		HeroRevive      = Yes
		ModifierFilter  = NONE +HERO
	End
    End

    Behavior = QueueProductionExitUpdate QueueProductionModuleTag
        UnitCreatePoint          = X:41.0 Y:0.00 Z:0.0
        NaturalRallyPoint        = X:109.0 Y:0.00 Z:0.0
        ExitDelay                = STANDARD_HERO_EXIT_DELAY
    End


    Behavior = GrantUpgradeCreate ModuleTag_ActLikeAnOldUpgrade
        UpgradeToGrant      = Upgrade_EaglesNestEagleButtonEnable
        GiveOnBuildComplete = Yes
    End

    Behavior = ModelConditionUpgrade ModuleTag_ShowTheEaglesNest
        TriggeredBy             = Upgrade_ElvenFortressEaglesNest
        AddConditionFlags       = UPGRADE_FORTRESS_MONUMENT
        AddTempConditionFlag    = ModelConditionState:USER_2
        TempConditionTime       = 11.0
        Permanent               = Yes
    End

    Behavior = AudioLoopUpgrade ModuleTag_EaglesNestBuildLoop
        TriggeredBy            = Upgrade_ElvenFortressEaglesNest
        SoundToPlay            = BuildingBigConstructionLoop
        KillOnDeath            = Yes
        KillAfterMS            = 9000
    End

    Behavior = GeometryUpgrade TowerGeom
        TriggeredBy            = Upgrade_ElvenFortressEaglesNest
        ShowGeometry           = HighTowerGeom
    End

    Behavior = AudioLoopUpgrade ModuleTag_EagleCreated
        TriggeredBy            = Upgrade_HasEaglesNestEagle
        SoundToPlay            = ElvenFortressEagleCreated
    End


    Behavior = ObjectCreationUpgrade MaketheEagle
        TriggeredBy              = Upgrade_HasEaglesNestEagle
        Delay                    = 0.0
        RemoveUpgrade            = Upgrade_EaglesNestEagleButtonEnable
        ThingToSpawn             = ImladrisGwaihirFortressEagle
        FadeInTime               = 600
        UseBuildingProduction    = Yes
    End

    Behavior = SlaveWatcherBehavior WatchTheEagle
        RemoveUpgrade       = Upgrade_HasEaglesNestEagle
        GrantUpgrade        = Upgrade_EaglesNestEagleButtonEnable
        LetSlaveLive        = Yes
    End

    Behavior = ModelConditionUpgrade ModuleTag_AnimateEagle
        TriggeredBy              = Upgrade_EaglesNestEagleButtonEnable
        AddConditionFlags        = FORTRESS_MONUMENT_CREATURE_AVAILABLE
        RemoveConditionFlags     = FORTRESS_MONUMENT_CREATURE_UNAVAILABLE
        Permanent                = Yes
    End

    Behavior = ModelConditionUpgrade ModuleTag_HideEagle
        TriggeredBy              = Upgrade_HasEaglesNestEagle
        AddConditionFlags        = FORTRESS_MONUMENT_CREATURE_UNAVAILABLE
        RemoveConditionFlags     = FORTRESS_MONUMENT_CREATURE_AVAILABLE
        Permanent                = Yes
    End

    Behavior      = SpawnUnitBehavior ModuleTag_allowMeToBuildDrakeFromCitadel
        UnitName        = ElvenFortressEagle
    End

    Behavior = CastleUpgrade ModuleTag_PassOutEncasingVinesUpgrade
        TriggeredBy            = Upgrade_ElvenFortressEncasingVinesTrigger
        Upgrade                = Upgrade_ElvenFortressEncasingVines
        WallUpgradeRadius    = ELVEN_FORTRESS_WALL_EFFECTIVE_RADIUS
    End

    Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
        TriggeredBy                = Upgrade_ElvenFortressEncasingVines
        AttributeModifier        = EncasingVines_Bonus
    End

    Behavior = ModelConditionUpgrade ModuleTag_ShowTheVines
        TriggeredBy            = Upgrade_ElvenFortressEncasingVines
        AddConditionFlags    = UPGRADE_NUMENOR_STONEWORK
        Permanent            = Yes
    End

    Behavior = SubObjectsUpgrade SiegeHammer_ShowTheVines2
        TriggeredBy          = Upgrade_AllFactionUpgrade
        ShowSubObjects       = UPGR
    End

    Behavior = SubObjectsUpgrade SiegeHammer_ShowTheVines3
        TriggeredBy          = Upgrade_AllFactionUpgrade
        HideSubObjects       = WALL
    End


    Behavior = ArmorUpgrade ModuleTag_ArmorUpgrade
        TriggeredBy             = Upgrade_ElvenFortressEncasingVines
    End


    Behavior = ModelConditionUpgrade ModuleTag_ShowMysticFountains
        TriggeredBy                = Upgrade_ElvenFortressMysticFountains
        AddConditionFlags        = FORTRESS_IMPROVEMENT_2
        AddTempConditionFlag    = ModelConditionState:USER_3
        TempConditionTime        = 10.0
        Permanent                = Yes
    End

    Behavior = StatusBitsUpgrade ModuleTag_FakeOutMysticFountains
        TriggeredBy    = Upgrade_ElvenFortressMysticFountains
    End

    Behavior = PassiveAreaEffectBehavior ModuleTag_MysticFountainsHealing
        UpgradeRequired          = Upgrade_ElvenFortressMysticFountains
        EffectRadius             = 250
        PingDelay                = 2000
        HealPercentPerSecond     = 3%
        AllowFilter              = ANY +INFANTRY +CAVALRY +HERO -MACHINE +MONSTER -IMMOBILE +DOZER
        NonStackable             = Yes
        HealFX                   = FX_SpellHealUnitHealBuff
    End

    Behavior = BannerCarrierUpdate BannerCarrierUpdateModuleTag
        UpgradeRequired          = Upgrade_ElvenFortressMysticFountains
        IdleSpawnRate            = 5000
        UnitSpawnFX              = FX_BannerCarrierSpawnUnit
        ReplenishNearbyHorde     = Yes
        ScanHordeDistance        = 200
    End


    Behavior = CostModifierUpgrade ModuleTag_EnchantedAnvilUpgrades
        LabelForPalantirString    = GUI:UPGRADE_DISCOUNT
        TriggeredBy               = Upgrade_ElvenFortressEnchantedAnvil
        UpgradeDiscount           = Yes
        ApplyToTheseUpgrades      = Upgrade_ForgedBlades Upgrade_HeavyArmor Upgrade_BasicTraining Upgrade_SilverThornArrows
        Percentage                = -15%
        Percentage                = -25%
        Percentage                = -35%
    End

    Behavior = ModelConditionUpgrade ModuleTag_ShowTheAnvil
        TriggeredBy                = Upgrade_ElvenFortressEnchantedAnvil
        AddConditionFlags        = FORTRESS_IMPROVEMENT_3
        AddTempConditionFlag    = ModelConditionState:USER_1
        TempConditionTime        = 5.0
        Permanent                = Yes
    End

    Behavior = AudioLoopUpgrade ModuleTag_EnchantedAnvilBuildLoop
        TriggeredBy            = Upgrade_ElvenFortressEnchantedAnvil
        SoundToPlay            = BuildingConstructionLoop
        KillOnDeath            = Yes
        KillAfterMS            = 3500
    End


    Behavior = InvisibilityUpdate ModuleTag_BroadcastCamouflage
        InvisibilityNugget
            InvisibilityType    = CAMOUFLAGE
            DetectionRange      = ELVEN_MIST_CAMOUFLAGE_DETECTION_RANGE
        End
        UpdatePeriod            = 1000
        Broadcast               = Yes
        BroadcastRange          = 300
        BroadcastObjectFilter   = ELVEN_MIST_OBJECT_FILTER
        StartsActive            = Yes
        RequiredUpgrades        = Upgrade_ElvenFortressBlessedMist
    End

    Behavior = ModelConditionUpgrade ModuleTag_AnimateNestDrake
        TriggeredBy              = Upgrade_ElvenFortressBlessedMist
        AddConditionFlags        = FORTRESS_IMPROVEMENT_8
        Permanent                = Yes
    End


    Behavior = ObjectCreationUpgrade CreateTheMoat
        TriggeredBy       = Upgrade_ElvenFortressCrystalMoat
        Delay             = 0.0
        ThingToSpawn      = ElvenFortressCrystalMoat
        FadeInTime        = 600
    End

    Behavior = CitadelSlaughterHordeContain ModuleTag_SlaughterMe
	PassengerFilter			= GENERIC_FACTION_SLAUGHTERABLE
	ObjectStatusOfContained		= UNSELECTABLE ENCLOSED
	CashBackPercent			= 200%
	ContainMax			= 99
	AllowEnemiesInside		= No
	AllowAlliesInside		= No
 	AllowNeutralInside		= No
 	AllowOwnPlayerInsideOverride	= Yes
	EnterSound			= GUI_RingReturned
	EntryOffset			= X:125.0 Y:0.0 Z:0.0
	EntryPosition			= X:30.0 Y:0.0 Z:0.0
	ExitOffset			= X:125.0 Y:0.0 Z:0.0
     End

	#include "..\..\..\FortressRingFunc.inc"


    Behavior = AIUpdateInterface ModuleTag_AI
        AILuaEventsList                = FortressFunctions
        AutoAcquireEnemiesWhenIdle     = Yes
        MoodAttackCheckRate            = 250
    End

    Behavior = PassiveAreaEffectBehavior ModuleTag_TurgonDefender
        EffectRadius            = 300
        PingDelay               = 2000
        ModifierName            = AllowedTurgonDefender
        AllowFilter             = NONE +GondolinTurgon +GondolinTurgon_AI ALLIES
    End

    Behavior = AutoDepositUpdate AutoDepositModuleTag
        DepositTiming           = GENERIC_KEEP_MONEY_TIME
        DepositAmount           = GENERIC_KEEP_MONEY_AMOUNT
        InitialCaptureBonus     = 0
    End

    Behavior = TerrainResourceBehavior ModuleTag_NewMoneyDeadSpot
        Radius            = GENERIC_KEEP_MONEY_RANGE
        MaxIncome         = 0
        IncomeInterval    = 999999
        HighPriority      = Yes
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI1
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 320000
        GrantUpgrade = Upgrade_ElvenFortressEnchantedAnvil
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI2
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 700000
        GrantUpgrade = Upgrade_ElvenFortressBlessedMist
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI3
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 1000000
        GrantUpgrade = Upgrade_ElvenFortressCrystalMoat
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI4
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 1400000
        GrantUpgrade = Upgrade_ElvenFortressMysticFountains
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI5
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 1700000
        GrantUpgrade = Upgrade_ElvenFortressEaglesNest
    End

	;Behavior = FireWeaponUpdate FireWeaponUpdateModuleTag2
        ;FireWeaponNugget
            ;WeaponName = ImladrisKillGlorfindelWeapon
            ;FireDelay  = 0ImladrisKillGlorfindelWeapon
            ;OneShot    = No
        ;End
    ;End
	
	;Behavior = FireWeaponUpdate FireWeaponUpdateModuleTag3
        ;FireWeaponNugget
            ;WeaponName = 
            ;FireDelay  = 0ImladrisKillEcthelionWeapon
            ;OneShot    = No
        ;End
    ;End


    Geometry                = CYLINDER
    GeometryName            = Geom_Orig
    GeometryMajorRadius     = 50.0
    GeometryHeight          = 55.0
    GeometryOffset          = X:0 Y:0 Z:0


    AdditionalGeometry      = BOX
    GeometryName            = Geom_V2
    GeometryMajorRadius     = 12.0
    GeometryMinorRadius     = 10.0
    GeometryHeight          = 120.0
    GeometryOffset          = X:25 Y:25 Z:0

    AdditionalGeometry      = BOX
    GeometryName            = Geom_V2
    GeometryMajorRadius     = 12.0
    GeometryMinorRadius     = 10.0
    GeometryHeight          = 120.0
    GeometryOffset          = X:-25 Y:25 Z:0

    AdditionalGeometry      = BOX
    GeometryName            = Geom_V2
    GeometryMajorRadius     = 12.0
    GeometryMinorRadius     = 10.0
    GeometryHeight          = 120.0
    GeometryOffset          = X:-25 Y:-25 Z:0

    AdditionalGeometry      = BOX
    GeometryName            = Geom_V2
    GeometryMajorRadius     = 12.0
    GeometryMinorRadius     = 10.0
    GeometryHeight          = 120.0
    GeometryOffset          = X:25 Y:-25 Z:0


    AdditionalGeometry      = BOX
    GeometryName            = Geom_V2
    GeometryMajorRadius     = 15.0
    GeometryMinorRadius     = 20.0
    GeometryHeight          = 80.0
    GeometryOffset          = X:60 Y:0 Z:0

    AdditionalGeometry      = BOX
    GeometryMajorRadius     = 12.0
    GeometryMinorRadius     = 16.0
    GeometryHeight          = 22.0
    GeometryOffset          = X:85 Y:0 Z:0

    AdditionalGeometry      = BOX
    GeometryName            = HighTowerGeom
    GeometryMajorRadius     = 12
    GeometryMinorRadius     = 12
    GeometryHeight          = 150
    GeometryOffset          = X:0 Y:0 Z:0
    GeometryUsedForHealthBox = No

    GeometryIsSmall         = No
    Shadow                  = SHADOW_VOLUME
    BuildCompletion         = PLACED_BY_PLAYER

    GeometryContactPoint = X:-50.348       Y:26.9         Z:0         Repair
    GeometryContactPoint = X:47.546        Y:-38.677      Z:0         Repair
    GeometryContactPoint = X:47.546        Y:36.435       Z:0
    GeometryContactPoint = X:-32.763       Y:-46.121      Z:0
    GeometryContactPoint = X:0             Y:0            Z:180       Swoop
End




Object ElvenFortress

    SelectPortrait = BRImladrisFestung

    Draw    = W3DScriptedModelDraw ModuleTag_01
        OkToChangeModelColor    = Yes
        StaticModelLODMode      = Yes

        DefaultModelConditionState
            Model           = None
        End

        IdleAnimationState
        End

        ModelConditionState = WORLD_BUILDER
            Model    = ebrivfortress
        End

        ModelConditionState = BUILD_PLACEMENT_CURSOR
            Model    = None
        End

        ModelConditionState =  PHANTOM_STRUCTURE
            Model    = ebrivfortress
        End

        ModelConditionState = RUBBLE
            Model        = ebrivfortress
        End

        AnimationState    = RUBBLE
            Animation    = Fortress_Rubble
                AnimationName        = ebrivfortress.ebrivfortress
                AnimationMode        = ONCE
            End
            EnteringStateFX    = FX_FortressCollapse
        End

        ModelConditionState = ACTIVELY_BEING_CONSTRUCTED SNOW
            Model            = rivfortress_a
            Texture    = EBFortress.tga EBFortress_U_Snow.tga
        End
        ModelConditionState = ACTIVELY_BEING_CONSTRUCTED
            Model            = rivfortress_a
        End

        AnimationState = ACTIVELY_BEING_CONSTRUCTED
            Animation                    = rivfortress_a
                AnimationName            = rivfortress_a.rivfortress_a
                AnimationMode            = MANUAL
            End
            ParticleSysBone = NONE BuildingContructDustCastles FollowBone:Yes
            ParticleSysBone = NONE FortressElven FollowBone:Yes
            StateName = BeingConstructed
            BeginScript
                CurDrawablePlaySound("GondorBarracksBeginConstruction")
            EndScript
        End
    End

    PlacementViewAngle = -45

      ArmorSet
        Conditions        = None
        Armor             = DefaultFortressArmor
      End

    Side                = Imladris
    EditorSorting       = STRUCTURE

    MaxSimultaneousOfType = NEW_FORTRESS_RATIO
    BuildCost           = ELVEN_FORTRESS_BUILDCOST
    BuildTime           = DEFAULT_FORTRESS_BUILDTIME

    DisplayName         = OBJECT:ElvenFortress


    #include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

    VoiceFullyCreated                = EVA:FortressComplete-Builder-Elf
    VoiceSelect                        = ElfFortressSelect
    VoiceSelectUnderConstruction    = BuildingGoodVoiceSelectUnderConstruction

    SoundOnDamaged                    = BuildingLightDamageStone
    SoundOnReallyDamaged            = BuildingHeavyDamageStone

    UnitSpecificSounds
        UnderConstruction            = BuildingBigConstructionLoop

        UnderRepairFromRubble        = BuildingBigConstructionLoop
    End

    ClientBehavior = ModelConditionAudioLoopClientBehavior ModuleTag_PlayCollapseSound
        ModelCondition = REQUIRED:RUBBLE Sound:BuildingSink
    End



    AutoResolveUnitType = AutoResolveUnit_Fortress

        AutoResolveBody = AutoResolve_ElvenFortressBody

        AutoResolveArmor
            Armor = AutoResolve_ElvenFortressArmor
        End

        AutoResolveWeapon
            Weapon = AutoResolve_ElvenFortressWeapon
        End



    RadarPriority       = STRUCTURE
    KindOf              = STRUCTURE SELECTABLE IMMOBILE BASE_FOUNDATION MP_COUNT_FOR_VICTORY BASE_SITE CAN_SEE_THROUGH_STRUCTURE LIVING_WORLD_BUILDING_MIRROR


    Body                        = StructureBody ModuleTag_05
        MaxHealth                     = DEFAULT_FORTRESS_HEALTH
    End

    Behavior = CastleBehavior ModuleTag_castle
        CastleToUnpackForFaction    = Imladris Fortress_Elves
        CastleToUnpackForFaction    = Men Fortress_Elves
        CastleToUnpackForFaction    = Arnor Fortress_Elves
        CastleToUnpackForFaction    = Rohan Fortress_Elves
        CastleToUnpackForFaction    = Elves Fortress_Elves
        CastleToUnpackForFaction    = Dwarves Fortress_Elves
        CastleToUnpackForFaction    = Mordor Fortress_Elves
        CastleToUnpackForFaction    = Isengard Fortress_Elves
        CastleToUnpackForFaction    = Wild Fortress_Elves
        CastleToUnpackForFaction    = Angmar Fortress_Elves

        FilterValidOwnedEntries     = ANY +STRUCTURE +WALK_ON_TOP_OF_WALL +BASE_FOUNDATION +TACTICAL_MARKER
        MaxCastleRadius             = 130.0
        InstantUnpack               = Yes
        KeepDeathKillsEverything    = Yes
        EvaEnemyCastleSightedEvent  = EnemyFortressSighted
    End

    Behavior                  = StructureCollapseUpdate ModuleTag_06
        MinCollapseDelay        = 000
        MaxCollapseDelay        = 000
        CollapseDamping         = .5
        MaxShudder              = 0.6
        MinBurstDelay           = 250
        MaxBurstDelay           = 800
        BigBurstFrequency       = 4
        FXList                  = INITIAL   FX_FortressCollapse

        DestroyObjectWhenDone    = Yes
        CollapseHeight            = 120
    End

    Behavior            = GettingBuiltBehavior ModuleTag_GettingBuiltBehavior
        WorkerName    = ElvenWorkerNoSelect
        SpawnTimer    = DEFAULT_STRUCTURE_HEALDELAY
    End

    Behavior = AIUpdateInterface ModuleTag_AI
        AILuaEventsList        =    FortressFunctions
    End



    Geometry                = CYLINDER
    GeometryName            = Geom_Orig
      GeometryMajorRadius        = 85.0
    GeometryHeight            = 55.0


    AdditionalGeometry        = BOX
    GeometryName            = Plots
    GeometryMajorRadius        = 10.0
    GeometryMinorRadius        = 10.0
    GeometryHeight            = 0.8
    GeometryOffset            = X:66.49 Y:-66.49 Z:0

    AdditionalGeometry        = BOX
    GeometryName            = Plots
    GeometryMajorRadius        = 10.0
    GeometryMinorRadius        = 10.0
    GeometryHeight            = 0.8
    GeometryOffset            = X:0 Y:-94.0 Z:0

    AdditionalGeometry        = BOX
    GeometryName            = Plots
    GeometryMajorRadius        = 10.0
    GeometryMinorRadius        = 10.0
    GeometryHeight            = 0.8
    GeometryOffset            = X:-66.49 Y:-66.49 Z:0

    AdditionalGeometry        = BOX
    GeometryName            = Plots
    GeometryMajorRadius        = 10.0
    GeometryMinorRadius        = 10.0
    GeometryHeight            = 0.8
    GeometryOffset            = X:-94.0 Y:0 Z:0

    AdditionalGeometry        = BOX
    GeometryName            = Plots
    GeometryMajorRadius        = 10.0
    GeometryMinorRadius        = 10.0
    GeometryHeight            = 0.8
    GeometryOffset            = X:-66.49 Y:66.49 Z:0

    AdditionalGeometry        = BOX
    GeometryName            = Plots
    GeometryMajorRadius        = 10.0
    GeometryMinorRadius        = 10.0
    GeometryHeight            = 0.8
    GeometryOffset            = X:0 Y:94.0 Z:0

    AdditionalGeometry        = BOX
    GeometryName            = Plots
    GeometryMajorRadius        = 10.0
    GeometryMinorRadius        = 10.0
    GeometryHeight            = 0.8
    GeometryOffset            = X:66.49 Y:66.49 Z:0


    AdditionalGeometry        = BOX
    GeometryMajorRadius        = 12.0
     GeometryMinorRadius        = 16.0
     GeometryHeight            = 22.0
    GeometryOffset            = X:85 Y:0 Z:0

    GeometryIsSmall         = No
    Shadow                    = SHADOW_VOLUME
End





Object ElvenFortressCrystalMoat

    SelectPortrait = BRImladrisFestung

    Draw    = W3DScriptedModelDraw ModuleTag_01
        OkToChangeModelColor    = Yes

        DefaultModelConditionState
            Model           = rivcrmoat
        End

        ModelConditionState = DAMAGED
            Model            = rivcrmoat
        End

        ModelConditionState = REALLYDAMAGED
            Model            = rivcrmoat
        End

        AnimationState    = REALLYDAMAGED
            Animation    = EBFCMoat_ReallyDamaged
                AnimationName        = rivcrmoat.rivcrmoat
                AnimationMode        = ONCE
            End
        End

        ModelConditionState = RUBBLE
            Model            = rivcrmoat
        End

        AnimationState    = RUBBLE
            Animation    = EBFCMoat_ReallyDamaged
                AnimationName        = rivcrmoat.rivcrmoat
                AnimationMode        = ONCE
            End
        End
    End

    ArmorSet
        Conditions        = None
          Armor             = NoArmor

      End

    Side                = Imladris
    EditorSorting       = STRUCTURE


    #include "..\..\..\Includes\StandardBuildingEvaEvents.inc"
    CampnessValue = 0



    RadarPriority       = STRUCTURE
    KindOf              = STRUCTURE IMMOBILE UNATTACKABLE NOT_AUTOACQUIRABLE BASE_SITE CAN_SEE_THROUGH_STRUCTURE

    Body = HighlanderBody ModuleTag_02
        MaxHealth      = 50.0
    End

    Behavior = SlavedUpdate ModuleTag_Slave
        DieOnMastersDeath = Yes
    End

    Geometry                  = CYLINDER
    GeometryMajorRadius       = 80
    GeometryHeight          = 10
    GeometryIsSmall         = No
    Shadow                    = SHADOW_VOLUME
End

ChildObject MER_ElvenFortress_1 ElvenFortress

  Behavior = CastleBehavior ModuleTag_castle
        CastleToUnpackForFaction    = Elves Fortress_Elves
        CastleToUnpackForFaction    = Dwarves Fortress_Elves
        CastleToUnpackForFaction    = Men Fortress_Elves
        CastleToUnpackForFaction    = Wild Fortress_Elves
        CastleToUnpackForFaction    = Isengard Fortress_Elves
        CastleToUnpackForFaction    = Mordor Fortress_Elves

        FilterValidOwnedEntries     = ANY +STRUCTURE +WALK_ON_TOP_OF_WALL +BASE_FOUNDATION +TACTICAL_MARKER
        MaxCastleRadius             = 130.0
        FadeTime                    = 2.0
        InstantUnpack               = Yes
        KeepDeathKillsEverything    = Yes
        EvaEnemyCastleSightedEvent  = EnemyFortressSighted
        PreBuiltList = ElvenVigilantEntExpansion 3
          PreBuiltList = ElvenFloodgateExpansion 0
          PreBuiltList = ElvenWatchtowerExpansion 4
          PreBuiltList = ElvenVigilantEntExpansion 1
          PreBuiltList = ElvenWatchtowerExpansion 5
          PreBuiltList = ElvenFloodgateExpansion 2
          PreBuiltList = ElvenVigilantEntExpansion 6
        PreBuiltPlyr = PlyrRivendell

    End
END

ChildObject MER_ElvenFortress_2 ElvenFortress

  Behavior = CastleBehavior ModuleTag_castle
          CastleToUnpackForFaction    = Elves Fortress_Elves
        CastleToUnpackForFaction    = Dwarves Fortress_Elves
        CastleToUnpackForFaction    = Men Fortress_Elves
        CastleToUnpackForFaction    = Wild Fortress_Elves
        CastleToUnpackForFaction    = Isengard Fortress_Elves
        CastleToUnpackForFaction    = Mordor Fortress_Elves


        FilterValidOwnedEntries        = ANY +STRUCTURE +WALK_ON_TOP_OF_WALL +BASE_FOUNDATION +TACTICAL_MARKER
        MaxCastleRadius             = 130.0
        FadeTime                    = 2.0
        InstantUnpack                = Yes
        KeepDeathKillsEverything    = Yes
        EvaEnemyCastleSightedEvent = EnemyFortressSighted
        PreBuiltList = ElvenWatchtowerExpansion 3
          PreBuiltList = ElvenVigilantEntExpansion 0
          PreBuiltList = ElvenWatchtowerExpansion 4
          PreBuiltList = ElvenVigilantEntExpansion 1
          PreBuiltList = ElvenWatchtowerExpansion 5
          PreBuiltList = ElvenVigilantEntExpansion 2
          PreBuiltList = ElvenWatchtowerExpansion 6

        PreBuiltPlyr = PlyrRivendell

    End
END

ChildObject EGH_ElvenFortress_1 ElvenFortress
    Behavior = CastleBehavior ModuleTag_castle
          CastleToUnpackForFaction    = Elves Fortress_Elves
        CastleToUnpackForFaction    = Dwarves Fortress_Elves
        CastleToUnpackForFaction    = Men Fortress_Elves
        CastleToUnpackForFaction    = Wild Fortress_Elves
        CastleToUnpackForFaction    = Isengard Fortress_Elves
        CastleToUnpackForFaction    = Mordor Fortress_Elves

        FilterValidOwnedEntries        = ANY +STRUCTURE +WALK_ON_TOP_OF_WALL +BASE_FOUNDATION +TACTICAL_MARKER
        MaxCastleRadius             = 130.0
        FadeTime                = 2.0
        InstantUnpack            = Yes
        KeepDeathKillsEverything    = Yes
        EvaEnemyCastleSightedEvent    = EnemyFortressSighted
        PreBuiltList             = ElvenWatchtowerExpansion -2
          PreBuiltList             = ElvenWatchtowerExpansion -2
          PreBuiltList             = ElvenWatchtowerExpansion -2
          PreBuiltList             = ElvenWatchtowerExpansion -2
          PreBuiltList             = ElvenWatchtowerExpansion -2
          PreBuiltList             = ElvenWatchtowerExpansion -2
        PreBuiltPlyr             = PlyrElves
    End
End

ChildObject EGH_ElvenFortress_2 ElvenCitadel

    ArmorSet
        Conditions        = None
        Armor             = DefaultFortressWallArmor
    End
End

