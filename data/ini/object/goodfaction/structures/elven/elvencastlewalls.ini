




Object ElvenCastleWallSegment


      SelectPortrait = BRBruchtalWall

    Draw = W3DScriptedModelDraw ModuleTag_Draw
        OkToChangeModelColor  = Yes
        UseStandardModelNames = Yes
        DefaultModelConditionState
            Model = lbwall
        End

        ModelConditionState = BUILD_PLACEMENT_CURSOR
            Model =  lbwall
        End









    IdleAnimationState
        StateName    =    STATE_Idle
        Animation = lbwall
            AnimationName        =    lbwall.lbwall
            AnimationMode        =    LOOP
            AnimationBlendTime    =    0
        End
        BeginScript
            CurDrawableHideSubObject("WALL")
        EndScript
    End



        ModelConditionState = SNOW AWAITING_CONSTRUCTION
            Model = lbwall_b
            Texture    = EBFortress.tga EBFortress_snow.tga
        End

        ModelConditionState   = AWAITING_CONSTRUCTION
            Model               = lbwall_b
        End
        AnimationState        = AWAITING_CONSTRUCTION
            Animation           =  lbwall_b
                AnimationName     =  lbwall_b.lbwall_b
                AnimationMode     = MANUAL
                AnimationBlendTime = 0
            End
            Flags                  = START_FRAME_FIRST
        End

        ModelConditionState = UPGRADE_NUMENOR_STONEWORK ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Model    = lbwall_b
            Texture    = EBFortress.tga EBFortress_U.tga
        End
        ModelConditionState = SNOW ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Model = lbwall_b
        Texture = rivbuilding1.tga rivbuilding1_Snow.tga
        End

        ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Model               = lbwall_b
        End

        AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Animation           = lbwall_b
                AnimationName     = lbwall_b.lbwall_b
                AnimationMode     = MANUAL
                AnimationBlendTime = 0
            End
            Flags                  = START_FRAME_FIRST
            StateName              = BeingConstructed
            ParticleSysBone   = NONE WallConstructDust FollowBone:Yes
        BeginScript
            CurDrawableHideSubObject("WALL")
        EndScript
        End


        ModelConditionState  = DAMAGED
            Model         = lbwall
        Texture = rivbuilding1.tga rivbuilding1_d1.tga
        End
        AnimationState = DAMAGED
            EnteringStateFX    = FX_WallDamaged
        End

        ModelConditionState  = REALLYDAMAGED
            Model         = lbwall
        Texture = rivbuilding1.tga rivbuilding1_d1.tga
        End

        AnimationState = REALLYDAMAGED
              Animation                =    RubbleAnimation
                AnimationName        =     lbwall.lbwall
                AnimationMode        =    ONCE
              End
            EnteringStateFX    = FX_WallDamaged
        End

        ModelConditionState  = COLLAPSING
            Model         = lbwall
        Texture = rivbuilding1.tga rivbuilding1_d1.tga
        End

        AnimationState = COLLAPSING
              Animation                =    RubbleAnimation
                AnimationName        =     lbwall.lbwall
                AnimationMode        =    ONCE
              End
              ParticleSysBone NONE WallDestructionDust
        End

        ModelConditionState  = RUBBLE
            Model         = None
        End

        ModelConditionState  = POST_RUBBLE
            Model         = None
        End
        AnimationState = POST_RUBBLE
        End

        ModelConditionState  = POST_COLLAPSE
        Model         = None
        End
        AnimationState = POST_COLLAPSE
        End

        ModelConditionState = UPGRADE_NUMENOR_STONEWORK
            Model    = lbwall
            Texture    = EBFortress.tga EBFortress_U.tga
        End
        ModelConditionState = SNOW
            Model = lbwall
        Texture = rivbuilding1.tga rivbuilding1_Snow.tga
        End

    End


    Draw = W3DScriptedModelDraw ModuleTag_Draw_Rubble
        OkToChangeModelColor  = Yes
        UseStandardModelNames = Yes
        DefaultModelConditionState
            Model = None
        End

        ModelConditionState  = COLLAPSING
            Model         = GBWall_Rubble
        End

        ModelConditionState  = RUBBLE
            Model         = GBWall_Rubble
        End

        ModelConditionState  = POST_RUBBLE
            Model         = GBWall_Rubble
        End

        ModelConditionState  = POST_COLLAPSE
            Model         = None
        End
    End


    DisplayName         = OBJECT:ElvenCastleWallSegment
    Side                = Elves
    EditorSorting       = STRUCTURE
    ThreatLevel = 1.0

    BuildCost           = ELVEN_CASTLE_WALLSEGMENT_BUILDCOST
    BuildTime           = ELVEN_CASTLE_WALLSEGMENT_BUILDTIME
    VisionRange         = 160.0
    ShroudClearingRange = 160
    CommandSet            = ElvenWallUpgradeNodeCommandSet

    ArmorSet
        Conditions        = None
        Armor             = ElvenWallArmor
    End



    #include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

    VoiceSelect                        = Gui_PlotSelect2
    VoiceSelectUnderConstruction    = BuildingGoodVoiceSelectUnderConstruction

    SoundOnDamaged                    = BuildingLightDamageStone
    SoundOnReallyDamaged            = BuildingHeavyDamageStone

    UnitSpecificSounds
        UnderConstruction        = WallConstructionLoop

        UnderRepairFromRubble    = WallConstructionLoop
    End

    ClientBehavior = ModelConditionAudioLoopClientBehavior ModuleTag_PlayCollapseSound
        ModelCondition = REQUIRED:RUBBLE Sound:BuildingSink
    End

    CampnessValue = CAMPNESS_WALL


    RadarPriority       = STRUCTURE
    KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE WALL_SEGMENT SCALEABLE_WALL MADE_OF_STONE
    ThreatBreakdown ThreatBreakdown_ModuleTag
        AIKindOf = WALL
    End


    KeepSelectableWhenDead    = Yes


    Behavior            = GettingBuiltBehavior ModuleTag_04
        SelfBuildingLoop            = WallConstructionLoop
        SelfRepairFromDamageLoop    = NoSound
        SelfRepairFromRubbleLoop    = WallConstructionLoop
        UseSpawnTimerWithoutWorker         = Yes
        SpawnTimer    = DEFAULT_STRUCTURE_HEALDELAY
        RebuildTimeSeconds            = ELVEN_CASTLE_WALLSEGMENT_BUILDTIME
    End

    Body                = StructureBody ModuleTag_05
        MaxHealth                = ELVEN_CASTLE_WALLSEGMENT_HEALTH
        MaxHealthDamaged        = ELVEN_CASTLE_WALLSEGMENT_HEALTH_DAMAGED
        MaxHealthReallyDamaged    = ELVEN_CASTLE_WALLSEGMENT_HEALTH_REALLY_DAMAGED
    End


    Behavior = KeepObjectDie ModuleTag_IWantRubble
        DeathTypes            = ALL -SUICIDED
    End
    Behavior            = SlowDeathBehavior ModuleTag_SlowDeath
        DeathTypes            = NONE +SUICIDED
        DestructionDelay = 5000
    End



    Behavior                  = StructureCollapseUpdate ModuleTag_StructureCollapseUpdate
        MinCollapseDelay        = 000
        MaxCollapseDelay        = 000
        CollapseDamping         = .5
        MaxShudder              = 0.6
        MinBurstDelay           = 250
        MaxBurstDelay           = 800
        BigBurstFrequency       = 4

        DestroyObjectWhenDone    = Yes
        CollapseHeight        = 0
    End


    Behavior = ReplaceSelfUpgrade ModuleTag_Replace_With_Hub
        ReplaceWith = ElvenCastleWallHub
        TriggeredBy = Upgrade_ElvenWallHub
        ConflictsWith = Upgrade_ElvenWallRegularGate Upgrade_RohanWallSeiteneingang Upgrade_RohanWallTower
    End

    Behavior = ReplaceSelfUpgrade ModuleTag_Replace_With_Gate
        ReplaceWith = ElvenCastleWallGate
        TriggeredBy = Upgrade_ElvenWallRegularGate
        ConflictsWith = Upgrade_ElvenWallHub Upgrade_RohanWallSeiteneingang Upgrade_RohanWallTower
    End

    Behavior = ReplaceSelfUpgrade ModuleTag_Replace_With_Tower
        ReplaceWith = ElvenCastleWallTower
        TriggeredBy = Upgrade_RohanWallTower
        ConflictsWith = Upgrade_ElvenWallHub Upgrade_ElvenWallRegularGate Upgrade_RohanWallSeiteneingang
    End

    Behavior = ReplaceSelfUpgrade ModuleTag_Replace_With_Seiteneingang
        ReplaceWith = ElvenCastleWallSeiteneingang
        TriggeredBy = Upgrade_RohanWallSeiteneingang
        ConflictsWith = Upgrade_ElvenWallHub Upgrade_ElvenWallRegularGate Upgrade_RohanWallTower
    End


    Behavior = ProductionUpdate ModuleTag_RequiredForUpgradeProduction
    End


    Behavior = InheritUpgradeCreate ModuleTag_InheritStonework
        Radius            = ELVEN_FORTRESS_WALL_EFFECTIVE_RADIUS
        Upgrade            = Upgrade_ElvenFortressEncasingVines
        ObjectFilter       = ANY +ElvenCitadel
    End

    Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
        TriggeredBy        = Upgrade_ElvenFortressEncasingVines
        AttributeModifier  = EncasingVinesExpansion_Bonus
    End







    Geometry              = BOX
    GeometryMajorRadius   = 4.0
    GeometryMinorRadius   = 20.0
    GeometryHeight        = 40.0
    GeometryIsSmall       = No







    Shadow                = SHADOW_VOLUME
    BuildCompletion     = PLACED_BY_PLAYER
End


Object ElvenCastleWallHub



      SelectPortrait  =  BRBruchtalWallHub

    Draw = W3DScriptedModelDraw ModuleTag_Draw
        OkToChangeModelColor  = Yes
        UseStandardModelNames = Yes

        DefaultModelConditionState
            Model = lbwallhub
        End

    IdleAnimationState
        StateName    =    STATE_Idle
        Animation = lbwallhub
            AnimationName        =    lbwallhub.lbwallhub
            AnimationMode        =    LOOP
            AnimationBlendTime    =    0
        End
        BeginScript
            CurDrawableHideSubObject("WALL")
        EndScript
    End




        ModelConditionState = SNOW AWAITING_CONSTRUCTION
            Model = lbwallhub_A
        Texture = rivbuilding1.tga rivbuilding1_Snow.tga
        End

        ModelConditionState   = AWAITING_CONSTRUCTION
            Model               = lbwallhub_A
        End
        AnimationState        = AWAITING_CONSTRUCTION
            Animation           =  lbwallhub_A
                AnimationName     =  lbwallhub_A.lbwallhub_A
                AnimationMode     = MANUAL
                AnimationBlendTime = 0
            End
            Flags                  = START_FRAME_FIRST
        End

        ModelConditionState = UPGRADE_NUMENOR_STONEWORK ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Model    = lbwallhub_A
            Texture    = EBFortress.tga EBFortress_U.tga
        End
        ModelConditionState = SNOW ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Model = lbwallhub_A
        Texture = rivbuilding1.tga rivbuilding1_Snow.tga
            Texture = EBDome.tga EBDome_snow.tga
        End

        ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Model               = lbwallhub_A
        End

        AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Animation           = lbwallhub_A
                AnimationName     = lbwallhub_A.lbwallhub_A
                AnimationMode     = MANUAL
                AnimationBlendTime = 0
            End
            Flags                  = START_FRAME_FIRST
            StateName              = BeingConstructed
            ParticleSysBone   = NONE WallConstructDust FollowBone:Yes
            BeginScript
                CurDrawablePlaySound("GondorBarracksBeginConstruction")
                CurDrawableHideSubObject("WALL")
            EndScript
        End



        ModelConditionState  = DAMAGED
            Model         = lbwallhub
        Texture = rivbuilding1.tga rivbuilding1_d1.tga
        End
        AnimationState = DAMAGED
            EnteringStateFX    = FX_BuildingDamaged
        End

        ModelConditionState  = REALLYDAMAGED
            Model         = lbwallhub
        Texture = rivbuilding1.tga rivbuilding1_d1.tga
        End

        AnimationState = REALLYDAMAGED
              Animation                =    RubbleAnimation
                AnimationName        =     lbwallhub.lbwallhub
                AnimationMode        =    ONCE
              End
            EnteringStateFX    = FX_BuildingReallyDamaged
        End

        ModelConditionState  = COLLAPSING
            Model         = lbwallhub
        Texture = rivbuilding1.tga rivbuilding1_d1.tga
        End

        AnimationState = COLLAPSING
              Animation                =    RubbleAnimation
                AnimationName        =     lbwallhub.lbwallhub
                AnimationMode        =    ONCE
              End
              EnteringStateFX    = FX_StructureMediumCollapse
              ParticleSysBone NONE HubDestructionDust
        End

        ModelConditionState  = DYING
            Model         = lbwallhub
        End

        AnimationState = DYING
              Animation                =    RubbleAnimation
                AnimationName        =     lbwallhub.lbwallhub
                AnimationMode        =    ONCE
              End
              EnteringStateFX    = FX_StructureMediumCollapse
              ParticleSysBone NONE HubDestructionDust
        End



        ModelConditionState  = RUBBLE
            Model         = None
        End

        ModelConditionState  = POST_RUBBLE
            Model         = NONE
        End
        AnimationState = POST_RUBBLE
        End


        ModelConditionState  = POST_COLLAPSE
            Model         = None
        End

        AnimationState = POST_COLLAPSE
        End

        ModelConditionState    = UPGRADE_NUMENOR_STONEWORK
            Model    = lbwallhub
            Texture    = EBFortress.tga EBFortress_U.tga
        End

        ModelConditionState = SNOW
            Model = lbwallhub
        Texture = rivbuilding1.tga rivbuilding1_Snow.tga
            Texture = EBDome.tga EBDome_snow.tga
        End

    End


    DisplayName         = OBJECT:ElvenCastleWallHub
    Side                = Elves
    EditorSorting       = STRUCTURE
    ThreatLevel = 1.0

    BuildCost           = ELVEN_CASTLE_WALLHUB_BUILDCOST
    BuildTime           = ELVEN_CASTLE_WALLHUB_BUILDTIME
    VisionRange         = ELVEN_CASTLE_WALLHUB_VISION_RANGE
    ShroudClearingRange = ELVEN_CASTLE_WALLHUB_SHROUD_CLEAR

    CommandSet = ElvenCastleWallHubCommandSet

    ArmorSet
        Conditions        = None
        Armor             = ElvenWallArmor
    End



    #include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

    VoiceSelect                        = NeutralWallHubSelect
    VoiceSelectUnderConstruction    = BuildingGoodVoiceSelectUnderConstruction

    SoundOnDamaged                    = BuildingLightDamageStone
    SoundOnReallyDamaged            = BuildingHeavyDamageStone

    UnitSpecificSounds
        UnderConstruction        = BuildingConstructionLoop

        UnderRepairFromRubble    = BuildingConstructionLoop
    End





    CampnessValue = CAMPNESS_WALL


    RadarPriority       = STRUCTURE
    KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE WALL_HUB MADE_OF_STONE WALL_UPGRADE
    ThreatBreakdown ThreatBreakdown_ModuleTag
        AIKindOf = WALL
    End

    Behavior = TerrainResourceBehavior ModuleTag_NewMoneyDeadSpot
        Radius            = 60
        MaxIncome        = 0
        IncomeInterval    = 999999
        HighPriority    = Yes
        Visible = No
    End

    Behavior            = GettingBuiltBehavior ModuleTag_04
        UseSpawnTimerWithoutWorker         = Yes

        SelfRepairFromDamageLoop    = WallConstructionLoop
        SelfRepairFromRubbleLoop    = BuildingConstructionLoop
        SpawnTimer    = DEFAULT_STRUCTURE_HEALDELAY
    End

    Body                = StructureBody ModuleTag_05
        MaxHealth                = ELVEN_CASTLE_WALLHUB_HEALTH
        MaxHealthDamaged        = ELVEN_CASTLE_WALLHUB_HEALTH_DAMAGED
        MaxHealthReallyDamaged    = ELVEN_CASTLE_WALLHUB_HEALTH_REALLY_DAMAGED
    End

    Behavior                = SlowDeathBehavior ModuleTag_SlowDeath
        DeathTypes            = ALL
        DestructionDelay    = 5000
    End

    Behavior = WallHubBehavior ModuleTag_WALL_HUB

        Options = OPTION_ONE
        MaxBuildoutDistance = DEFAULT_FORTRESS_WALL_EFFECTIVE_RADIUS

        StaggeredBuildFactor = STANDARD_WALL_STAGGERED_BUILD_FACTOR


        SegmentTemplateName = ElvenCastleWallSegment
        SegmentTemplateName = ElvenCastleWallSegment
        SegmentTemplateName = ElvenCastleWallSegment
        SegmentTemplateName = ElvenCastleWallSegment
        SegmentTemplateName = ElvenCastleWallSegment
        SegmentTemplateName = ElvenCastleWallSegment
        SegmentTemplateName = ElvenCastleWallSegment
        SegmentTemplateName = ElvenCastleWallSegment
        SegmentTemplateName = ElvenCastleWallHub

        BuilderRadius = 20

        HubCapTemplateName = ElvenCastleWallHub
        DefaultSegmentTemplateName = ElvenCastleWallSegment

        CliffCapTemplateName = ElvenWallCliffCap




    End




    Behavior = InheritUpgradeCreate ModuleTag_InheritStonework
        Radius            = ELVEN_FORTRESS_WALL_EFFECTIVE_RADIUS
        Upgrade            = Upgrade_ElvenFortressEncasingVines
        ObjectFilter       = ANY +ElvenCitadel
    End

    Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
        TriggeredBy        = Upgrade_ElvenFortressEncasingVines
        AttributeModifier  = EncasingVinesExpansion_Bonus
    End

    Behavior = SubObjectsUpgrade SiegeHammer_ShowTheVines2
        TriggeredBy        = Upgrade_AllFactionUpgrade
        ShowSubObjects     = UPGR
    End


    Behavior                  = StructureCollapseUpdate ModuleTag_StructureCollapseUpdate
        MinCollapseDelay        = 000
        MaxCollapseDelay        = 000
        CollapseDamping         = .5
        MaxShudder              = 0.6
        MinBurstDelay           = 250
        MaxBurstDelay           = 800
        BigBurstFrequency       = 4

        DestroyObjectWhenDone    = Yes
        CollapseHeight        = 0
    End




    Geometry              = CYLINDER
    GeometryMajorRadius   = 20.0
    GeometryMinorRadius   = 20.0
    GeometryHeight        = 70.0
    GeometryIsSmall       = No


    AdditionalGeometry    = BOX
    GeometryMajorRadius   = 4.0
    GeometryMinorRadius   = 20.0
    GeometryHeight        = 40.0
    GeometryIsSmall       = No







    Shadow                = SHADOW_VOLUME
    BuildCompletion     = PLACED_BY_PLAYER
End



Object ElvenCastleWallGate


       SelectPortrait = BRBruchtalTor

     Draw = W3DScriptedModelDraw ModuleTag_Draw
         OkToChangeModelColor  = Yes
         UseStandardModelNames = Yes

        DefaultModelConditionState
             Model = lblorgate
        End

    IdleAnimationState
        StateName    =    STATE_Idle
        Animation = lblorgate
            AnimationName        =    lblorgate.lblorgate
            AnimationMode        =    LOOP
            AnimationBlendTime    =    0
        End
        BeginScript
            CurDrawableHideSubObject("WALL")
        EndScript
    End


        ModelConditionState   = DAMAGED
            Model               = lblorgate
        Texture = rivbuilding1.tga rivbuilding1_d1.tga
        End

        ModelConditionState   = REALLYDAMAGED
            Model               = lblorgate
        Texture = rivbuilding1.tga rivbuilding1_d1.tga
        End

        ModelConditionState  = COLLAPSING DOOR_1_OPENING
            Model         = lblorgate
        End
        AnimationState = COLLAPSING DOOR_1_OPENING
              Animation                =    RubbleAnimation
                AnimationName        =     lblorgate.lblorgate
                AnimationMode        =    ONCE
              End
              EnteringStateFX    = FX_StructureMediumCollapse
              ParticleSysBone NONE HubDestructionDust
        End

        ModelConditionState  = DYING DOOR_1_OPENING
            Model         = lblorgate
        End
        AnimationState = DYING DOOR_1_OPENING
              Animation                =    RubbleAnimation
                AnimationName        =     lblorgate.lblorgate
                AnimationMode        =    ONCE
              End
            EnteringStateFX    = FX_StructureMediumCollapse
              ParticleSysBone NONE HubDestructionDust
        End


        ModelConditionState  = COLLAPSING
            Model         = lblorgate
        Texture = rivbuilding1.tga rivbuilding1_d1.tga
        End
        AnimationState = COLLAPSING
              Animation                =    RubbleAnimation
                AnimationName        =     lblorgate.lblorgate
                AnimationMode        =    ONCE
              End
              EnteringStateFX    = FX_StructureMediumCollapse
              ParticleSysBone NONE HubDestructionDust
        End


        ModelConditionState  = DYING
            Model         = lblorgate
        Texture = rivbuilding1.tga rivbuilding1_d1.tga
        End
        AnimationState = DYING
              Animation                =    RubbleAnimation
                AnimationName        =     lblorgate.lblorgate
                AnimationMode        =    ONCE
              End
              EnteringStateFX    = FX_StructureMediumCollapse
              ParticleSysBone NONE HubDestructionDust
        End



        ModelConditionState  = RUBBLE
            Model         = None
        End

        ModelConditionState  = POST_RUBBLE
            Model         = NONE
            ParticleSysBone NONE SmokeBuildingMediumRubble
        End
        AnimationState = POST_RUBBLE
        End

        ModelConditionState  = POST_COLLAPSE
        Model         = None
            ParticleSysBone NONE SmokeBuildingMediumRubble
        End
        AnimationState = POST_COLLAPSE
        End



        AnimationState = DOOR_1_OPENING
            Flags = START_FRAME_LAST
            StateName = Door_Open
            Animation                =    Death
                AnimationName        =    DolGulGate_SKL.DolGulGate_OP
                AnimationMode        =    ONCE
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Door_Close" then CurDrawableSetTransitionAnimState("TRANS_Closed_To_Open") end
            EndScript
        End
        TransitionState = TRANS_Closed_To_Open
            Animation = Open
                AnimationName    =    DolGulGate_SKL.DolGulGate_OPN
                AnimationMode    =    ONCE
            End
        End

        AnimationState = DOOR_1_CLOSING
            Flags = START_FRAME_LAST
            StateName = Door_Close
            Animation                =    Death
                AnimationName        =    DolGulGate_SKL.DolGulGate_CL
                AnimationMode        =    ONCE
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Door_Open" then CurDrawableSetTransitionAnimState("TRANS_Open_To_Closed") end
            EndScript
        End
        TransitionState = TRANS_Open_To_Closed
            Animation = Open
                AnimationName    =    DolGulGate_SKL.DolGulGate_CLS
                AnimationMode    =    ONCE
            End
        End

        ModelConditionState = UPGRADE_NUMENOR_STONEWORK
            Model    = lblorgate
            Texture    = EBFortress.tga EBFortress_U.tga
        End

        ModelConditionState = SNOW
            Model    = lblorgate
        Texture = rivbuilding1.tga rivbuilding1_Snow.tga
        End

     End


    DisplayName         = OBJECT:ElvenCastleWallGate
    Side                = Elves
    EditorSorting       = STRUCTURE
    ThreatLevel            = 1.0

    BuildCost           = ELVEN_CASTLE_WALLGATE_BUILDCOST
    BuildTime           = ELVEN_CASTLE_WALLGATE_BUILDTIME
    VisionRange         = ELVEN_CASTLE_WALLGATE_VISION_RANGE
    ShroudClearingRange = ELVEN_CASTLE_WALLGATE_SHROUD_CLEAR

    CommandSet            = CastleGateCommandSet

    ArmorSet
        Conditions        = None
        Armor             = ElvenWallArmor
    End



    #include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

    VoiceSelect                        = GateSelect
    VoiceSelectUnderConstruction    = BuildingGoodVoiceSelectUnderConstruction

     SoundOnDamaged                    = BuildingLightDamageStone
     SoundOnReallyDamaged            = BuildingHeavyDamageStone

    UnitSpecificSounds
        UnderConstruction        = BuildingConstructionLoop

        UnderRepairFromRubble    = BuildingConstructionLoop
    End

    ClientBehavior = ModelConditionAudioLoopClientBehavior ModuleTag_PlayCollapseSound
        ModelCondition = REQUIRED:RUBBLE Sound:BuildingSink
    End

    CampnessValue = CAMPNESS_WALL


    RadarPriority       = STRUCTURE
    KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE WALL_UPGRADE MADE_OF_STONE BLOCKING_GATE WALL_GATE
    ThreatBreakdown ThreatBreakdown_ModuleTag
        AIKindOf = WALL
    End

    Behavior            = GettingBuiltBehavior ModuleTag_04
        SelfBuildingLoop            = WallConstructionLoop
        SelfRepairFromDamageLoop    = NoSound
        SelfRepairFromRubbleLoop    = WallConstructionLoop
        SpawnTimer                    = -1.0
        RebuildTimeSeconds            = ELVEN_CASTLE_WALLGATE_BUILDTIME
    End


    Body                = StructureBody ModuleTag_05
        MaxHealth                = ELVEN_CASTLE_WALLGATE_HEALTH
        MaxHealthDamaged        = ELVEN_CASTLE_WALLGATE_HEALTH_DAMAGED
        MaxHealthReallyDamaged    = ELVEN_CASTLE_WALLGATE_HEALTH_REALLY_DAMAGED
    End

    Behavior            = SlowDeathBehavior ModuleTag_SlowDeath
        DeathTypes            = ALL
        DestructionDelay = 5000
    End



    Behavior = GateOpenAndCloseBehavior ModuleTag_GATE
        ResetTimeInMilliseconds            = 3500
        OpenByDefault                    = No
        PercentOpenForPathing            = 50
        SoundOpeningGateLoop            = GateOpenStart
        SoundClosingGateLoop            = GateCloseStart
        SoundFinishedOpeningGate        = GateOpenEnd
        SoundFinishedClosingGate        = GateCloseEnd
        TimeBeforePlayingOpenSound        = 9500
        TimeBeforePlayingClosedSound    = 9500
    End


    Behavior = InheritUpgradeCreate ModuleTag_InheritStonework
        Radius            = ELVEN_FORTRESS_WALL_EFFECTIVE_RADIUS
        Upgrade            = Upgrade_ElvenFortressEncasingVines
        ObjectFilter       = ANY +ElvenCitadel
    End

    Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
        TriggeredBy        = Upgrade_ElvenFortressEncasingVines
        AttributeModifier  = EncasingVinesExpansion_Bonus
    End

    Behavior = SubObjectsUpgrade SiegeHammer_ShowTheVines2
        TriggeredBy        = Upgrade_AllFactionUpgrade
        ShowSubObjects     = UPGR
    End



    Behavior                  = StructureCollapseUpdate ModuleTag_StructureCollapseUpdate
        MinCollapseDelay        = 000
        MaxCollapseDelay        = 000
        CollapseDamping         = .5
        MaxShudder              = 0.6
        MinBurstDelay           = 250
        MaxBurstDelay           = 800
        BigBurstFrequency       = 4

        DestroyObjectWhenDone    = Yes
        CollapseHeight        = 0
    End


    Behavior = FakePathfindPortalBehaviour ModuleTag_FAKEPATHFIND
        AllowEnemies            = No
        AllowNonSkirmishAIUnits    = No
    End

    Behavior = AIGateUpdate ModuleTage_AIGateUpdate
        TriggerWidthX = 450.0
        TriggerWidthY = 225.0
    End


    GeometryIsSmall          = No


    Geometry              = BOX
    GeometryMajorRadius   = 10.0
    GeometryMinorRadius   = 10.0
    GeometryHeight        = 75
    GeometryOffset        = X:0 Y:50 Z:0


    AdditionalGeometry    = BOX
    GeometryMajorRadius   = 10.0
    GeometryMinorRadius   = 10.0
    GeometryHeight        = 75
    GeometryOffset        = X:0 Y:-50 Z:0


    AdditionalGeometry    = BOX
    GeometryName          = "Closed"
    GeometryMajorRadius   = 9.0
    GeometryMinorRadius   = 50.0
    GeometryHeight        = 50


    AdditionalGeometry    = BOX
    GeometryName          = "OpenLeft"
    GeometryMajorRadius   = 9.0
    GeometryMinorRadius   = 10.0
    GeometryHeight        = 40
    GeometryOffset        = X:0 Y:-30 Z:0


    AdditionalGeometry    = BOX
    GeometryName          = "OpenRight"
    GeometryMajorRadius   = 9.0
    GeometryMinorRadius   = 10.0
    GeometryHeight        = 40
    GeometryOffset        = X:0 Y:30 Z:0


    Shadow                = SHADOW_VOLUME
    BuildCompletion     = PLACED_BY_PLAYER
End



Object ElvenWallCliffCap


    SelectPortrait      =  BRBruchtalWall


    Draw = W3DScriptedModelDraw ModuleTag_Draw
        OkToChangeModelColor  = Yes
        UseStandardModelNames = Yes
        DefaultModelConditionState
            Model = lbwall
        End

    IdleAnimationState
        StateName    =    STATE_Idle
        Animation = lbwall
            AnimationName        =    lbwall.lbwall
            AnimationMode        =    LOOP
            AnimationBlendTime    =    0
        End
        BeginScript
            CurDrawableHideSubObject("WALL")
        EndScript
    End

        ModelConditionState = UPGRADE_NUMENOR_STONEWORK ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Model = lbwall_b
            Texture    = EBFortress.tga EBFortress_U.tga
            ParticleSysBone   = NONE WallConstructDust FollowBone:Yes
        End
        ModelConditionState = SNOW ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Model = lbwall_b
        Texture = rivbuilding1.tga rivbuilding1_Snow.tga
            ParticleSysBone   = NONE WallConstructDust FollowBone:Yes
        End
        ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Model               = lbwall_b
            ParticleSysBone   = NONE WallConstructDust FollowBone:Yes
        End
        AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Animation           =  lbwall_b
                AnimationName     =  lbwall_b.lbwall_b
                AnimationMode     = MANUAL
                AnimationBlendTime = 0
            End
            Flags                  = START_FRAME_FIRST
        BeginScript
            CurDrawableHideSubObject("WALL")
        EndScript
        End





        ModelConditionState  = DAMAGED
            Model         = lbwall
        Texture = rivbuilding1.tga rivbuilding1_d1.tga
        End

        AnimationState = DAMAGED
            EnteringStateFX    = FX_WallDamaged
        End

        ModelConditionState  = REALLYDAMAGED
            Model         = lbwall
        Texture = rivbuilding1.tga rivbuilding1_d1.tga
        End

        AnimationState = REALLYDAMAGED
              Animation                =    RubbleAnimation
                AnimationName        =     lbwall.lbwall
                AnimationMode        =    ONCE
              End
            EnteringStateFX    = FX_WallDamaged
        End

        ModelConditionState  = COLLAPSING
            Model         = lbwall
        Texture = rivbuilding1.tga rivbuilding1_d1.tga
        End

        AnimationState = COLLAPSING
              Animation                =    RubbleAnimation
                AnimationName        =     lbwall.lbwall
                AnimationMode        =    ONCE
              End
              ParticleSysBone NONE WallDestructionDust
            EnteringStateFX            = FX_StructureMediumCollapse
        End

        ModelConditionState  = RUBBLE
            Model         = None
        End
        AnimationState = RUBBLE
        End

        ModelConditionState  = POST_RUBBLE
            Model         = None
        End
        AnimationState = POST_RUBBLE
        End

        ModelConditionState  = POST_COLLAPSE
            Model         = None
        End
        AnimationState = POST_COLLAPSE
        End

        ModelConditionState = UPGRADE_NUMENOR_STONEWORK
            Model    = lbwall
            Texture    = EBFortress.tga EBFortress_U.tga
        End

        ModelConditionState = SNOW
            Model = lbwall
        Texture = rivbuilding1.tga rivbuilding1_Snow.tga
        End

    End







    DisplayName         = OBJECT:ElvenCastleWallSegment
    Side                = Elves
    EditorSorting       = STRUCTURE
    ThreatLevel            = 1.0

    CommandSet            = ElvenWallCliffCapCommandSet

    ArmorSet
        Conditions        = None
        Armor             = ElvenWallArmor
    End

    BuildCost           = MEN_WALLSEGMENT_SMALL_BUILDCOST
    BuildTime           = MEN_WALLSEGMENT_SMALL_BUILDTIME
    VisionRange         = MEN_WALLSEGMENT_SMALL_VISION_RANGE
    ShroudClearingRange = MEN_WALLSEGMENT_SMALL_SHROUD_CLEAR



    #include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

    VoiceSelectUnderConstruction    = BuildingGoodVoiceSelectUnderConstruction

    SoundOnDamaged                    = BuildingLightDamageStone
    SoundOnReallyDamaged            = BuildingHeavyDamageStone

    UnitSpecificSounds
        UnderConstruction        = WallConstructionLoop

        UnderRepairFromRubble    = WallConstructionLoop
    End

    ClientBehavior = ModelConditionAudioLoopClientBehavior ModuleTag_PlayCollapseSound
        ModelCondition = REQUIRED:RUBBLE Sound:BuildingSink
    End

    CampnessValue = CAMPNESS_WALL


    RadarPriority       = STRUCTURE
    KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE DEFENSIVE_WALL MADE_OF_STONE CAN_CAST_REFLECTIONS
    ThreatBreakdown ThreatBreakdown_ModuleTag
        AIKindOf = WALL
    End

    Behavior            = GettingBuiltBehavior ModuleTag_04
        UseSpawnTimerWithoutWorker         = Yes

        SelfBuildingLoop            = WallConstructionLoop

        SelfRepairFromRubbleLoop    = WallConstructionLoop
        SpawnTimer    = DEFAULT_STRUCTURE_HEALDELAY
    End



    Behavior                  = StructureCollapseUpdate ModuleTag_StructureCollapseUpdate
        MinCollapseDelay        = 000
        MaxCollapseDelay        = 000
        CollapseDamping         = .5
        MaxShudder              = 0.6
        MinBurstDelay           = 250
        MaxBurstDelay           = 800
        BigBurstFrequency       = 4

        DestroyObjectWhenDone    = Yes
        CollapseHeight        = 0
    End


    Body                = StructureBody ModuleTag_05
        MaxHealth                = ELVEN_CASTLE_WALLSEGMENT_HEALTH
        MaxHealthDamaged        = ELVEN_CASTLE_WALLSEGMENT_HEALTH_DAMAGED
        MaxHealthReallyDamaged    = ELVEN_CASTLE_WALLSEGMENT_HEALTH_REALLY_DAMAGED
    End






    Behavior = KeepObjectDie ModuleTag_IWantRubble
        DeathTypes            = ALL -SUICIDED
    End
    Behavior            = SlowDeathBehavior ModuleTag_SlowDeath
        DeathTypes            = NONE +SUICIDED
        DestructionDelay = 5000
    End



    Behavior = InheritUpgradeCreate ModuleTag_InheritStonework
        Radius            = ELVEN_FORTRESS_WALL_EFFECTIVE_RADIUS
        Upgrade            = Upgrade_ElvenFortressEncasingVines
        ObjectFilter       = ANY +ElvenCitadel
    End

    Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
        TriggeredBy        = Upgrade_ElvenFortressEncasingVines
        AttributeModifier  = EncasingVinesExpansion_Bonus
    End

    Behavior = SubObjectsUpgrade SiegeHammer_ShowTheVines2
        TriggeredBy        = Upgrade_AllFactionUpgrade
        ShowSubObjects     = UPGR
    End



    Geometry                  = BOX
    GeometryMajorRadius       = 10.0
    GeometryMinorRadius       = 40.0
    GeometryHeight            = 80
    GeometryIsSmall            = No
    GeometryOffset            = X:0 Y:-20 Z:-40


    Shadow                    = SHADOW_VOLUME
    BuildCompletion            = PLACED_BY_PLAYER
End


Object ElvenCastleWallTower


    SelectPortrait = BRBruchtalWallTurm


  Draw = W3DScriptedModelDraw ModuleTag_Draw
        OkToChangeModelColor  = Yes
        UseStandardModelNames = Yes

        ExtraPublicBone = ARROW_01
        ExtraPublicBone = ARROW_02
        ExtraPublicBone = ARROW_03
        ExtraPublicBone = ARROW_04
        ExtraPublicBone = ARROW_05
        ExtraPublicBone = ARROW_06
        ExtraPublicBone = ARROW_07
        ExtraPublicBone = ARROW_08
        ExtraPublicBone = ARROW_09
        ExtraPublicBone = ARROW_10
        ExtraPublicBone = ARROW_11
        ExtraPublicBone = ARROW_12

        DefaultModelConditionState
            Model                = lbwalltwrn
        End



        ModelConditionState   = AWAITING_CONSTRUCTION
            Model               = lbwalltwrn
        End
        ModelConditionState   = AWAITING_CONSTRUCTION SNOW
            Model               = lbwalltwrn

        End
        AnimationState        = AWAITING_CONSTRUCTION
            Animation           =  lbwalltwrn
                AnimationName     =  lbwalltwrn.lbwalltwrn
                AnimationMode     = MANUAL
                AnimationBlendTime = 0
            End
            Flags                  = START_FRAME_FIRST
        BeginScript
            CurDrawableHideSubObject("WALL")
        EndScript
        End

        ModelConditionState    = UPGRADE_NUMENOR_STONEWORK ACTIVELY_BEING_CONSTRUCTED
            Model        = lbwalltwrn
            Texture        = DBFortress1.tga DBFortress_U.tga
        End

        ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Model               = lbwalltwrn
            ParticleSysBone   = NONE WallConstructDust FollowBone:Yes
        End

        ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED SNOW
            Model               = lbwalltwrn
            ParticleSysBone   = NONE WallConstructDust FollowBone:Yes
        End

        AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Animation           = lbwalltwrn
                AnimationName     = lbwalltwrn.lbwalltwrn
                AnimationMode     = MANUAL
                AnimationBlendTime = 0
            End
            Flags                  = START_FRAME_FIRST




        End




        ModelConditionState  = DAMAGED
            Model         = lbwalltwrn
        Texture = rivbuilding1.tga rivbuilding1_d1.tga
        End
        AnimationState = DAMAGED
        End

        ModelConditionState  = REALLYDAMAGED
            Model         = lbwalltwrn
        Texture = rivbuilding1.tga rivbuilding1_d1.tga
        End

        AnimationState = REALLYDAMAGED
              Animation                =    RubbleAnimation
                AnimationName        =     lbwalltwrn.lbwalltwrn
                AnimationMode        =    ONCE
              End
            EnteringStateFX    = FX_BuildingReallyDamaged
        End

        ModelConditionState  = COLLAPSING
            Model         = lbwalltwrn
        Texture = rivbuilding1.tga rivbuilding1_d1.tga
        End
        AnimationState = COLLAPSING
              Animation                =    RubbleAnimation
                AnimationName        =     lbwalltwrn.lbwalltwrn
                AnimationMode        =    ONCE
              End
            EnteringStateFX            = FX_StructureMediumCollapse
        End

        ModelConditionState  = DYING
            Model         = lbwalltwrn
        Texture = rivbuilding1.tga rivbuilding1_d1.tga
        End
        AnimationState = DYING
              Animation                =    RubbleAnimation
                AnimationName        =     lbwalltwrn.lbwalltwrn
                AnimationMode        =    ONCE
              End
            EnteringStateFX            = FX_StructureMediumCollapse

        End

        ModelConditionState  = RUBBLE
            Model         = None
        End

        ModelConditionState  = POST_RUBBLE
            Model         = NONE
            ParticleSysBone NONE SmokeBuildingMediumRubble
        End
        AnimationState = POST_RUBBLE
        End

        ModelConditionState  = POST_COLLAPSE
        Model         = None
            ParticleSysBone NONE SmokeBuildingMediumRubble
        End
        AnimationState = POST_COLLAPSE
        End

        ModelConditionState    = UPGRADE_NUMENOR_STONEWORK
            Model    = lbwalltwrn
            Texture    = DBFortress1.tga DBFortress_U.tga
        End

        ModelConditionState = SNOW
            Model = lbwalltwrn
        Texture = rivbuilding1.tga rivbuilding1_snow.tga
        End


    End

    Draw = W3DFloorDraw ModuleTag_DrawFloor
       StaticModelLODMode = Yes
       ModelName = DBWallTwrN_Bib
       WeatherTexture        = SNOWY DBWall_Bib_Snow.tga
    End





    DisplayName         = OBJECT:RohanCastleWallTower
    Side                = Rohan
    EditorSorting       = STRUCTURE
    ThreatLevel            = 1.0
    ThreatBreakdown ModuleTag_DetailedThreat
        AIKindOf = WALL
    End

    BuildCost           = DWARVEN_WALLTOWER_SMALL_BUILDCOST
    BuildTime           = DWARVEN_WALLTOWER_SMALL_BUILDTIME
    VisionRange         = DWARVEN_WALLTOWER_SMALL_VISION_RANGE
    ShroudClearingRange = DWARVEN_WALLTOWER_SMALL_SHROUD_CLEAR

    ArmorSet
        Conditions        = None
        Armor             = ElvenWallArmor
    End

    WeaponSet
        Weapon              = PRIMARY ImladrisBattleTowerBow
        Conditions          = NONE
        AutoChooseSources   = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End

    CommandSet    = SellableCommandSet



    #include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

    VoiceSelect                        = DwarfTowerWallSelect
    VoiceSelectUnderConstruction    = BuildingEvilVoiceSelectUnderConstruction

    SoundOnDamaged                    = BuildingLightDamageStone
    SoundOnReallyDamaged            = BuildingHeavyDamageStone

    UnitSpecificSounds
        UnderConstruction        = WallConstructionLoop

        UnderRepairFromRubble    = WallConstructionLoop
    End

    CampnessValue = CAMPNESS_WALL


    RadarPriority       = STRUCTURE
    KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE MADE_OF_STONE CAN_ATTACK IGNORE_FOR_VICTORY WALL_UPGRADE

    Behavior                        = GettingBuiltBehavior ModuleTag_04
        UseSpawnTimerWithoutWorker         = Yes
        SpawnTimer    = DEFAULT_STRUCTURE_HEALDELAY
        RebuildTimeSeconds            = 30
        SelfBuildingLoop            = WallConstructionLoop
        SelfRepairFromDamageLoop     = WallConstructionLoop
        SelfRepairFromRubbleLoop    = WallConstructionLoop
    End


    Behavior = AIUpdateInterface ModuleTag_SoWeCanUseWeapon
         AutoAcquireEnemiesWhenIdle    = Yes
         MoodAttackCheckRate            = 250
     End

    Body = StructureBody ModuleTag_05
        MaxHealth = 2500
    End


    Behavior            = SlowDeathBehavior ModuleTag_SlowDeath
        DeathTypes            = ALL
        DestructionDelay    = 5000
    End



    Behavior                  = StructureCollapseUpdate ModuleTag_StructureCollapseUpdate
        MinCollapseDelay        = 000
        MaxCollapseDelay        = 000
        CollapseDamping         = .5
        MaxShudder              = 0.6
        MinBurstDelay           = 250
        MaxBurstDelay           = 800
        BigBurstFrequency       = 4

        DestroyObjectWhenDone    = Yes
        CollapseHeight        = 0
    End



    Behavior = InheritUpgradeCreate ModuleTag_InheritStonework
        Radius            = ELVEN_FORTRESS_WALL_EFFECTIVE_RADIUS
        Upgrade            = Upgrade_ElvenFortressEncasingVines
        ObjectFilter       = ANY +ElvenCitadel
    End

    Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
        TriggeredBy        = Upgrade_ElvenFortressEncasingVines
        AttributeModifier  = EncasingVinesExpansion_Bonus
    End





    Geometry                  = BOX
    GeometryMajorRadius       = 5.0
    GeometryMinorRadius       = 20.0
    GeometryHeight            = 40.0

    GeometryIsSmall           = No

    Shadow                    = SHADOW_VOLUME
    BuildCompletion           = PLACED_BY_PLAYER
End



Object ElvenCastleWallSeiteneingang


      SelectPortrait  =  BRBruchtalWallUpg

    Draw = W3DScriptedModelDraw ModuleTag_Draw

        DefaultModelConditionState
            Model = lbwall
        End

        ModelConditionState = BUILD_PLACEMENT_CURSOR
            Model =  lbwall
        End







        IdleAnimationState
            StateName = STATE_None
        End


        ModelConditionState = SNOW AWAITING_CONSTRUCTION
            Model = lbwall_b
            Texture    = EBFortress.tga EBFortress_snow.tga
        End

        ModelConditionState   = AWAITING_CONSTRUCTION
            Model               = lbwall_b
        End
        AnimationState        = AWAITING_CONSTRUCTION
            Animation           =  lbwall_b
                AnimationName     = lbwall_b.lbwall_b
                AnimationMode     = MANUAL
                AnimationBlendTime = 0
            End
            Flags                  = START_FRAME_FIRST
        End

        ModelConditionState = UPGRADE_NUMENOR_STONEWORK ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Model    = lbwall_b
            Texture    = EBFortress.tga EBFortress_U.tga
        End
        ModelConditionState = SNOW ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Model = lbwall_b
        Texture = rivbuilding1.tga rivbuilding1_Snow.tga
        End

        ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Model               = lbwall_b
        End

        AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Animation           = lbwall_b
                AnimationName     = lbwall_b.lbwall_b
                AnimationMode     = MANUAL
                AnimationBlendTime = 0
            End
            Flags                  = START_FRAME_FIRST
            StateName              = BeingConstructed
            ParticleSysBone   = NONE WallConstructDust FollowBone:Yes
        End


        ModelConditionState  = DAMAGED
            Model         = lbwall
        Texture = rivbuilding1.tga rivbuilding1_d1.tga
        End
        AnimationState = DAMAGED
            EnteringStateFX    = FX_WallDamaged
        End

        ModelConditionState  = REALLYDAMAGED

            Model         = lbwall
        Texture = rivbuilding1.tga rivbuilding1_d1.tga
        End

        AnimationState = REALLYDAMAGED
              Animation                =    RubbleAnimation
                AnimationName        =     lbwall.lbwall
                AnimationMode        =    ONCE
              End
            EnteringStateFX    = FX_WallDamaged
        End

        ModelConditionState  = COLLAPSING
            Model         = lbwall
        Texture = rivbuilding1.tga rivbuilding1_d1.tga
        End

        AnimationState = COLLAPSING
              Animation                =    RubbleAnimation
                AnimationName        =     lbwall.lbwall
                AnimationMode        =    ONCE
              End
              ParticleSysBone NONE WallDestructionDust
        End

        ModelConditionState  = RUBBLE
            Model         = None
        End

        ModelConditionState  = POST_RUBBLE
            Model         = None
        End
        AnimationState = POST_RUBBLE
        End

        ModelConditionState  = POST_COLLAPSE
        Model         = None
        End
        AnimationState = POST_COLLAPSE
        End

        ModelConditionState = UPGRADE_NUMENOR_STONEWORK
            Model    = lbwall
            Texture    = EBFortress.tga EBFortress_U.tga
        End
        ModelConditionState = SNOW
            Model = lbwall
        Texture = rivbuilding1.tga rivbuilding1_Snow.tga
        End

    End


    Draw = W3DScriptedModelDraw ModuleTag_Draw_Rubble
        OkToChangeModelColor  = Yes
        UseStandardModelNames = Yes
        DefaultModelConditionState
            Model = None
        End

        ModelConditionState  = COLLAPSING
            Model         = GBWall_Rubble
        End

        ModelConditionState  = RUBBLE
            Model         = GBWall_Rubble
        End

        ModelConditionState  = POST_RUBBLE
            Model         = GBWall_Rubble
        End

        ModelConditionState  = POST_COLLAPSE
            Model         = None
        End
    End


    Draw = W3DScriptedModelDraw ModuleTag_DoorDraw

        OkToChangeModelColor            = Yes
        UseStandardModelNames            = Yes

        ExtraPublicBone                = Post01
        ExtraPublicBone                = Post02
        ExtraPublicBone                = Post03
        ExtraPublicBone                = Post04

        DefaultModelConditionState
            Model                = lbwallpgn
        End

        IdleAnimationState
            Flags = ADJUST_HEIGHT_BY_CONSTRUCTION_PERCENT
            Animation            = ReallyDamagedanimation
                AnimationName        = lbwallpgn.lbwallpgn
                AnimationMode        = LOOP
               End
               StateName = STATE_None
        End



        ModelConditionState = DAMAGED
            Model                = lbwallpgn
        Texture = rivbuilding1.tga rivbuilding1_d1.tga
        End

        AnimationState = DAMAGED
        End

        ModelConditionState = REALLYDAMAGED
            Model                = lbwallpgn
        Texture = rivbuilding1.tga rivbuilding1_d1.tga
        End

        AnimationState = REALLYDAMAGED
            EnteringStateFX            = FX_BuildingReallyDamaged
        End

        ModelConditionState = COLLAPSING
            Model                = lbwallpgn
        Texture = rivbuilding1.tga rivbuilding1_d1.tga
        End
        AnimationState                = COLLAPSING
                  Animation            = RubbleAnimation
                AnimationName        = lbwallpgn.lbwallpgn
                AnimationMode        = ONCE
              End
              EnteringStateFX            = FX_StructureMediumCollapse
        End

        ModelConditionState = DYING
            Model                = lbwallpgn
        Texture = rivbuilding1.tga rivbuilding1_d1.tga
        End
        AnimationState                = DYING




              EnteringStateFX            = FX_StructureMediumCollapse
        End

        ModelConditionState = RUBBLE
            Model                = None
            ParticleSysBone SmokeLarge01 SmokeBuildingLarge
        End

        AnimationState = RUBBLE
        End

        ModelConditionState = POST_RUBBLE
            Model                = None
            ParticleSysBone NONE SmokeBuildingMediumRubble
        End

        ModelConditionState = POST_COLLAPSE
            Model                = None
            ParticleSysBone NONE SmokeBuildingMediumRubble
        End

        ModelConditionState = UPGRADE_NUMENOR_STONEWORK
            Model    = lbwallpgn
            Texture    = EBFortress.tga EBFortress_U.tga
        End
        ModelConditionState = SNOW
            Model = lbwallpgn
        Texture = rivbuilding1.tga rivbuilding1_Snow.tga
        End

    End

    DisplayName                    = OBJECT:RohanPosternGate
    DisplayNameInvisibleForEnemy   = OBJECT:GondorCastleWallSegment
    Side                           = Rohan
    EditorSorting                  = STRUCTURE
    ThreatLevel                    = 1.0
    VisionRange                    = 160.0
    ShroudClearingRange            = 160
    CommandSet                     = SellableCommandSet




    #include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

    VoiceSelect                = GondorPosternGateSelect
    VoiceSelectUnderConstruction        = BuildingGoodVoiceSelectUnderConstruction

    SoundOnDamaged                = BuildingLightDamageStone
    SoundOnReallyDamaged            = BuildingHeavyDamageStone

    UnitSpecificSounds
        UnderConstruction        = WallConstructionLoop

        UnderRepairFromRubble        = WallConstructionLoop
    End

    CampnessValue                = CAMPNESS_WALL


    RadarPriority                = STRUCTURE
    KindOf = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE MADE_OF_STONE WALL_UPGRADE WALL_GATE IGNORE_FOR_VICTORY

    Behavior = GettingBuiltBehavior ModuleTag_04
        UseSpawnTimerWithoutWorker    = Yes
        SpawnTimer            = DEFAULT_STRUCTURE_HEALDELAY

        SelfBuildingLoop        = BuildingConstructionLoop
        SelfRepairFromDamageLoop    = WallConstructionLoop
        SelfRepairFromRubbleLoop    = BuildingConstructionLoop
    End

    Body = StructureBody ModuleTag_05
        MaxHealth            = 2500.0
    End

    Behavior = SlowDeathBehavior ModuleTag_SlowDeath
        DeathTypes            = ALL
        DestructionDelay        = 5000
    End


    Behavior                  = StructureCollapseUpdate ModuleTag_StructureCollapseUpdate
        MinCollapseDelay        = 000
        MaxCollapseDelay        = 000
        CollapseDamping         = .5
        MaxShudder              = 0.6
        MinBurstDelay           = 250
        MaxBurstDelay           = 800
        BigBurstFrequency       = 4

        DestroyObjectWhenDone    = Yes
        CollapseHeight        = 0
    End


    ArmorSet
        Conditions        = None
        Armor             = ElvenWallArmor
    End

    Behavior = DynamicPortalBehaviour PosternGatePortal
        ActivationDelaySeconds = 0.0
        GenerateNow            = Yes

        ObjectFilter        = POSTERNGATE_ALLOWABLE_OBJECTFILTER
        BonePrefix          = Post
        NumberOfBones       = 4
        WayPoint            = Index:0    Type:Walk
        WayPoint            = Index:1    Type:Walk
        WayPoint            = Index:2    Type:Walk
        WayPoint            = Index:3    Type:Walk
        WayPoint            = Index:2    Type:Walk
        WayPoint            = Index:1    Type:Walk
        Link                = From:0 Via:4 Via:5 To:3
        Link                = From:3 Via:1 Via:2 To:0
    End



    Behavior = ProductionUpdate ModuleTag_RequiredForUpgradeProduction
    End


    Behavior = InheritUpgradeCreate ModuleTag_InheritStonework
        Radius            = ELVEN_FORTRESS_WALL_EFFECTIVE_RADIUS
        Upgrade            = Upgrade_ElvenFortressEncasingVines
        ObjectFilter       = ANY +ElvenCitadel
    End

    Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
        TriggeredBy        = Upgrade_ElvenFortressEncasingVines
        AttributeModifier  = EncasingVinesExpansion_Bonus
    End




    #include "..\..\..\includes\DefaultPosternGateInvisibilityUpdate.inc"

    Geometry                  = BOX
    GeometryMajorRadius       = 5.0
    GeometryMinorRadius       = 20.0
    GeometryHeight            = 40.0

    GeometryIsSmall           = No

    Shadow                    = SHADOW_VOLUME
    BuildCompletion           = PLACED_BY_PLAYER
End

