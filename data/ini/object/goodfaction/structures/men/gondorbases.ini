

Object MenCastleCenterGeneric

    SelectPortrait = BPDFortress

    Draw = W3DScriptedModelDraw ModuleTag_01

        DefaultModelConditionState
              Model = None
        End

        ModelConditionState = WORLD_BUILDER
            Model = NBasePin
        End
    End

    Side            = Men
    EditorSorting   = STRUCTURE
    KindOf          = IMMOBILE BASE_FOUNDATION CASTLE_CENTER

    Behavior = CastleBehavior ModuleTag_castle

        FilterValidOwnedEntries = ANY +STRUCTURE +WALK_ON_TOP_OF_WALL +BASE_FOUNDATION +TACTICAL_MARKER
    End
End



Object GondorCastleGateL_Edain

        SelectPortrait = BPCastleWall

    Draw = W3DScriptedModelDraw Draw_Wall
        OkToChangeModelColor = Yes

        WallBoundsMesh = P1

        DefaultModelConditionState
            Model = GBCASTGATEL
        End

        ModelConditionState = WORLD_BUILDER
              Model = GBCASTGATELW
          End

        ModelConditionState = BASE_BUILD
              Model = GBCASTGATEL_A
          End
        AnimationState = BASE_BUILD
            StateName = STATE_None
            Animation
                AnimationName = GBCASTGATEL_A.GBCASTGATEL_A
                AnimationMode = ONCE
                AnimationSpeedFactorRange = 2.0 2.5
            End
        End

        ModelConditionState = JUST_BUILT
              Model = GBCASTGATEL_A
          End
        AnimationState = JUST_BUILT
            StateName = STATE_None
            Animation
                AnimationName = GBCASTGATEL_A.GBCASTGATEL_A
                AnimationMode = MANUAL
            End
            Flags = START_FRAME_FIRST
        End

        ModelConditionState  = ACTIVELY_BEING_CONSTRUCTED UPGRADE_NUMENOR_STONEWORK
            Model = GBCASTGATEL_UA
        End
        AnimationState = ACTIVELY_BEING_CONSTRUCTED UPGRADE_NUMENOR_STONEWORK
            Animation
                AnimationName = GBCASTGATEL_UA.GBCASTGATEL_UA
                AnimationMode = MANUAL
            End
            Flags = START_FRAME_FIRST
            StateName = STATE_None
        End

        ModelConditionState  = ACTIVELY_BEING_CONSTRUCTED
            Model = GBCASTGATEL_A
        End
        AnimationState = ACTIVELY_BEING_CONSTRUCTED
            Animation
                AnimationName = GBCASTGATEL_A.GBCASTGATEL_A
                AnimationMode = MANUAL
            End
            Flags = START_FRAME_FIRST
            StateName = STATE_None
        End

        ModelConditionState  = DAMAGED UPGRADE_NUMENOR_STONEWORK
            Model         = GBCASTGATL_UD1
        End

        ModelConditionState  = DAMAGED
            Model         = GBCASTGATEL_D1
        End

        AnimationState = DAMAGED
            StateName        = STATE_None

        End


        TransitionState = TRANS_U_IntoReallyDamaged
            EnteringStateFX        = FX_BuildingReallyDamaged
            Animation = D2
                AnimationName        = GBCASTGATL_UD2.GBCASTGATL_UD2
                AnimationMode        = ONCE
                AnimationBlendTime    = 0
            End
        End
        ModelConditionState  = REALLYDAMAGED UPGRADE_NUMENOR_STONEWORK
            Model         = GBCASTGATL_UD2
        End
        AnimationState = REALLYDAMAGED UPGRADE_NUMENOR_STONEWORK
            StateName            = STATE_ReallyDamaged
             Flags                = START_FRAME_LAST
               Animation            = ReallyDamagedanimation
                AnimationName    = GBCASTGATL_UD2.GBCASTGATL_UD2
                AnimationMode    = ONCE
               End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_None" or Prev == "STATE_Rubble"
                then

                    CurDrawableSetTransitionAnimState("TRANS_U_IntoReallyDamaged")
                end
            EndScript
        End

        ModelConditionState  = REALLYDAMAGED
            Model         = GBCASTGATEL_D2
        End
        AnimationState = REALLYDAMAGED
            StateName            = STATE_ReallyDamaged
               Animation            = ReallyDamagedanimation
                AnimationName    = GBCASTGATEL_D2.GBCASTGATEL_D2
                AnimationMode    = ONCE
               End
        End


        TransitionState = TRANS_U_IntoRubble
            Animation = D3
                AnimationName        = GBCASTGATL_UD3.GBCASTGATL_UD3
                AnimationMode        = ONCE
                AnimationBlendTime    = 0
            End
        End
        ModelConditionState  = RUBBLE UPGRADE_NUMENOR_STONEWORK
            Model         = GBCASTGATL_UD3
        End
        AnimationState = RUBBLE UPGRADE_NUMENOR_STONEWORK
            StateName                = STATE_Rubble
            Flags                    = START_FRAME_LAST

            Animation                = Death
                AnimationName        = GBCASTGATL_UD3.GBCASTGATL_UD3
                AnimationMode        = MANUAL
                AnimationBlendTime    = 0
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_ReallyDamaged" or Prev == "STATE_None" or Prev == "TRANS_U_IntoReallyDamaged"
                then

                    CurDrawableSetTransitionAnimState("TRANS_U_IntoRubble")
                end
            EndScript
        End

        ModelConditionState  = RUBBLE
            Model         = GBCASTGATEL_D3
        End
        AnimationState = RUBBLE
            StateName                = STATE_Rubble
            Animation                = Death
                AnimationName        = GBCASTGATEL_D3.GBCASTGATEL_D3
                AnimationMode        = ONCE
            End
            EnteringStateFX    = FX_WallDie
        End

          ModelConditionState = UPGRADE_NUMENOR_STONEWORK
              Model = GBCASTGATEL_U
          End

          AnimationState = UPGRADE_NUMENOR_STONEWORK
            StateName        = STATE_None
            EnteringStateFX = GenericBuildingUpgrade
        End
    End




    VoiceSelect                = Gui_PlotSelect

    SoundOnDamaged            = BuildingLightDamageStone
    SoundOnReallyDamaged        = BuildingHeavyDamageStone

    VoiceSelectUnderConstruction    = BuildingGoodVoiceSelectUnderConstruction

    UnitSpecificSounds
        UnderConstruction        = BuildingConstructionLoop

        UnderRepairFromRubble    = BuildingConstructionLoop
    End

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound:WallDie    Animation:GBCASTGATL_UD3.GBCASTGATL_UD3    Frames:0
    End



    DisplayName        = OBJECT:GondorCastleGate
    EditorSorting    = STRUCTURE
    Side            = Men
    BuildTime        = CASTLE_WALL_REBUILD_TIME
    BuildCost        = CASTLE_WALL_REBUILD_COST

    ArmorSet
        Conditions    = None
        Armor        = MenWallArmor
        DamageFX    = MinasWallADamageFX
    End



    KindOf                    = STRUCTURE IMMOBILE WALK_ON_TOP_OF_WALL CHUNK_VENDOR SELECTABLE NOT_AUTOACQUIRABLE
    RadarPriority            = STRUCTURE
    KeepSelectableWhenDead    = Yes
    CommandSet                = GenericSelfRepairCommandSet

    Body                = ActiveBody ModuleTag_02
        MaxHealth        = GONDOR_CASTLE_WALL_HEALTH

        GrabObject = EntThrownBuildingRock
        GrabFX = FX_WallGrab
        GrabDamage = 490
        GrabOffset = X:16 Y:0
    End

        Behavior                  = BuildingBehavior BuildingModuleTag
           NightWindowName         = WINDOW_N01
        End

    Behavior = KeepObjectDie ModuleTag_IWantRubble
    End

     Behavior = GettingBuiltBehavior ModuleTag_GettingBuilt
        SelfBuildingLoop = BuildingConstructionLoop
        SelfRepairFromDamageLoop  = NoSound
        SelfRepairFromRubbleLoop  = BuildingConstructionLoop
        SpawnTimer = -1.0
        RebuildTimeSeconds = CASTLE_WALL_REBUILD_TIME
    End

    Behavior = CastleMemberBehavior ModuleTag_CMB
        CountsForEvaCastleBreached = Yes
    End

    Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
        TriggeredBy                = Upgrade_MenFortressNumenorStonework
        AttributeModifier        = NumenorStonework_Bonus
        CustomAnimAndDuration    = AnimState:UPGRADE_NUMENOR_STONEWORK AnimTime:0
    End

     Behavior = FireWeaponWhenDeadBehavior FireDeadTag2
        DeathTypes                    = ALL
        StartsActive                = Yes
        ActiveDuringConstruction    = Yes
        DeathWeapon                    = StandardWallDeath
    End

     Behavior = FireWeaponWhenDeadBehavior FireDeadTag1
        DeathTypes                    = ALL
        StartsActive                = Yes
        ActiveDuringConstruction    = Yes
        DeathWeapon                    = CastleWallDeath
    End

    Geometry                        = BOX
    GeometryMajorRadius                = 0.1
    GeometryMinorRadius                = 0.1
    GeometryHeight                    = 0.1
    GeometryRotationAnchorOffset    = X:375.0 Y:0
    GeometryIsSmall                    = No

    GeometryContactPoint            = X:35        Y: 25        Z:0 Grab
    GeometryContactPoint            = X:21        Y: 25        Z:0
    GeometryContactPoint            = X:21        Y: 60        Z:52
    GeometryContactPoint            = X:21        Y: 95        Z:0
    GeometryContactPoint            = X:31        Y: 95        Z:0 Grab
    GeometryContactPoint            = X:-50        Y: 95        Z:0 Grab
    GeometryContactPoint            = X:-30        Y: 95        Z:0
    GeometryContactPoint            = X:-21        Y: 60        Z:52
    GeometryContactPoint            = X:-21        Y: 25        Z:0
    GeometryContactPoint            = X:-40        Y: 25        Z:0 Grab

    Shadow                            = SHADOW_VOLUME
End


Object GondorCastleGateR_Edain

        SelectPortrait = BPCastleWall

    Draw = W3DScriptedModelDraw Draw_Wall
        OkToChangeModelColor = Yes


        WallBoundsMesh = P1

        DefaultModelConditionState
            Model = GBCASTGATER
        End

        ModelConditionState = WORLD_BUILDER
              Model = GBCASTGATERW
          End

        ModelConditionState = BASE_BUILD
              Model = GBCASTGATER_A
          End
        AnimationState = BASE_BUILD
            StateName = STATE_None
            Animation
                AnimationName = GBCASTGATER_A.GBCASTGATER_A
                AnimationMode = ONCE
                AnimationSpeedFactorRange = 2.0 2.5
            End
        End

        ModelConditionState = JUST_BUILT
              Model = GBCASTGATER_A
          End
        AnimationState = JUST_BUILT
            StateName = STATE_None
            Animation
                AnimationName = GBCASTGATER_A.GBCASTGATER_A
                AnimationMode = MANUAL
            End
            Flags = START_FRAME_FIRST
        End

        ModelConditionState  = ACTIVELY_BEING_CONSTRUCTED UPGRADE_NUMENOR_STONEWORK
            Model = GBCASTGATER_UA
        End
        AnimationState = ACTIVELY_BEING_CONSTRUCTED UPGRADE_NUMENOR_STONEWORK
            Animation
                AnimationName = GBCASTGATER_UA.GBCASTGATER_UA
                AnimationMode = MANUAL
            End
            StateName = STATE_None
            Flags = START_FRAME_FIRST
        End

        ModelConditionState  = ACTIVELY_BEING_CONSTRUCTED
            Model = GBCASTGATER_A
        End
        AnimationState = ACTIVELY_BEING_CONSTRUCTED
            Animation
                AnimationName = GBCASTGATER_A.GBCASTGATER_A
                AnimationMode = MANUAL
            End
            StateName = STATE_None
            Flags = START_FRAME_FIRST
        End















        ModelConditionState  = DAMAGED UPGRADE_NUMENOR_STONEWORK
            Model         = GBCASTGATR_UD1
        End

        ModelConditionState  = DAMAGED
            Model         = GBCASTGATER_D1
        End

        AnimationState = DAMAGED
            StateName        = STATE_None

        End


        TransitionState = TRANS_U_IntoReallyDamaged
            EnteringStateFX        = FX_BuildingReallyDamaged
            Animation = D2
                AnimationName        = GBCASTGATR_UD2.GBCASTGATR_UD2
                AnimationMode        = ONCE
                AnimationBlendTime    = 0
            End
        End
        ModelConditionState  = REALLYDAMAGED UPGRADE_NUMENOR_STONEWORK
            Model         = GBCASTGATR_UD2
        End
        AnimationState = REALLYDAMAGED UPGRADE_NUMENOR_STONEWORK
            StateName            = STATE_ReallyDamaged
             Flags                = START_FRAME_LAST
               Animation            = ReallyDamagedanimation
                AnimationName    = GBCASTGATR_UD2.GBCASTGATR_UD2
                AnimationMode    = ONCE
               End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_None" or Prev == "STATE_Rubble"
                then

                    CurDrawableSetTransitionAnimState("TRANS_U_IntoReallyDamaged")
                end
            EndScript
        End

        ModelConditionState  = REALLYDAMAGED
            Model         = GBCASTGATER_D2
        End
        AnimationState = REALLYDAMAGED
            StateName            = STATE_ReallyDamaged
               Animation            = ReallyDamagedanimation
                AnimationName    = GBCASTGATER_D2.GBCASTGATER_D2
                AnimationMode    = ONCE
               End
        End


        TransitionState = TRANS_U_IntoRubble
            Animation = D3
                AnimationName        = GBCASTGATR_UD3.GBCASTGATR_UD3
                AnimationMode        = ONCE
                AnimationBlendTime = 0
            End
        End
        ModelConditionState  = RUBBLE UPGRADE_NUMENOR_STONEWORK
            Model         = GBCASTGATR_UD3
        End
        AnimationState = RUBBLE UPGRADE_NUMENOR_STONEWORK
            StateName                = STATE_Rubble
            Flags                    = START_FRAME_LAST

            Animation                =    Death
                AnimationName        =    GBCASTGATR_UD3.GBCASTGATR_UD3
                AnimationMode        = MANUAL
                AnimationBlendTime    = 0
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_ReallyDamaged" or Prev == "STATE_None" or Prev == "TRANS_U_IntoReallyDamaged"
                then

                    CurDrawableSetTransitionAnimState("TRANS_U_IntoRubble")
                end
            EndScript
        End

        ModelConditionState  = RUBBLE
            Model         = GBCASTGATER_D3
        End
        AnimationState = RUBBLE
            StateName                = STATE_Rubble
            Animation                =    Death
                AnimationName        =    GBCASTGATER_D3.GBCASTGATER_D3
                AnimationMode        =    ONCE
            End
            EnteringStateFX    = FX_WallDie
        End

          ModelConditionState = UPGRADE_NUMENOR_STONEWORK
              Model = GBCASTGATER_U
          End

          AnimationState = UPGRADE_NUMENOR_STONEWORK
            StateName        = STATE_None
            EnteringStateFX = GenericBuildingUpgrade
        End








    End




    VoiceSelect                = Gui_PlotSelect

    SoundOnDamaged            = BuildingLightDamageStone
    SoundOnReallyDamaged        = BuildingHeavyDamageStone

    VoiceSelectUnderConstruction    = BuildingGoodVoiceSelectUnderConstruction

    UnitSpecificSounds
        UnderConstruction        = BuildingConstructionLoop

        UnderRepairFromRubble    = BuildingConstructionLoop
    End

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound:WallDie    Animation:GBCASTGATR_UD3.GBCASTGATR_UD3    Frames:0
    End



    DisplayName        = OBJECT:GondorCastleGate
    EditorSorting    = STRUCTURE
    Side            = Men
    BuildTime        = CASTLE_WALL_REBUILD_TIME
    BuildCost        = CASTLE_WALL_REBUILD_COST

    ArmorSet
        Conditions    = None
        Armor        = MenWallArmor
        DamageFX    = MinasWallADamageFX
    End



    KindOf                    = STRUCTURE IMMOBILE WALK_ON_TOP_OF_WALL CHUNK_VENDOR SELECTABLE NOT_AUTOACQUIRABLE
    RadarPriority            = STRUCTURE
    KeepSelectableWhenDead    = Yes
    CommandSet                = GenericSelfRepairCommandSet

        Behavior                  = BuildingBehavior BuildingModuleTag
           NightWindowName         = WINDOW_N01



        End

    Body                = ActiveBody ModuleTag_02
        MaxHealth        = GONDOR_CASTLE_WALL_HEALTH

        GrabObject = EntThrownBuildingRock
        GrabFX = FX_WallGrab
        GrabDamage = 490
        GrabOffset = X:16 Y:0
    End










    Behavior = KeepObjectDie ModuleTag_IWantRubble
    End

     Behavior = GettingBuiltBehavior ModuleTag_GettingBuilt
        SelfBuildingLoop = BuildingConstructionLoop
        SelfRepairFromDamageLoop  = NoSound
        SelfRepairFromRubbleLoop  = BuildingConstructionLoop
        SpawnTimer = -1.0
        RebuildTimeSeconds = CASTLE_WALL_REBUILD_TIME
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag

    End



    Behavior = CastleMemberBehavior ModuleTag_CMB
        CountsForEvaCastleBreached = Yes
    End

    Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
        TriggeredBy                = Upgrade_MenFortressNumenorStonework
        AttributeModifier        = NumenorStonework_Bonus
        CustomAnimAndDuration    = AnimState:UPGRADE_NUMENOR_STONEWORK AnimTime:0
    End

     Behavior = FireWeaponWhenDeadBehavior FireDeadTag2
        DeathTypes                    = ALL
        StartsActive                = Yes
        ActiveDuringConstruction    = Yes
        DeathWeapon                    = StandardWallDeath
    End

     Behavior = FireWeaponWhenDeadBehavior FireDeadTag1
        DeathTypes                    = ALL
        StartsActive                = Yes
        ActiveDuringConstruction    = Yes
        DeathWeapon                    = CastleWallDeath
    End

    Geometry                        = BOX
    GeometryMajorRadius                = 0.1
    GeometryMinorRadius                = 0.1
    GeometryHeight                    = 0.1
    GeometryOffset                    = X:-3 Y:5 Z:200














    GeometryRotationAnchorOffset    = X:375.0 Y:0
    GeometryIsSmall                    = No

    GeometryContactPoint            = X:35        Y: -25        Z:0 Grab
    GeometryContactPoint            = X:21        Y: -25        Z:0
    GeometryContactPoint            = X:21        Y: -60        Z:52
    GeometryContactPoint            = X:21        Y: -95        Z:0
    GeometryContactPoint            = X:31        Y: -95        Z:0 Grab
    GeometryContactPoint            = X:-50        Y: -95        Z:0 Grab
    GeometryContactPoint            = X:-30        Y: -95        Z:0
    GeometryContactPoint            = X:-21        Y: -60        Z:52
    GeometryContactPoint            = X:-21        Y: -25        Z:0
    GeometryContactPoint            = X:-40        Y: -25        Z:0 Grab


    Shadow                            = SHADOW_VOLUME
End


Object GondorCastleElevator_Edain

  SelectPortrait = BPCastleWall

  Draw = W3DScriptedModelDraw ModuleTag_01
        OkToChangeModelColor = Yes

        ExtraPublicBone = Elev01
        ExtraPublicBone = Elev02
        ExtraPublicBone = Elev03
        ExtraPublicBone = Elev04


        WallBoundsMesh = P1

    DefaultModelConditionState
      Model = GBCASTELEV
    End

        ModelConditionState = WORLD_BUILDER
              Model = GBCASTELEVW
          End

    IdleAnimationState
        Animation
            AnimationName     = GBCASTELEV.GBCASTELEV
            AnimationMode     = MANUAL
            AnimationBlendTime = 0
        End
        StateName = STATE_None
        Flags = START_FRAME_LAST
    End


    ModelConditionState   = BASE_BUILD
      Model               = GBCASTELEV

      ParticleSysBone     = NONE BuildingContructDust
    End
    AnimationState          = BASE_BUILD
        StateName = STATE_None
        Animation
            AnimationName = GBCASTELEV.GBCASTELEV
            AnimationMode = ONCE
            AnimationSpeedFactorRange = 2.0 2.5
        End
    End

    AnimationState          = JUST_BUILT
        Animation
            AnimationName = GBCASTELEV.GBCASTELEV
            AnimationMode = MANUAL
            AnimationBlendTime = 0
        End
        Flags = START_FRAME_FIRST
        StateName = STATE_None
    End


    ModelConditionState = ACTIVELY_BEING_CONSTRUCTED UPGRADE_NUMENOR_STONEWORK
        Model = GBCASTELEV_UA
    End
    AnimationState          = ACTIVELY_BEING_CONSTRUCTED UPGRADE_NUMENOR_STONEWORK
        Animation
            AnimationName = GBCASTELEV_UA.GBCASTELEV_UA
            AnimationMode = MANUAL
            AnimationBlendTime = 0
        End
        StateName = STATE_None
        Flags = START_FRAME_FIRST



    End

    ModelConditionState = ACTIVELY_BEING_CONSTRUCTED
        Model = GBCASTELEV
    End
    AnimationState          = ACTIVELY_BEING_CONSTRUCTED
        Animation
            AnimationName = GBCASTELEV.GBCASTELEV
            AnimationMode = MANUAL
            AnimationBlendTime = 0
        End
        StateName = STATE_None
        Flags = START_FRAME_FIRST



    End

    ModelConditionState  = DAMAGED UPGRADE_NUMENOR_STONEWORK
      Model         = GBCASTELEV_UD1
    End
    ModelConditionState  = DAMAGED
      Model         = GBCASTELEV_D1
    End

    AnimationState = DAMAGED
        StateName = STATE_None

    End


    TransitionState = TRANS_U_IntoReallyDamaged
        EnteringStateFX        = FX_BuildingReallyDamaged
        Animation = D2
            AnimationName        = GBCASTELEV_UD2.GBCASTELEV_UD2
            AnimationMode        = ONCE
            AnimationBlendTime    = 0
        End
    End
    ModelConditionState  = REALLYDAMAGED UPGRADE_NUMENOR_STONEWORK
      Model         = GBCASTELEV_UD2
    End
    AnimationState = REALLYDAMAGED UPGRADE_NUMENOR_STONEWORK
         StateName                = STATE_ReallyDamaged
         Flags                    = START_FRAME_LAST
          Animation                = ReallyDamagedanimation_U
            AnimationName        = GBCASTELEV_UD2.GBCASTELEV_UD2
            AnimationMode        = MANUAL
            AnimationBlendTime = 0
           End
        BeginScript
            Prev = CurDrawablePrevAnimationState()
            if Prev == "STATE_None" or Prev == "STATE_Rubble"
            then

                CurDrawableSetTransitionAnimState("TRANS_U_IntoReallyDamaged")
            end
        EndScript
    End

    ModelConditionState  = REALLYDAMAGED
      Model         = GBCASTELEV_D2
    End
    AnimationState = REALLYDAMAGED
          StateName                = STATE_ReallyDamaged
          Animation                = ReallyDamagedanimation
            AnimationName        = GBCASTELEV_D2.GBCASTELEV_D2
            AnimationMode        = ONCE
           End
    End


    TransitionState = TRANS_U_IntoRubble
        Animation = D3
            AnimationName        = GBCASTELEV_UD3.GBCASTELEV_UD3
            AnimationMode        = ONCE
            AnimationBlendTime = 0
        End
        ParticleSysBone NONE Explosion3
        ParticleSysBone NONE ExplosiveMineSmoke02
    End
    ModelConditionState  = RUBBLE UPGRADE_NUMENOR_STONEWORK
      Model         = GBCASTELEV_UD3
    End
    AnimationState = RUBBLE UPGRADE_NUMENOR_STONEWORK
        StateName                = STATE_Rubble
        Flags                    = START_FRAME_LAST
        Animation                = Death_U
            AnimationName        = GBCASTELEV_UD3.GBCASTELEV_UD3
            AnimationMode        = MANUAL
            AnimationBlendTime    = 0
        End
        BeginScript
            Prev = CurDrawablePrevAnimationState()
            if Prev == "STATE_ReallyDamaged" or Prev == "STATE_None" or Prev == "TRANS_U_IntoReallyDamaged"
            then

                CurDrawableSetTransitionAnimState("TRANS_U_IntoRubble")
            end
        EndScript

    End

   ModelConditionState  = RUBBLE
      Model         = GBCASTELEV_D3
      ParticleSysBone NONE Explosion3
      ParticleSysBone NONE ExplosiveMineSmoke02
    End
    AnimationState = RUBBLE
        StateName                = STATE_Rubble
        Animation                = Death
            AnimationName        = GBCASTELEV_D3.GBCASTELEV_D3
            AnimationMode        = ONCE
        End
        EnteringStateFX    = FX_WallDie
    End

    ModelConditionState = UPGRADE_NUMENOR_STONEWORK
          Model = GBCASTELEV_U
      End

      AnimationState = UPGRADE_NUMENOR_STONEWORK
        EnteringStateFX = GenericBuildingUpgrade
    End

End




    VoiceSelect            = Gui_PlotSelect

    SoundOnDamaged            = BuildingLightDamageStone
    SoundOnReallyDamaged        = BuildingHeavyDamageStone

    VoiceSelectUnderConstruction    = BuildingGoodVoiceSelectUnderConstruction

    UnitSpecificSounds
        UnderConstruction        = BuildingConstructionLoop

        UnderRepairFromRubble    = BuildingConstructionLoop
    End

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound:WallDie        Animation:GBCASTELEV_UD3.GBCASTELEV_UD3    Frames:0
    End



  DisplayName      = OBJECT:GondorCastleElevator
  Side 		   = Men
  EditorSorting    = STRUCTURE
  BuildTime        = CASTLE_WALL_REBUILD_TIME
  BuildCost        = CASTLE_WALL_REBUILD_COST
  ShroudClearingRange = 160

  ArmorSet
    Conditions        = None
    Armor             = MenWallArmor
    DamageFX          = MinasWallADamageFX
  End


    KindOf                    = STRUCTURE IMMOBILE WALK_ON_TOP_OF_WALL CHUNK_VENDOR NOT_AUTOACQUIRABLE SELECTABLE
    RadarPriority             = STRUCTURE
    KeepSelectableWhenDead    = Yes
    CommandSet                = GenericSelfRepairCommandSet

    Body                = ActiveBody ModuleTag_02
        MaxHealth          = GONDOR_CASTLE_WALL_HEALTH

        GrabObject = EntThrownBuildingRock
        GrabFX = FX_WallGrab
        GrabDamage = 490
        GrabOffset = X:16 Y:0
    End

    Behavior = KeepObjectDie ModuleTag_IWantRubble
    End

    Behavior = SiegeDockingBehavior ModuleTag_SiegeDocking
    End

     Behavior = GettingBuiltBehavior ModuleTag_GettingBuilt
        SelfBuildingLoop = BuildingConstructionLoop
        SelfRepairFromDamageLoop  = NoSound
        SelfRepairFromRubbleLoop  = BuildingConstructionLoop
        SpawnTimer = -1.0
        RebuildTimeSeconds = CASTLE_WALL_REBUILD_TIME
    End

    Behavior = DynamicPortalBehaviour Portal
        GenerateNow        = Yes
        ObjectFilter    = ANY +INFANTRY -MONSTER -MACHINE -CAVALRY -ARMY_OF_DEAD
        AllowEnemies    = Yes
        BonePrefix        = Elev
        NumberOfBones    = 4

        WayPoint        = Index:0    Type:PreClimb
        WayPoint        = Index:1    Type:PreClimb
        WayPoint        = Index:2    Type:Climb
        WayPoint        = Index:3    Type:Climb
        WayPoint        = Index:2    Type:Climb
        WayPoint        = Index:1    Type:Climb

        Link            = From:0 Via:4 Via:5 To:3
        Link            = From:3 Via:1 Via:2 To:0
    End




    Behavior = CastleMemberBehavior ModuleTag_CMB
        CountsForEvaCastleBreached = Yes
    End

    Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
        TriggeredBy                = Upgrade_MenFortressNumenorStonework
        AttributeModifier        = NumenorStonework_Bonus
        CustomAnimAndDuration    = AnimState:UPGRADE_NUMENOR_STONEWORK AnimTime:0
    End

     Behavior = FireWeaponWhenDeadBehavior FireDeadTag2
        DeathTypes                    = ALL
        StartsActive                = Yes
        ActiveDuringConstruction    = Yes
        DeathWeapon                    = StandardWallDeath
    End

    Geometry                        = BOX
    GeometryMajorRadius                = 0.1
    GeometryMinorRadius                = 0.1
    GeometryHeight                    = 0.1
    GeometryOffset                    = X:-3 Y:0 Z:0








































    GeometryIsSmall                    = No
    GeometryRotationAnchorOffset    = X:375.0 Y:0.0
    Shadow                            = SHADOW_VOLUME

    GeometryContactPoint            = X: 0  Y: 0  Z:53 Swoop
    GeometryContactPoint            = X: 30 Y:-70 Z:0 Grab
    GeometryContactPoint            = X:-20 Y:-60 Z:0 Grab
    GeometryContactPoint            = X: 23 Y:-40 Z:0 Grab
    GeometryContactPoint            = X:-40 Y:-40 Z:0 Grab
    GeometryContactPoint            = X: 33 Y: 40 Z:0 Grab
    GeometryContactPoint            = X:-40 Y: 40 Z:0 Grab
    GeometryContactPoint            = X: 30 Y: 60 Z:0 Grab
    GeometryContactPoint            = X:-40 Y: 70 Z:0 Grab

End


Object GondorCastleWall_Edain

        SelectPortrait = BPCastleWall
    Draw = W3DScriptedModelDraw Draw_Wall
        OkToChangeModelColor = Yes

        WallBoundsMesh = P1

        DefaultModelConditionState
            Model = GBCASTWALL
        End

        ModelConditionState = WORLD_BUILDER
              Model = GBCASTWALLW
          End

        ModelConditionState = BASE_BUILD
              Model = GBCASTWALL_A
          End
        AnimationState = BASE_BUILD
            StateName = STATE_None
            Animation
                AnimationName = GBCASTWALL_A.GBCASTWALL_A
                AnimationMode = ONCE
                AnimationSpeedFactorRange = 2.0 2.5
            End
        End

        ModelConditionState = JUST_BUILT
              Model = GBCASTWALL_A
          End
        AnimationState = JUST_BUILT
            StateName = STATE_None
            Animation
                AnimationName = GBCASTWALL_A.GBCASTWALL_A
                AnimationMode = MANUAL
            End
            Flags = START_FRAME_FIRST
        End



        ModelConditionState = ACTIVELY_BEING_CONSTRUCTED UPGRADE_NUMENOR_STONEWORK
              Model = GBCASTWALL_UA
          End
        AnimationState = ACTIVELY_BEING_CONSTRUCTED UPGRADE_NUMENOR_STONEWORK
            Animation
                AnimationName = GBCASTWALL_UA.GBCASTWALL_UA
                AnimationMode = MANUAL
            End
            StateName = STATE_None
            Flags = START_FRAME_FIRST
        End

        ModelConditionState = ACTIVELY_BEING_CONSTRUCTED
              Model = GBCASTWALL_A
          End
        AnimationState = ACTIVELY_BEING_CONSTRUCTED
            Animation
                AnimationName = GBCASTWALL_A.GBCASTWALL_A
                AnimationMode = MANUAL
            End
            StateName = STATE_None
            Flags = START_FRAME_FIRST
        End


        ModelConditionState  = DAMAGED UPGRADE_NUMENOR_STONEWORK
            Model         = GBCASTWALL_UD1
        End

        ModelConditionState  = DAMAGED
            Model         = GBCASTWALL_D1
        End

        AnimationState = DAMAGED
            StateName = STATE_None

        End


        TransitionState = TRANS_U_IntoReallyDamaged
            EnteringStateFX        = FX_BuildingReallyDamaged
            Animation = D2
                AnimationName        = GBCASTWALL_UD2.GBCASTWALL_UD2
                AnimationMode        = ONCE
                AnimationBlendTime    = 0
            End
        End
        ModelConditionState  = REALLYDAMAGED UPGRADE_NUMENOR_STONEWORK
            Model         = GBCASTWALL_UD2
        End
        AnimationState = REALLYDAMAGED UPGRADE_NUMENOR_STONEWORK
            StateName = STATE_ReallyDamaged
             Flags = START_FRAME_LAST
            Animation                = ReallyDamagedanimation
                AnimationName        = GBCASTWALL_UD2.GBCASTWALL_UD2
                AnimationMode        = MANUAL
                AnimationBlendTime    = 0
               End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_None" or Prev == "STATE_Rubble"
                then

                    CurDrawableSetTransitionAnimState("TRANS_U_IntoReallyDamaged")
                end
            EndScript
        End

        ModelConditionState  = REALLYDAMAGED
            Model         = GBCASTWALL_D2
        End
        AnimationState = REALLYDAMAGED
            StateName                = STATE_ReallyDamaged
            Animation                = ReallyDamagedanimation
                AnimationName        = GBCASTWALL_D2.GBCASTWALL_D2
                AnimationMode        = ONCE
               End
        End


        TransitionState = TRANS_U_IntoRubble
            Animation = D3
                AnimationName        = GBCASTWALL_UD3.GBCASTWALL_UD3
                AnimationMode        = ONCE
                AnimationBlendTime = 0
            End
        End
        ModelConditionState  = RUBBLE UPGRADE_NUMENOR_STONEWORK
            Model         = GBCASTWALL_UD3
      ParticleSysBone NONE BuildingChunkBitsTrail
      ParticleSysBone NONE ExplosiveMineFire02
    End
        AnimationState = RUBBLE UPGRADE_NUMENOR_STONEWORK
            StateName = STATE_Rubble
            Flags = START_FRAME_LAST
            Animation                = Death
                AnimationName        = GBCASTWALL_UD3.GBCASTWALL_UD3
                AnimationMode        = MANUAL
            AnimationBlendTime        = 0
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_ReallyDamaged" or Prev == "STATE_None" or Prev == "TRANS_U_IntoReallyDamaged"
                then

                    CurDrawableSetTransitionAnimState("TRANS_U_IntoRubble")
                end
            EndScript

        End

        ModelConditionState  = RUBBLE
            Model         = GBCASTWALL_D3
      ParticleSysBone NONE BuildingChunkBitsTrail
      ParticleSysBone NONE ExplosiveMineFire02
    End
        AnimationState = RUBBLE
            Animation                =    Death
                AnimationName        =    GBCASTWALL_D3.GBCASTWALL_D3
                AnimationMode        =    ONCE
            End
            StateName = STATE_Rubble
            EnteringStateFX    = FX_WallDie
        End


          ModelConditionState = UPGRADE_NUMENOR_STONEWORK
              Model = GBCASTWALL_U
          End

          AnimationState = UPGRADE_NUMENOR_STONEWORK
            EnteringStateFX = GenericBuildingUpgrade
        End

        ModelConditionState  = POST_RUBBLE
            Model         = None
        End

        ModelConditionState  = POST_COLLAPSE
            Model         = None
        End

    End




    VoiceSelect                = Gui_PlotSelect

    SoundOnDamaged            = BuildingLightDamageStone
    SoundOnReallyDamaged        = BuildingHeavyDamageStone

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
         AnimationSound = Sound:WallDie    Animation:GBCASTWALL_UD3.GBCASTWALL_UD3    Frames:0
    End



    DisplayName      = OBJECT:GondorCastleWall
    EditorSorting    = STRUCTURE
    Side             = Men
    BuildTime        = CASTLE_WALL_REBUILD_TIME
    BuildCost        = CASTLE_WALL_REBUILD_COST
    ShroudClearingRange = 160

    ArmorSet
        Conditions    = None
        Armor        = MenWallArmor
        DamageFX    = MinasWallADamageFX
    End


    KindOf                    = STRUCTURE IMMOBILE WALK_ON_TOP_OF_WALL CHUNK_VENDOR SELECTABLE NOT_AUTOACQUIRABLE
    RadarPriority            = STRUCTURE
    VisionRange                = GONDOR_ARCHER_VISION_RANGE
    KeepSelectableWhenDead    = Yes
    CommandSet                = GenericSelfRepairCommandSet

    Body                = ActiveBody ModuleTag_02
        MaxHealth        = GONDOR_CASTLE_WALL_HEALTH

        GrabObject = EntThrownBuildingRock
        GrabFX = FX_WallGrab
        GrabDamage = 490
        GrabOffset = X:16 Y:0
    End

    Behavior                  = BuildingBehavior BuildingModuleTag
        NightWindowName         = WINDOW_N01



    End

    Behavior = GettingBuiltBehavior ModuleTag_GettingBuilt
        SelfBuildingLoop = BuildingConstructionLoop
        SelfRepairFromDamageLoop  = NoSound
        SelfRepairFromRubbleLoop  = BuildingConstructionLoop
        SpawnTimer = -1.0
        RebuildTimeSeconds = CASTLE_WALL_REBUILD_TIME
    End

    Behavior = SiegeDockingBehavior ModuleTag_SiegeDocking
    End

    Behavior = KeepObjectDie ModuleTag_IWantRubble
    End

    Behavior = CastleMemberBehavior ModuleTag_CMB
        CountsForEvaCastleBreached = Yes
    End



    Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
        TriggeredBy                = Upgrade_MenFortressNumenorStonework
        AttributeModifier        = NumenorStonework_Bonus
        CustomAnimAndDuration    = AnimState:UPGRADE_NUMENOR_STONEWORK AnimTime:0
    End

     Behavior = FireWeaponWhenDeadBehavior FireDeadTag1
        DeathTypes                    = ALL
        StartsActive                = Yes
        ActiveDuringConstruction    = Yes
        DeathWeapon                    = CastleWallDeath
    End

     Behavior = FireWeaponWhenDeadBehavior FireDeadTag2
        DeathTypes                    = ALL
        StartsActive                = Yes
        ActiveDuringConstruction    = Yes
        DeathWeapon                    = StandardWallDeath
    End

    Geometry                        = BOX
    GeometryMajorRadius                = 0.1
    GeometryMinorRadius                = 0.1
    GeometryHeight                    = 0.1
    GeometryOffset                    = X:-3 Y:0 Z:0

































    GeometryContactPoint            = X:-29.397        Y:0.326        Z:108.421        Swoop
    GeometryContactPoint            = X: 40 Y:-70 Z:0 Grab
    GeometryContactPoint            = X:-40 Y:-60 Z:0 Grab
    GeometryContactPoint            = X: 23 Y:-40 Z:0 Grab
    GeometryContactPoint            = X:-18 Y:-40 Z:0 Grab
    GeometryContactPoint            = X: 23 Y: 40 Z:0 Grab
    GeometryContactPoint            = X:-40 Y: 40 Z:0 Grab
    GeometryContactPoint            = X: 40 Y: 60 Z:0 Grab
    GeometryContactPoint            = X:-40 Y: 70 Z:0 Grab


    GeometryIsSmall                    = No
    GeometryRotationAnchorOffset    = X:375.0 Y:0.0
    Shadow                            = SHADOW_VOLUME
End


Object GondorCastleGateTower_Edain


  Draw = W3DScriptedModelDraw ModuleTag_01

    OkToChangeModelColor = Yes
    WallBoundsMesh = P1
    RampMesh1 = Ramp1

    DefaultModelConditionState
      Model = GBCastPed
    End

    ModelConditionState = WORLD_BUILDER
          Model = GBCASTPEDW
      End

    IdleAnimationState
         StateName             = STATE_None
        Flags                 = START_FRAME_LAST
        Animation
            AnimationName     = GBCastPed.GBCastPed
            AnimationMode     = MANUAL
            AnimationBlendTime = 0
        End
    End

    ModelConditionState  = ACTIVELY_BEING_CONSTRUCTED UPGRADE_NUMENOR_STONEWORK
        Model = GBCastPed_UA
    End
    AnimationState = ACTIVELY_BEING_CONSTRUCTED UPGRADE_NUMENOR_STONEWORK
        StateName            = STATE_None
        Flags                = START_FRAME_FIRST
        Animation
            AnimationName = GBCastPed_UA.GBCastPed_UA
            AnimationMode = MANUAL
        End
    End

    ModelConditionState  = ACTIVELY_BEING_CONSTRUCTED
        Model = GBCastPed
    End
    AnimationState = ACTIVELY_BEING_CONSTRUCTED
        StateName            = STATE_None
        Flags                = START_FRAME_FIRST
        Animation
            AnimationName = GBCastPed.GBCastPed
            AnimationMode = MANUAL
        End
    End


    ModelConditionState   = BASE_BUILD
      Model               = GBCastPed
      ParticleSysBone     = NONE BuildingContructDust
    End
    AnimationState          = BASE_BUILD
        StateName                = STATE_None
        Animation
            AnimationName = GBCastPed.GBCastPed
            AnimationMode = ONCE
            AnimationSpeedFactorRange = 2.0 2.5
        End
    End

    AnimationState = JUST_BUILT
        StateName                = STATE_None
        Flags                    = START_FRAME_FIRST
        Animation
            AnimationName        = GBCastPed.GBCastPed
            AnimationMode        = MANUAL
            AnimationBlendTime    = 0
        End
    End


    ModelConditionState = DAMAGED UPGRADE_NUMENOR_STONEWORK
        Model            = GBCastPed_UD1
    End
    AnimationState = DAMAGED UPGRADE_NUMENOR_STONEWORK
        StateName        = STATE_None
        EnteringStateFX    = FX_BuildingDamaged
    End
    ModelConditionState = DAMAGED
        Model            = GBCastPed_D1
    End
    AnimationState = DAMAGED
        StateName        = STATE_None
        EnteringStateFX    = FX_BuildingDamaged
    End


    TransitionState = TRANS_U_IntoReallyDamaged
        EnteringStateFX        = FX_BuildingReallyDamaged
        Animation = D2
            AnimationName        = GBCastPed_UD2.GBCastPed_UD2
            AnimationMode        = ONCE
            AnimationBlendTime    = 0
        End
    End

    ModelConditionState  = REALLYDAMAGED UPGRADE_NUMENOR_STONEWORK
      Model         = GBCastPed_UD2
    End
    AnimationState = REALLYDAMAGED UPGRADE_NUMENOR_STONEWORK
        StateName            = STATE_ReallyDamaged
         Flags                = START_FRAME_LAST
          Animation            = ReallyDamagedanimation
            AnimationName    = GBCastPed_UD2.GBCastPed_UD2
            AnimationMode    = MANUAL
            AnimationBlendTime = 0
           End
        BeginScript
            Prev = CurDrawablePrevAnimationState()
            if Prev == "STATE_None" or Prev == "STATE_Rubble"
            then

                CurDrawableSetTransitionAnimState("TRANS_U_IntoReallyDamaged")
            end
        EndScript
       End

    ModelConditionState  = REALLYDAMAGED
      Model         = GBCastPed_D2
    End
    AnimationState = REALLYDAMAGED
        StateName            = STATE_ReallyDamaged
           Animation            = ReallyDamagedanimation
            AnimationName    = GBCastPed_D2.GBCastPed_D2
            AnimationMode    = ONCE
            AnimationBlendTime = 0
           End
        EnteringStateFX    = FX_BuildingReallyDamaged
    End


    TransitionState = TRANS_U_IntoRubble
        Animation = D3
            AnimationName        = GBCastPed_U_D3.GBCastPed_U_D3
            AnimationMode        = ONCE
            AnimationBlendTime = 0
        End
    End

    ModelConditionState  = RUBBLE UPGRADE_NUMENOR_STONEWORK
      Model                        = GBCastPed_U_D3
    End
    AnimationState = RUBBLE UPGRADE_NUMENOR_STONEWORK
        StateName                = STATE_Rubble
        Flags                    = START_FRAME_LAST

        Animation                = Death
            AnimationName        = GBCastPed_U_D3.GBCastPed_U_D3
            AnimationMode        = MANUAL
            AnimationBlendTime    = 0
        End
        BeginScript
            Prev = CurDrawablePrevAnimationState()
            if Prev == "STATE_ReallyDamaged" or Prev == "STATE_None" or Prev == "TRANS_U_IntoReallyDamaged"
            then

                CurDrawableSetTransitionAnimState("TRANS_U_IntoRubble")
            end
        EndScript
    End

    ModelConditionState  = RUBBLE
      Model         = GBCastPed_D3
    End
    AnimationState = RUBBLE
        StateName                = STATE_Rubble
        Animation                = Death
            AnimationName        = GBCastPed_D3.GBCastPed_D3
            AnimationMode        = ONCE
            AnimationBlendTime    = 0
        End
        EnteringStateFX    = FX_WallDie
    End


   ModelConditionState  = UPGRADE_NUMENOR_STONEWORK
      Model         = GBCastPed_U
    End
    AnimationState = UPGRADE_NUMENOR_STONEWORK
        StateName        = STATE_None
        EnteringStateFX = GenericBuildingUpgrade
    End

  End



    #include "..\..\..\Includes\StandardBuildingEvaEvents.inc"
    SoundOnDamaged        = BuildingLightDamageStone
    SoundOnReallyDamaged    = BuildingHeavyDamageStone

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound:WallDie    Animation:GBCastPed_U_D3.GBCastPed_U_D3    Frames:0
    End
    CampnessValue = CAMPNESS_WALL




    DisplayName     = OBJECT:GondorCastleGateTower
    Side            = Men
    EditorSorting    = STRUCTURE
    BuildTime        = CASTLE_WALL_REBUILD_TIME
    BuildCost        = CASTLE_WALL_REBUILD_COST

  VisionRange         = 160.0
  ShroudClearingRange = 160

  ArmorSet
    Conditions        = None
    Armor             = MenWallArmor
    DamageFX          = MinasWallADamageFX
  End


    KindOf                    = STRUCTURE IMMOBILE WALK_ON_TOP_OF_WALL CHUNK_VENDOR SELECTABLE MADE_OF_STONE NOT_AUTOACQUIRABLE
    RadarPriority            = STRUCTURE
    KeepSelectableWhenDead    = Yes
    CommandSet                = GenericSelfRepairCommandSet

  Body                  = ActiveBody ModuleTag_03
    MaxHealth       = GONDOR_CASTLE_WALL_HEALTH
  End





    Behavior = KeepObjectDie ModuleTag_IWantRubble
    End

    Behavior = CastleMemberBehavior ModuleTag_CMB
    End

    Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
        TriggeredBy                = Upgrade_MenFortressNumenorStonework
        AttributeModifier        = NumenorStoneworkKeep_Bonus
        CustomAnimAndDuration    = AnimState:UPGRADE_NUMENOR_STONEWORK AnimTime:0
    End

     Behavior = GettingBuiltBehavior ModuleTag_GettingBuilt
        SelfBuildingLoop = BuildingConstructionLoop
        SelfRepairFromDamageLoop  = NoSound
        SelfRepairFromRubbleLoop  = BuildingConstructionLoop
        SpawnTimer = -1.0
        RebuildTimeSeconds = CASTLE_WALL_REBUILD_TIME
    End

    Geometry              = BOX
    GeometryMajorRadius   = 1.0
    GeometryMinorRadius   = 1.0
    GeometryHeight        = 1.0
    GeometryIsSmall       = No







    Shadow                = SHADOW_VOLUME

    GeometryContactPoint = X:-10  Y:-40  Z:0 Grab
    GeometryContactPoint = X:40   Y:0    Z:0 Grab
    GeometryContactPoint = X:-10  Y:40   Z:0 Grab
    GeometryContactPoint = X:-10  Y:25   Z:45
    GeometryContactPoint = X:15   Y:15   Z:5
    GeometryContactPoint = X:20   Y:0    Z:45
    GeometryContactPoint = X:15   Y:-15  Z:5
    GeometryContactPoint = X:-10  Y:-25  Z:45
    GeometryContactPoint = X:-10  Y:-25  Z:5
End


Object GondorCastleBridge_Edain


    Draw = W3DScriptedModelDraw ModuleTag_01


        RampMesh1 = P2
        RampMesh2 = P3
        RaisedWallMesh = P1


        DefaultModelConditionState
            Model = GBCastBrdg




        End

    IdleAnimationState
        Animation
            AnimationName     = GBCastBrdg.GBCastBrdg
            AnimationMode     = MANUAL
            AnimationBlendTime = 0
        End
        Flags = START_FRAME_LAST
    End


    ModelConditionState   = BASE_BUILD
      Model               = GBCastBrdg

      ParticleSysBone     = NONE BuildingContructDust
    End
    AnimationState          = BASE_BUILD
        Animation
            AnimationName = GBCastBrdg.GBCastBrdg
            AnimationMode = ONCE
            AnimationSpeedFactorRange = 2.0 2.5
        End
    End

    AnimationState          = JUST_BUILT
        Animation
            AnimationName = GBCastBrdg.GBCastBrdg
            AnimationMode = MANUAL
            AnimationBlendTime = 0
        End
        Flags = START_FRAME_FIRST
    End

    ModelConditionState  = DAMAGED UPGRADE_NUMENOR_STONEWORK
      Model         = GBCastBrdg_U_D1
    End
    ModelConditionState  = DAMAGED
      Model         = GBCastBrdg_D1
    End
    AnimationState = DAMAGED
    End

    ModelConditionState  = REALLYDAMAGED UPGRADE_NUMENOR_STONEWORK
      Model         = GBCastBrdg_UD2
    End
    AnimationState = REALLYDAMAGED UPGRADE_NUMENOR_STONEWORK
        Animation                =    ReallyDamagedanimation
            AnimationName        =     GBCastBrdg_UD2.GBCastBrdg_UD2
            AnimationMode        =    ONCE

           End
    End

    ModelConditionState  = REALLYDAMAGED
      Model         = GBCastBrdg_D2
    End
    AnimationState = REALLYDAMAGED
        Animation                =    ReallyDamagedanimation
            AnimationName        =     GBCastBrdg_D2.GBCastBrdg_D2
            AnimationMode        =    ONCE

           End
    End

    ModelConditionState  = RUBBLE UPGRADE_NUMENOR_STONEWORK
      Model         = GBCastBrdg_UD3



    End
    AnimationState = RUBBLE UPGRADE_NUMENOR_STONEWORK
        Animation                =    Death
            AnimationName        =    GBCastBrdg_UD3.GBCastBrdg_UD3
            AnimationMode        =    ONCE

        End
        EnteringStateFX    = FX_WallDie
    End


    ModelConditionState  = ACTIVELY_BEING_CONSTRUCTED UPGRADE_NUMENOR_STONEWORK
      Model         = GBCastBrdg_U_D1
    End
    ModelConditionState  = ACTIVELY_BEING_CONSTRUCTED
      Model         = GBCastBrdg_D1
    End


    AnimationState  = ACTIVELY_BEING_CONSTRUCTED UPGRADE_NUMENOR_STONEWORK
        Animation                =    Death
            AnimationName        =    GBCastBrdg_UD3.GBCastBrdg_UD3
            AnimationMode        =    ONCE
        End
    End
    AnimationState  = ACTIVELY_BEING_CONSTRUCTED
        Animation                =    Death
            AnimationName        =    GBCastBrdg_D3.GBCastBrdg_D3
            AnimationMode        =    ONCE
        End
    End




    ModelConditionState  = RUBBLE
      Model         = GBCastBrdg_D3



    End
    AnimationState = RUBBLE
        Animation                =    Death
            AnimationName        =    GBCastBrdg_D3.GBCastBrdg_D3
            AnimationMode        =    ONCE

        End
        EnteringStateFX    = FX_WallDie
    End

        ModelConditionState = UPGRADE_NUMENOR_STONEWORK
              Model = GBCastBrdg_U




          End

          AnimationState = UPGRADE_NUMENOR_STONEWORK
            EnteringStateFX = GenericBuildingUpgrade
        End

      ModelConditionState  = POST_RUBBLE
        Model         = None
        ParticleSysBone NONE SmokeBuildingMediumRubble
    End
    ModelConditionState  = POST_COLLAPSE
        Model         = None
        ParticleSysBone NONE SmokeBuildingMediumRubble
    End

  End



    SoundOnDamaged            = BuildingLightDamageStone
    SoundOnReallyDamaged        = BuildingHeavyDamageStone





  DisplayName      = OBJECT:GondorCastleGate
  Side = Men
  EditorSorting = STRUCTURE


  ArmorSet
    Conditions        = None
    Armor             = MenWallArmor
    DamageFX          = MinasWallADamageFX
  End



    KindOf                    = STRUCTURE IMMOBILE CHUNK_VENDOR WALK_ON_TOP_OF_WALL SELECTABLE NOT_AUTOACQUIRABLE
    RadarPriority            = STRUCTURE
    KeepSelectableWhenDead    = Yes

    Body                    = ActiveBody ModuleTag_03

            MaxHealth                = 5000
            MaxHealthDamaged        = 2500
            MaxHealthReallyDamaged  = 1000
        GrabObject = EntThrownBuildingRock
        GrabFX = FX_WallGrab
        GrabDamage = 490
        GrabOffset = X:16 Y:0
    End







    Behavior = KeepObjectDie ModuleTag_IWantRubble
    End

    Behavior = CastleMemberBehavior ModuleTag_CMB
        CountsForEvaCastleBreached = No
    End

    Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
        TriggeredBy                = Upgrade_MenFortressNumenorStonework
        AttributeModifier        = NumenorStonework_Bonus
        CustomAnimAndDuration    = AnimState:UPGRADE_NUMENOR_STONEWORK AnimTime:0
    End


    BuildCost        = 0
      CommandSet                = GenericSelfRepairCommandSet
     Behavior = GettingBuiltBehavior ModuleTag_GettingBuilt
        SelfBuildingLoop = BuildingConstructionLoop
        SelfRepairFromDamageLoop  = NoSound
        SelfRepairFromRubbleLoop  = BuildingConstructionLoop
        SpawnTimer = -1.0
        RebuildTimeSeconds    = 15
    End



  Geometry                = BOX
  GeometryMajorRadius   = 1.0
  GeometryMinorRadius   = 1.0
  GeometryHeight        = 1.0
  GeometryOffset        = X:-5 Y:10 Z:60

    GeometryRotationAnchorOffset    = X:375.0 Y:0
    GeometryIsSmall                    = No

    GeometryContactPoint            = X:70        Y: 72        Z:0 Grab
    GeometryContactPoint            = X:28        Y: 72        Z:0
    GeometryContactPoint            = X:0        Y: 60        Z:70
    GeometryContactPoint            = X:0        Y: -60        Z:70
    GeometryContactPoint            = X:28        Y: -72        Z:0
    GeometryContactPoint            = X:70        Y: -72        Z:0 Grab


    Shadow                            = SHADOW_VOLUME
End


Object GondorGBCastleFloorEdain


    Draw = W3DScriptedModelDraw ModuleTag_01



        DefaultModelConditionState
            Model = GBCastFloor
        End

    End




  DisplayName      = OBJECT:CastFloor
  Side = Men
  EditorSorting = STRUCTURE


  ArmorSet
    Conditions        = None
    Armor             = NoArmor
    DamageFX          = None
  End





  KindOf                = STRUCTURE IMMOBILE NO_COLLIDE UNATTACKABLE INERT
  RadarPriority = NOT_ON_RADAR
  Body                  = ImmortalBody ModuleTag_03
    MaxHealth       = 2000.0
  End




  Behavior = SlowDeathBehavior ModuleTag_SlowDeathWithoutRubble
      DestructionDelay  = 1000
  End

  Geometry              = BOX
  GeometryMajorRadius   = 0.8
  GeometryMinorRadius   = 0.8
  GeometryHeight        = 0.8
  GeometryIsSmall       = Yes
  GeometryOffset    = X:0.0 Y:-100.0 Z:0
End



Object GondorCastleEdain

    SelectPortrait = BPGFortress

    Draw                = W3DScriptedModelDraw ModuleTag_01
        OkToChangeModelColor    = Yes
        StaticModelLODMode        = Yes

        DefaultModelConditionState
            Model           = None
        End

        IdleAnimationState
        End


        ModelConditionState = WORLD_BUILDER
            Model    = GBFortress
        End


        ModelConditionState = BUILD_PLACEMENT_CURSOR
            Model    = None
        End


        ModelConditionState =  PHANTOM_STRUCTURE
            Model    = GBFortress
        End


        AnimationState = BUILD_PLACEMENT_CURSOR
            BeginScript
                   CurDrawableHideSubObject("FIREGLOW")
                   CurDrawableHideSubObject("FLAMES")
                   CurDrawableHideSubObject("GBFFLAG")
                   CurDrawableHideSubObject("GBFFLAMING")
            EndScript
        End


        AnimationState = PHANTOM_STRUCTURE
            BeginScript
                   CurDrawableHideSubObject("FIREGLOW")
                   CurDrawableHideSubObject("FLAMES")
                   CurDrawableHideSubObject("GBFFLAG")
                   CurDrawableHideSubObject("GBFFLAMING")
            EndScript
        End

        ModelConditionState  = RUBBLE
            Model         = GBFortress_D3
        End

        AnimationState    = RUBBLE
            Animation    = Fortress_Rubble
                AnimationName        = GBFortress_D3SK.GBFortress_D3AN
                AnimationMode        = ONCE
            End
            EnteringStateFX    = FX_FortressCollapse
        End

        ModelConditionState = ACTIVELY_BEING_CONSTRUCTED SNOW
            Model            = GBFortress_A
            Texture            = GBFortress1.tga GBFortress1_Snow.tga
        End
        ModelConditionState = ACTIVELY_BEING_CONSTRUCTED
            Model            = GBFortress_A
        End

        AnimationState = ACTIVELY_BEING_CONSTRUCTED
            Animation                    = UpAndStill
                AnimationName            = GBFortress_ASK.GBFortress_ABL
                AnimationMode            = MANUAL
            End
            BeginScript
                CurDrawablePlaySound("GondorBarracksBeginConstruction")
            EndScript
            ParticleSysBone = NONE BuildingContructDustCastles FollowBone:Yes
            StateName = BeingConstructed
        End
    End


    Draw = W3DScriptedModelDraw ModuleTag_DrawDoor

        DefaultModelConditionState
            Model = None
        End


        ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED
            Model               = GBFDoor_A
        End

        AnimationState        = ACTIVELY_BEING_CONSTRUCTED
            Animation           = GBFDoor_A
                AnimationName     = GBFDoor_A.GBFDoor_A
                AnimationMode     = MANUAL
            End
        End
    End

    ArmorSet
        Conditions     = None
          Armor           = FortressArmor
        DamageFX        = EmptyDamageFX
    End

    Side                = Men
    EditorSorting       = STRUCTURE

    PlacementViewAngle = -45

    BuildCost           = MEN_FORTRESS_BUILDCOST
    BuildTime           = MEN_FORTRESS_BUILDTIME


    DisplayName         = OBJECT:MenFortress



    AutoResolveUnitType = AutoResolveUnit_Fortress

        AutoResolveBody = AutoResolve_MenFortressBody

        AutoResolveArmor
            Armor = AutoResolve_MenFortressArmor
        End

        AutoResolveWeapon
            Weapon = AutoResolve_MenFortressWeapon
        End


    #include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

    VoiceFullyCreated                = EVA:FortressComplete-Builder
    VoiceSelect                     = MenFortressSelect
    VoiceSelectUnderConstruction    = BuildingGoodVoiceSelectUnderConstruction

    SoundOnDamaged                    = BuildingLightDamageStone
    SoundOnReallyDamaged            = BuildingHeavyDamageStone

    UnitSpecificSounds
        UnderConstruction            = BuildingBigConstructionLoop

        UnderRepairFromRubble        = BuildingBigConstructionLoop
    End

    ClientBehavior = ModelConditionAudioLoopClientBehavior ModuleTag_PlayCollapseSound
        ModelCondition = REQUIRED:RUBBLE Sound:BuildingSink
    End


    RadarPriority       = STRUCTURE
    KindOf              = STRUCTURE SELECTABLE IMMOBILE BASE_FOUNDATION MP_COUNT_FOR_VICTORY BASE_SITE CAN_SEE_THROUGH_STRUCTURE LIVING_WORLD_BUILDING_MIRROR

    Body                = StructureBody ModuleTag_05
        MaxHealth         = MEN_FORTRESS_HEALTH
    End

    Behavior = CastleBehavior ModuleTag_castle
        CastleToUnpackForFaction    = Men Fortress_Men
        CastleToUnpackForFaction    = Elves Fortress_Men
        CastleToUnpackForFaction    = Dwarves Fortress_Men
        CastleToUnpackForFaction    = Wild Fortress_Men
        CastleToUnpackForFaction    = Isengard Fortress_Men
        CastleToUnpackForFaction    = Mordor Fortress_Men
        CastleToUnpackForFaction    = Angmar Fortress_Men
        CastleToUnpackForFaction    = Arnor Fortress_Men
        CastleToUnpackForFaction    = Rohan Fortress_Men

        FilterValidOwnedEntries = ANY +STRUCTURE +WALK_ON_TOP_OF_WALL +BASE_FOUNDATION +TACTICAL_MARKER

        MaxCastleRadius                = 130.0
        InstantUnpack                = Yes
        KeepDeathKillsEverything    = Yes

        EvaEnemyCastleSightedEvent = EnemyFortressSighted
    End

    Behavior                  = StructureCollapseUpdate ModuleTag_08
        MinCollapseDelay        = 000
        MaxCollapseDelay        = 000
        CollapseDamping         = .5
        MaxShudder              = 0.6
        MinBurstDelay           = 250
        MaxBurstDelay           = 800
        BigBurstFrequency       = 4
        FXList                  = INITIAL   FX_FortressCollapse

        DestroyObjectWhenDone    = Yes
        CollapseHeight            = 155
    End

    Behavior            = GettingBuiltBehavior ModuleTag_GettingBuiltBehavior
        WorkerName    = GondorWorkerNoSelect
        SpawnTimer    = DEFAULT_STRUCTURE_HEALDELAY
    End

    Behavior = AIUpdateInterface ModuleTag_AI
        AILuaEventsList                = FortressFunctions
    End


    Geometry                  = BOX
    GeometryMajorRadius       = 64
    GeometryMinorRadius       = 64
    GeometryHeight            = 50


    AdditionalGeometry        = BOX
    GeometryName            = Plots
    GeometryMajorRadius        = 10.0
    GeometryMinorRadius        = 10.0
    GeometryHeight            = 0.8
    GeometryOffset            = X:64.0 Y:-64.0 Z:0

    AdditionalGeometry        = BOX
    GeometryName            = Plots
    GeometryMajorRadius        = 10.0
    GeometryMinorRadius        = 10.0
    GeometryHeight            = 0.8
    GeometryOffset            = X:00 Y:-62.0 Z:0

    AdditionalGeometry        = BOX
    GeometryName            = Plots
    GeometryMajorRadius        = 10.0
    GeometryMinorRadius        = 10.0
    GeometryHeight            = 0.8
    GeometryOffset            = X:-64.0 Y:-64.0 Z:0

    AdditionalGeometry        = BOX
    GeometryName            = Plots
    GeometryMajorRadius        = 10.0
    GeometryMinorRadius        = 10.0
    GeometryHeight            = 0.8
    GeometryOffset            = X:-64.0 Y:64.0 Z:0

    AdditionalGeometry        = BOX
    GeometryName            = Plots
    GeometryMajorRadius        = 10.0
    GeometryMinorRadius        = 10.0
    GeometryHeight            = 0.8
    GeometryOffset            = X:0 Y:62.0 Z:0

    AdditionalGeometry        = BOX
    GeometryName            = Plots
    GeometryMajorRadius        = 10.0
    GeometryMinorRadius        = 10.0
    GeometryHeight            = 0.8
    GeometryOffset            = X:64.0 Y:64.0 Z:0

    GeometryIsSmall            = No
    Shadow                    = SHADOW_VOLUME

    GeometryContactPoint = X:-90        Y:82        Z:0            Repair
    GeometryContactPoint = X:84        Y:-79        Z:0            Repair
    GeometryContactPoint = X:5.576        Y:44.987    Z:0
    GeometryContactPoint = X:-38.348    Y:-42.113    Z:0
    GeometryContactPoint = X:-28.448    Y:-0.003    Z:75.14        Swoop

End



Object GondorCastleUpgrade_Edain


    SelectPortrait         = BPCastleWall
    Draw = W3DScriptedModelDraw Draw_Trebuchet
        OkToChangeModelColor = Yes

        AffectedByStealth = No

        ExtraPublicBone = Treb01
        ExtraPublicBone = Treb02

        DefaultModelConditionState
            Model                = GBCASTTREB
        End

        ModelConditionState = WORLD_BUILDER
              Model = GBCASTTREBW
          End

        IdleAnimationState
            StateName = Complete
            BeginScript
                CurDrawableHideModule("Draw_Trebuchet")
            EndScript
        End


        ModelConditionState  = SOLD SNOW
            Model = GBCASTTREB
            Texture = GCCastTreb.tga GCCastTreb_snow.tga
        End
        ModelConditionState  = SOLD
            Model = GBCASTTREB
        End
        AnimationState = SOLD
            Animation
                AnimationName = GBCASTTREB.GBCASTTREB
                AnimationMode = ONCE_BACKWARDS
                AnimationSpeedFactorRange = 3.0 3.0
            End
            Flags = START_FRAME_LAST
            EnteringStateFX = FX_BuildingContructDustCastles
        End



        ModelConditionState  = UPGRADE_TREBUCHET DAMAGED SNOW
            Model         = GBCASTTREB_D1
            Texture          = GCCastTreb.tga GCCastTreb_snow.tga
        End
        ModelConditionState  = UPGRADE_TREBUCHET DAMAGED
            Model         = GBCASTTREB_D1
        End

        AnimationState = UPGRADE_TREBUCHET DAMAGED

        End

        ModelConditionState  = UPGRADE_TREBUCHET REALLYDAMAGED
            Model         = GBCASTTREB_D2
        End

        AnimationState = UPGRADE_TREBUCHET REALLYDAMAGED
               Animation                =    ReallyDamagedanimation
                AnimationName        =     GBCASTTREB_D2.GBCASTTREB_D2
                AnimationMode        =    ONCE
               End
        End

        ModelConditionState  = UPGRADE_TREBUCHET RUBBLE
        Model         = GBCASTTREB_D3
        End

        AnimationState = UPGRADE_TREBUCHET RUBBLE
            StateName = Complete
            Animation                =    Death
                AnimationName        =    GBCASTTREB_D3.GBCASTTREB_D3
                AnimationMode        =    ONCE
            End
            EnteringStateFX    = FX_WallDie
        End

        ModelConditionState  = UPGRADE_TREBUCHET POST_RUBBLE
            Model         = None
        End

        ModelConditionState  = UPGRADE_TREBUCHET POST_COLLAPSE
            Model         = None
        End

        TransitionState = TRANS_IdleToBuild
            Animation
                AnimationName                = GBCASTTREB.GBCASTTREB
                AnimationMode                = ONCE
                AnimationSpeedFactorRange    = GONDOR_WALLTREBUCHET_BUILD_SPEED GONDOR_WALLTREBUCHET_BUILD_SPEED
            End
        End

        AnimationState = UPGRADE_TREBUCHET
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Complete" then CurDrawableSetTransitionAnimState("TRANS_IdleToBuild") end
            EndScript
            Flags = START_FRAME_LAST
            Animation
                AnimationName = GBCASTTREB.GBCASTTREB
                AnimationMode = ONCE
            End
        End

        ModelConditionState  = SNOW
            Model         = GBCASTTREB
            Texture          = GCCastTreb.tga GCCastTreb_snow.tga
        End
    End


    Draw = W3DScriptedModelDraw Draw_Picker

        AffectedByStealth = No

        DefaultModelConditionState
            Model = GBCASTWallOB
        End

    End


    Draw = W3DScriptedModelDraw Draw_Decal


        AffectedByStealth = No


        DefaultModelConditionState
            Model = gbcstpicker
        End

        ModelConditionState = USER_1
            Model = GBcstwlluprst
            Texture = GBFoundation.tga EBFoundation.tga
        End
        ModelConditionState = USER_2
            Model = GBcstwlluprst
            Texture = GBFoundation.tga DBFoundation.tga
        End
        ModelConditionState = USER_3
            Model = GBcstwlluprst
            Texture = GBFoundation.tga Mbfs01.tga
        End
        ModelConditionState = USER_4
            Model = GBcstwlluprst
            Texture = GBFoundation.tga IBFoundation.tga
        End
        ModelConditionState = USER_5
            Model = GBcstwlluprst
            Texture = GBFoundation.tga WBFoundation.tga
        End
        ModelConditionState = USER_6
            Model = GBcstwlluprst
            Texture = GBFoundation.tga IMLAFoundation.tga
        End
        ModelConditionState = USER_7
            Model = GBcstwlluprst
            Texture = GBFoundation.tga KBFoundation.tga
        End
        ModelConditionState = USER_8
            Model = GBcstwlluprst
            Texture = GBFoundation.tga RBFoundation.tga
        End
        ModelConditionState = USER_9
            Model = GBcstwlluprst
            Texture = GBFoundation.tga GBFoundation_arnor.tga
        End

        IdleAnimationState
            BeginScript
                CurDrawableShowModule("Draw_Decal")
                CurDrawableShowModule("Draw_Picker")
            EndScript
        End

        AnimationState  = JUST_BUILT
            BeginScript
                CurDrawableHideModule("Draw_Decal")
                CurDrawableShowModule("Draw_Picker")
            EndScript
        End

        AnimationState  = SOLD
            BeginScript
                CurDrawableHideModule("Draw_Decal")
            EndScript
        End

        AnimationState  = RUBBLE
            BeginScript
                CurDrawableHideModule("Draw_Decal")
                CurDrawableHideModule("Draw_Picker")
            EndScript
        End

        AnimationState  = UPGRADE_POSTERN_GATE
            BeginScript
                CurDrawableShowModule("Draw_PosternGate")
                CurDrawableShowModule("Draw_Decal")
                CurDrawableHideModule("Draw_Tower")
                CurDrawableHideModule("Draw_Trebuchet")
                CurDrawableHideModule("Draw_Picker")
            EndScript
        End

        AnimationState  = UPGRADE_TREBUCHET
            BeginScript
                CurDrawableShowModule("Draw_Trebuchet")
                CurDrawableHideModule("Draw_Decal")
                CurDrawableHideModule("Draw_PosternGate")
                CurDrawableHideModule("Draw_Tower")
                CurDrawableHideModule("Draw_Picker")
            EndScript
        End

        AnimationState  = UPGRADE_GARRISON
            BeginScript
                CurDrawableShowModule("Draw_Tower")
                CurDrawableHideModule("Draw_Decal")
                CurDrawableHideModule("Draw_PosternGate")
                CurDrawableHideModule("Draw_Trebuchet")
                CurDrawableHideModule("Draw_Picker")
            EndScript
        End

    End


    Draw = W3DScriptedModelDraw Draw_PosternGate

        ExtraPublicBone = Post01
        ExtraPublicBone = Post02
        ExtraPublicBone = Post03
        ExtraPublicBone = Post04

        DefaultModelConditionState
            Model                = GBCASTPOST
        End

        IdleAnimationState
            BeginScript
                CurDrawableHideModule("Draw_PosternGate")
            EndScript
        End


        ModelConditionState  = SOLD SNOW
            Model = GBCASTPOST
            Texture = GBBtlTwr.tga GBBtlTwr_snow.tga
        End
        ModelConditionState  = SOLD
            Model = GBCASTPOST
        End
        AnimationState = SOLD
            Animation
                AnimationName = GBCASTPOST.GBCASTPOST
                AnimationMode = ONCE_BACKWARDS
                AnimationSpeedFactorRange = 3.0 3.0
            End
            Flags = START_FRAME_LAST
            EnteringStateFX = FX_BuildingContructDustCastlesCentre
        End


        ModelConditionState  = UPGRADE_POSTERN_GATE DAMAGED
            Model         = GBCASTPOST_D1
        End

        AnimationState = UPGRADE_POSTERN_GATE DAMAGED

        End

        ModelConditionState  = UPGRADE_POSTERN_GATE REALLYDAMAGED
        Model         = GBCASTPOST_D2
        End
        AnimationState = UPGRADE_POSTERN_GATE REALLYDAMAGED

        End

        ModelConditionState  = UPGRADE_POSTERN_GATE RUBBLE
        Model         = GBCASTPOST_D3
        End

        AnimationState = UPGRADE_POSTERN_GATE RUBBLE
            Animation                =    Death
                AnimationName        =    GBCASTPOST_D3.GBCASTPOST_D3
                AnimationMode        =    ONCE
            End

            EnteringStateFX    = FX_WallDie
        End

        ModelConditionState  = UPGRADE_POSTERN_GATE POST_RUBBLE
            Model         = None
        End

        ModelConditionState  = UPGRADE_POSTERN_GATE POST_COLLAPSE
            Model         = None
        End


        AnimationState = UPGRADE_POSTERN_GATE
            Animation
                AnimationName = GBCASTPOST.GBCASTPOST
                AnimationMode = ONCE
            End

        End

        ModelConditionState  = SNOW
            Model = GBCASTPOST
            Texture = GBBtlTwr.tga GBBtlTwr_snow.tga
        End

    End


    Draw = W3DScriptedModelDraw Draw_Tower

        ExtraPublicBone = Arrow_01
        ExtraPublicBone = Arrow_02
        ExtraPublicBone = Arrow_03
        ExtraPublicBone = Arrow_04
        ExtraPublicBone = Arrow_05
        ExtraPublicBone = Arrow_06
        ExtraPublicBone = Arrow_07
        ExtraPublicBone = Arrow_08
        ExtraPublicBone = Arrow_09
        ExtraPublicBone = Arrow_10
        ExtraPublicBone = Arrow_11
        ExtraPublicBone = Arrow_12


        AffectedByStealth = No

        DefaultModelConditionState
            Model                = GBCASTTOWR
            WeaponLaunchBone    = PRIMARY ARROW_
        End

        IdleAnimationState
            StateName = Complete
            BeginScript
                CurDrawableHideModule("Draw_Tower")
            EndScript
        End

        ModelConditionState  = SOLD SNOW
            Model = GBCASTTOWR
            Texture = GBBtlTwr.tga GBBtlTwr_snow.tga
        End
        ModelConditionState  = SOLD
            Model = GBCASTTOWR
        End
        AnimationState = SOLD
            Animation
                AnimationName = GBCASTTOWR.GBCASTTOWR
                AnimationMode = ONCE_BACKWARDS
                AnimationSpeedFactorRange = 3.0 3.0
            End
            Flags = START_FRAME_LAST
            EnteringStateFX = FX_BuildingContructDustCastles
        End




        ModelConditionState  = UPGRADE_GARRISON DAMAGED SNOW
            Model         = GBCASTTOWR_D1
            Texture = GBBtlTwr.tga GBBtlTwr_snow.tga
        End
        ModelConditionState  = UPGRADE_GARRISON DAMAGED
            Model         = GBCASTTOWR_D1
        End

        AnimationState = UPGRADE_GARRISON DAMAGED

        End

        ModelConditionState  = UPGRADE_GARRISON REALLYDAMAGED
            Model         = GBCASTTOWR_D2
        End

        AnimationState = UPGRADE_GARRISON REALLYDAMAGED
               Animation                =    ReallyDamagedanimation
                AnimationName        =     GBCASTTOWR_D2.GBCASTTOWR_D2
                AnimationMode        =    ONCE
              End

        End

        ModelConditionState  = UPGRADE_GARRISON RUBBLE
            Model         = GBCASTTOWR_D3
        End

        AnimationState = UPGRADE_GARRISON RUBBLE
            StateName = Complete
            Animation                =    Death
                AnimationName        =    GBCASTTOWR_D3.GBCASTTOWR_D3
                AnimationMode        =    ONCE
            End
            EnteringStateFX    = FX_WallDie
        End

        ModelConditionState  = UPGRADE_GARRISON POST_RUBBLE
            Model         = None
        End

        ModelConditionState  = UPGRADE_GARRISON POST_COLLAPSE
            Model         = None
        End

        TransitionState                =    TRANS_IdleToBuild
            Animation
                AnimationName                = GBCASTTOWR.GBCASTTOWR
                AnimationMode                = ONCE
                AnimationSpeedFactorRange    = GONDOR_BATTLETOWER_BUILD_SPEED GONDOR_BATTLETOWER_BUILD_SPEED
            End

        End


        AnimationState = UPGRADE_GARRISON


            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Complete" then CurDrawableSetTransitionAnimState("TRANS_IdleToBuild") end
            EndScript

            Flags = START_FRAME_LAST
            Animation
                AnimationName = GBCASTTOWR.GBCASTTOWR
                AnimationMode = ONCE
            End
        End

        ModelConditionState         = SNOW
            Model                = GBCASTTOWR
            Texture = GBBtlTwr.tga GBBtlTwr_snow.tga
        End

    End




    VoiceSelect                = Gui_PlotSelect

    SoundOnDamaged            = BuildingLightDamageStone
    SoundOnReallyDamaged        = BuildingHeavyDamageStone

    VoiceSelectUnderConstruction    = BuildingGoodVoiceSelectUnderConstruction

    ClientBehavior = UpgradeSoundSelectorClientBehavior ModuleTag_UpgradeSoundSelector
        SoundUpgrade = Upgrade_PosternGate
            ExcludedUpgrades = Upgrade_OpenGarrison Upgrade_TrebuchetTurret
            VoiceSelect = GondorPosternGateSelect
        End

        SoundUpgrade = Upgrade_OpenGarrison
            ExcludedUpgrades = Upgrade_PosternGate Upgrade_TrebuchetTurret
            VoiceSelect = GondorBattleTowerSelect
        End

        SoundUpgrade = Upgrade_TrebuchetTurret
            ExcludedUpgrades = Upgrade_PosternGate Upgrade_OpenGarrison
            VoiceSelect = GondorArmorySelect
        End
    End



    DisplayName        = OBJECT:GondorCastleWallUpgrade
    EditorSorting    = STRUCTURE
    Side            = Men
    IsTrainable        = No

    ArmorSet
        Conditions    = None
        Armor        = GondorCastleWallUpgrade
        DamageFX    = MinasWallADamageFX
    End
    ArmorSet
        Conditions    = AS_TOWER
        Armor        = GondorCastleWallUpgradeAsTower
        DamageFX    = MinasWallADamageFX
    End


    WeaponSet
        Conditions            = None
    End
    WeaponSet
        Conditions            = PLAYER_UPGRADE
        Weapon                = PRIMARY CastleWallUpgradeBow
        AutoChooseSources    = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End


    Behavior = ProductionUpdate ProductionUpdateModuleTag

    End


    Body                = ActiveBody ModuleTag_02
        MaxHealth        = GONDOR_CASTLE_WALL_UPGRADE_HEALTH
    End

    Behavior = WeaponSetUpgrade ModuleTag_Add5ArchersToAllKeepsAndBattleTowers
        TriggeredBy            = Upgrade_OpenGarrison
        ConflictsWith        = Upgrade_PosternGate Upgrade_TrebuchetTurret
    End
    Behavior = CommandSetUpgrade TheGarrisonCommandSet
        TriggeredBy            = Upgrade_OpenGarrison
        ConflictsWith        = Upgrade_PosternGate Upgrade_TrebuchetTurret
        CommandSet            = SellableCommandSet
    End
    Behavior = AttributeModifierUpgrade DontShootWhilstBuilding
        TriggeredBy            = Upgrade_OpenGarrison
        ConflictsWith        = Upgrade_PosternGate Upgrade_TrebuchetTurret
        AttributeModifier    = PreventFromShooting
    End
    Behavior = AudioLoopUpgrade ModuleTag_GarrisonBuildLoop

        TriggeredBy            = Upgrade_OpenGarrison
        ConflictsWith        = Upgrade_PosternGate Upgrade_TrebuchetTurret
        SoundToPlay            = BuildingConstructionLoop
        KillOnDeath         = Yes
        KillAfterMS            = 6166
    End
    Behavior = ArmorUpgrade ArmorUpgradeModuleTag1
        TriggeredBy            = Upgrade_OpenGarrison
        ArmorSetFlag        = AS_TOWER
    End
    Behavior = TooltipUpgrade ModuleTag_GarrisonTooltip
        TriggeredBy                = Upgrade_OpenGarrison
        ConflictsWith            = Upgrade_PosternGate Upgrade_TrebuchetTurret
        DisplayName                = OBJECT:GondorBattleTower
        Description                = OBJECT:GondorBattleTowerDescription
    End

    Behavior = GeometryUpgrade ModuleTag_FireArrows
        TriggeredBy            = Upgrade_BattleTowersToUseFireArrows
        ConflictsWith        = Upgrade_PosternGate Upgrade_TrebuchetTurret
    End

    Behavior = GeometryUpgrade ModueTag_TowerGeom
        TriggeredBy            = Upgrade_OpenGarrison
        ConflictsWith        = Upgrade_PosternGate Upgrade_TrebuchetTurret
        ShowGeometry        = TowerGeom
        HideGeometry        = TrebGeom DummyGeom
        CustomAnimAndDuration    = AnimState:UPGRADE_GARRISON AnimTime:0
    End

    Behavior = GeometryUpgrade ModueTag_TrebGeom
        TriggeredBy            = Upgrade_TrebuchetTurret
        ConflictsWith        = Upgrade_PosternGate Upgrade_OpenGarrison
        ShowGeometry        = TrebGeom
        HideGeometry        = TowerGeom DummyGeom
        WallBoundsMesh        = P2
        RampMesh1            = P3

        CustomAnimAndDuration    = AnimState:UPGRADE_TREBUCHET AnimTime:0

    End
    Behavior = AudioLoopUpgrade ModuleTag_TrebBuildLoop

        TriggeredBy            = Upgrade_TrebuchetTurret
        ConflictsWith        = Upgrade_PosternGate Upgrade_OpenGarrison
        SoundToPlay            = BuildingConstructionLoop
        KillOnDeath         = Yes
        KillAfterMS            = 6166
    End

    Behavior = ArmorUpgrade ArmorUpgradeModuleTag2
        TriggeredBy            = Upgrade_TrebuchetTurret
        ArmorSetFlag        = AS_TOWER
    End

    Behavior = AttributeModifierUpgrade DontShootWhilstBuilding2
        TriggeredBy            = Upgrade_TrebuchetTurret
        AttributeModifier    = PreventFromShooting
    End
    Behavior = TooltipUpgrade ModuleTag_TrebuchetTooltip
        TriggeredBy                = Upgrade_TrebuchetTurret
        ConflictsWith            = Upgrade_OpenGarrison Upgrade_PosternGate
        DisplayName                = OBJECT:GondorTrebuchetOutcropping

    End

    Behavior = DynamicPortalBehaviour PosternGatePortal
        TriggeredBy                = Upgrade_PosternGate
        ConflictsWith            = Upgrade_OpenGarrison Upgrade_TrebuchetTurret
        CustomAnimAndDuration    = AnimState:UPGRADE_POSTERN_GATE AnimTime:0
        ActivationDelaySeconds    = 7.0

        ObjectFilter    = POSTERNGATE_ALLOWABLE_OBJECTFILTER
        BonePrefix        = Post
        NumberOfBones    = 4
        WayPoint        = Index:0    Type:Walk
        WayPoint        = Index:1    Type:Walk
        WayPoint        = Index:2    Type:Walk
        WayPoint        = Index:3    Type:Walk
        WayPoint        = Index:2    Type:Walk
        WayPoint        = Index:1    Type:Walk
        Link            = From:0 Via:4 Via:5 To:3
        Link            = From:3 Via:1 Via:2 To:0
    End
    Behavior = CommandSetUpgrade ModueTag_PosternGateCommandSet
        TriggeredBy            = Upgrade_PosternGate
        ConflictsWith        = Upgrade_OpenGarrison Upgrade_TrebuchetTurret
        CommandSet            = SellableCommandSet
    End
    Behavior = AttributeModifierUpgrade DontShootWhilstBuilding3
        TriggeredBy            = Upgrade_PosternGate
        AttributeModifier    = PreventPosternGateFromShooting
    End
    Behavior = AudioLoopUpgrade ModuleTag_GateBuildLoop

        TriggeredBy            = Upgrade_PosternGate
        ConflictsWith        = Upgrade_TrebuchetTurret Upgrade_OpenGarrison
        SoundToPlay            = BuildingConstructionLoop
        KillOnDeath         = Yes
        KillAfterMS            = 6166
    End
    Behavior = TooltipUpgrade ModuleTag_PosternGateTooltip
        TriggeredBy                = Upgrade_PosternGate
        ConflictsWith            = Upgrade_TrebuchetTurret Upgrade_OpenGarrison
        DisplayName                = OBJECT:GondorPosternGate
    End


    Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
        TriggeredBy                = Upgrade_MenFortressNumenorStonework
        AttributeModifier        = NumenorStoneworkWallUpgrade_Bonus
    End


    Behavior = CommandSetUpgrade ModueTag_TrebCommandSet
        TriggeredBy                = Upgrade_TrebuchetTurret
        ConflictsWith            = Upgrade_HasWallTrebuchet Upgrade_PosternGate Upgrade_OpenGarrison
        CommandSet                = GenericBuyNewTrebCommandSet
    End
    Behavior = CommandSetUpgrade ModueTag_TrebSellCommandSet
        TriggeredBy                = Upgrade_HasWallTrebuchet Upgrade_TrebuchetTurret
        CommandSet                = SellableCommandSet
        RequiresAllTriggers        = Yes
    End
    Behavior = ObjectCreationUpgrade MakeTheFreeTreb
        TriggeredBy                = Upgrade_TrebuchetTurret
        Delay                    = GONDOR_WALLTREBUCHET_CREATE_DELAY
        GrantUpgrade            = Upgrade_HasWallTrebuchet
        DestroyWhenSold            = Yes
        DeathAnimAndDuration    = AnimState:DEATH_2 AnimTime:999999
    End
    Behavior = ObjectCreationUpgrade ModuleTag_MordorTreb
        TriggeredBy                = Upgrade_HasWallTrebuchet Upgrade_MordorFaction
        RequiresAllTriggers        = Yes
        Delay                    = 0.0
        ThingToSpawn            = MordorWallCatapult
        Offset                    = X:50.0 Y:0.0 Z:68
        FadeInTime                = 600
    End
    Behavior = ObjectCreationUpgrade ModuleTag_MenTreb
        TriggeredBy                = Upgrade_HasWallTrebuchet Upgrade_MenFaction
        RequiresAllTriggers        = Yes
        Delay                    = 0.0
        ThingToSpawn            = GondorTrebuchetWall
        Offset                    = X:50.0 Y:0.0 Z:68
        FadeInTime                = 600
    End
    Behavior = ObjectCreationUpgrade ModuleTag_ElvenTreb
        TriggeredBy                = Upgrade_HasWallTrebuchet Upgrade_ElfFaction
        RequiresAllTriggers        = Yes
        Delay                    = 0.0
        ThingToSpawn            = GondorTrebuchetWall
        Offset                    = X:50.0 Y:0.0 Z:68
        FadeInTime                = 600
    End
    Behavior = ObjectCreationUpgrade ModuleTag_IsengardTreb
        TriggeredBy                = Upgrade_HasWallTrebuchet Upgrade_IsengardFaction
        RequiresAllTriggers        = Yes
        Delay                    = 0.0
        ThingToSpawn            = IsengardWallBallista
        Offset                    = X:50.0 Y:0.0 Z:68
        FadeInTime                = 600
    End
    Behavior = ObjectCreationUpgrade ModuleTag_WildTreb
        TriggeredBy                = Upgrade_HasWallTrebuchet Upgrade_WildFaction
        RequiresAllTriggers        = Yes
        Delay                    = 0.0
        ThingToSpawn            = MordorWallCatapult
        Offset                    = X:50.0 Y:0.0 Z:68
        FadeInTime                = 600
    End
    Behavior = ObjectCreationUpgrade ModuleTag_DwarfTreb
        TriggeredBy                = Upgrade_HasWallTrebuchet Upgrade_DwarfFaction
        RequiresAllTriggers        = Yes
        Delay                    = 0.0
        ThingToSpawn            = DwarvenWallCatapult
        Offset                    = X:50.0 Y:0.0 Z:68
        FadeInTime                = 600
    End
    Behavior = ObjectCreationUpgrade ModuleTag_AngmarTreb
        TriggeredBy                = Upgrade_HasWallTrebuchet Upgrade_AngmarFaction
        RequiresAllTriggers        = Yes
        Delay                    = 0.0
        ThingToSpawn            = AngmarTrollSlingWall
        Offset                    = X:0.0 Y:0.0 Z:60.0
        FadeInTime                = 600
    End
    Behavior = SlaveWatcherBehavior WatchTheTreb
        RemoveUpgrade            = Upgrade_HasWallTrebuchet
    End


    Behavior = CastleMemberBehavior ModuleTag_CMB
        StoreUpgradePrice = Yes
        CountsForEvaCastleBreached = No
    End

    Behavior = FoundationAIUpdate ModuleTag_FoundationAI
    End

    Behavior = WallUpgradeUpdate ModuleTag_Update
    End

    Behavior = AIUpdateInterface ModuleTag_SoWeCanUseWeapon
        AutoAcquireEnemiesWhenIdle    = Yes
        MoodAttackCheckRate            = 250
        AILuaEventsList                = GarrisonableFunctions
     End

    Behavior = RefundDie ModuleTag_refund
        UpgradeRequired = Upgrade_MarketplaceUpgradeDefiance
        BuildingRequired = ANY +GondorMarketPlace
        RefundPercent = 50%
    End

     Behavior = FireWeaponWhenDeadBehavior FireDeadTag1
        DeathTypes                    = ALL
        StartsActive                = Yes
        ActiveDuringConstruction    = Yes
        DeathWeapon                    = CastleUpgradeDeath
    End

    Behavior = ModelConditionUpgrade Elven_Faction
        TriggeredBy                    = Upgrade_ElfFaction
        AddConditionFlags            = USER_1
        Permanent                    = Yes
    End
    Behavior = ModelConditionUpgrade Dwarven_Faction
        TriggeredBy                    = Upgrade_DwarfFaction
        AddConditionFlags            = USER_2
        Permanent                    = Yes
    End
    Behavior = ModelConditionUpgrade Mordor_Faction
        TriggeredBy                    = Upgrade_MordorFaction
        AddConditionFlags            = USER_3
        Permanent                    = Yes
    End
    Behavior = ModelConditionUpgrade Isengard_Faction
        TriggeredBy                    = Upgrade_IsengardFaction
        AddConditionFlags            = USER_4
        Permanent                    = Yes
    End
    Behavior = ModelConditionUpgrade Goblin_Faction
        TriggeredBy                    = Upgrade_WildFaction
        AddConditionFlags            = USER_5
        Permanent                    = Yes
    End

    Behavior = ModelConditionUpgrade Angmar_Faction
        TriggeredBy                    = Upgrade_AngmarFaction
        AddConditionFlags            = USER_6
        Permanent                    = Yes
    End


    KindOf                            = STRUCTURE SELECTABLE IMMOBILE CHUNK_VENDOR CAN_ATTACK WALL_UPGRADE WALK_ON_TOP_OF_WALL NOT_AUTOACQUIRABLE IGNORE_FOR_VICTORY
    RadarPriority                    = STRUCTURE
    CommandSet                        = GondorCastleWallCommandSet
    VisionRange                        = GONDOR_ARCHER_VISION_RANGE
    KeepSelectableWhenDead            = No

    GeometryRotationAnchorOffset    = X:375.0 Y:0.0
    GeometryIsSmall                    = No

    Geometry                        = BOX
    GeometryMajorRadius                = 1.0
    GeometryMinorRadius                = 1.0
    GeometryHeight                    = 1.0
    GeometryName                    = DummyGeom
    GeometryActive                    = Yes

    AdditionalGeometry                = BOX
    GeometryMajorRadius                = 28.0
    GeometryMinorRadius                = 28.0
    GeometryHeight                    = 80.0
    GeometryOffset                    = X:54.0 Y:0.0 Z:0.0
    GeometryName                    = TrebGeom
    GeometryActive                    = No

    AdditionalGeometry                = BOX
    GeometryMajorRadius                = 20.0
    GeometryMinorRadius                = 20.0
    GeometryHeight                    = 120.0
    GeometryOffset                    = X:45.0 Y:0.0 Z:0.0
    GeometryName                    = TowerGeom
    GeometryActive                    = No


    GeometryContactPoint    = X: 37.0    Y:-16.0        Z:120    Swoop
    GeometryContactPoint    = X: 37.0    Y:  0.0        Z:0        Grab
    GeometryContactPoint    = X: 37.0    Y: 16.0        Z:120    Swoop


    Shadow                            = SHADOW_VOLUME
End

