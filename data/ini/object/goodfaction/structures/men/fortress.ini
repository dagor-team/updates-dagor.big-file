Object MenFortressCenterGeneric

    SelectPortrait = BPGFortress

    Draw = W3DScriptedModelDraw ModuleTag_01

        DefaultModelConditionState
              Model = None
        End

        ModelConditionState = WORLD_BUILDER
            Model = NBasePin
        End
    End

    Side = Men
    EditorSorting = STRUCTURE
    KindOf = IMMOBILE BASE_FOUNDATION CASTLE_CENTER CAN_CAST_REFLECTIONS CAN_CAST_REFLECTIONS

    Behavior = CastleBehavior ModuleTag_castle
        FilterValidOwnedEntries = ANY +STRUCTURE +WALK_ON_TOP_OF_WALL +BASE_FOUNDATION +TACTICAL_MARKER
    End
End


Object MenFortressExpansionPadCorner

    SelectPortrait = BPGFortress_BuildPlot

    Draw = W3DFloorDraw DrawFloorBase
        ModelName = GBFoundationB
    End

    Draw = W3DScriptedModelDraw ModuleTag_DrawMain
        DefaultModelConditionState
            Model = WBFoundationP
        End
        ModelConditionState = CONSTRUCTION_COMPLETE
            Model = None
        End
    End


    DisplayName         = OBJECT:MenBuildingFoundation
    Description         = OBJECT:MenFortressDescription
    Side                = Men
    EditorSorting       = STRUCTURE
    ThreatLevel         = 1.0

    BuildCost           = 1
    BuildTime           = 5.0
    VisionRange         = 0.0
    ShroudClearingRange = 0

    CommandSet = MenFortressExpansionPadCornerCommandSet


    VoiceSelect           = Gui_PlotSelect



    KindOf                = STRUCTURE SELECTABLE IMMOBILE BASE_FOUNDATION UNATTACKABLE MP_COUNT_FOR_VICTORY NO_COLLIDE DO_NOT_CLASSIFY CAN_CAST_REFLECTIONS EXPANSION_PAD

    Behavior              = FoundationAIUpdate ModuleTag_foundationAI
        BuildVariation    = 2
    End

    Behavior = CastleMemberBehavior ModuleTag_CMB
    End

    Body                  = ImmortalBody ModuleTag_05
        MaxHealth         = DEFAULT_FORTRESS_HEALTH
    End

    Geometry              = BOX
    GeometryMajorRadius   = 5.0
    GeometryMinorRadius   = 5.0
    GeometryHeight        = 0.8
    GeometryIsSmall       = No
    Shadow                = SHADOW_VOLUME
    BuildCompletion       = PLACED_BY_PLAYER
End



ChildObject MenFortressExpansionPadCorner_Tutorial1 MenFortressExpansionPadCorner
End

ChildObject MenFortressExpansionPadCorner_Tutorial2 MenFortressExpansionPadCorner
End

ChildObject MenFortressExpansionPadCorner_Tutorial3 MenFortressExpansionPadCorner
End

ChildObject MenFortressExpansionPadCorner_Tutorial4 MenFortressExpansionPadCorner
End

ChildObject MenFortressExpansionPadSide_Tutorial1 MenFortressExpansionPadCorner

    CommandSet = MenFortressExpansionPadSideCommandSet

    Behavior            = FoundationAIUpdate ModuleTag_foundationAI
        BuildVariation = 1
    End
End

ChildObject MenFortressExpansionPadSideTutorial2 MenFortressExpansionPadCorner

    CommandSet = MenFortressExpansionPadSideCommandSet

    Behavior           = FoundationAIUpdate ModuleTag_foundationAI
        BuildVariation = 1
    End
End



ChildObject MenFortressExpansionPadSide MenFortressExpansionPadCorner

    CommandSet = MenFortressExpansionPadSideCommandSet

    Behavior            = FoundationAIUpdate ModuleTag_foundationAI
        BuildVariation = 1
    End
End


ChildObject MenFortressExpansionPadBack MenFortressExpansionPadCorner

    CommandSet = MenFortressExpansionPadBackCommandSet

    Behavior            = FoundationAIUpdate ModuleTag_foundationAI
        BuildVariation = 1
    End
End


Object MenFortressCitadel


Draw = W3DFloorDraw ModuleTag_DrawFortressFloor
    ModelName            	= GBFloorSEE
    StartHidden 		= No
    HideIfModelConditions	= AWAITING_CONSTRUCTION
    HideIfModelConditions	= PARTIALLY_CONSTRUCTED
    ForceToBack 		= Yes
    FloorFadeRateOnObjectDeath  = -0.01
End

    ButtonImage         = BGFortress
    SelectPortrait  	= BPGFortress

    Draw = W3DScriptedModelDraw ModuleTag_MainDraw
        ExtraPublicBone         = ARROW_01
        ExtraPublicBone         = ARROW_02
        ExtraPublicBone         = ARROW_03
        ExtraPublicBone         = ARROW_04
        ExtraPublicBone         = ARROW_05
        ExtraPublicBone         = ARROW_06
        ExtraPublicBone         = ARROW_07
        ExtraPublicBone         = ARROW_08
        ExtraPublicBone         = ARROW_09
        ExtraPublicBone         = ARROW_10
        ExtraPublicBone         = ARROW_11
        ExtraPublicBone         = ARROW_12
        ExtraPublicBone         = ARROW_13
        ExtraPublicBone         = ARROW_14
        ExtraPublicBone         = ARROW_15
        ExtraPublicBone         = ARROW_16
        ExtraPublicBone         = ARROW_17
        ExtraPublicBone         = ARROW_18
        ExtraPublicBone         = ARROW_19
        ExtraPublicBone         = ARROW_20
        ExtraPublicBone         = ARROW_21
        ExtraPublicBone         = ARROW_22
        ExtraPublicBone         = ARROW_23
        ExtraPublicBone         = ARROW_24
        OkToChangeModelColor    = Yes
        StaticModelLODMode        = Yes

        DefaultModelConditionState
            Model                = GBFortress
            WeaponLaunchBone    = PRIMARY ARROW_
        End


        AnimationState = BUILD_PLACEMENT_CURSOR
            BeginScript
                   CurDrawableHideSubObject("FIREGLOW")
                   CurDrawableHideSubObject("FLAMES")
                   CurDrawableHideSubObject("GBFFLAG")
                   CurDrawableHideSubObject("GBFFLAMING")
            EndScript
        End


        AnimationState = PHANTOM_STRUCTURE
            BeginScript
                   CurDrawableHideSubObject("FIREGLOW")
                   CurDrawableHideSubObject("FLAMES")
                   CurDrawableHideSubObject("GBFFLAG")
                   CurDrawableHideSubObject("GBFFLAMING")
            EndScript
        End


        ModelConditionState  = DAMAGED
            Model        = GBFortress
            Texture        = GBFortress1.tga GBFortress1D.tga
        End

        AnimationState = DAMAGED
            EnteringStateFX    = FX_FortressDamaged
        End

        ModelConditionState  = REALLYDAMAGED
            Model         = GBFortress_D2
        End

        AnimationState    = REALLYDAMAGED
            Animation    = Fortress_ReallyDamaged
                AnimationName        = GBFortress_D2SK.GBFortress_D2AN
                AnimationMode        = ONCE
            End
            EnteringStateFX    = FX_FortressReallyDamaged
        End

        ModelConditionState  = RUBBLE
            Model         = GBFortress_D3
        End

        AnimationState    = RUBBLE
            Animation    = Fortress_Rubble
                AnimationName        = GBFortress_D3SK.GBFortress_D3AN
                AnimationMode        = ONCE
            End
            EnteringStateFX    = FX_FortressCollapse
        End


        ModelConditionState = UPGRADE_NUMENOR_STONEWORK
            Model        = GBFortress
            Texture        = GBFortress1.tga GBFortress1_U.tga
        End


        ModelConditionState = SNOW
            Model            = GBFortress
            Texture            = GBFortress1.tga GBFortress1_Snow.tga
        End

    End




    Draw = W3DScriptedModelDraw ModuleTag_OilDraw
        OkToChangeModelColor    = Yes
        StaticModelLODMode        = Yes

        DefaultModelConditionState
            Model           = None
        End


        ModelConditionState      = UPGRADE_BOILING_OIL DAMAGED USER_1
            Model        = GBFBOil_A
            Texture        = GBFortress1.tga GBFortress1D.tga
        End

        ModelConditionState      = UPGRADE_BOILING_OIL REALLYDAMAGED USER_1
            Model        = GBFBOil_A
            Texture        = GBFortress1.tga GBFortress1D.tga
        End


        ModelConditionState = UPGRADE_BOILING_OIL USER_1
            Model        = GBFBOil_A
        End
        AnimationState = UPGRADE_BOILING_OIL USER_1
            Animation                    = RiseUp
                AnimationName            = GBFBoil_ASKL.GBFBoil_ABLD
                AnimationMode            = ONCE
            End
        End


        ModelConditionState        = UPGRADE_BOILING_OIL DAMAGED
            Model        = GBFBoil
            Texture        = GBFortress1.tga GBFortress1D.tga
        End

        ModelConditionState        = UPGRADE_BOILING_OIL REALLYDAMAGED
            Model        = GBFBoil_D2
        End

        AnimationState            = UPGRADE_BOILING_OIL REALLYDAMAGED
            Animation            = ReallyDamaged
                AnimationName    = GBFBoil_D2SKL.GBFBoil_D2AN
                AnimationMode   = ONCE
            End
        End

        ModelConditionState        = UPGRADE_BOILING_OIL RUBBLE
            Model        = GBFBoil_D3
        End

        AnimationState            = UPGRADE_BOILING_OIL RUBBLE
            Animation            = Destroyed
                AnimationName    = GBFBoil_D3SKL.GBFBoil_D3AN
                AnimationMode   = ONCE
            End
        End


        ModelConditionState = UPGRADE_BOILING_OIL
            Model        = GBFBOil
        End
    End


    Draw = W3DScriptedModelDraw ModuleTag_OilGuyDraw
        AttachToBoneInAnotherModule = PositionBone
        OkToChangeModelColor    = Yes
        StaticModelLODMode        = Yes

        DefaultModelConditionState
            Model           = None
        End

        IdleAnimationState
            StateName        = NoTower
        End


        ModelConditionState = UPGRADE_BOILING_OIL USER_1
            Model        = None
        End

        ModelConditionState        = UPGRADE_BOILING_OIL RUBBLE
            Model        = NONE
        End


        AnimationState            = SPECIAL_WEAPON_ONE UNPACKING UPGRADE_BOILING_OIL
            Animation            = Pouring
                AnimationName    = GBFBOil_SKL.GBFBOil_ATKA
                AnimationMode   = ONCE
            End
            EnteringStateFX    = FX_BoilingOilAttack

            ParticleSysBone = Steam_Bone02 MenFortressSpray FOLLOWBONE:Yes
            ParticleSysBone = Steam_Bone03 MenFortressSpray FOLLOWBONE:Yes
            ParticleSysBone = Steam_Bone04 MenFortressSpray FOLLOWBONE:Yes
            ParticleSysBone = Steam_Bone05 MenFortressSpray FOLLOWBONE:Yes
            ParticleSysBone = Steam_Bone06 MenFortressSpray FOLLOWBONE:Yes
            ParticleSysBone = Steam_Bone07 MenFortressSpray FOLLOWBONE:Yes
            ParticleSysBone = Steam_Bone08 MenFortressSpray FOLLOWBONE:Yes
            ParticleSysBone = Steam_Bone09 MenFortressSpray FOLLOWBONE:Yes

            ParticleSysBone = Steam_Bone02 MenFortressSpray02 FOLLOWBONE:Yes
            ParticleSysBone = Steam_Bone03 MenFortressSpray02 FOLLOWBONE:Yes
            ParticleSysBone = Steam_Bone04 MenFortressSpray02 FOLLOWBONE:Yes
            ParticleSysBone = Steam_Bone05 MenFortressSpray02 FOLLOWBONE:Yes
            ParticleSysBone = Steam_Bone06 MenFortressSpray02 FOLLOWBONE:Yes
            ParticleSysBone = Steam_Bone07 MenFortressSpray02 FOLLOWBONE:Yes
            ParticleSysBone = Steam_Bone08 MenFortressSpray02 FOLLOWBONE:Yes
            ParticleSysBone = Steam_Bone09 MenFortressSpray02 FOLLOWBONE:Yes

            ParticleSysBone = Steam_Bone02 MenFortressSteam FOLLOWBONE:Yes
            ParticleSysBone = Steam_Bone03 MenFortressSteam FOLLOWBONE:Yes
            ParticleSysBone = Steam_Bone04 MenFortressSteam FOLLOWBONE:Yes
            ParticleSysBone = Steam_Bone05 MenFortressSteam FOLLOWBONE:Yes
            ParticleSysBone = Steam_Bone06 MenFortressSteam FOLLOWBONE:Yes
            ParticleSysBone = Steam_Bone07 MenFortressSteam FOLLOWBONE:Yes
            ParticleSysBone = Steam_Bone08 MenFortressSteam FOLLOWBONE:Yes
            ParticleSysBone = Steam_Bone09 MenFortressSteam FOLLOWBONE:Yes


            ParticleSysBone = Steam_Bone02 MenFortressProxy FOLLOWBONE:Yes
            ParticleSysBone = Steam_Bone03 MenFortressProxy FOLLOWBONE:Yes
            ParticleSysBone = Steam_Bone04 MenFortressProxy FOLLOWBONE:Yes
            ParticleSysBone = Steam_Bone05 MenFortressProxy FOLLOWBONE:Yes
            ParticleSysBone = Steam_Bone06 MenFortressProxy FOLLOWBONE:Yes
            ParticleSysBone = Steam_Bone07 MenFortressProxy FOLLOWBONE:Yes
            ParticleSysBone = Steam_Bone08 MenFortressProxy FOLLOWBONE:Yes
            ParticleSysBone = Steam_Bone09 MenFortressProxy FOLLOWBONE:Yes
        End


        ModelConditionState = UPGRADE_BOILING_OIL
            Model        = GBFBOil_SKN
        End
        AnimationState = UPGRADE_BOILING_OIL
            Animation            = Idle
                AnimationName    = GBFBOil_SKL.GBFBOil_IDLA
                AnimationMode   = LOOP
            End
        End
    End


    Draw = W3DScriptedModelDraw ModuleTag_IvoryTowerDraw
        OkToChangeModelColor    = Yes
        StaticModelLODMode        = Yes

        DefaultModelConditionState
            Model           = None
        End


        ModelConditionState        = UPGRADE_IVORY_TOWER DAMAGED
            Model        = GBFITower_A
            Texture        = GBFortress1.tga GBFortress1D.tga
        End

        ModelConditionState        = UPGRADE_IVORY_TOWER REALLYDAMAGED
            Model        = GBFITower_D2
        End

        AnimationState            = UPGRADE_IVORY_TOWER REALLYDAMAGED
            Animation            = ReallyDamaged
                AnimationName    = GBFITower_D2SK.GBFITower_D2AN
                AnimationMode   = ONCE
            End
        End

        ModelConditionState        = UPGRADE_IVORY_TOWER RUBBLE
            Model        = GBFITower_D3
        End

        AnimationState            = UPGRADE_IVORY_TOWER RUBBLE
            Animation            = Destroyed
                AnimationName    = GBFITower_D3SK.GBFITower_D3AN
                AnimationMode   = ONCE
            End
        End


        ModelConditionState = UPGRADE_IVORY_TOWER USER_2
            Model           = GBFITower_A
        End


        AnimationState = UPGRADE_IVORY_TOWER USER_2
            Animation                    = RiseUp
                AnimationName                = GBFITower_ASKL.GBFITower_ABLD
                AnimationMode                = ONCE
                AnimationSpeedFactorRange    = 8.0 8.0
            End
        End


        ModelConditionState = SNOW UPGRADE_IVORY_TOWER
            Model            = GBFITower
            Texture            = GBFortress1.tga GBFortress1_Snow.tga
        End

        ModelConditionState = UPGRADE_IVORY_TOWER
            Model           = GBFITower
        End

    End



    Draw = W3DScriptedModelDraw ModuleTag_HouseOfHealingDraw
        OkToChangeModelColor    = Yes
        StaticModelLODMode        = Yes

        DefaultModelConditionState
            Model           = None
        End


        ModelConditionState = UPGRADE_HOUSE_OF_HEALING USER_3 DAMAGED
            Model        = GBFHeal_A
            Texture        = GBFortress1.tga GBFortress1D.tga
        End

        ModelConditionState = UPGRADE_HOUSE_OF_HEALING USER_3 REALLYDAMAGED
            Model        = GBFHeal_A
            Texture        = GBFortress1.tga GBFortress1D.tga
        End

        ModelConditionState = UPGRADE_HOUSE_OF_HEALING USER_3 UPGRADE_NUMENOR_STONEWORK
            Model        = GBFHeal_A
            Texture        = GBFortress1.tga GBFortress1_U.tga
        End
        ModelConditionState = UPGRADE_HOUSE_OF_HEALING USER_3 SNOW
            Model        = GBFHeal_A
            Texture        = GBFortress1.tga GBFortress1_Snow.tga
        End
        ModelConditionState = UPGRADE_HOUSE_OF_HEALING USER_3
            Model        = GBFHeal_A
        End
        AnimationState = UPGRADE_HOUSE_OF_HEALING USER_3
            Animation                    = RiseUp
                AnimationName                = GBFHeal_ASKL.GBFHeal_ABLD
                AnimationMode                = ONCE
                AnimationSpeedFactorRange    = 5.0 5.0
            End
        End


        ModelConditionState        = UPGRADE_HOUSE_OF_HEALING DAMAGED
            Model        = GBFHeal
            Texture        = GBFortress1.tga GBFortress1D.tga
        End

        ModelConditionState        = UPGRADE_HOUSE_OF_HEALING REALLYDAMAGED
            Model        = GBFHeal_D2
        End

        AnimationState            = UPGRADE_HOUSE_OF_HEALING REALLYDAMAGED
            Animation            = ReallyDamaged
                AnimationName    = GBFHeal_D2SKL.GBFHeal_D2AN
                AnimationMode   = ONCE
            End
        End

        ModelConditionState        = UPGRADE_HOUSE_OF_HEALING RUBBLE
            Model        = GBFHeal_D3
        End

        AnimationState            = UPGRADE_HOUSE_OF_HEALING RUBBLE
            Animation            = Destroyed
                AnimationName    = GBFHeal_D3SKL.GBFHeal_D3AN
                AnimationMode   = ONCE
            End
        End


        ModelConditionState = UPGRADE_NUMENOR_STONEWORK UPGRADE_HOUSE_OF_HEALING
            Model        = GBFHeal
            Texture        = GBFortress1.tga GBFortress1_U.tga
        End


        ModelConditionState = SNOW UPGRADE_HOUSE_OF_HEALING
            Model            = GBFHeal
            Texture            = GBFortress1.tga GBFortress1_Snow.tga
        End


        ModelConditionState = UPGRADE_HOUSE_OF_HEALING
            Model           = GBFHeal
        End

    End


    Draw = W3DScriptedModelDraw ModuleTag_DrawTower2

        OkToChangeModelColor    = Yes
        StaticModelLODMode        = Yes

        DefaultModelConditionState
            Model           = None
        End


        ModelConditionState        = UPGRADE_HOUSE_OF_HEALING DAMAGED
            Model        = gbbalkon
            Texture        = GBFortress1.tga GBFortress1D.tga
        End

        ModelConditionState        = UPGRADE_HOUSE_OF_HEALING REALLYDAMAGED
            Model        = gbbalkon
        End

        AnimationState            = UPGRADE_HOUSE_OF_HEALING REALLYDAMAGED
            Animation            = ReallyDamaged
                AnimationName    = gbbalkon.gbbalkon
                AnimationMode   = ONCE
            End
        End

        ModelConditionState        = UPGRADE_HOUSE_OF_HEALING RUBBLE
            Model        = gbbalkon
        End

        AnimationState            = UPGRADE_HOUSE_OF_HEALING RUBBLE
            Animation            = Destroyed
                AnimationName    = gbbalkon.gbbalkon
                AnimationMode   = ONCE
            End
        End


        ModelConditionState = UPGRADE_HOUSE_OF_HEALING USER_3
            Model           = gbbalkon_a
        End


        AnimationState = UPGRADE_HOUSE_OF_HEALING USER_3
            Animation                    = RiseUp
                AnimationName                = gbbalkon_a.gbbalkon_a
                AnimationMode                = ONCE
                AnimationSpeedFactorRange    = 6.0 6.0
            End
        End


        ModelConditionState = SNOW UPGRADE_HOUSE_OF_HEALING
            Model           = gbbalkon
            Texture         = GBFortress1.tga GBFortress1_Snow.tga
        End

        ModelConditionState = UPGRADE_HOUSE_OF_HEALING
            Model           = gbbalkon
        End

    End




    Draw = W3DScriptedModelDraw ModuleTag_DrawDoor

        DefaultModelConditionState
            Model = GBFDoor_DRC
        End


        ModelConditionState   = DAMAGED DOOR_1_WAITING_OPEN
            Model        = GBFDoor_DRO
            Texture        = GBFortress1.tga GBFortress1D.tga
        End

        ModelConditionState   = REALLYDAMAGED DOOR_1_WAITING_OPEN
            Model        = GBFDoor_DRO
            Texture        = GBFortress1.tga GBFortress1D.tga
        End

        ModelConditionState = DAMAGED DOOR_1_CLOSING
            Model        = GBFDoor_DRCA
            Texture        = GBFortress1.tga GBFortress1D.tga
        End

        ModelConditionState = REALLYDAMAGED DOOR_1_CLOSING
            Model        = GBFDoor_DRCA
            Texture        = GBFortress1.tga GBFortress1D.tga
        End

        ModelConditionState = DAMAGED
            Model        = GBFDoor_DRC
            Texture        = GBFortress1.tga GBFortress1D.tga
        End

        ModelConditionState = REALLYDAMAGED
            Model        = GBFDoor_DRC
            Texture        = GBFortress1.tga GBFortress1D.tga
        End

        ModelConditionState = RUBBLE
            Model        = GBFDoor_D3
        End

        AnimationState    = RUBBLE
            Animation    = Door_Destroyed
                AnimationName        = GBFDoor_D3.GBFDoor_D3
                AnimationMode        = ONCE
                AnimationBlendTime    = 50
            End
        End


        ModelConditionState   = DOOR_1_OPENING
            Model               = GBFDoor_DROA
        End

        AnimationState            =    DOOR_1_OPENING
            Animation           =    GBFDoor_DRO
                AnimationName   =    GBFDoor_DROA.GBFDoor_DROA
                AnimationMode   =    ONCE
            End
        End

        ModelConditionState   = DOOR_1_CLOSING
            Model               = GBFDoor_DRCA
            ParticleSysBone        = NONE trollCageDust
        End

           AnimationState            =    DOOR_1_CLOSING
            Animation           =    GBFDoor_DRCA
                AnimationName   =    GBFDoor_DRCA.GBFDoor_DRCA
                AnimationMode   =    ONCE
            End
        End

        ModelConditionState   = DOOR_1_WAITING_OPEN
            Model               = GBFDoor_DRO
        End

        AnimationState            =    DOOR_1_WAITING_OPEN
        End

        ModelConditionState  = POST_RUBBLE
            Model         = None
        End

        ModelConditionState  = POST_COLLAPSE
            Model         = None
        End
    End




    Draw = W3DFloorDraw ModuleTag_DrawFloor
          ModelName        = GBFortress_Bib
          WeatherTexture SNOWY GBFortress_bib_snow.tga
    End


    DisplayName           = OBJECT:MenFortress
    Description           = OBJECT:MenFortressDescription
    Side                  = Men
    EditorSorting         = STRUCTURE
    ThreatLevel           = 1.0
    CommandPointBonus     = MAIN_FORTRESS_COMMAND_POINT
    MaxSimultaneousOfType = NEW_FORTRESS_RATIO
    BuildCost             = MEN_FORTRESS_BUILDCOST
    BuildTime             = DEFAULT_FORTRESS_BUILDTIME
    VisionRange           = DEFAULT_FORTRESS_VISION_RANGE
    ShroudClearingRange   = DEFAULT_FORTRESS_SHROUD_CLEAR

    WeaponSet
        Weapon               = PRIMARY FortressArrowTowerBow
        AutoChooseSources    = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End

    ArmorSet
        Conditions        = None
        Armor             = DefaultFortressArmor
    End

    CommandSet            = MenFortressCommandSet




    #include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

    EvaEventDieOwner                 = EvaFortressDie

    VoiceSelect                     = MenFortressSelect
    VoiceSelectUnderConstruction    = BuildingGoodVoiceSelectUnderConstruction

    SoundOnDamaged                    = BuildingLightDamageStone
    SoundOnReallyDamaged            = BuildingHeavyDamageStone

    UnitSpecificSounds
        UnderConstruction            = BuildingBigConstructionLoop

        UnderRepairFromRubble        = BuildingBigConstructionLoop
    End

    CampnessValue = CAMPNESS_FORTRESS


    RadarPriority      = STRUCTURE
    KindOf             = PRELOAD COMMANDCENTER VITAL_FOR_BASE_SURVIVAL STRUCTURE IMMOBILE CASTLE_KEEP MP_COUNT_FOR_VICTORY SELECTABLE FS_FACTORY AUTO_RALLYPOINT MADE_OF_WOOD SCORE DOZER_FACTORY

    Behavior            = GettingBuiltBehavior ModuleTag_GettingBuiltBehavior
        WorkerName    = GondorWorkerNoSelect
        SpawnTimer    = DEFAULT_STRUCTURE_HEALDELAY
    End

    Behavior = CastleMemberBehavior ModuleTag_CMB
        BeingBuiltSound = BuildingBigConstructionLoop
    End


    Behavior = ProductionUpdate ProductionUpdateModuleTag
		ProductionModifier
		RequiredUpgrade = Upgrade_ObjectUnderAIControl
		TimeMultiplier  = TIME_MULTIPLIER_AI_HEROES
		HeroRevive      = Yes
		ModifierFilter  = NONE +HERO
	End
	ProductionModifier
		RequiredUpgrade = Upgrade_BrutalAIMultiPlayer Upgrade_BrutalAISinglePlayer
		CostMultiplier  = COST_MULTIPLIER_AI_HEROES
		HeroPurchase    = Yes
		HeroRevive      = Yes
		ModifierFilter  = NONE +HERO
	End
	ProductionModifier
		RequiredUpgrade = Upgrade_MenFortressBanners
		CostMultiplier  = 0.80
		ModifierFilter  = NONE +MenPorter
	End
	ProductionModifier
		RequiredUpgrade = Upgrade_MenFortressBanners
		CostMultiplier  = 0.90
		TimeMultiplier  = 0.90
		HeroPurchase    = Yes
		HeroRevive      = Yes
		ModifierFilter  = NONE +HERO
        End

  	NumDoorAnimations       = 1
	DoorOpeningTime         = 3000
	DoorWaitOpenTime        = 3000
	DoorCloseTime           = 3000
    End

    Behavior = ObjectCreationUpgrade CreateTheDiscount
        TriggeredBy        = Upgrade_MenFortressBanners
        Delay              = 0.0
        ThingToSpawn       = DiscountHeroObjectGondor
        FadeInTime         = 100
    End

    Behavior = QueueProductionExitUpdate ModuleTag_QueuePEU
        UnitCreatePoint   = X:0.0 Y:0.0 Z:0.0
        NaturalRallyPoint = X:80.0 Y:0.0 Z:0.0
        ExitDelay         = STANDARD_HERO_EXIT_DELAY
    End

    Body                        = StructureBody ModuleTag_05
        MaxHealth                     = DEFAULT_FORTRESS_HEALTH
        MaxHealthDamaged              = DEFAULT_FORTRESS_HEALTH_DAMAGED
        MaxHealthReallyDamaged        = DEFAULT_FORTRESS_HEALTH_REALLY_DAMAGED
    End

    Behavior                  = StructureCollapseUpdate ModuleTag_08
        MinCollapseDelay        = 000
        MaxCollapseDelay        = 000
        CollapseDamping         = .5
        MaxShudder              = 0.6
        MinBurstDelay           = 250
        MaxBurstDelay           = 800
        BigBurstFrequency       = 4
        FXList                  = INITIAL   FX_FortressCollapse
        DestroyObjectWhenDone   = Yes
        CollapseHeight          = 155
    End

    Behavior = CitadelSlaughterHordeContain ModuleTag_SlaughterMe
		PassengerFilter			= GENERIC_FACTION_SLAUGHTERABLE
		ObjectStatusOfContained		= UNSELECTABLE ENCLOSED
		CashBackPercent			= 200%
		ContainMax			= 99
		AllowEnemiesInside		= No
		AllowAlliesInside		= No
		AllowNeutralInside		= No
		AllowOwnPlayerInsideOverride	= Yes
		EnterSound			= GUI_RingReturned
		EntryOffset			= X:125.0 Y:0.0 Z:0.0
		EntryPosition			= X:30.0 Y:0.0 Z:0.0
		ExitOffset			= X:125.0 Y:0.0 Z:0.0
    End

	#include "..\..\..\FortressRingFunc.inc"


    Behavior = SubObjectsUpgrade ModuleTag_HideAll
        TriggeredBy        = Upgrade_StructureLevel1
        HideSubObjects     = GBFFLAMING GBFFLAG
    End


    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_OilEnabler
        SpecialPowerTemplate = SpecialAbilityMenFortressBoilingOil
        TriggeredBy = Upgrade_MenFortressBoilingOil
    End
	
    Behavior = SpecialPowerModule ModuleTag_OilStarter
        SpecialPowerTemplate      = SpecialAbilityMenFortressBoilingOil
        UpdateModuleStartsAttack  = Yes
        StartsPaused                = Yes
    End
	
    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_OilWeaponFireUpdate
        SpecialPowerTemplate    = SpecialAbilityMenFortressBoilingOil
        WhichSpecialWeapon        = 1
        UnpackTime              = 5200
        PackTime                = 4600
        SpecialWeapon            = MenFortressBoilingOilWeapon
    End

	Behavior = AutoAbilityBehavior ModuleTag_BoilingOilAutoAbility
		SpecialAbility		    	= SpecialAbilityMenFortressBoilingOil
		MaxScanRange			= 200
		Query					= 1 ALL ENEMIES
	End

    Behavior = ModelConditionUpgrade ModuleTag_ShowTheOil
        TriggeredBy                = Upgrade_MenFortressBoilingOil
        AddConditionFlags        = UPGRADE_BOILING_OIL
        AddTempConditionFlag    = ModelConditionState:USER_1
        TempConditionTime        = 5.0
        Permanent                = Yes
    End

    Behavior = AudioLoopUpgrade ModuleTag_BoilingOilBuildLoop
        TriggeredBy            = Upgrade_MenFortressBoilingOil
        SoundToPlay            = WallConstructionLoop
        KillOnDeath         = Yes
        KillAfterMS            = 4000
    End


    Behavior = CastleUpgrade ModuleTag_PassOutNumenorStoneworkUpgrade
        TriggeredBy    = Upgrade_MenFortressNumenorStoneworkTrigger
        Upgrade        = Upgrade_MenFortressNumenorStonework
        WallUpgradeRadius = MEN_FORTRESS_WALL_EFFECTIVE_RADIUS
    End

    Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
        TriggeredBy                = Upgrade_MenFortressNumenorStonework
        AttributeModifier        = NumenorStoneworkKeep_Bonus
    End

    Behavior = ModelConditionUpgrade ModuleTag_ShowTheStones
        TriggeredBy            = Upgrade_MenFortressNumenorStonework
        AddConditionFlags    = UPGRADE_NUMENOR_STONEWORK
        Permanent            = Yes
    End

    Behavior = ArmorUpgrade ModuleTag_ArmorUpgrade
        TriggeredBy             = Upgrade_MenFortressNumenorStonework
    End

    Behavior = CastleUpgrade ModuleTag_PassOutFlamingMunitionsUpgrade
        TriggeredBy       = Upgrade_GoodFortressFlamingMunitionsTrigger
        Upgrade           = Upgrade_GoodFortressFlamingMunitions
    End

    Behavior = StatusBitsUpgrade ModuleTag_FakeOut
        TriggeredBy       = Upgrade_GoodFortressFlamingMunitions
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowTorches
        TriggeredBy        = Upgrade_GoodFortressFlamingMunitions
        ShowSubObjects     = GBFFLAMING
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowBanners
        TriggeredBy        = Upgrade_MenFortressBanners
        ShowSubObjects     = GBFFLAG
    End

    Behavior = ModelConditionUpgrade ModuleTag_ShowHouseOfHealing
        TriggeredBy             = Upgrade_FortressPalaceoftheSteward
        AddConditionFlags       = UPGRADE_HOUSE_OF_HEALING
        AddTempConditionFlag    = ModelConditionState:USER_3
        TempConditionTime       = 7.0
        Permanent               = Yes
    End

    Behavior = AudioLoopUpgrade ModuleTag_HouseOfHealingBuildLoop
        TriggeredBy            = Upgrade_FortressPalaceoftheSteward
        SoundToPlay            = BuildingConstructionLoop
        KillOnDeath            = Yes
        KillAfterMS            = 5000
    End

    Behavior = CastleUpgrade ModuleTag_PassOutHouseOfHealingUpgrade
        TriggeredBy    = Upgrade_FortressPalaceoftheSteward
        Upgrade        = Upgrade_FortressPalaceoftheSteward
    End

    Behavior = StatusBitsUpgrade ModuleTag_FakeOutMysticFountains
        TriggeredBy    = Upgrade_FortressPalaceoftheSteward
    End

    Behavior = StatusBitsUpgrade ModuleTag_WellFix
        TriggeredBy    = Upgrade_MenFortressHouseOfHealing
    End

    Behavior = FireWeaponUpdate ModuleTag_WeaponFiring
        FireWeaponNugget
            WeaponName = MenFortressHealWeapon
            Offset = X:0 Y:0 Z:0
            FireDelay = 0
            OneShot = No
        End
    End

    Behavior = GeometryUpgrade TowerGeom
        TriggeredBy            = Upgrade_MenFortressIvoryTower Upgrade_FortressPalaceoftheSteward
        RequiresAllTriggers    = Yes
        ShowGeometry           = HighTowerGeom
    End

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_IvoryTowerVisionEnabler
        SpecialPowerTemplate = SpecialAbilityMenFortressIvoryTowerVision
        TriggeredBy 	     = Upgrade_MenFortressIvoryTower Upgrade_FortressPalaceoftheSteward
        RequiresAllTriggers  = Yes
    End
	
    Behavior                 = OCLSpecialPower ModuleTag_IvoryTowerVision
        SpecialPowerTemplate = SpecialAbilityMenFortressIvoryTowerVision
        StartsPaused         = Yes
        OCL                  = SpecialPowerIvoryTowerVision
        CreateLocation       = CREATE_AT_LOCATION
    End

    Behavior = AudioLoopUpgrade ModuleTag_IvoryTowerBuildLoop
        TriggeredBy            = Upgrade_MenFortressIvoryTower
        SoundToPlay            = BuildingBigConstructionLoop
        KillOnDeath            = Yes
        KillAfterMS            = 2500
    End

    Behavior = ModelConditionUpgrade ModuleTag_ShowTheTower
        TriggeredBy              = Upgrade_MenFortressIvoryTower Upgrade_FortressPalaceoftheSteward
        RequiresAllTriggers      = Yes
        AddConditionFlags        = UPGRADE_IVORY_TOWER
        AddTempConditionFlag     = ModelConditionState:USER_2
        TempConditionTime        = 10.0
        Permanent                = Yes
    End

    Behavior = CommandSetUpgrade ModueTag_LevelCommandSet_WithoutDenethor
        TriggeredBy            = Upgrade_FortressPalaceoftheSteward
        CommandSet             = MenFortressCommandSet_WithoutDenethor
    End
	
	
	

    Behavior = ObjectCreationUpgrade MakeTheFreeTreb2
        TriggeredBy             = Upgrade_FortressPalaceoftheSteward
        Delay                   = 3000.0
        RemoveUpgrade           = Upgrade_WallTrebuchetButtonEnable
        ThingToSpawn            = GondorDenethor
        Offset                  = X:54 Y:0 Z:51.14
        FadeInTime              = 500
    End

    Behavior = SlaveWatcherBehavior WatchTheTreb
        RemoveUpgrade           = Upgrade_FortressPalaceoftheSteward
        GrantUpgrade            = Upgrade_WallTrebuchetButtonEnable
        ShareUpgrades           = Yes
    End

    Behavior = AIUpdateInterface ModuleTag_AI
        AILuaEventsList            = FortressFunctions
        AutoAcquireEnemiesWhenIdle = Yes
        MoodAttackCheckRate        = 250
    End

    Behavior = AutoDepositUpdate AutoDepositModuleTag
        DepositTiming           = GENERIC_KEEP_MONEY_TIME
        DepositAmount           = GENERIC_KEEP_MONEY_AMOUNT
        InitialCaptureBonus     = 0
    End

    Behavior = TerrainResourceBehavior ModuleTag_NewMoneyDeadSpot
        Radius            = GENERIC_KEEP_MONEY_RANGE
        MaxIncome         = 0
        IncomeInterval    = 999999
        HighPriority      = Yes
    End

    Behavior = AISpecialPowerUpdate BoilongOilAI
		CommandButtonName = Command_FireWeaponMenFortressBoilingOil
		SpecialPowerAIType = AI_SPELLBOOK_ARMY_BREAKER
		SpecialPowerRadius = 200
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI1
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 320000
        GrantUpgrade = Upgrade_MenFortressBanners
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI2
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 700000
        GrantUpgrade = Upgrade_GoodFortressFlamingMunitionsTrigger
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI3
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 1000000
        GrantUpgrade = Upgrade_MenFortressBoilingOil
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI4
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 1400000
        GrantUpgrade = Upgrade_MenFortressNumenorStoneworkTrigger
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI5
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 1600000
        GrantUpgrade = Upgrade_MenFortressHouseOfHealing
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI6
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 1750000
        GrantUpgrade = Upgrade_FortressPalaceoftheSteward
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI7
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 2000000
        GrantUpgrade = Upgrade_MenFortressIvoryTower
    End

    GeometryIsSmall       = No
    Geometry              = BOX
    GeometryMajorRadius   = 49
    GeometryMinorRadius   = 49
    GeometryHeight        = 50

    AdditionalGeometry    = BOX
    GeometryMajorRadius    = 12.0
    GeometryMinorRadius    = 12.0
    GeometryHeight        = 100.0
    GeometryOffset        = X:-40 Y:-40 Z:0

    AdditionalGeometry    = BOX
    GeometryMajorRadius    = 12.0
    GeometryMinorRadius    = 12.0
    GeometryHeight        = 100.0
    GeometryOffset        = X:-40 Y:40 Z:0

    AdditionalGeometry    = BOX
    GeometryMajorRadius    = 12.0
    GeometryMinorRadius    = 12.0
    GeometryHeight        = 100.0
    GeometryOffset        = X:40 Y:-40 Z:0

    AdditionalGeometry    = BOX
    GeometryMajorRadius    = 12.0
    GeometryMinorRadius    = 12.0
    GeometryHeight        = 100.0
    GeometryOffset        = X:40 Y:40 Z:0

    AdditionalGeometry        = BOX
    GeometryName            = HighTowerGeom
    GeometryMajorRadius       = 12
    GeometryMinorRadius       = 12
    GeometryHeight            = 175
    GeometryOffset            = X:0 Y:0 Z:0
    GeometryUsedForHealthBox = No

    GeometryContactPoint = X:-57        Y:57        Z:0            Repair
    GeometryContactPoint = X:57            Y:-57        Z:0            Repair
    GeometryContactPoint = X:49            Y:36.435    Z:0
    GeometryContactPoint = X:-32.763    Y:-46.121    Z:0
    GeometryContactPoint = X:0            Y:0            Z:180        Swoop

    Shadow                = SHADOW_VOLUME
    BuildCompletion     = PLACED_BY_PLAYER
End


ChildObject BFME1GondorFortressCitadel MenFortressCitadel

    Draw = W3DScriptedModelDraw ModuleTag_MainDraw
        ExtraPublicBone         = ARROW_01
        ExtraPublicBone         = ARROW_02
        ExtraPublicBone         = ARROW_03
        ExtraPublicBone         = ARROW_04
        ExtraPublicBone         = ARROW_05
        ExtraPublicBone         = ARROW_06
        ExtraPublicBone         = ARROW_07
        ExtraPublicBone         = ARROW_08
        ExtraPublicBone         = ARROW_09
        ExtraPublicBone         = ARROW_10
        ExtraPublicBone         = ARROW_11
        ExtraPublicBone         = ARROW_12
        ExtraPublicBone         = ARROW_13
        ExtraPublicBone         = ARROW_14
        ExtraPublicBone         = ARROW_15
        ExtraPublicBone         = ARROW_16
        ExtraPublicBone         = ARROW_17
        ExtraPublicBone         = ARROW_18
        ExtraPublicBone         = ARROW_19
        ExtraPublicBone         = ARROW_20
        ExtraPublicBone         = ARROW_21
        ExtraPublicBone         = ARROW_22
        ExtraPublicBone         = ARROW_23
        ExtraPublicBone         = ARROW_24
        OkToChangeModelColor        = Yes
        StaticModelLODMode        = Yes

        DefaultModelConditionState
            Model            = GBFortress
            WeaponLaunchBone    = PRIMARY ARROW_
        End


        ModelConditionState = BUILD_PLACEMENT_CURSOR
            Model    = None
        End


        AnimationState = BUILD_PLACEMENT_CURSOR
            BeginScript
                   CurDrawableHideSubObject("FIREGLOW")
                   CurDrawableHideSubObject("FLAMES")
                   CurDrawableHideSubObject("GBFFLAG")
                   CurDrawableHideSubObject("GBFFLAMING")
            EndScript
        End


        ModelConditionState =  PHANTOM_STRUCTURE
            Model    = GBFortress
        End


        AnimationState = PHANTOM_STRUCTURE
            BeginScript
                   CurDrawableHideSubObject("FIREGLOW")
                   CurDrawableHideSubObject("FLAMES")
                   CurDrawableHideSubObject("GBFFLAG")
                   CurDrawableHideSubObject("GBFFLAMING")
            EndScript
        End

        ModelConditionState = ACTIVELY_BEING_CONSTRUCTED SNOW
            Model                = GBFortress_A
            Texture                = GBFortress1.tga GBFortress1_Snow.tga
        End
        ModelConditionState = ACTIVELY_BEING_CONSTRUCTED
            Model                = GBFortress_A
        End

        AnimationState = ACTIVELY_BEING_CONSTRUCTED
            Animation            = UpAndStill
                AnimationName        = GBFortress_ASK.GBFortress_ABL
                AnimationMode        = MANUAL
            End
            BeginScript
                CurDrawablePlaySound("GondorBarracksBeginConstruction")
            EndScript
            ParticleSysBone = NONE BuildingContructDustCastles FollowBone:Yes
            StateName = BeingConstructed
        End


        ModelConditionState            = DAMAGED
            Model                = GBFortress
            Texture                = GBFortress1.tga GBFortress1D.tga
        End

        AnimationState = DAMAGED
            EnteringStateFX            = FX_FortressDamaged
        End

        ModelConditionState  = REALLYDAMAGED
            Model         = GBFortress_D2
        End

        AnimationState    = REALLYDAMAGED
            Animation    = Fortress_ReallyDamaged
                AnimationName        = GBFortress_D2SK.GBFortress_D2AN
                AnimationMode        = ONCE
            End
            EnteringStateFX    = FX_FortressReallyDamaged
        End

        ModelConditionState  = RUBBLE
            Model         = GBFortress_D3
        End

        AnimationState    = RUBBLE
            Animation    = Fortress_Rubble
                AnimationName        = GBFortress_D3SK.GBFortress_D3AN
                AnimationMode        = ONCE
            End
            EnteringStateFX    = FX_FortressCollapse
        End


        ModelConditionState = UPGRADE_NUMENOR_STONEWORK
            Model        = GBFortress
            Texture        = GBFortress1.tga GBFortress1_U.tga
        End


        ModelConditionState = SNOW
            Model            = GBFortress
            Texture            = GBFortress1.tga GBFortress1_Snow.tga
        End

    End

    Draw = W3DFloorDraw ModuleTag_DrawFloor
        StaticModelLODMode   = Yes
        ModelName            = None
    End

    Behavior = TerrainResourceBehavior ModuleTag_NewMoneyDeadSpot
        Radius            = 0
        MaxIncome         = 0
        IncomeInterval    = 999999
        HighPriority      = Yes
    End
End




Object MenFortress

    SelectPortrait = BPGFortress

    Draw                = W3DScriptedModelDraw ModuleTag_01
        OkToChangeModelColor    = Yes
        StaticModelLODMode        = Yes

        DefaultModelConditionState
            Model           = None
        End

        IdleAnimationState
        End


        ModelConditionState = WORLD_BUILDER
            Model    = GBFortress
        End


        ModelConditionState = BUILD_PLACEMENT_CURSOR
            Model    = None
        End


        ModelConditionState =  PHANTOM_STRUCTURE
            Model    = GBFortress
        End


        AnimationState = BUILD_PLACEMENT_CURSOR
            BeginScript
                   CurDrawableHideSubObject("FIREGLOW")
                   CurDrawableHideSubObject("FLAMES")
                   CurDrawableHideSubObject("GBFFLAG")
                   CurDrawableHideSubObject("GBFFLAMING")
            EndScript
        End


        AnimationState = PHANTOM_STRUCTURE
            BeginScript
                   CurDrawableHideSubObject("FIREGLOW")
                   CurDrawableHideSubObject("FLAMES")
                   CurDrawableHideSubObject("GBFFLAG")
                   CurDrawableHideSubObject("GBFFLAMING")
            EndScript
        End

        ModelConditionState  = RUBBLE
            Model         = GBFortress_D3
        End

        AnimationState    = RUBBLE
            Animation    = Fortress_Rubble
                AnimationName        = GBFortress_D3SK.GBFortress_D3AN
                AnimationMode        = ONCE
            End
            EnteringStateFX    = FX_FortressCollapse
        End

        ModelConditionState = ACTIVELY_BEING_CONSTRUCTED SNOW
            Model            = GBFortress_A
            Texture            = GBFortress1.tga GBFortress1_Snow.tga
        End
        ModelConditionState = ACTIVELY_BEING_CONSTRUCTED
            Model            = GBFortress_A
        End

        AnimationState = ACTIVELY_BEING_CONSTRUCTED
            Animation                    = UpAndStill
                AnimationName            = GBFortress_ASK.GBFortress_ABL
                AnimationMode            = MANUAL
            End
            BeginScript
                CurDrawablePlaySound("GondorBarracksBeginConstruction")
            EndScript
            ParticleSysBone = NONE BuildingContructDustCastles FollowBone:Yes
            StateName = BeingConstructed
        End
    End

    Draw = W3DScriptedModelDraw ModuleTag_DrawDoor

        DefaultModelConditionState
            Model = None
        End


        ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED
            Model               = GBFDoor_A
        End

        AnimationState        = ACTIVELY_BEING_CONSTRUCTED
            Animation           = GBFDoor_A
                AnimationName     = GBFDoor_A.GBFDoor_A
                AnimationMode     = MANUAL
            End
        End
    End

 PlacementViewAngle = -45

    ArmorSet
        Conditions     = None
        Armor          = DefaultFortressArmor
        DamageFX       = EmptyDamageFX
    End

    Side                = Men
    EditorSorting       = STRUCTURE
    MaxSimultaneousOfType = NEW_FORTRESS_RATIO

    BuildCost           = MEN_FORTRESS_BUILDCOST
    BuildTime           = DEFAULT_FORTRESS_BUILDTIME


    DisplayName         = OBJECT:MenFortress



    AutoResolveUnitType = AutoResolveUnit_Fortress

        AutoResolveBody = AutoResolve_MenFortressBody

        AutoResolveArmor
            Armor = AutoResolve_MenFortressArmor
        End

        AutoResolveWeapon
            Weapon = AutoResolve_MenFortressWeapon
        End


    #include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

    VoiceFullyCreated               = EVA:FortressComplete-Builder
    VoiceSelect                     = MenFortressSelect
    VoiceSelectUnderConstruction    = BuildingGoodVoiceSelectUnderConstruction

    SoundOnDamaged                  = BuildingLightDamageStone
    SoundOnReallyDamaged            = BuildingHeavyDamageStone

    UnitSpecificSounds
        UnderConstruction           = BuildingBigConstructionLoop
        UnderRepairFromRubble       = BuildingBigConstructionLoop
    End

    ClientBehavior = ModelConditionAudioLoopClientBehavior ModuleTag_PlayCollapseSound
        ModelCondition = REQUIRED:RUBBLE Sound:BuildingSink
    End


    RadarPriority       = STRUCTURE
    KindOf              = STRUCTURE SELECTABLE IMMOBILE BASE_FOUNDATION MP_COUNT_FOR_VICTORY BASE_SITE CAN_SEE_THROUGH_STRUCTURE LIVING_WORLD_BUILDING_MIRROR CAN_CAST_REFLECTIONS

    Body                = StructureBody ModuleTag_05
        MaxHealth         = DEFAULT_FORTRESS_HEALTH
    End

    Behavior = CastleBehavior ModuleTag_castle
        CastleToUnpackForFaction    = Men Fortress_Men
        CastleToUnpackForFaction    = Arnor Fortress_Men
        CastleToUnpackForFaction    = Rohan Fortress_Men
        CastleToUnpackForFaction    = Elves Fortress_Men
        CastleToUnpackForFaction    = Imladris Fortress_Men
        CastleToUnpackForFaction    = Dwarves Fortress_Men
        CastleToUnpackForFaction    = Mordor Fortress_Men
        CastleToUnpackForFaction    = Isengard Fortress_Men
        CastleToUnpackForFaction    = Wild Fortress_Men
        CastleToUnpackForFaction    = Angmar Fortress_Men

        FilterValidOwnedEntries     = ANY +STRUCTURE +WALK_ON_TOP_OF_WALL +BASE_FOUNDATION +TACTICAL_MARKER

        MaxCastleRadius             = 130.0
        InstantUnpack               = Yes
        KeepDeathKillsEverything    = Yes

        EvaEnemyCastleSightedEvent  = EnemyFortressSighted
    End

    Behavior                  = StructureCollapseUpdate ModuleTag_08
        MinCollapseDelay        = 000
        MaxCollapseDelay        = 000
        CollapseDamping         = .5
        MaxShudder              = 0.6
        MinBurstDelay           = 250
        MaxBurstDelay           = 800
        BigBurstFrequency       = 4
        FXList                  = INITIAL   FX_FortressCollapse
        DestroyObjectWhenDone   = Yes
        CollapseHeight          = 155
    End

    Behavior            = GettingBuiltBehavior ModuleTag_GettingBuiltBehavior
        WorkerName    = GondorWorkerNoSelect
        SpawnTimer    = DEFAULT_STRUCTURE_HEALDELAY
    End

    Behavior = AIUpdateInterface ModuleTag_AI
        AILuaEventsList                = FortressFunctions
    End


    Geometry                  = BOX
    GeometryMajorRadius       = 64
    GeometryMinorRadius       = 64
    GeometryHeight            = 50


    AdditionalGeometry        = BOX
    GeometryName              = Plots
    GeometryMajorRadius       = 10.0
    GeometryMinorRadius       = 10.0
    GeometryHeight            = 0.8
    GeometryOffset            = X:64.0 Y:-64.0 Z:0

    AdditionalGeometry        = BOX
    GeometryName              = Plots
    GeometryMajorRadius       = 10.0
    GeometryMinorRadius       = 10.0
    GeometryHeight            = 0.8
    GeometryOffset            = X:00 Y:-62.0 Z:0

    AdditionalGeometry        = BOX
    GeometryName              = Plots
    GeometryMajorRadius       = 10.0
    GeometryMinorRadius       = 10.0
    GeometryHeight            = 0.8
    GeometryOffset            = X:-64.0 Y:-64.0 Z:0

    AdditionalGeometry        = BOX
    GeometryName              = Plots
    GeometryMajorRadius       = 10.0
    GeometryMinorRadius       = 10.0
    GeometryHeight            = 0.8
    GeometryOffset            = X:-64.0 Y:64.0 Z:0

    AdditionalGeometry        = BOX
    GeometryName              = Plots
    GeometryMajorRadius       = 10.0
    GeometryMinorRadius       = 10.0
    GeometryHeight            = 0.8
    GeometryOffset            = X:0 Y:62.0 Z:0

    AdditionalGeometry        = BOX
    GeometryName              = Plots
    GeometryMajorRadius       = 10.0
    GeometryMinorRadius       = 10.0
    GeometryHeight            = 0.8
    GeometryOffset            = X:64.0 Y:64.0 Z:0

    GeometryIsSmall           = No
    Shadow                    = SHADOW_VOLUME

    GeometryContactPoint = X:-90        Y:82         Z:0            Repair
    GeometryContactPoint = X:84         Y:-79        Z:0            Repair
    GeometryContactPoint = X:5.576      Y:44.987     Z:0
    GeometryContactPoint = X:-38.348    Y:-42.113    Z:0
    GeometryContactPoint = X:-28.448    Y:-0.003     Z:75.14        Swoop
End


ChildObject MenFortress_Tutorial MenFortress

    BuildTime           = 15

    Behavior = CastleBehavior ModuleTag_castle
        CastleToUnpackForFaction  = Men Fortress_MenTutorial

        FilterValidOwnedEntries = ANY +STRUCTURE +WALK_ON_TOP_OF_WALL +BASE_FOUNDATION +TACTICAL_MARKER

        MaxCastleRadius = 90.0
        FadeTime = 2.0

        InstantUnpack = Yes
        KeepDeathKillsEverything = Yes

        EvaEnemyCastleSightedEvent = EnemyFortressSighted
    End
End