Object RohanGimli

    SelectPortrait = HPGimli
    ButtonImage    = HIGimli

    DescriptionStrategic = CONTROLBAR:LW_ToolTip_Gimli

    Draw = W3DScriptedModelDraw ModuleTag_01

    OkToChangeModelColor = Yes
    StaticModelLODMode   = Yes


        DefaultModelConditionState
            Model               = RUGimli_SKN
            Skeleton            = RUGimli_SKL
            WeaponLaunchBone    = TERTIARY AXE02
        End

        ModelConditionState = WEAPONSET_TOGGLE_1
            Model               = RUGimli_SKN
            Skeleton            = RUGimli_SKL
	    ParticleSysBone     = BAT_HEAD BladeMasterR1 FollowBone:Yes
	    ParticleSysBone     = BAT_HEAD BladeMasterR2 FollowBone:Yes
        End








        AnimationState        = STUNNED_FLAILING
            Animation           = FLYA
                AnimationName     = RUGimli_FLYA
                AnimationMode     = LOOP
                AnimationSpeedFactorRange    = 0.3 0.5
            End
            Flags               = RANDOMSTART
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End

        AnimationState        = DYING SPLATTED
            Animation           = LNDB
                AnimationName     = RUGimli_LNDA
                AnimationMode     = ONCE
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End

        AnimationState        = DYING
            Animation           = DIEA
                AnimationName     = RUGimli_DIEA
                AnimationMode     = ONCE
            End
            Animation           = DIEC
                AnimationName     = RUGimli_DIEC
                AnimationMode     = ONCE
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End

        AnimationState        = STUNNED_STANDING_UP
            Animation           = GTPA
                AnimationName     = RUGimli_GTPA
                AnimationMode     = ONCE
            End
        End

        AnimationState        = STUNNED
            Animation           = LNDA
                AnimationName     = RUGimli_LNDA
                AnimationMode     = ONCE
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End

        AnimationState                        = PARALYZED
            Animation
                AnimationName                = RUGimli_IDLA
                AnimationMode                = LOOP
            End
        End






    AnimationState        = MOVING FIRING_OR_PREATTACK_A
            ShareAnimation        = Yes
            Animation           = RunAndFire
                AnimationName       = RUGimli_ATRA
                AnimationMode       = LOOP
            End
            Flags               = RANDOMSTART
        End

        AnimationState                =    MOVING ATTACKING
            Animation                =    RUNB
                AnimationName        =    RUGimli_RUNB
                AnimationMode        =    LOOP
            End
            Flags                    =    RANDOMSTART

            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End

        AnimationState                =    MOVING
            Animation                =    RUNA
                AnimationName        =    RUGimli_RUNA
                AnimationMode        =    LOOP
            End
            Flags                    =    RANDOMSTART
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End




        AnimationState        =  FIRING_OR_PREATTACK_C
            Animation           = SPCA
                AnimationName     = RUGimli_SPCA
                AnimationMode     = ONCE
            End
            FrameForPristineBonePositions = 42

            BeginScript
                CurDrawableShowSubObject("AXE02")
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End

        AnimationState        =  FIRING_OR_PREATTACK_B
            Animation           = ATKA
                AnimationName     = RUGimli_ATKD
                AnimationMode     = ONCE
                UseWeaponTiming        = Yes
            End


            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End

        AnimationState        =  FIRING_OR_PREATTACK_A
            Animation           = ATKA
                AnimationName     = RUGimli_ATKA
                AnimationMode     = ONCE
                UseWeaponTiming        = Yes
            End
            Animation           = ATKB
                AnimationName     = RUGimli_ATKB
                AnimationMode     = ONCE
                UseWeaponTiming        = Yes
            End
            Animation           = ATKC
                AnimationName     = RUGimli_ATKC
                AnimationMode     = ONCE
                UseWeaponTiming        = Yes
            End


            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End


        AnimationState            = SPECIAL_WEAPON_TWO UNPACKING
            Animation            = GettingReadyToLeap
                AnimationName    = RUGimli_LEPA
                AnimationMode   = ONCE
            End
        End

        AnimationState        =  ABOUT_TO_HIT
        StateName            = State_AboutToHitGround
            Animation           = Leap
                AnimationName     = RUGimli_LEPC
                AnimationMode     = ONCE

            End
        End


        AnimationState        = THROWN_PROJECTILE
            Animation           = LEPB
                AnimationName     = RUGimli_LEPB
                AnimationMode     = LOOP
                AnimationBlendTime = 20
            End
        End



        AnimationState = HIT_REACTION
            Animation = Hit_Level_1_a
                AnimationName = RUGimli_HITA
                AnimationMode = ONCE
            End
        End




        AnimationState                = LEVELED
            Animation                = LevelUp
                AnimationName        = RUGimli_CHRB
                AnimationMode        = ONCE
            End
        End


        AnimationState            = EMOTION_CELEBRATING
            Animation           = CHRA
                AnimationName   = RUGimli_CHRA
                AnimationMode   = ONCE
            End
            Flags                    =    RESTART_ANIM_WHEN_COMPLETE
        End


        AnimationState            = EMOTION_TAUNTING
            Animation           = TNTA
                AnimationName   = RUGimli_TNTA
                AnimationMode   = ONCE
            End
            Animation           = TNTB
                AnimationName   = RUGimli_TNTB
                AnimationMode   = ONCE
            End
            Flags                    =    RESTART_ANIM_WHEN_COMPLETE
        End

        AnimationState                    = EMOTION_ALERT
            Animation                    = Ready
                AnimationName            = RUGimli_IDLA
                AnimationMode            = LOOP
                AnimationBlendTime  =   15
            End
            BeginScript
                CurDrawableHideSubObject("AXE02")
                if Prev == "State_AboutToHitGround" then CurDrawableSetTransitionAnimState("TRANS_AboutToHitGround_To_Idle") end
            EndScript

        End

        AnimationState            = RAISING_FLAG
            Animation           = CHRA
                AnimationName   = RUGimli_CHRA
                AnimationMode   = LOOP
            End
        End



        AnimationState                =    SELECTED
            StateName                =    AtAttentionIdle
            SimilarRestart            =   Yes
            Animation                =    ATNB
                AnimationName        =     RUGimli_ATNB
                AnimationMode        =    LOOP
            End
            BeginScript
                CurDrawableHideSubObject("AXE02")
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Idle" then CurDrawableSetTransitionAnimState("TRANS_Select") end
                if Prev == "AtAttentionIdle" then CurDrawableSetTransitionAnimState("TRANS_Select") end
                if Prev == "State_AboutToHitGround" then CurDrawableSetTransitionAnimState("TRANS_AboutToHitGround_To_Idle") end
            EndScript
        End



        IdleAnimationState
            StateName                = STATE_Idle
            Animation           = IDLB
                AnimationName     = RUGimli_IDLB
                AnimationMode     = ONCE
                AnimationPriority = 30
            End
            Animation           = IDLF
                AnimationName     = RUGimli_IDLF
                AnimationMode     = ONCE
                AnimationPriority = 5
            End
            Animation           = IDLD
                AnimationName     = RUGimli_IDLD
                AnimationMode     = ONCE
                AnimationPriority = 4
            End
            Animation           = IDLG
                AnimationName     = RUGimli_IDLG
                AnimationMode     = ONCE
                AnimationPriority = 2
            End
            Animation           = IDLH
                AnimationName     = RUGimli_IDLH
                AnimationMode     = ONCE
                AnimationPriority = 1
            End
            Animation           = IDLC
                AnimationName     = RUGimli_IDLC
                AnimationMode     = ONCE
                AnimationPriority = 1
            End
            Animation           = IDLE
                AnimationName     = RUGimli_IDLE
                AnimationMode     = ONCE
                AnimationPriority = 1
            End

            BeginScript
                CurDrawableHideSubObject("AXE02")
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
                if Prev == "AtAttentionIdle" then CurDrawableSetTransitionAnimState("TRANS_SelectedToIdle") end
                if Prev == "State_AboutToHitGround" then CurDrawableSetTransitionAnimState("TRANS_AboutToHitGround_To_Idle") end
            EndScript
        End




        TransitionState       = TRANS_EndDwarfToss
            Animation           = TOS4
                AnimationName     = RUGimli_TOS4
                AnimationMode     = ONCE
            End
        End

        TransitionState       = TRANS_SelectedToIdle
            Animation           = ATNC
                AnimationName     = RUGimli_ATNC
                AnimationMode     = ONCE
                AnimationSpeedFactorRange = 0.7 1.3
            End
        End

        TransitionState                =    TRANS_Select
            Animation                =    ATNA
                AnimationName        =     RUGimli_ATNA
                AnimationMode        =    ONCE
            End
        End

        TransitionState = TRANS_AboutToHitGround_To_Idle
            Animation = SplashAtEndOfJump
                AnimationName = RUGimli_LEPC
                AnimationMode = ONCE

            End
            Flags = MAINTAIN_FRAME_ACROSS_STATES
        End

    End




    Draw = W3DScriptedModelDraw Icon
        ModelConditionState = NONE
            Model                    = Icon02
        End
    End



    #include "..\..\..\includes\StunDrawModuleSmall.inc"


    Side                = Obsolete
    EditorSorting       = UNIT
    ThreatLevel         = GIMLI_THREAT_LEVEL
    TransportSlotCount  = TRANSPORTSLOTCOUNT_HERO
    BuildCost           = GIMLIDAG_COST
    BuildTime           = MEDIUM_HERO_BUILDTIME
    DisplayMeleeDamage  = GIMLIDAG_DAMAGE
    HeroSortOrder       = 40

    WeaponSet
        Conditions                = None
        Weapon                    = PRIMARY  RohanGimliAxe
        Weapon                    = TERTIARY RohanGimliAxeThrown
        AutoChooseSources         = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
        AutoChooseSources         = TERTIARY NONE
        ShareWeaponReloadTime     = Yes
    End

    WeaponSet
        Conditions                = WEAPONSET_TOGGLE_1
        Weapon                    = SECONDARY  RohanGimliSuperAxe
        Weapon                    = TERTIARY   RohanGimliAxeThrown
        AutoChooseSources         = SECONDARY FROM_PLAYER FROM_SCRIPT FROM_AI
        AutoChooseSources         = TERTIARY NONE
        ShareWeaponReloadTime     = Yes
    End


    ArmorSet
        Conditions      = None
        Armor           = MediumHeroArmor
        DamageFX        = NormalDamageFX
    End
	
    VisionRange = VISION_STANDARD_MELEE
    ShroudClearingRange = SHROUD_CLEAR_HERO

    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = 200
    VisionBonusPercentPerFoot = 1.0%

    BountyValue = ROHAN_GIMLI_BOUNTY_VALUE
    DisplayName = OBJECT:RohanGimli
    RecruitText = CONTROLBAR:RohanGimliRecruit
    ReviveText    = CONTROLBAR:RohanGimliRevive
    Hotkey        = CONTROLBAR:RohanGimliHotkey
    CrushableLevel = 2

    CommandSet  = RohanGimliCommandSet
    CommandPoints = 0



    AutoResolveUnitType = AutoResolveUnit_Hero
    AutoResolveCombatChain = AutoResolve_HeroCombatChain

    AutoResolveBody = AutoResolve_GimliBody

    AutoResolveArmor
        Armor = AutoResolve_GimliArmor
    End

    AutoResolveWeapon
        Weapon = AutoResolve_GimliWeapon
    End



    VoiceAttack                               = GimliVoiceAttack
    VoiceAttackCharge                         = GimliVoiceAttackCharge
    VoiceAttackMachine                        = GimliVoiceAttack
    VoiceAttackStructure                    = GimliVoiceAttack
    VoiceFear                                 = GimliVoiceHelpMe
    VoiceGuard                                = GimliVoiceMove
    VoiceMove                                = GimliVoiceMove
    VoiceMoveToCamp                            = GimliVoiceMove
    VoiceMoveWhileAttacking                    = GimliVoiceDisengage
    VoicePriority                            = 85
    VoiceRetreatToCastle                    = GimliVoiceRetreat
    VoiceSelect                                = GimliVoiceSelectMS
    VoiceSelectBattle                         = GimliVoiceSelectBattle

    SoundImpact                                = ImpactHorse


    UnitSpecificSounds
        VoiceGarrison                        = GimliVoiceGarrison
        VoiceEnterUnitElvenTransportShip    = GimliVoiceMove
        VoiceInitiateCaptureBuilding        = GimliVoiceMove
    End

    CrowdResponseKey = DwarfHero

    #include "..\..\..\Includes\StandardUnitEvaEvents.inc"

    EvaEventDieOwner = GimliDie

    Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
        Key = Humanoid_Male Dwarf Dwarf_Male Unit Infantry Hero
    End

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound:FootstepDirtA            Animation:RUGimli_SKL.RUGimli_RUNA    Frames:3 14
        AnimationSound = Sound:FootstepDirtA            Animation:RUGimli_SKL.RUGimli_RUNB    Frames:3 12

        AnimationSound = Sound:BodyFallSoldier            Animation:RUGimli_SKL.RUGimli_LNDA    Frames:2

        AnimationSound = Sound:BodyFallGenericNoArmor    Animation:RUGimli_SKL.RUGimli_DIEA    Frames:11
        AnimationSound = Sound:BodyFallGenericNoArmor    Animation:RUGimli_SKL.RUGimli_DIEC    Frames:59
    End




    RadarPriority = UNIT
    KindOf = PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE THROWN_OBJECT GIMLI HERO ARMY_SUMMARY ATTACK_NEEDS_LINE_OF_SIGHT HEAVY_MELEE_HITTER
    PathfindDiameter = 40.0

    Body = RespawnBody ModuleTag_RespawnBody
        CheerRadius                = EMOTION_CHEER_RADIUS
        MaxHealth                  = GIMLIDAG_HEALTH
        PermanentlyKilledByFilter  = NONE
        DodgePercent               = HERO_DODGE_PERCENT
    End

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_TheodenLeadership
        SpecialPowerTemplate = SpecialAbilityFakeLeadership
        TriggeredBy = Upgrade_Level_1
    End
    Behavior = SpecialPowerModule ModuleTag_TheodenLeadershipUpdate
        SpecialPowerTemplate      = SpecialAbilityFakeLeadership
        UpdateModuleStartsAttack  = No
        StartsPaused = Yes
    End

    Behavior = RespawnUpdate ModuleTag_RespawnUpdate
        DeathAnim                = DYING
        DeathFX                = FX_GimliDieToRespawn
        DeathAnimationTime        = 4100
        InitialSpawnFX            = FX_GimliInitialSpawn
        RespawnAnim                = LEVELED
        RespawnFX                = FX_GimliRespawn
        RespawnAnimationTime        = 2000
        AutoRespawnAtObjectFilter    = NONE +CASTLE_KEEP
        ButtonImage                = HIGimli_res

        RespawnRules =                AutoSpawn:No    Cost:GIMLIDAG_COST        Time:MEDIUM_HERO_RESPAWNTIME        Health:100%
    End

    Behavior = AutoHealBehavior ModuleTag_GimliHealing
        StartsActive = Yes
        HealingAmount = HERO_HEAL_AMOUNT
        HealingDelay = 1000
        StartHealingDelay = HERO_HEAL_DELAY
        HealOnlyIfNotInCombat = Yes
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = Hero
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = AIUpdateInterface ModuleTag_03
        AutoAcquireEnemiesWhenIdle   = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate          = 500
        HoldGroundCloseRangeDistance = 60
    End

    LocomotorSet
        Locomotor = RohanGimliLocomotor
        Condition = SET_NORMAL
        Speed     = NORMAL_DWARF_HERO_SPEED
    End

    Behavior = PhysicsBehavior ModuleTag_04
        GravityMult = 1.0
        AllowBouncing = No
        ShockStunnedTimeLow        = 1400
        ShockStunnedTimeHigh    = 2400
        ShockStandingTime        = 2600
    End

    Behavior = SlowDeathBehavior ModuleTag_05
        DeathTypes = ALL -KNOCKBACK
        SinkDelay = 3000
        SinkRate = 0.40
        DestructionDelay = 8000
        Sound = INITIAL GimliVoiceDie
    End

    Behavior = SquishCollide ModuleTag_06

    End

    Behavior = SlowDeathBehavior ModuleTag_07

        DeathTypes = NONE +KNOCKBACK
        SinkDelay = 3000
        SinkRate = 0.40
        DestructionDelay = 8000
    End

    Behavior = BezierProjectileBehavior ModuleTag_08

        FirstHeight = 50
        SecondHeight = 20
        FirstPercentIndent = 20%
        SecondPercentIndent = 70%
        TumbleRandomly = Yes

        CrushStyle = Yes

        BounceCount = 0

        FinalStuckTime = 1200

        GroundHitFX       = FX_GimliLeapLand
        GroundHitWeapon   = RohanGimliLeapWarhead
        PreLandingStateTime = 75
    End


    Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance       =    300
        TauntAndPointUpdateDelay    =    1000

        AddEmotion            =    Doom_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
        AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    Alert_Base
        AddEmotion            =    CheerForAboutToCrush_Base
     End





    Behavior = SpecialPowerModule ModuleTag_ZealotBoomAxeStarter
	SpecialPowerTemplate	    = SpecialAbilityGimliAxe
	UpdateModuleStartsAttack    = Yes
	InitiateSound		    = GimliAxeThrowClickMS
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_CreateAHeroAxeThrowUpdate
	SpecialPowerTemplate	= SpecialAbilityGimliAxe
	UnpackTime              = 1500
	PackTime                = 1000
	AwardXPForTriggering    = 0
	StartAbilityRange	= #SUBTRACT( GIMLI_THROW_RANGE 15 )
	ApproachRequiresLOS	= Yes
	SpecialWeapon		= RohanGimliAxeThrown
	WhichSpecialWeapon	= 1
    End

    Behavior = AutoAbilityBehavior ModuleTag_AxeThrowAutoAbility
	SpecialAbility	= SpecialAbilityGimliAxe
	ForbiddenStatus = INSIDE_GARRISON
	MaxScanRange	= #SUBTRACT( GIMLI_THROW_RANGE 50 )
	Query		= 15 ALL ENEMIES -STRUCTURE -WALL_UPGRADE -WALL_HUB -WALL_SEGMENT -DEFENSIVE_WALL -FS_BASE_DEFENSE
	Query           = 1 ANY +HERO +MONSTER
    End





    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_LeapEnabler
        SpecialPowerTemplate = SpecialAbilityGimliLeap
        TriggeredBy = Upgrade_Level_3
    End

    Behavior = SpecialPowerModule ModuleTag_LeapStarter
        SpecialPowerTemplate        = SpecialAbilityGimliLeap
        UpdateModuleStartsAttack    = Yes
        StartsPaused            = Yes
        InitiateSound            = GimliVoiceAttackLeap
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_LeapUpdate
        SpecialPowerTemplate    = SpecialAbilityGimliLeap
        UnpackTime              = 600
        PackTime                = 300
        AwardXPForTriggering    = 0
        MustFinishAbility       = Yes
        StartAbilityRange       = 100.0
        SpecialWeapon           = RohanGimliLeap
        BusyForDuration         = 2000
        WhichSpecialWeapon      = 2
        TriggerSound            = GimliLeapVoice
    End

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_KnifeEnabler
        SpecialPowerTemplate = SpecialAbilityGimliHeroMode
        TriggeredBy 	     = Upgrade_Level_5
    End

    Behavior = WeaponModeSpecialPowerUpdate ModuleTag_KnifeFighterPowerUpdate
        SpecialPowerTemplate    = SpecialAbilityGimliHeroMode
        Duration                = 30000
        AttributeModifier       = Slayer
        WeaponSetFlags          = WEAPONSET_TOGGLE_1
        StartsPaused            = Yes
    End

    Behavior = HitReactionBehavior HitReactionBehaviorModuleTag
        HitReactionLifeTimer1 = 2200
        HitReactionLifeTimer2 = 15
        HitReactionLifeTimer3 = 10

        HitReactionThreshold1 = 1.0
        HitReactionThreshold2 = 2500.0
        HitReactionThreshold3 = 5000.0
    End

    Behavior = AutoHealBehavior ModuleTag_ElvenGiftHealing
        StartsActive                = No
        TriggeredBy                 = Upgrade_ElvenGift
        HealingAmount               = ELVEN_GIFT_REGEN_AMOUNT
        HealingDelay                = ELVEN_GIFT_REGEN_DELAY
        StartHealingDelay           = HERO_HEAL_DELAY
        HealOnlyIfNotInCombat       = Yes
    End

    Behavior = AttributeModifierUpgrade ModuleTag_ElvenGiftBonus
        TriggeredBy = Upgrade_ElvenGift
        AttributeModifier = SpellBookElvenGifts
    End






    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End


    Behavior = AISpecialPowerUpdate GimliSlayerAI
        CommandButtonName = Command_SpecialAbilitySlayer
        SpecialPowerAIType = AI_SPECIAL_POWER_BASIC_SELF_BUFF
    End

    Behavior = AISpecialPowerUpdate GimliLeapAttackAI
        CommandButtonName = Command_RohanGimliLeap
        SpecialPowerAIType = AI_SPECIAL_POWER_RANGED_AOE_ATTACK
        SpecialPowerRadius = 100
    End

    Behavior = AISpecialPowerUpdate GimliAxeThrowAI
        CommandButtonName = Command_GimliAxeThrow
        SpecialPowerAIType = AI_SPECIAL_POWER_ENEMY_TYPE_KILLER
    End

    Geometry = CYLINDER
    GeometryMajorRadius = 5.6
    GeometryMinorRadius = 5.6
    GeometryHeight = 16.0
    GeometryIsSmall = Yes
    Shadow = SHADOW_DECAL
    ShadowSizeX = 19
    ShadowSizeY = 19
    ShadowTexture = ShadowI
End







Object DwarvenGimliMod


    SelectPortrait = HPGimliMod
    ButtonImage    = HIGimli

    DescriptionStrategic = CONTROLBAR:LW_ToolTip_SupportHero

    Draw = W3DScriptedModelDraw ModuleTag_01



        DefaultModelConditionState
            Model               = DUGimli_NEW
            Skeleton            = RUGimli_SKL
            WeaponLaunchBone    = TERTIARY AXE02
        End

        ModelConditionState     = WEAPONSET_TOGGLE_1
            Model               = DUGimli_NEW
            Skeleton            = RUGimli_SKL
	    ParticleSysBone     = BAT_HEAD BladeMasterR1 FollowBone:Yes
	    ParticleSysBone     = BAT_HEAD BladeMasterR2 FollowBone:Yes
        End






        AnimationState        = STUNNED_FLAILING
            Animation           = FLYA
                AnimationName     = RUGimli_FLYA
                AnimationMode     = LOOP
                AnimationSpeedFactorRange    = 0.3 0.5
            End
            Flags               = RANDOMSTART
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End

        AnimationState        = DYING SPLATTED DEATH_1
            Animation           = LNDB
                AnimationName     = RUGimli_LNDA
                AnimationMode     = ONCE
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End

        AnimationState        = DYING DEATH_1
            Animation           = DIEA
                AnimationName     = RUGimli_DIEA
                AnimationMode     = ONCE
            End
            Animation           = DIEC
                AnimationName     = RUGimli_DIEC
                AnimationMode     = ONCE
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End

        AnimationState        = DYING DEATH_2
             Animation           = FadeOut
                AnimationName     = RUGimli_IDLB
                AnimationMode     = LOOP
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End

        AnimationState        = STUNNED_STANDING_UP
            Animation           = GTPA
                AnimationName     = RUGimli_GTPA
                AnimationMode     = ONCE
            End
        End

        AnimationState        = STUNNED
            Animation           = LNDA
                AnimationName     = RUGimli_LNDA
                AnimationMode     = ONCE
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End

        AnimationState                        = PARALYZED
            Animation
                AnimationName                = RUGimli_IDLA
                AnimationMode                = LOOP
            End
        End





    AnimationState        = MOVING FIRING_OR_PREATTACK_A
            ShareAnimation        = Yes
            Animation           = RunAndFire
                AnimationName       = RUGimli_ATRA
                AnimationMode       = LOOP
            End
            Flags               = RANDOMSTART
        End

        AnimationState                =    MOVING ATTACKING
            Animation                =    RUNB
                AnimationName        =    RUGimli_RUNB
                AnimationMode        =    LOOP
            End
            Flags                    =    RANDOMSTART

            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End

        AnimationState                =    MOVING
            Animation                =    RUNA
                AnimationName        =    RUGimli_RUNA
                AnimationMode        =    LOOP
            End
            Flags                    =    RANDOMSTART

            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End






        AnimationState        =  FIRING_OR_PREATTACK_C
            Animation           = SPCA
                AnimationName     = RUGimli_SPCA
                AnimationMode     = ONCE

            End
            FrameForPristineBonePositions = 42

            BeginScript
                CurDrawableShowSubObject("AXE02")
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End

        AnimationState        =  FIRING_OR_PREATTACK_B
            Animation           = ATKA
                AnimationName     = RUGimli_ATKD
                AnimationMode     = ONCE
                UseWeaponTiming        = Yes
            End


            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End

        AnimationState        =  FIRING_OR_PREATTACK_A
            Animation           = ATKA
                AnimationName     = RUGimli_ATKA
                AnimationMode     = ONCE
                UseWeaponTiming        = Yes
            End
            Animation           = ATKB
                AnimationName     = RUGimli_ATKB
                AnimationMode     = ONCE
                UseWeaponTiming        = Yes
            End
            Animation           = ATKC
                AnimationName     = RUGimli_ATKC
                AnimationMode     = ONCE
                UseWeaponTiming        = Yes
            End


            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End


        AnimationState        =  SPECIAL_WEAPON_ONE
            Animation           = TNTA
                AnimationName   = RUGimli_TNTA
                AnimationMode   = ONCE
            End
            Animation           = TNTB
                AnimationName   = RUGimli_TNTB
                AnimationMode   = ONCE
            End
        End



        AnimationState            = SPECIAL_WEAPON_TWO UNPACKING
            Animation            = GettingReadyToLeap
                AnimationName    = RUGimli_LEPA
                AnimationMode   = ONCE
            End
        End

        AnimationState        =  ABOUT_TO_HIT
        StateName            = State_AboutToHitGround
            Animation           = Leap
                AnimationName     = RUGimli_LEPC
                AnimationMode     = ONCE

            End
        End


        AnimationState        = THROWN_PROJECTILE
            Animation           = LEPB
                AnimationName     = RUGimli_LEPB
                AnimationMode     = LOOP
                AnimationBlendTime = 20
            End
        End




        AnimationState = HIT_REACTION
            Animation = Hit_Level_1_a
                AnimationName = RUGimli_HITA
                AnimationMode = ONCE
            End
        End




        AnimationState                = LEVELED
            Animation                = LevelUp
                AnimationName        = RUGimli_CHRB
                AnimationMode        = ONCE
            End
        End


        AnimationState            = EMOTION_CELEBRATING
            Animation           = CHRA
                AnimationName   = RUGimli_CHRA
                AnimationMode   = ONCE
            End
            Flags                    =    RESTART_ANIM_WHEN_COMPLETE
        End


        AnimationState            = EMOTION_TAUNTING
            Animation           = TNTA
                AnimationName   = RUGimli_TNTA
                AnimationMode   = ONCE
            End
            Animation           = TNTB
                AnimationName   = RUGimli_TNTB
                AnimationMode   = ONCE
            End
            Flags                    =    RESTART_ANIM_WHEN_COMPLETE
        End

        AnimationState                    = EMOTION_ALERT
            Animation                    = Ready
                AnimationName            = RUGimli_IDLA
                AnimationMode            = LOOP
                AnimationBlendTime  =   15
            End
            BeginScript
                CurDrawableHideSubObject("AXE02")



                if Prev == "State_AboutToHitGround" then CurDrawableSetTransitionAnimState("TRANS_AboutToHitGround_To_Idle") end
            EndScript

        End

        AnimationState            = RAISING_FLAG
            Animation           = CHRA
                AnimationName   = RUGimli_CHRA
                AnimationMode   = LOOP
            End
        End



        AnimationState                =    SELECTED
            StateName                =    AtAttentionIdle
            SimilarRestart            =   Yes
            Animation                =    ATNB
                AnimationName        =     RUGimli_ATNB
                AnimationMode        =    LOOP
            End
            BeginScript
                CurDrawableHideSubObject("AXE02")
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Idle" then CurDrawableSetTransitionAnimState("TRANS_Select") end
                if Prev == "AtAttentionIdle" then CurDrawableSetTransitionAnimState("TRANS_Select") end
                if Prev == "State_AboutToHitGround" then CurDrawableSetTransitionAnimState("TRANS_AboutToHitGround_To_Idle") end
            EndScript
        End



        IdleAnimationState
            StateName                = STATE_Idle
            Animation           = IDLB
                AnimationName     = RUGimli_IDLB
                AnimationMode     = ONCE
                AnimationPriority = 20
            End
            Animation           = IDLF
                AnimationName     = RUGimli_IDLF
                AnimationMode     = ONCE
                AnimationPriority = 5
            End
            Animation           = IDLD
                AnimationName     = RUGimli_IDLD
                AnimationMode     = ONCE
                AnimationPriority = 4
            End
            Animation           = IDLG
                AnimationName     = RUGimli_IDLG
                AnimationMode     = ONCE
                AnimationPriority = 3
            End
            Animation           = IDLH
                AnimationName     = RUGimli_IDLH
                AnimationMode     = ONCE
                AnimationPriority = 3
            End
            Animation           = IDLC
                AnimationName     = RUGimli_IDLC
                AnimationMode     = ONCE
                AnimationPriority = 3
            End
            Animation           = IDLE
                AnimationName     = RUGimli_IDLE
                AnimationMode     = ONCE
                AnimationPriority = 3
            End

            BeginScript
                CurDrawableHideSubObject("AXE02")
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
                if Prev == "AtAttentionIdle" then CurDrawableSetTransitionAnimState("TRANS_SelectedToIdle") end
                if Prev == "State_AboutToHitGround" then CurDrawableSetTransitionAnimState("TRANS_AboutToHitGround_To_Idle") end
            EndScript
        End




        TransitionState       = TRANS_EndDwarfToss
            Animation           = TOS4
                AnimationName     = RUGimli_TOS4
                AnimationMode     = ONCE
            End
        End

        TransitionState       = TRANS_SelectedToIdle
            Animation           = ATNC
                AnimationName     = RUGimli_ATNC
                AnimationMode     = ONCE
                AnimationSpeedFactorRange = 0.7 1.3
            End
        End

        TransitionState                =    TRANS_Select
            Animation                =    ATNA
                AnimationName        =     RUGimli_ATNA
                AnimationMode        =    ONCE
            End
        End

        TransitionState = TRANS_AboutToHitGround_To_Idle
            Animation = SplashAtEndOfJump
                AnimationName = RUGimli_LEPC
                AnimationMode = ONCE

            End
            Flags = MAINTAIN_FRAME_ACROSS_STATES
        End

    End


    Draw = W3DScriptedModelDraw Icon
        ModelConditionState = NONE
            Model           = bbox
        End
    End




    #include "..\..\..\includes\StunDrawModuleSmall.inc"


    Side = Dwarves
    EditorSorting = UNIT
    ThreatLevel = GIMLI_THREAT_LEVEL
    TransportSlotCount = TRANSPORTSLOTCOUNT_HERO
    BuildCost           = GIMLIDAG_COST
    BuildTime           = MEDIUM_HERO_BUILDTIME
    DisplayMeleeDamage = GIMLIDAG_DAMAGE
    HeroSortOrder = 40
    Scale            = 0.91

    WeaponSet
        Conditions                = None
        Weapon                    = PRIMARY   RohanGimliAxeMod
        Weapon                    = TERTIARY  RohanGimliAxeThrown
        AutoChooseSources         = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
        AutoChooseSources         = TERTIARY NONE
        ShareWeaponReloadTime     = Yes
    End

    WeaponSet
        Conditions                = WEAPONSET_TOGGLE_1
        Weapon                    = SECONDARY  RohanGimliSuperAxeMod
        Weapon                    = TERTIARY   RohanGimliAxeThrown
        AutoChooseSources         = SECONDARY FROM_PLAYER FROM_SCRIPT FROM_AI
        AutoChooseSources         = TERTIARY NONE
        ShareWeaponReloadTime     = Yes
    End


    ArmorSet
        Conditions      = None
        Armor           = StrongHeroArmor
        DamageFX        = NormalDamageFX
    End

    ArmorSet
        Conditions      = PLAYER_UPGRADE
        Armor           = VeryStrongHeroArmor
        DamageFX        = NormalDamageFX
    End

    VisionRange = 200
    ShroudClearingRange = 300

    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = 200
    VisionBonusPercentPerFoot = 1.0%

    BountyValue = ROHAN_GIMLI_BOUNTY_VALUE
    DisplayName = OBJECT:RohanGimli
    RecruitText = CONTROLBAR:RohanGimliRecruit
    ReviveText    = CONTROLBAR:RohanGimliRevive
    Hotkey        = CONTROLBAR:RohanGimliHotkey
    CrushableLevel = 2


    CommandSet  = RohanGimliModCommandSet
    CommandPoints = 0

        Behavior = CommandSetUpgrade ModuleTag_GimliMithril
        TriggeredBy        = Upgrade_DwarvenMithrilMailHeroes
        CommandSet        = GimliMithrilCommandSet
    End



    AutoResolveUnitType = AutoResolveUnit_Hero
    AutoResolveCombatChain = AutoResolve_HeroCombatChain

    AutoResolveBody = AutoResolve_GimliBody

    AutoResolveArmor
        Armor = AutoResolve_GimliArmor
    End

    AutoResolveWeapon
        Weapon = AutoResolve_GimliWeapon
    End



    VoiceAttack                                = GimliVoiceAttack
    VoiceAttackCharge                        = GimliVoiceAttackCharge
    VoiceAttackMachine                        = GimliVoiceAttack
    VoiceAttackStructure                    = GimliVoiceAttack
    VoiceCreated                            = GimliVoiceSalute
    VoiceFear                                 = GimliVoiceHelpMe
    VoiceGuard                                = GimliVoiceMove
    VoiceMove                                = GimliVoiceMove
    VoiceMoveToCamp                            = GimliVoiceMove
    VoiceMoveWhileAttacking                    = GimliVoiceDisengage
    VoicePriority                            = 85
    VoiceRetreatToCastle                    = GimliVoiceRetreat
    VoiceSelect                                = GimliVoiceSelectMS
    VoiceSelectBattle                         = GimliVoiceSelectBattle

    SoundImpact                                = ImpactHorse

    UnitSpecificSounds
        VoiceGarrison                        = GimliVoiceGarrison
        VoiceEnterUnitElvenTransportShip    = GimliVoiceMove
        VoiceInitiateCaptureBuilding        = GimliVoiceMove
    End

    CrowdResponseKey = DwarfHero

    #include "..\..\..\Includes\StandardUnitEvaEvents.inc"

    EvaEventDieOwner = GimliDie

    Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
        Key = Humanoid_Male Dwarf Dwarf_Male Unit Infantry Hero
    End

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound:FootstepDirtA            Animation:RUGimli_SKL.RUGimli_RUNA    Frames:3 14
        AnimationSound = Sound:FootstepDirtA            Animation:RUGimli_SKL.RUGimli_RUNB    Frames:3 12

        AnimationSound = Sound:BodyFallSoldier            Animation:RUGimli_SKL.RUGimli_LNDA    Frames:2

        AnimationSound = Sound:BodyFallGenericNoArmor    Animation:RUGimli_SKL.RUGimli_DIEA    Frames:11
        AnimationSound = Sound:BodyFallGenericNoArmor    Animation:RUGimli_SKL.RUGimli_DIEC    Frames:59
    End




    RadarPriority = UNIT
    KindOf = PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE THROWN_OBJECT GIMLI HERO ARMY_SUMMARY ATTACK_NEEDS_LINE_OF_SIGHT HEAVY_MELEE_HITTER
    PathfindDiameter = 40.0

    Body = DelayedDeathBody ModuleTag_DelayedDeathBody
        CheerRadius                     = EMOTION_CHEER_RADIUS
        MaxHealth                       = GIMLIDAG_HEALTH
        MaxHealthDamaged                = 2500
        MaxHealthReallyDamaged          = 100
        DelayedDeathTime                = 20000
        DelayedDeathPrerequisiteUpgrade = Upgrade_EisernerWille
        PermanentlyKilledByFilter       = NONE
        DodgePercent               = HERO_DODGE_PERCENT
    End

    Behavior = LifetimeUpdate ModuleTag_LifeTime
        WaitForWakeUp = Yes
    End


    Behavior = RespawnUpdate ModuleTag_RespawnUpdate
        DeathAnim                = DYING
        DeathAnimationTime        = 4100
        RespawnAnim                = LEVELED
        RespawnAnimationTime        = 2000
        AutoRespawnAtObjectFilter    = NONE +CASTLE_KEEP
        ButtonImage                = HIGimli

        RespawnRules =    AutoSpawn:No           Cost:GIMLIDAG_COST       Time:MEDIUM_HERO_RESPAWNTIME        Health:100%
   End


    Behavior = AutoHealBehavior ModuleTag_GimliHealing
        StartsActive = Yes
        HealingAmount = HERO_HEAL_AMOUNT
        HealingDelay = 1000
        StartHealingDelay = HERO_HEAL_DELAY
        HealOnlyIfNotInCombat = Yes
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = Hero
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = AIUpdateInterface ModuleTag_03
        AutoAcquireEnemiesWhenIdle = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate        = 500
        HoldGroundCloseRangeDistance = 60
    End

    LocomotorSet
        Locomotor = RohanGimliLocomotor
        Condition = SET_NORMAL
        Speed     = NORMAL_DWARF_HERO_SPEED
    End


    Behavior = PhysicsBehavior ModuleTag_04
        GravityMult = 1.0
        AllowBouncing = No
        ShockStunnedTimeLow        = 1400
        ShockStunnedTimeHigh    = 2400
        ShockStandingTime        = 2600
    End










    Behavior = SlowDeathBehavior ModuleTag_05
        DeathTypes = ALL -KNOCKBACK -FADED
        SinkDelay = 3000
        SinkRate = 0.40
        DestructionDelay = 8000
        Sound = INITIAL GimliVoiceDie
        DeathFlags = DEATH_1
    End

      Behavior = SlowDeathBehavior ModuleTag_FadeDeath
        DeathTypes = NONE +FADED
        FadeDelay = 0
        FadeTime = 2500
        DestructionDelay = 2500
        Sound = INITIAL SpellGenericUnsummonFasterMS
        DeathFlags = DEATH_2
    End

    Behavior = SquishCollide ModuleTag_06

    End

    Behavior = SlowDeathBehavior ModuleTag_07

        DeathTypes = NONE +KNOCKBACK
        SinkDelay = 3000
        SinkRate = 0.40
        DestructionDelay = 8000
    End

    Behavior = BezierProjectileBehavior ModuleTag_08

        FirstHeight = 50
        SecondHeight = 20
        FirstPercentIndent = 20%
        SecondPercentIndent = 70%
        TumbleRandomly = Yes

        CrushStyle = Yes

        BounceCount = 0

        FinalStuckTime = 1200

        GroundHitFX       = FX_GimliLeapLand
        GroundHitWeapon   = RohanGimliLeapWarheadMod
        PreLandingStateTime = 75
    End


    Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance       =    300
        TauntAndPointUpdateDelay    =    1000

        AddEmotion            =    Doom_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
        AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    Alert_Base
        AddEmotion            =    CheerForAboutToCrush_Base
     End





    Behavior = SpecialPowerModule ModuleTag_ZealotBoomAxeStarter
	SpecialPowerTemplate	    = SpecialAbilityGimliAxe
	UpdateModuleStartsAttack    = Yes
	InitiateSound		    = GimliAxeThrowClickMS
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_CreateAHeroAxeThrowUpdate
	SpecialPowerTemplate	= SpecialAbilityGimliAxe
	UnpackTime              = 1500
	PackTime                = 1000
	AwardXPForTriggering    = 0
	StartAbilityRange	= #SUBTRACT( GIMLI_THROW_RANGE 15 )
	ApproachRequiresLOS	= Yes
	SpecialWeapon		= RohanGimliAxeThrown
	WhichSpecialWeapon	= 1
    End

    Behavior = AutoAbilityBehavior ModuleTag_AxeThrowAutoAbility
	SpecialAbility	= SpecialAbilityGimliAxe
	ForbiddenStatus = INSIDE_GARRISON
	MaxScanRange	= #SUBTRACT( GIMLI_THROW_RANGE 50 )
	Query		= 15 ALL ENEMIES -STRUCTURE -WALL_UPGRADE -WALL_HUB -WALL_SEGMENT -DEFENSIVE_WALL -FS_BASE_DEFENSE
	Query           = 1 ANY +HERO +MONSTER
    End





    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_LeapEnabler
        SpecialPowerTemplate     = SpecialAbilityGimliLeap
        TriggeredBy              = Upgrade_Level_2
    End

    Behavior = SpecialPowerModule ModuleTag_LeapStarter
        SpecialPowerTemplate     = SpecialAbilityGimliLeap
        UpdateModuleStartsAttack = Yes
        StartsPaused             = Yes
        InitiateSound            = GimliVoiceAttackLeap
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_LeapUpdate
        SpecialPowerTemplate    = SpecialAbilityGimliLeap
        UnpackTime              = 600
        PackTime                = 300
        AwardXPForTriggering    = 0
        StartAbilityRange       = 100.0
        SpecialWeapon           = RohanGimliLeapMod
        BusyForDuration         = 2000
        WhichSpecialWeapon      = 2
        TriggerSound            = GimliLeapVoice
    End







    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_SturheitEnabler
        SpecialPowerTemplate     = SpecialAbilityGimliSturheit
        TriggeredBy              = Upgrade_Level_8
        ObeyRechageOnTrigger     = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_SturheitStarter
        SpecialPowerTemplate      = SpecialAbilityGimliSturheit
        UpdateModuleStartsAttack  = Yes
        StartsPaused              = Yes

    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_SturheitWeaponFireUpdate
        SpecialPowerTemplate      = SpecialAbilityGimliSturheit
        SpecialWeapon             = GimliSturheitWeapon
        WhichSpecialWeapon        = 1
        StartAbilityRange         = 10.0
        SkipContinue              = Yes
        UnpackTime                = 1000
        PackTime                  = 2000
        MustFinishAbility         = Yes
    End

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_GimliDiplomacynabler
        SpecialPowerTemplate     = SpecialAbilityGimliDiplomacy
        TriggeredBy              = Upgrade_DwarvenMithrilMailHeroes Upgrade_Level_5
        RequiresAllTriggers = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_MachtStarter
        SpecialPowerTemplate     = SpecialAbilityGimliDiplomacy
        UpdateModuleStartsAttack = Yes
        StartsPaused             = Yes
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_MachtUpdate
        SpecialPowerTemplate     = SpecialAbilityGimliDiplomacy
        SkipContinue             = Yes
        UnpackTime               = 1100
        PreparationTime          = 1
        PersistentPrepTime       = 500
        PackTime                 = 500
        MustFinishAbility        = Yes
        AwardXPForTriggering     = 0
        StartAbilityRange        = 150
        SpecialWeapon            = GimliDiplomacyPingWeapon
        WhichSpecialWeapon       = 3
    End

    Behavior = CostModifierUpgrade ModuleTag_CostModifier2
        StartsActive    = No
        ObjectFilter    = NONE +AglarondHunterHorde +AglarondPikeHorde +AglarondCavalaryHorde
        Percentage      = -25%
        TriggeredBy     = Upgrade_Level_5 Upgrade_DwarvenMithrilMailHeroes
        RequiresAllTriggers = Yes
    End

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_KnifeEnabler
        SpecialPowerTemplate = SpecialAbilityGimliHeroMode
        TriggeredBy = Upgrade_Level_5
    End

    Behavior = WeaponModeSpecialPowerUpdate ModuleTag_KnifeFighterPowerUpdate
        SpecialPowerTemplate    = SpecialAbilityGimliHeroMode
        Duration                = 30000
        AttributeModifier        = SlayerGimliMod

        WeaponSetFlags            = WEAPONSET_TOGGLE_1
        StartsPaused            = Yes

    End

    Behavior = HitReactionBehavior HitReactionBehaviorModuleTag
        HitReactionLifeTimer1 = 2200
        HitReactionLifeTimer2 = 15
        HitReactionLifeTimer3 = 10

        HitReactionThreshold1 = 1.0
        HitReactionThreshold2 = 2500.0
        HitReactionThreshold3 = 5000.0
    End

    Behavior = AutoHealBehavior ModuleTag_ElvenGiftHealing
        StartsActive                = No
        TriggeredBy                    = Upgrade_ElvenGift
        HealingAmount                = ELVEN_GIFT_REGEN_AMOUNT
        HealingDelay                = ELVEN_GIFT_REGEN_DELAY
        StartHealingDelay = HERO_HEAL_DELAY
        HealOnlyIfNotInCombat = Yes
    End


    Behavior = ArmorUpgrade ModuleTag_ArmorUpgradeMithril
        TriggeredBy     = Upgrade_DwarvenMithrilMailHeroes
        ArmorSetFlag    = PLAYER_UPGRADE
    End

    Behavior = SubObjectsUpgrade ModuleTag_MithrilSkinwelchsel
        TriggeredBy     = Upgrade_DwarvenMithrilMailHeroes
        UpgradeTexture  = rugimli.tga 0 rugimli_ha.tga
        ExcludeSubobjects = AXE02
    End

    Behavior = SubObjectsUpgrade SiegeHammer_UpgradeGuardian
        TriggeredBy       = Upgrade_DwarvenMithrilMailHeroes
        HideSubObjects    = AXE02
    End






    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Behavior = AISpecialPowerUpdate GimliSlayerAI
        CommandButtonName = Command_SpecialAbilityGimliOrkschlachter
        SpecialPowerAIType = AI_SPECIAL_POWER_BASIC_SELF_BUFF
    End

    Behavior = AISpecialPowerUpdate GimliLeapAttackAI
        CommandButtonName = Command_RohanGimliLeap
        SpecialPowerAIType = AI_SPECIAL_POWER_RANGED_AOE_ATTACK
        SpecialPowerRadius = 100
    End

    Behavior = AISpecialPowerUpdate GimliAxeThrowAI
        CommandButtonName = Command_GimliAxeThrow
        SpecialPowerAIType = AI_SPECIAL_POWER_ENEMY_TYPE_KILLER
    End

    Behavior = AISpecialPowerUpdate GandalfWordOfPowerAI
        CommandButtonName = Command_SpecialAbilityGimliSturheit
        SpecialPowerAIType = AI_SPECIAL_POWER_BASIC_SELF_BUFF
        SpecialPowerRadius = 150
    End


    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End


    Geometry = CYLINDER
    GeometryMajorRadius = 5.6
    GeometryMinorRadius = 5.6
    GeometryHeight = 16.0
    GeometryIsSmall = Yes
  Shadow = SHADOW_DECAL
  ShadowSizeX = 19
  ShadowSizeY = 19
  ShadowTexture = ShadowI
End


ChildObject DwarvenGimliMod_forMM DwarvenGimliMod

    MaxSimultaneousOfType    = 1

    Behavior = RespawnUpdate ModuleTag_RespawnUpdate
    End
End

Object DwarvenGimli



    SelectPortrait = HPGimliMod
    ButtonImage    = HIGimli

    DescriptionStrategic = CONTROLBAR:LW_ToolTip_SupportHero

    Draw = W3DScriptedModelDraw ModuleTag_01



        DefaultModelConditionState
            Model               = DUGimli_NEW
            Skeleton            = RUGimli_SKL
            WeaponLaunchBone    = TERTIARY AXE02
        End

        ModelConditionState     = WEAPONSET_TOGGLE_1
            Model               = DUGimli_NEW
            Skeleton            = RUGimli_SKL
	    ParticleSysBone     = BAT_HEAD BladeMasterR1 FollowBone:Yes
	    ParticleSysBone     = BAT_HEAD BladeMasterR2 FollowBone:Yes
        End






        AnimationState        = STUNNED_FLAILING
            Animation           = FLYA
                AnimationName     = RUGimli_FLYA
                AnimationMode     = LOOP
                AnimationSpeedFactorRange    = 0.3 0.5
            End
            Flags               = RANDOMSTART
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End

        AnimationState        = DYING SPLATTED DEATH_1
            Animation           = LNDB
                AnimationName     = RUGimli_LNDA
                AnimationMode     = ONCE
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End

        AnimationState        = DYING DEATH_1
            Animation           = DIEA
                AnimationName     = RUGimli_DIEA
                AnimationMode     = ONCE
            End
            Animation           = DIEC
                AnimationName     = RUGimli_DIEC
                AnimationMode     = ONCE
            End




            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End

        AnimationState        = DYING DEATH_2
             Animation           = FadeOut
                AnimationName     = RUGimli_IDLB
                AnimationMode     = LOOP
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End

        AnimationState        = STUNNED_STANDING_UP
            Animation           = GTPA
                AnimationName     = RUGimli_GTPA
                AnimationMode     = ONCE
            End
        End

        AnimationState        = STUNNED
            Animation           = LNDA
                AnimationName     = RUGimli_LNDA
                AnimationMode     = ONCE
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End

        AnimationState                        = PARALYZED
            Animation
                AnimationName                = RUGimli_IDLA
                AnimationMode                = LOOP
            End
        End






    AnimationState        = MOVING FIRING_OR_PREATTACK_A
            ShareAnimation        = Yes
            Animation           = RunAndFire
                AnimationName       = RUGimli_ATRA
                AnimationMode       = LOOP
            End
            Flags               = RANDOMSTART
        End













































        AnimationState                =    MOVING ATTACKING
            Animation                =    RUNB
                AnimationName        =    RUGimli_RUNB
                AnimationMode        =    LOOP
            End
            Flags                    =    RANDOMSTART

            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End

        AnimationState                =    MOVING
            Animation                =    RUNA
                AnimationName        =    RUGimli_RUNA
                AnimationMode        =    LOOP
            End
            Flags                    =    RANDOMSTART

            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End






        AnimationState        =  FIRING_OR_PREATTACK_C
            Animation           = SPCA
                AnimationName     = RUGimli_SPCA
                AnimationMode     = ONCE

            End
            FrameForPristineBonePositions = 42

            BeginScript
                CurDrawableShowSubObject("AXE02")
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End

        AnimationState        =  FIRING_OR_PREATTACK_B
            Animation           = ATKA
                AnimationName     = RUGimli_ATKD
                AnimationMode     = ONCE
                UseWeaponTiming        = Yes
            End


            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End

        AnimationState        =  FIRING_OR_PREATTACK_A
            Animation           = ATKA
                AnimationName     = RUGimli_ATKA
                AnimationMode     = ONCE
                UseWeaponTiming        = Yes
            End
            Animation           = ATKB
                AnimationName     = RUGimli_ATKB
                AnimationMode     = ONCE
                UseWeaponTiming        = Yes
            End
            Animation           = ATKC
                AnimationName     = RUGimli_ATKC
                AnimationMode     = ONCE
                UseWeaponTiming        = Yes
            End


            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End


        AnimationState        =  SPECIAL_WEAPON_ONE
            Animation           = TNTA
                AnimationName   = RUGimli_TNTA
                AnimationMode   = ONCE
            End
            Animation           = TNTB
                AnimationName   = RUGimli_TNTB
                AnimationMode   = ONCE
            End
        End



        AnimationState            = SPECIAL_WEAPON_TWO UNPACKING
            Animation            = GettingReadyToLeap
                AnimationName    = RUGimli_LEPA
                AnimationMode   = ONCE
            End
        End

        AnimationState        =  ABOUT_TO_HIT
        StateName            = State_AboutToHitGround
            Animation           = Leap
                AnimationName     = RUGimli_LEPC
                AnimationMode     = ONCE

            End
        End


        AnimationState        = THROWN_PROJECTILE
            Animation           = LEPB
                AnimationName     = RUGimli_LEPB
                AnimationMode     = LOOP
                AnimationBlendTime = 20
            End
        End



        AnimationState = HIT_REACTION
            Animation = Hit_Level_1_a
                AnimationName = RUGimli_HITA
                AnimationMode = ONCE
            End
        End




        AnimationState                = LEVELED
            Animation                = LevelUp
                AnimationName        = RUGimli_CHRB
                AnimationMode        = ONCE
            End
        End


        AnimationState            = EMOTION_CELEBRATING
            Animation           = CHRA
                AnimationName   = RUGimli_CHRA
                AnimationMode   = ONCE
            End
            Flags                    =    RESTART_ANIM_WHEN_COMPLETE
        End


        AnimationState            = EMOTION_TAUNTING
            Animation           = TNTA
                AnimationName   = RUGimli_TNTA
                AnimationMode   = ONCE
            End
            Animation           = TNTB
                AnimationName   = RUGimli_TNTB
                AnimationMode   = ONCE
            End
            Flags                    =    RESTART_ANIM_WHEN_COMPLETE
        End

        AnimationState                    = EMOTION_ALERT
            Animation                    = Ready
                AnimationName            = RUGimli_IDLA
                AnimationMode            = LOOP
                AnimationBlendTime  =   15
            End
            BeginScript
                CurDrawableHideSubObject("AXE02")



                if Prev == "State_AboutToHitGround" then CurDrawableSetTransitionAnimState("TRANS_AboutToHitGround_To_Idle") end
            EndScript

        End

        AnimationState            = RAISING_FLAG
            Animation           = CHRA
                AnimationName   = RUGimli_CHRA
                AnimationMode   = LOOP
            End
        End



        AnimationState                =    SELECTED
            StateName                =    AtAttentionIdle
            SimilarRestart            =   Yes
            Animation                =    ATNB
                AnimationName        =     RUGimli_ATNB
                AnimationMode        =    LOOP
            End
            BeginScript
                CurDrawableHideSubObject("AXE02")
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Idle" then CurDrawableSetTransitionAnimState("TRANS_Select") end
                if Prev == "AtAttentionIdle" then CurDrawableSetTransitionAnimState("TRANS_Select") end
                if Prev == "State_AboutToHitGround" then CurDrawableSetTransitionAnimState("TRANS_AboutToHitGround_To_Idle") end
            EndScript
        End



        IdleAnimationState
            StateName                = STATE_Idle
            Animation           = IDLB
                AnimationName     = RUGimli_IDLB
                AnimationMode     = ONCE
                AnimationPriority = 20
            End
            Animation           = IDLF
                AnimationName     = RUGimli_IDLF
                AnimationMode     = ONCE
                AnimationPriority = 5
            End
            Animation           = IDLD
                AnimationName     = RUGimli_IDLD
                AnimationMode     = ONCE
                AnimationPriority = 4
            End
            Animation           = IDLG
                AnimationName     = RUGimli_IDLG
                AnimationMode     = ONCE
                AnimationPriority = 3
            End
            Animation           = IDLH
                AnimationName     = RUGimli_IDLH
                AnimationMode     = ONCE
                AnimationPriority = 3
            End
            Animation           = IDLC
                AnimationName     = RUGimli_IDLC
                AnimationMode     = ONCE
                AnimationPriority = 3
            End
            Animation           = IDLE
                AnimationName     = RUGimli_IDLE
                AnimationMode     = ONCE
                AnimationPriority = 3
            End

            BeginScript
                CurDrawableHideSubObject("AXE02")
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
                if Prev == "AtAttentionIdle" then CurDrawableSetTransitionAnimState("TRANS_SelectedToIdle") end
                if Prev == "State_AboutToHitGround" then CurDrawableSetTransitionAnimState("TRANS_AboutToHitGround_To_Idle") end
            EndScript
        End




        TransitionState       = TRANS_EndDwarfToss
            Animation           = TOS4
                AnimationName     = RUGimli_TOS4
                AnimationMode     = ONCE
            End
        End

        TransitionState       = TRANS_SelectedToIdle
            Animation           = ATNC
                AnimationName     = RUGimli_ATNC
                AnimationMode     = ONCE
                AnimationSpeedFactorRange = 0.7 1.3
            End
        End

        TransitionState                =    TRANS_Select
            Animation                =    ATNA
                AnimationName        =     RUGimli_ATNA
                AnimationMode        =    ONCE
            End
        End

        TransitionState = TRANS_AboutToHitGround_To_Idle
            Animation = SplashAtEndOfJump
                AnimationName = RUGimli_LEPC
                AnimationMode = ONCE

            End
            Flags = MAINTAIN_FRAME_ACROSS_STATES
        End

    End


    Draw = W3DScriptedModelDraw Icon
        ModelConditionState = NONE
            Model           = bbox
        End
    End




    #include "..\..\..\includes\StunDrawModuleSmall.inc"


    Side = Dwarves
    EditorSorting = UNIT
    ThreatLevel = GIMLI_THREAT_LEVEL
    TransportSlotCount = TRANSPORTSLOTCOUNT_HERO
    BuildCost           = GIMLIDAG_COST
    BuildTime           = MEDIUM_HERO_BUILDTIME

    DisplayMeleeDamage = GIMLIDAG_DAMAGE
    HeroSortOrder = 40
    Scale            = 0.91

    WeaponSet
        Conditions                = None
        Weapon                    = PRIMARY  RohanGimliAxeMod
        Weapon                    = TERTIARY    RohanGimliAxeThrown
        AutoChooseSources        = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
        AutoChooseSources        = TERTIARY NONE
        ShareWeaponReloadTime    = Yes
    End

    WeaponSet
        Conditions                = WEAPONSET_TOGGLE_1
        Weapon                    = SECONDARY  RohanGimliSuperAxeMod
        Weapon                    = TERTIARY    RohanGimliAxeThrown
        AutoChooseSources        = SECONDARY FROM_PLAYER FROM_SCRIPT FROM_AI
        AutoChooseSources        = TERTIARY NONE
        ShareWeaponReloadTime    = Yes
    End


    ArmorSet
        Conditions      = None
        Armor           = MediumHeroArmor
        DamageFX        = NormalDamageFX
    End

    ArmorSet
        Conditions      = PLAYER_UPGRADE
        Armor           = StrongHeroArmor
        DamageFX        = NormalDamageFX
    End

    VisionRange = 200
    ShroudClearingRange = 300

    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = 200
    VisionBonusPercentPerFoot = 1.0%

    BountyValue = ROHAN_GIMLI_BOUNTY_VALUE
    DisplayName = OBJECT:RohanGimli
    RecruitText = CONTROLBAR:RohanGimliRecruit
    ReviveText    = CONTROLBAR:RohanGimliRevive
    Hotkey        = CONTROLBAR:RohanGimliHotkey
    CrushableLevel = 2


    CommandSet  = RohanGimliModCommandSet
    CommandPoints = 0

    Behavior = CommandSetUpgrade ModuleTag_GimliMithril
        TriggeredBy        = Upgrade_DwarvenMithrilMailHeroes
        CommandSet        = GimliMithrilCommandSet
    End



    AutoResolveUnitType = AutoResolveUnit_Hero
    AutoResolveCombatChain = AutoResolve_HeroCombatChain

    AutoResolveBody = AutoResolve_GimliBody

    AutoResolveArmor
        Armor = AutoResolve_GimliArmor
    End

    AutoResolveWeapon
        Weapon = AutoResolve_GimliWeapon
    End




    VoiceAttack                                = GimliVoiceAttack
    VoiceAttackCharge                        = GimliVoiceAttackCharge
    VoiceAttackMachine                        = GimliVoiceAttack
    VoiceAttackStructure                    = GimliVoiceAttack
    VoiceCreated                            = GimliVoiceSalute
    VoiceFear                                 = GimliVoiceHelpMe
    VoiceGuard                                = GimliVoiceMove
    VoiceMove                                = GimliVoiceMove
    VoiceMoveToCamp                            = GimliVoiceMove
    VoiceMoveWhileAttacking                    = GimliVoiceDisengage
    VoicePriority                            = 85
    VoiceRetreatToCastle                    = GimliVoiceRetreat
    VoiceSelect                                = GimliVoiceSelectMS
    VoiceSelectBattle                         = GimliVoiceSelectBattle

    SoundImpact                                = ImpactHorse

    UnitSpecificSounds
        VoiceGarrison                        = GimliVoiceGarrison
        VoiceEnterUnitElvenTransportShip    = GimliVoiceMove
        VoiceInitiateCaptureBuilding        = GimliVoiceMove
    End

    CrowdResponseKey = DwarfHero

    #include "..\..\..\Includes\StandardUnitEvaEvents.inc"

    EvaEventDieOwner = GimliDie

    Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
        Key = Humanoid_Male Dwarf Dwarf_Male Unit Infantry Hero
    End

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound:FootstepDirtA            Animation:RUGimli_SKL.RUGimli_RUNA    Frames:3 14
        AnimationSound = Sound:FootstepDirtA            Animation:RUGimli_SKL.RUGimli_RUNB    Frames:3 12

        AnimationSound = Sound:BodyFallSoldier            Animation:RUGimli_SKL.RUGimli_LNDA    Frames:2

        AnimationSound = Sound:BodyFallGenericNoArmor    Animation:RUGimli_SKL.RUGimli_DIEA    Frames:11
        AnimationSound = Sound:BodyFallGenericNoArmor    Animation:RUGimli_SKL.RUGimli_DIEC    Frames:59
    End




    RadarPriority = UNIT
    KindOf = PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE THROWN_OBJECT GIMLI HERO ARMY_SUMMARY ATTACK_NEEDS_LINE_OF_SIGHT HEAVY_MELEE_HITTER
    PathfindDiameter = 40.0

    Body = RespawnBody ModuleTag_RespawnBody
        CheerRadius             = EMOTION_CHEER_RADIUS
        MaxHealth                 = GIMLIDAG_HEALTH
        PermanentlyKilledByFilter    = NONE
        DodgePercent               = HERO_DODGE_PERCENT
    End


    Behavior = RespawnUpdate ModuleTag_RespawnUpdate
        DeathAnim                = DYING
        DeathAnimationTime        = 4100
        RespawnAnim                = LEVELED
        RespawnAnimationTime        = 2000
        AutoRespawnAtObjectFilter    = NONE +CASTLE_KEEP
        ButtonImage                = HIGimli

        RespawnRules =    AutoSpawn:No           Cost:GIMLIDAG_COST       Time:MEDIUM_HERO_RESPAWNTIME        Health:100%
   End


    Behavior = AutoHealBehavior ModuleTag_GimliHealing
        StartsActive = Yes
        HealingAmount = HERO_HEAL_AMOUNT
        HealingDelay = 1000
        StartHealingDelay = HERO_HEAL_DELAY
        HealOnlyIfNotInCombat = Yes
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = Hero
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = AIUpdateInterface ModuleTag_03
        AutoAcquireEnemiesWhenIdle = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate        = 500
        HoldGroundCloseRangeDistance = 60
    End

    LocomotorSet
        Locomotor = RohanGimliLocomotor
        Condition = SET_NORMAL
        Speed     = NORMAL_DWARF_HERO_SPEED
    End


    Behavior = PhysicsBehavior ModuleTag_04
        GravityMult = 1.0
        AllowBouncing = No
        ShockStunnedTimeLow        = 1400
        ShockStunnedTimeHigh    = 2400
        ShockStandingTime        = 2600
    End

    Behavior = SlowDeathBehavior ModuleTag_05
        DeathTypes = ALL -KNOCKBACK -FADED
        SinkDelay = 3000
        SinkRate = 0.40
        DestructionDelay = 8000
        Sound = INITIAL GimliVoiceDie
        DeathFlags = DEATH_1
    End

      Behavior = SlowDeathBehavior ModuleTag_FadeDeath
        DeathTypes = NONE +FADED
        FadeDelay = 0
        FadeTime = 2500
        DestructionDelay = 2500
        Sound = INITIAL SpellGenericUnsummonFasterMS
        DeathFlags = DEATH_2
    End

    Behavior = SquishCollide ModuleTag_06

    End

    Behavior = SlowDeathBehavior ModuleTag_07

        DeathTypes = NONE +KNOCKBACK
        SinkDelay = 3000
        SinkRate = 0.40
        DestructionDelay = 8000
    End

    Behavior = BezierProjectileBehavior ModuleTag_08

        FirstHeight = 50
        SecondHeight = 20
        FirstPercentIndent = 20%
        SecondPercentIndent = 70%
        TumbleRandomly = Yes

        CrushStyle = Yes

        BounceCount = 0

        FinalStuckTime = 1200

        GroundHitFX       = FX_GimliLeapLand
        GroundHitWeapon   = RohanGimliLeapWarheadMod
        PreLandingStateTime = 75
    End



    Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    300
         TauntAndPointUpdateDelay    =    1000

        AddEmotion            =    Doom_Base



        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
         AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base


        AddEmotion            =    Alert_Base
        AddEmotion            =    CheerForAboutToCrush_Base
     End





    Behavior = SpecialPowerModule ModuleTag_ZealotBoomAxeStarter
	SpecialPowerTemplate	    = SpecialAbilityGimliAxe
	UpdateModuleStartsAttack    = Yes
	InitiateSound		    = GimliAxeThrowClickMS
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_CreateAHeroAxeThrowUpdate
	SpecialPowerTemplate	= SpecialAbilityGimliAxe
	UnpackTime              = 1500
	PackTime                = 1000
	AwardXPForTriggering    = 0
	StartAbilityRange	= #SUBTRACT( GIMLI_THROW_RANGE 15 )
	ApproachRequiresLOS	= Yes
	SpecialWeapon		= RohanGimliAxeThrown
	WhichSpecialWeapon	= 1
    End

    Behavior = AutoAbilityBehavior ModuleTag_AxeThrowAutoAbility
	SpecialAbility	= SpecialAbilityGimliAxe
	ForbiddenStatus = INSIDE_GARRISON
	MaxScanRange	= #SUBTRACT( GIMLI_THROW_RANGE 50 )
	Query		= 15 ALL ENEMIES -STRUCTURE -WALL_UPGRADE -WALL_HUB -WALL_SEGMENT -DEFENSIVE_WALL -FS_BASE_DEFENSE
	Query           = 1 ANY +HERO +MONSTER
    End





    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_LeapEnabler
        SpecialPowerTemplate     = SpecialAbilityGimliLeap
        TriggeredBy              = Upgrade_Level_2
    End

    Behavior = SpecialPowerModule ModuleTag_LeapStarter
        SpecialPowerTemplate     = SpecialAbilityGimliLeap
        UpdateModuleStartsAttack = Yes
        StartsPaused             = Yes
        InitiateSound            = GimliVoiceAttackLeap
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_LeapUpdate
        SpecialPowerTemplate    = SpecialAbilityGimliLeap
        UnpackTime              = 600
        PackTime                = 300
        AwardXPForTriggering    = 0
        StartAbilityRange       = 100.0
        SpecialWeapon           = RohanGimliLeapMod
        BusyForDuration         = 2000

        WhichSpecialWeapon      = 2
        TriggerSound            = GimliLeapVoice
    End







    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_SturheitEnabler
        SpecialPowerTemplate     = SpecialAbilityGimliSturheit
        TriggeredBy              = Upgrade_Level_8
        ObeyRechageOnTrigger     = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_SturheitStarter
        SpecialPowerTemplate      = SpecialAbilityGimliSturheit
        UpdateModuleStartsAttack  = Yes
        StartsPaused              = Yes

    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_SturheitWeaponFireUpdate
        SpecialPowerTemplate      = SpecialAbilityGimliSturheit
        SpecialWeapon             = GimliSturheitWeapon
        WhichSpecialWeapon        = 1
        StartAbilityRange         = 10.0
        SkipContinue              = Yes
        UnpackTime                = 1000
        PackTime                  = 2000
        MustFinishAbility         = Yes
    End



    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_GimliDiplomacynabler
        SpecialPowerTemplate     = SpecialAbilityGimliDiplomacy
        TriggeredBy              = Upgrade_Level_5
    End

    Behavior = SpecialPowerModule ModuleTag_MachtStarter
        SpecialPowerTemplate     = SpecialAbilityGimliDiplomacy
        UpdateModuleStartsAttack = Yes
        StartsPaused             = Yes
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_MachtUpdate
        SpecialPowerTemplate     = SpecialAbilityGimliDiplomacy
        SkipContinue             = Yes
        UnpackTime               = 1100
        PreparationTime          = 1
        PersistentPrepTime       = 500
        PackTime                 = 500
        MustFinishAbility        = Yes
        AwardXPForTriggering     = 0
        StartAbilityRange        = 150
        SpecialWeapon            = GimliDiplomacyPingWeapon
        WhichSpecialWeapon       = 3
    End

    Behavior = CostModifierUpgrade ModuleTag_CostModifier2
        StartsActive    = No
        ObjectFilter    = NONE +AglarondHunterHorde +AglarondPikeHorde +AglarondCavalaryHorde
        Percentage      = -25%
        TriggeredBy     = Upgrade_Level_5 Upgrade_DwarvenMithrilMailHeroes
        RequiresAllTriggers = Yes
    End



    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_KnifeEnabler
        SpecialPowerTemplate = SpecialAbilityGimliHeroMode
        TriggeredBy 	     = Upgrade_Level_5
    End

    Behavior = WeaponModeSpecialPowerUpdate ModuleTag_KnifeFighterPowerUpdate
        SpecialPowerTemplate    = SpecialAbilityGimliHeroMode
        Duration                = 30000
        AttributeModifier       = SlayerGimliMod
        WeaponSetFlags          = WEAPONSET_TOGGLE_1
        StartsPaused            = Yes
    End

    Behavior = HitReactionBehavior HitReactionBehaviorModuleTag
        HitReactionLifeTimer1 = 2200
        HitReactionLifeTimer2 = 15
        HitReactionLifeTimer3 = 10

        HitReactionThreshold1 = 1.0
        HitReactionThreshold2 = 2500.0
        HitReactionThreshold3 = 5000.0
    End

    Behavior = AutoHealBehavior ModuleTag_ElvenGiftHealing
        StartsActive            = No
        TriggeredBy             = Upgrade_ElvenGift
        HealingAmount           = ELVEN_GIFT_REGEN_AMOUNT
        HealingDelay            = ELVEN_GIFT_REGEN_DELAY
        StartHealingDelay 	= HERO_HEAL_DELAY
        HealOnlyIfNotInCombat   = Yes
    End


    Behavior = ArmorUpgrade ModuleTag_ArmorUpgradeMithril
        TriggeredBy     = Upgrade_DwarvenMithrilMailHeroes
        ArmorSetFlag    = PLAYER_UPGRADE
    End

    Behavior = SubObjectsUpgrade ModuleTag_MithrilSkinwelchsel
        TriggeredBy     = Upgrade_DwarvenMithrilMailHeroes
        UpgradeTexture  = rugimli.tga 0 rugimli_ha.tga
        ExcludeSubobjects = AXE02
    End

    Behavior = SubObjectsUpgrade SiegeHammer_UpgradeGuardian
        TriggeredBy       = Upgrade_DwarvenMithrilMailHeroes
        HideSubObjects    = AXE02
    End






    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Behavior = AISpecialPowerUpdate GimliSlayerAI

        CommandButtonName = Command_SpecialAbilityGimliOrkschlachter
        SpecialPowerAIType = AI_SPECIAL_POWER_BASIC_SELF_BUFF
    End

    Behavior = AISpecialPowerUpdate GimliLeapAttackAI
        CommandButtonName = Command_RohanGimliLeap
        SpecialPowerAIType = AI_SPECIAL_POWER_RANGED_AOE_ATTACK
        SpecialPowerRadius = 100
    End

    Behavior = AISpecialPowerUpdate GimliAxeThrowAI
        CommandButtonName = Command_GimliAxeThrow
        SpecialPowerAIType = AI_SPECIAL_POWER_ENEMY_TYPE_KILLER
    End

    Behavior = AISpecialPowerUpdate GandalfWordOfPowerAI
        CommandButtonName = Command_SpecialAbilityGimliSturheit
        SpecialPowerAIType = AI_SPECIAL_POWER_BASIC_SELF_BUFF
        SpecialPowerRadius = 150
    End


    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End


    Geometry = CYLINDER
    GeometryMajorRadius = 5.6
    GeometryMinorRadius = 5.6
    GeometryHeight = 16.0
    GeometryIsSmall = Yes
  Shadow = SHADOW_DECAL
  ShadowSizeX = 19
  ShadowSizeY = 19
  ShadowTexture = ShadowI
End


ChildObject DwarvenGimliMod_Summoned DwarvenGimli
    IsTrainable = No
    CommandPoints = 0
    CommandSet  = RohanGimliModCommandSetSummoned

    KindOf = PRELOAD HERO SELECTABLE CAN_CAST_REFLECTIONS SCORE NO_FREEWILL_ENTER MONSTER SCARY CANNOT_RETALIATE SUMMONED

    Behavior = ExperienceLevelCreate ModuleTag_MPLevelBonus
        LevelToGrant = 5
    End

    Behavior = LifetimeUpdate ModuleTag_LifetimeUpdate
        MinLifetime      = CREATE_A_HERO_REINFORCEMENT_LIFETIME
        MaxLifetime      = CREATE_A_HERO_REINFORCEMENT_LIFETIME
        DeathType        = FADED
    End

    Behavior = RespawnUpdate ModuleTag_RespawnUpdate
    End

      Behavior = SlowDeathBehavior ModuleTag_FadeDeath
        DeathTypes = NONE +FADED
        FadeDelay = 0
        FadeTime = 2500
        DestructionDelay = 2500
        Sound = INITIAL SpellGenericUnsummonFasterMS
        DeathFlags = DEATH_2
    End
End


ChildObject DwarvenGimli_SummonedGefahrten DwarvenGimli
    IsTrainable   = No
    CommandPoints = 0
    CommandSet    = RohanGimliCommandSetSummonedGefahrtenFull

    KindOf = PRELOAD HERO SELECTABLE CAN_CAST_REFLECTIONS SCORE NO_FREEWILL_ENTER MONSTER SCARY CANNOT_RETALIATE SUMMONED

    Behavior = LifetimeUpdate ModuleTag_LifetimeUpdate
        MinLifetime        = 120000
        MaxLifetime        = 120000
        DeathType          = FADED
    End

    Behavior = ExperienceLevelCreate ModuleTag_MPLevelBonus
        LevelToGrant = 5
    End

    WeaponSet
        Conditions               = None
        Weapon                   = PRIMARY  RohanGimliAxeMod
        Weapon                   = TERTIARY RohanGimliAxeThrown_Gefahrten
        AutoChooseSources        = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
        AutoChooseSources        = TERTIARY NONE
        ShareWeaponReloadTime    = Yes
    End

    WeaponSet
        Conditions               = WEAPONSET_TOGGLE_1
        Weapon                   = SECONDARY  RohanGimliSuperAxeMod
        Weapon                   = TERTIARY   RohanGimliAxeThrown_Gefahrten
        AutoChooseSources        = SECONDARY FROM_PLAYER FROM_SCRIPT FROM_AI
        AutoChooseSources        = TERTIARY NONE
        ShareWeaponReloadTime    = Yes
    End






    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_LeapEnabler
        SpecialPowerTemplate     = SpecialAbilityGimliLeap
        TriggeredBy              = Upgrade_Level_1
    End

    Behavior = SpecialPowerModule ModuleTag_LeapStarter
        SpecialPowerTemplate     = SpecialAbilityGimliLeap
        UpdateModuleStartsAttack = Yes
        StartsPaused             = Yes
        AvailableAtStart         = No
        InitiateSound            = GimliVoiceAttackLeap
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_LeapUpdate
        SpecialPowerTemplate    = SpecialAbilityGimliLeap
        UnpackTime              = 600
        PackTime                = 300
        AwardXPForTriggering    = 0
        StartAbilityRange       = 100.0
        SpecialWeapon           = RohanGimliLeapMod
        BusyForDuration         = 2000
        WhichSpecialWeapon      = 2
        TriggerSound            = GimliLeapVoice
    End







    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_KnifeEnabler
        SpecialPowerTemplate = SpecialAbilityGimliHeroMode
        TriggeredBy 	     = Upgrade_Level_1
    End

    Behavior = WeaponModeSpecialPowerUpdate ModuleTag_KnifeFighterPowerUpdate
        SpecialPowerTemplate    = SpecialAbilityGimliHeroMode
        Duration                = 30000
        AttributeModifier       = SlayerGimliMod
        WeaponSetFlags          = WEAPONSET_TOGGLE_1
        StartsPaused            = Yes
    End

    Behavior = RespawnUpdate ModuleTag_RespawnUpdate
    End

    Behavior = SlowDeathBehavior ModuleTag_FadeDeath
        DeathTypes = NONE +FADED
        FadeDelay = 0
        FadeTime = 2500
        DestructionDelay = 2500
        Sound = INITIAL SpellGenericUnsummonFasterMS
        DeathFlags = DEATH_2
    End
End


ChildObject DwarvenGimliMod_ElrondsRat DwarvenGimli
    IsTrainable = No
    CommandPoints = 0
    CommandSet  = RohanGimliModCommandSetSummoned

    KindOf = PRELOAD HERO SELECTABLE CAN_CAST_REFLECTIONS SCORE NO_FREEWILL_ENTER MONSTER SCARY CANNOT_RETALIATE SUMMONED

    Behavior = ExperienceLevelCreate ModuleTag_MPLevelBonus
        LevelToGrant = 6
    End

    Behavior = LifetimeUpdate ModuleTag_LifetimeUpdate
        MinLifetime      = 120000
        MaxLifetime      = 120000
        DeathType        = FADED
    End

    Behavior = RespawnUpdate ModuleTag_RespawnUpdate
    End

    Behavior = SlowDeathBehavior ModuleTag_FadeDeath
        DeathTypes = NONE +FADED
        FadeDelay = 0
        FadeTime = 2500
        DestructionDelay = 2500
        Sound = INITIAL SpellGenericUnsummonFasterMS
        DeathFlags = DEATH_2
    End
End

