Object DwarvenCatapult

  SelectPortrait        = UPDwarven_IronHillsCatapult
  ButtonImage           = HIDwarvenCatapult_Wotr

  DescriptionStrategic = CONTROLBAR:LW_ToolTip_DwarvenCatapult

  Draw = W3DTruckDraw ModuleTag_01

    WadingParticleSys = EntRipples

        OkToChangeModelColor = Yes
        StaticModelLODMode   = Yes

        DefaultModelConditionState
            Model               = DUCatapult_SKN
            WeaponLaunchBone    = PRIMARY Projectile_Left
            WeaponLaunchBone    = SECONDARY Projectile_Righ
        End

        ModelConditionState = DYING
            Model               = DUCatapult_DIEA
        End

        IdleAnimationState
            StateName           = Stand
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "JUST_BUILT" then CurDrawableSetTransitionAnimState("TRANS_FROM_JUST_BUILT") end
            EndScript
            Animation = IDLES
                AnimationName     = DUCatapult_SKL.DUCatapult_IDLA
                AnimationMode       = ONCE
                AnimationBlendTime  = 15
            End
        End


        AnimationState      = DYING
            Animation         = DUCatapult_DIEA
                AnimationName   = DUCatapult_DIEA.DUCatapult_DIEA
                AnimationMode   = ONCE
            End
        End

        AnimationState                        = PARALYZED
            Animation
                AnimationName                = DUCatapult_IDLA
                AnimationMode                = LOOP
            End
        End


        ModelConditionState =JUST_BUILT
            Model    =  DUCatapult_A
        End

        AnimationState  = JUST_BUILT
            Animation            = Being_Built
                AnimationName        = DUCatapult_SKL.DUCatapult_BLDA
                AnimationMode        = ONCE
                AnimationBlendTime    = 0
            End
        End

    AnimationState        =  TURN_LEFT_HIGH_SPEED
        Animation = TurningLeft
            AnimationName           =  DUCatapult_SKL.DUCatapult_TRNL
            AnimationMode       = LOOP
            AnimationSpeedFactorRange = 1.8 1.8
            AnimationBlendTime    = 10
        End
    End


    AnimationState        =  TURN_RIGHT_HIGH_SPEED
        Animation = TurningLeft
            AnimationName           =  DUCatapult_SKL.DUCatapult_TRNR
            AnimationMode       = LOOP
            AnimationSpeedFactorRange = 1.8 1.8
            AnimationBlendTime    = 10
        End
    End



        AnimationState        = TURN_LEFT
            StateName           = TurningLeft
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "JUST_BUILT" then CurDrawableSetTransitionAnimState("TRANS_FROM_JUST_BUILT")
                end
            EndScript
            Animation           = DUCatapult_TRSL
                AnimationName     = DUCatapult_SKL.DUCatapult_TRSL
                AnimationMode     = LOOP
                AnimationBlendTime= 15
            End
        End

        TransitionState = BlendToTurnLeft
            Animation           = DUCatapult_TRSL
                AnimationName     = DUCatapult_SKL.DUCatapult_TRSL
                AnimationMode     = ONCE
                AnimationBlendTime= 30
            End
        End

        AnimationState        = TURN_RIGHT
            StateName           = TurningRight
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "JUST_BUILT" then CurDrawableSetTransitionAnimState("TRANS_FROM_JUST_BUILT")
                end
            EndScript


            Animation           = DUCatapult_TRSR
                AnimationName     = DUCatapult_SKL.DUCatapult_TRSR
                AnimationMode     = LOOP
                AnimationBlendTime= 15
            End
        End

        TransitionState = BlendToTurnRight
            Animation           = DUCatapult_TRSR
                AnimationName     = DUCatapult_SKL.DUCatapult_TRSR
                AnimationMode     = ONCE
                AnimationBlendTime= 30
            End
        End

        AnimationState        = MOVING
            Animation = Move
                AnimationName           = DUCatapult_SKL.DUCatapult_WLKA
                AnimationMode       = LOOP
                AnimationBlendTime= 15
                AnimationSpeedFactorRange = 1.5 1.5
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Stand" then CurDrawableSetTransitionAnimState("Trans_Stand_To_Move")
                elseif Prev == "JUST_BUILT" then CurDrawableSetTransitionAnimState("TRANS_FROM_JUST_BUILT")
                end
            EndScript
        End

        TransitionState = BlendToMove
            Animation           = DUCatapult_WLKA
                AnimationName     = DUCatapult_SKL.DUCatapult_WLKA
                AnimationMode     = ONCE
                AnimationBlendTime= 15
            End
        End

        AnimationState            =     FIRING_OR_PREATTACK_A
            Animation            =    Normal
                AnimationName    =    DUCatapult_SKL.DUCatapult_ATKA
                AnimationMode    =    ONCE

            End
            Animation            =    NoBlend
                AnimationName    =    DUCatapult_SKL.DUCatapult_ATKA
                AnimationMode    =    ONCE

            End
            Flags = MAINTAIN_FRAME_ACROSS_STATES
            StateName            =    Attack
            FrameForPristineBonePositions = 31
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Stand" or Prev == "Attack"
                then
                    return "NoBlend"
                else
                    return "Normal"
                end
            EndScript
        End

        TrackMarks = EXTireTrack2_Temp.tga
        TrackMarksLeftBone = B_Cat_WheelFrtLt
        TrackMarksRightBone = B_Cat_WheelFrtRt


        LeftFrontTireBone           = WheelL01
        RightFrontTireBone          = WheelR01
        LeftRearTireBone            = WheelL02
        RightRearTireBone           = WheelR02
        TireRotationMultiplier      = 0.1
        PowerslideRotationAddition  = 1.5

    ParticlesAttachedToAnimatedBones = Yes

 End

     Draw = W3DScriptedModelDraw DustEffects
        DefaultModelConditionState
          Model = None
        End
        IdleAnimationState
        End
        AnimationState = MOVING WADING
            ParticleSysBone     = WheelL01 FootstepSlash FollowBone:Yes
            ParticleSysBone     = WheelR01 FootstepSlash FollowBone:Yes
            ParticleSysBone     = WheelL02 FootstepSlash FollowBone:Yes
        End
        AnimationState        = TURN_RIGHT


        End
        AnimationState        = TURN_LEFT


        End
        AnimationState = MOVING


        End
    End

    #include "..\..\..\includes\StunDrawModuleLarge.inc"



    Side                   = Dwarves
    EditorSorting          = UNIT
    ThreatLevel            = DWARVEN_CATAPULT_THREAT_LEVEL

    ThreatBreakdown DwarvenCatapult_DetailedThreat
        AIKindOf = SIEGEWEAPON
    End

    TransportSlotCount          = TRANSPORTSLOTCOUNT_SIEGE
    ShowHealthInSelectionDecal  = Yes
    ThingClass                  = MACHINE

    CommandSet            = DwarvenCatapultCommandSet
    CommandPoints         = DEFAULT_SIEGE_COMMANDPOINTS
    MaxSimultaneousOfType = NEW_CATAPULT_RATIO

    Behavior       = MonitorConditionUpdate MonitorConditionUpdateModuleTag
        ModelConditionFlags      = ATTACKING_POSITION
        ModelConditionCommandSet = DwarvenCatapultCommandSetStopBombard
    End

    WeaponSet
        Conditions           = None
        Weapon               = PRIMARY        DwarvenIronHillsCatapultRock_Edain
        AutoChooseSources    = PRIMARY        FROM_PLAYER FROM_SCRIPT FROM_AI
    End
    WeaponSet
        Conditions           = PLAYER_UPGRADE
        Weapon               = PRIMARY        DwarvenIronHillsCatapultFlamingShot_Edain
        AutoChooseSources    = PRIMARY        FROM_PLAYER FROM_SCRIPT FROM_AI
    End


    ArmorSet
        Conditions      = None
        Armor           = DefaultSiegeCatapultArmor
        DamageFX        = None
    End

    BuildFadeInOnCreateTime = 7.0

    VisionRange             = 550
    ShroudClearingRange     = 550

    MaxVisionBonusPercent   = 300%
    VisionBonusTestRadius   = 200
    VisionBonusPercentPerFoot = 1.0%

    BountyValue            = DWARVEN_CATAPULT_BOUNTY_VALUE
    DisplayName            = OBJECT:DwarvenCatapultErebor
    CrushableLevel         = 2
    CrusherLevel           = 0
    ShockwaveResistance    = SHOCKWAVE_RESISTANCE_IMMUNE


    AutoResolveUnitType     = AutoResolveUnit_Siege
    AutoResolveCombatChain  = AutoResolve_SiegeCombatChain
    AutoResolveBody         = AutoResolve_DwarvenCatapultBody

    AutoResolveArmor
        Armor = AutoResolve_DwarvenCatapultArmor
    End

    AutoResolveWeapon
        Weapon = AutoResolve_DwarvenCatapultWeapon
    End





    VoiceAttack                    = DwarfCatapultVoiceAttack
    VoiceAttackCharge                = DwarfCatapultVoiceAttackCharge
    VoiceAttackMachine                = DwarfCatapultVoiceAttack
    VoiceAttackStructure                = DwarfCatapultVoiceAttackBuilding
    VoiceCreated                    = DwarfCatapultVoiceSalute
    VoiceFullyCreated                 = DwarfCatapultVoiceSalute
    VoiceGuard                    = DwarfCatapultVoiceMove
    VoiceMove                    = DwarfCatapultVoiceMove
    VoiceMoveToCamp                    = DwarfCatapultVoiceMoveCamp
    VoiceMoveToHigherGround                = DwarfCatapultVoiceMoveHighGround
    VoiceMoveWhileAttacking                = DwarfCatapultVoiceDisengage
    VoicePriority                    = 30
    VoiceRetreatToCastle                = DwarfCatapultVoiceRetreat
    VoiceSelect                    = DwarfCatapultVoiceSelectMS
    VoiceSelectBattle                 = DwarfCatapultVoiceSelectBattle

    MinZIncreaseForVoiceMoveToHigherGround    = 45

    SoundImpact                    = ImpactHorse
    SoundMoveLoop                    = DwarfCatapultMoveLoop
    SoundMoveStart                    = CatapultMoveStart
    SoundOnDamaged                    = UnitDamageWoodLight
    SoundOnReallyDamaged                = UnitDamageWoodHeavy

    UnitSpecificSounds
        VoiceGarrison                = DwarfCatapultVoiceMove
        VoiceEnterUnitElvenTransportShip    = DwarfCatapultVoiceMove
        VoiceInitiateCaptureBuilding        = DwarfCatapultVoiceMove
    End

        #include "..\..\..\includes\StandardUnitEvaEvents.inc"

    CrowdResponseKey = Dwarf

    Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
        Key = Humanoid_Male Dwarf Dwarf_Male SiegeWeapon Catapult Dwarf_Siege
        UnitWeight = 2
    End

    ClientBehavior = ModelConditionAudioLoopClientBehavior ModuleTag_foo
        ModelCondition = Required:EMOTION_CELEBRATING    Excluded:DYING ENGAGED    Sound:EmotionDwarfCompilationVoxCheerSinglesLoop
        ModelCondition = Required:EMOTION_POINTING        Excluded:DYING ENGAGED    Sound:EmotionDwarfCompilationVoxTauntSinglesLoop
        ModelCondition = Required:EMOTION_TAUNTING        Excluded:DYING ENGAGED    Sound:EmotionDwarfCompilationVoxTauntSinglesLoop
        ModelCondition = Required:RAISING_FLAG            Excluded:DYING ENGAGED    Sound:EmotionDwarfCompilationVoxTauntSinglesLoop
    End

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound:CatapultCreate    Animation:MUCatapult_A.MUCatapult_A        Frames:130
        AnimationSound = Sound:BodyFallOrc        Animation:MUCatapltD_SKL.MUCatapltD_ANM    Frames:35
    End




    RadarPriority        = UNIT
    KindOf            = PRELOAD SELECTABLE CAN_CAST_REFLECTIONS MACHINE CAN_ATTACK CAN_ATTACK_WALLS TROLL_BUFF_NUGGET HEAVY_MELEE_HITTER ARMY_SUMMARY SIEGEENGINE
    CamouflageDetectionMultiplier = CAMOUFLAGE_DETECTION_DISTANCE_SHORTISH

    Body             = ActiveBody ModuleTag_02
        CheerRadius       = EMOTION_CHEER_RADIUS
        MaxHealth         = DEFAULTSIEGECATAPULTHEALTH
        MaxHealthDamaged  = 1000
    End

    Behavior     = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate     = Artillery
        End

       BuildCost = 900
        BuildTime = ELITE_BUILDTIME

    Behavior         = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP     = Yes
    End

    Behavior         = WeaponSetUpgrade ModuleTag_FlamingShotUpgrade
        TriggeredBy     = Upgrade_DwarvenFlamingShot
    End

    Behavior         = AIUpdateInterface ModuleTag_03
        AutoAcquireEnemiesWhenIdle = Yes ATTACK_BUILDINGS
        AILuaEventsList    =    CatapultFunctions
    End

    LocomotorSet
        Locomotor = DwarvenCatapultLocomotor
        Condition = SET_NORMAL
        Speed     = NORMAL_SIEGE_MED_MEMBER_SPEED
    End

    Behavior = PhysicsBehavior ModuleTag_04
    End

    Behavior = SlowDeathBehavior ModuleTag_06
        DeathTypes = ALL
        SinkDelay = 3000
        SinkRate = 1.20
        DestructionDelay = 28000

        FX = INITIAL FX_CatapultDie
        Sound = INITIAL    DwarfGenericVoiceDie
    End

    Behavior = SquishCollide ModuleTag_07

    End

    Behavior = TransitionDamageFX ModuleTag_8
        ReallyDamagedFXList1 = Loc: X:0 Y:0 Z:0 FXList:FX_GondorCatapultTransitionMedium
    End

      Behavior = HitReactionBehavior HitReactionBehaviorModuleTag
        HitReactionLifeTimer1 = 2000
        HitReactionLifeTimer2 = 15
        HitReactionLifeTimer3 = 10

        HitReactionThreshold1 = 10.0
        HitReactionThreshold2 = 25000.0
        HitReactionThreshold3 = 50000.0
    End


    Behavior = SpecialPowerModule ModuleTag_OilBarrelsStarter
        SpecialPowerTemplate        = SpecialAbilityDwarvenIronHillsCatapultOilBarrels
        UpdateModuleStartsAttack    = Yes
        InitiateSound                = DwarfCatapultVoiceAttackBarrel
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_OilBarrelUpdate
        SpecialPowerTemplate        = SpecialAbilityDwarvenIronHillsCatapultOilBarrels
        WhichSpecialWeapon            = 1
        UnpackTime                    = 1000
        PreparationTime                = 0
        PackTime                    = 500
        StartAbilityRange            = DWARVEN_CATAPULT_OILBARREL_RANGE
        SpecialWeapon                = DwarvenIronHillsCatapultOilBarrel
        TriggerSound                = OilBarrelLaunch
    End



    Behavior = SubObjectsUpgrade Armor_Upgrade1
        TriggeredBy          = Upgrade_SubFactionIronHills
        UpgradeTexture       = EUDwarfmin.tga 0 EUDwarfmin_eisen.tga
        UpgradeTexture       = eudwarfeng.tga 0 eudwarfeng_eisen.tga
        UpgradeTexture       = eudwarfram_eng.tga 0 eudwarfram_eisen.tga

        ExcludeSubobjects    = Forged_Blade
    End

    Behavior = SubObjectsUpgrade Armor_Upgrade2
        TriggeredBy          = Upgrade_SubFactionErebor
        UpgradeTexture       = EUDwarfmin.tga 0 EUDwarfmin_ereb.tga
        UpgradeTexture       = eudwarfeng.tga 0 eudwarfeng_ereb.tga
        UpgradeTexture       = eudwarfram_eng.tga 0 eudwarfram_ereb.tga

        ExcludeSubobjects    = Forged_Blade
    End

    Behavior = SubObjectsUpgrade Armor_Upgrade3
        TriggeredBy          = Upgrade_SubFactionEredLuin
        UpgradeTexture       = EUDwarfmin.tga 0 EUDwarfmin_ered.tga
        UpgradeTexture       = eudwarfeng.tga 0 eudwarfeng_ered.tga
        UpgradeTexture       = eudwarfram_eng.tga 0 eudwarfram_ered.tga

        ExcludeSubobjects    = Forged_Blade
    End






    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Behavior                  = AISpecialPowerUpdate DwarfCatapultOilBarrels
        CommandButtonName     = Command_SpecialAbilityDwarvenIronHillsCatapultOilBarrels
        SpecialPowerAIType    = AI_SPECIAL_POWER_RANGED_AOE_ATTACK
    End

  Scale = 0.92
  Geometry = BOX
  GeometryMajorRadius = 29.0
  GeometryMinorRadius = 15.0
  GeometryHeight = 18.4
  GeometryIsSmall = No
  Shadow = SHADOW_VOLUME
  HealthBoxHeightOffset        = 20.0
End


ChildObject DwarvenCatapultFortress DwarvenCatapult

    Draw = W3DTruckDraw ModuleTag_01

          OkToChangeModelColor    = Yes
          StaticModelLODMode        = Yes

        DefaultModelConditionState
            Model               = GUFCatapB_SKN
            WeaponLaunchBone    = PRIMARY Projectile_Left
            WeaponLaunchBone    = SECONDARY Projectile_Righ
        End

        IdleAnimationState
            StateName           = Stand
            Animation = IDLES
                AnimationName     = GUFCatapB_SKL.GUFCatapB_IDLA
                AnimationMode       = ONCE
                AnimationBlendTime  = 15
            End
        End

        AnimationState            =     FIRING_OR_PREATTACK_A
            Animation            =    Normal
                AnimationName    =    GUFCatapB_SKL.GUFCatapB_ATKA
                AnimationMode    =    ONCE

            End
            Animation            =    NoBlend
                AnimationName    =    GUFCatapB_SKL.GUFCatapB_ATKA
                AnimationMode    =    ONCE

            End
            Flags = MAINTAIN_FRAME_ACROSS_STATES
            StateName            =    Attack
            FrameForPristineBonePositions = 31
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Stand" or Prev == "Attack"
                then
                    return "NoBlend"
                else
                    return "Normal"
                end
            EndScript
        End


        AnimationState        = TURN_LEFT
            StateName           = TurningLeft
            Animation           = GUFCatapB_TRSL
                AnimationName     = GUFCatapB_SKL.GUFCatapB_TRSL
                AnimationMode     = LOOP
                AnimationBlendTime= 15
            End
        End

        AnimationState        = TURN_RIGHT
            StateName           = TurningRight
            Animation           = DUCatapult_TRSR
                AnimationName     = GUFCatapB_SKL.GUFCatapB_TRSR
                AnimationMode     = LOOP
                AnimationBlendTime= 15
            End
        End
    End



    VoiceAttack                                = DwarfWallCatapultMoveStartForBombard
    VoiceAttackCharge                        = DwarfWallCatapultMoveStartForBombard
    VoiceAttackMachine                        = DwarfWallCatapultMoveStartForBombard
    VoiceAttackStructure                    = DwarfWallCatapultMoveStartForBombard
    VoiceCreated                            = TrebuchetCreated
    VoiceFullyCreated                         = TrebuchetCreated
    VoiceGuard                                = NoSound
    VoiceMove                                = NoSound
    VoiceMoveToCamp                            = NoSound
    VoiceMoveToHigherGround                    = NoSound
    VoiceMoveWhileAttacking                    = NoSound
    VoicePriority                            = 10
    VoiceRetreatToCastle                    = NoSound
    VoiceSelect                                = DwarfCatapultFoleySelect
    VoiceSelectBattle                         = DwarfCatapultFoleySelect

    SoundImpact                                = ImpactHorse
    SoundMoveLoop                            = NoSound
    SoundMoveStart                            = CatapultMoveStart
    SoundOnDamaged                            = UnitDamageWoodLight
    SoundOnReallyDamaged                    = UnitDamageWoodHeavy

    UnitSpecificSounds
        VoiceGarrison                        = NoSound
        VoiceEnterUnitElvenTransportShip    = NoSound
        VoiceInitiateCaptureBuilding        = NoSound
    End

    #include "..\..\..\includes\StandardUnitEvaEvents.inc"

    CommandPoints        = 0
    ShockwaveResistance = SHOCKWAVE_RESISTANCE_ALWAYS

    KindOf = PRELOAD SELECTABLE CAN_CAST_REFLECTIONS MACHINE SCORE CAN_ATTACK CAN_ATTACK_WALLS IGNORES_SELECT_ALL SIEGEENGINE

    CommandSet = DwarvenCatapultFortressCommandSet

    Behavior = MonitorConditionUpdate MonitorConditionUpdateModuleTag
        ModelConditionFlags = ATTACKING_POSITION
        ModelConditionCommandSet = DwarvenCatapultFortressCommandSetStopBombard
    End

    ArmorSet
        Conditions      = None
        Armor           = FortressSiegeEngineArmor
        DamageFX        = None
    End

    WeaponSet
        Conditions          = None
        Weapon              = PRIMARY        DwarvenIronHillsCatapultRock_Edain
        AutoChooseSources   = PRIMARY        FROM_PLAYER FROM_SCRIPT FROM_AI
    End
    WeaponSet
        Conditions          = PLAYER_UPGRADE
        Weapon              = PRIMARY        DwarvenIronHillsCatapultFlamingShot_Edain
        AutoChooseSources   = PRIMARY        FROM_PLAYER FROM_SCRIPT FROM_AI
    End

    Behavior = AIUpdateInterface ModuleTag_03
        AutoAcquireEnemiesWhenIdle    = No
    End

    LocomotorSet
        Locomotor = FloatingCatapultLocomotor
        Condition = SET_NORMAL
        Speed     = 0
    End


    Behavior = SlavedUpdate ModuleTag_Slave
        DieOnMastersDeath    = Yes
        MarkUnselectable    = No
    End


    Behavior = DestroyDie ModuleTag_Die
    End

    Behavior = WeaponSetUpgrade ModuleTag_FlamingRock
        TriggeredBy    = Upgrade_GoodFortressFlamingMunitions
    End

    Behavior = TransitionDamageFX ModuleTag_8
        DamagedFXList1 = Loc: X:0 Y:0 Z:5 FXList:FX_TrebDamage
        ReallyDamagedFXList1 = Loc: X:0 Y:0 Z:5 FXList:FX_TrebDamage
        RubbleFXList1 = Loc: X:0 Y:0 Z:5 FXList:FX_TrebDamage
    End

    Geometry                = CYLINDER
    GeometryMajorRadius        = 15.0
    GeometryHeight            = 18.0
    GeometryIsSmall            = Yes

    Shadow                    = SHADOW_VOLUME
    HealthBoxHeightOffset    = 20.0

End


ChildObject DwarvenWallCatapult DwarvenCatapultFortress

    Behavior = AIUpdateInterface ModuleTag_03
        AutoAcquireEnemiesWhenIdle    = Yes
        AILuaEventsList                = CatapultFunctions
    End
End


ChildObject DwarvenMinasMorgulCatapult DwarvenCatapult

    CommandPoints        = 0
    ShockwaveResistance = SHOCKWAVE_RESISTANCE_ALWAYS

    LocomotorSet
        Locomotor = FloatingCatapultLocomotor
        Condition = SET_NORMAL
        Speed     = 0
    End
End


Object DwarvenFortressMightyCatapult DwarvenCatapult

    Draw = W3DTruckDraw ModuleTag_01

        OkToChangeModelColor    = Yes
          StaticModelLODMode        = No

        DefaultModelConditionState
            Model               = GUFCatapA_SKN
            WeaponLaunchBone    = PRIMARY BOLT1
            WeaponLaunchBone    = SECONDARY BOLT2
            WeaponLaunchBone    = TERTIARY BOLT3
        End

        IdleAnimationState
            StateName           = Stand
            Animation = IDLES
                AnimationName     = GUFCatapA_SKL.GUFCatapA_IDLA
                AnimationMode       = ONCE
                AnimationBlendTime  = 15
            End
        End

        AnimationState            =     FIRING_OR_PREATTACK_A
            Animation            =    Normal
                AnimationName    =    GUFCatapA_SKL.GUFCatapA_ATKA
                AnimationMode    =    ONCE

            End
            Animation            =    NoBlend
                AnimationName    =    GUFCatapA_SKL.GUFCatapA_ATKA
                AnimationMode    =    ONCE

            End
            Flags = MAINTAIN_FRAME_ACROSS_STATES
            StateName            =    Attack
            FrameForPristineBonePositions = 31
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Stand" or Prev == "Attack"
                then
                    return "NoBlend"
                else
                    return "Normal"
                end
            EndScript
        End
    End





    Side                = Dwarves
    EditorSorting            = UNIT

    ThreatLevel            = DWARVEN_CATAPULT_THREAT_LEVEL
    ThreatBreakdown DwarvenCatapult_DetailedThreat
        AIKindOf         = SIEGEWEAPON
    End

    TransportSlotCount        = TRANSPORTSLOTCOUNT_SIEGE
    ShowHealthInSelectionDecal     = Yes
    ThingClass            = MACHINE

    CommandPoints            = 0
    ShockwaveResistance         = SHOCKWAVE_RESISTANCE_ALWAYS


    CommandSet             = EmptyCommandSet


    BuildFadeInOnCreateTime        = 7.0
    BuildCost	            = 1200
    BuildTime                = ELITE_BUILDTIME
    VisionRange            = DWARVEN_CATAPULT_VISION_RANGE
    ShroudClearingRange        = SHROUD_CLEAR_ARTILLERY

    MaxVisionBonusPercent        = 300%
    VisionBonusTestRadius        = 200
    VisionBonusPercentPerFoot    = 1.0%

    BountyValue            = DWARVEN_CATAPULT_BOUNTY_VALUE
    DisplayName            = OBJECT:DwarvenCatapult
    CrushableLevel            = 2
    CrusherLevel            = 0
    ShockwaveResistance        = SHOCKWAVE_RESISTANCE_IMMUNE
    CamouflageDetectionMultiplier    = CAMOUFLAGE_DETECTION_DISTANCE_SHORTISH



    RadarPriority            = UNIT
    KindOf                = PRELOAD CAN_CAST_REFLECTIONS MACHINE SCORE CAN_ATTACK CAN_ATTACK_WALLS IGNORES_SELECT_ALL NOT_AUTOACQUIRABLE UNATTACKABLE SIEGEENGINE



    VoiceAttack            = DwarfCatapultFoleySelect
    VoiceAttackCharge        = DwarfCatapultFoleySelect
    VoiceAttackMachine        = DwarfCatapultFoleySelect
    VoiceAttackStructure        = DwarfCatapultFoleySelect
    VoiceCreated            = UpgradeDwarfFortressMightyCatapult
    VoiceFullyCreated         = UpgradeDwarfFortressMightyCatapult
    VoiceGuard            = NoSound
    VoiceMove            = NoSound
    VoiceMoveToCamp            = NoSound
    VoiceMoveToHigherGround        = NoSound
    VoiceMoveWhileAttacking        = NoSound
    VoicePriority            = 10
    VoiceRetreatToCastle        = NoSound
    VoiceSelect            = DwarfCatapultFoleySelect
    VoiceSelectBattle         = DwarfCatapultFoleySelect

    SoundImpact            = ImpactHorse
    SoundMoveLoop            = NoSound
    SoundMoveStart            = MightyCatapultMoveStart

    UnitSpecificSounds
        VoiceGarrison                = NoSound
        VoiceEnterUnitElvenTransportShip    = NoSound
        VoiceInitiateCaptureBuilding        = NoSound
    End

    #include "..\..\..\includes\StandardUnitEvaEvents.inc"

    CrowdResponseKey = Dwarf

    Behavior = LargeGroupAudioUpdate ModuleTag_LGAU

        Key = Humanoid_Male Dwarf Dwarf_Male SiegeWeapon Catapult Dwarf_Siege
        UnitWeight = 2
    End

    ClientBehavior = ModelConditionAudioLoopClientBehavior ModuleTag_foo
        ModelCondition = Required:EMOTION_CELEBRATING    Excluded:DYING ENGAGED    Sound:EmotionDwarfCompilationVoxCheerSinglesLoop
        ModelCondition = Required:EMOTION_POINTING        Excluded:DYING ENGAGED    Sound:EmotionDwarfCompilationVoxTauntSinglesLoop
        ModelCondition = Required:EMOTION_TAUNTING        Excluded:DYING ENGAGED    Sound:EmotionDwarfCompilationVoxTauntSinglesLoop
    End

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound:CatapultCreate    Animation:MUCatapult_A.MUCatapult_A        Frames:130
        AnimationSound = Sound:BodyFallOrc        Animation:MUCatapltD_SKL.MUCatapltD_ANM    Frames:35
    End


    WeaponSet
        Conditions          = None
        Weapon              = PRIMARY DwarvenMightyCatapultRock
    End

    ArmorSet
        Conditions      = None
        Armor           = FortressSiegeEngineArmor
        DamageFX        = None
    End



    Body = HighlanderBody ModuleTag_10
        MaxHealth      = 50.0
    End

    Behavior = AIUpdateInterface ModuleTag_03
        AutoAcquireEnemiesWhenIdle    = No

    End

    LocomotorSet
        Locomotor = FloatingCatapultLocomotor
        Condition = SET_NORMAL
        Speed     = 0
    End

    Behavior = PhysicsBehavior ModuleTag_04
    End


    Behavior = DestroyDie ModuleTag_Die
    End

    Behavior = TransitionDamageFX ModuleTag_8
        DamagedFXList1 = Loc: X:0 Y:0 Z:5 FXList:FX_TrebDamage


        ReallyDamagedFXList1 = Loc: X:0 Y:0 Z:5 FXList:FX_TrebDamage


        RubbleFXList1 = Loc: X:0 Y:0 Z:5 FXList:FX_TrebDamage
    End


    Behavior = SlavedUpdate ModuleTag_Slave
        DieOnMastersDeath    = Yes
        MarkUnselectable    = No
    End

    Geometry                = CYLINDER
    GeometryMajorRadius        = 95.0
    GeometryHeight            = 18.0
    GeometryIsSmall            = Yes
End

ChildObject EvilEreborDwarvenCat DwarvenCatapult

    LocomotorSet
            Locomotor = FloatingCatapultLocomotor
            Condition = SET_NORMAL
            Speed     = 0
    End
END

ChildObject DwarvenCatapultKampagne DwarvenCatapult
    CommandPoints            = 0
    WeaponSet
        Conditions           = None
        Weapon               = PRIMARY        DwarvenKampagneCatapultRock
        AutoChooseSources    = PRIMARY        FROM_PLAYER FROM_SCRIPT FROM_AI
    End
End





Object DwarvenCatapult_EredLuin

  SelectPortrait         = UPDwarven_IronHillsCatapult
  ButtonImage           = HIDwarvenCatapult_Wotr

    DescriptionStrategic = CONTROLBAR:LW_ToolTip_DwarvenCatapult

  Draw = W3DTruckDraw ModuleTag_01

    WadingParticleSys = EntRipples

        OkToChangeModelColor = Yes

        StaticModelLODMode = Yes

        RandomTexture       = EUDwarfmin_ered.tga 0 EUDwarfmin_eisen.tga
        RandomTexture       = eudwarfeng_ered.tga 0 eudwarfeng_eisen.tga
        RandomTexture       = eudwarfram_eng_ered.tga 0 eudwarfram_eisen.tga

     DefaultModelConditionState
      Model               = dueisencata
      WeaponLaunchBone    = PRIMARY Projectile
      WeaponLaunchBone      = SECONDARY Projectile
      End

      IdleAnimationState
        Animation = Idle1
        AnimationName       = MUCatapult_SKL.MUCatapult_IDLA
        AnimationMode       = ONCE
        AnimationBlendTime  = 15
      End
        Animation = Idle1
        AnimationName       = MUCatapult_SKL.MUCatapult_IDLB
        AnimationMode       = ONCE
        AnimationBlendTime  = 15
      End
        Animation = Idle1
        AnimationName       = MUCatapult_SKL.MUCatapult_IDLC
        AnimationMode       = ONCE
        AnimationBlendTime  = 15
      End
      BeginScript


      EndScript
    End

    ModelConditionState = DYING
            Model               = dueisencatad
            WeaponLaunchBone    = PRIMARY Projectile
        End

    AnimationState      = DYING
            Animation         = MUCataplt_DIEA
                AnimationName   = MUCatapltD_SKL.MUCatapltD_ANM
                AnimationMode   = ONCE
            End
        End

        ModelConditionState =JUST_BUILT
            Model    =  dueisencata_A
        End

        AnimationState  = JUST_BUILT
            Animation            = Being_Built
                AnimationName        = DUCatapult_SKL.DUCatapult_BLDA
                AnimationMode        = ONCE
                AnimationBlendTime    = 0
            End
        End


    AnimationState                =    MOVING BACKING_UP WADING
        Animation                =    BackingUp
            AnimationName           = MUCatapult_SKL.MUCatapult_BAKA
            AnimationMode       = LOOP
            AnimationSpeedFactorRange = 2.0 2.0
        End
        BeginScript
            Prev = CurDrawablePrevAnimationState()
            if Prev == "Attack" then
                CurDrawableSetTransitionAnimState("TransToBackUp")
            end
        EndScript
    End

    AnimationState        = TURN_LEFT WADING
        Animation = TurningLeft
            AnimationName           = MUCatapult_SKL.MUCatapult_TRNL
            AnimationMode       = LOOP
            AnimationSpeedFactorRange = 1.5 1.5
            AnimationBlendTime    = 15
        End
        BeginScript
            Prev = CurDrawablePrevAnimationState()
            if Prev == "Attack" then
                CurDrawableSetTransitionAnimState("TransToTurnLeft")
            end
        EndScript
    End

    AnimationState        = TURN_RIGHT WADING
        Animation = TurningRight
            AnimationName           = MUCatapult_SKL.MUCatapult_TRNR
            AnimationSpeedFactorRange = 1.5 1.5
            AnimationMode       = LOOP
            AnimationBlendTime    = 15
        End
        BeginScript
            Prev = CurDrawablePrevAnimationState()
            if Prev == "Attack" then
                CurDrawableSetTransitionAnimState("TransToTurnRight")
            end
        EndScript
    End

    AnimationState                        = MOVING WADING
        Animation                        = Move
            AnimationName                = MUCatapult_SKL.MUCatapult_MOVA
            AnimationMode                = LOOP
            AnimationSpeedFactorRange    = 2.0 2.0
            AnimationBlendTime            = 15
        End
        BeginScript
            Prev = CurDrawablePrevAnimationState()
            if Prev == "Attack" then
                CurDrawableSetTransitionAnimState("TransToMove")
            end
        EndScript
    End

    AnimationState                =    MOVING BACKING_UP
        Animation                =    BackingUp
            AnimationName           = MUCatapult_SKL.MUCatapult_BAKA
            AnimationMode       = LOOP
            AnimationSpeedFactorRange = 2.0 2.0
        End
        BeginScript
            Prev = CurDrawablePrevAnimationState()
            if Prev == "Attack" then
                CurDrawableSetTransitionAnimState("TransToBackUp")
            end
        EndScript
    End

    AnimationState        = TURN_LEFT
        Animation = TurningLeft
            AnimationName           = MUCatapult_SKL.MUCatapult_TRNL
            AnimationMode       = LOOP
            AnimationSpeedFactorRange = 1.5 1.5
            AnimationBlendTime    = 15
        End
        BeginScript
            Prev = CurDrawablePrevAnimationState()
            if Prev == "Attack" then
                CurDrawableSetTransitionAnimState("TransToTurnLeft")
            end
        EndScript
    End

    AnimationState        = TURN_RIGHT
        Animation = TurningRight
            AnimationName           = MUCatapult_SKL.MUCatapult_TRNR
            AnimationSpeedFactorRange = 1.5 1.5
            AnimationMode       = LOOP
            AnimationBlendTime    = 15
        End
        BeginScript
            Prev = CurDrawablePrevAnimationState()
            if Prev == "Attack" then
                CurDrawableSetTransitionAnimState("TransToTurnRight")
            end
        EndScript
    End

    AnimationState                        = MOVING
        Animation                        = Move
            AnimationName                = MUCatapult_SKL.MUCatapult_MOVA
            AnimationMode                = LOOP
            AnimationSpeedFactorRange    = 2.0 2.0
            AnimationBlendTime            = 15
        End
        BeginScript
            Prev = CurDrawablePrevAnimationState()
            if Prev == "Attack" then
                CurDrawableSetTransitionAnimState("TransToMove")
            end
        EndScript
    End

       AnimationState        = FIRING_OR_PREATTACK_A
        StateName            = Attack
        Animation            = ATKA
            AnimationName           = MUCatapult_SKL.MUCatapult_ATKA
            AnimationMode       = ONCE
            UseWeaponTiming    = Yes
        End
        FrameForPristineBonePositions = 24


    End

    AnimationState            = FIRING_OR_PREATTACK_B
        StateName            = Attack
        Animation            = ATKB
            AnimationName   = MUCatapult_SKL.MUCatapult_ATKA
            AnimationMode   = ONCE
            UseWeaponTiming    = Yes
        End
        FrameForPristineBonePositions = 24
    End

    AnimationState            = SPECIAL_WEAPON_ONE
        StateName            = Attack
        Animation            = ATKB
            AnimationName   = MUCatapult_SKL.MUCatapult_ATKA
            AnimationMode   = ONCE
            UseWeaponTiming    = Yes
        End
        FrameForPristineBonePositions = 24
    End


        AnimationState = HIT_REACTION HIT_LEVEL_1
            Animation = Hit_Level_1_a
                AnimationName = MUCatapult_SKL.MUCatapult_HITA
                AnimationMode = ONCE
            End
        End


        TransitionState = TransToBackUp
            Animation = BAKA
                AnimationName = MUCatapult_SKL.MUCatapult_BAKA
                AnimationMode = ONCE
                AnimationSpeedFactorRange = 2.0 2.0
                AnimationBlendTime    =    30
            End
        End

        TransitionState = TransToMove
            Animation = MOVA
                AnimationName = MUCatapult_SKL.MUCatapult_MOVA
                AnimationMode = ONCE
                AnimationSpeedFactorRange = 2.0 2.0
                AnimationBlendTime    =    30
            End
        End

        TransitionState = TransToTurnLeft
            Animation = TRNL
                AnimationName = MUCatapult_SKL.MUCatapult_TRNL
                AnimationMode = ONCE
                AnimationSpeedFactorRange = 1.5 1.5
                AnimationBlendTime    =    30
            End
        End

        TransitionState = TransToTurnRight
            Animation = TRNR
                AnimationName = MUCatapult_SKL.MUCatapult_TRNR
                AnimationMode = ONCE
                AnimationSpeedFactorRange = 1.5 1.5
                AnimationBlendTime    =    30
            End
        End

    TrackMarks = EXTireTrack2_Temp.tga
    TrackMarksLeftBone = WheelL02
    TrackMarksRightBone = WheelR02

    LeftFrontTireBone           = WheelL01
    RightFrontTireBone          = WheelR01
    LeftRearTireBone            = WheelL02
    RightRearTireBone           = WheelR02
    TireRotationMultiplier      = 0.2
    PowerslideRotationAddition  = 2.5

    ParticlesAttachedToAnimatedBones = Yes

 End

    Draw = W3DScriptedModelDraw DustEffects
        DefaultModelConditionState
          Model = None
        End
        IdleAnimationState
        End
        AnimationState = MOVING WADING
            ParticleSysBone     = WheelL02 FootstepSlash
            ParticleSysBone     = WheelR02 FootstepSlash
        End
        AnimationState        = TURN_RIGHT
            ParticleSysBone     = WheelL02 GenericSiegeTrailDust
            ParticleSysBone     = WheelR02 GenericSiegeTrailDust
        End
        AnimationState        = TURN_LEFT
            ParticleSysBone     = WheelL02 GenericSiegeTrailDust
            ParticleSysBone     = WheelR02 GenericSiegeTrailDust
        End
        AnimationState = MOVING
            ParticleSysBone     = WheelL02 GenericSiegeTrailDust
            ParticleSysBone     = WheelR02 GenericSiegeTrailDust
        End
    End


    #include "..\..\..\includes\StunDrawModuleLarge.inc"



    Side                   = Dwarves
    EditorSorting          = UNIT
    ThreatLevel            = DWARVEN_CATAPULT_THREAT_LEVEL

    ThreatBreakdown DwarvenCatapult_DetailedThreat
        AIKindOf = SIEGEWEAPON
    End

    TransportSlotCount        = TRANSPORTSLOTCOUNT_SIEGE
    ShowHealthInSelectionDecal     = Yes
    ThingClass            = MACHINE

    CommandSet            = DwarvenCatapultCommandSet
    CommandPoints          = DEFAULT_SIEGE_COMMANDPOINTS
    MaxSimultaneousOfType  = NEW_CATAPULT_RATIO

    Behavior             = MonitorConditionUpdate MonitorConditionUpdateModuleTag
        ModelConditionFlags     = ATTACKING_POSITION
        ModelConditionCommandSet = DwarvenCatapultCommandSetStopBombard
    End

    WeaponSet
        Conditions              = None
        Weapon                  = PRIMARY        DwarvenEisenbergeCatapultRock_Edain
        AutoChooseSources       = PRIMARY        FROM_PLAYER FROM_SCRIPT FROM_AI
    End
    WeaponSet
        Conditions              = PLAYER_UPGRADE
        Weapon                  = PRIMARY        DwarvenEisenbergeCatapultFlamingShot_Edain
        AutoChooseSources       = PRIMARY        FROM_PLAYER FROM_SCRIPT FROM_AI
    End


    ArmorSet
        Conditions      = None
        Armor           = DefaultSiegeCatapultArmor
        DamageFX        = None
    End

    BuildFadeInOnCreateTime = 7.0

    VisionRange         = 550
    ShroudClearingRange     = 550

    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = 200
    VisionBonusPercentPerFoot = 1.0%

    BountyValue            = DWARVEN_CATAPULT_BOUNTY_VALUE
    DisplayName            = OBJECT:DwarvenCatapultEredLuin
    CrushableLevel         = 2
    CrusherLevel           = 0
    ShockwaveResistance    = SHOCKWAVE_RESISTANCE_IMMUNE


    AutoResolveUnitType     = AutoResolveUnit_Siege
    AutoResolveCombatChain  = AutoResolve_SiegeCombatChain
    AutoResolveBody         = AutoResolve_DwarvenCatapultBody

    AutoResolveArmor
        Armor = AutoResolve_DwarvenCatapultArmor
    End

    AutoResolveWeapon
        Weapon = AutoResolve_DwarvenCatapultWeapon
    End




    VoiceAttack                    = DwarfCatapultVoiceAttack
    VoiceAttackCharge                = DwarfCatapultVoiceAttackCharge
    VoiceAttackMachine                = DwarfCatapultVoiceAttack
    VoiceAttackStructure                = DwarfCatapultVoiceAttackBuilding
    VoiceCreated                    = DwarfCatapultVoiceSalute
    VoiceFullyCreated                 = DwarfCatapultVoiceSalute
    VoiceGuard                    = DwarfCatapultVoiceMove
    VoiceMove                    = DwarfCatapultVoiceMove
    VoiceMoveToCamp                    = DwarfCatapultVoiceMoveCamp
    VoiceMoveToHigherGround                = DwarfCatapultVoiceMoveHighGround
    VoiceMoveWhileAttacking                = DwarfCatapultVoiceDisengage
    VoicePriority                    = 30
    VoiceRetreatToCastle                = DwarfCatapultVoiceRetreat
    VoiceSelect                    = DwarfCatapultVoiceSelectMS
    VoiceSelectBattle                 = DwarfCatapultVoiceSelectBattle

    MinZIncreaseForVoiceMoveToHigherGround    = 45

    SoundImpact                    = ImpactHorse
    SoundMoveLoop                    = DwarfCatapultMoveLoop
    SoundMoveStart                    = CatapultMoveStart
    SoundOnDamaged                    = UnitDamageWoodLight
    SoundOnReallyDamaged                = UnitDamageWoodHeavy

    UnitSpecificSounds
        VoiceGarrison                = DwarfCatapultVoiceMove
        VoiceEnterUnitElvenTransportShip    = DwarfCatapultVoiceMove
        VoiceInitiateCaptureBuilding        = DwarfCatapultVoiceMove
    End

        #include "..\..\..\includes\StandardUnitEvaEvents.inc"

    CrowdResponseKey = Dwarf

    Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
        Key = Humanoid_Male Dwarf Dwarf_Male SiegeWeapon Catapult Dwarf_Siege
        UnitWeight = 2
    End

    ClientBehavior = ModelConditionAudioLoopClientBehavior ModuleTag_foo
        ModelCondition = Required:EMOTION_CELEBRATING    Excluded:DYING ENGAGED    Sound:EmotionDwarfCompilationVoxCheerSinglesLoop
        ModelCondition = Required:EMOTION_POINTING        Excluded:DYING ENGAGED    Sound:EmotionDwarfCompilationVoxTauntSinglesLoop
        ModelCondition = Required:EMOTION_TAUNTING        Excluded:DYING ENGAGED    Sound:EmotionDwarfCompilationVoxTauntSinglesLoop
        ModelCondition = Required:RAISING_FLAG            Excluded:DYING ENGAGED    Sound:EmotionDwarfCompilationVoxTauntSinglesLoop
    End

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound:CatapultCreate    Animation:MUCatapult_A.MUCatapult_A        Frames:130
        AnimationSound = Sound:BodyFallOrc        Animation:MUCatapltD_SKL.MUCatapltD_ANM    Frames:35
    End




    RadarPriority        = UNIT
    KindOf               = PRELOAD SELECTABLE CAN_CAST_REFLECTIONS MACHINE CAN_ATTACK CAN_ATTACK_WALLS TROLL_BUFF_NUGGET HEAVY_MELEE_HITTER ARMY_SUMMARY SIEGEENGINE
    CamouflageDetectionMultiplier = CAMOUFLAGE_DETECTION_DISTANCE_SHORTISH

    Body             = ActiveBody ModuleTag_02
        CheerRadius       = EMOTION_CHEER_RADIUS
        MaxHealth         = DEFAULTSIEGECATAPULTHEALTH
        MaxHealthDamaged  = 1000
    End

    Behavior     = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate     = Artillery
        End

       BuildCost = 1200
       BuildTime = ELITE_BUILDTIME

    Behavior         = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP     = Yes
    End

     Behavior         = WeaponSetUpgrade ModuleTag_FlamingShotUpgrade
        TriggeredBy     = Upgrade_DwarvenFlamingShot
    End

    Behavior         = AIUpdateInterface ModuleTag_03
        AutoAcquireEnemiesWhenIdle = Yes ATTACK_BUILDINGS
        AILuaEventsList    =    CatapultFunctions
    End

    LocomotorSet
        Locomotor = CatapultLocomotor
        Condition = SET_NORMAL
        Speed     = NORMAL_SIEGE_MED_MEMBER_SPEED
    End

    Behavior = PhysicsBehavior ModuleTag_04
    End



    Behavior = SlowDeathBehavior ModuleTag_06
        DeathTypes = ALL
        SinkDelay = 3000
        SinkRate = 1.20
        DestructionDelay = 28000

        FX = INITIAL FX_CatapultDie
        Sound = INITIAL    DwarfGenericVoiceDie
    End

    Behavior = SquishCollide ModuleTag_07

    End

    Behavior = TransitionDamageFX ModuleTag_8
        ReallyDamagedFXList1 = Loc: X:0 Y:0 Z:0 FXList:FX_GondorCatapultTransitionMedium
    End

      Behavior = HitReactionBehavior HitReactionBehaviorModuleTag
        HitReactionLifeTimer1 = 2000
        HitReactionLifeTimer2 = 15
        HitReactionLifeTimer3 = 10

        HitReactionThreshold1 = 10.0
        HitReactionThreshold2 = 25000.0
        HitReactionThreshold3 = 50000.0
    End

    Behavior = SpecialPowerModule ModuleTag_OilBarrelsStarter
        SpecialPowerTemplate        = SpecialAbilityDwarvenIronHillsCatapultOilBarrels
        UpdateModuleStartsAttack    = Yes
        InitiateSound                = DwarfCatapultVoiceAttackBarrel
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_OilBarrelUpdate
        SpecialPowerTemplate        = SpecialAbilityDwarvenIronHillsCatapultOilBarrels
        WhichSpecialWeapon            = 1
        UnpackTime                    = 1000
        PreparationTime                = 0
        PackTime                    = 500
        StartAbilityRange            = DWARVEN_CATAPULT_OILBARREL_RANGE
        SpecialWeapon                = EisenbergeDwarvenIronHillsCatapultOilBarrel
        TriggerSound                = OilBarrelLaunch
    End






    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End


    Behavior  = AISpecialPowerUpdate DwarfCatapultOilBarrels
        CommandButtonName  = Command_SpecialAbilityDwarvenIronHillsCatapultOilBarrels
        SpecialPowerAIType = AI_SPECIAL_POWER_RANGED_AOE_ATTACK
    End

  Scale = 0.90
  Geometry = BOX
  GeometryMajorRadius = 29.0
  GeometryMinorRadius = 15.0
  GeometryHeight = 18.4
  GeometryIsSmall = No
  Shadow = SHADOW_VOLUME
  HealthBoxHeightOffset        = 20.0
End



Object DwarvenErdenhammer_Erebor

  SelectPortrait        = UPErdenhammer
  ButtonImage           = HIErdenhammer_Wotr

    DescriptionStrategic = CONTROLBAR:LW_ToolTip_DwarvenCatapult

  Draw = W3DTruckDraw ModuleTag_01

    WadingParticleSys = EntRipples

        OkToChangeModelColor = Yes

        StaticModelLODMode = Yes


     DefaultModelConditionState
      Model               = duerdenhammer
      WeaponLaunchBone    = PRIMARY Projectile
      WeaponLaunchBone      = SECONDARY Projectile
      End

      IdleAnimationState
        Animation = Idle1
        AnimationName       = MUCatapult_SKL.MUCatapult_IDLA
        AnimationMode       = ONCE
        AnimationBlendTime  = 15
      End
        Animation = Idle1
        AnimationName       = MUCatapult_SKL.MUCatapult_IDLB
        AnimationMode       = ONCE
        AnimationBlendTime  = 15
      End
        Animation = Idle1
        AnimationName       = MUCatapult_SKL.MUCatapult_IDLC
        AnimationMode       = ONCE
        AnimationBlendTime  = 15
      End
      BeginScript
      EndScript
    End

    ModelConditionState = DYING
            Model               = duerdenhammerd
            WeaponLaunchBone    = PRIMARY Projectile
        End

    AnimationState      = DYING
            Animation         = MUCataplt_DIEA
                AnimationName   = MUCatapltD_SKL.MUCatapltD_ANM
                AnimationMode   = ONCE
            End
        End

        ModelConditionState =JUST_BUILT
            Model    =  duerdenhammer_A
        End

        AnimationState  = JUST_BUILT
            Animation            = Being_Built
                AnimationName        = DUCatapult_SKL.DUCatapult_BLDA
                AnimationMode        = ONCE
                AnimationBlendTime    = 0
            End
        End

    AnimationState                =    MOVING BACKING_UP WADING
        Animation                =    BackingUp
            AnimationName           = MUCatapult_SKL.MUCatapult_BAKA
            AnimationMode       = LOOP
            AnimationSpeedFactorRange = 2.0 2.0
        End
        BeginScript
            Prev = CurDrawablePrevAnimationState()
            if Prev == "Attack" then
                CurDrawableSetTransitionAnimState("TransToBackUp")
            end
        EndScript
    End

    AnimationState        = TURN_LEFT WADING
        Animation = TurningLeft
            AnimationName           = MUCatapult_SKL.MUCatapult_TRNL
            AnimationMode       = LOOP
            AnimationSpeedFactorRange = 1.5 1.5
            AnimationBlendTime    = 15
        End
        BeginScript
            Prev = CurDrawablePrevAnimationState()
            if Prev == "Attack" then
                CurDrawableSetTransitionAnimState("TransToTurnLeft")
            end
        EndScript
    End

    AnimationState        = TURN_RIGHT WADING
        Animation = TurningRight
            AnimationName           = MUCatapult_SKL.MUCatapult_TRNR
            AnimationSpeedFactorRange = 1.5 1.5
            AnimationMode       = LOOP
            AnimationBlendTime    = 15
        End
        BeginScript
            Prev = CurDrawablePrevAnimationState()
            if Prev == "Attack" then
                CurDrawableSetTransitionAnimState("TransToTurnRight")
            end
        EndScript
    End

    AnimationState                        = MOVING WADING
        Animation                        = Move
            AnimationName                = MUCatapult_SKL.MUCatapult_MOVA
            AnimationMode                = LOOP
            AnimationSpeedFactorRange    = 2.0 2.0
            AnimationBlendTime            = 15
        End
        BeginScript
            Prev = CurDrawablePrevAnimationState()
            if Prev == "Attack" then
                CurDrawableSetTransitionAnimState("TransToMove")
            end
        EndScript
    End

    AnimationState                =    MOVING BACKING_UP
        Animation                =    BackingUp
            AnimationName           = MUCatapult_SKL.MUCatapult_BAKA
            AnimationMode       = LOOP
            AnimationSpeedFactorRange = 2.0 2.0
        End
        BeginScript
            Prev = CurDrawablePrevAnimationState()
            if Prev == "Attack" then
                CurDrawableSetTransitionAnimState("TransToBackUp")
            end
        EndScript
    End

    AnimationState        = TURN_LEFT
        Animation = TurningLeft
            AnimationName           = MUCatapult_SKL.MUCatapult_TRNL
            AnimationMode       = LOOP
            AnimationSpeedFactorRange = 1.5 1.5
            AnimationBlendTime    = 15
        End
        BeginScript
            Prev = CurDrawablePrevAnimationState()
            if Prev == "Attack" then
                CurDrawableSetTransitionAnimState("TransToTurnLeft")
            end
        EndScript
    End

    AnimationState        = TURN_RIGHT
        Animation = TurningRight
            AnimationName           = MUCatapult_SKL.MUCatapult_TRNR
            AnimationSpeedFactorRange = 1.5 1.5
            AnimationMode       = LOOP
            AnimationBlendTime    = 15
        End
        BeginScript
            Prev = CurDrawablePrevAnimationState()
            if Prev == "Attack" then
                CurDrawableSetTransitionAnimState("TransToTurnRight")
            end
        EndScript
    End

    AnimationState                        = MOVING
        Animation                        = Move
            AnimationName                = MUCatapult_SKL.MUCatapult_MOVA
            AnimationMode                = LOOP
            AnimationSpeedFactorRange    = 2.0 2.0
            AnimationBlendTime            = 15
        End
        BeginScript
            Prev = CurDrawablePrevAnimationState()
            if Prev == "Attack" then
                CurDrawableSetTransitionAnimState("TransToMove")
            end
        EndScript
    End

       AnimationState        = FIRING_OR_PREATTACK_A
        StateName            = Attack
        Animation            = ATKA
            AnimationName           = MUCatapult_SKL.MUCatapult_ATKA
            AnimationMode       = ONCE
            UseWeaponTiming    = Yes
        End
        FrameForPristineBonePositions = 24
    End

    AnimationState            = FIRING_OR_PREATTACK_B
        StateName            = Attack
        Animation            = ATKB
            AnimationName   = MUCatapult_SKL.MUCatapult_ATKA
            AnimationMode   = ONCE
            UseWeaponTiming    = Yes
        End
        FrameForPristineBonePositions = 24
    End

    AnimationState            = SPECIAL_WEAPON_ONE
        StateName            = Attack
        Animation            = ATKB
            AnimationName   = MUCatapult_SKL.MUCatapult_ATKA
            AnimationMode   = ONCE
            UseWeaponTiming    = Yes
        End
        FrameForPristineBonePositions = 24
    End


        AnimationState = HIT_REACTION HIT_LEVEL_1
            Animation = Hit_Level_1_a
                AnimationName = MUCatapult_SKL.MUCatapult_HITA
                AnimationMode = ONCE
            End
        End


        TransitionState = TransToBackUp
            Animation = BAKA
                AnimationName = MUCatapult_SKL.MUCatapult_BAKA
                AnimationMode = ONCE
                AnimationSpeedFactorRange = 2.0 2.0
                AnimationBlendTime    =    30
            End
        End

        TransitionState = TransToMove
            Animation = MOVA
                AnimationName = MUCatapult_SKL.MUCatapult_MOVA
                AnimationMode = ONCE
                AnimationSpeedFactorRange = 2.0 2.0
                AnimationBlendTime    =    30
            End
        End

        TransitionState = TransToTurnLeft
            Animation = TRNL
                AnimationName = MUCatapult_SKL.MUCatapult_TRNL
                AnimationMode = ONCE
                AnimationSpeedFactorRange = 1.5 1.5
                AnimationBlendTime    =    30
            End
        End

        TransitionState = TransToTurnRight
            Animation = TRNR
                AnimationName = MUCatapult_SKL.MUCatapult_TRNR
                AnimationMode = ONCE
                AnimationSpeedFactorRange = 1.5 1.5
                AnimationBlendTime    =    30
            End
        End

    TrackMarks = EXTireTrack2_Temp.tga
    TrackMarksLeftBone = WheelL02
    TrackMarksRightBone = WheelR02

    LeftFrontTireBone           = WheelL01
    RightFrontTireBone          = WheelR01
    LeftRearTireBone            = WheelL02
    RightRearTireBone           = WheelR02
    TireRotationMultiplier      = 0.2
    PowerslideRotationAddition  = 2.5

    ParticlesAttachedToAnimatedBones = Yes

 End

    Draw = W3DScriptedModelDraw DustEffects
        DefaultModelConditionState
          Model = None
        End
        IdleAnimationState
        End
        AnimationState = MOVING WADING
            ParticleSysBone     = WheelL02 FootstepSlash
            ParticleSysBone     = WheelR02 FootstepSlash
        End
        AnimationState        = TURN_RIGHT
            ParticleSysBone     = WheelL02 GenericSiegeTrailDust
            ParticleSysBone     = WheelR02 GenericSiegeTrailDust
        End
        AnimationState        = TURN_LEFT
            ParticleSysBone     = WheelL02 GenericSiegeTrailDust
            ParticleSysBone     = WheelR02 GenericSiegeTrailDust
        End
        AnimationState = MOVING
            ParticleSysBone     = WheelL02 GenericSiegeTrailDust
            ParticleSysBone     = WheelR02 GenericSiegeTrailDust
        End
    End


    #include "..\..\..\includes\StunDrawModuleLarge.inc"



    Side                   = Dwarves
    EditorSorting          = UNIT

    ThreatLevel            = DWARVEN_CATAPULT_THREAT_LEVEL
    ThreatBreakdown DwarvenCatapult_DetailedThreat
        AIKindOf = SIEGEWEAPON
    End

    TransportSlotCount          = TRANSPORTSLOTCOUNT_SIEGE
    ShowHealthInSelectionDecal  = Yes
    ThingClass                  = MACHINE

    CommandSet             = DwarvenErdenhammerCommandSet
    CommandPoints          = DEFAULT_SIEGE_COMMANDPOINTS
    MaxSimultaneousOfType  = 2

    WeaponSet
        Conditions         = None
        Weapon             = PRIMARY       ErdenhammerCatapultWeapon_Erebor
        AutoChooseSources  = PRIMARY       FROM_PLAYER FROM_SCRIPT FROM_AI
    End

    ArmorSet
        Conditions      = None
        Armor           = DefaultSiegeCatapultArmor
        DamageFX        = None
    End

    BuildFadeInOnCreateTime = 7.0

    VisionRange         = 550
    ShroudClearingRange     = 550
    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = 200
    VisionBonusPercentPerFoot = 1.0%

    BountyValue         = DWARVEN_CATAPULT_BOUNTY_VALUE
    DisplayName         = OBJECT:DwarvenErdenhammer
    CrushableLevel         = 2
    CrusherLevel           = 0
    ShockwaveResistance     = SHOCKWAVE_RESISTANCE_IMMUNE



    AutoResolveUnitType     = AutoResolveUnit_Siege
    AutoResolveCombatChain  = AutoResolve_SiegeCombatChain
    AutoResolveBody         = AutoResolve_DwarvenCatapultBody

    AutoResolveArmor
        Armor = AutoResolve_DwarvenCatapultArmor
    End

    AutoResolveWeapon
        Weapon = AutoResolve_DwarvenCatapultWeapon
    End





    VoiceAttack                    = DwarfCatapultVoiceAttack
    VoiceAttackCharge                = DwarfCatapultVoiceAttackCharge
    VoiceAttackMachine                = DwarfCatapultVoiceAttack
    VoiceAttackStructure                = DwarfCatapultVoiceAttackBuilding
    VoiceCreated                    = DwarfCatapultVoiceSalute
    VoiceFullyCreated                 = DwarfCatapultVoiceSalute
    VoiceGuard                    = DwarfCatapultVoiceMove
    VoiceMove                    = DwarfCatapultVoiceMove
    VoiceMoveToCamp                    = DwarfCatapultVoiceMoveCamp
    VoiceMoveToHigherGround                = DwarfCatapultVoiceMoveHighGround
    VoiceMoveWhileAttacking                = DwarfCatapultVoiceDisengage
    VoicePriority                    = 30
    VoiceRetreatToCastle                = DwarfCatapultVoiceRetreat
    VoiceSelect                    = DwarfCatapultVoiceSelectMS
    VoiceSelectBattle                 = DwarfCatapultVoiceSelectBattle

    MinZIncreaseForVoiceMoveToHigherGround    = 45

    SoundImpact                    = ImpactHorse
    SoundMoveLoop                    = DwarfCatapultMoveLoop
    SoundMoveStart                    = CatapultMoveStart
    SoundOnDamaged                    = UnitDamageWoodLight
    SoundOnReallyDamaged                = UnitDamageWoodHeavy

    UnitSpecificSounds
        VoiceGarrison                = DwarfCatapultVoiceMove
        VoiceEnterUnitElvenTransportShip    = DwarfCatapultVoiceMove
        VoiceInitiateCaptureBuilding        = DwarfCatapultVoiceMove

    End

        #include "..\..\..\includes\StandardUnitEvaEvents.inc"

    CrowdResponseKey = Dwarf

    Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
        Key = Humanoid_Male Dwarf Dwarf_Male SiegeWeapon Catapult Dwarf_Siege
        UnitWeight = 2
    End

    ClientBehavior = ModelConditionAudioLoopClientBehavior ModuleTag_foo
        ModelCondition = Required:EMOTION_CELEBRATING    Excluded:DYING ENGAGED    Sound:EmotionDwarfCompilationVoxCheerSinglesLoop
        ModelCondition = Required:EMOTION_POINTING        Excluded:DYING ENGAGED    Sound:EmotionDwarfCompilationVoxTauntSinglesLoop
        ModelCondition = Required:EMOTION_TAUNTING        Excluded:DYING ENGAGED    Sound:EmotionDwarfCompilationVoxTauntSinglesLoop
        ModelCondition = Required:RAISING_FLAG            Excluded:DYING ENGAGED    Sound:EmotionDwarfCompilationVoxTauntSinglesLoop
    End

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound:CatapultCreate    Animation:MUCatapult_A.MUCatapult_A        Frames:130
        AnimationSound = Sound:BodyFallOrc        Animation:MUCatapltD_SKL.MUCatapltD_ANM    Frames:35
    End




    RadarPriority        = UNIT
    KindOf            = PRELOAD SELECTABLE CAN_CAST_REFLECTIONS MACHINE CAN_ATTACK CAN_ATTACK_WALLS TROLL_BUFF_NUGGET HEAVY_MELEE_HITTER ARMY_SUMMARY SIEGEENGINE

    CamouflageDetectionMultiplier = CAMOUFLAGE_DETECTION_DISTANCE_SHORTISH

    Body             = ActiveBody ModuleTag_02
        CheerRadius       = EMOTION_CHEER_RADIUS
        MaxHealth         = DEFAULTSIEGECATAPULTHEALTHBETTER
        MaxHealthDamaged  = 1100
    End

    Behavior     = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate     = Artillery
        End

    BuildCost = 700
    BuildTime = ELITE_BUILDTIME

    Behavior         = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP     = Yes
    End

    Behavior         = AIUpdateInterface ModuleTag_03
        AutoAcquireEnemiesWhenIdle = Yes ATTACK_BUILDINGS
        AILuaEventsList    =    CatapultFunctions
    End

    LocomotorSet
        Locomotor = CatapultLocomotor
        Condition = SET_NORMAL
        Speed     = 30
    End

    Behavior = PhysicsBehavior ModuleTag_04
    End






    Behavior = SpecialPowerModule ModuleTag_StompStarter
        SpecialPowerTemplate      = SpecialAbilityWildMountainGiantStomp
        UpdateModuleStartsAttack  = Yes
        StartsPaused              = No
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_StompWeaponFireUpdate
        SpecialPowerTemplate    = SpecialAbilityWildMountainGiantStomp
        WhichSpecialWeapon      = 1
        SkipContinue            = Yes
        UnpackTime              = 300
        PackTime                = 400
        AwardXPForTriggering    = 0
        StartAbilityRange       = 80.0
        SpecialWeapon           = DwarvenErdenhammerStomp
    End

    Behavior = AutoAbilityBehavior ModuleTag_EarthShatterHammer
        SpecialAbility          = SpecialAbilityWildMountainGiantStomp
        MaxScanRange            = 50
        Query                   = 1 ANY +STRUCTURE
    End


    Behavior = SubObjectsUpgrade Armor_Upgrade1
        TriggeredBy          = Upgrade_SubFactionIronHills
        UpgradeTexture       = EUDwarfmin_eisen.tga 0 EUDwarfmin_eisen.tga
        UpgradeTexture       = eudwarfeng_eisen.tga 0 eudwarfeng_eisen.tga
        UpgradeTexture       = eudwarfram_eng_eisen.tga 0 eudwarfram_eisen.tga
        ExcludeSubobjects    = Forged_Blade
    End

    Behavior = SubObjectsUpgrade Armor_Upgrade2
        TriggeredBy          = Upgrade_SubFactionErebor
        UpgradeTexture       = EUDwarfmin_eisen.tga 0 EUDwarfmin_ereb.tga
        UpgradeTexture       = eudwarfeng_eisen.tga 0 eudwarfeng_ereb.tga
        UpgradeTexture       = eudwarfram_eng_eisen.tga 0 eudwarfram_ereb.tga
        ExcludeSubobjects    = Forged_Blade
    End

    Behavior = SubObjectsUpgrade Armor_Upgrade3
        TriggeredBy          = Upgrade_SubFactionEredLuin
        UpgradeTexture       = EUDwarfmin_eisen.tga 0 EUDwarfmin_ered.tga
        UpgradeTexture       = eudwarfeng_eisen.tga 0 eudwarfeng_ered.tga
        UpgradeTexture       = eudwarfram_eng_eisen.tga 0 eudwarfram_ered.tga
        ExcludeSubobjects    = Forged_Blade
    End

    Behavior = SlowDeathBehavior ModuleTag_06
        DeathTypes = ALL
        SinkDelay = 3000
        SinkRate = 1.20
        DestructionDelay = 28000
        FX = INITIAL FX_CatapultDie
        Sound = INITIAL    DwarfGenericVoiceDie
    End

    Behavior = SquishCollide ModuleTag_07

    End

    Behavior = TransitionDamageFX ModuleTag_8
        ReallyDamagedFXList1 = Loc: X:0 Y:0 Z:0 FXList:FX_GondorCatapultTransitionMedium
    End

      Behavior = HitReactionBehavior HitReactionBehaviorModuleTag
        HitReactionLifeTimer1 = 2000
        HitReactionLifeTimer2 = 15
        HitReactionLifeTimer3 = 10

        HitReactionThreshold1 = 10.0
        HitReactionThreshold2 = 25000.0
        HitReactionThreshold3 = 50000.0
    End








    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Behavior = AISpecialPowerUpdate StompAI
	CommandButtonName  = Command_SpecialAbilityWildMountainGiantStomp
	SpecialPowerAIType = AI_SPECIAL_POWER_BASIC_SELF_BUFF
	SpecialPowerRange  = 50
    End


  Scale = 0.92
  Geometry = BOX
  GeometryMajorRadius = 29.0
  GeometryMinorRadius = 15.0
  GeometryHeight = 18.4
  GeometryIsSmall = No
  Shadow = SHADOW_VOLUME
  HealthBoxHeightOffset        = 20.0


    AutoResolveUnitType = AutoResolveUnit_Cavalry
    AutoResolveCombatChain = AutoResolve_CavalryCombatChain

    AutoResolveBody = AutoResolve_DwarvenBattleWagonBody

    AutoResolveArmor
        Armor = AutoResolve_DwarvenBattleWagonArmor
    End

    AutoResolveWeapon
        Weapon = AutoResolve_DwarvenBattleWagonWeapon
    End
End





Object DwarvenKanone

  SelectPortrait        = UPDwarven_IronHillsCatapult
  ButtonImage           = HIDwarvenCatapult_Wotr

  DescriptionStrategic = CONTROLBAR:LW_ToolTip_DwarvenCatapult

  Draw = W3DTruckDraw ModuleTag_01

    WadingParticleSys = EntRipples

        OkToChangeModelColor = Yes

        StaticModelLODMode = Yes

        RandomTexture       = EUDwarfmin_eisen.tga 0 EUDwarfmin_ered.tga
        RandomTexture       = eudwarfeng_eisen.tga 0 eudwarfeng_ered.tga
        RandomTexture       = eudwarfram_eng_eisen.tga 0 eudwarfram_ered.tga
        RandomTexture       = EUDwarfmin_eisen.tga 0 EUDwarfmin_ereb.tga
        RandomTexture       = eudwarfeng_eisen.tga 0 eudwarfeng_ereb.tga
        RandomTexture       = eudwarfram_eng_eisen.tga 0 eudwarfram_ereb.tga

        DefaultModelConditionState
            Model               = DUKanone_SKN
            WeaponLaunchBone    = PRIMARY Projectile_Left
            WeaponLaunchBone    = SECONDARY Projectile_Righ
            WeaponLaunchBone    = TERTIARY BOLT2



        End

        ModelConditionState = DYING
            Model               = DUCatapult_DIEA
        End

        IdleAnimationState
            StateName           = Stand
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "JUST_BUILT" then CurDrawableSetTransitionAnimState("TRANS_FROM_JUST_BUILT") end
            EndScript
            Animation = IDLES
                AnimationName     = DUCatapult_SKL.DUCatapult_IDLA
                AnimationMode       = ONCE
                AnimationBlendTime  = 15
            End
        End


        AnimationState      = DYING
            Animation         = DUCatapult_DIEA
                AnimationName   = DUCatapult_DIEA.DUCatapult_DIEA
                AnimationMode   = ONCE
            End
        End

        AnimationState                        = PARALYZED
            Animation
                AnimationName                = DUCatapult_IDLA
                AnimationMode                = LOOP
            End
        End


        ModelConditionState = JUST_BUILT
            Model    =  DUKanone_SKN
        End

        AnimationState  = JUST_BUILT
            Animation            = Being_Built
                AnimationName        = DUCatapult_SKL.DUCatapult_BLDA
                AnimationMode        = ONCE
                AnimationBlendTime    = 0
            End
        End


    AnimationState        =  TURN_LEFT_HIGH_SPEED
        Animation = TurningLeft
            AnimationName           =  DUCatapult_SKL.DUCatapult_TRNL
            AnimationMode       = LOOP
            AnimationSpeedFactorRange = 1.8 1.8
            AnimationBlendTime    = 10
        End
    End


    AnimationState        =  TURN_RIGHT_HIGH_SPEED
        Animation = TurningLeft
            AnimationName           =  DUCatapult_SKL.DUCatapult_TRNR
            AnimationMode       = LOOP
            AnimationSpeedFactorRange = 1.8 1.8
            AnimationBlendTime    = 10
        End
    End



        AnimationState        = TURN_LEFT
            StateName           = TurningLeft
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "JUST_BUILT" then CurDrawableSetTransitionAnimState("TRANS_FROM_JUST_BUILT")
                end
            EndScript
            Animation           = DUCatapult_TRSL
                AnimationName     = DUCatapult_SKL.DUCatapult_TRSL
                AnimationMode     = LOOP
                AnimationBlendTime= 15
            End
        End

        TransitionState = BlendToTurnLeft
            Animation           = DUCatapult_TRSL
                AnimationName     = DUCatapult_SKL.DUCatapult_TRSL
                AnimationMode     = ONCE
                AnimationBlendTime= 30
            End
        End

        AnimationState        = TURN_RIGHT
            StateName           = TurningRight
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "JUST_BUILT" then CurDrawableSetTransitionAnimState("TRANS_FROM_JUST_BUILT")
                end
            EndScript


            Animation           = DUCatapult_TRSR
                AnimationName     = DUCatapult_SKL.DUCatapult_TRSR
                AnimationMode     = LOOP
                AnimationBlendTime= 15
            End
        End

        TransitionState = BlendToTurnRight
            Animation           = DUCatapult_TRSR
                AnimationName     = DUCatapult_SKL.DUCatapult_TRSR
                AnimationMode     = ONCE
                AnimationBlendTime= 30
            End
        End

        AnimationState        = MOVING
            Animation = Move
                AnimationName           = DUCatapult_SKL.DUCatapult_WLKA
                AnimationMode       = LOOP
                AnimationBlendTime= 15
                AnimationSpeedFactorRange = 1.5 1.5
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Stand" then CurDrawableSetTransitionAnimState("Trans_Stand_To_Move")
                elseif Prev == "JUST_BUILT" then CurDrawableSetTransitionAnimState("TRANS_FROM_JUST_BUILT")
                end
            EndScript
        End

        TransitionState = BlendToMove
            Animation           = DUCatapult_WLKA
                AnimationName     = DUCatapult_SKL.DUCatapult_WLKA
                AnimationMode     = ONCE
                AnimationBlendTime= 15
            End
        End

        AnimationState            =     FIRING_OR_PREATTACK_A
            Animation            =    Normal
                AnimationName    =    DUCatapult_SKL.DUCatapult_ATKA
                AnimationMode    =    ONCE

            End
            Animation            =    NoBlend
                AnimationName    =    DUCatapult_SKL.DUCatapult_ATKA
                AnimationMode    =    ONCE

            End
            Flags = MAINTAIN_FRAME_ACROSS_STATES
            StateName            =    Attack
            FrameForPristineBonePositions = 31
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Stand" or Prev == "Attack"
                then
                    return "NoBlend"
                else
                    return "Normal"
                end
            EndScript
        End

        TrackMarks = EXTireTrack2_Temp.tga
        TrackMarksLeftBone = B_Cat_WheelFrtLt
        TrackMarksRightBone = B_Cat_WheelFrtRt


        LeftFrontTireBone           = WheelL01
        RightFrontTireBone          = WheelR01
        LeftRearTireBone            = WheelL02
        RightRearTireBone           = WheelR02
        TireRotationMultiplier      = 0.1
        PowerslideRotationAddition  = 1.5

    ParticlesAttachedToAnimatedBones = Yes

 End

     Draw = W3DScriptedModelDraw DustEffects
        DefaultModelConditionState
          Model = None
        End
        IdleAnimationState
        End
        AnimationState = MOVING WADING
            ParticleSysBone     = WheelL01 FootstepSlash FollowBone:Yes
            ParticleSysBone     = WheelR01 FootstepSlash FollowBone:Yes
            ParticleSysBone     = WheelL02 FootstepSlash FollowBone:Yes
        End
        AnimationState        = TURN_RIGHT
        End
        AnimationState        = TURN_LEFT
        End
        AnimationState = MOVING
        End
    End

    #include "..\..\..\includes\StunDrawModuleLarge.inc"



    Side                   = Dwarves
    EditorSorting          = UNIT
    ThreatLevel            = DWARVEN_CATAPULT_THREAT_LEVEL

    ThreatBreakdown DwarvenCatapult_DetailedThreat
        AIKindOf = SIEGEWEAPON
    End

    TransportSlotCount        = TRANSPORTSLOTCOUNT_SIEGE
    ShowHealthInSelectionDecal     = Yes
    ThingClass            = MACHINE

    CommandSet            = DwarvenKanoneCommandSet
    CommandPoints          = DEFAULT_SIEGE_COMMANDPOINTS
    MaxSimultaneousOfType  = NEW_CATAPULT_RATIO

    Behavior             = MonitorConditionUpdate MonitorConditionUpdateModuleTag
        ModelConditionFlags     = ATTACKING_POSITION
        ModelConditionCommandSet = DwarvenKanoneCommandSetStopBombard
    End

    WeaponSet
        Conditions              = None
        Weapon                  = PRIMARY        DwarvenKanoneCatapultRock
        AutoChooseSources       = PRIMARY        FROM_PLAYER FROM_SCRIPT FROM_AI
    End
    WeaponSet
        Conditions              = PLAYER_UPGRADE
        Weapon                  = PRIMARY        DwarvenKanoneCatapultRockFlamingShot
        AutoChooseSources       = PRIMARY        FROM_PLAYER FROM_SCRIPT FROM_AI
    End


    ArmorSet
        Conditions      = None
        Armor           = DefaultSiegeCatapultArmor
        DamageFX        = None
    End

    BuildFadeInOnCreateTime = 7.0

    VisionRange            = 550
    ShroudClearingRange    = 550

    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = 200
    VisionBonusPercentPerFoot = 1.0%

    BountyValue            = DWARVEN_CATAPULT_BOUNTY_VALUE
    DisplayName            = OBJECT:DwarvenCatapultIronHills
    CrushableLevel         = 2
    CrusherLevel           = 0
    ShockwaveResistance    = SHOCKWAVE_RESISTANCE_IMMUNE



    AutoResolveUnitType     = AutoResolveUnit_Siege
    AutoResolveCombatChain  = AutoResolve_SiegeCombatChain
    AutoResolveBody         = AutoResolve_DwarvenCatapultBody

    AutoResolveArmor
        Armor = AutoResolve_DwarvenCatapultArmor
    End

    AutoResolveWeapon
        Weapon = AutoResolve_DwarvenCatapultWeapon
    End





    VoiceAttack                    = DwarfCatapultVoiceAttack
    VoiceAttackCharge                = DwarfCatapultVoiceAttackCharge
    VoiceAttackMachine                = DwarfCatapultVoiceAttack
    VoiceAttackStructure                = DwarfCatapultVoiceAttackBuilding
    VoiceCreated                    = DwarfCatapultVoiceSalute
    VoiceFullyCreated                 = DwarfCatapultVoiceSalute
    VoiceGuard                    = DwarfCatapultVoiceMove
    VoiceMove                    = DwarfCatapultVoiceMove
    VoiceMoveToCamp                    = DwarfCatapultVoiceMoveCamp
    VoiceMoveToHigherGround                = DwarfCatapultVoiceMoveHighGround
    VoiceMoveWhileAttacking                = DwarfCatapultVoiceDisengage
    VoicePriority                    = 30
    VoiceRetreatToCastle                = DwarfCatapultVoiceRetreat
    VoiceSelect                    = DwarfCatapultVoiceSelectMS
    VoiceSelectBattle                 = DwarfCatapultVoiceSelectBattle

    MinZIncreaseForVoiceMoveToHigherGround    = 45

    SoundImpact                    = ImpactHorse
    SoundMoveLoop                    = DwarfCatapultMoveLoop
    SoundMoveStart                    = CatapultMoveStart
    SoundOnDamaged                    = UnitDamageWoodLight
    SoundOnReallyDamaged                = UnitDamageWoodHeavy

    UnitSpecificSounds
        VoiceGarrison                = DwarfCatapultVoiceMove
        VoiceEnterUnitElvenTransportShip    = DwarfCatapultVoiceMove
        VoiceInitiateCaptureBuilding        = DwarfCatapultVoiceMove
    End

        #include "..\..\..\includes\StandardUnitEvaEvents.inc"

    CrowdResponseKey = Dwarf

    Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
        Key = Humanoid_Male Dwarf Dwarf_Male SiegeWeapon Catapult Dwarf_Siege
        UnitWeight = 2
    End

    ClientBehavior = ModelConditionAudioLoopClientBehavior ModuleTag_foo
        ModelCondition = Required:EMOTION_CELEBRATING    Excluded:DYING ENGAGED    Sound:EmotionDwarfCompilationVoxCheerSinglesLoop
        ModelCondition = Required:EMOTION_POINTING        Excluded:DYING ENGAGED    Sound:EmotionDwarfCompilationVoxTauntSinglesLoop
        ModelCondition = Required:EMOTION_TAUNTING        Excluded:DYING ENGAGED    Sound:EmotionDwarfCompilationVoxTauntSinglesLoop
        ModelCondition = Required:RAISING_FLAG            Excluded:DYING ENGAGED    Sound:EmotionDwarfCompilationVoxTauntSinglesLoop
    End

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound:CatapultCreate    Animation:MUCatapult_A.MUCatapult_A        Frames:130
        AnimationSound = Sound:BodyFallOrc        Animation:MUCatapltD_SKL.MUCatapltD_ANM    Frames:35
    End




    RadarPriority        = UNIT
    KindOf               = PRELOAD SELECTABLE CAN_CAST_REFLECTIONS MACHINE CAN_ATTACK CAN_ATTACK_WALLS TROLL_BUFF_NUGGET HEAVY_MELEE_HITTER ARMY_SUMMARY SIEGEENGINE
    CamouflageDetectionMultiplier = CAMOUFLAGE_DETECTION_DISTANCE_SHORTISH

    Body             = ActiveBody ModuleTag_02
        CheerRadius       = EMOTION_CHEER_RADIUS
        MaxHealth         = DEFAULTSIEGECATAPULTHEALTH
        MaxHealthDamaged  = 1000
    End

    Behavior     = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate     = Artillery
        End

       BuildCost = 1200
        BuildTime = ELITE_BUILDTIME

    Behavior         = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP     = Yes
    End

     Behavior         = WeaponSetUpgrade ModuleTag_FlamingShotUpgrade
        TriggeredBy     = Upgrade_DwarvenFlamingShot
    End

    Behavior         = AIUpdateInterface ModuleTag_03
        AutoAcquireEnemiesWhenIdle = Yes ATTACK_BUILDINGS
        AILuaEventsList    =    CatapultFunctions
    End

    LocomotorSet
        Locomotor = DwarvenCatapultLocomotor
        Condition = SET_NORMAL
        Speed     = NORMAL_SIEGE_MED_MEMBER_SPEED
    End

    Behavior = PhysicsBehavior ModuleTag_04
    End

    Behavior = SlowDeathBehavior ModuleTag_06
        DeathTypes = ALL
        SinkDelay = 3000
        SinkRate = 1.20
        DestructionDelay = 28000

        FX = INITIAL FX_CatapultDie
        Sound = INITIAL    DwarfGenericVoiceDie
    End

    Behavior = SquishCollide ModuleTag_07

    End

    Behavior = TransitionDamageFX ModuleTag_8
        ReallyDamagedFXList1 = Loc: X:0 Y:0 Z:0 FXList:FX_GondorCatapultTransitionMedium
    End

      Behavior = HitReactionBehavior HitReactionBehaviorModuleTag
        HitReactionLifeTimer1 = 2000
        HitReactionLifeTimer2 = 15
        HitReactionLifeTimer3 = 10

        HitReactionThreshold1 = 10.0
        HitReactionThreshold2 = 25000.0
        HitReactionThreshold3 = 50000.0
    End




    Behavior = SpecialPowerModule ModuleTag_OilBarrelsStarter
        SpecialPowerTemplate        = SpecialAbilityDwarvenIronHillsCatapultOilBarrels
        UpdateModuleStartsAttack    = Yes
        InitiateSound                = DwarfCatapultVoiceAttackBarrel
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_OilBarrelUpdate
        SpecialPowerTemplate        = SpecialAbilityDwarvenIronHillsCatapultOilBarrels
        WhichSpecialWeapon            = 1
        UnpackTime                    = 1000
        PreparationTime                = 0
        PackTime                    = 500
        StartAbilityRange            = DWARVEN_CATAPULT_OILBARREL_RANGE
        SpecialWeapon                = DwarvenIronHillsCatapultOilBarrel
        TriggerSound                = OilBarrelLaunch
    End



    Behavior = SubObjectsUpgrade Armor_Upgrade1
        TriggeredBy          = Upgrade_SubFactionIronHills
        UpgradeTexture       = EUDwarfmin.tga 0 EUDwarfmin_eisen.tga
        UpgradeTexture       = eudwarfeng.tga 0 eudwarfeng_eisen.tga
        UpgradeTexture       = eudwarfram_eng.tga 0 eudwarfram_eisen.tga

        ExcludeSubobjects    = Forged_Blade
    End

    Behavior = SubObjectsUpgrade Armor_Upgrade2
        TriggeredBy          = Upgrade_SubFactionErebor
        UpgradeTexture       = EUDwarfmin.tga 0 EUDwarfmin_ereb.tga
        UpgradeTexture       = eudwarfeng.tga 0 eudwarfeng_ereb.tga
        UpgradeTexture       = eudwarfram_eng.tga 0 eudwarfram_ereb.tga

        ExcludeSubobjects    = Forged_Blade
    End

    Behavior = SubObjectsUpgrade Armor_Upgrade3
        TriggeredBy          = Upgrade_SubFactionEredLuin
        UpgradeTexture       = EUDwarfmin.tga 0 EUDwarfmin_ered.tga
        UpgradeTexture       = eudwarfeng.tga 0 eudwarfeng_ered.tga
        UpgradeTexture       = eudwarfram_eng.tga 0 eudwarfram_ered.tga
        ExcludeSubobjects    = Forged_Blade
    End






    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Behavior = AISpecialPowerUpdate DwarfCatapultOilBarrels
        CommandButtonName  = Command_SpecialAbilityDwarvenIronHillsCatapultOilBarrels
        SpecialPowerAIType  = AI_SPECIAL_POWER_RANGED_AOE_ATTACK
    End

  Scale = 0.92
  Geometry = BOX
  GeometryMajorRadius = 29.0
  GeometryMinorRadius = 15.0
  GeometryHeight = 18.4
  GeometryIsSmall = No
  Shadow = SHADOW_VOLUME
  HealthBoxHeightOffset        = 20.0
End

ChildObject DwarvenErdenhammerErebor_Summoned DwarvenErdenhammer_Erebor

    KindOf = +SUMMONED

    Behavior = LifetimeUpdate ModuleTag_LifetimeUpdate
        MinLifetime      = 120000
        MaxLifetime      = 120000
        DeathType        = FADED
    End
End

ChildObject DwarvenCatapult_SummonedDain DwarvenCatapult

	Behavior = GrantUpgradeCreate ModuleTag_GrantDwarvenFlamingShot
        UpgradeToGrant = Upgrade_DwarvenFlamingShot
    End
End

ChildObject DwarvenCatapult_AI DwarvenCatapult

    EquivalentTo   = DwarvenCatapult
    CommandPoints  = DEFAULT_SIEGE_COMMANDPOINTS_AI
End

ChildObject DwarvenKanone_AI DwarvenKanone

    EquivalentTo   = DwarvenKanone
    CommandPoints  = DEFAULT_SIEGE_COMMANDPOINTS_AI
End

ChildObject DwarvenCatapult_EredLuin_AI DwarvenCatapult_EredLuin

    EquivalentTo   = DwarvenCatapult_EredLuin
    CommandPoints  = DEFAULT_SIEGE_COMMANDPOINTS_AI
End

ChildObject DwarvenErdenhammer_Erebor_AI DwarvenErdenhammer_Erebor

    EquivalentTo   = DwarvenErdenhammer_Erebor
    CommandPoints  = DEFAULT_SIEGE_COMMANDPOINTS_AI
End