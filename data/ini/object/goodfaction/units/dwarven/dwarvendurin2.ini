Object DwarvenDurin2

    SelectPortrait = HPDurinNew
    ButtonImage    = HiDurinNew

    DescriptionStrategic = CONTROLBAR:LW_Hero_DwarvenThrain

    Draw = W3DScriptedModelDraw ModuleTag_01

        OkToChangeModelColor    = Yes
        StaticModelLODMode        = Yes ;// Will append M or L to the skin name depending on GameLOD

        ;;//====================== MODELS ==================================

        DefaultModelConditionState
            Model               = duthror_ring ;DUDainking_SKN
            Skeleton            = DUDain_SKL
            WeaponLaunchBone    = TERTIARY AXE02
        End

        ModelConditionState = WEAPONSET_HERO_MODE
            ParticleSysBone = BAT_RIBS ThrorAxeMaster FollowBone:Yes
        End
        
        ModelConditionState = WEAPONSET_TOGGLE_1
            Model               = duthror_ring ;DUDainking_SKN
            Skeleton            = DUDain_SKL
            ParticleSysBone     = BAT_HEAD Slayer FollowBone:Yes
        End

        ;;//================== ANIMATIONS =================================================================

        ;//;------------------ MOVING & DYING ---------------------------

        ;//;======= DYING

        AnimationState        = STUNNED_FLAILING
            Animation           = FLYA
                AnimationName     = DUDain_FLYA
                AnimationMode     = LOOP
            End
            Flags               = RANDOMSTART
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End
        
        AnimationState        = DYING SPLATTED
            Animation           = LNDB
                AnimationName     = DUDain_LNDA
                AnimationMode     = ONCE
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End

        AnimationState        = DYING
            Animation           = DIEA
                AnimationName     = DUDain_DTHA
                AnimationMode     = ONCE
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End
        
        AnimationState        = STUNNED_STANDING_UP
            Animation           = GTPA
                AnimationName     = DUDain_GTPA
                AnimationMode     = ONCE
            End
        End
    
        AnimationState        = STUNNED
            Animation           = LNDA
                AnimationName     = DUDain_LNDA
                AnimationMode     = ONCE
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End
            
        AnimationState                        = PARALYZED
            Animation
                AnimationName                = DUDain_IDLA
                AnimationMode                = LOOP
            End
        End

        ;//;======= MOVING
    
    

;        AnimationState        = MOVING FIRING_OR_PREATTACK_A
;            ShareAnimation        = Yes
;            Animation           = RunAndFire
;                AnimationName       = DUDain_ATRA
;                AnimationMode       = LOOP
;            End
;            Flags               = RANDOMSTART 
;        End

        AnimationState                =    MOVING ATTACKING
            Animation                =    RUNB
                AnimationName        =    DUDain_RUNB
                AnimationMode        =    LOOP
            End
            Flags                    =    RANDOMSTART
            ;//ParticleSysBone        =    None InfantryDustTrails
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End
    
        AnimationState                =    MOVING
            Animation                =    RUNA
                AnimationName        =    DUDain_RUNA
                AnimationMode        =    LOOP
            End
            Flags                    =    RANDOMSTART
            ;//ParticleSysBone        =    None InfantryDustTrails
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End


        ;;//------------------ ATTACKING  -------------------------------

        ;// AXE THROW
        AnimationState        = FIRING_OR_PREATTACK_C
            Animation            = SPCA
                AnimationName        = DUDain_SPCA
                AnimationMode        = ONCE
;//                UseWeaponTiming        = Yes
            End
            FrameForPristineBonePositions = 42;44
            ;//ParticleSysBone     = None MeleeDust
            BeginScript
;                CurDrawableShowSubObject("AXE02")
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End

    
        AnimationState        =  FIRING_OR_PREATTACK_A
            Animation           = ATKA
                AnimationName     = DUDain_ATKA
                AnimationMode     = ONCE
                UseWeaponTiming        = Yes
            End
            Animation           = ATKB
                AnimationName     = DUDain_ATKB
                AnimationMode     = ONCE
                UseWeaponTiming        = Yes
            End
            ;//ParticleSysBone None MeleeDust
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End


        ;;//-------------------- HIT REACTIONS --------------------------
        AnimationState = HIT_REACTION
            Animation = Hit_Level_1_a
                AnimationName = DUDain_HITA
                AnimationMode = ONCE
            End
        End
        
        ;;//------------ EMOTIONS ---------------------------------------

        ;;//====== LEVELED
        AnimationState                = LEVELED                         ; This state clears itself in 3 seconds
            Animation                = LevelUp
                AnimationName        = DUDain_CHRA
                AnimationMode        = ONCE
            End
        End

        ;;//====== CELEBRATING
        AnimationState            = EMOTION_CELEBRATING
            Animation           = CHRA
                AnimationName   = DUDain_CHRA
                AnimationMode   = ONCE
            End
            Flags                    =    RESTART_ANIM_WHEN_COMPLETE
        End

        ;;//====== TAUNTING
        AnimationState            = EMOTION_TAUNTING
            Animation
                AnimationName   = DUDain_TNTA
                AnimationMode   = ONCE
            End
            Flags                    =    RESTART_ANIM_WHEN_COMPLETE
        End

        
        AnimationState                    = EMOTION_ALERT
            Animation                    = Ready
                AnimationName            = DUDain_IDLA
                AnimationMode            = LOOP
                AnimationBlendTime  =   15
            End
            BeginScript
;                CurDrawableHideSubObject("AXE02")
;//                Prev = CurDrawablePrevAnimationState()
;//                if Prev == "BORED"        then CurDrawableSetTransitionAnimState("Transition_BoredToReady") end
;//                if Prev == "SELECTED"    then CurDrawableSetTransitionAnimState("Transition_SelectedToReady") end
                if Prev == "State_AboutToHitGround" then CurDrawableSetTransitionAnimState("TRANS_AboutToHitGround_To_Idle") end
            EndScript

        End
        
        AnimationState            = RAISING_FLAG
            Animation           = CHRA
                AnimationName   = DUDain_CHRA
                AnimationMode   = LOOP
            End
        End

        ;;//------------------- SELECTED STATES -------------------------
        
        AnimationState                =    SELECTED
            StateName                =    AtAttentionIdle
            SimilarRestart            =   Yes            
            Animation                =    ATNB
                AnimationName        =     DUDain_ATNB
                AnimationMode        =    LOOP
            End
            BeginScript
;                CurDrawableHideSubObject("AXE02")
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Idle" then CurDrawableSetTransitionAnimState("TRANS_Select") end
                if Prev == "AtAttentionIdle" then CurDrawableSetTransitionAnimState("TRANS_Select") end
                if Prev == "State_AboutToHitGround" then CurDrawableSetTransitionAnimState("TRANS_AboutToHitGround_To_Idle") end
            EndScript
        End
                            
        ;;//--------------- IDLE STATES ---------------------------------

        IdleAnimationState
            StateName                = STATE_Idle
            Animation           = IDLB
                AnimationName     = DUDain_IDLB
                AnimationMode     = ONCE
                AnimationPriority = 10
            End
            Animation           = IDLF
                AnimationName     = DUDain_IDLC
                AnimationMode     = ONCE
                AnimationPriority = 5
            End        
            Animation           = IDLF
                AnimationName     = DUDain_IDLD
                AnimationMode     = ONCE
                AnimationPriority = 5
            End    
            Animation           = IDLF
                AnimationName     = DUDain_IDLE
                AnimationMode     = ONCE
                AnimationPriority = 2
            End    
            BeginScript
;                CurDrawableHideSubObject("AXE02")
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
                if Prev == "AtAttentionIdle" then CurDrawableSetTransitionAnimState("TRANS_SelectedToIdle") end
                if Prev == "State_AboutToHitGround" then CurDrawableSetTransitionAnimState("TRANS_AboutToHitGround_To_Idle") end
            EndScript
        End

        
        ;//---Transitions-------------------------------------

        TransitionState       = TRANS_SelectedToIdle    
            Animation           = ATNC
                AnimationName     = DUDain_ATNC
                AnimationMode     = ONCE
                AnimationSpeedFactorRange = 0.7 1.3
            End
        End
        
        TransitionState                =    TRANS_Select
            Animation                =    ATNA
                AnimationName        =     DUDain_ATNA
                AnimationMode        =    ONCE
            End
        End
    End
    
    Draw = W3DScriptedModelDraw Selected
        ModelConditionState = NONE
            Model           = bbox
        End
    End        



    #include "..\..\..\includes\StunDrawModuleSmall.inc"


    Side                = Dwarves
    EditorSorting       = UNIT
    ThreatLevel         = DAIN_THREAT_LEVEL
    TransportSlotCount  = TRANSPORTSLOTCOUNT_HERO
    BuildCost           = 3000
    BuildTime           = SILMARIL_HERO_BUILDTIME
    ShockwaveResistance = SHOCKWAVE_RESISTANCE_STRONG
    DisplayMeleeDamage    = SILMARIL_HERO_DAMAGE
    MaxSimultaneousOfType = 2
    Scale             	 = 0.88
    HeroSortOrder        = 50


    WeaponSet
        Conditions           = None
        Weapon               = PRIMARY  DwarvenDurinAxe
        AutoChooseSources    = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End

    ArmorSet
        Conditions      = None
        Armor           = FirstAgeStrongHeroArmor
        DamageFX        = NormalDamageFX
    End

    ArmorSet
        Conditions      = PLAYER_UPGRADE
        Armor           = FirstAgeVeryStrongHeroArmor
        DamageFX        = NormalDamageFX
    End


    VisionRange            = 200
    ShroudClearingRange = 350

    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = 200
    VisionBonusPercentPerFoot = 1.0%

    BountyValue     = DWARVEN_DAIN_BOUNTY_VALUE
    DisplayName     = OBJECT:DwarvenDurin
    RecruitText     = CONTROLBAR:DwarvenDainRecruit
    ReviveText        = CONTROLBAR:DwarvenDainRevive
    Hotkey            = CONTROLBAR:DwarvenDurinHotkey
    CrushableLevel    = 4

    CommandSet  = DurinCommandSet
    CommandPoints = 0



    AutoResolveUnitType = AutoResolveUnit_Hero
    AutoResolveCombatChain = AutoResolve_HeroCombatChain

    AutoResolveBody = AutoResolve_DainBody

    AutoResolveArmor
        Armor = AutoResolve_DainArmor
    End

    AutoResolveWeapon
        Weapon = AutoResolve_DainWeapon
    End

    AutoResolveLeadership = AutoResolve_DainBonus




    VoiceAttack                               = DurinVoiceAttack
    VoiceAttackCharge                         = DurinVoiceAttack
    VoiceAttackMachine                        = DurinVoiceAttackStructure
    VoiceAttackStructure                      = DurinVoiceAttackStructure
    VoiceGuard                                = DurinVoiceMove
    VoiceMove                                 = DurinVoiceMove
    VoiceMoveToCamp                           = DurinVoiceMove
    VoiceMoveWhileAttacking                   = DurinVoiceMove
    VoicePriority                             = 95
    VoiceRetreatToCastle                      = DurinVoiceRetreat
    VoiceSelect                               = DurinVoiceSelect
    VoiceSelectBattle                         = DurinVoiceSelectinBattle

    SoundImpact                               = ImpactHorse

    UnitSpecificSounds
        VoiceGarrison                         = DurinVoiceMove
        VoiceEnterUnitElvenTransportShip      = DurinVoiceMove
        VoiceInitiateCaptureBuilding          = DurinVoiceSelect
    End

    CrowdResponseKey = DwarfHero

    #include "..\..\..\includes\StandardUnitEvaEvents.inc"

    Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
        Key = Humanoid_Male Dwarf Dwarf_Male Unit Infantry Hero
    End

    ClientBehavior = ModelConditionAudioLoopClientBehavior ModuleTag_foo
        ModelCondition = Required:EMOTION_CELEBRATING     Excluded:DYING ENGAGED    Sound:EmotionDainVoxCheerLoop
        ModelCondition = Required:EMOTION_TAUNTING        Excluded:DYING ENGAGED    Sound:EmotionDainVoxTauntLoop
        ModelCondition = Required:EMOTION_POINTING        Excluded:DYING ENGAGED    Sound:EmotionDainVoxTauntLoop
        ModelCondition = Required:RAISING_FLAG            Excluded:DYING ENGAGED    Sound:EmotionDainVoxCheerLoop
    End

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound:FootstepDirtA              Animation:DUDain_SKL.DUDain_RUNA    Frames:3 14
        AnimationSound = Sound:FootstepDirtA              Animation:DUDain_SKL.DUDain_RUNB    Frames:3 12
        AnimationSound = Sound:BodyFallSoldier            Animation:DUDain_SKL.DUDain_LNDA    Frames:4
        AnimationSound = Sound:BodyFallSoldier            Animation:DUDain_SKL.DUDain_DIEA    Frames:11
        AnimationSound = Sound:BodyFallSoldier            Animation:DUDain_SKL.DUDain_DIEC    Frames:59
        AnimationSound = Sound:BodyFallSoldier            Animation:DUDAIN_SKL.DUDAIN_DTHA    Frames:73

        AnimationSound = Sound:SwordIntoGroundQuiet       Animation:DUDAIN_SKL.DUDAIN_IDLE    Frames:61
        AnimationSound = Sound:TauntHumanHitShield        Animation:DUDAIN_SKL.DUDAIN_SPCA    Frames:25 50
        AnimationSound = Sound:TauntHumanHitShield        Animation:DUDAIN_SKL.DUDAIN_TNTA    Frames:28 43
    End



    RadarPriority = UNIT
    KindOf = PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE THROWN_OBJECT HERO ATTACK_NEEDS_LINE_OF_SIGHT HEAVY_MELEE_HITTER

    Body = RespawnBody ModuleTag_RespawnBody
        CheerRadius                  = EMOTION_CHEER_RADIUS
        MaxHealth                    = 6000
        PermanentlyKilledByFilter    = NONE
        DodgePercent                 = HERO_DODGE_PERCENT
    End

    Behavior = RespawnUpdate ModuleTag_RespawnUpdate
        DeathAnim                     = DYING
        DeathAnimationTime            = 4000
        RespawnAnim                   = LEVELED
        RespawnAnimationTime          = 2000
        AutoRespawnAtObjectFilter     = NONE +CASTLE_KEEP
        ButtonImage                   = HiDurinNew
        ;AutoRespawnAtObjectFilterRespawnAsTemplate             = ImladrisElrond

        RespawnRules =    AutoSpawn:No           Cost:ELRONDDAG_COST       Time:SILMARIL_HERO_RESPAWNTIME        Health:100%
   End

    Behavior = LifetimeUpdate ModuleTag_LifeTime
        WaitForWakeUp = Yes
    End


    Behavior = SpecialPowerModule ModuleTag_DelayedDeathUpdate
        SpecialPowerTemplate     = SpecialAbilityFakeLeadership2
        UpdateModuleStartsAttack = No
        StartsPaused             = No
    End


    Behavior = GrantUpgradeCreate ModuleTag_BuildHackUpgrade
           UpgradeToGrant        = Upgrade_TestBuilding
           GiveOnBuildComplete   = Yes
    End

    Behavior = ModelConditionUpgrade ModuleTag_ShowTheTower
        TriggeredBy              = Upgrade_TestBuilding
        RequiresAllTriggers      = Yes
        AddConditionFlags        = UPGRADE_FORTRESS_MONUMENT
        AddTempConditionFlag     = ModelConditionState:USER_1
        TempConditionTime        = 1.5
        Permanent                = Yes
    End

    Behavior = AudioLoopUpgrade ModuleTag_DragonNestBuildLoop
        TriggeredBy              = Upgrade_TestBuilding
        SoundToPlay              = BuildingBigConstructionLoop
        KillOnDeath              = Yes
        KillAfterMS              = 2000
    End

    Behavior = AnnounceBirthAndDeathBehavior ModuleTag_AnnounceBirthAndDeathBehavior
    End

    Behavior = AutoHealBehavior ModuleTag_ElvenGiftHealing
        StartsActive                = No
        TriggeredBy                    = Upgrade_ElvenGift
        HealingAmount                = ELVEN_GIFT_REGEN_AMOUNT
        HealingDelay                = ELVEN_GIFT_REGEN_DELAY
        StartHealingDelay            = HERO_HEAL_DELAY
        HealOnlyIfNotInCombat        = Yes
    End

    Behavior = AutoHealBehavior ModuleTag_DainHealing
        StartsActive            = Yes
        HealingAmount           = NAZGUL_HEAL_AMOUNT
        HealingDelay            = 800
        StartHealingDelay       = HERO_HEAL_DELAY
        HealOnlyIfNotInCombat   = Yes
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = Hero
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = AIUpdateInterface ModuleTag_03
        AutoAcquireEnemiesWhenIdle        = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate               = 500
        HoldGroundCloseRangeDistance      = 60
        AILuaEventsList                   = DurinFunctions
    End
	
; --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------	

    LocomotorSet
        Locomotor = RohanGimliLocomotor
        Condition = SET_NORMAL
        Speed     = NORMAL_DWARF_HERO_SPEED
    End

    Behavior = PhysicsBehavior ModuleTag_04
        GravityMult                = 1.0
        AllowBouncing              = No
        ShockStunnedTimeLow        = 1400
        ShockStunnedTimeHigh       = 2400
        ShockStandingTime          = 2600
    End
	
; --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------	

    Behavior = SlowDeathBehavior ModuleTag_05
        DeathTypes           = ALL -KNOCKBACK
        SinkDelay            = 3000
        SinkRate             = 0.40
        DestructionDelay     = 8000
        Sound                = INITIAL DurinVoiceDie
        DeathFlags 	     = DEATH_1
    End

    Behavior = SquishCollide ModuleTag_06
    End

    Behavior = SlowDeathBehavior ModuleTag_07
        DeathTypes            = NONE +KNOCKBACK
        SinkDelay            = 3000
        SinkRate            = 0.40
        DestructionDelay    = 8000
    End

    Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance       =    300
        TauntAndPointUpdateDelay    =    1000
        AddEmotion            =    Doom_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
        AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    Alert_Base
        AddEmotion            =    CheerForAboutToCrush_Base
     End

    Behavior = HitReactionBehavior HitReactionBehaviorModuleTag
        HitReactionLifeTimer1 = 2200
        HitReactionLifeTimer2 = 15
        HitReactionLifeTimer3 = 10

        HitReactionThreshold1 = 1.0
        HitReactionThreshold2 = 2500.0
        HitReactionThreshold3 = 5000.0
    End

; --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_MeisterStarter
        SpecialPowerTemplate            = SpecialAbilityDurinMeisterGestein
        TriggeredBy                     = Upgrade_Level_3
    End

    Behavior = SpecialPowerModule ModuleTag_MeisterDummy
        SpecialPowerTemplate            = SpecialAbilityDurinMeisterGestein
        StartsPaused                    = Yes
        UpdateModuleStartsAttack        = Yes
    End

    Behavior = ActivateModuleSpecialPower ModuleTag_CloseTheGap
        SpecialPowerTemplate            = SpecialAbilityDurinMeisterGestein
        StartAbilityRange               = 200
        TriggerSpecialPower             = ModuleTag_MeisterBuff      TARGETPOS
        TriggerSpecialPower             = ModuleTag_MeisterDebuff    TARGETPOS
        TriggerSpecialPower             = ModuleTag_MeisterHeal      TARGETPOS
    End

    Behavior = SpecialPowerModule ModuleTag_MeisterBuff
        SpecialPowerTemplate            = SpecialAbilityActivateeDummy
        AttributeModifier               = DurinMeisterBuff
        AttributeModifierRange          = 240
        AttributeModifierAffects        = ANY +STRUCTURE +BASE_FOUNDATION -INFANTRY -MONSTER -DOZER -CAVALRY -SHIP -HERO ALLIES
    End

    Behavior = SpecialPowerModule ModuleTag_MeisterDebuff
        SpecialPowerTemplate            = SpecialAbilityActivateeDummy
        AttributeModifier               = DurinMeisterDeBuff
        AttributeModifierRange          = 240
        AttributeModifierAffects        = ANY +STRUCTURE +BASE_FOUNDATION -INFANTRY -MONSTER -DOZER -CAVALRY -SHIP -HERO ENEMIES
        AntiCategory                    = LEADERSHIP BUFF
    End

    Behavior                  = PlayerHealSpecialPower ModuleTag_MeisterHeal
        SpecialPowerTemplate  = SpecialAbilityActivateeDummy
        StartsPaused          = Yes
        HealAmount            = 100000
        HealAsPercent         = No
        HealAffects           = STRUCTURE
        HealRadius            = SPELL_REBUILD_RADIUS_STRUCTURE_SCAN
        HealFX                = FX_SpellRebuild
    End

; --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_WortStarter
        SpecialPowerTemplate            = SpecialAbilityDainMightyRage2
        TriggeredBy                     = Upgrade_Level_10
    End

    Behavior = SpecialPowerModule ModuleTag_WortDummy
        SpecialPowerTemplate            = SpecialAbilityDainMightyRage2
        StartsPaused                    = Yes
        UpdateModuleStartsAttack        = Yes
    End

    Behavior = ActivateModuleSpecialPower ModuleTag_CloseTheGap2
        SpecialPowerTemplate            = SpecialAbilityDainMightyRage2
        StartAbilityRange               = 600
        TriggerSpecialPower             = ModuleTag_WordofSilence1  TARGETPOS
        TriggerSpecialPower             = ModuleTag_WordofSilence2  TARGETPOS
    End

    Behavior = PlayerHealSpecialPower ModuleTag_WordofSilence1
        SpecialPowerTemplate            = SpecialAbilityActivateeDummy
        HealAmount                      = 1.0
        HealAsPercent                   = Yes
        HealAffects                     = INFANTRY CAVALRY HERO DOZER MONSTER
        HealRadius                      = 600
        HealFX                          = FX_SpellHealUnitHealBuff
        InitiateSound                   = DainMightyRage
        TriggerFX                       = FX_DainMightyRage02
    End

    Behavior = SpecialPowerModule ModuleTag_WordofSilence2
        SpecialPowerTemplate            = SpecialAbilityWizardBlast
        UpdateModuleStartsAttack        = Yes
        StartsPaused                    = No
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_NecroFellStrengthBlastWeaponFireUpdate
        SpecialPowerTemplate            = SpecialAbilityWizardBlast
        WhichSpecialWeapon              = 5
        SkipContinue                    = Yes
        FreezeAfterTriggerDuration      = 500
        UnpackTime                      = 500
        PreparationTime                 = 1
        PackTime                        = 500
        AwardXPForTriggering            = 0
        StartAbilityRange               = 300
        SpecialWeapon                   = WortderStilleObjectWeapon
    End

    Behavior = AutoAbilityBehavior ModuleTag_WortAutoAbility
		SpecialAbility		= SpecialAbilityDainMightyRage2
		ForbiddenStatus 	= INSIDE_GARRISON
		MaxScanRange	= 175
		Query			= 20 ALL ENEMIES
    End

; --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_DainLeadership
        SpecialPowerTemplate     = SpecialAbilityFakeLeadership
        TriggeredBy              = Upgrade_Level_5
    End

    Behavior = SpecialPowerModule ModuleTag_DainLeadershipUpdate
        SpecialPowerTemplate     = SpecialAbilityFakeLeadership
        UpdateModuleStartsAttack = No
        StartsPaused             = Yes
    End

    Behavior = AttributeModifierAuraUpdate ModuleTag_Leadership
        StartsActive     = No
        BonusName        = DurinLeadership
        TriggeredBy      = Upgrade_Level_5
        RefreshDelay     = 2000
        Range            = 400
        ObjectFilter     = ANY +HERO -INFANTRY -CAVALRY -MACHINE -STRUCTURE -MONSTER +DOZER ALLIES
    End

    Behavior = AttributeModifierAuraUpdate ModuleTag_Leadership2
        StartsActive     = Yes
        BonusName        = DurinLeadership2
		TriggeredBy      = Upgrade_Level_5
        RefreshDelay     = 2000
        Range            = 400
        ObjectFilter     = ALL -HERO -MACHINE -SHIP -DOZER -STRUCTURE ALLIES
    End

; --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_SchmiedefeuerEnabler
        SpecialPowerTemplate       = SpecialAbilityAulesSchmiedefeuer
        TriggeredBy                = Upgrade_Level_7
    End

    Behavior = SpecialPowerModule ModuleTag_SchmiedefeuerStarter
        SpecialPowerTemplate       = SpecialAbilityAulesSchmiedefeuer
        UpdateModuleStartsAttack   = Yes
        StartsPaused               = Yes
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_SchmiedefeuerWeaponFireUpdate
        SpecialPowerTemplate       = SpecialAbilityAulesSchmiedefeuer
        WhichSpecialWeapon         = 1
        SkipContinue               = Yes
        UnpackTime                 = 1700
        PackTime                   = 1
        FreezeAfterTriggerDuration = 5000
        AwardXPForTriggering       = 0
        StartAbilityRange          = 80.0
        SpecialWeapon              = DurinSchmiedefeuerWeapon
    End

    Behavior = AutoAbilityBehavior ModuleTag_SchmiedefeuerAutoAbility
        SpecialAbility             = SpecialAbilityAulesSchmiedefeuer
        MaxScanRange               = 80
        Query                      = 3 ANY +HORDE +MACHINE ENEMIES
        Query                      = 1 ANY +HERO +MONSTER NOT_FLYING_UNITS
    End
	
; --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------	

    Behavior = ObjectCreationUpgrade MaketheEagle
        TriggeredBy                     = Upgrade_TestBuilding
        Delay                           = 10.0
        ThingToSpawn                    = SevenFathers_01
        Offset                          = X:20.0 Y:0.0 Z:0.0
        FadeInTime                      = 100
    End

    Behavior = ObjectCreationUpgrade MaketheEagle2
        TriggeredBy                     = Upgrade_TestBuilding
        Delay                           = 20.0
        ThingToSpawn                    = SevenFathers_02
        Offset                          = X:-20.0 Y:0.0 Z:0.0
        FadeInTime                      = 100
    End

    Behavior = ObjectCreationUpgrade MaketheEagle3
        TriggeredBy                     = Upgrade_TestBuilding
        Delay                           = 30.0
        ThingToSpawn                    = SevenFathers_03
        Offset                          = X:0.0 Y:20.0 Z:0.0
        FadeInTime                      = 100
    End

    Behavior = ObjectCreationUpgrade MaketheEagle4
        TriggeredBy                     = Upgrade_TestBuilding
        Delay                           = 40.0
        ThingToSpawn                    = SevenFathers_04
        Offset                          = X:20.0 Y:-20.0 Z:0.0
        FadeInTime                      = 100
    End

    Behavior = ObjectCreationUpgrade MaketheEagle5
        TriggeredBy                     = Upgrade_TestBuilding
        Delay                           = 50.0
        ThingToSpawn                    = SevenFathers_05
        Offset                          = X:20.0 Y:20.0 Z:0.0
        FadeInTime                      = 100
    End

    Behavior = ObjectCreationUpgrade MaketheEagle6
        TriggeredBy                     = Upgrade_TestBuilding
        Delay                           = 60.0
        ThingToSpawn                    = SevenFathers_06
        Offset                          = X:-20.0 Y:20.0 Z:0.0
        FadeInTime                      = 100
    End

    Behavior = SlaveWatcherBehavior WatchTheEagle
        RemoveUpgrade                   = Upgrade_TestBuilding
        LetSlaveLive                    = Yes
    End

; --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    Behavior = ArmorUpgrade ModuleTag_ArmorUpgradeMithril
        TriggeredBy     = Upgrade_Level_10
        ArmorSetFlag    = PLAYER_UPGRADE
    End

    Behavior = SubObjectsUpgrade ModuleTag_MithrilSkinwelchsel
        TriggeredBy     = Upgrade_Level_10
        UpgradeTexture  = dudain.tga 0 dudain_ha.tga
    End

; --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    Behavior = AttributeModifierAuraUpdate ModuleTag_DisableSecondDurin1
		StartsActive			= Yes
		BonusName				= DisableDurinSecondModifier1
		RefreshDelay				= 3000
		Range					= 999999999
		ObjectFilter			= ANY +DwarfMausoleum +BFME1DwarfMausoleum
    End

; --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    ;Behavior = AISpecialPowerUpdate RoyalGuardAI
        ;CommandButtonName = Command_SpecialAbilityDurinstag
        ;SpecialPowerAIType = AI_SPECIAL_POWER_TARGETAOE_SUMMON
        ;SpecialPowerRadius = 30.0
    ;End

    Behavior = AISpecialPowerUpdate ShakeFoundationAI
        CommandButtonName = Command_SpecialAbilityDurinMeisterGestein
        SpecialPowerAIType    = AI_SPECIAL_POWER_ENEMY_TYPE_KILLER_STRUCTURES
        SpecialPowerRange    = 200
    End

    Behavior = AISpecialPowerUpdate GandalfWordOfPowerAI
        CommandButtonName = Command_SpecialAbilityAulesSchmiedefeuer
        SpecialPowerAIType = AI_SPECIAL_POWER_BASIC_SELF_BUFF
        SpecialPowerRadius = 250
    End

    Behavior = AISpecialPowerUpdate Summmon_AI
        CommandButtonName  = Command_DurinSummonSevenFathers
        SpecialPowerAIType = AI_SPECIAL_POWER_BASIC_SELF_BUFF
    End

    Geometry            = CYLINDER
    GeometryMajorRadius = 5.6
    GeometryMinorRadius = 5.6
    GeometryHeight      = 16.0
    GeometryIsSmall     = Yes

    Shadow              = SHADOW_DECAL
    ShadowSizeX         = 19
    ShadowSizeY         = 19
    ShadowTexture       = ShadowI
End



Object DwarvenDurin_Summoned

    SelectPortrait = HPDurinNew
    ButtonImage    = HiDurinNew

    DescriptionStrategic = CONTROLBAR:LW_ToolTip_Dain

    Draw = W3DScriptedModelDraw ModuleTag_01

        OkToChangeModelColor    = Yes
        StaticModelLODMode      = Yes

        RandomTexture = dudurin_cloak.tga  0 dudwarfberserker.tga

        DefaultModelConditionState
            Model               = DUDurin_SKN
            Skeleton            = DUDain_SKL
            WeaponLaunchBone    = TERTIARY AXE02
        End

        ModelConditionState     = WORLD_BUILDER
            Model               = DUDurin_SKN
            Skeleton            = DUDain_SKL
            WeaponLaunchBone    = TERTIARY AXE02
        End


        AnimationState        = STUNNED_FLAILING
            Animation           = FLYA
                AnimationName     = DUDain_FLYA
                AnimationMode     = LOOP
            End
            Flags               = RANDOMSTART
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End

        AnimationState        = DYING SPLATTED DEATH_1
            Animation           = LNDB
                AnimationName     = DUDain_LNDA
                AnimationMode     = ONCE
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End

        AnimationState        = DYING DEATH_1
            Animation           = DIEA
                AnimationName     = DUDain_DTHA
                AnimationMode     = ONCE
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End

        AnimationState        = DYING DEATH_2
            Animation           = ByeBye
                AnimationName     = DUDain_IDLA
                AnimationMode     = LOOP
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End

        AnimationState        = STUNNED_STANDING_UP
            Animation           = GTPA
                AnimationName     = DUDain_GTPA
                AnimationMode     = ONCE
            End
        End

        AnimationState        = STUNNED
            Animation           = LNDA
                AnimationName     = DUDain_LNDA
                AnimationMode     = ONCE
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End

        AnimationState                        = PARALYZED
            Animation
                AnimationName                = DUDain_IDLA
                AnimationMode                = LOOP
            End
        End




        AnimationState                =    MOVING ATTACKING
            Animation                =    RUNB
                AnimationName        =    DUDain_RUNB
                AnimationMode        =    LOOP
            End
            Flags                    =    RANDOMSTART

            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End

        AnimationState                =    MOVING
            Animation                =    RUNA
                AnimationName        =    DUDain_RUNA
                AnimationMode        =    LOOP
            End
            Flags                    =    RANDOMSTART

            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End





        AnimationState        = FIRING_OR_PREATTACK_C
            Animation            = SPCA
                AnimationName        = DUDain_SPCA
                AnimationMode        = ONCE

            End
            FrameForPristineBonePositions = 42

            BeginScript

                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End


        AnimationState        =  FIRING_OR_PREATTACK_A
            Animation           = ATKA
                AnimationName     = DUDain_ATKA
                AnimationMode     = ONCE
                UseWeaponTiming        = Yes
            End
            Animation           = ATKB
                AnimationName     = DUDain_ATKB
                AnimationMode     = ONCE
                UseWeaponTiming        = Yes
            End
            Animation           = ATKC
                AnimationName     = DUDain_ATKC
                AnimationMode     = ONCE
                UseWeaponTiming        = Yes
            End

            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End

        AnimationState        = SPECIAL_WEAPON_THREE
            Animation
                AnimationName     = DUDain_SPCB
                AnimationMode     = ONCE
            End
        End

        AnimationState        = SPECIAL_WEAPON_ONE
            Animation
                AnimationName     = DUDain_SPCA
                AnimationMode     = ONCE
            End
        End


        AnimationState = HIT_REACTION
            Animation = Hit_Level_1_a
                AnimationName = DUDain_HITA
                AnimationMode = ONCE
            End
        End




        AnimationState                = LEVELED
            Animation                = LevelUp
                AnimationName        = DUDain_CHRA
                AnimationMode        = ONCE
            End
        End


        AnimationState            = EMOTION_CELEBRATING
            Animation           = CHRA
                AnimationName   = DUDain_CHRA
                AnimationMode   = ONCE
            End
            Flags                    =    RESTART_ANIM_WHEN_COMPLETE
        End


        AnimationState            = EMOTION_TAUNTING
            Animation
                AnimationName   = DUDain_TNTA
                AnimationMode   = ONCE
            End
            Flags                    =    RESTART_ANIM_WHEN_COMPLETE
        End


        AnimationState                    = EMOTION_ALERT
            Animation                    = Ready
                AnimationName            = DUDain_IDLA
                AnimationMode            = LOOP
                AnimationBlendTime  =   15
            End
            BeginScript




                if Prev == "State_AboutToHitGround" then CurDrawableSetTransitionAnimState("TRANS_AboutToHitGround_To_Idle") end
            EndScript

        End

        AnimationState            = RAISING_FLAG
            Animation           = CHRA
                AnimationName   = DUDain_CHRA
                AnimationMode   = LOOP
            End
        End



        AnimationState                =    SELECTED
            StateName                =    AtAttentionIdle
            SimilarRestart            =   Yes
            Animation                =    ATNB
                AnimationName        =     DUDain_ATNB
                AnimationMode        =    LOOP
            End
            BeginScript

                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Idle" then CurDrawableSetTransitionAnimState("TRANS_Select") end
                if Prev == "AtAttentionIdle" then CurDrawableSetTransitionAnimState("TRANS_Select") end
                if Prev == "State_AboutToHitGround" then CurDrawableSetTransitionAnimState("TRANS_AboutToHitGround_To_Idle") end
            EndScript
        End



        IdleAnimationState
            StateName                = STATE_Idle
            Animation           = IDLB
                AnimationName     = DUDain_IDLB
                AnimationMode     = ONCE
                AnimationPriority = 10
            End
            Animation           = IDLF
                AnimationName     = DUDain_IDLC
                AnimationMode     = ONCE
                AnimationPriority = 5
            End
            Animation           = IDLF
                AnimationName     = DUDain_IDLD
                AnimationMode     = ONCE
                AnimationPriority = 5
            End
            Animation           = IDLF
                AnimationName     = DUDain_IDLE
                AnimationMode     = ONCE
                AnimationPriority = 2
            End
            BeginScript

                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
                if Prev == "AtAttentionIdle" then CurDrawableSetTransitionAnimState("TRANS_SelectedToIdle") end
                if Prev == "State_AboutToHitGround" then CurDrawableSetTransitionAnimState("TRANS_AboutToHitGround_To_Idle") end
            EndScript
        End




        TransitionState       = TRANS_SelectedToIdle
            Animation           = ATNC
                AnimationName     = DUDain_ATNC
                AnimationMode     = ONCE
                AnimationSpeedFactorRange = 0.7 1.3
            End
        End

        TransitionState                =    TRANS_Select
            Animation                =    ATNA
                AnimationName        =     DUDain_ATNA
                AnimationMode        =    ONCE
            End
        End
    End

    Draw = W3DScriptedModelDraw Icon
        ModelConditionState = NONE
            Model           = bbox
        End
    End
	
	#include "..\..\..\includes\StunDrawModuleSmall.inc"


    Side                = Dwarves
    EditorSorting       = UNIT
    ThreatLevel         = DAIN_THREAT_LEVEL
    TransportSlotCount  = TRANSPORTSLOTCOUNT_HERO
    BuildCost           = SILMARIL_HERO_COST
    BuildTime           = SILMARIL_HERO_BUILDTIME
    ShockwaveResistance = SHOCKWAVE_RESISTANCE_STRONG
    DisplayMeleeDamage    = VERY_WEAK_HERO_DAMAGE
    MaxSimultaneousOfType = 2
    Scale                = 0.88
    HeroSortOrder        = 50

    WeaponSet
        Conditions           = None
        Weapon               = PRIMARY  DwarvenDurinAxeGhost
        AutoChooseSources    = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End

    ArmorSet
        Conditions      = None
        Armor           = DwarvenGuardianArmor
    End


    VisionRange               = 200
    ShroudClearingRange       = 350

    MaxVisionBonusPercent     = 300%
    VisionBonusTestRadius     = 200
    VisionBonusPercentPerFoot = 1.0%

    BountyValue     = DWARVEN_DAIN_BOUNTY_VALUE
    DisplayName     = OBJECT:DwarvenDurinGhost
    RecruitText     = CONTROLBAR:DwarvenDainRecruit
    ReviveText      = CONTROLBAR:DwarvenDainRevive
    Hotkey          = CONTROLBAR:DwarvenDurinHotkey
    CrushableLevel  = 4

    CommandSet      = DurinCommandSet_Summoned
    IsTrainable     = No
    CommandPoints   = 0



    AutoResolveUnitType = AutoResolveUnit_Hero
    AutoResolveCombatChain = AutoResolve_HeroCombatChain

    AutoResolveBody = AutoResolve_DainBody

    AutoResolveArmor
        Armor = AutoResolve_DainArmor
    End

    AutoResolveWeapon
        Weapon = AutoResolve_DainWeapon
    End

    AutoResolveLeadership = AutoResolve_DainBonus




    VoiceAttack                               = DurinVoiceAttack
    VoiceAttackCharge                         = DurinVoiceAttack
    VoiceAttackMachine                        = DurinVoiceAttackStructure
    VoiceAttackStructure                      = DurinVoiceAttackStructure
    VoiceGuard                                = DurinVoiceMove
    VoiceMove                                 = DurinVoiceMove
    VoiceMoveToCamp                           = DurinVoiceMove
    VoiceMoveWhileAttacking                   = DurinVoiceMove
    VoicePriority                             = 95
    VoiceRetreatToCastle                      = DurinVoiceRetreat
    VoiceSelect                               = DurinVoiceSelect
    VoiceSelectBattle                         = DurinVoiceSelectinBattle

    SoundImpact                               = ImpactHorse

    UnitSpecificSounds
        VoiceGarrison                         = DurinVoiceMove
        VoiceEnterUnitElvenTransportShip      = DurinVoiceMove
        VoiceInitiateCaptureBuilding          = DurinVoiceSelect
    End

    CrowdResponseKey = DwarfHero

    #include "..\..\..\includes\StandardUnitEvaEvents.inc"


    Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
        Key = Humanoid_Male Dwarf Dwarf_Male Unit Infantry Hero
    End

    ClientBehavior = ModelConditionAudioLoopClientBehavior ModuleTag_foo
        ModelCondition = Required:EMOTION_CELEBRATING    Excluded:DYING ENGAGED    Sound:EmotionDainVoxCheerLoop
        ModelCondition = Required:EMOTION_TAUNTING        Excluded:DYING ENGAGED    Sound:EmotionDainVoxTauntLoop
        ModelCondition = Required:EMOTION_POINTING        Excluded:DYING ENGAGED    Sound:EmotionDainVoxTauntLoop
        ModelCondition = Required:RAISING_FLAG            Excluded:DYING ENGAGED    Sound:EmotionDainVoxCheerLoop
    End

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound:FootstepDirtA            Animation:DUDain_SKL.DUDain_RUNA    Frames:3 14
        AnimationSound = Sound:FootstepDirtA            Animation:DUDain_SKL.DUDain_RUNB    Frames:3 12
        AnimationSound = Sound:BodyFallSoldier          Animation:DUDain_SKL.DUDain_LNDA    Frames:4
        AnimationSound = Sound:BodyFallSoldier          Animation:DUDain_SKL.DUDain_DIEA    Frames:11
        AnimationSound = Sound:BodyFallSoldier          Animation:DUDain_SKL.DUDain_DIEC    Frames:59
        AnimationSound = Sound:BodyFallSoldier          Animation:DUDAIN_SKL.DUDAIN_DTHA    Frames:73

        AnimationSound = Sound:SwordIntoGroundQuiet     Animation:DUDAIN_SKL.DUDAIN_IDLE    Frames:61
        AnimationSound = Sound:TauntHumanHitShield      Animation:DUDAIN_SKL.DUDAIN_SPCA    Frames:25 50
        AnimationSound = Sound:TauntHumanHitShield      Animation:DUDAIN_SKL.DUDAIN_TNTA    Frames:28 43
    End



    RadarPriority = UNIT
    KindOf = PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE THROWN_OBJECT HERO ATTACK_NEEDS_LINE_OF_SIGHT HEAVY_MELEE_HITTER SUMMONED


    Body = RespawnBody ModuleTag_RespawnBody
        CheerRadius                 = EMOTION_CHEER_RADIUS
        MaxHealth                   = SILMARIL_HERO_HEALTH
        PermanentlyKilledByFilter   = NONE
        DodgePercent                = HERO_DODGE_PERCENT
    End

    Behavior = SpecialPowerModule ModuleTag_DelayedDeathUpdate
        SpecialPowerTemplate     = SpecialAbilityFakeLeadership2
        UpdateModuleStartsAttack = No
        StartsPaused             = No
    End

    Behavior = GrantUpgradeCreate ModuleTag_BuildHackUpgrade
           UpgradeToGrant        = Upgrade_TestBuilding
           GiveOnBuildComplete   = Yes
    End

    Behavior = ModelConditionUpgrade ModuleTag_ShowTheTower
        TriggeredBy              = Upgrade_TestBuilding
        RequiresAllTriggers      = Yes
        AddConditionFlags        = UPGRADE_FORTRESS_MONUMENT
        AddTempConditionFlag     = ModelConditionState:USER_1
        TempConditionTime        = 1.5
        Permanent                = Yes
    End

    Behavior = AudioLoopUpgrade ModuleTag_DragonNestBuildLoop
        TriggeredBy              = Upgrade_TestBuilding
        SoundToPlay              = BuildingBigConstructionLoop
        KillOnDeath              = Yes
        KillAfterMS              = 2000
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = Hero
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = AIUpdateInterface ModuleTag_03
        AutoAcquireEnemiesWhenIdle        = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate               = 500
        HoldGroundCloseRangeDistance      = 60
        AILuaEventsList                   = DurinFunctionsSummoned
    End

    LocomotorSet
        Locomotor = RohanGimliLocomotor
        Condition = SET_NORMAL
        Speed     = NORMAL_DWARF_HERO_SPEED
    End

    Behavior = PhysicsBehavior ModuleTag_04
        GravityMult              = 1.0
        AllowBouncing            = No
        ShockStunnedTimeLow      = 1400
        ShockStunnedTimeHigh     = 2400
        ShockStandingTime        = 2600
    End

    Behavior = SlowDeathBehavior ModuleTag_05
        DeathTypes            = ALL -KNOCKBACK
        SinkDelay             = 3000
        SinkRate              = 0.40
        DestructionDelay      = 8000
        Sound                 = INITIAL DurinVoiceDie
        DeathFlags            = DEATH_1
    End

    Behavior = LifetimeUpdate ModuleTag_LifetimeUpdate
        MinLifetime      = 180000
        MaxLifetime      = 180000
        DeathType        = FADED
    End

      Behavior = SlowDeathBehavior ModuleTag_FadeDeath
        DeathTypes = NONE +FADED
        FadeDelay = 0
        FadeTime = 2500
        DestructionDelay = 2500
        Sound = INITIAL SpellGenericUnsummonFasterMS
        DeathFlags = DEATH_2
    End

    Behavior = SquishCollide ModuleTag_06
    End

    Behavior = SlowDeathBehavior ModuleTag_07
        DeathTypes          = NONE +KNOCKBACK
        SinkDelay           = 3000
        SinkRate            = 0.40
        DestructionDelay    = 8000
    End

    Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance       =    300
        TauntAndPointUpdateDelay    =    1000
        AddEmotion            =    Doom_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
        AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    Alert_Base
        AddEmotion            =    CheerForAboutToCrush_Base
     End

    Behavior = HitReactionBehavior HitReactionBehaviorModuleTag
        HitReactionLifeTimer1 = 2200
        HitReactionLifeTimer2 = 15
        HitReactionLifeTimer3 = 10

        HitReactionThreshold1 = 1.0
        HitReactionThreshold2 = 2500.0
        HitReactionThreshold3 = 5000.0
    End

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_SilmarilHeroLeadershipStart
        SpecialPowerTemplate    = SpecialAbilityFakeLeadership3
    End

    Behavior = SpecialPowerModule ModuleTag_SilmarilHeroLeadershipUpdate
        SpecialPowerTemplate        = SpecialAbilityFakeLeadership3
        UpdateModuleStartsAttack    = No
        StartsPaused                = No
    End

    Behavior = AttributeModifierAuraUpdate ModuleTag_SilmarilHeroLeadership
        StartsActive     = Yes
        BonusName        = SilmarilHeroGlobalLeadership
        RefreshDelay     = 2000
        Range            = 1250
	    TargetEnemy	 = No
        ObjectFilter     = ALL -HERO -MACHINE -SHIP -DOZER -STRUCTURE ALLIES
    End


    Behavior = CitadelSlaughterHordeContain ModuleTag_SlaughterMe
        PassengerFilter              = NONE +TheDroppedRing
        ObjectStatusOfContained      = UNSELECTABLE ENCLOSED
        ContainMax                   = 1
        AllowEnemiesInside           = No
        AllowAlliesInside            = Yes
        AllowNeutralInside           = No
        AllowOwnPlayerInsideOverride = Yes
        EntryOffset                  = X:0.0 Y:0.0 Z:0.0
        EntryPosition                = X:0.0 Y:0.0 Z:0.0
        ExitOffset                   = X:0.0 Y:0.0 Z:0.0
        StatusForRingEntry           = HOLDING_THE_RING
        UpgradeForRingEntry          = Upgrade_RingHero Upgrade_FortressRingHero
        ObjectToDestroyForRingEntry  = NONE +TheDroppedRing
        FXForRingEntry               = FX_OneRingFlare
    End

    Behavior = ModelConditionUpgrade ModulTag_RingHeroMC
        TriggeredBy         	= Upgrade_RingHero Upgrade_FortressRingHero
        RequiresAllTriggers 	= Yes
        AddConditionFlags   	= ONE_RING
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly 		= Yes
        StuffToPickUp 		= NONE +TheDroppedRing
        ScanRange 		= 3000
        ScanIntervalSeconds 	= 0.5
    End


    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_SilmarilHeroEnabler
        SpecialPowerTemplate 		= SpecialAbilityGandalfGeprufte
		TriggeredBy			= Upgrade_RingHero
    End

    Behavior = SpecialPowerModule ModuleTag_SilmarilHeroStarter
         SpecialPowerTemplate           = SpecialAbilityGandalfGeprufte
         UpdateModuleStartsAttack       = Yes
         StartsPaused                   = Yes
    End

    Behavior = ToggleMountedSpecialAbilityUpdate ModuleTag_SilmarilHero
         SpecialPowerTemplate           = SpecialAbilityGandalfGeprufte
         MountedTemplate                = DwarvenDurin
         SynchronizeTimerOnSpecialPower = SpecialAbilityDurinMeisterGestein SpecialAbilityDainMightyRage SpecialPowerDurinSpawn
         UnpackTime                     = OBJECT_TOGGLE_TIME
         PreparationTime                = 0
         PackTime                       = 0
         OpacityTarget                  = .0
         AwardXPForTriggering           = 0
         IgnoreFacingCheck              = Yes
    End

    Behavior = DoCommandUpgrade Module_DoCommandSilmarilHero
        TriggeredBy                     = Upgrade_RingHero
        GetUpgradeCommandButtonName     = Command_SpecialAbilityGlorfindelRingSwitch
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End


    Geometry            = CYLINDER
    GeometryMajorRadius = 5.6
    GeometryMinorRadius = 5.6
    GeometryHeight      = 16.0
    GeometryIsSmall     = Yes

    Shadow              = SHADOW_DECAL
    ShadowSizeX         = 19
    ShadowSizeY         = 19
    ShadowTexture       = ShadowI
End