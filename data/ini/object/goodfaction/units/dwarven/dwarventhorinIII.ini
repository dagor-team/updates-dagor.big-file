Object DwarvenThorinIII

    SelectPortrait = HPStonehelm
    ButtonImage    = HIStonehelm

    DescriptionStrategic = CONTROLBAR:LW_ToolTip_LeaderHero

    Draw = W3DScriptedModelDraw ModuleTag_01

        OkToChangeModelColor     = Yes
        StaticModelLODMode       = Yes

        DefaultModelConditionState
            Model               = duthorinIII_skn
            Skeleton            = DUDain_SKL
            WeaponLaunchBone    = TERTIARY AXE02
        End

        ModelConditionState     = WEAPONSET_HERO_MODE
        End


        AnimationState        = STUNNED_FLAILING
            Animation           = FLYA
                AnimationName     = DUDain_FLYA
                AnimationMode     = LOOP
            End
            Flags               = RANDOMSTART
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End

        AnimationState        = DYING SPLATTED
            Animation           = LNDB
                AnimationName     = DUDain_LNDA
                AnimationMode     = ONCE
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End

        AnimationState        = DYING
            Animation           = DIEA
                AnimationName     = DUDain_DTHA
                AnimationMode     = ONCE
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End

        AnimationState        = STUNNED_STANDING_UP
            Animation           = GTPA
                AnimationName     = DUDain_GTPA
                AnimationMode     = ONCE
            End
        End

        AnimationState        = STUNNED
            Animation           = LNDA
                AnimationName     = DUDain_LNDA
                AnimationMode     = ONCE
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End

        AnimationState                        = PARALYZED
            Animation
                AnimationName                = DUDain_IDLA
                AnimationMode                = LOOP
            End
        End














        AnimationState                =    MOVING ATTACKING
            Animation                =    RUNB
                AnimationName        =    DUDain_RUNB
                AnimationMode        =    LOOP
            End
            Flags                    =    RANDOMSTART

            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End

        AnimationState                =    MOVING
            Animation                =    RUNA
                AnimationName        =    DUDain_RUNA
                AnimationMode        =    LOOP
            End
            Flags                    =    RANDOMSTART

            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End





        AnimationState        = FIRING_OR_PREATTACK_C
            Animation            = SPCA
                AnimationName        = DUDain_SPCA
                AnimationMode        = ONCE

            End
            FrameForPristineBonePositions = 42

            BeginScript

                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End


        AnimationState        =  FIRING_OR_PREATTACK_A
            Animation           = ATKA
                AnimationName     = DUDain_ATKA
                AnimationMode     = ONCE
                UseWeaponTiming        = Yes
            End
            Animation           = ATKB
                AnimationName     = DUDain_ATKB
                AnimationMode     = ONCE
                UseWeaponTiming        = Yes
            End

            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End



        AnimationState        =  SPECIAL_WEAPON_ONE
            Animation           = ATKA
                AnimationName     = DUDain_ATKA
                AnimationMode     = ONCE
            End
            Animation           = ATKB
                AnimationName     = DUDain_ATKB
                AnimationMode     = ONCE
            End
            ParticleSysBone = NONE GloinBlastSlam    FollowBone:Yes
        End

        AnimationState        =  SPECIAL_WEAPON_THREE
            Animation           = SPCA
                AnimationName   = DUDain_SPCA
                AnimationMode   = ONCE
            End
            Animation           = SPCB
                AnimationName   = DUDain_SPCB
                AnimationMode   = ONCE
            End
        End

        AnimationState          =    PACKING_TYPE_1
            StateName          =    Attacking
            Animation           = SPCA
                AnimationName   = DUDain_SPCA
                AnimationMode   = ONCE
            End
            Animation           = SPCB
                AnimationName   = DUDain_SPCB
                AnimationMode   = ONCE
            End
        End



        AnimationState = HIT_REACTION
            Animation = Hit_Level_1_a
                AnimationName = DUDain_HITA
                AnimationMode = ONCE
            End
        End




        AnimationState                = LEVELED
            Animation                = LevelUp
                AnimationName        = DUDain_CHRA
                AnimationMode        = ONCE
            End
        End


        AnimationState            = EMOTION_CELEBRATING
            Animation           = CHRA
                AnimationName   = DUDain_CHRA
                AnimationMode   = ONCE
            End
            Flags                    =    RESTART_ANIM_WHEN_COMPLETE
        End


        AnimationState            = EMOTION_TAUNTING
            Animation
                AnimationName   = DUDain_TNTA
                AnimationMode   = ONCE
            End
            Flags                    =    RESTART_ANIM_WHEN_COMPLETE
        End


        AnimationState                    = EMOTION_ALERT
            Animation                    = Ready
                AnimationName            = DUDain_IDLA
                AnimationMode            = LOOP
                AnimationBlendTime  =   15
            End
            BeginScript




                if Prev == "State_AboutToHitGround" then CurDrawableSetTransitionAnimState("TRANS_AboutToHitGround_To_Idle") end
            EndScript

        End

        AnimationState            = RAISING_FLAG
            Animation           = CHRA
                AnimationName   = DUDain_CHRA
                AnimationMode   = LOOP
            End
        End



        AnimationState                =    SELECTED
            StateName                =    AtAttentionIdle
            SimilarRestart            =   Yes
            Animation                =    ATNB
                AnimationName        =     DUDain_ATNB
                AnimationMode        =    LOOP
            End
            BeginScript

                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Idle" then CurDrawableSetTransitionAnimState("TRANS_Select") end
                if Prev == "AtAttentionIdle" then CurDrawableSetTransitionAnimState("TRANS_Select") end
                if Prev == "State_AboutToHitGround" then CurDrawableSetTransitionAnimState("TRANS_AboutToHitGround_To_Idle") end
            EndScript
        End



        IdleAnimationState
            StateName                = STATE_Idle
            Animation           = IDLB
                AnimationName     = DUDain_IDLB
                AnimationMode     = ONCE
                AnimationPriority = 10
            End
            Animation           = IDLF
                AnimationName     = DUDain_IDLC
                AnimationMode     = ONCE
                AnimationPriority = 5
            End
            Animation           = IDLF
                AnimationName     = DUDain_IDLD
                AnimationMode     = ONCE
                AnimationPriority = 5
            End
            Animation           = IDLF
                AnimationName     = DUDain_IDLE
                AnimationMode     = ONCE
                AnimationPriority = 2
            End
            BeginScript

                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
                if Prev == "AtAttentionIdle" then CurDrawableSetTransitionAnimState("TRANS_SelectedToIdle") end
                if Prev == "State_AboutToHitGround" then CurDrawableSetTransitionAnimState("TRANS_AboutToHitGround_To_Idle") end
            EndScript
        End




        TransitionState       = TRANS_SelectedToIdle
            Animation           = ATNC
                AnimationName     = DUDain_ATNC
                AnimationMode     = ONCE
                AnimationSpeedFactorRange = 0.7 1.3
            End
        End

        TransitionState                =    TRANS_Select
            Animation                =    ATNA
                AnimationName        =     DUDain_ATNA
                AnimationMode        =    ONCE
            End
        End
    End

    Draw = W3DScriptedModelDraw Icon
        ModelConditionState = NONE
            Model           = bbox
        End
    End





    #include "..\..\..\includes\StunDrawModuleSmall.inc"


    Side                = Dwarves
    EditorSorting        = UNIT
    ThreatLevel            = DAIN_THREAT_LEVEL
    TransportSlotCount    = TRANSPORTSLOTCOUNT_HERO
    BuildCost           = THORIN2DAG_COST
    BuildTime           = MEDIUM_HERO_BUILDTIME
    DisplayMeleeDamage    = THORIN2DAG_DAMAGE
    Scale             = 0.88
    HeroSortOrder        = 40

    WeaponSet
        Conditions         = None
        Weapon             = PRIMARY  DwarvenThorinIIIWeapon
        AutoChooseSources  = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End

    ArmorSet
        Conditions      = None
        Armor           = StrongHeroArmor
        DamageFX        = NormalDamageFX
    End

    ArmorSet
        Conditions      = PLAYER_UPGRADE
        Armor           = VeryStrongHeroArmor
        DamageFX        = NormalDamageFX
    End

    VisionRange         = 200
    ShroudClearingRange = 300

    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = 200
    VisionBonusPercentPerFoot = 1.0%

    BountyValue     = DWARVEN_DAIN_BOUNTY_VALUE
    DisplayName     = OBJECT:DwarvenThorinIII
    RecruitText     = CONTROLBAR:DwarvenThorinIIIRecruit
    ReviveText      = CONTROLBAR:DwarvenThorinIIIRevive
    Hotkey          = CONTROLBAR:DwarvenThorinIIIHotkey
    CrushableLevel  = 2

    CommandSet  = ThorinIIICommandSet
    CommandPoints = 0



    AutoResolveUnitType = AutoResolveUnit_Hero
    AutoResolveCombatChain = AutoResolve_HeroCombatChain

    AutoResolveBody = AutoResolve_DainBody

    AutoResolveArmor
        Armor = AutoResolve_DainArmor
    End

    AutoResolveWeapon
        Weapon = AutoResolve_DainWeapon
    End

    AutoResolveLeadership = AutoResolve_DainBonus




            VoiceAttack                 = SteinhelmVoiceAttack
            VoiceAttackAir              = SteinhelmVoiceAttack
            VoiceAttackCharge           = SteinhelmVoiceAttack
            VoiceAttackMachine          = SteinhelmVoiceAttack
            VoiceAttackStructure        = SteinhelmVoiceAttack
            VoiceCreated                = SteinhelmVoiceSelect
            VoiceFear                   = SteinhelmVoiceHelpMe
            VoiceFullyCreated           = SteinhelmVoiceSelect
            VoiceGuard                  = SteinhelmVoiceMove
            VoiceMove                   = SteinhelmVoiceMove
            VoiceMoveToCamp             = SteinhelmVoiceReturn
            VoiceMoveWhileAttacking     = SteinhelmVoiceMove
            VoicePriority               = 85
            VoiceRetreatToCastle        = SteinhelmVoiceRetreat
            VoiceSelect                 = SteinhelmVoiceSelect
            VoiceSelectBattle           = SteinhelmVoiceSelectinBattle

            UnitSpecificSounds
            VoiceEnterUnitElvenTransportShip   = SteinhelmVoiceMove
            VoiceEnterUnitMordorMumakil        = SteinhelmVoiceMove
            VoiceEnterUnitSlaughterHouse       = SteinhelmVoiceMove
            VoiceEnterUnitTransportShip        = SteinhelmVoiceMove
            VoiceGarrison                      = SteinhelmVoiceMove
            VoiceInitiateCaptureBuilding       = SteinhelmVoiceMove
            End

    CrowdResponseKey = DwarfHero

    #include "..\..\..\includes\StandardUnitEvaEvents.inc"

    Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
        Key = Humanoid_Male Dwarf Dwarf_Male Unit Infantry Hero
    End

    ClientBehavior = ModelConditionAudioLoopClientBehavior ModuleTag_foo
        ModelCondition = Required:EMOTION_CELEBRATING    Excluded:DYING ENGAGED    Sound:EmotionDainVoxCheerLoop
        ModelCondition = Required:EMOTION_TAUNTING        Excluded:DYING ENGAGED    Sound:EmotionDainVoxTauntLoop
        ModelCondition = Required:EMOTION_POINTING        Excluded:DYING ENGAGED    Sound:EmotionDainVoxTauntLoop
        ModelCondition = Required:RAISING_FLAG            Excluded:DYING ENGAGED    Sound:EmotionDainVoxCheerLoop
    End

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound:FootstepDirtA            Animation:DUDain_SKL.DUDain_RUNA    Frames:3 14
        AnimationSound = Sound:FootstepDirtA            Animation:DUDain_SKL.DUDain_RUNB    Frames:3 12
        AnimationSound = Sound:BodyFallSoldier            Animation:DUDain_SKL.DUDain_LNDA    Frames:4
        AnimationSound = Sound:BodyFallSoldier            Animation:DUDain_SKL.DUDain_DIEA    Frames:11
        AnimationSound = Sound:BodyFallSoldier            Animation:DUDain_SKL.DUDain_DIEC    Frames:59
        AnimationSound = Sound:BodyFallSoldier            Animation:DUDAIN_SKL.DUDAIN_DTHA    Frames:73

        AnimationSound = Sound:SwordIntoGroundQuiet        Animation:DUDAIN_SKL.DUDAIN_IDLE    Frames:61
        AnimationSound = Sound:TauntHumanHitShield        Animation:DUDAIN_SKL.DUDAIN_SPCA    Frames:25 50
        AnimationSound = Sound:TauntHumanHitShield        Animation:DUDAIN_SKL.DUDAIN_TNTA    Frames:28 43
    End



    RadarPriority = UNIT
    KindOf = PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE THROWN_OBJECT HERO ARMY_SUMMARY ATTACK_NEEDS_LINE_OF_SIGHT HEAVY_MELEE_HITTER
    PathfindDiameter = 40.0

    Body = RespawnBody ModuleTag_RespawnBody
        CheerRadius               = EMOTION_CHEER_RADIUS
        MaxHealth                 = THORIN2DAG_HEALTH
        PermanentlyKilledByFilter = NONE
        DodgePercent                 = HERO_DODGE_PERCENT
    End

    Behavior = RespawnUpdate ModuleTag_RespawnUpdate
        DeathAnim                    = DYING
        DeathAnimationTime            = 4100
        RespawnAnim                    = LEVELED
        RespawnAnimationTime        = 2000
        AutoRespawnAtObjectFilter    = NONE +CASTLE_KEEP
        ButtonImage                    = HIStonehelm

        RespawnRules =    AutoSpawn:No           Cost:THORIN2DAG_COST       Time:MEDIUM_HERO_RESPAWNTIME        Health:100%
    End


     Behavior = AutoHealBehavior ModuleTag_AthelasHealing
        StartsActive                = Yes
        ButtonTriggered                = Yes
        HealingAmount                = ATHELAS_HEAL_AMOUNT
        Radius                        = 200
        HealOnlyOthers                = No
        SingleBurst                    = Yes
        UnitHealPulseFX                = FX_DainMightyRage
        KindOf                        = INFANTRY CAVALRY
    End

    Behavior = AutoHealBehavior ModuleTag_ElvenGiftHealing
        StartsActive                = No
        TriggeredBy                    = Upgrade_ElvenGift
        HealingAmount                = ELVEN_GIFT_REGEN_AMOUNT
        HealingDelay                = ELVEN_GIFT_REGEN_DELAY
        StartHealingDelay            = HERO_HEAL_DELAY
        HealOnlyIfNotInCombat        = Yes
    End

    Behavior = AutoHealBehavior ModuleTag_DainHealing
        StartsActive            = Yes
        HealingAmount            = HERO_HEAL_AMOUNT
        HealingDelay            = 1000
        StartHealingDelay        = HERO_HEAL_DELAY
        HealOnlyIfNotInCombat    = Yes
    End
	
	#include "..\..\..\includes\DwarvenRunesHeroes.inc"

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = Hero
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = AIUpdateInterface ModuleTag_03
        AutoAcquireEnemiesWhenIdle      = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate             = 500
        HoldGroundCloseRangeDistance    = 60
        AILuaEventsList                 = DwarvenThorinHeroFunctions
    End

    LocomotorSet
        Locomotor = RohanGimliLocomotor
        Condition = SET_NORMAL
        Speed     = NORMAL_DWARF_HERO_SPEED
    End

    Behavior = PhysicsBehavior ModuleTag_04
        GravityMult                = 1.0
        AllowBouncing            = No
        ShockStunnedTimeLow        = 1400
        ShockStunnedTimeHigh    = 2400
        ShockStandingTime        = 2600
    End

    Behavior = SlowDeathBehavior ModuleTag_05
        DeathTypes            = ALL -KNOCKBACK
        SinkDelay            = 3000
        SinkRate            = 0.40
        DestructionDelay    = 8000
        Sound                = INITIAL HeroDwarfVoiceDie
    End

    Behavior = SquishCollide ModuleTag_06

    End

    Behavior = SlowDeathBehavior ModuleTag_07

        DeathTypes            = NONE +KNOCKBACK
        SinkDelay            = 3000
        SinkRate            = 0.40
        DestructionDelay    = 8000
    End

    Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    300
        TauntAndPointUpdateDelay    =    1000
        AddEmotion            =    Doom_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
        AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    Alert_Base
        AddEmotion            =    CheerForAboutToCrush_Base
     End

    Behavior = HitReactionBehavior HitReactionBehaviorModuleTag
        HitReactionLifeTimer1 = 2200
        HitReactionLifeTimer2 = 15
        HitReactionLifeTimer3 = 10

        HitReactionThreshold1 = 1.0
        HitReactionThreshold2 = 2500.0
        HitReactionThreshold3 = 5000.0
    End







    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_TheodenLeadership1
        SpecialPowerTemplate      = SpecialAbilityFakeLeadership
        TriggeredBy               = Upgrade_Level_1
    End

    Behavior = SpecialPowerModule ModuleTag_TheodenLeadershipUpdate1
        SpecialPowerTemplate      = SpecialAbilityFakeLeadership
        UpdateModuleStartsAttack  = No
        StartsPaused              = No
    End

    Behavior = AttributeModifierAuraUpdate ModuleTag_Leadership1
        StartsActive              = Yes
        BonusName                 = ThorinIIILeadershipErebor
        TriggeredBy               = Upgrade_TestBuilding
        RefreshDelay              = 2000
        Range                     = 200

        ObjectFilter              = ANY +DwarvenDainErebor +DwarvenGloin_mod +DwarvenBalin +DwarvenDain +DwarvenDain_mod +DwarvenDurin +RohanGimli +DwarvenGimli +RohanGimli +DwarvenGimliMod +DwarvenGimli +DwarvenThorinIII -DwarvenCarc ALLIES
    End

    Behavior = SpecialPowerModule ModuleTag_AragornBladeMasterStarter
        SpecialPowerTemplate      = SpecialAbilityAragornBladeMaster
        StartsPaused              = No
    End

    Behavior = HeroModeSpecialAbilityUpdate ModuleTag_AragornBladeMasterUpdate
        SpecialPowerTemplate      = SpecialAbilityAragornBladeMaster
        HeroAttributeModifier     = ThorinIIILeadershipSelfErebor
        HeroEffectDuration        = 30000
        UnpackTime                = 1
        TriggerSound              = AragornBladeMaster
    End







    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_SlamEnabler
        SpecialPowerTemplate      = SpecialAbilityDwarvenGloinSlam
        TriggeredBy               = Upgrade_Level_3
    End

    Behavior = SpecialPowerModule ModuleTag_SlamStarter
        SpecialPowerTemplate      = SpecialAbilityDwarvenGloinSlam
        UpdateModuleStartsAttack  = Yes
        StartsPaused              = Yes
        InitiateSound             = SteinhelmVoiceHieb
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_SlamWeaponFireUpdate
        SpecialPowerTemplate      = SpecialAbilityDwarvenGloinSlam
        SpecialWeapon             = ThorinHiebWeapon
        WhichSpecialWeapon        = 1
        StartAbilityRange         = 10.0
        SkipContinue              = Yes
        UnpackTime                = 1000
        PackTime                  = 1300
        MustFinishAbility         = Yes
    End

    Behavior = AutoAbilityBehavior ModuleTag_SlamAutoAbility
        SpecialAbility            = SpecialAbilityDwarvenGloinSlam
        Query                     = 1 ANY ENEMIES -STRUCTURE -UNATTACKABLE
        Query                     = 1 ALL ENEMIES
    End



    Behavior = FireWeaponWhenDamagedBehavior ModuleTag_ThranduilSchildDamage
        StartsActive                = No
        ReactionWeaponPristine      = Thorin3HeroHealWeapon
        ReactionWeaponDamaged       = Thorin3HeroHealWeapon
        ReactionWeaponReallyDamaged = Thorin3HeroHealWeapon
        DamageTypes                 = NONE +HERO +HERO_RANGED
        DamageAmount                = 100
        TriggeredBy = Upgrade_Level_5
    End



    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_WilleEnabler
        SpecialPowerTemplate     = SpecialAbilityEisernerWille
        TriggeredBy              = Upgrade_Level_10
    End

    Behavior = SpecialPowerModule ModuleTag_WilleStarter
        SpecialPowerTemplate     = SpecialAbilityEisernerWille
        UpdateModuleStartsAttack = Yes
        StartsPaused             = Yes
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_WilleUpdate
        SpecialPowerTemplate     = SpecialAbilityEisernerWille
        SkipContinue             = Yes
        UnpackTime               = 1100
        PreparationTime          = 1
        PersistentPrepTime       = 500
        PackTime                 = 500
        MustFinishAbility        = Yes
        AwardXPForTriggering     = 0
        StartAbilityRange        = 200
        SpecialWeapon            = EisernerWilleWeapon
        WhichSpecialWeapon       = 3
    End



    Behavior = SubObjectsUpgrade ModuleTag_HidetheHelm
        TriggeredBy       = Upgrade_Level_1
        HideSubObjects    = HELM
    End

    Behavior = SubObjectsUpgrade ModuleTag_MakingtheHelm
        TriggeredBy       = Upgrade_Level_10
        ShowSubObjects    = HELM
    End



;--------------------------------------------------------------------
; Revanche
;--------------------------------------------------------------------

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_RevancheUnpause
        SpecialPowerTemplate        = SpecialAbilityRevanche
        TriggeredBy                 = Upgrade_Level_10
    End

    Behavior = SpecialPowerModule ModuleTag_RevancheSpecialPower
        SpecialPowerTemplate        = SpecialAbilityRevanche
        UpdateModuleStartsAttack    = Yes
        StartsPaused                = Yes
        InitiateSound               = SteinhelmVoiceAttack
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_RevancheUpdate
        SpecialPowerTemplate        = SpecialAbilityRevanche
        SkipContinue                = Yes
        UnpackTime                  = 250
        PreparationTime             = 1
        PersistentPrepTime          = 500
        PackTime                    = 100
        MustFinishAbility           = Yes
        StartAbilityRange           = 25
        SpecialWeapon               = ThorinRevancheWeapon
        WhichSpecialWeapon          = 1
    End

    Behavior = AutoAbilityBehavior ModuleTag_RevancheAutoAbility
        SpecialAbility              = SpecialAbilityRevanche
        MaxScanRange                = 25
        Query                       = 1 ANY +HERO ENEMIES
    End










    Behavior = SpecialPowerModule ModuleTag_WeisheitStarter
        SpecialPowerTemplate     = SpecialAbilityZwergenRuneUnantastbarkeit
        UpdateModuleStartsAttack = Yes
        StartsPaused             = No
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_WeisheitUpdate
        SpecialPowerTemplate     = SpecialAbilityZwergenRuneUnantastbarkeit
        WhichSpecialWeapon         = 3
        SkipContinue               = Yes
        FreezeAfterTriggerDuration = 100
        UnpackTime                 = 700
        PreparationTime            = 1

        PackTime                   = 100
        AwardXPForTriggering       = 0
        StartAbilityRange          = 80
        SpecialWeapon            = ZwergenruneUnantastbarkeit
        TriggerSound             = SpellSunflare2
    End






    Behavior = SpecialPowerModule ModuleTag_InspirationStarter
        SpecialPowerTemplate     = SpecialAbilityZwergenRuneInspiration
        StartsPaused             = No
        UpdateModuleStartsAttack = Yes
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_InspirationBlastWeaponFireUpdate
        SpecialPowerTemplate     = SpecialAbilityZwergenRuneInspiration
        WhichSpecialWeapon         = 3
        SkipContinue               = Yes
        FreezeAfterTriggerDuration = 100
        UnpackTime                 = 700
        PreparationTime            = 1

        PackTime                   = 100
        AwardXPForTriggering       = 0
        StartAbilityRange          = 80
        SpecialWeapon            = ZwergenruneInspiration
        TriggerSound             = SpellSunflare2
    End





    Behavior = SpecialPowerModule ModuleTag_KraftStarter
        SpecialPowerTemplate     = SpecialAbilityZwergenRuneKraft
        StartsPaused             = No
        UpdateModuleStartsAttack = Yes
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_KraftBlastWeaponFireUpdate
        SpecialPowerTemplate     = SpecialAbilityZwergenRuneKraft
        WhichSpecialWeapon         = 3
        SkipContinue               = Yes
        FreezeAfterTriggerDuration = 100
        UnpackTime                 = 700
        PreparationTime            = 1
        PackTime                   = 100
        AwardXPForTriggering       = 0
        StartAbilityRange          = 80
        SpecialWeapon            = ZwergenruneKraft
        TriggerSound             = SpellSunflare2
    End





    Behavior = SpecialPowerModule ModuleTag_ProduktivitatStarter
        SpecialPowerTemplate     = SpecialAbilityZwergenRuneProduktivitat
        StartsPaused             = No
        UpdateModuleStartsAttack = Yes
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_ProduktivitatBlastWeaponFireUpdate
        SpecialPowerTemplate     = SpecialAbilityZwergenRuneProduktivitat
        WhichSpecialWeapon         = 3
        SkipContinue               = Yes
        FreezeAfterTriggerDuration = 100
        UnpackTime                 = 700
        PreparationTime            = 1

        PackTime                   = 100
        AwardXPForTriggering       = 0
        StartAbilityRange          = 80
        SpecialWeapon            = ZwergenruneProduktivitat
        TriggerSound             = SpellSunflare2
    End





    Behavior = SpecialPowerModule ModuleTag_SchreckenStarter
        SpecialPowerTemplate       = SpecialAbilityZwergenRuneSchrecken
        StartsPaused               = No
        UpdateModuleStartsAttack   = Yes
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_SchreckenBlastWeaponFireUpdate
        SpecialPowerTemplate       = SpecialAbilityZwergenRuneSchrecken
        WhichSpecialWeapon         = 3
        SkipContinue               = Yes
        FreezeAfterTriggerDuration = 100
        UnpackTime                 = 700
        PreparationTime            = 1

        PackTime                   = 100
        AwardXPForTriggering       = 0
        StartAbilityRange          = 80
        SpecialWeapon              = ZwergenruneSchrecken
        TriggerSound               = SpellSunflare2
    End




    Behavior = ArmorUpgrade ModuleTag_ArmorUpgradeMithril
        TriggeredBy     = Upgrade_DwarvenMithrilMailHeroes
        ArmorSetFlag    = PLAYER_UPGRADE
    End

    Behavior = SubObjectsUpgrade ModuleTag_MithrilSkinwelchsel
        TriggeredBy     = Upgrade_DwarvenMithrilMailHeroes
        UpgradeTexture  = duthorinIII.tga 0 duthorinIII_ha.tga
    End


    Behavior = MonitorConditionUpdate ModuleTag_CommandSetSwapper1
        WeaponSetFlags            = WEAPONSET_TOGGLE_1
        WeaponToggleCommandSet    = ThorinIIICommandSet_Runenmeister
    End

    Behavior = MonitorConditionUpdate ModuleTag_CommandSetSwapper2
        WeaponSetFlags            = WEAPONSET_TOGGLE_2
        WeaponToggleCommandSet    = ThorinIIIMithrilCommandSet
    End

    Behavior = CommandSetUpgrade ModuleTag_GimliMithril
        TriggeredBy        = Upgrade_DwarvenMithrilMailHeroes
        CommandSet        = ThorinIIIMithrilCommandSet
    End







    Behavior = AISpecialPowerUpdate SlamAI
        CommandButtonName = Command_SpecialAbilityThorinIIIGerechterHieb
        SpecialPowerAIType    = AI_SPECIAL_POWER_ENEMY_TYPE_KILLER_STRUCTURES
        SpecialPowerRange    = 200
    End

    Behavior = AISpecialPowerUpdate SpecialPowerTheodenGiveXPAoE
        CommandButtonName = Command_SpecialAbilityEisernerWille
        SpecialPowerAIType = AI_SPECIAL_POWER_GIVEXP_AOE
        SpecialPowerRadius = 30.0
    End


    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End



    Geometry            = CYLINDER
    GeometryMajorRadius = 5.6
    GeometryMinorRadius = 5.6
    GeometryHeight        = 16.0
    GeometryIsSmall        = Yes

    Shadow                = SHADOW_DECAL
    ShadowSizeX            = 19
    ShadowSizeY            = 19
    ShadowTexture        = ShadowI
End


Object DwarvenThorinIII_Eisenberge


    SelectPortrait = HPThorinIIIE
    ButtonImage = HIStonehelm

    DescriptionStrategic = CONTROLBAR:LW_ToolTip_LeaderHero

    Draw = W3DScriptedModelDraw ModuleTag_01

        OkToChangeModelColor    = Yes
        StaticModelLODMode        = Yes



        DefaultModelConditionState
            Model               = duthorin_iron
            Skeleton            = DUDain_SKL
            WeaponLaunchBone    = TERTIARY AXE02
        End

        ModelConditionState     = WEAPONSET_HERO_MODE

        End








        AnimationState        = STUNNED_FLAILING
            Animation           = FLYA
                AnimationName     = DUDain_FLYA
                AnimationMode     = LOOP
            End
            Flags               = RANDOMSTART
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End

        AnimationState        = DYING SPLATTED
            Animation           = LNDB
                AnimationName     = DUDain_LNDA
                AnimationMode     = ONCE
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End

        AnimationState        = DYING
            Animation           = DIEA
                AnimationName     = DUDain_DTHA
                AnimationMode     = ONCE
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End

        AnimationState        = STUNNED_STANDING_UP
            Animation           = GTPA
                AnimationName     = DUDain_GTPA
                AnimationMode     = ONCE
            End
        End

        AnimationState        = STUNNED
            Animation           = LNDA
                AnimationName     = DUDain_LNDA
                AnimationMode     = ONCE
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End

        AnimationState                        = PARALYZED
            Animation
                AnimationName                = DUDain_IDLA
                AnimationMode                = LOOP
            End
        End














        AnimationState                =    MOVING ATTACKING
            Animation                =    RUNB
                AnimationName        =    DUDain_RUNB
                AnimationMode        =    LOOP
            End
            Flags                    =    RANDOMSTART

            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End

        AnimationState                =    MOVING
            Animation                =    RUNA
                AnimationName        =    DUDain_RUNA
                AnimationMode        =    LOOP
            End
            Flags                    =    RANDOMSTART

            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End





        AnimationState        = FIRING_OR_PREATTACK_C
            Animation            = SPCA
                AnimationName        = DUDain_SPCA
                AnimationMode        = ONCE

            End
            FrameForPristineBonePositions = 42

            BeginScript

                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End


        AnimationState        =  FIRING_OR_PREATTACK_A
            Animation           = ATKA
                AnimationName     = DUDain_ATKA
                AnimationMode     = ONCE
                UseWeaponTiming        = Yes
            End
            Animation           = ATKB
                AnimationName     = DUDain_ATKB
                AnimationMode     = ONCE
                UseWeaponTiming        = Yes
            End

            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
            EndScript
        End



        AnimationState        =  SPECIAL_WEAPON_ONE
            Animation           = ATKA
                AnimationName     = DUDain_ATKA
                AnimationMode     = ONCE
            End
            Animation           = ATKB
                AnimationName     = DUDain_ATKB
                AnimationMode     = ONCE
            End
            ParticleSysBone = NONE GloinBlastSlam    FollowBone:Yes
        End

        AnimationState        =  SPECIAL_WEAPON_THREE
            Animation           = SPCA
                AnimationName   = DUDain_SPCA
                AnimationMode   = ONCE
            End
            Animation           = SPCB
                AnimationName   = DUDain_SPCB
                AnimationMode   = ONCE
            End
        End

        AnimationState          =    PACKING_TYPE_1
            StateName          =    Attacking
            Animation           = SPCA
                AnimationName   = DUDain_SPCA
                AnimationMode   = ONCE
            End
            Animation           = SPCB
                AnimationName   = DUDain_SPCB
                AnimationMode   = ONCE
            End
        End



        AnimationState = HIT_REACTION
            Animation = Hit_Level_1_a
                AnimationName = DUDain_HITA
                AnimationMode = ONCE
            End
        End




        AnimationState                = LEVELED
            Animation                = LevelUp
                AnimationName        = DUDain_CHRA
                AnimationMode        = ONCE
            End
        End


        AnimationState            = EMOTION_CELEBRATING
            Animation           = CHRA
                AnimationName   = DUDain_CHRA
                AnimationMode   = ONCE
            End
            Flags                    =    RESTART_ANIM_WHEN_COMPLETE
        End


        AnimationState            = EMOTION_TAUNTING
            Animation
                AnimationName   = DUDain_TNTA
                AnimationMode   = ONCE
            End
            Flags                    =    RESTART_ANIM_WHEN_COMPLETE
        End


        AnimationState                    = EMOTION_ALERT
            Animation                    = Ready
                AnimationName            = DUDain_IDLA
                AnimationMode            = LOOP
                AnimationBlendTime  =   15
            End
            BeginScript




                if Prev == "State_AboutToHitGround" then CurDrawableSetTransitionAnimState("TRANS_AboutToHitGround_To_Idle") end
            EndScript

        End

        AnimationState            = RAISING_FLAG
            Animation           = CHRA
                AnimationName   = DUDain_CHRA
                AnimationMode   = LOOP
            End
        End



        AnimationState                =    SELECTED
            StateName                =    AtAttentionIdle
            SimilarRestart            =   Yes
            Animation                =    ATNB
                AnimationName        =     DUDain_ATNB
                AnimationMode        =    LOOP
            End
            BeginScript

                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Idle" then CurDrawableSetTransitionAnimState("TRANS_Select") end
                if Prev == "AtAttentionIdle" then CurDrawableSetTransitionAnimState("TRANS_Select") end
                if Prev == "State_AboutToHitGround" then CurDrawableSetTransitionAnimState("TRANS_AboutToHitGround_To_Idle") end
            EndScript
        End



        IdleAnimationState
            StateName                = STATE_Idle
            Animation           = IDLB
                AnimationName     = DUDain_IDLB
                AnimationMode     = ONCE
                AnimationPriority = 10
            End
            Animation           = IDLF
                AnimationName     = DUDain_IDLC
                AnimationMode     = ONCE
                AnimationPriority = 5
            End
            Animation           = IDLF
                AnimationName     = DUDain_IDLD
                AnimationMode     = ONCE
                AnimationPriority = 5
            End
            Animation           = IDLF
                AnimationName     = DUDain_IDLE
                AnimationMode     = ONCE
                AnimationPriority = 2
            End
            BeginScript

                Prev = CurDrawablePrevAnimationState()
                if Prev == "DwarfToss" then CurDrawableSetTransitionAnimState("TRANS_EndDwarfToss") end
                if Prev == "AtAttentionIdle" then CurDrawableSetTransitionAnimState("TRANS_SelectedToIdle") end
                if Prev == "State_AboutToHitGround" then CurDrawableSetTransitionAnimState("TRANS_AboutToHitGround_To_Idle") end
            EndScript
        End




        TransitionState       = TRANS_SelectedToIdle
            Animation           = ATNC
                AnimationName     = DUDain_ATNC
                AnimationMode     = ONCE
                AnimationSpeedFactorRange = 0.7 1.3
            End
        End

        TransitionState                =    TRANS_Select
            Animation                =    ATNA
                AnimationName        =     DUDain_ATNA
                AnimationMode        =    ONCE
            End
        End
    End

    Draw = W3DScriptedModelDraw Icon
        ModelConditionState = NONE
            Model           = bbox
        End
    End





    #include "..\..\..\includes\StunDrawModuleSmall.inc"


    Side                = Dwarves
    EditorSorting        = UNIT
    ThreatLevel            = DAIN_THREAT_LEVEL
    TransportSlotCount    = TRANSPORTSLOTCOUNT_HERO
    BuildCost           = THORIN2DAG_COST
    BuildTime           = MEDIUM_HERO_BUILDTIME

    DisplayMeleeDamage    = THORIN2DAG_DAMAGE
    Scale             = 0.88
    HeroSortOrder        = 40

    WeaponSet
        Conditions         = None
        Weapon             = PRIMARY  DwarvenThorinIIIWeapon
        AutoChooseSources  = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End
	
	WeaponSet
        Conditions         = WEAPONSET_HERO_MODE
        Weapon             = PRIMARY  DwarvenThorinIIIHeroModeWeapon
        AutoChooseSources  = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End


    ArmorSet
        Conditions      = None
        Armor           = HeroHeroKillerArmor
        DamageFX        = NormalDamageFX
    End

    ArmorSet
        Conditions      = PLAYER_UPGRADE
        Armor           = HeroHeroKillerArmorUpgrade
        DamageFX        = NormalDamageFX
    End

    VisionRange         = 200
    ShroudClearingRange = 300

    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = 200
    VisionBonusPercentPerFoot = 1.0%

    BountyValue     = DWARVEN_DAIN_BOUNTY_VALUE
    DisplayName     = OBJECT:DwarvenThorinIII
    RecruitText     = CONTROLBAR:DwarvenThorinIIIRecruit
    ReviveText      = CONTROLBAR:DwarvenThorinIIIRevive
    Hotkey          = CONTROLBAR:DwarvenThorinIIIHotkey
    CrushableLevel  = 2

    CommandSet  = ThorinIIIEisenbergeCommandSet
    CommandPoints = 0



    AutoResolveUnitType = AutoResolveUnit_Hero
    AutoResolveCombatChain = AutoResolve_HeroCombatChain

    AutoResolveBody = AutoResolve_DainBody

    AutoResolveArmor
        Armor = AutoResolve_DainArmor
    End

    AutoResolveWeapon
        Weapon = AutoResolve_DainWeapon
    End

    AutoResolveLeadership = AutoResolve_DainBonus




            VoiceAttack                 = SteinhelmVoiceAttack
            VoiceAttackAir              = SteinhelmVoiceAttack
            VoiceAttackCharge           = SteinhelmVoiceAttack
            VoiceAttackMachine          = SteinhelmVoiceAttack
            VoiceAttackStructure        = SteinhelmVoiceAttack
            VoiceCreated                = SteinhelmVoiceSelect
            VoiceFear                   = SteinhelmVoiceHelpMe
            VoiceFullyCreated           = SteinhelmVoiceSelect
            VoiceGuard                  = SteinhelmVoiceMove
            VoiceMove                   = SteinhelmVoiceMove
            VoiceMoveToCamp             = SteinhelmVoiceReturn
            VoiceMoveWhileAttacking     = SteinhelmVoiceMove
            VoicePriority               = 85
            VoiceRetreatToCastle        = SteinhelmVoiceRetreat
            VoiceSelect                 = SteinhelmVoiceSelect
            VoiceSelectBattle           = SteinhelmVoiceSelectinBattle

            UnitSpecificSounds
            VoiceEnterUnitElvenTransportShip   = SteinhelmVoiceMove
            VoiceEnterUnitMordorMumakil        = SteinhelmVoiceMove
            VoiceEnterUnitSlaughterHouse       = SteinhelmVoiceMove
            VoiceEnterUnitTransportShip        = SteinhelmVoiceMove
            VoiceGarrison                      = SteinhelmVoiceMove
            VoiceInitiateCaptureBuilding       = SteinhelmVoiceMove
            End

    CrowdResponseKey = DwarfHero

    #include "..\..\..\includes\StandardUnitEvaEvents.inc"

    Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
        Key = Humanoid_Male Dwarf Dwarf_Male Unit Infantry Hero
    End

    ClientBehavior = ModelConditionAudioLoopClientBehavior ModuleTag_foo
        ModelCondition = Required:EMOTION_CELEBRATING    Excluded:DYING ENGAGED    Sound:EmotionDainVoxCheerLoop
        ModelCondition = Required:EMOTION_TAUNTING        Excluded:DYING ENGAGED    Sound:EmotionDainVoxTauntLoop
        ModelCondition = Required:EMOTION_POINTING        Excluded:DYING ENGAGED    Sound:EmotionDainVoxTauntLoop
        ModelCondition = Required:RAISING_FLAG            Excluded:DYING ENGAGED    Sound:EmotionDainVoxCheerLoop
    End

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound:FootstepDirtA            Animation:DUDain_SKL.DUDain_RUNA    Frames:3 14
        AnimationSound = Sound:FootstepDirtA            Animation:DUDain_SKL.DUDain_RUNB    Frames:3 12
        AnimationSound = Sound:BodyFallSoldier            Animation:DUDain_SKL.DUDain_LNDA    Frames:4
        AnimationSound = Sound:BodyFallSoldier            Animation:DUDain_SKL.DUDain_DIEA    Frames:11
        AnimationSound = Sound:BodyFallSoldier            Animation:DUDain_SKL.DUDain_DIEC    Frames:59
        AnimationSound = Sound:BodyFallSoldier            Animation:DUDAIN_SKL.DUDAIN_DTHA    Frames:73

        AnimationSound = Sound:SwordIntoGroundQuiet        Animation:DUDAIN_SKL.DUDAIN_IDLE    Frames:61
        AnimationSound = Sound:TauntHumanHitShield        Animation:DUDAIN_SKL.DUDAIN_SPCA    Frames:25 50
        AnimationSound = Sound:TauntHumanHitShield        Animation:DUDAIN_SKL.DUDAIN_TNTA    Frames:28 43
    End



    RadarPriority = UNIT
    KindOf = PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE THROWN_OBJECT HERO ARMY_SUMMARY ATTACK_NEEDS_LINE_OF_SIGHT HEAVY_MELEE_HITTER
    PathfindDiameter = 40.0


    Body = DelayedDeathBody ModuleTag_DelayedDeathBody
        CheerRadius                      = EMOTION_CHEER_RADIUS
        MaxHealth                        = THORIN2DAG_HEALTH
        MaxHealthDamaged                 = 5000
        MaxHealthReallyDamaged           = 2000
        DelayedDeathTime                 = 20000
        DelayedDeathPrerequisiteUpgrade  = Upgrade_Level_10
        PermanentlyKilledByFilter        = NONE
        DodgePercent               = HERO_DODGE_PERCENT
        DamagedAttributeModifier        = ThorinIIIDamagedAttributeModifierIronHills
        ReallyDamagedAttributeModifier  = ThorinIIIReallyDamagedAttributeModifierIronHills    
    End

    Behavior = LifetimeUpdate ModuleTag_LifeTime
        WaitForWakeUp = Yes
    End


    Behavior = RespawnUpdate ModuleTag_RespawnUpdate
        DeathAnim                    = DYING
        DeathAnimationTime            = 4100
        RespawnAnim                    = LEVELED
        RespawnAnimationTime        = 2000
        AutoRespawnAtObjectFilter    = NONE +CASTLE_KEEP
        ButtonImage                    = HIStonehelm

        RespawnRules =    AutoSpawn:No           Cost:THORIN2DAG_COST       Time:MEDIUM_HERO_RESPAWNTIME        Health:100%
	End



     Behavior = AutoHealBehavior ModuleTag_AthelasHealing
        StartsActive                = Yes
        ButtonTriggered                = Yes
        HealingAmount                = ATHELAS_HEAL_AMOUNT
        Radius                        = 200
        HealOnlyOthers                = No
        SingleBurst                    = Yes
        UnitHealPulseFX                = FX_DainMightyRage
        KindOf                        = INFANTRY CAVALRY
    End

    Behavior = AutoHealBehavior ModuleTag_ElvenGiftHealing
        StartsActive                = No
        TriggeredBy                    = Upgrade_ElvenGift
        HealingAmount                = ELVEN_GIFT_REGEN_AMOUNT
        HealingDelay                = ELVEN_GIFT_REGEN_DELAY
        StartHealingDelay            = HERO_HEAL_DELAY
        HealOnlyIfNotInCombat        = Yes
    End
	
	#include "..\..\..\includes\DwarvenRunesHeroes.inc"

    Behavior = AutoHealBehavior ModuleTag_DainHealing
        StartsActive            = Yes
        HealingAmount            = HERO_HEAL_AMOUNT
        HealingDelay            = 1000
        StartHealingDelay        = HERO_HEAL_DELAY
        HealOnlyIfNotInCombat    = Yes
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = Hero
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = AIUpdateInterface ModuleTag_03
        AutoAcquireEnemiesWhenIdle      = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate             = 500
        HoldGroundCloseRangeDistance    = 60
        AILuaEventsList                 = DwarvenThorinHeroFunctions
    End

    Behavior = PassiveAreaEffectBehavior ModuleTag_FeelGoodHero2
        EffectRadius            = 200
        PingDelay               = 2000
        UpgradeRequired         = Upgrade_TestBuilding_2
        ModifierName            = DainRachefeldzugUnitModifier
        AllowFilter             = GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
    End


    LocomotorSet
        Locomotor = RohanGimliLocomotor
        Condition = SET_NORMAL
        Speed     = NORMAL_DWARF_HERO_SPEED
    End

    Behavior = PhysicsBehavior ModuleTag_04
        GravityMult                = 1.0
        AllowBouncing            = No
        ShockStunnedTimeLow        = 1400
        ShockStunnedTimeHigh    = 2400
        ShockStandingTime        = 2600
    End

    Behavior = SlowDeathBehavior ModuleTag_05
        DeathTypes            = ALL -KNOCKBACK
        SinkDelay            = 3000
        SinkRate            = 0.40
        DestructionDelay    = 8000
        Sound                = INITIAL HeroDwarfVoiceDie
    End

    Behavior = SquishCollide ModuleTag_06

    End

    Behavior = SlowDeathBehavior ModuleTag_07

        DeathTypes            = NONE +KNOCKBACK
        SinkDelay            = 3000
        SinkRate            = 0.40
        DestructionDelay    = 8000
    End

    Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    300
         TauntAndPointUpdateDelay    =    1000
        AddEmotion            =    Doom_Base



        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
         AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base


        AddEmotion            =    Alert_Base
        AddEmotion            =    CheerForAboutToCrush_Base
     End

    Behavior = HitReactionBehavior HitReactionBehaviorModuleTag
        HitReactionLifeTimer1 = 2200
        HitReactionLifeTimer2 = 15
        HitReactionLifeTimer3 = 10

        HitReactionThreshold1 = 1.0
        HitReactionThreshold2 = 2500.0
        HitReactionThreshold3 = 5000.0
    End







    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_TheodenLeadership1
        SpecialPowerTemplate      = SpecialAbilityFakeLeadership
        TriggeredBy               = Upgrade_Level_1
    End

    Behavior = SpecialPowerModule ModuleTag_TheodenLeadershipUpdate1
        SpecialPowerTemplate      = SpecialAbilityFakeLeadership
        UpdateModuleStartsAttack  = No
        StartsPaused              = No
    End

    Behavior = AttributeModifierAuraUpdate ModuleTag_Leadership1
        StartsActive              = No
        BonusName                 = ThorinIIILeadershipEisenberge
        TriggeredBy               = Upgrade_TestBuilding
        RefreshDelay              = 2000
        Range                     = 200
        ObjectFilter              = ANY +DwarvenMurin +DwarvenDrar +DwarvenBalin +DwarvenDain +DwarvenDain_mod +DwarvenDurin -DwarvenCarc ALLIES
    End


    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_BladeMasterEnabler
        SpecialPowerTemplate      = SpecialAbilityAragornBladeMaster
        TriggeredBy               = Upgrade_Level_2
    End

    Behavior = SpecialPowerModule ModuleTag_AragornBladeMasterStarter
        SpecialPowerTemplate      = SpecialAbilityAragornBladeMaster
        StartsPaused              = Yes

    End

    Behavior = HeroModeSpecialAbilityUpdate ModuleTag_AragornBladeMasterUpdate
        SpecialPowerTemplate      = SpecialAbilityAragornBladeMaster
        HeroAttributeModifier     = ThorinBlutrauschModifier
        HeroEffectDuration        = 30000
        UnpackTime                = 1
        TriggerSound              = AragornBladeMaster
    End








    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_SlamEnabler
        SpecialPowerTemplate      = SpecialAbilityDwarvenGloinSlam
        TriggeredBy               = Upgrade_Level_4
    End

    Behavior = SpecialPowerModule ModuleTag_SlamStarter
        SpecialPowerTemplate      = SpecialAbilityDwarvenGloinSlam
        UpdateModuleStartsAttack  = Yes
        StartsPaused              = Yes
        InitiateSound             = SteinhelmVoiceHieb
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_SlamWeaponFireUpdate
        SpecialPowerTemplate      = SpecialAbilityDwarvenGloinSlam
        SpecialWeapon             = ThorinHiebWeapon
        WhichSpecialWeapon        = 1
        StartAbilityRange         = 10.0
        SkipContinue              = Yes
        UnpackTime                = 1000
        PackTime                  = 1300
        MustFinishAbility         = Yes
    End

    Behavior = AutoAbilityBehavior ModuleTag_SlamAutoAbility
        SpecialAbility            = SpecialAbilityDwarvenGloinSlam
        Query                     = 1 ANY ENEMIES -STRUCTURE -UNATTACKABLE
        Query                     = 1 ALL ENEMIES
    End





    Behavior = FireWeaponUpdate FireWeaponUpdateModuleTag
        FireWeaponNugget
            WeaponName  = ThorinKampfgebrllHeroEffect
            FireDelay   = 0
            OneShot     = No
        End
    End

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_KampfgebrllUnpause
        SpecialPowerTemplate      = SpecialAbilityThorinKampfgebrll
        TriggeredBy               = Upgrade_Level_5
    End
  
    Behavior = SpecialPowerModule ModuleTag_KampfgebrllStarter                      
        SpecialPowerTemplate      = SpecialAbilityThorinKampfgebrll
        UpdateModuleStartsAttack  = Yes
        StartsPaused              = Yes
    End

    Behavior = HeroModeSpecialAbilityUpdate ModuleTag_KampfgebrllUpdate   
        SpecialPowerTemplate      = SpecialAbilityThorinKampfgebrll
        UnpackingVariation        = 1
        UnpackTime                = 1800 
        PackTime                  = 1600
        AwardXPForTriggering      = 0
        HeroAttributeModifier     = ThorinKampfgebrllModifier
        HeroEffectDuration        = 20000
    End


;--------------------------------------------------------------------
; Revanche
;--------------------------------------------------------------------

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_RevancheUnpause
        SpecialPowerTemplate        = SpecialAbilityRevanche
        TriggeredBy                 = Upgrade_Level_10
    End

    Behavior = SpecialPowerModule ModuleTag_RevancheSpecialPower
        SpecialPowerTemplate        = SpecialAbilityRevanche
        UpdateModuleStartsAttack    = Yes
        StartsPaused                = Yes
        InitiateSound               = SteinhelmVoiceAttack
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_RevancheUpdate
        SpecialPowerTemplate        = SpecialAbilityRevanche
        SkipContinue                = Yes
        UnpackTime                  = 250
        PreparationTime             = 1
        PersistentPrepTime          = 500
        PackTime                    = 100
        MustFinishAbility           = Yes
        StartAbilityRange           = 15
        SpecialWeapon               = ThorinRevancheWeapon
        WhichSpecialWeapon          = 1
    End

    Behavior = AutoAbilityBehavior ModuleTag_RevancheAutoAbility
        SpecialAbility              = SpecialAbilityRevanche
        MaxScanRange                = 25
        Query                       = 1 ANY +HERO ENEMIES
    End








    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_WilleEnabler
        SpecialPowerTemplate     = SpecialAbilityEisernerWille
        TriggeredBy              = Upgrade_Level_10
    End

    Behavior = SpecialPowerModule ModuleTag_WilleStarter
        SpecialPowerTemplate     = SpecialAbilityEisernerWille
        UpdateModuleStartsAttack = Yes
        StartsPaused             = Yes
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_WilleUpdate
        SpecialPowerTemplate     = SpecialAbilityEisernerWille
        SkipContinue             = Yes
        UnpackTime               = 1100
        PreparationTime          = 1
        PersistentPrepTime       = 500
        PackTime                 = 500
        MustFinishAbility        = Yes
        AwardXPForTriggering     = 0
        StartAbilityRange        = 200
        SpecialWeapon            = EisernerWilleWeapon
        WhichSpecialWeapon       = 3
    End


    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_LastStand
        SpecialPowerTemplate = SpecialAbilityLastStand
        TriggeredBy = Upgrade_Level_10
    End

    Behavior = SpecialPowerModule ModuleTag_LastStandUpdate
        SpecialPowerTemplate = SpecialAbilityLastStand
        UpdateModuleStartsAttack     = No
        StartsPaused     = Yes
    End

    Behavior = SubObjectsUpgrade ModuleTag_HidetheHelm
        TriggeredBy       = Upgrade_Level_1
        HideSubObjects    = HELM
    End

    Behavior = SubObjectsUpgrade ModuleTag_MakingtheHelm
        TriggeredBy       = Upgrade_Level_10
        ShowSubObjects    = HELM
    End


    Behavior = ArmorUpgrade ModuleTag_ArmorUpgradeMithril
        TriggeredBy     = Upgrade_DwarvenMithrilMailHeroes
        ArmorSetFlag    = PLAYER_UPGRADE
    End

    Behavior = SubObjectsUpgrade ModuleTag_MithrilSkinwelchsel
        TriggeredBy     = Upgrade_DwarvenMithrilMailHeroes
        UpgradeTexture  = duthorinIII_eisen.tga 0 duthorinIII_eisen_ha.tga
    End






    Behavior = SpecialPowerModule ModuleTag_SchutzStarter
        SpecialPowerTemplate     = SpecialAbilitySchmiedSchutz
        StartsPaused             = No
        UpdateModuleStartsAttack = Yes
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_SchutzWeaponFireUpdate
        SpecialPowerTemplate     = SpecialAbilitySchmiedSchutz
        SkipContinue             = Yes
        UnpackTime               = 1100
        PreparationTime          = 1
        PersistentPrepTime       = 500
        PackTime                 = 500
        MustFinishAbility        = Yes
        AwardXPForTriggering     = 0
        StartAbilityRange        = 200
        WhichSpecialWeapon       = 3
        SpecialWeapon            = SchmiedSchutzWeapon
    End






    Behavior = SpecialPowerModule ModuleTag_ReichtumStarter
        SpecialPowerTemplate     = SpecialAbilitySchmiedReichtum
        StartsPaused             = No
        UpdateModuleStartsAttack = Yes
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_ReichtumWeaponFireUpdate
        SpecialPowerTemplate     = SpecialAbilitySchmiedReichtum
        SkipContinue             = Yes
        UnpackTime               = 1100
        PreparationTime          = 1
        PersistentPrepTime       = 500
        PackTime                 = 500
        MustFinishAbility        = Yes
        AwardXPForTriggering     = 0
        StartAbilityRange        = 200
        WhichSpecialWeapon       = 3
        SpecialWeapon            = SchmiedReichtumWeapon
    End






    Behavior = SpecialPowerModule ModuleTag_RuhmStarter
        SpecialPowerTemplate     = SpecialAbilitySchmiedRuhm
        StartsPaused             = No
        UpdateModuleStartsAttack = Yes
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_RuhmWeaponFireUpdate
        SpecialPowerTemplate     = SpecialAbilitySchmiedRuhm
        SkipContinue             = Yes
        UnpackTime               = 1100
        PreparationTime          = 1
        PersistentPrepTime       = 500
        PackTime                 = 500
        MustFinishAbility        = Yes
        AwardXPForTriggering     = 0
        StartAbilityRange        = 200
        WhichSpecialWeapon       = 3
        SpecialWeapon            = SchmiedRuhmWeapon
    End






    Behavior = SpecialPowerModule ModuleTag_EhreStarter
        SpecialPowerTemplate     = SpecialAbilitySchmiedEhre
        StartsPaused             = No
        UpdateModuleStartsAttack = Yes
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_EhreWeaponFireUpdate
        SpecialPowerTemplate     = SpecialAbilitySchmiedEhre
        SkipContinue             = Yes
        UnpackTime               = 1100
        PreparationTime          = 1
        PersistentPrepTime       = 500
        PackTime                 = 500
        MustFinishAbility        = Yes
        AwardXPForTriggering     = 0
        StartAbilityRange        = 200
        WhichSpecialWeapon       = 3
        SpecialWeapon            = SchmiedEhreWeapon
    End





    Behavior = ModelConditionUpgrade ModuleTag_ModellEredLuin
        TriggeredBy              = Upgrade_SubFactionIronHills
        AddConditionFlags        = HERO
        Permanent                = Yes
    End


    Behavior = MonitorConditionUpdate ModuleTag_CommandSetSwapper1
        WeaponSetFlags            = WEAPONSET_TOGGLE_1
        WeaponToggleCommandSet    = ThorinIIICommandSet_Runenschmied
    End

    Behavior = MonitorConditionUpdate ModuleTag_CommandSetSwapper2
        WeaponSetFlags            = WEAPONSET_TOGGLE_2
        WeaponToggleCommandSet    = ThorinIIIEisenbergeMithrilCommandSet
    End

    Behavior = CommandSetUpgrade ModuleTag_GimliMithril
        TriggeredBy        = Upgrade_DwarvenMithrilMailHeroes
        CommandSet        = ThorinIIIEisenbergeMithrilCommandSet
    End








    Behavior = AISpecialPowerUpdate SlamAI
        CommandButtonName = Command_SpecialAbilityThorinIIIGerechterHieb
        SpecialPowerAIType    = AI_SPECIAL_POWER_ENEMY_TYPE_KILLER_STRUCTURES
        SpecialPowerRange    = 200
    End

    Behavior = AISpecialPowerUpdate SpecialPowerTheodenGiveXPAoE
        CommandButtonName = Command_SpecialAbilityEisernerWille
        SpecialPowerAIType = AI_SPECIAL_POWER_GIVEXP_AOE
        SpecialPowerRadius = 30.0
    End



    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End



    Geometry            = CYLINDER
    GeometryMajorRadius = 5.6
    GeometryMinorRadius = 5.6
    GeometryHeight        = 16.0
    GeometryIsSmall        = Yes

    Shadow                = SHADOW_DECAL
    ShadowSizeX            = 19
    ShadowSizeY            = 19
    ShadowTexture        = ShadowI
End





