Object DwarvenMinerMod

    SelectPortrait         = UPNeutralMiner
    ButtonImage            = HSNeutralMiner

    Draw = W3DHordeModelDraw ModuleTag_01
        OkToChangeModelColor = Yes
        StaticModelLODMode   = Yes

        WadingParticleSys = WaterRipplesTrail

        DefaultModelConditionState
            Model                    = duihporter
            Skeleton                = DUPorter_SKL
        End



        AnimationState                        = THROWN_PROJECTILE
            Animation                       = FlyA
                AnimationName                   = EUDwarfMin_FLYA
                AnimationMode               = LOOP
            End
            Flags                           = RANDOMSTART
        End

        AnimationState                        = FREEFALL
            Animation                        = Falling
                AnimationName                = EUDwarfMin_FLYA
                AnimationMode                = LOOP
                AnimationBlendTime            = 10
            End
        End



        AnimationState                        = STUNNED_FLAILING
            Animation                       = FlyA
                AnimationName               = EUDwarfMin_FLYA
                AnimationMode               = LOOP
            End
            Flags                           = RANDOMSTART
        End

        AnimationState                         = DYING SPLATTED
            Animation                         = Splatted_On_Ground
                AnimationName                 = EUDwarfMin_LNDA
                AnimationMode                 = ONCE
            End
            EnteringStateFX                    = FX_OrcHitGround
        End

        AnimationState                        = DYING
            Animation                        = DIEB
                AnimationName                = EUDwarfMin_DIEB
                AnimationMode                = ONCE
            End
            Animation                        = DIEC
                AnimationName                = EUDwarfMin_DIEB
                AnimationMode                = ONCE
            End
        End



        AnimationState                        = STUNNED_STANDING_UP
            Animation                        = GTPA
                AnimationName                = EUDwarfMin_GTPA
                AnimationMode                = ONCE
                AnimationSpeedFactorRange = 1.5 1.5
            End
        End



        AnimationState            =     STUNNED
            Animation            =     Slatted_On_Ground
            AnimationName                 = EUDwarfMin_LNDA
                AnimationMode                 = ONCE
            End
            EnteringStateFX                    = FX_OrcHitGround

       End


        AnimationState        = MOVING FIRING_OR_PREATTACK_A
            ShareAnimation        = Yes
            Animation           = RunAndFire
                AnimationName       = EUDwarfMin_ATRA
                AnimationMode       = LOOP
            End
            Flags               = RANDOMSTART
        End



        AnimationState                        = MOVING EMOTION_TERROR EMOTION_LOOK_TO_SKY

            Animation                    = TerrorFromTheSky
                AnimationName            = EUDwarfMin_RUNA
                AnimationMode            = LOOP
            End
            Animation                    = TerrorFromTheSky
                AnimationName            = EUDwarfMin_RUNA
                AnimationMode            = LOOP
            End
            Flags = RANDOMSTART
        End
        AnimationState                        = MOVING EMOTION_TERROR

            Animation                        = TerrorFromTheSky
                AnimationName                = EUDwarfMin_RUNA
                AnimationMode                = ONCE
            End
            Animation                        = TerrorFromTheSky
                AnimationName                = EUDwarfMin_RUNA
                AnimationMode                = ONCE
            End
            Flags                            = RESTART_ANIM_WHEN_COMPLETE
        End



        AnimationState                        = MOVING BACKING_UP

            Animation                        = BAKA
                AnimationName                = EUDwarfMin_RUNA
                AnimationMode                = LOOP
            End
            Flags = RANDOMSTART
        End

        AnimationState                        = MOVING ATTACKING
            ShareAnimation                    = Yes
            Animation                        = RUNA
                AnimationName                = EUDwarfMin_RUNA
                AnimationMode                = LOOP
                Distance                    = 25
            End
            Flags                            = RANDOMSTART

        End

        AnimationState                        = MOVING CHARGING
            ShareAnimation                    = Yes
            Animation                        = RUNB
                AnimationName                = EUDwarfMin_RUNA
                AnimationMode                = LOOP
                Distance                    = 30

            End
            Flags                            = RANDOMSTART

        End

        AnimationState                        = MOVING

            ShareAnimation                    = Yes
            Animation                        = RUNB
                AnimationName                = EUDwarfMin_RUNA
                AnimationMode                = LOOP
                Distance                    = 30
            End
            Flags                            = RANDOMSTART

        End


        AnimationState                        = EMOTION_UNCONTROLLABLY_AFRAID
            Animation                        = FERA
                AnimationName                = EUDwarfMin_CHRA
                AnimationMode                = LOOP
            End
        End

        AnimationState                        = FIRING_OR_PREATTACK_A
            Animation                        = ATK1
                AnimationName                = EUDwarfMin_ATKA
                AnimationMode                = ONCE
                UseWeaponTiming                = Yes
            End

        End

        AnimationState                        = ATTACKING
            Animation                        = ALERT_1
                AnimationName                = EUDwarfMin_IDLA
                AnimationMode                = LOOP
            End
        End








































































        AnimationState                        = EMOTION_ALERT
            Animation                        = ALERT_1
                AnimationName                = EUDwarfMin_IDLA
                AnimationMode                = LOOP
                AnimationPriority            = 10
            End
            Flags                            = RESTART_ANIM_WHEN_COMPLETE
        End


        AnimationState        = SELECTED
            StateName           = STATE_Selected
            Animation           = ATNB
                AnimationName     = EUDwarfMin_ATNB
                AnimationMode     = LOOP
            End

            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Idle"
                then
                    CurDrawableSetTransitionAnimState("TRANS_IdleToSelected")
                end
                if CurDrawableModelcondition("ATTACKING")
                then
                    return "IDLA"
                else
                    return "ATNA"
                end
            EndScript

            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Idle" then CurDrawableSetTransitionAnimState("TRANS_IdleToSelected") end
            EndScript
        End


        AnimationState                = WEAPONSET_PLAYER_UPGRADE
            StateName                = STATE_Idle
            Animation                = IDLB
                AnimationName       = EUDwarfMin_IDLB
                AnimationMode       = ONCE
                AnimationSpeedFactorRange = 0.9 1.1
            End
            Animation                = IDLC
                AnimationName       = EUDwarfMin_IDLC
                AnimationMode       = ONCE
                AnimationSpeedFactorRange = 0.9 1.1
            End
            Animation                = IDLD
                AnimationName       = EUDwarfMin_IDLD
                AnimationMode       = ONCE
                AnimationSpeedFactorRange = 0.9 1.1
            End










            Flags                    = RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Selected" then CurDrawableSetTransitionAnimState("TRANS_SelectedToIdle") end
            EndScript
        End
        AnimationState                = USER_3
            StateName                = STATE_User_3
            Animation                = GUARD_STANCE
                AnimationName        = GUManMocap_IDLA
                AnimationMode        = LOOP
            End
        End
        IdleAnimationState


            StateName                = STATE_Idle
            Animation                = IDLA
                AnimationName       = EUDwarfMin_IDLA
                AnimationMode       = ONCE
                AnimationPriority   = 20
                AnimationSpeedFactorRange = 0.9 1.1
                AnimationBlendTime    = 15
            End
            Animation                = IDLB
                AnimationName       = EUDwarfMin_IDLB
                AnimationMode       = ONCE
                AnimationPriority   = 10
                AnimationSpeedFactorRange = 0.9 1.1
                AnimationBlendTime    = 15
            End
            Animation                = IDLC
                AnimationName       = EUDwarfMin_IDLC
                AnimationMode       = ONCE
                AnimationPriority   = 5
                AnimationSpeedFactorRange = 0.9 1.1
                AnimationBlendTime    = 15
            End
            Animation                = IDLD
                AnimationName       = EUDwarfMin_IDLD
                AnimationMode       = ONCE
                AnimationPriority   = 7
                AnimationSpeedFactorRange = 0.9 1.1
                AnimationBlendTime    = 15
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Selected" then CurDrawableSetTransitionAnimState("TRANS_SelectedToIdle") end
            EndScript
        End

        TransitionState       = TRANS_IdleToSelected
            Animation           = ATNA
                AnimationName     = EUDwarfMin_ATNA
                AnimationMode     = ONCE
                AnimationSpeedFactorRange = 0.9 1.0

            End
        End
        TransitionState        = TRANS_SelectedToIdle
            Animation            = ATNC
                AnimationName    = EUDwarfMin_ATNC
                AnimationMode    = ONCE
                AnimationSpeedFactorRange = 0.9 1.0
            End
        End


        AnimationState        = ACTIVELY_CONSTRUCTING
            StateName           = STATE_Constructing
            Animation           = WRKA
                AnimationName     = EUDwarfMin_WRKB
                AnimationMode     = ONCE
                AnimationPriority    =    30
                AnimationSpeedFactorRange = 0.9 1.1
            End
            Animation           = WRKA
                AnimationName     = EUDwarfMin_WRKB
                AnimationMode     = ONCE
                AnimationPriority    =    30
                AnimationSpeedFactorRange = 0.9 1.1
            End
            Animation           = WRKB
                AnimationName     = EUDwarfMin_WRKC
                AnimationMode     = ONCE
                AnimationPriority    =    5
                AnimationSpeedFactorRange = 0.9 1.1
            End
            Animation           = WRKB
                AnimationName     = EUDwarfMin_WRKC
                AnimationMode     = ONCE
                AnimationPriority    =    5
                AnimationSpeedFactorRange = 0.9 1.1
            End
            Flags                    =    RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Idle" then CurDrawableSetTransitionAnimState("TRANS_RunToWork") end
            EndScript
        End




        TransitionState       = TRANS_RunToWork
            Animation           = ATNA
                AnimationName     = EUDwarfMin_WRKA
                AnimationMode     = ONCE
            End
        End

    End


    Side = Dwarves
    EditorSorting = UNIT
    ThreatLevel = 1.0
    Scale = 0.88
    ThingClass = HORDE_UNIT
    CommandPoints = DWARVEN_MINER_MOD_COMMAND_POINTS
    BountyValue = DWARVEN_GUARDIAN_BOUNTY_VALUE

    EmotionRange = 240

    TransportSlotCount = TRANSPORTSLOTCOUNT_UNIT


    WeaponSet
        Conditions            = None
        Weapon                = PRIMARY    DwarvenGuardianAxe
        AutoChooseSources    = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End
    WeaponSet
        Conditions            = PLAYER_UPGRADE
        Weapon                = PRIMARY    DwarvenGuardianAxe
        AutoChooseSources    = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End


    ArmorSet
        Conditions      = None
        Armor           = SoldierArmor
        DamageFX        = NormalDamageFX
    End
    ArmorSet
        Conditions      = PLAYER_UPGRADE
        Armor           = SoldierHeavyArmor
        DamageFX        = NormalDamageFX
    End

    VisionRange = VISION_STANDARD_MELEE
    VisionSide = 35%
    VisionRear = 25%
    VisionBonusPercentPerFoot = 2.0%
    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = 200
    ShroudClearingRange = SHROUD_CLEAR_STANDARD

    DisplayName = OBJECT:Dwarvenminer
    CrushableLevel = 0
    CrusherLevel = 1
    CrushOnlyWhileCharging = Yes
    MinCrushVelocityPercent = MINCRUSHVELOCITYPERCENT_STANDARD
    CrushDecelerationPercent = CRUSHDECELERATIONPERCENT_STANDARD
    CrushKnockback = 40
    CrushZFactor = 1.0
    CrushRevengeWeapon = BasicInfantryCrushRevenge

    CommandSet = DwarvenMinerCommandSet





    VoiceAttack                                = DwarfGuardianVoiceAttack
    VoiceAttackCharge                        = DwarfGuardianVoiceAttackCharge
    VoiceAttackMachine                        = DwarfGuardianVoiceAttack
    VoiceAttackStructure                    = DwarfGuardianVoiceAttackBuilding
    VoiceCreated                            = DwarfGuardianVoiceSalute
    VoiceFullyCreated                         = DwarfGuardianVoiceSalute
    VoiceGuard                                = DwarfGuardianVoiceMove
    VoiceMove                                = DwarfGuardianVoiceMove
    VoiceMoveToCamp                            = DwarfGuardianVoiceMoveCamp
    VoiceMoveWhileAttacking                    = DwarfGuardianVoiceDisengage
    VoicePriority                            = 47
    VoiceRetreatToCastle                    = DwarfGuardianVoiceRetreat
    VoiceSelect                                = DwarfGuardianVoiceSelectMS
    VoiceSelectBattle                         = DwarfGuardianVoiceSelectBattle

    VoiceEnterStateAttack                    = DwarfGuardianVoiceEnterStateAttack
    VoiceEnterStateAttackCharge                = DwarfGuardianVoiceEnterStateAttackCharge
    VoiceEnterStateAttackMachine            = DwarfGuardianVoiceEnterStateAttackBuilding
    VoiceEnterStateAttackStructure            = DwarfGuardianVoiceEnterStateAttackBuilding
    VoiceEnterStateMove                        = DwarfGuardianVoiceEnterStateMove
    VoiceEnterStateMoveToCamp                = DwarfGuardianVoiceEnterStateMoveCamp
    VoiceEnterStateMoveWhileAttacking        = DwarfGuardianVoiceEnterStateDisengage
    VoiceEnterStateRetreatToCastle            = DwarfGuardianVoiceEnterStateRetreat

    SoundImpact                                = ImpactHorse

    UnitSpecificSounds
        VoiceGarrison                        = DwarfGuardianVoiceMoveGarrison
        VoiceEnterUnitElvenTransportShip    = DwarfGuardianVoiceMoveShip
        VoiceInitiateCaptureBuilding        = DwarfGuardianVoiceCaptureBuilding

    End


    Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
        Key = Human Unit Infantry Gondor_Soldier
    End

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound: TauntHumanHitShield    Animation:GUMAArms_SKL.GUManMocap_IDLC    Frames: 17 27
        AnimationSound = Sound: TauntHumanHitShield    Animation:GUMAArms_SKL.GUManMocap_TNTC    Frames: 74 82 94 125 139

        AnimationSound = Sound:BodyFallGeneric1        Animation:GUMAArms_SKL.GUManMocap_DIEB    Frames:89
        AnimationSound = Sound:BodyFallGeneric1        Animation:GUMAArms_SKL.GUManMocap_DIEC    Frames:71
        AnimationSound = Sound:BodyFallGeneric1        Animation:GUMAArms_SKL.GUManMocap_DIED    Frames:29
        AnimationSound = Sound:BodyFallGeneric1        Animation:GUMAArms_SKL.GUManMocap_DIEE    Frames:28
        AnimationSound = Sound:BodyFallGeneric1        Animation:GUMAArms_SKL.GUMAARMS_LNDA    Frames:0
    End




    RadarPriority = UNIT
    KindOf = PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE THROWN_OBJECT ATTACK_NEEDS_LINE_OF_SIGHT NOTIFY_OF_PREATTACK GRAB_AND_DROP

    Body = ActiveBody ModuleTag_02
        CheerRadius       = EMOTION_CHEER_RADIUS
        MaxHealth         = 200
        MaxHealthDamaged  = 100
    End


    Behavior = ArmorUpgrade ArmorUpgradeModuleTagGuardian
        TriggeredBy = Upgrade_DwarvenMithrilMail
        ArmorSetFlag            = PLAYER_UPGRADE

    End

    Behavior = SubObjectsUpgrade Armor_UpgradeGuardian
        TriggeredBy        = Upgrade_DwarvenMithrilMail
        UpgradeTexture    = EUDwarfmin.tga 0 EUDwarfmin_HA.tga
        RecolorHouse    = Yes
        ExcludeSubobjects = Forged_Blade
    End

    Behavior = WorkerAIUpdate ModuleTag_10
        AutoAcquireEnemiesWhenIdle     = Yes ATTACK_BUILDINGS
        RepairHealthPercentPerSecond   = 0.2%
        AILuaEventsList                = StandardPeasantFunctions
        AttackPriority                 = AttackPriority_Infantry
        SpecialContactPoints           = Repair
    End

    LocomotorSet
        Locomotor = HumanSpecialChargeLocomotor
        Condition = SET_NORMAL
        Speed     = 40
    End

    LocomotorSet
        Locomotor = BurningDeathLocomotorInfantry
        Condition = SET_BURNINGDEATH
        Speed      = BURNINGDEATH_WANDERSPEED_INFANTRY
    End

    Behavior = PhysicsBehavior ModuleTag_04
        GravityMult                = 1.0
        ShockStunnedTimeLow        = 1400
        ShockStunnedTimeHigh    = 2400
        ShockStandingTime        = 666
    End

    Behavior = AttributeModifierUpgrade ModuleTag_AMU
        TriggeredBy = Upgrade_GondorFighterFearless
        AttributeModifier = FearlessForever
    End

    Behavior = SquishCollide ModuleTag_06

    End

    Behavior = HordeMemberCollide ModuleTag_HMC

    End

    Behavior = HitReactionBehavior HitReactionBehaviorModuleTag
        HitReactionLifeTimer1 = 2500
        HitReactionLifeTimer2 = 2500
        HitReactionLifeTimer3 = 2500

        HitReactionThreshold1 = 5.0
        HitReactionThreshold2 = 25.0
        HitReactionThreshold3 = 50.0

        FastHitsResetReaction = Yes    If set -- when hits occur faster than the reaction animations, it will reset the animation. (like getting riddled with machine gun bullets)
    End

    Behavior = SlowDeathBehavior ModuleTag_05
        DeathTypes            = ALL -KNOCKBACK -FADED
        SinkDelay            = 3000
        SinkRate            = 0.90
        DestructionDelay    = 15000
        Sound                = INITIAL DwarfGenericVoiceDie
    End

    Behavior = SlowDeathBehavior ModuleTag_07

        DeathTypes            = NONE +KNOCKBACK
        SinkDelay            = 3000
        SinkRate            = 0.60
        DestructionDelay    = 10000
    End

    Behavior = SlowDeathBehavior ModuleTag_FadeDeath
        DeathTypes            = NONE +FADED
        FadeDelay            = 0
        FadeTime            = 5000
        DestructionDelay    = 5000
        DeathFlags            = DEATH_2

        Sound = INITIAL SpellGenericUnsummonMS
    End

    Behavior = RepairSpecialPower ModuleTag_RepairSPecialPower
        SpecialPowerTemplate      = SpecialRepairStructure
    End

    Behavior = BezierProjectileBehavior ModuleTag_08

        FirstHeight = 24
        SecondHeight = 24
        FirstPercentIndent = 30%
        SecondPercentIndent = 70%
        TumbleRandomly = Yes

        CrushStyle = Yes
        DieOnImpact = Yes
        BounceCount = 1
        BounceDistance = 40
        BounceFirstHeight = 24
        BounceSecondHeight = 24
        BounceFirstPercentIndent = 20%
        BounceSecondPercentIndent = 80%

        GroundHitFX       = FX_ThrownRockGroundHit
        GroundBounceFX    = FX_ThrownRockBounceHit
    End


    Geometry            = CYLINDER
    GeometryMajorRadius = 8.0
    GeometryMinorRadius = 8.0
    GeometryHeight        = 19.2
    GeometryIsSmall        = No

    Shadow            = SHADOW_DECAL
    ShadowSizeX            = 19
    ShadowSizeY            = 19
    ShadowTexture        = ShadowI
End

Object DwarvenMinerMod_Dozer


    SelectPortrait = UPDwarven_Porter


    ButtonImage = BDFortress_Porter

    Draw = W3DTruckDraw ModuleTag_01

        OkToChangeModelColor = Yes



        DefaultModelConditionState
            Model                    = DUPorter_SKN
            Skeleton                = DUPorter_SKL
        End


        IdleAnimationState
            StateName                = STATE_Running
            Animation                = IDLA
                AnimationName        = DUPorter_IDLA
                AnimationMode        = ONCE
                AnimationPriority   = 20
            End
        End

        AnimationState                = DYING DEATH_1
            Animation                = DIEB
                AnimationName        = DUPorter_DIEB
                AnimationMode        = ONCE
            End
        End

        AnimationState                = DYING DEATH_2
            Animation
                AnimationName        = DUPorter_IDLA
                AnimationMode        = LOOP
            End
        End

        AnimationState                = DYING
            Animation                = DIEA
                AnimationName        = DUPorter_DIEA
                AnimationMode        = ONCE
            End
        End

        AnimationState                        = PARALYZED
            Animation
                AnimationName                = DUPorter_IDLA

                AnimationMode                = LOOP
            End
        End


        AnimationState                = MOVING WANDER
            Animation                = WLKA
                AnimationName        = DUPorter_RUNA
                AnimationMode        = LOOP
            End
            Flags                    = RANDOMSTART

        End

        AnimationState                = MOVING
            StateName                = STATE_Running
            Animation                = RUNNING
                AnimationName        = DUPorter_RUNA
                AnimationMode        = LOOP
            End
            Flags                    = RANDOMSTART

        End

        AnimationState        = UNPACKING PACKING_TYPE_1
            Animation
                AnimationName        = DUPorter_FIRA
                AnimationMode        = ONCE
            End
            ParticleSysBone = BUCKET PorterFireWater FollowBone:Yes
            BeginScript
                CurDrawablePlaySound("MenBuilderFireExtinguish")
            EndScript
        End

        AnimationState        = ACTIVELY_CONSTRUCTING
            StateName           = STATE_Constructing
            Animation           = WRKA
                AnimationName     = DUPorter_WRKB
                AnimationMode     = ONCE
                AnimationPriority    =    30
                AnimationSpeedFactorRange = 0.9 1.1
            End
            Animation           = WRKA
                AnimationName     = DUPorter_WRKB
                AnimationMode     = ONCE
                AnimationPriority    =    30
                AnimationSpeedFactorRange = 0.9 1.1
            End
            Animation           = WRKB
                AnimationName     = DUPorter_WRKC
                AnimationMode     = ONCE
                AnimationPriority    =    5
                AnimationSpeedFactorRange = 0.9 1.1
            End
            Animation           = WRKB
                AnimationName     = DUPorter_WRKC
                AnimationMode     = ONCE
                AnimationPriority    =    5
                AnimationSpeedFactorRange = 0.9 1.1
            End
            Flags                    =    RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Running" then CurDrawableSetTransitionAnimState("TRANS_RunToWork") end
            EndScript
        End




        TransitionState       = TRANS_RunToWork
            Animation           = ATNA
                AnimationName     = DUPorter_WRKA
                AnimationMode     = ONCE
            End
        End



        LeftFrontTireBone            = WHEEL_L01
        RightFrontTireBone            = WHEEL_R01


        TireRotationMultiplier        = 0.2
    End

    #include "..\..\..\includes\StunDrawModuleMedium.inc"



    Side = Dwarves
    EditorSorting                    =    UNIT
    ThingClass                        = HORDE_UNIT
    CommandPoints = 0
    Scale             = 0.9

    TransportSlotCount = TRANSPORTSLOTCOUNT_DOZER

    ArmorSet
        Conditions                    = None
        Armor                        = PorterArmor
        DamageFX                    = NormalDamageFX
    End

    BuildCost = 500
    BuildTime = STRONG_BUILDTIME
    VisionRange          = 300
    ShroudClearingRange  = 200
    BountyValue          = 75

    DisplayName = OBJECT:DwarvenPorter
    CrushableLevel = 1
    ShockwaveResistance = SHOCKWAVE_RESISTANCE_IMMUNE
    IsTrainable = No

    CommandSet = DwarvenMinerCommandSet




    VoiceCreated                            = DwarfBuilderVoiceSalute
    VoiceFullyCreated                       = DwarfBuilderVoiceSalute
    VoiceMove                               = DwarfBuilderVoiceMove
    VoiceMoveToCamp                         = DwarfBuilderVoiceMove
    VoicePriority                           = 6
    VoiceRetreatToCastle                    = DwarfBuilderVoiceMove
    VoiceSelect                             = DwarfBuilderVoiceSelectMS

    SoundImpact                              = ImpactHorse



    UnitSpecificSounds
        VoiceNoBuild                        = DwarfBuilderVoiceCantBuild
        VoiceBuildResponse                  = DwarfBuilderVoiceBuild
        VoiceExtinguishFireAtLocation       = DwarfBuilderVoiceMove
        VoiceGarrison                       = DwarfBuilderVoiceMove
        VoiceEnterUnitElvenTransportShip    = DwarfBuilderVoiceMove
        VoiceInitiateCaptureBuilding        = DwarfBuilderVoiceMove
        VoiceSelectIdleWorker               = DwarfBuilderVoiceSelectIdle

    End

    CrowdResponseKey = Dwarf

    Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
        Key = Dwarf
    End

    #include "..\..\..\Includes\StandardUnitEvaEvents.inc"


    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound:BodyFallGeneric1        Animation:EUDwarfMin_SKL.EUDwarfMin_DIEA   Frames:89
        AnimationSound = Sound:BodyFallGeneric1        Animation:EUDwarfMin_SKL.EUDwarfMin_LNDA   Frames:0
    End




    RadarPriority = UNIT
    KindOf = PRELOAD SELECTABLE DOZER CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE THROWN_OBJECT PORTER IGNORES_SELECT_ALL


    Body = ActiveBody ModuleTag_02
        MaxHealth         = DWARVEN_PORTER_HEALTH
        MaxHealthDamaged  = DWARVEN_PORTER_HEALTH_DAMAGED
        RecoveryTime      = DWARVEN_PORTER_HEALTH_RECOVERY_TIME
    End

     Behavior = DozerAIUpdate ModuleTag_03
        AILuaEventsList                 = StandardPorterFunctions
         RepairHealthPercentPerSecond   = 1%
         BoredTime                      = 5000
         BoredRange                     = 500
         AutoAcquireEnemiesWhenIdle     = No
        SpecialContactPoints            = Repair
     End

    Behavior = CommandSetUpgrade ModuleTag_CommandSetErebor
        TriggeredBy       = Upgrade_SubFactionErebor
		ConflictsWith	  	  = Upgrade_ObjectUnderAIControl
        CommandSet        = DwarvenMinerCommandSet_Erebor
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSetEisenberge
        TriggeredBy       = Upgrade_SubFactionIronHills
		ConflictsWith	  	  = Upgrade_ObjectUnderAIControl
        CommandSet        = DwarvenMinerCommandSet_Eisenberge
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSetEredLuin
        TriggeredBy       = Upgrade_SubFactionEredLuin
		ConflictsWith	  	  = Upgrade_ObjectUnderAIControl
        CommandSet        = DwarvenMinerCommandSet_EredLuin
    End





    Behavior = CommandSetUpgrade ModuleTag_CommandSetErebor_AI
        TriggeredBy       = Upgrade_SubFactionErebor Upgrade_ObjectUnderAIControl
	RequiresAllTriggers = Yes
        CommandSet        = DwarvenMinerCommandSet_Erebor_AI
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSetEisenberge_AI
        TriggeredBy       = Upgrade_SubFactionIronHills Upgrade_ObjectUnderAIControl
	RequiresAllTriggers = Yes
        CommandSet        = DwarvenMinerCommandSet_Eisenberge_AI
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSetEredLuin_AI
        TriggeredBy       = Upgrade_SubFactionEredLuin Upgrade_ObjectUnderAIControl
	RequiresAllTriggers = Yes
        CommandSet        = DwarvenMinerCommandSet_EredLuin_AI
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSetKampagne
        TriggeredBy       = Upgrade_AbendsternSpellbook
        CommandSet        = DwarvenPorterCommandSet
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSetWotr
        TriggeredBy    = Upgrade_DwarvesFortressWotrEndCS
        CommandSet     = DwarvenMinerCommandSet_Erebor_wotr
    End

    LocomotorSet
        Locomotor = PorterLocomotor
        Condition = SET_NORMAL
        Speed     = NORMAL_INGAME_PORTER_SPEED
    End

    LocomotorSet
        Locomotor = PorterLocomotor
        Condition = SET_WANDER
        Speed     = NORMAL_INGAME_PORTER_SPEED
    End

    Behavior = PhysicsBehavior ModuleTag_04
        GravityMult                = 1.0
        ShockStunnedTimeLow        = 1400
        ShockStunnedTimeHigh    = 2400
        ShockStandingTime        = 666
    End


    Behavior = SquishCollide ModuleTag_06

    End

    Behavior = SlowDeathBehavior SlowDeathBehaviorModuleTag_1
        DeathTypes = ALL -CRUSHED -EXPLODED -KNOCKBACK -DETONATED -SPLATTED -FADED -SLAUGHTERED
        SinkDelay = 3000
        SinkRate = 1.40
        DestructionDelay = 13000
        Sound = INITIAL DwarfBuilderVoiceDie
        FX      = INITIAL FX_PorterDie
    End


    Behavior = SlowDeathBehavior SlowDeathBehaviorModuleTag_Decommissioned
        DeathTypes = NONE +SLAUGHTERED
        SinkDelay = 1000
        SinkRate = 1.40
        DestructionDelay = 5000
    End

    Behavior = SlowDeathBehavior SlowDeathBehaviorModuleTag_2
        DeathTypes = NONE +CRUSHED +EXPLODED +KNOCKBACK +DETONATED +SPLATTED
        SinkDelay = 3000
        SinkRate = 1.40
        DestructionDelay = 13000
        DeathFlags = DEATH_1
        FX = INITIAL FX_PorterDieExplosion
        Sound = INITIAL DwarfBuilderVoiceDie
    End

    Behavior = SlowDeathBehavior ModuleTag_ConstructionDeath
        DeathTypes            = NONE +FADED
        DeathFlags            = DEATH_2
        FadeDelay            = 500
        FadeTime            = 3500
        DestructionDelay    = 4000
    End

    Behavior = RepairSpecialPower ModuleTag_RepairSPecialPower
        SpecialPowerTemplate      = SpecialRepairStructure
    End

    Behavior = BezierProjectileBehavior ModuleTag_08

        FirstHeight = 24
        SecondHeight = 24
        FirstPercentIndent = 30%
        SecondPercentIndent = 70%
        TumbleRandomly = Yes

        CrushStyle = Yes
        DieOnImpact = Yes
        BounceCount = 1
        BounceDistance = 40
        BounceFirstHeight = 24
        BounceSecondHeight = 24
        BounceFirstPercentIndent = 20%
        BounceSecondPercentIndent = 80%

        GroundHitFX       = FX_ThrownRockGroundHit
        GroundBounceFX    = FX_ThrownRockBounceHit
    End


    Behavior = FireWeaponUpdate FireWeaponUpdateModuleTagWOTR
        FireWeaponNugget
            WeaponName = DwarvesFortressWotrWeapon
            FireDelay  = 0
            OneShot    = No
        End
    End




    Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        AfraidOf                    =    NONE +RohanTreeBerd +RohanEntFir +RohanEntAsh +RohanEntBirch +MordorBalrog +MordorMountainTroll +MordorDrummerTroll +MordorFellBeast +MordorMumakil
        AlwaysAfraidOf                =    NONE +MordorWitchKing +MordorWitchKingOnFellBeast +MordorBalrog +RohanOathbreaker

        FearScanDistance            =    250

        AddEmotion    =    Terror_Base
        AddEmotion    =   BraceForBeingCrushed_Base
    End

    #include "..\..\..\Includes\PorterExtinguishFire.inc"


    Geometry            = CYLINDER
    GeometryMajorRadius = 8.0
    GeometryMinorRadius = 8.0
    GeometryHeight        = 19.2
    GeometryIsSmall        = No

    Shadow            = SHADOW_DECAL
    ShadowSizeX            = 19
    ShadowSizeY            = 19
    ShadowTexture        = ShadowI
End



Object DwarvenMinerMod_Erebor

    SelectPortrait         = UPEreborMiner
    ButtonImage            = HSEreborMiner

    Draw = W3DHordeModelDraw ModuleTag_01
        OkToChangeModelColor = Yes
        StaticModelLODMode = Yes

        WadingParticleSys = WaterRipplesTrail

        DefaultModelConditionState
            Model               = EUDwarfMin_SKN
            Skeleton            = EUDwarfMin_SKL
        End













        AnimationState                        = THROWN_PROJECTILE
            Animation                       = FlyA
                AnimationName                   = EUDwarfMin_FLYA
                AnimationMode               = LOOP
            End
            Flags                           = RANDOMSTART
        End

        AnimationState                        = FREEFALL
            Animation                        = Falling
                AnimationName                = EUDwarfMin_FLYA
                AnimationMode                = LOOP
                AnimationBlendTime            = 10
            End
        End



        AnimationState                        = STUNNED_FLAILING
            Animation                       = FlyA
                AnimationName               = EUDwarfMin_FLYA
                AnimationMode               = LOOP
            End
            Flags                           = RANDOMSTART
        End

        AnimationState                         = DYING SPLATTED
            Animation                         = Splatted_On_Ground
                AnimationName                 = EUDwarfMin_LNDA
                AnimationMode                 = ONCE
            End
            EnteringStateFX                    = FX_OrcHitGround
        End

        AnimationState                        = DYING
            Animation                        = DIEB
                AnimationName                = EUDwarfMin_DIEB
                AnimationMode                = ONCE
            End
            Animation                        = DIEC
                AnimationName                = EUDwarfMin_DIEB
                AnimationMode                = ONCE
            End
        End



        AnimationState                        = STUNNED_STANDING_UP
            Animation                        = GTPA
                AnimationName                = EUDwarfMin_GTPA
                AnimationMode                = ONCE
                AnimationSpeedFactorRange = 1.5 1.5
            End
        End



        AnimationState            =     STUNNED
            Animation            =     Slatted_On_Ground
            AnimationName                 = EUDwarfMin_LNDA
                AnimationMode                 = ONCE
            End
            EnteringStateFX                    = FX_OrcHitGround

       End


        AnimationState        = MOVING FIRING_OR_PREATTACK_A
            ShareAnimation        = Yes
            Animation           = RunAndFire
                AnimationName       = EUDwarfMin_ATRA
                AnimationMode       = LOOP
            End
            Flags               = RANDOMSTART
        End



        AnimationState                        = MOVING EMOTION_TERROR EMOTION_LOOK_TO_SKY

            Animation                    = TerrorFromTheSky
                AnimationName            = EUDwarfMin_RUNA
                AnimationMode            = LOOP
            End
            Animation                    = TerrorFromTheSky
                AnimationName            = EUDwarfMin_RUNA
                AnimationMode            = LOOP
            End
            Flags = RANDOMSTART
        End
        AnimationState                        = MOVING EMOTION_TERROR

            Animation                        = TerrorFromTheSky
                AnimationName                = EUDwarfMin_RUNA
                AnimationMode                = ONCE
            End
            Animation                        = TerrorFromTheSky
                AnimationName                = EUDwarfMin_RUNA
                AnimationMode                = ONCE
            End
            Flags                            = RESTART_ANIM_WHEN_COMPLETE
        End



        AnimationState                        = MOVING BACKING_UP

            Animation                        = BAKA
                AnimationName                = EUDwarfMin_RUNA
                AnimationMode                = LOOP
            End
            Flags = RANDOMSTART
        End

        AnimationState                        = MOVING ATTACKING
            ShareAnimation                    = Yes
            Animation                        = RUNA
                AnimationName                = EUDwarfMin_RUNA
                AnimationMode                = LOOP
                Distance                    = 25
            End
            Flags                            = RANDOMSTART

        End

        AnimationState                        = MOVING CHARGING
            ShareAnimation                    = Yes
            Animation                        = RUNB
                AnimationName                = EUDwarfMin_RUNA
                AnimationMode                = LOOP
                Distance                    = 30

            End
            Flags                            = RANDOMSTART

        End

        AnimationState                        = MOVING

            ShareAnimation                    = Yes
            Animation                        = RUNB
                AnimationName                = EUDwarfMin_RUNA
                AnimationMode                = LOOP
                Distance                    = 30
            End
            Flags                            = RANDOMSTART

        End


        AnimationState                        = EMOTION_UNCONTROLLABLY_AFRAID
            Animation                        = FERA
                AnimationName                = EUDwarfMin_CHRA
                AnimationMode                = LOOP
            End
        End

        AnimationState                        = FIRING_OR_PREATTACK_A
            Animation                        = ATK1
                AnimationName                = EUDwarfMin_ATKA
                AnimationMode                = ONCE
                UseWeaponTiming                = Yes
            End

        End

        AnimationState                        = ATTACKING
            Animation                        = ALERT_1
                AnimationName                = EUDwarfMin_IDLA
                AnimationMode                = LOOP
            End
        End








































































        AnimationState                        = EMOTION_ALERT
            Animation                        = ALERT_1
                AnimationName                = EUDwarfMin_IDLA
                AnimationMode                = LOOP
                AnimationPriority            = 10
            End
            Flags                            = RESTART_ANIM_WHEN_COMPLETE
        End


        AnimationState        = SELECTED
            StateName           = STATE_Selected
            Animation           = ATNB
                AnimationName     = EUDwarfMin_ATNB
                AnimationMode     = LOOP
            End

            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Idle"
                then
                    CurDrawableSetTransitionAnimState("TRANS_IdleToSelected")
                end
                if CurDrawableModelcondition("ATTACKING")
                then
                    return "IDLA"
                else
                    return "ATNA"
                end
            EndScript

            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Idle" then CurDrawableSetTransitionAnimState("TRANS_IdleToSelected") end
            EndScript
        End


        AnimationState                = WEAPONSET_PLAYER_UPGRADE
            StateName                = STATE_Idle
            Animation                = IDLB
                AnimationName       = EUDwarfMin_IDLB
                AnimationMode       = ONCE
                AnimationSpeedFactorRange = 0.9 1.1
            End
            Animation                = IDLC
                AnimationName       = EUDwarfMin_IDLC
                AnimationMode       = ONCE
                AnimationSpeedFactorRange = 0.9 1.1
            End
            Animation                = IDLD
                AnimationName       = EUDwarfMin_IDLD
                AnimationMode       = ONCE
                AnimationSpeedFactorRange = 0.9 1.1
            End










            Flags                    = RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Selected" then CurDrawableSetTransitionAnimState("TRANS_SelectedToIdle") end
            EndScript
        End
        AnimationState                = USER_3
            StateName                = STATE_User_3
            Animation                = GUARD_STANCE
                AnimationName        = GUManMocap_IDLA
                AnimationMode        = LOOP
            End
        End
        IdleAnimationState


            StateName                = STATE_Idle
            Animation                = IDLA
                AnimationName       = EUDwarfMin_IDLA
                AnimationMode       = ONCE
                AnimationPriority   = 20
                AnimationSpeedFactorRange = 0.9 1.1
                AnimationBlendTime    = 15
            End
            Animation                = IDLB
                AnimationName       = EUDwarfMin_IDLB
                AnimationMode       = ONCE
                AnimationPriority   = 10
                AnimationSpeedFactorRange = 0.9 1.1
                AnimationBlendTime    = 15
            End
            Animation                = IDLC
                AnimationName       = EUDwarfMin_IDLC
                AnimationMode       = ONCE
                AnimationPriority   = 5
                AnimationSpeedFactorRange = 0.9 1.1
                AnimationBlendTime    = 15
            End
            Animation                = IDLD
                AnimationName       = EUDwarfMin_IDLD
                AnimationMode       = ONCE
                AnimationPriority   = 7
                AnimationSpeedFactorRange = 0.9 1.1
                AnimationBlendTime    = 15
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Selected" then CurDrawableSetTransitionAnimState("TRANS_SelectedToIdle") end
            EndScript
        End

        TransitionState       = TRANS_IdleToSelected
            Animation           = ATNA
                AnimationName     = EUDwarfMin_ATNA
                AnimationMode     = ONCE
                AnimationSpeedFactorRange = 0.9 1.0

            End
        End
        TransitionState        = TRANS_SelectedToIdle
            Animation            = ATNC
                AnimationName    = EUDwarfMin_ATNC
                AnimationMode    = ONCE
                AnimationSpeedFactorRange = 0.9 1.0
            End
        End


        AnimationState        = ACTIVELY_CONSTRUCTING
            StateName           = STATE_Constructing
            Animation           = WRKA
                AnimationName     = EUDwarfMin_WRKB
                AnimationMode     = ONCE
                AnimationPriority    =    30
                AnimationSpeedFactorRange = 0.9 1.1
            End
            Animation           = WRKA
                AnimationName     = EUDwarfMin_WRKB
                AnimationMode     = ONCE
                AnimationPriority    =    30
                AnimationSpeedFactorRange = 0.9 1.1
            End
            Animation           = WRKB
                AnimationName     = EUDwarfMin_WRKC
                AnimationMode     = ONCE
                AnimationPriority    =    5
                AnimationSpeedFactorRange = 0.9 1.1
            End
            Animation           = WRKB
                AnimationName     = EUDwarfMin_WRKC
                AnimationMode     = ONCE
                AnimationPriority    =    5
                AnimationSpeedFactorRange = 0.9 1.1
            End
            Flags                    =    RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Idle" then CurDrawableSetTransitionAnimState("TRANS_RunToWork") end
            EndScript
        End




        TransitionState       = TRANS_RunToWork
            Animation           = ATNA
                AnimationName     = EUDwarfMin_WRKA
                AnimationMode     = ONCE
            End
        End

    End




    Side = Dwarves
    EditorSorting = UNIT
    ThreatLevel = 1.0
    Scale = 0.88
    IsTrainable         = No

    ThingClass = HORDE_UNIT
    CommandPoints = 0

    EmotionRange = 240
    TransportSlotCount  = TRANSPORTSLOTCOUNT_DOZER

    WeaponSet
        Conditions           = None
        Weapon               = PRIMARY    DwarvenMinerHammerAxe
        AutoChooseSources    = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End


    ArmorSet
        Conditions      = None
        Armor           = SoldierArmor
        DamageFX        = NormalDamageFX
    End
    ArmorSet
        Conditions      = PLAYER_UPGRADE
        Armor           = SoldierHeavyArmor
        DamageFX        = NormalDamageFX
    End

    VisionRange          = 300
    ShroudClearingRange  = 200
    BountyValue          = 75

    DisplayName = OBJECT:Dwarvenminer
    CrushableLevel = 0
    CrusherLevel = 0

    BuildCost           = 500
    BuildTime           = STRONG_BUILDTIME

    CommandSet = DwarvenMinerCommandSet_Erebor




    VoiceCreated                            = DwarfBuilderVoiceSalute
    VoiceFullyCreated                       = DwarfBuilderVoiceSalute
    VoiceMove                               = DwarfBuilderVoiceMove
    VoiceMoveToCamp                         = DwarfBuilderVoiceMove
    VoicePriority                           = 6
    VoiceRetreatToCastle                    = DwarfBuilderVoiceMove
    VoiceSelect                             = DwarfBuilderVoiceSelectMS

    SoundImpact                              = ImpactHorse



    UnitSpecificSounds
        VoiceNoBuild                        = DwarfBuilderVoiceCantBuild
        VoiceBuildResponse                  = DwarfBuilderVoiceBuild
        VoiceExtinguishFireAtLocation       = DwarfBuilderVoiceMove
        VoiceGarrison                       = DwarfBuilderVoiceMove
        VoiceEnterUnitElvenTransportShip    = DwarfBuilderVoiceMove
        VoiceInitiateCaptureBuilding        = DwarfBuilderVoiceMove
        VoiceSelectIdleWorker               = DwarfBuilderVoiceSelectIdle

    End

    CrowdResponseKey = Dwarf

    Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
        Key = Dwarf
    End

    #include "..\..\..\Includes\StandardUnitEvaEvents.inc"


    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound:BodyFallGeneric1        Animation:EUDwarfMin_SKL.EUDwarfMin_DIEA   Frames:89
        AnimationSound = Sound:BodyFallGeneric1        Animation:EUDwarfMin_SKL.EUDwarfMin_LNDA   Frames:0
    End




    RadarPriority = UNIT
    KindOf              = PRELOAD SELECTABLE DOZER CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE THROWN_OBJECT PORTER IGNORES_SELECT_ALL

    Body = ActiveBody ModuleTag_02
        CheerRadius       = EMOTION_CHEER_RADIUS
        MaxHealth         = 500
        MaxHealthDamaged  = 250
    End

    Behavior = ArmorUpgrade ArmorUpgradeModuleTagGuardian
        TriggeredBy = Upgrade_DwarvenMithrilMail
        ArmorSetFlag            = PLAYER_UPGRADE

    End

    Behavior = SubObjectsUpgrade Armor_UpgradeGuardian
        TriggeredBy        = Upgrade_DwarvenMithrilMail
        UpgradeTexture    = EUDwarfmin.tga 0 EUDwarfmin_HA.tga
        RecolorHouse    = Yes
        ExcludeSubobjects = Forged_Blade
    End

    Behavior = DozerAIUpdate ModuleTag_03
        AILuaEventsList                 = InfantryFunctions
        RepairHealthPercentPerSecond    = 2%
        BoredTime                       = 5000
        BoredRange                      = 150
        AutoAcquireEnemiesWhenIdle      = No
        SpecialContactPoints            = Repair
    End




    Behavior = SubObjectsUpgrade Armor_Upgrade2
        TriggeredBy          = Upgrade_SubFactionErebor
        UpgradeTexture       = EUDwarfmin.tga 0 EUDwarfmin_ereb.tga
        UpgradeTexture       = eudwarfeng.tga 0 eudwarfeng_ereb.tga
        UpgradeTexture       = eudwarfram_eng.tga 0 eudwarfram_ereb.tga

        ExcludeSubobjects    = Forged_Blade
    End



    Behavior = SubObjectsUpgrade ModuleTag_Making
        TriggeredBy       = Upgrade_AllFactionUpgrade
        HideSubObjects    = HAMMER1
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = Hero
    End




    LocomotorSet
        Locomotor = HumanSpecialChargeLocomotor
        Condition = SET_NORMAL
        Speed     = 40
    End

    LocomotorSet
        Locomotor = BurningDeathLocomotorInfantry
        Condition = SET_BURNINGDEATH
        Speed      = BURNINGDEATH_WANDERSPEED_INFANTRY
    End

    Behavior = PhysicsBehavior ModuleTag_04
        GravityMult                = 1.0
        ShockStunnedTimeLow        = 1400
        ShockStunnedTimeHigh    = 2400
        ShockStandingTime        = 666
    End

    Behavior = AttributeModifierUpgrade ModuleTag_AMU
        TriggeredBy = Upgrade_GondorFighterFearless
        AttributeModifier = FearlessForever
    End

    Behavior = SquishCollide ModuleTag_06

    End

    Behavior = HordeMemberCollide ModuleTag_HMC

    End

    Behavior = HitReactionBehavior HitReactionBehaviorModuleTag
        HitReactionLifeTimer1 = 2500
        HitReactionLifeTimer2 = 2500
        HitReactionLifeTimer3 = 2500

        HitReactionThreshold1 = 5.0
        HitReactionThreshold2 = 25.0
        HitReactionThreshold3 = 50.0

        FastHitsResetReaction = Yes    If set -- when hits occur faster than the reaction animations, it will reset the animation. (like getting riddled with machine gun bullets)
    End

    Behavior = SlowDeathBehavior ModuleTag_05
        DeathTypes            = ALL -KNOCKBACK -FADED
        SinkDelay            = 3000
        SinkRate            = 0.90
        DestructionDelay    = 15000
        Sound                = INITIAL DwarfGenericVoiceDie
    End

    Behavior = SlowDeathBehavior ModuleTag_07

        DeathTypes            = NONE +KNOCKBACK
        SinkDelay            = 3000
        SinkRate            = 0.60
        DestructionDelay    = 10000
    End

    Behavior = SlowDeathBehavior ModuleTag_FadeDeath
        DeathTypes            = NONE +FADED
        FadeDelay            = 0
        FadeTime            = 5000
        DestructionDelay    = 5000
        DeathFlags            = DEATH_2

        Sound = INITIAL SpellGenericUnsummonMS
    End

    Behavior = RepairSpecialPower ModuleTag_RepairSPecialPower
        SpecialPowerTemplate      = SpecialRepairStructure
    End

    Behavior = BezierProjectileBehavior ModuleTag_08

        FirstHeight = 24
        SecondHeight = 24
        FirstPercentIndent = 30%
        SecondPercentIndent = 70%
        TumbleRandomly = Yes

        CrushStyle = Yes
        DieOnImpact = Yes
        BounceCount = 1
        BounceDistance = 40
        BounceFirstHeight = 24
        BounceSecondHeight = 24
        BounceFirstPercentIndent = 20%
        BounceSecondPercentIndent = 80%

        GroundHitFX       = FX_ThrownRockGroundHit
        GroundBounceFX    = FX_ThrownRockBounceHit
    End


    Geometry            = CYLINDER
    GeometryMajorRadius = 8.0
    GeometryMinorRadius = 8.0
    GeometryHeight        = 19.2
    GeometryIsSmall        = No

    Shadow            = SHADOW_DECAL
    ShadowSizeX            = 19
    ShadowSizeY            = 19
    ShadowTexture        = ShadowI
End


Object DwarvenMinerMod_EredLuin

    SelectPortrait         = UPEredLuinMiner
    ButtonImage            = HSEredLuinMiner

    Draw = W3DHordeModelDraw ModuleTag_01
        OkToChangeModelColor = Yes
        StaticModelLODMode = Yes

        WadingParticleSys = WaterRipplesTrail

        DefaultModelConditionState
            Model               = EUDwarfMin_SKN
            Skeleton            = EUDwarfMin_SKL
        End













        AnimationState                        = THROWN_PROJECTILE
            Animation                       = FlyA
                AnimationName                   = EUDwarfMin_FLYA
                AnimationMode               = LOOP
            End
            Flags                           = RANDOMSTART
        End

        AnimationState                        = FREEFALL
            Animation                        = Falling
                AnimationName                = EUDwarfMin_FLYA
                AnimationMode                = LOOP
                AnimationBlendTime            = 10
            End
        End



        AnimationState                        = STUNNED_FLAILING
            Animation                       = FlyA
                AnimationName               = EUDwarfMin_FLYA
                AnimationMode               = LOOP
            End
            Flags                           = RANDOMSTART
        End

        AnimationState                         = DYING SPLATTED
            Animation                         = Splatted_On_Ground
                AnimationName                 = EUDwarfMin_LNDA
                AnimationMode                 = ONCE
            End
            EnteringStateFX                    = FX_OrcHitGround
        End

        AnimationState                        = DYING
            Animation                        = DIEB
                AnimationName                = EUDwarfMin_DIEB
                AnimationMode                = ONCE
            End
            Animation                        = DIEC
                AnimationName                = EUDwarfMin_DIEB
                AnimationMode                = ONCE
            End
        End



        AnimationState                        = STUNNED_STANDING_UP
            Animation                        = GTPA
                AnimationName                = EUDwarfMin_GTPA
                AnimationMode                = ONCE
                AnimationSpeedFactorRange = 1.5 1.5
            End
        End



        AnimationState            =     STUNNED
            Animation            =     Slatted_On_Ground
            AnimationName                 = EUDwarfMin_LNDA
                AnimationMode                 = ONCE
            End
            EnteringStateFX                    = FX_OrcHitGround

       End


        AnimationState        = MOVING FIRING_OR_PREATTACK_A
            ShareAnimation        = Yes
            Animation           = RunAndFire
                AnimationName       = EUDwarfMin_ATRA
                AnimationMode       = LOOP
            End
            Flags               = RANDOMSTART
        End



        AnimationState                        = MOVING EMOTION_TERROR EMOTION_LOOK_TO_SKY

            Animation                    = TerrorFromTheSky
                AnimationName            = EUDwarfMin_RUNA
                AnimationMode            = LOOP
            End
            Animation                    = TerrorFromTheSky
                AnimationName            = EUDwarfMin_RUNA
                AnimationMode            = LOOP
            End
            Flags = RANDOMSTART
        End
        AnimationState                        = MOVING EMOTION_TERROR

            Animation                        = TerrorFromTheSky
                AnimationName                = EUDwarfMin_RUNA
                AnimationMode                = ONCE
            End
            Animation                        = TerrorFromTheSky
                AnimationName                = EUDwarfMin_RUNA
                AnimationMode                = ONCE
            End
            Flags                            = RESTART_ANIM_WHEN_COMPLETE
        End



        AnimationState                        = MOVING BACKING_UP

            Animation                        = BAKA
                AnimationName                = EUDwarfMin_RUNA
                AnimationMode                = LOOP
            End
            Flags = RANDOMSTART
        End

        AnimationState                        = MOVING ATTACKING
            ShareAnimation                    = Yes
            Animation                        = RUNA
                AnimationName                = EUDwarfMin_RUNA
                AnimationMode                = LOOP
                Distance                    = 25
            End
            Flags                            = RANDOMSTART

        End

        AnimationState                        = MOVING CHARGING
            ShareAnimation                    = Yes
            Animation                        = RUNB
                AnimationName                = EUDwarfMin_RUNA
                AnimationMode                = LOOP
                Distance                    = 30

            End
            Flags                            = RANDOMSTART

        End

        AnimationState                        = MOVING

            ShareAnimation                    = Yes
            Animation                        = RUNB
                AnimationName                = EUDwarfMin_RUNA
                AnimationMode                = LOOP
                Distance                    = 30
            End
            Flags                            = RANDOMSTART

        End


        AnimationState                        = EMOTION_UNCONTROLLABLY_AFRAID
            Animation                        = FERA
                AnimationName                = EUDwarfMin_CHRA
                AnimationMode                = LOOP
            End
        End

        AnimationState                        = FIRING_OR_PREATTACK_A
            Animation                        = ATK1
                AnimationName                = EUDwarfMin_ATKA
                AnimationMode                = ONCE
                UseWeaponTiming                = Yes
            End

        End

        AnimationState                        = ATTACKING
            Animation                        = ALERT_1
                AnimationName                = EUDwarfMin_IDLA
                AnimationMode                = LOOP
            End
        End








































































        AnimationState                        = EMOTION_ALERT
            Animation                        = ALERT_1
                AnimationName                = EUDwarfMin_IDLA
                AnimationMode                = LOOP
                AnimationPriority            = 10
            End
            Flags                            = RESTART_ANIM_WHEN_COMPLETE
        End


        AnimationState        = SELECTED
            StateName           = STATE_Selected
            Animation           = ATNB
                AnimationName     = EUDwarfMin_ATNB
                AnimationMode     = LOOP
            End

            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Idle"
                then
                    CurDrawableSetTransitionAnimState("TRANS_IdleToSelected")
                end
                if CurDrawableModelcondition("ATTACKING")
                then
                    return "IDLA"
                else
                    return "ATNA"
                end
            EndScript

            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Idle" then CurDrawableSetTransitionAnimState("TRANS_IdleToSelected") end
            EndScript
        End


        AnimationState                = WEAPONSET_PLAYER_UPGRADE
            StateName                = STATE_Idle
            Animation                = IDLB
                AnimationName       = EUDwarfMin_IDLB
                AnimationMode       = ONCE
                AnimationSpeedFactorRange = 0.9 1.1
            End
            Animation                = IDLC
                AnimationName       = EUDwarfMin_IDLC
                AnimationMode       = ONCE
                AnimationSpeedFactorRange = 0.9 1.1
            End
            Animation                = IDLD
                AnimationName       = EUDwarfMin_IDLD
                AnimationMode       = ONCE
                AnimationSpeedFactorRange = 0.9 1.1
            End










            Flags                    = RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Selected" then CurDrawableSetTransitionAnimState("TRANS_SelectedToIdle") end
            EndScript
        End
        AnimationState                = USER_3
            StateName                = STATE_User_3
            Animation                = GUARD_STANCE
                AnimationName        = GUManMocap_IDLA
                AnimationMode        = LOOP
            End
        End
        IdleAnimationState


            StateName                = STATE_Idle
            Animation                = IDLA
                AnimationName       = EUDwarfMin_IDLA
                AnimationMode       = ONCE
                AnimationPriority   = 20
                AnimationSpeedFactorRange = 0.9 1.1
                AnimationBlendTime    = 15
            End
            Animation                = IDLB
                AnimationName       = EUDwarfMin_IDLB
                AnimationMode       = ONCE
                AnimationPriority   = 10
                AnimationSpeedFactorRange = 0.9 1.1
                AnimationBlendTime    = 15
            End
            Animation                = IDLC
                AnimationName       = EUDwarfMin_IDLC
                AnimationMode       = ONCE
                AnimationPriority   = 5
                AnimationSpeedFactorRange = 0.9 1.1
                AnimationBlendTime    = 15
            End
            Animation                = IDLD
                AnimationName       = EUDwarfMin_IDLD
                AnimationMode       = ONCE
                AnimationPriority   = 7
                AnimationSpeedFactorRange = 0.9 1.1
                AnimationBlendTime    = 15
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Selected" then CurDrawableSetTransitionAnimState("TRANS_SelectedToIdle") end
            EndScript
        End

        TransitionState       = TRANS_IdleToSelected
            Animation           = ATNA
                AnimationName     = EUDwarfMin_ATNA
                AnimationMode     = ONCE
                AnimationSpeedFactorRange = 0.9 1.0

            End
        End
        TransitionState        = TRANS_SelectedToIdle
            Animation            = ATNC
                AnimationName    = EUDwarfMin_ATNC
                AnimationMode    = ONCE
                AnimationSpeedFactorRange = 0.9 1.0
            End
        End


        AnimationState        = ACTIVELY_CONSTRUCTING
            StateName           = STATE_Constructing
            Animation           = WRKA
                AnimationName     = EUDwarfMin_WRKB
                AnimationMode     = ONCE
                AnimationPriority    =    30
                AnimationSpeedFactorRange = 0.9 1.1
            End
            Animation           = WRKA
                AnimationName     = EUDwarfMin_WRKB
                AnimationMode     = ONCE
                AnimationPriority    =    30
                AnimationSpeedFactorRange = 0.9 1.1
            End
            Animation           = WRKB
                AnimationName     = EUDwarfMin_WRKC
                AnimationMode     = ONCE
                AnimationPriority    =    5
                AnimationSpeedFactorRange = 0.9 1.1
            End
            Animation           = WRKB
                AnimationName     = EUDwarfMin_WRKC
                AnimationMode     = ONCE
                AnimationPriority    =    5
                AnimationSpeedFactorRange = 0.9 1.1
            End
            Flags                    =    RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Idle" then CurDrawableSetTransitionAnimState("TRANS_RunToWork") end
            EndScript
        End




        TransitionState       = TRANS_RunToWork
            Animation           = ATNA
                AnimationName     = EUDwarfMin_WRKA
                AnimationMode     = ONCE
            End
        End

    End




    Side = Dwarves
    EditorSorting = UNIT
    ThreatLevel = 1.0
    Scale = 0.88
    IsTrainable         = No

    ThingClass = HORDE_UNIT
    CommandPoints = 0

    EmotionRange = 240
    TransportSlotCount  = TRANSPORTSLOTCOUNT_DOZER

    WeaponSet
        Conditions           = None
        Weapon               = PRIMARY    DwarvenMinerHammerAxe
        AutoChooseSources    = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End


    ArmorSet
        Conditions      = None
        Armor           = SoldierArmor
        DamageFX        = NormalDamageFX
    End
    ArmorSet
        Conditions      = PLAYER_UPGRADE
        Armor           = SoldierHeavyArmor
        DamageFX        = NormalDamageFX
    End

    VisionRange          = 300
    ShroudClearingRange  = 200
    BountyValue          = 75


    DisplayName = OBJECT:Dwarvenminer
    CrushableLevel = 0
    CrusherLevel = 0

    BuildCost           = 500
    BuildTime           = STRONG_BUILDTIME

    CommandSet = DwarvenMinerCommandSet_EredLuin




    VoiceCreated                            = DwarfBuilderVoiceSalute
    VoiceFullyCreated                       = DwarfBuilderVoiceSalute
    VoiceMove                               = DwarfBuilderVoiceMove
    VoiceMoveToCamp                         = DwarfBuilderVoiceMove
    VoicePriority                           = 6
    VoiceRetreatToCastle                    = DwarfBuilderVoiceMove
    VoiceSelect                             = DwarfBuilderVoiceSelectMS

    SoundImpact                              = ImpactHorse



    UnitSpecificSounds
        VoiceNoBuild                        = DwarfBuilderVoiceCantBuild
        VoiceBuildResponse                  = DwarfBuilderVoiceBuild
        VoiceExtinguishFireAtLocation       = DwarfBuilderVoiceMove
        VoiceGarrison                       = DwarfBuilderVoiceMove
        VoiceEnterUnitElvenTransportShip    = DwarfBuilderVoiceMove
        VoiceInitiateCaptureBuilding        = DwarfBuilderVoiceMove
        VoiceSelectIdleWorker               = DwarfBuilderVoiceSelectIdle

    End

    CrowdResponseKey = Dwarf

    Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
        Key = Dwarf
    End

    #include "..\..\..\Includes\StandardUnitEvaEvents.inc"


    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound:BodyFallGeneric1        Animation:EUDwarfMin_SKL.EUDwarfMin_DIEA   Frames:89
        AnimationSound = Sound:BodyFallGeneric1        Animation:EUDwarfMin_SKL.EUDwarfMin_LNDA   Frames:0
    End




    RadarPriority = UNIT
    KindOf              = PRELOAD SELECTABLE DOZER CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE THROWN_OBJECT PORTER IGNORES_SELECT_ALL

    Body = ActiveBody ModuleTag_02
        CheerRadius       = EMOTION_CHEER_RADIUS
        MaxHealth         = 500
        MaxHealthDamaged  = 250
    End

    Behavior = ArmorUpgrade ArmorUpgradeModuleTagGuardian
        TriggeredBy = Upgrade_DwarvenMithrilMail
        ArmorSetFlag            = PLAYER_UPGRADE

    End

    Behavior = SubObjectsUpgrade Armor_UpgradeGuardian
        TriggeredBy        = Upgrade_DwarvenMithrilMail
        UpgradeTexture    = EUDwarfmin.tga 0 EUDwarfmin_HA.tga
        RecolorHouse    = Yes
        ExcludeSubobjects = Forged_Blade
    End

    Behavior = DozerAIUpdate ModuleTag_03
        AILuaEventsList                 = InfantryFunctions
        RepairHealthPercentPerSecond    = 2%
        BoredTime                       = 5000
        BoredRange                      = 150
        AutoAcquireEnemiesWhenIdle      = No
        SpecialContactPoints            = Repair
    End




    Behavior = SubObjectsUpgrade Armor_Upgrade2
        TriggeredBy          = Upgrade_SubFactionEredLuin
        UpgradeTexture       = EUDwarfmin.tga 0 EUDwarfmin_ered.tga
        UpgradeTexture       = eudwarfeng.tga 0 eudwarfeng_ered.tga
        UpgradeTexture       = eudwarfram_eng.tga 0 eudwarfram_ered.tga

        ExcludeSubobjects    = Forged_Blade
    End



    Behavior = SubObjectsUpgrade ModuleTag_Making
        TriggeredBy       = Upgrade_AllFactionUpgrade
        HideSubObjects    = HAMMER1
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = Hero
    End




    LocomotorSet
        Locomotor = HumanSpecialChargeLocomotor
        Condition = SET_NORMAL
        Speed     = 40
    End

    LocomotorSet
        Locomotor = BurningDeathLocomotorInfantry
        Condition = SET_BURNINGDEATH
        Speed      = BURNINGDEATH_WANDERSPEED_INFANTRY
    End

    Behavior = PhysicsBehavior ModuleTag_04
        GravityMult                = 1.0
        ShockStunnedTimeLow        = 1400
        ShockStunnedTimeHigh    = 2400
        ShockStandingTime        = 666
    End

    Behavior = AttributeModifierUpgrade ModuleTag_AMU
        TriggeredBy = Upgrade_GondorFighterFearless
        AttributeModifier = FearlessForever
    End

    Behavior = SquishCollide ModuleTag_06

    End

    Behavior = HordeMemberCollide ModuleTag_HMC

    End

    Behavior = HitReactionBehavior HitReactionBehaviorModuleTag
        HitReactionLifeTimer1 = 2500
        HitReactionLifeTimer2 = 2500
        HitReactionLifeTimer3 = 2500

        HitReactionThreshold1 = 5.0
        HitReactionThreshold2 = 25.0
        HitReactionThreshold3 = 50.0

        FastHitsResetReaction = Yes    If set -- when hits occur faster than the reaction animations, it will reset the animation. (like getting riddled with machine gun bullets)
    End

    Behavior = SlowDeathBehavior ModuleTag_05
        DeathTypes            = ALL -KNOCKBACK -FADED
        SinkDelay            = 3000
        SinkRate            = 0.90
        DestructionDelay    = 15000
        Sound                = INITIAL DwarfGenericVoiceDie
    End

    Behavior = SlowDeathBehavior ModuleTag_07

        DeathTypes            = NONE +KNOCKBACK
        SinkDelay            = 3000
        SinkRate            = 0.60
        DestructionDelay    = 10000
    End

    Behavior = SlowDeathBehavior ModuleTag_FadeDeath
        DeathTypes            = NONE +FADED
        FadeDelay            = 0
        FadeTime            = 5000
        DestructionDelay    = 5000
        DeathFlags            = DEATH_2

        Sound = INITIAL SpellGenericUnsummonMS
    End

    Behavior = RepairSpecialPower ModuleTag_RepairSPecialPower
        SpecialPowerTemplate      = SpecialRepairStructure
    End

    Behavior = BezierProjectileBehavior ModuleTag_08

        FirstHeight = 24
        SecondHeight = 24
        FirstPercentIndent = 30%
        SecondPercentIndent = 70%
        TumbleRandomly = Yes

        CrushStyle = Yes
        DieOnImpact = Yes
        BounceCount = 1
        BounceDistance = 40
        BounceFirstHeight = 24
        BounceSecondHeight = 24
        BounceFirstPercentIndent = 20%
        BounceSecondPercentIndent = 80%

        GroundHitFX       = FX_ThrownRockGroundHit
        GroundBounceFX    = FX_ThrownRockBounceHit
    End


    Geometry            = CYLINDER

    GeometryMajorRadius = 8.0
    GeometryMinorRadius = 8.0
    GeometryHeight        = 19.2
    GeometryIsSmall        = No

    Shadow            = SHADOW_DECAL
    ShadowSizeX            = 19
    ShadowSizeY            = 19
    ShadowTexture        = ShadowI
End


Object DwarvenMinerMod_Eisenberge

    SelectPortrait         = UPEisenbergeMiner
    ButtonImage            = HSEisenbergeMiner

    Draw = W3DHordeModelDraw ModuleTag_01
        OkToChangeModelColor = Yes
        StaticModelLODMode = Yes

        WadingParticleSys = WaterRipplesTrail

        DefaultModelConditionState
            Model               = EUDwarfMin_SKN
            Skeleton            = EUDwarfMin_SKL
        End













        AnimationState                        = THROWN_PROJECTILE
            Animation                       = FlyA
                AnimationName                   = EUDwarfMin_FLYA
                AnimationMode               = LOOP
            End
            Flags                           = RANDOMSTART
        End

        AnimationState                        = FREEFALL
            Animation                        = Falling
                AnimationName                = EUDwarfMin_FLYA
                AnimationMode                = LOOP
                AnimationBlendTime            = 10
            End
        End



        AnimationState                        = STUNNED_FLAILING
            Animation                       = FlyA
                AnimationName               = EUDwarfMin_FLYA
                AnimationMode               = LOOP
            End
            Flags                           = RANDOMSTART
        End

        AnimationState                         = DYING SPLATTED
            Animation                         = Splatted_On_Ground
                AnimationName                 = EUDwarfMin_LNDA
                AnimationMode                 = ONCE
            End
            EnteringStateFX                    = FX_OrcHitGround
        End

        AnimationState                        = DYING
            Animation                        = DIEB
                AnimationName                = EUDwarfMin_DIEB
                AnimationMode                = ONCE
            End
            Animation                        = DIEC
                AnimationName                = EUDwarfMin_DIEB
                AnimationMode                = ONCE
            End
        End



        AnimationState                        = STUNNED_STANDING_UP
            Animation                        = GTPA
                AnimationName                = EUDwarfMin_GTPA
                AnimationMode                = ONCE
                AnimationSpeedFactorRange = 1.5 1.5
            End
        End



        AnimationState            =     STUNNED
            Animation            =     Slatted_On_Ground
            AnimationName                 = EUDwarfMin_LNDA
                AnimationMode                 = ONCE
            End
            EnteringStateFX                    = FX_OrcHitGround

       End


        AnimationState        = MOVING FIRING_OR_PREATTACK_A
            ShareAnimation        = Yes
            Animation           = RunAndFire
                AnimationName       = EUDwarfMin_ATRA
                AnimationMode       = LOOP
            End
            Flags               = RANDOMSTART
        End



        AnimationState                        = MOVING EMOTION_TERROR EMOTION_LOOK_TO_SKY

            Animation                    = TerrorFromTheSky
                AnimationName            = EUDwarfMin_RUNA
                AnimationMode            = LOOP
            End
            Animation                    = TerrorFromTheSky
                AnimationName            = EUDwarfMin_RUNA
                AnimationMode            = LOOP
            End
            Flags = RANDOMSTART
        End
        AnimationState                        = MOVING EMOTION_TERROR

            Animation                        = TerrorFromTheSky
                AnimationName                = EUDwarfMin_RUNA
                AnimationMode                = ONCE
            End
            Animation                        = TerrorFromTheSky
                AnimationName                = EUDwarfMin_RUNA
                AnimationMode                = ONCE
            End
            Flags                            = RESTART_ANIM_WHEN_COMPLETE
        End



        AnimationState                        = MOVING BACKING_UP

            Animation                        = BAKA
                AnimationName                = EUDwarfMin_RUNA
                AnimationMode                = LOOP
            End
            Flags = RANDOMSTART
        End

        AnimationState                        = MOVING ATTACKING
            ShareAnimation                    = Yes
            Animation                        = RUNA
                AnimationName                = EUDwarfMin_RUNA
                AnimationMode                = LOOP
                Distance                    = 25
            End
            Flags                            = RANDOMSTART

        End

        AnimationState                        = MOVING CHARGING
            ShareAnimation                    = Yes
            Animation                        = RUNB
                AnimationName                = EUDwarfMin_RUNA
                AnimationMode                = LOOP
                Distance                    = 30

            End
            Flags                            = RANDOMSTART

        End

        AnimationState                        = MOVING

            ShareAnimation                    = Yes
            Animation                        = RUNB
                AnimationName                = EUDwarfMin_RUNA
                AnimationMode                = LOOP
                Distance                    = 30
            End
            Flags                            = RANDOMSTART

        End


        AnimationState                        = EMOTION_UNCONTROLLABLY_AFRAID
            Animation                        = FERA
                AnimationName                = EUDwarfMin_CHRA
                AnimationMode                = LOOP
            End
        End

        AnimationState                        = FIRING_OR_PREATTACK_A
            Animation                        = ATK1
                AnimationName                = EUDwarfMin_ATKA
                AnimationMode                = ONCE
                UseWeaponTiming                = Yes
            End

        End

        AnimationState                        = ATTACKING
            Animation                        = ALERT_1
                AnimationName                = EUDwarfMin_IDLA
                AnimationMode                = LOOP
            End
        End








































































        AnimationState                        = EMOTION_ALERT
            Animation                        = ALERT_1
                AnimationName                = EUDwarfMin_IDLA
                AnimationMode                = LOOP
                AnimationPriority            = 10
            End
            Flags                            = RESTART_ANIM_WHEN_COMPLETE
        End


        AnimationState        = SELECTED
            StateName           = STATE_Selected
            Animation           = ATNB
                AnimationName     = EUDwarfMin_ATNB
                AnimationMode     = LOOP
            End

            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Idle"
                then
                    CurDrawableSetTransitionAnimState("TRANS_IdleToSelected")
                end
                if CurDrawableModelcondition("ATTACKING")
                then
                    return "IDLA"
                else
                    return "ATNA"
                end
            EndScript

            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Idle" then CurDrawableSetTransitionAnimState("TRANS_IdleToSelected") end
            EndScript
        End


        AnimationState                = WEAPONSET_PLAYER_UPGRADE
            StateName                = STATE_Idle
            Animation                = IDLB
                AnimationName       = EUDwarfMin_IDLB
                AnimationMode       = ONCE
                AnimationSpeedFactorRange = 0.9 1.1
            End
            Animation                = IDLC
                AnimationName       = EUDwarfMin_IDLC
                AnimationMode       = ONCE
                AnimationSpeedFactorRange = 0.9 1.1
            End
            Animation                = IDLD
                AnimationName       = EUDwarfMin_IDLD
                AnimationMode       = ONCE
                AnimationSpeedFactorRange = 0.9 1.1
            End










            Flags                    = RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Selected" then CurDrawableSetTransitionAnimState("TRANS_SelectedToIdle") end
            EndScript
        End
        AnimationState                = USER_3
            StateName                = STATE_User_3
            Animation                = GUARD_STANCE
                AnimationName        = GUManMocap_IDLA
                AnimationMode        = LOOP
            End
        End
        IdleAnimationState


            StateName                = STATE_Idle
            Animation                = IDLA
                AnimationName       = EUDwarfMin_IDLA
                AnimationMode       = ONCE
                AnimationPriority   = 20
                AnimationSpeedFactorRange = 0.9 1.1
                AnimationBlendTime    = 15
            End
            Animation                = IDLB
                AnimationName       = EUDwarfMin_IDLB
                AnimationMode       = ONCE
                AnimationPriority   = 10
                AnimationSpeedFactorRange = 0.9 1.1
                AnimationBlendTime    = 15
            End
            Animation                = IDLC
                AnimationName       = EUDwarfMin_IDLC
                AnimationMode       = ONCE
                AnimationPriority   = 5
                AnimationSpeedFactorRange = 0.9 1.1
                AnimationBlendTime    = 15
            End
            Animation                = IDLD
                AnimationName       = EUDwarfMin_IDLD
                AnimationMode       = ONCE
                AnimationPriority   = 7
                AnimationSpeedFactorRange = 0.9 1.1
                AnimationBlendTime    = 15
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Selected" then CurDrawableSetTransitionAnimState("TRANS_SelectedToIdle") end
            EndScript
        End

        TransitionState       = TRANS_IdleToSelected
            Animation           = ATNA
                AnimationName     = EUDwarfMin_ATNA
                AnimationMode     = ONCE
                AnimationSpeedFactorRange = 0.9 1.0

            End
        End
        TransitionState        = TRANS_SelectedToIdle
            Animation            = ATNC
                AnimationName    = EUDwarfMin_ATNC
                AnimationMode    = ONCE
                AnimationSpeedFactorRange = 0.9 1.0
            End
        End


        AnimationState        = ACTIVELY_CONSTRUCTING
            StateName           = STATE_Constructing
            Animation           = WRKA
                AnimationName     = EUDwarfMin_WRKB
                AnimationMode     = ONCE
                AnimationPriority    =    30
                AnimationSpeedFactorRange = 0.9 1.1
            End
            Animation           = WRKA
                AnimationName     = EUDwarfMin_WRKB
                AnimationMode     = ONCE
                AnimationPriority    =    30
                AnimationSpeedFactorRange = 0.9 1.1
            End
            Animation           = WRKB
                AnimationName     = EUDwarfMin_WRKC
                AnimationMode     = ONCE
                AnimationPriority    =    5
                AnimationSpeedFactorRange = 0.9 1.1
            End
            Animation           = WRKB
                AnimationName     = EUDwarfMin_WRKC
                AnimationMode     = ONCE
                AnimationPriority    =    5
                AnimationSpeedFactorRange = 0.9 1.1
            End
            Flags                    =    RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Idle" then CurDrawableSetTransitionAnimState("TRANS_RunToWork") end
            EndScript
        End




        TransitionState       = TRANS_RunToWork
            Animation           = ATNA
                AnimationName     = EUDwarfMin_WRKA
                AnimationMode     = ONCE
            End
        End

    End




    Side = Dwarves
    EditorSorting = UNIT
    ThreatLevel = 1.0
    Scale = 0.88
    IsTrainable         = No

    ThingClass = HORDE_UNIT
    CommandPoints = 0

    EmotionRange = 240
    TransportSlotCount  = TRANSPORTSLOTCOUNT_DOZER

    WeaponSet
        Conditions           = None
        Weapon               = PRIMARY    DwarvenMinerHammerAxe
        AutoChooseSources    = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End


    ArmorSet
        Conditions      = None
        Armor           = SoldierArmor
        DamageFX        = NormalDamageFX
    End
    ArmorSet
        Conditions      = PLAYER_UPGRADE
        Armor           = SoldierHeavyArmor
        DamageFX        = NormalDamageFX
    End

    VisionRange          = 300
    ShroudClearingRange  = 200
    BountyValue          = 75


    DisplayName = OBJECT:Dwarvenminer
    CrushableLevel = 0
    CrusherLevel = 0

    BuildCost           = 500
    BuildTime           = STRONG_BUILDTIME

    CommandSet = DwarvenMinerCommandSet_Eisenberge




    VoiceCreated                            = DwarfBuilderVoiceSalute
    VoiceFullyCreated                       = DwarfBuilderVoiceSalute
    VoiceMove                               = DwarfBuilderVoiceMove
    VoiceMoveToCamp                         = DwarfBuilderVoiceMove
    VoicePriority                           = 6
    VoiceRetreatToCastle                    = DwarfBuilderVoiceMove
    VoiceSelect                             = DwarfBuilderVoiceSelectMS

    SoundImpact                              = ImpactHorse



    UnitSpecificSounds
        VoiceNoBuild                        = DwarfBuilderVoiceCantBuild
        VoiceBuildResponse                  = DwarfBuilderVoiceBuild
        VoiceExtinguishFireAtLocation       = DwarfBuilderVoiceMove
        VoiceGarrison                       = DwarfBuilderVoiceMove
        VoiceEnterUnitElvenTransportShip    = DwarfBuilderVoiceMove
        VoiceInitiateCaptureBuilding        = DwarfBuilderVoiceMove
        VoiceSelectIdleWorker               = DwarfBuilderVoiceSelectIdle

    End

    CrowdResponseKey = Dwarf

    Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
        Key = Dwarf
    End

    #include "..\..\..\Includes\StandardUnitEvaEvents.inc"


    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound:BodyFallGeneric1        Animation:EUDwarfMin_SKL.EUDwarfMin_DIEA   Frames:89
        AnimationSound = Sound:BodyFallGeneric1        Animation:EUDwarfMin_SKL.EUDwarfMin_LNDA   Frames:0
    End




    RadarPriority = UNIT
    KindOf              = PRELOAD SELECTABLE DOZER CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE THROWN_OBJECT PORTER IGNORES_SELECT_ALL

    Body = ActiveBody ModuleTag_02
        CheerRadius       = EMOTION_CHEER_RADIUS
        MaxHealth         = 500
        MaxHealthDamaged  = 250
    End

    Behavior = ArmorUpgrade ArmorUpgradeModuleTagGuardian
        TriggeredBy = Upgrade_DwarvenMithrilMail
        ArmorSetFlag            = PLAYER_UPGRADE

    End

    Behavior = SubObjectsUpgrade Armor_UpgradeGuardian
        TriggeredBy        = Upgrade_DwarvenMithrilMail
        UpgradeTexture    = EUDwarfmin.tga 0 EUDwarfmin_HA.tga
        RecolorHouse    = Yes
        ExcludeSubobjects = Forged_Blade
    End

    Behavior = DozerAIUpdate ModuleTag_03
        AILuaEventsList                 = InfantryFunctions
        RepairHealthPercentPerSecond    = 2%
        BoredTime                       = 5000
        BoredRange                      = 150
        AutoAcquireEnemiesWhenIdle      = No
        SpecialContactPoints            = Repair
    End




    Behavior = SubObjectsUpgrade Armor_Upgrade2
        TriggeredBy          = Upgrade_SubFactionIronHills
        UpgradeTexture       = EUDwarfmin.tga 0 EUDwarfmin_eisen.tga
        UpgradeTexture       = eudwarfeng.tga 0 eudwarfeng_eisen.tga
        UpgradeTexture       = eudwarfram_eng.tga 0 eudwarfram_eisen.tga

        ExcludeSubobjects    = Forged_Blade
    End



    Behavior = SubObjectsUpgrade ModuleTag_Making
        TriggeredBy       = Upgrade_AllFactionUpgrade
        HideSubObjects    = HAMMER1
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = Hero
    End




    LocomotorSet
        Locomotor = HumanSpecialChargeLocomotor
        Condition = SET_NORMAL
        Speed     = 40
    End

    LocomotorSet
        Locomotor = BurningDeathLocomotorInfantry
        Condition = SET_BURNINGDEATH
        Speed      = BURNINGDEATH_WANDERSPEED_INFANTRY
    End

    Behavior = PhysicsBehavior ModuleTag_04
        GravityMult                = 1.0
        ShockStunnedTimeLow        = 1400
        ShockStunnedTimeHigh    = 2400
        ShockStandingTime        = 666
    End

    Behavior = AttributeModifierUpgrade ModuleTag_AMU
        TriggeredBy = Upgrade_GondorFighterFearless
        AttributeModifier = FearlessForever
    End

    Behavior = SquishCollide ModuleTag_06

    End

    Behavior = HordeMemberCollide ModuleTag_HMC

    End

    Behavior = HitReactionBehavior HitReactionBehaviorModuleTag
        HitReactionLifeTimer1 = 2500
        HitReactionLifeTimer2 = 2500
        HitReactionLifeTimer3 = 2500

        HitReactionThreshold1 = 5.0
        HitReactionThreshold2 = 25.0
        HitReactionThreshold3 = 50.0

        FastHitsResetReaction = Yes    If set -- when hits occur faster than the reaction animations, it will reset the animation. (like getting riddled with machine gun bullets)
    End

    Behavior = SlowDeathBehavior ModuleTag_05
        DeathTypes            = ALL -KNOCKBACK -FADED
        SinkDelay            = 3000
        SinkRate            = 0.90
        DestructionDelay    = 15000
        Sound                = INITIAL DwarfGenericVoiceDie
    End

    Behavior = SlowDeathBehavior ModuleTag_07

        DeathTypes            = NONE +KNOCKBACK
        SinkDelay            = 3000
        SinkRate            = 0.60
        DestructionDelay    = 10000
    End

    Behavior = SlowDeathBehavior ModuleTag_FadeDeath
        DeathTypes            = NONE +FADED
        FadeDelay            = 0
        FadeTime            = 5000
        DestructionDelay    = 5000
        DeathFlags            = DEATH_2

        Sound = INITIAL SpellGenericUnsummonMS
    End

    Behavior = RepairSpecialPower ModuleTag_RepairSPecialPower
        SpecialPowerTemplate      = SpecialRepairStructure
    End

    Behavior = BezierProjectileBehavior ModuleTag_08

        FirstHeight = 24
        SecondHeight = 24
        FirstPercentIndent = 30%
        SecondPercentIndent = 70%
        TumbleRandomly = Yes

        CrushStyle = Yes
        DieOnImpact = Yes
        BounceCount = 1
        BounceDistance = 40
        BounceFirstHeight = 24
        BounceSecondHeight = 24
        BounceFirstPercentIndent = 20%
        BounceSecondPercentIndent = 80%

        GroundHitFX       = FX_ThrownRockGroundHit
        GroundBounceFX    = FX_ThrownRockBounceHit
    End


    Geometry            = CYLINDER

    GeometryMajorRadius = 8.0
    GeometryMinorRadius = 8.0
    GeometryHeight        = 19.2
    GeometryIsSmall        = No

    Shadow            = SHADOW_DECAL
    ShadowSizeX            = 19
    ShadowSizeY            = 19
    ShadowTexture        = ShadowI
End



ChildObject DwarvenMinerMod_Festung DwarvenMinerMod

    Side                = Dwarves
    BuildCost           = 500
    BuildTime           = STRONG_BUILDTIME
    EditorSorting       = UNIT
    ThingClass          = HORDE_UNIT
    CommandPoints       = 0
    CommandSet          = DwarvenMinerFortressCommandSet
    TransportSlotCount  = TRANSPORTSLOTCOUNT_DOZER
    VisionRange          = 300
    ShroudClearingRange  = 200
    BountyValue          = 75
    IsTrainable         = No
    KindOf              = PRELOAD SELECTABLE DOZER CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE THROWN_OBJECT PORTER IGNORES_SELECT_ALL

    WeaponSet
        Conditions           = None
        Weapon               = PRIMARY    DwarvenMinerHammerAxe
        AutoChooseSources    = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End

    Body = ActiveBody ModuleTag_02
        CheerRadius       = EMOTION_CHEER_RADIUS
        MaxHealth         = 500
        MaxHealthDamaged  = 250
    End

    Behavior = DozerAIUpdate ModuleTag_03
        AILuaEventsList                 = InfantryFunctions
        RepairHealthPercentPerSecond    = 2%
        BoredTime                       = 5000
        BoredRange                      = 150
        AutoAcquireEnemiesWhenIdle      = No
        SpecialContactPoints            = Repair
    End

    Behavior = ArmorUpgrade ArmorUpgradeModuleTagGuardian
        TriggeredBy = Upgrade_DwarvenMithrilMail
        ArmorSetFlag            = PLAYER_UPGRADE

    End

    Behavior = SubObjectsUpgrade Armor_UpgradeGuardian
        TriggeredBy        = Upgrade_DwarvenMithrilMail
        UpgradeTexture    = EUDwarfmin.tga 0 EUDwarfmin_HA.tga
        RecolorHouse    = Yes
        ExcludeSubobjects = Forged_Blade
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = Hero
    End

    Behavior = MonitorConditionUpdate ModuleTag_CommandSetSwapper1
        WeaponSetFlags            = WEAPONSET_TOGGLE_1
        WeaponToggleCommandSet    = DwarvenMinerCommandSet2
    End

    Behavior = MonitorConditionUpdate ModuleTag_CommandSetSwapper2
        WeaponSetFlags            = WEAPONSET_TOGGLE_2
        WeaponToggleCommandSet    = DwarvenMinerCommandSet
    End

End

Object DwarvenMinerModHorde


    SelectPortrait         = UPNeutralMiner
    ButtonImage            = HSNeutralMiner

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER EMOTION_TERROR EMOTION_LOOK_TO_SKY SELECTED
        DefaultModelConditionState
            Model = None
        End

        ModelConditionState = HORDE_EMPTY
            Model = None
        End

        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkEUDFG
        End
    End

    Side = Dwarves
    EditorSorting = UNIT
    EmotionRange = 240
    DisplayName = OBJECT:HordeDwarvenMinerMod
    DisplayNameStrategic = CONTROLBAR:LW_Unit_DwarvenMinerHorde
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_DwarvenMinerHorde

    WeaponSet
        Conditions = None
        Weapon = PRIMARY    NormalMeleeHordeRangefinder
    End




    #include "..\..\..\includes\StandardHordeEvaEvents.inc"

    UnitSpecificSounds
        VoiceDesperateAttack  = GondorSoldierVoiceDesperateCharge
    End

    BuildCost = DWARVEN_GUARDIAN_BUILDCOST
    BuildTime = STRONG_BUILDTIME
    VisionRange = DWARVEN_GUARDIAN_HORDE_VISION_RANGE
    ShroudClearingRange = DWARVEN_GUARDIAN_SHROUD_RANGE
    VisionSide = 50%
    VisionRear = 25%

    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = 200
    VisionBonusPercentPerFoot = 1.0%
    CommandPoints = DWARVEN_MINER_MOD_HORDE_COMMAND_POINTS

    FormationWidth = 2
    FormationDepth = 1

    CrushableLevel = 0
    CrusherLevel = 1

    CrushOnlyWhileCharging = Yes

    MinCrushVelocityPercent = MINCRUSHVELOCITYPERCENT_STANDARD
    CrushDecelerationPercent = CRUSHDECELERATIONPERCENT_STANDARD

    CrushKnockback = 40
    CrushZFactor = 1.0

    TransportSlotCount = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE MELEE_HORDE NOTIFY_OF_PREATTACK ARMY_SUMMARY LARGE_RECTANGLE_PATHFIND

    ThreatLevel = DWARVEN_GUARDIAN_HORDE_THREAT
    ThreatBreakdown DwarvenGuardianHorde_DetailedThreat
        AIKindOf = INFANTRY
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = FighterHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle        = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate            = 500
        MaxCowerTime                = 5000
        MinCowerTime                = 3000

        CanAttackWhileContained            = Yes
        AILuaEventsList                = InfantryFunctions
        AttackPriority                = AttackPriority_Infantry
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained            =
        InitialPayload                = DwarvenMinerMod 10
        Slots                    = 10
        PassengerFilter          = NONE +DwarvenMinerMod
        ShowPips                 = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset = X:2 Y:3

        MeleeBehavior = Amoeba
        End


        BannerCarriersAllowed    = DwarvenBanner
        BannerCarrierPosition    = UnitType:DwarvenMinerMod    Pos:X:70.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:DwarvenMinerMod Position:X:50 Y:0        Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:50 Y:40        Position:X:50 Y:-40
        RankInfo = RankNumber:2 UnitType:DwarvenMinerMod Position:X:30 Y:0 Leader 1 0    Position:X:30 Y:20 Leader 1 1    Position:X:30 Y:-20 Leader 1 2    Position:X:30 Y:40 Leader 1 3    Position:X:30 Y:-40 Leader 1 4





        RanksToReleaseWhenAttacking        = 1 2

        MeleeAttackLeashDistance        = 25
        BackUpMinDelayTime            = 1
        BackUpMaxDelayTime            = 3000
        BackUpMinDistance            = 1
        BackUpMaxDistance            = 3
        BackupPercentage            = 80%
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

    Behavior = CommandButtonHuntUpdate ModuleTag_CommandButtonHuntUpdate
    End

    Behavior = HordeNotifyTargetsOfImminentProbableCrushingUpdate ModuleTag_NotifyCrushScan
        ScanWidth = 60.0
    End

       Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded        =    NONE
         AfraidOf            =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf            =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
         PointAt                =    EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance        =    150
        FearScanDistance        =    INFANTRY_FEAR_SCAN_RADIUS

        AddEmotion            =    Terror_Base
        AddEmotion            =    Doom_Base
        AddEmotion            =       BraceForBeingCrushed_Base
        AddEmotion            =    UncontrollableFear_Base
        AddEmotion            =    FearIdle_Base
        AddEmotion            =    FearBusy_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
         AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    HeroCheerIdle_Base
        AddEmotion            =    HeroCheerBusy_Base
        AddEmotion            =    Alert_Base
        AddEmotion            =       CheerForAboutToCrush_Base
    End

    LocomotorSet
        Locomotor     = NormalChargeMeleeHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_FOOT_SLOW_MEMBER_SPEED
    End

    LocomotorSet
        Locomotor     = ScaredMeleeHordeLocomotor
        Condition     = SET_SCARED
        Speed         = NORMAL_FOOT_SLOW_MEMBER_SPEED
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTraining
        LevelsToGain = 1
        LevelCap = 2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality1
        TriggeredBy = Upgrade_DwarvenSiegeHammer
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_ForgedBlades
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality3
        TriggeredBy = Upgrade_DwarvenMithrilMail
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End


    CommandSet = DwarvenMinerHordeCommandSet





    Behavior = AISpecialPowerUpdate DwarvenGuardianHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Behavior = AISpecialPowerUpdate DwarfGuardianCharge
        CommandButtonName = Command_DwarvenGuardianChargeAttack
        SpecialPowerAIType = AI_SPECIAL_POWER_CHARGE
    End


    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 50.0
    GeometryHeight = 20.0
    GeometryIsSmall = No



    AutoResolveUnitType = AutoResolveUnit_Soldier
    AutoResolveCombatChain = AutoResolve_SoldierCombatChain

    AutoResolveBody = AutoResolve_DwarvenGuardianHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_DwarvenMithrilMail
        Armor = AutoResolve_DwarvenGuardianHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_DwarvenMithrilMail
        Armor = AutoResolve_DwarvenGuardianArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_DwarvenGuardianUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_DwarvenGuardianWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTraining Upgrade_ForgedBlades Upgrade_DwarvenMithrilMail
End



Object DwarvenMinerRingkrieg



    SelectPortrait = UPDwarven_Porter


    ButtonImage = BDFortress_Porter

    Draw = W3DTruckDraw ModuleTag_01

        OkToChangeModelColor = Yes



        DefaultModelConditionState
            Model                    = DUPorter_SKN
            Skeleton                = DUPorter_SKL
        End


        IdleAnimationState
            StateName                = STATE_Running
            Animation                = IDLA
                AnimationName        = DUPorter_IDLA
                AnimationMode        = ONCE
                AnimationPriority   = 20
            End
        End

        AnimationState                = DYING DEATH_1
            Animation                = DIEB
                AnimationName        = DUPorter_DIEB
                AnimationMode        = ONCE
            End
        End

        AnimationState                = DYING DEATH_2
            Animation
                AnimationName        = DUPorter_IDLA
                AnimationMode        = LOOP
            End
        End

        AnimationState                = DYING
            Animation                = DIEA
                AnimationName        = DUPorter_DIEA
                AnimationMode        = ONCE
            End
        End

        AnimationState                        = PARALYZED
            Animation
                AnimationName                = DUPorter_IDLA

                AnimationMode                = LOOP
            End
        End


        AnimationState                = MOVING WANDER
            Animation                = WLKA
                AnimationName        = DUPorter_RUNA
                AnimationMode        = LOOP
            End
            Flags                    = RANDOMSTART

        End

        AnimationState                = MOVING
            StateName                = STATE_Running
            Animation                = RUNNING
                AnimationName        = DUPorter_RUNA
                AnimationMode        = LOOP
            End
            Flags                    = RANDOMSTART

        End

        AnimationState        = UNPACKING PACKING_TYPE_1
            Animation
                AnimationName        = DUPorter_FIRA
                AnimationMode        = ONCE
            End
            ParticleSysBone = BUCKET PorterFireWater FollowBone:Yes
            BeginScript
                CurDrawablePlaySound("MenBuilderFireExtinguish")
            EndScript
        End

        AnimationState        = ACTIVELY_CONSTRUCTING
            StateName           = STATE_Constructing
            Animation           = WRKA
                AnimationName     = DUPorter_WRKB
                AnimationMode     = ONCE
                AnimationPriority    =    30
                AnimationSpeedFactorRange = 0.9 1.1
            End
            Animation           = WRKA
                AnimationName     = DUPorter_WRKB
                AnimationMode     = ONCE
                AnimationPriority    =    30
                AnimationSpeedFactorRange = 0.9 1.1
            End
            Animation           = WRKB
                AnimationName     = DUPorter_WRKC
                AnimationMode     = ONCE
                AnimationPriority    =    5
                AnimationSpeedFactorRange = 0.9 1.1
            End
            Animation           = WRKB
                AnimationName     = DUPorter_WRKC
                AnimationMode     = ONCE
                AnimationPriority    =    5
                AnimationSpeedFactorRange = 0.9 1.1
            End
            Flags                    =    RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Running" then CurDrawableSetTransitionAnimState("TRANS_RunToWork") end
            EndScript
        End




        TransitionState       = TRANS_RunToWork
            Animation           = ATNA
                AnimationName     = DUPorter_WRKA
                AnimationMode     = ONCE
            End
        End



        LeftFrontTireBone            = WHEEL_L01
        RightFrontTireBone            = WHEEL_R01


        TireRotationMultiplier        = 0.2
    End

    #include "..\..\..\includes\StunDrawModuleMedium.inc"



    Side = Dwarves
    EditorSorting                    =    UNIT
    ThingClass                        = HORDE_UNIT
    CommandPoints = 0
    Scale             = 0.9

    TransportSlotCount = TRANSPORTSLOTCOUNT_DOZER

    ArmorSet
        Conditions                    = None
        Armor                        = PorterArmor
        DamageFX                    = NormalDamageFX
    End

    BuildCost = 500
    BuildTime = STRONG_BUILDTIME
    VisionRange          = 300
    ShroudClearingRange  = 200
    BountyValue          = 75

    DisplayName = OBJECT:DwarvenPorter
    CrushableLevel = 1
    ShockwaveResistance = SHOCKWAVE_RESISTANCE_IMMUNE
    IsTrainable = No

    CommandSet = DwarvenMinerCommandSet_Erebor_wotr




    VoiceCreated                            = DwarfBuilderVoiceSalute
    VoiceFullyCreated                       = DwarfBuilderVoiceSalute
    VoiceMove                               = DwarfBuilderVoiceMove
    VoiceMoveToCamp                         = DwarfBuilderVoiceMove
    VoicePriority                           = 6
    VoiceRetreatToCastle                    = DwarfBuilderVoiceMove
    VoiceSelect                             = DwarfBuilderVoiceSelectMS

    SoundImpact                              = ImpactHorse



    UnitSpecificSounds
        VoiceNoBuild                        = DwarfBuilderVoiceCantBuild
        VoiceBuildResponse                  = DwarfBuilderVoiceBuild
        VoiceExtinguishFireAtLocation       = DwarfBuilderVoiceMove
        VoiceGarrison                       = DwarfBuilderVoiceMove
        VoiceEnterUnitElvenTransportShip    = DwarfBuilderVoiceMove
        VoiceInitiateCaptureBuilding        = DwarfBuilderVoiceMove
        VoiceSelectIdleWorker               = DwarfBuilderVoiceSelectIdle

    End

    CrowdResponseKey = Dwarf

    Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
        Key = Dwarf
    End

    #include "..\..\..\Includes\StandardUnitEvaEvents.inc"


    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound:BodyFallGeneric1        Animation:EUDwarfMin_SKL.EUDwarfMin_DIEA   Frames:89
        AnimationSound = Sound:BodyFallGeneric1        Animation:EUDwarfMin_SKL.EUDwarfMin_LNDA   Frames:0
    End




    RadarPriority = UNIT
    KindOf = PRELOAD SELECTABLE DOZER CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE THROWN_OBJECT PORTER IGNORES_SELECT_ALL


    Body = ActiveBody ModuleTag_02
        MaxHealth         = DWARVEN_PORTER_HEALTH
        MaxHealthDamaged  = DWARVEN_PORTER_HEALTH_DAMAGED
        RecoveryTime      = DWARVEN_PORTER_HEALTH_RECOVERY_TIME
    End


    Behavior = DozerAIUpdate ModuleTag_03
        AILuaEventsList                 = InfantryFunctions
        RepairHealthPercentPerSecond    = 2%
        BoredTime                       = 5000
        BoredRange                      = 150
        AutoAcquireEnemiesWhenIdle      = No
        SpecialContactPoints            = Repair
    End


    Behavior = GrantUpgradeCreate ModuleTag_Enable2
        UpgradeToGrant      = Upgrade_SubFactionErebor
        GiveOnBuildComplete = Yes
    End
    LocomotorSet
        Locomotor = PorterLocomotor
        Condition = SET_NORMAL
        Speed     = NORMAL_INGAME_PORTER_SPEED
    End

    LocomotorSet
        Locomotor = PorterLocomotor
        Condition = SET_WANDER
        Speed     = NORMAL_INGAME_PORTER_SPEED
    End

    Behavior = PhysicsBehavior ModuleTag_04
        GravityMult                = 1.0
        ShockStunnedTimeLow        = 1400
        ShockStunnedTimeHigh    = 2400
        ShockStandingTime        = 666
    End


    Behavior = SquishCollide ModuleTag_06

    End

    Behavior = SlowDeathBehavior SlowDeathBehaviorModuleTag_1
        DeathTypes = ALL -CRUSHED -EXPLODED -KNOCKBACK -DETONATED -SPLATTED -FADED -SLAUGHTERED
        SinkDelay = 3000
        SinkRate = 1.40
        DestructionDelay = 13000
        Sound = INITIAL DwarfBuilderVoiceDie
        FX      = INITIAL FX_PorterDie
    End


    Behavior = SlowDeathBehavior SlowDeathBehaviorModuleTag_Decommissioned
        DeathTypes = NONE +SLAUGHTERED
        SinkDelay = 1000
        SinkRate = 1.40
        DestructionDelay = 5000
    End

    Behavior = SlowDeathBehavior SlowDeathBehaviorModuleTag_2
        DeathTypes = NONE +CRUSHED +EXPLODED +KNOCKBACK +DETONATED +SPLATTED
        SinkDelay = 3000
        SinkRate = 1.40
        DestructionDelay = 13000
        DeathFlags = DEATH_1
        FX = INITIAL FX_PorterDieExplosion
        Sound = INITIAL DwarfBuilderVoiceDie
    End

    Behavior = SlowDeathBehavior ModuleTag_ConstructionDeath
        DeathTypes            = NONE +FADED
        DeathFlags            = DEATH_2
        FadeDelay            = 500
        FadeTime            = 3500
        DestructionDelay    = 4000
    End

    Behavior = RepairSpecialPower ModuleTag_RepairSPecialPower
        SpecialPowerTemplate      = SpecialRepairStructure
    End

    Behavior = BezierProjectileBehavior ModuleTag_08

        FirstHeight = 24
        SecondHeight = 24
        FirstPercentIndent = 30%
        SecondPercentIndent = 70%
        TumbleRandomly = Yes

        CrushStyle = Yes
        DieOnImpact = Yes
        BounceCount = 1
        BounceDistance = 40
        BounceFirstHeight = 24
        BounceSecondHeight = 24
        BounceFirstPercentIndent = 20%
        BounceSecondPercentIndent = 80%

        GroundHitFX       = FX_ThrownRockGroundHit
        GroundBounceFX    = FX_ThrownRockBounceHit
    End


    Behavior = FireWeaponUpdate FireWeaponUpdateModuleTagWOTR
        FireWeaponNugget
            WeaponName = DwarvesFortressWotrWeapon
            FireDelay  = 0
            OneShot    = No
        End
    End




    Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        AfraidOf                    =    NONE +RohanTreeBerd +RohanEntFir +RohanEntAsh +RohanEntBirch +MordorBalrog +MordorMountainTroll +MordorDrummerTroll +MordorFellBeast +MordorMumakil
        AlwaysAfraidOf                =    NONE +MordorWitchKing +MordorWitchKingOnFellBeast +MordorBalrog +RohanOathbreaker

        FearScanDistance            =    250

        AddEmotion    =    Terror_Base
        AddEmotion    =   BraceForBeingCrushed_Base
    End

    #include "..\..\..\Includes\PorterExtinguishFire.inc"

    Geometry            = CYLINDER
    GeometryMajorRadius = 8.0
    GeometryMinorRadius = 8.0
    GeometryHeight        = 19.2
    GeometryIsSmall        = No

    Shadow            = SHADOW_DECAL
    ShadowSizeX            = 19
    ShadowSizeY            = 19
    ShadowTexture        = ShadowI
End


