Object DwarvenBattleWagon

    ButtonImage        = WOR_Battlewagon
    SelectPortrait     = UPDwarven_Battlewagon

    #include "..\..\..\includes\StunDrawModuleLarge.inc"

    Draw = W3DScriptedModelDraw DustEffects
        DefaultModelConditionState
          Model = None
        End
        IdleAnimationState
        End
        AnimationState =  MOVING WADING
            ParticleSysBone = None FootstepSlash
        End
        AnimationState = MOVING ACCELERATE
            ParticleSysBone = None GenericSiegeTrailDust
        End
        AnimationState =  MOVING ACCELERATE
            ParticleSysBone = None GenericSiegeTrailDust
        End
        AnimationState = MOUNTED MOVING
        End
    End

    Draw = W3DScriptedModelDraw DrawSpawnFX
        DefaultModelConditionState
            Model               = None
        End

        ModelConditionState    = USER_2
            Model    = None
            FXEvent    = Frame:0 Name:FX_HordeResurrection
        End
    End

    Draw = W3DTruckDraw ModuleTag_01

        ExtraPublicBone            = PASS01
        ExtraPublicBone            = PASS02

        OkToChangeModelColor      = Yes
        StaticModelLODMode        = Yes

        DefaultModelConditionState
            Model               = DUBtlWagon_SKN
            Skeleton            = DUBtlWagon_SKL
            WeaponLaunchBone    = PRIMARY BONE01
        End

        ModelConditionState     = DYING
            Model               = DUBtlWagon_DIEA
            Skeleton            = DUBtlWagon_DIEA
        End

        TrackMarks                  = EXTireTrack2_Temp.tga
        TrackMarksLeftBone          = Wheel_L
        TrackMarksRightBone         = Wheel_R
        LeftRearTireBone            = Wheel_L
        RightRearTireBone           = Wheel_R
        TireRotationMultiplier      = 0.07
        PowerslideRotationAddition  = 1.5


        IdleAnimationState
            Animation            = IDLA
                AnimationName        = DUBtlWagon_IDLA
                AnimationPriority    = 5
            End
            Animation = IDLB
                AnimationName = DUBtlWagon_IDLB
            End
            StateName = Idle
        End

        AnimationState         = DYING
            Animation            = DIEA
                AnimationName      = DUBtlWagon_DIEA
                AnimationMode      = ONCE
                AnimationBlendTime = 0
            End
        End

        AnimationState        = STUNNED_STANDING_UP
            Animation           = GTPA
                AnimationName     = DUBtlWagon_IDLA
                AnimationMode     = ONCE
            End
        End

        AnimationState        = STUNNED
            Animation           = LNDA
                AnimationName     = DUBtlWagon_IDLA
                AnimationMode     = ONCE
            End
        End

        AnimationState                        = PARALYZED
            Animation
                AnimationName                = DUBtlWagon_IDLA
                AnimationMode                = LOOP
            End
        End


        ModelConditionState = JUST_BUILT
            Model    =  DUBtlWagon_SKN
        End

        AnimationState  = JUST_BUILT
            Animation            = Being_Built
                AnimationName        = DUBtlWagon_BLDA
                AnimationMode        = ONCE
                AnimationBlendTime = 0
            End
        End

        AnimationState            = MOVING TURN_LEFT
            Animation            = Turn
                AnimationName        = DUBtlWagon_TNLA
                AnimationMode       = LOOP
                AnimationBlendTime  = 10
            End
        End

        AnimationState    = MOVING TURN_RIGHT
            Animation        = Turn
                AnimationName        = DUBtlWagon_TNRA
                AnimationMode       = LOOP
                AnimationBlendTime  = 10
            End
        End

        AnimationState            = TURN_LEFT
            Animation            = Turn
                AnimationName        = DUBtlWagon_TNLB
                AnimationMode       = LOOP
                AnimationBlendTime  = 10
            End
        End

        AnimationState    = TURN_RIGHT
            Animation        = Turn
                AnimationName        = DUBtlWagon_TNRB
                AnimationMode       = LOOP
                AnimationBlendTime  = 10
            End
        End

        AnimationState    = MOVING BACKING_UP
            Animation        = BackingUp
                AnimationName        =    DUBtlWagon_BAKA
                AnimationMode        =    LOOP
            End
            Flags                    =    RANDOMSTART
        End

        AnimationState    = MOVING
            ShareAnimation    = Yes
            Animation            = RUNB
                AnimationName            = DUBtlWagon_RUNA
                AnimationMode            = LOOP
                Distance                = 30
                AnimationBlendTime        = 10
            End
            Flags            = RANDOMSTART
        End

        AnimationState                        = ATTACKING_STRUCTURE FIRING_OR_PREATTACK_A
            Animation                        = ATKB
                AnimationName                = DUBtlWagon_ATKA
                AnimationMode                = ONCE
                UseWeaponTiming                = Yes
            End
        End

        AnimationState                        = FIRING_OR_PREATTACK_A
            Animation                        = ATKB
                AnimationName                = DUBtlWagon_ATKA
                AnimationMode                = ONCE
                UseWeaponTiming                = Yes
            End
        End

        AnimationState                        = EMOTION_CELEBRATING
            Animation
                AnimationName                = DUBtlWagon_CHRA
                AnimationMode                = LOOP
            End
            Flags                            = RANDOMSTART
        End
    End


    Side                        = Dwarves
    EditorSorting                = UNIT

    ThreatLevel                    = DWARVEN_BATTLEWAGON_THREAT_LEVEL
    ThreatBreakdown DwarvenBattleWagon_DetailedThreat
        AIKindOf = CAVALRY
    End

    ShowHealthInSelectionDecal    = Yes
    TransportSlotCount            = TRANSPORTSLOTCOUNT_MACHINE
    ShockwaveResistance            = SHOCKWAVE_RESISTANCE_IMMUNE

    ArmorSet
        Conditions      = None
        Armor           = BattleWagonArmor
    End

    ArmorSet
        Conditions      = PLAYER_UPGRADE
        Armor           = BattleWagonArmorHeavy
    End

    WeaponSet
        Conditions            = None
        Weapon                = PRIMARY    YurgHorn
    End

    VisionRange            = 300
      ShroudClearingRange  = 450

    VisionSide = 35%
    VisionRear = 25%
    VisionBonusPercentPerFoot = 2.0%
    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = 200



    BountyValue            = DWARVEN_BATTLEWAGON_BOUNTY_VALUE
    DisplayName            = OBJECT:DwarvenBattleWagon
    DisplayNameStrategic        = CONTROLBAR:LW_Unit_DwarvenBattleWagon
    DescriptionStrategic         = CONTROLBAR:LW_ToolTip_DwarvenBattleWagon

    CrusherLevel                = 2
    CrushWeapon            = BattleWagonCrush
    MinCrushVelocityPercent = MINCRUSHVELOCITYPERCENT_BATTLEWAGON  
    CrushDecelerationPercent = CRUSHDECELERATIONPERCENT_BATTLEWAGON
    CommandSet            = DwarvenBattleWagonCommandSetMod
    CommandPoints            = 20




    VoiceAttack                                = DwarfBattleWagonVoiceAttack
    VoiceAttackCharge                        = DwarfBattleWagonVoiceAttackCharge
    VoiceAttackMachine                        = DwarfBattleWagonVoiceAttack
    VoiceAttackStructure                    = DwarfBattleWagonVoiceAttackBuilding
    VoiceCreated                            = DwarfBattleWagonVoiceSalute
    VoiceFullyCreated                         = DwarfBattleWagonVoiceSalute
    VoiceGuard                                = DwarfBattleWagonVoiceMove
    VoiceMove                                = DwarfBattleWagonVoiceMove
    VoiceMoveToCamp                            = DwarfBattleWagonVoiceMoveCamp
    VoiceMoveWhileAttacking                    = DwarfBattleWagonVoiceDisengage
    VoicePriority                            = 58
    VoiceRetreatToCastle                    = DwarfBattleWagonVoiceRetreat
    VoiceSelect                                = DwarfBattleWagonVoiceSelectMS
    VoiceSelectBattle                         = DwarfBattleWagonVoiceSelectBattle

    UnitSpecificSounds
        VoiceGarrison                        = DwarfBattleWagonVoiceMove
        VoiceEnterUnitElvenTransportShip    = DwarfBattleWagonVoiceMoveShip
        VoiceInitiateCaptureBuilding        = DwarfBattleWagonVoiceMove
    End

    SoundAmbient                            = DwarfRhinocerousVoxAmbientLoop
    SoundImpact                             = ImpactHorse
    SoundMoveLoop                            = DwarfBattleWagonMoveLoop

    CrowdResponseKey = Dwarf

    Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
        Key = Humanoid_Male Dwarf Dwarf_Male Dwarf_BattleWagon Dwarf_Siege
        UnitWeight = 2
    End

    ClientBehavior = ModelConditionAudioLoopClientBehavior ModuleTag_foo
        ModelCondition = Required:EMOTION_CELEBRATING    Excluded:DYING ENGAGED    Sound:EmotionDwarfCompilationVoxCheerSinglesLoop
        ModelCondition = Required:EMOTION_POINTING        Excluded:DYING ENGAGED    Sound:EmotionDwarfCompilationVoxTauntSinglesLoop
        ModelCondition = Required:EMOTION_TAUNTING        Excluded:DYING ENGAGED    Sound:EmotionDwarfCompilationVoxTauntSinglesLoop
        ModelCondition = Required:RAISING_FLAG            Excluded:DYING ENGAGED    Sound:EmotionDwarfCompilationVoxTauntSinglesLoop
    End

    #include "..\..\..\includes\StandardHordeEvaEvents.inc"
    #include "..\..\..\includes\DwarvenRunesUnits.inc"


    RadarPriority = UNIT
    KindOf = PRELOAD SELECTABLE CAN_CAST_REFLECTIONS SCORE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT PATH_THROUGH_INFANTRY TRANSPORT CAN_ATTACK_WALLS ARMY_SUMMARY NOTIFY_OF_PREATTACK MACHINE
    CamouflageDetectionMultiplier = 0.8

    BuildCost = DWARVEN_BATTLEWAGON_BUILDCOST
    BuildTime = STRONG_BUILDTIME

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = Hero
        End

    BuildFadeInOnCreateTime = 6.7

    Body = DelayedDeathBody ModuleTag_02
        CheerRadius                 = EMOTION_CHEER_RADIUS
        MaxHealth                   = DWARVEN_BATTLEWAGON_HEALTH
        MaxHealthDamaged            = 1300
        DoHealthCheck               = No
        DelayedDeathTime            = 5000
        CanRespawn                  = No
        ImmortalUntilDeathTime      = No
    End



    Behavior = AttributeModifierAuraUpdate ModuleTag_BannerCarrierBuff
        StartsActive            = No
        BonusName                = BattleWagonLeadership
        TriggeredBy                = Upgrade_BattleWagonBannerCarrier
        RefreshDelay            = 2000
        Range                    = 200

        ObjectFilter            = GENERIC_BUFF_RECIPIENT_OBJECT_FILTER -DwarvenBattleWagonAxeThrower -DwarvenBattleWagonMenOfDale -DwarvenBattleWagonPhalanx
    End


    Behavior = AutoHealBehavior ModuleTag_BannerCarrierHeal
        StartsActive            = No
        TriggeredBy                = Upgrade_Level_2
        HealingAmount = 30
        HealingDelay = 1000
        StartHealingDelay = 2000
        HealOnlyIfNotInCombat = Yes
    End



    Behavior = ModelConditionUpgrade ModuleTag_BannerObject
        TriggeredBy                = Upgrade_BattleWagonBannerCarrier
        AddConditionFlags        = USER_1
    End

    Behavior = SubObjectsUpgrade Show_Topper
        TriggeredBy        = Upgrade_AllFactionUpgrade
        RequiresAllTriggers = Yes
        HideSubObjects    = Glow
    End


    Behavior = PassiveAreaEffectBehavior ModuleTag_HearthHeal
        EffectRadius            = 100
        UpgradeRequired         = Upgrade_BattleWagonHearth
        PingDelay               = 3000
        HealPercentPerSecond    = 2%
        AllowFilter             = ANY +INFANTRY +CAVALRY -MACHINE -IMMOBILE +DOZER -STRUCTURE -DwarvenBattleWagon ALLIES
        NonStackable            = Yes
        HealFX                  = FX_SpellHealUnitHealBuff
    End

    Behavior = StealthDetectorUpdate ModuleTag_HearthStealthDetect
        DetectionRange            = 200
        DetectionRate            = 2000
        CancelOneRingEffect     = Yes
        RequiredUpgrade            = Upgrade_BattleWagonHearth
    End

    Behavior = SpecialPowerModule ModuleTag_OilBarrelsStarter
        SpecialPowerTemplate        = SpecialAbilityDwarvenBattleWagonOilBarrels
        UpdateModuleStartsAttack    = Yes
        InitiateSound                = DwarfBattleWagonVoiceAttackOilBarrels
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_OilBarrelUpdate
        SpecialPowerTemplate        = SpecialAbilityDwarvenBattleWagonOilBarrels
        WhichSpecialWeapon            = 1
        PackTime                    = 500
        StartAbilityRange            = BATTLEWAGON_OILBARREL_RANGE
        SpecialWeapon                = BattleWagonOilBarrel
        IgnoreFacingCheck            = Yes
    End

    Behavior = AIUpdateInterface ModuleTag_03
        AILuaEventsList                = DwarvenBattleWagonFunctions
        AutoAcquireEnemiesWhenIdle    = No
        AttackPriority                = AttackPriority_Cavalry
    End

       Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        AddEmotion            =    Terror_Base
        AddEmotion            =    Doom_Base
        AddEmotion            =   BraceForBeingCrushed_Base
        AddEmotion            =    UncontrollableFear_Base
        AddEmotion            =    FearIdle_Base
        AddEmotion            =    FearBusy_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
        AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    HeroCheerIdle_Base
        AddEmotion            =    HeroCheerBusy_Base
        AddEmotion            =    Alert_Base
        AddEmotion            =    CheerForAboutToCrush_Base
    End

    Behavior = NotifyTargetsOfImminentProbableCrushingUpdate ModuleTag_NotifyCrushScan
    End

    Behavior LifetimeUpdate LifetimeTag
        WaitForWakeUp    =    Yes
    End

    Behavior = TransportContain  ModuleTag_12
        ObjectStatusOfContained                = UNSELECTABLE CAN_ATTACK
        Slots                                = 2
        DamagePercentToUnits                = 100%
        PassengerFilter                        = ANY +DwarvenBattleWagonAxeThrower +DwarvenBattleWagonBow +DwarvenBattleWagonCrossbow +DwarvenBattleWagonPhalanx
        AllowOwnPlayerInsideOverride        = Yes
        AllowAlliesInside                    = Yes
        AllowEnemiesInside                    = No
        AllowNeutralInside                    = No
        ExitDelay                            = 0
        ForceOrientationContainer            = Yes
        PassengerBonePrefix                    = PassengerBone:PASS KindOf:INFANTRY


        BoneSpecificConditionState 1 PASSENGER_VARIATION_1

        BoneSpecificConditionState 2 PASSENGER_VARIATION_2

        ShowPips                            = No
        EjectPassengersOnDeath                = No
        KillPassengersOnDeath                = Yes

        FadeFilter                            = ALL

        UpgradeCreationTrigger                = Upgrade_BattleWagonAxeThrowers DwarvenBattleWagonAxeThrower 2
        UpgradeCreationTrigger                = Upgrade_BattleWagonBow DwarvenBattleWagonBow 2
        UpgradeCreationTrigger                = Upgrade_BattleWagonCrossbow DwarvenBattleWagonCrossbow 2

        UpgradeCreationTrigger                = Upgrade_BattleWagonBannerCarrier DwarvenBattleWagonPhalanx 2
    End

    Behavior = ModelConditionUpgrade ModuleTag_SpawnFX
        TriggeredBy                = Upgrade_BattleWagonAxeThrowers Upgrade_BattleWagonCrossbow Upgrade_BattleWagonBow Upgrade_BattleWagonBannerCarrier
        AddTempConditionFlag    = ModelConditionState:USER_2
        TempConditionTime        = 0.01
    End

    LocomotorSet
        Locomotor = BattleWagonLocomotor
        Condition = SET_NORMAL
        Speed     = 95
    End

    Behavior = PhysicsBehavior ModuleTag_04
    End

    Behavior = SlowDeathBehavior ModuleTag_05
        DeathTypes            = ALL
        SinkDelay            = 5000
        SinkRate            = 2.4
        DestructionDelay    = 15000
        DecayBeginTime        = 6000
        ProbabilityModifier    = 10
        DeathFlags            = DEATH_1
        ShadowWhenDead        = Yes
        Sound                = INITIAL DwarfBattleWagonDieMS
    End

    Behavior = SquishCollide ModuleTag_06
    End

    Behavior = HitReactionBehavior HitReactionBehaviorModuleTag
        HitReactionLifeTimer1 = 1000
        HitReactionThreshold1 = 200.0
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes

    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSetUpgradeLangbarte
        TriggeredBy          = Upgrade_SubFactionErebor
        CommandSet           = DwarvenBattleWagonCommandSetErebor
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSetUpgradeFeuerbarte
        TriggeredBy          = Upgrade_SubFactionIronHills
        CommandSet           = DwarvenBattleWagonCommandSetEisenberge
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSetUpgradeBreitschultern
        TriggeredBy          = Upgrade_SubFactionEredLuin
        CommandSet           = DwarvenBattleWagonCommandSetEredLuin
    End


    Behavior = SubObjectsUpgrade Armor_UpgradeLangbarte
        TriggeredBy       = Upgrade_SubFactionErebor
        UpgradeTexture    = duaxdban1.tga 0 duereborban.tga
    End

    Behavior = SubObjectsUpgrade Armor_UpgradeFeuerbarte
        TriggeredBy       = Upgrade_SubFactionIronHills
        UpgradeTexture    = duaxdban1.tga 0 dueisenban.tga
    End

    Behavior = SubObjectsUpgrade Armor_UpgradeBreitschultern
        TriggeredBy       = Upgrade_SubFactionEredLuin
        UpgradeTexture    = duaxdban1.tga 0 dueredluinban.tga
    End

    Behavior = SubObjectsUpgrade Armor_Upgrade1
        TriggeredBy          = Upgrade_SubFactionIronHills
        UpgradeTexture       = EUDwarfmin.tga 0 EUDwarfmin_eisen.tga
        UpgradeTexture       = eudwarfeng.tga 0 eudwarfeng_eisen.tga
        UpgradeTexture       = eudwarfram_eng.tga 0 eudwarfram_eisen.tga
        UpgradeTexture       = duaxdban1.tga 0 dueisenban.tga

        ExcludeSubobjects    = Forged_Blade
    End

    Behavior = SubObjectsUpgrade Armor_Upgrade2
        TriggeredBy          = Upgrade_SubFactionErebor
        UpgradeTexture       = EUDwarfmin.tga 0 EUDwarfmin_ereb.tga
        UpgradeTexture       = eudwarfeng.tga 0 eudwarfeng_ereb.tga
        UpgradeTexture       = eudwarfram_eng.tga 0 eudwarfram_ereb.tga
        UpgradeTexture       = duaxdban1.tga 0 duereborban.tga

        ExcludeSubobjects    = Forged_Blade
    End

    Behavior = SubObjectsUpgrade Armor_Upgrade3
        TriggeredBy          = Upgrade_SubFactionEredLuin
        UpgradeTexture       = EUDwarfmin.tga 0 EUDwarfmin_ered.tga
        UpgradeTexture       = eudwarfeng.tga 0 eudwarfeng_ered.tga
        UpgradeTexture       = eudwarfram_eng.tga 0 eudwarfram_ered.tga
        UpgradeTexture       = duaxdban1.tga 0 dueredluinban.tga

        ExcludeSubobjects    = Forged_Blade
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSetUpgrade1
        TriggeredBy          = Upgrade_BattleWagonAxeThrowers
        CommandSet           = DwarvenBattleWagonCommandSet_Upgraded
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSetUpgrade2
        TriggeredBy          = Upgrade_BattleWagonCrossbow
        CommandSet           = DwarvenBattleWagonCommandSet_Upgraded
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSetUpgrade3
        TriggeredBy          = Upgrade_BattleWagonBow
        CommandSet           = DwarvenBattleWagonCommandSet_Upgraded
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSetUpgrade4
        TriggeredBy          = Upgrade_BattleWagonHearth
        CommandSet           = DwarvenBattleWagonCommandSet_Upgraded
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSetUpgrade5
        TriggeredBy          = Upgrade_BattleWagonBannerCarrier
        CommandSet           = DwarvenBattleWagonCommandSet_Upgraded
    End


    Behavior = ArmorUpgrade ArmorUpgradeModuleTag
        TriggeredBy = Upgrade_DwarvenMithrilMail
    End

    Behavior = SubObjectsUpgrade Armor_Upgrade
        TriggeredBy        = Upgrade_DwarvenMithrilMail
        UpgradeTexture    = dwarf_a.tga 0 rudwarf_b.tga
        RecolorHouse    = Yes
        ExcludeSubobjects = Forged_Blade
    End

    Behavior = SubObjectsUpgrade Armor_Hearth
        TriggeredBy       = Upgrade_BattleWagonHearth
        ShowSubObjects    = dwarfHearth dwarfHearthFire
    End

    Behavior = SubObjectsUpgrade Banner_Upgrade
        TriggeredBy       = Upgrade_BattleWagonBannerCarrier
        ShowSubObjects    = Banner_L
    End


    Behavior = CommandSetUpgrade ModuleTag_CommandSetAI
        TriggeredBy    = Upgrade_ObjectUnderAIControl
        CommandSet     = DwarvenBattleWagonCommandSet_AI
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSetLangbarteAI
        TriggeredBy    = Upgrade_SubFactionErebor Upgrade_ObjectUnderAIControl
        RequiresAllTriggers = Yes
        CommandSet     = DwarvenBattleWagonCommandSetEreborAI
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSetFeuerbarteAI
        TriggeredBy    = Upgrade_SubFactionIronHills Upgrade_ObjectUnderAIControl
        RequiresAllTriggers = Yes
        CommandSet     = DwarvenBattleWagonCommandSetEisenbergeAI
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSetBreitschulternAI
        TriggeredBy    = Upgrade_SubFactionEredLuin Upgrade_ObjectUnderAIControl
        RequiresAllTriggers = Yes
        CommandSet     = DwarvenBattleWagonCommandSetEredLuinAI
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSetUpgrade1AI
        TriggeredBy          = Upgrade_BattleWagonAxeThrowers Upgrade_ObjectUnderAIControl
        RequiresAllTriggers  = Yes
        CommandSet           = DwarvenBattleWagonCommandSet_Upgraded
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSetUpgrade2AI
        TriggeredBy          = Upgrade_BattleWagonCrossbow Upgrade_ObjectUnderAIControl
        RequiresAllTriggers  = Yes
        CommandSet           = DwarvenBattleWagonCommandSet_Upgraded
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSetUpgrade3AI
        TriggeredBy          = Upgrade_BattleWagonBow Upgrade_ObjectUnderAIControl
        RequiresAllTriggers  = Yes
        CommandSet           = DwarvenBattleWagonCommandSet_Upgraded
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSetUpgrade4AI
        TriggeredBy          = Upgrade_BattleWagonHearth Upgrade_ObjectUnderAIControl
        RequiresAllTriggers  = Yes
        CommandSet           = DwarvenBattleWagonCommandSet_Upgraded
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSetUpgrade5AI
        TriggeredBy          = Upgrade_BattleWagonBannerCarrier Upgrade_ObjectUnderAIControl
        RequiresAllTriggers  = Yes
        CommandSet           = DwarvenBattleWagonCommandSet_Upgraded
    End


    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_ForgedBlades
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality3
        TriggeredBy = Upgrade_DwarvenMithrilMail
    End





    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End


    Behavior = AISpecialPowerUpdate DwarfBattlewagonOilBarrels
        CommandButtonName = Command_SpecialAbilityOilBarrels
        SpecialPowerAIType = AI_SPECIAL_POWER_RANGED_AOE_ATTACK
    End

    FormationPreviewDecal
            Texture = FPBattleWagonDecal
            Width = 96
            Height = 96
        End

    Geometry = Box
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 17.0
    GeometryHeight = 44.8
    GeometryOffset = X:5.0 Y:0.0 Z:0.0

    GeometryIsSmall = No
    DeadCollideSize = LARGE

    Shadow = SHADOW_VOLUME_NON_SELF_2
    ShadowSizeX = 36



    AutoResolveUnitType = AutoResolveUnit_Cavalry
    AutoResolveCombatChain = AutoResolve_CavalryCombatChain

    AutoResolveBody = AutoResolve_DwarvenBattleWagonBody

    AutoResolveArmor
        Armor = AutoResolve_DwarvenBattleWagonArmor
    End

    AutoResolveWeapon
        Weapon = AutoResolve_DwarvenBattleWagonWeapon
    End
End


Object DwarvenBattleWagon_Eisenberge

    ButtonImage       = WOR_Battlewagon
    SelectPortrait    = UPDwarven_Battlewagon

    #include "..\..\..\includes\StunDrawModuleLarge.inc"

    Draw = W3DScriptedModelDraw DustEffects
        DefaultModelConditionState
          Model = None
        End
        IdleAnimationState
        End
        AnimationState =  MOVING WADING
            ParticleSysBone = None FootstepSlash
        End
        AnimationState = MOVING ACCELERATE
            ParticleSysBone = None GenericSiegeTrailDust
        End
        AnimationState =  MOVING ACCELERATE
            ParticleSysBone = None GenericSiegeTrailDust
        End
        AnimationState = MOUNTED MOVING
        End
    End

    Draw = W3DScriptedModelDraw DrawSpawnFX
        DefaultModelConditionState
            Model               = None
        End

        ModelConditionState    = USER_2
            Model    = None
            FXEvent    = Frame:0 Name:FX_HordeResurrection
        End
    End

    Draw = W3DTruckDraw ModuleTag_01

        ExtraPublicBone            = PASS01
        ExtraPublicBone            = PASS02

        OkToChangeModelColor    = Yes

        StaticModelLODMode        = Yes

        DefaultModelConditionState
            Model               = DUBtlWagon_SKN
            Skeleton            = DUBtlWagon_SKL
            WeaponLaunchBone    = PRIMARY BONE01
        End

        ModelConditionState     = DYING
            Model               = DUBtlWagon_DIEA
            Skeleton            = DUBtlWagon_DIEA
        End

        TrackMarks                    = EXTireTrack2_Temp.tga
        TrackMarksLeftBone            = Wheel_L
        TrackMarksRightBone            = Wheel_R
        LeftRearTireBone            = Wheel_L
        RightRearTireBone           = Wheel_R
        TireRotationMultiplier      = 0.07
        PowerslideRotationAddition  = 1.5


        IdleAnimationState
            Animation            = IDLA
                AnimationName        = DUBtlWagon_IDLA
                AnimationPriority    = 5
            End
            Animation = IDLB
                AnimationName = DUBtlWagon_IDLB
            End
            StateName = Idle
        End

        AnimationState         = DYING
            Animation            = DIEA
                AnimationName      = DUBtlWagon_DIEA
                AnimationMode      = ONCE
                AnimationBlendTime = 0
            End
        End

        AnimationState        = STUNNED_STANDING_UP
            Animation           = GTPA
                AnimationName     = DUBtlWagon_IDLA
                AnimationMode     = ONCE
            End
        End

        AnimationState        = STUNNED
            Animation           = LNDA
                AnimationName     = DUBtlWagon_IDLA
                AnimationMode     = ONCE
            End
        End

        AnimationState                        = PARALYZED
            Animation
                AnimationName                = DUBtlWagon_IDLA
                AnimationMode                = LOOP
            End
        End


        ModelConditionState = JUST_BUILT
            Model    =  DUBtlWagon_SKN
        End

        AnimationState  = JUST_BUILT
            Animation            = Being_Built
                AnimationName        = DUBtlWagon_BLDA
                AnimationMode        = ONCE
                AnimationBlendTime = 0
            End
        End

        AnimationState            = MOVING TURN_LEFT
            Animation            = Turn
                AnimationName        = DUBtlWagon_TNLA
                AnimationMode       = LOOP
                AnimationBlendTime  = 10
            End

        End

        AnimationState    = MOVING TURN_RIGHT
            Animation        = Turn
                AnimationName        = DUBtlWagon_TNRA
                AnimationMode       = LOOP
                AnimationBlendTime  = 10
            End
        End

        AnimationState            = TURN_LEFT
            Animation            = Turn
                AnimationName        = DUBtlWagon_TNLB
                AnimationMode       = LOOP
                AnimationBlendTime  = 10
            End
        End

        AnimationState    = TURN_RIGHT
            Animation        = Turn
                AnimationName        = DUBtlWagon_TNRB
                AnimationMode       = LOOP
                AnimationBlendTime  = 10
            End
        End

        AnimationState    = MOVING BACKING_UP
            Animation        = BackingUp
                AnimationName        =    DUBtlWagon_BAKA
                AnimationMode        =    LOOP
            End
            Flags                    =    RANDOMSTART
        End

        AnimationState    = MOVING
            ShareAnimation    = Yes
            Animation            = RUNB
                AnimationName            = DUBtlWagon_RUNA
                AnimationMode            = LOOP
                Distance                = 30
                AnimationBlendTime        = 10
            End
            Flags            = RANDOMSTART
        End

        AnimationState                        = ATTACKING_STRUCTURE FIRING_OR_PREATTACK_A
            Animation                        = ATKB
                AnimationName                = DUBtlWagon_ATKA
                AnimationMode                = ONCE
                UseWeaponTiming                = Yes
            End
        End

        AnimationState                        = FIRING_OR_PREATTACK_A
            Animation                        = ATKB
                AnimationName                = DUBtlWagon_ATKA
                AnimationMode                = ONCE
                UseWeaponTiming                = Yes
            End
        End

        AnimationState                        = EMOTION_CELEBRATING
            Animation
                AnimationName                = DUBtlWagon_CHRA
                AnimationMode                = LOOP
            End
            Flags                            = RANDOMSTART
        End
    End









    Side                        = Dwarves
    EditorSorting                = UNIT

    ThreatLevel                    = DWARVEN_BATTLEWAGON_THREAT_LEVEL
    ThreatBreakdown DwarvenBattleWagon_DetailedThreat
        AIKindOf = CAVALRY
    End

    ShowHealthInSelectionDecal    = Yes
    TransportSlotCount            = TRANSPORTSLOTCOUNT_MACHINE
    ShockwaveResistance            = SHOCKWAVE_RESISTANCE_IMMUNE

    ArmorSet
        Conditions      = None
        Armor           = BattleWagonArmor

    End

    ArmorSet
        Conditions      = PLAYER_UPGRADE
        Armor           = BattleWagonArmorHeavy

    End

    WeaponSet
        Conditions            = None
        Weapon                = PRIMARY    YurgHorn
    End

    VisionRange            = 300
      ShroudClearingRange         = 450

    VisionSide = 35%
    VisionRear = 25%
    VisionBonusPercentPerFoot = 2.0%
    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = 200



    BountyValue            = DWARVEN_BATTLEWAGON_BOUNTY_VALUE
    DisplayName            = OBJECT:DwarvenBattleWagon
    DisplayNameStrategic        = CONTROLBAR:LW_Unit_DwarvenBattleWagon
    DescriptionStrategic         = CONTROLBAR:LW_ToolTip_DwarvenBattleWagon

    CrusherLevel                = 2
    CrushWeapon            = BattleWagonCrush
    MinCrushVelocityPercent = MINCRUSHVELOCITYPERCENT_BATTLEWAGON
    CrushDecelerationPercent = CRUSHDECELERATIONPERCENT_BATTLEWAGON
    CommandSet            = DwarvenBattleWagonEisenbergeCommandSet
    CommandPoints            = 20




    VoiceAttack                                = DwarfBattleWagonVoiceAttack
    VoiceAttackCharge                        = DwarfBattleWagonVoiceAttackCharge
    VoiceAttackMachine                        = DwarfBattleWagonVoiceAttack
    VoiceAttackStructure                    = DwarfBattleWagonVoiceAttackBuilding
    VoiceCreated                            = DwarfBattleWagonVoiceSalute
    VoiceFullyCreated                         = DwarfBattleWagonVoiceSalute
    VoiceGuard                                = DwarfBattleWagonVoiceMove
    VoiceMove                                = DwarfBattleWagonVoiceMove
    VoiceMoveToCamp                            = DwarfBattleWagonVoiceMoveCamp
    VoiceMoveWhileAttacking                    = DwarfBattleWagonVoiceDisengage
    VoicePriority                            = 58
    VoiceRetreatToCastle                    = DwarfBattleWagonVoiceRetreat
    VoiceSelect                                = DwarfBattleWagonVoiceSelectMS
    VoiceSelectBattle                         = DwarfBattleWagonVoiceSelectBattle










    UnitSpecificSounds
        VoiceGarrison                        = DwarfBattleWagonVoiceMove
        VoiceEnterUnitElvenTransportShip    = DwarfBattleWagonVoiceMoveShip
        VoiceInitiateCaptureBuilding        = DwarfBattleWagonVoiceMove

    End

    SoundAmbient                            = DwarfRhinocerousVoxAmbientLoop
    SoundImpact                             = ImpactHorse
    SoundMoveLoop                            = DwarfBattleWagonMoveLoop

    CrowdResponseKey = Dwarf

    Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
        Key = Humanoid_Male Dwarf Dwarf_Male Dwarf_BattleWagon Dwarf_Siege
        UnitWeight = 2
    End

    ClientBehavior = ModelConditionAudioLoopClientBehavior ModuleTag_foo
        ModelCondition = Required:EMOTION_CELEBRATING    Excluded:DYING ENGAGED    Sound:EmotionDwarfCompilationVoxCheerSinglesLoop
        ModelCondition = Required:EMOTION_POINTING        Excluded:DYING ENGAGED    Sound:EmotionDwarfCompilationVoxTauntSinglesLoop
        ModelCondition = Required:EMOTION_TAUNTING        Excluded:DYING ENGAGED    Sound:EmotionDwarfCompilationVoxTauntSinglesLoop
        ModelCondition = Required:RAISING_FLAG            Excluded:DYING ENGAGED    Sound:EmotionDwarfCompilationVoxTauntSinglesLoop
    End

    #include "..\..\..\includes\StandardHordeEvaEvents.inc"
    #include "..\..\..\includes\DwarvenRunesUnits.inc"


    RadarPriority = UNIT
    KindOf = PRELOAD SELECTABLE CAN_CAST_REFLECTIONS CAVALRY SCORE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT PATH_THROUGH_INFANTRY TRANSPORT CAN_ATTACK_WALLS ARMY_SUMMARY NOTIFY_OF_PREATTACK MACHINE GARRISONABLE_UNTIL_DESTROYED
    CamouflageDetectionMultiplier = 0.8

    BuildCost = DWARVEN_BATTLEWAGON_BUILDCOST
    BuildTime = STRONG_BUILDTIME

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = Hero
        End


    BuildFadeInOnCreateTime = 6.7

    Body = DelayedDeathBody ModuleTag_02
        CheerRadius                 = EMOTION_CHEER_RADIUS
        MaxHealth                    = 2700
        MaxHealthDamaged            = 1300
        DoHealthCheck                = No
        DelayedDeathTime            = 5000
        CanRespawn                    = No
        ImmortalUntilDeathTime        = No
    End



    Behavior = AttributeModifierAuraUpdate ModuleTag_BannerCarrierBuff
        StartsActive            = No
        BonusName                = BattleWagonLeadership
        TriggeredBy                = Upgrade_BattleWagonBannerCarrier
        RefreshDelay            = 2000
        Range                    = 200

        ObjectFilter            = GENERIC_BUFF_RECIPIENT_OBJECT_FILTER -DwarvenBattleWagonAxeThrower -DwarvenBattleWagonMenOfDale -DwarvenBattleWagonPhalanx
    End
    Behavior = AutoHealBehavior ModuleTag_BannerCarrierHeal
        StartsActive            = No
        TriggeredBy                = Upgrade_BattleWagonBannerCarrier
        HealingAmount            = 30
        HealingDelay            = 2000
        HealOnlyIfNotInCombat    = Yes
        UnitHealPulseFX            = FX_SpellHealUnitHealBuff
        NonStackable            = Yes
    End
    Behavior = ModelConditionUpgrade ModuleTag_BannerObject
        TriggeredBy                = Upgrade_BattleWagonBannerCarrier
        AddConditionFlags        = USER_1
    End

    Behavior = SubObjectsUpgrade Show_Topper
        TriggeredBy        = Upgrade_AllFactionUpgrade
        RequiresAllTriggers = Yes
        HideSubObjects    = Glow
    End


    Behavior = AutoHealBehavior ModuleTag_HearthHeal
        StartsActive            = No
        TriggeredBy                = Upgrade_BattleWagonHearth
        HealingAmount            = 30
        Radius                    = 100
        HealingDelay            = 2000
        UnitHealPulseFX            = FX_SpellHealUnitHealBuff
        NonStackable            = Yes
        RespawnNearbyHordeMembers = Yes
        RespawnFXList            = FX_BannerCarrierSpawnUnit
        RespawnMinimumDelay        = 100
    End

    Behavior = StealthDetectorUpdate ModuleTag_HearthStealthDetect
        DetectionRange            = 200
        DetectionRate            = 2000
        CancelOneRingEffect     = Yes
        RequiredUpgrade            = Upgrade_BattleWagonHearth
    End

    Behavior = SpecialPowerModule ModuleTag_OilBarrelsStarter
        SpecialPowerTemplate        = SpecialAbilityDwarvenBattleWagonOilBarrels
        UpdateModuleStartsAttack    = Yes
        InitiateSound                = DwarfBattleWagonVoiceAttackOilBarrels
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_OilBarrelUpdate
        SpecialPowerTemplate        = SpecialAbilityDwarvenBattleWagonOilBarrels
        WhichSpecialWeapon            = 1
        PackTime                    = 500
        StartAbilityRange            = BATTLEWAGON_OILBARREL_RANGE
        SpecialWeapon                = BattleWagonOilBarrel
        IgnoreFacingCheck            = Yes
    End

    Behavior = AIUpdateInterface ModuleTag_03
        AILuaEventsList                = DwarvenBattleWagonFunctions
        AutoAcquireEnemiesWhenIdle    = No
        AttackPriority                = AttackPriority_Cavalry
    End

       Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        AddEmotion            =    Terror_Base
        AddEmotion            =    Doom_Base
        AddEmotion            =   BraceForBeingCrushed_Base
        AddEmotion            =    UncontrollableFear_Base
        AddEmotion            =    FearIdle_Base
        AddEmotion            =    FearBusy_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
         AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    HeroCheerIdle_Base
        AddEmotion            =    HeroCheerBusy_Base
        AddEmotion            =    Alert_Base
        AddEmotion            =    CheerForAboutToCrush_Base
    End

    Behavior = NotifyTargetsOfImminentProbableCrushingUpdate ModuleTag_NotifyCrushScan
    End

    Behavior LifetimeUpdate LifetimeTag
        WaitForWakeUp    =    Yes
    End



    Behavior = HordeTransportContain  ModuleTag_12
        ObjectStatusOfContained              = UNSELECTABLE
        Slots                                = 1
        EnterSound                           = GarrisonEnter
        ExitSound                            = GarrisonExit
        DamagePercentToUnits                 = 0%
        PassengerFilter                      = ANY +HERO
        AllowOwnPlayerInsideOverride         = Yes
        AllowAlliesInside                    = No
        AllowEnemiesInside                   = No
        AllowNeutralInside                   = No
        ExitDelay                            = 0
        NumberOfExitPaths                    = 2
        ForceOrientationContainer            = No
        PassengerBonePrefix                  = PassengerBone:PASS     KindOf:HERO
        ShowPips                             = No
        EjectPassengersOnDeath               = Yes

        FadeFilter    = ALL
        FadePassengerOnEnter = Yes
        EnterFadeTime = 1000
        FadePassengerOnExit = Yes
        ExitFadeTime = 1000
    End


    Behavior = ModelConditionUpgrade ModuleTag_SpawnFX
        TriggeredBy                = Upgrade_BattleWagonAxeThrowers Upgrade_BattleWagonCrossbow Upgrade_BattleWagonBow Upgrade_BattleWagonBannerCarrier
        AddTempConditionFlag    = ModelConditionState:USER_2
        TempConditionTime        = 0.01
    End

    LocomotorSet
        Locomotor = BattleWagonLocomotor
        Condition = SET_NORMAL
        Speed     = 95
    End

    Behavior = PhysicsBehavior ModuleTag_04
    End

    Behavior = SlowDeathBehavior ModuleTag_05
        DeathTypes            = ALL
        SinkDelay            = 5000
        SinkRate            = 2.4
        DestructionDelay    = 15000
        DecayBeginTime        = 6000
        ProbabilityModifier    = 10
        DeathFlags            = DEATH_1
        ShadowWhenDead        = Yes
        Sound                = INITIAL DwarfBattleWagonDieMS
    End

    Behavior = SquishCollide ModuleTag_06
    End

    Behavior = HitReactionBehavior HitReactionBehaviorModuleTag
        HitReactionLifeTimer1 = 1000
        HitReactionThreshold1 = 200.0
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes

    End


    Behavior = SubObjectsUpgrade Armor_Upgrade1
        TriggeredBy          = Upgrade_DwarfFaction
        UpgradeTexture       = EUDwarfmin.tga 0 EUDwarfmin_eisen.tga
        UpgradeTexture       = eudwarfeng.tga 0 eudwarfeng_eisen.tga
        UpgradeTexture       = eudwarfram_eng.tga 0 eudwarfram_eisen.tga
        UpgradeTexture       = duaxdban1.tga 0 dueisenban.tga

        ExcludeSubobjects    = Forged_Blade
    End


    Behavior = ArmorUpgrade ArmorUpgradeModuleTag
        TriggeredBy = Upgrade_DwarvenMithrilMail


    End

    Behavior = SubObjectsUpgrade Armor_Upgrade
        TriggeredBy        = Upgrade_DwarvenMithrilMail
        UpgradeTexture    = dwarf_a.tga 0 rudwarf_b.tga
        RecolorHouse    = Yes
        ExcludeSubobjects = Forged_Blade
    End

    Behavior = SubObjectsUpgrade Armor_Hearth
        TriggeredBy       = Upgrade_BattleWagonHearth
        ShowSubObjects    = dwarfHearth dwarfHearthFire
    End

    Behavior = SubObjectsUpgrade Banner_Upgrade
        TriggeredBy       = Upgrade_BattleWagonBannerCarrier
        ShowSubObjects    = Banner_L
    End


    Behavior = CommandSetUpgrade ModuleTag_CommandSetUpgrade1
        TriggeredBy          = Upgrade_BattleWagonAxeThrowers
        CommandSet           = DwarvenBattleWagonCommandSet_Upgraded
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSetUpgrade2
        TriggeredBy          = Upgrade_BattleWagonCrossbow
        CommandSet           = DwarvenBattleWagonCommandSet_Upgraded
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSetUpgrade3
        TriggeredBy          = Upgrade_BattleWagonBow
        CommandSet           = DwarvenBattleWagonCommandSet_Upgraded
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSetUpgrade4
        TriggeredBy          = Upgrade_BattleWagonHearth
        CommandSet           = DwarvenBattleWagonCommandSet_Upgraded
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSetUpgrade5
        TriggeredBy          = Upgrade_BattleWagonBannerCarrier
        CommandSet           = DwarvenBattleWagonCommandSet_Upgraded
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_ForgedBlades
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality3
        TriggeredBy = Upgrade_DwarvenMithrilMail
    End





    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End


    Behavior = AISpecialPowerUpdate DwarfBattlewagonOilBarrels
        CommandButtonName = Command_SpecialAbilityOilBarrels
        SpecialPowerAIType = AI_SPECIAL_POWER_RANGED_AOE_ATTACK
    End

    FormationPreviewDecal
            Texture = FPBattleWagonDecal
            Width = 96
            Height = 96
        End

    Geometry = Box
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 17.0
    GeometryHeight = 44.8
    GeometryOffset = X:5.0 Y:0.0 Z:0.0

    GeometryIsSmall = No
    DeadCollideSize = LARGE

    Shadow = SHADOW_VOLUME_NON_SELF_2
    ShadowSizeX = 36



    AutoResolveUnitType = AutoResolveUnit_Cavalry
    AutoResolveCombatChain = AutoResolve_CavalryCombatChain

    AutoResolveBody = AutoResolve_DwarvenBattleWagonBody

    AutoResolveArmor
        Armor = AutoResolve_DwarvenBattleWagonArmor
    End

    AutoResolveWeapon
        Weapon = AutoResolve_DwarvenBattleWagonWeapon
    End
End

Object DwarvenBattleWagonIronHills

    ButtonImage        = HSBattlewagonIcon
    SelectPortrait     = UPDwarven_BattlewagonIronHills

    #include "..\..\..\includes\StunDrawModuleLarge.inc"

    Draw = W3DScriptedModelDraw DustEffects
        DefaultModelConditionState
          Model = None
        End
        IdleAnimationState
        End
        AnimationState =  MOVING WADING
            ParticleSysBone = None FootstepSlash
        End
        AnimationState = MOVING ACCELERATE
            ParticleSysBone = None GenericSiegeTrailDust
        End
        AnimationState =  MOVING ACCELERATE
            ParticleSysBone = None GenericSiegeTrailDust
        End
        AnimationState = MOUNTED MOVING
        End
    End

    Draw = W3DScriptedModelDraw DrawSpawnFX
        DefaultModelConditionState
            Model               = None
        End

        ModelConditionState    = USER_2
            Model    = None
            FXEvent    = Frame:0 Name:FX_HordeResurrection
        End
    End

    Draw = W3DTruckDraw ModuleTag_01

        ExtraPublicBone            = PASS01
        ExtraPublicBone            = PASS02

        OkToChangeModelColor    = Yes

        StaticModelLODMode        = Yes

        DefaultModelConditionState
            Model               = DUBtlwgn_SKN
            Skeleton            = DUBtlWagon_SKL
            WeaponLaunchBone    = PRIMARY BONE01
        End

        ModelConditionState     = DYING
            Model               = DUBtlwgn_DIEA
            Skeleton            = DUBtlwgn_DIEA
        End

        TrackMarks                    = EXTireTrack2_Temp.tga
        TrackMarksLeftBone            = Wheel_L
        TrackMarksRightBone            = Wheel_R
        LeftRearTireBone            = Wheel_L
        RightRearTireBone           = Wheel_R
        TireRotationMultiplier      = 0.07
        PowerslideRotationAddition  = 1.5


        IdleAnimationState
            Animation            = IDLA
                AnimationName        = DUBtlWagon_IDLA
                AnimationPriority    = 5
            End
            Animation = IDLB
                AnimationName = DUBtlWagon_IDLB
            End
            StateName = Idle
        End

        AnimationState         = DYING
            Animation            = DIEA
                AnimationName      = DUBtlwgn_DIEA
                AnimationMode      = ONCE
                AnimationBlendTime = 0
            End
        End

        AnimationState        = STUNNED_STANDING_UP
            Animation           = GTPA
                AnimationName     = DUBtlWagon_IDLA
                AnimationMode     = ONCE
            End
        End

        AnimationState        = STUNNED
            Animation           = LNDA
                AnimationName     = DUBtlWagon_IDLA
                AnimationMode     = ONCE
            End
        End

        AnimationState                        = PARALYZED
            Animation
                AnimationName                = DUBtlWagon_IDLA
                AnimationMode                = LOOP
            End
        End


        ModelConditionState = JUST_BUILT
            Model    =  DUBtlwgn_SKN
        End

        AnimationState  = JUST_BUILT
            Animation            = Being_Built
                AnimationName        = DUBtlWagon_BLDA
                AnimationMode        = ONCE
                AnimationBlendTime = 0
            End
        End

        AnimationState            = MOVING TURN_LEFT
            Animation            = Turn
                AnimationName        = DUBtlWagon_TNLA
                AnimationMode       = LOOP
                AnimationBlendTime  = 10
            End
        End

        AnimationState    = MOVING TURN_RIGHT
            Animation        = Turn
                AnimationName        = DUBtlWagon_TNRA
                AnimationMode       = LOOP
                AnimationBlendTime  = 10
            End
        End

        AnimationState            = TURN_LEFT
            Animation            = Turn
                AnimationName        = DUBtlWagon_TNLB
                AnimationMode       = LOOP
                AnimationBlendTime  = 10
            End
        End

        AnimationState    = TURN_RIGHT
            Animation        = Turn
                AnimationName        = DUBtlWagon_TNRB
                AnimationMode       = LOOP
                AnimationBlendTime  = 10
            End
        End

        AnimationState    = MOVING BACKING_UP
            Animation        = BackingUp
                AnimationName        =    DUBtlWagon_BAKA
                AnimationMode        =    LOOP
            End
            Flags                    =    RANDOMSTART
        End

        AnimationState    = MOVING
            ShareAnimation    = Yes
            Animation            = RUNB
                AnimationName            = DUBtlWagon_RUNA
                AnimationMode            = LOOP
                Distance                = 30
                AnimationBlendTime        = 10
            End
            Flags            = RANDOMSTART
        End

        AnimationState                        = ATTACKING_STRUCTURE FIRING_OR_PREATTACK_A
            Animation                        = ATKB
                AnimationName                = DUBtlWagon_ATKA
                AnimationMode                = ONCE
                UseWeaponTiming                = Yes
            End
        End

        AnimationState                        = FIRING_OR_PREATTACK_A
            Animation                        = ATKB
                AnimationName                = DUBtlWagon_ATKA
                AnimationMode                = ONCE
                UseWeaponTiming                = Yes
            End
        End

        AnimationState                        = EMOTION_CELEBRATING
            Animation
                AnimationName                = DUBtlWagon_CHRA
                AnimationMode                = LOOP
            End
            Flags                            = RANDOMSTART
        End
    End


    Draw = W3DScriptedModelDraw Icon
        ModelConditionState = NONE
            Model           = bhorsebox
        End
    End









    Side                        = Dwarves
    EditorSorting                = UNIT

    ThreatLevel                    = DWARVEN_BATTLEWAGON_THREAT_LEVEL
    ThreatBreakdown DwarvenBattleWagon_DetailedThreat
        AIKindOf = CAVALRY
    End

    ShowHealthInSelectionDecal    = Yes
    TransportSlotCount            = TRANSPORTSLOTCOUNT_MACHINE
    ShockwaveResistance            = SHOCKWAVE_RESISTANCE_IMMUNE

    ArmorSet
        Conditions      = None
        Armor           = BattleWagonArmor

    End

    ArmorSet
        Conditions      = PLAYER_UPGRADE
        Armor           = BattleWagonArmorHeavy

    End

    WeaponSet
        Conditions            = None
        Weapon                = PRIMARY    YurgHorn
    End

    VisionRange               = 300
    ShroudClearingRange       = 450

    VisionSide = 35%
    VisionRear = 25%
    VisionBonusPercentPerFoot = 2.0%
    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = 200


    BountyValue            = DWARVEN_BATTLEWAGON_BOUNTY_VALUE
    DisplayName            = OBJECT:DwarvenBattleWagon
    DisplayNameStrategic        = CONTROLBAR:LW_Unit_DwarvenBattleWagon
    DescriptionStrategic         = CONTROLBAR:LW_ToolTip_DwarvenBattleWagon

    CrusherLevel                = 2
    CrushWeapon            = BattleWagonCrush
    MinCrushVelocityPercent = MINCRUSHVELOCITYPERCENT_BATTLEWAGON
    CrushDecelerationPercent = CRUSHDECELERATIONPERCENT_BATTLEWAGON

    RamPower = 35
    RamZMult = 0.5

    CommandSet            = DwarvenBattleWagonCommandSetMod
    CommandPoints            = 20




    VoiceAttack                                = DwarfBattleWagonVoiceAttack
    VoiceAttackCharge                        = DwarfBattleWagonVoiceAttackCharge
    VoiceAttackMachine                        = DwarfBattleWagonVoiceAttack
    VoiceAttackStructure                    = DwarfBattleWagonVoiceAttackBuilding
    VoiceCreated                            = DwarfBattleWagonVoiceSalute
    VoiceFullyCreated                         = DwarfBattleWagonVoiceSalute
    VoiceGuard                                = DwarfBattleWagonVoiceMove
    VoiceMove                                = DwarfBattleWagonVoiceMove
    VoiceMoveToCamp                            = DwarfBattleWagonVoiceMoveCamp
    VoiceMoveWhileAttacking                    = DwarfBattleWagonVoiceDisengage
    VoicePriority                            = 58
    VoiceRetreatToCastle                    = DwarfBattleWagonVoiceRetreat
    VoiceSelect                                = DwarfBattleWagonVoiceSelectMS
    VoiceSelectBattle                         = DwarfBattleWagonVoiceSelectBattle










    UnitSpecificSounds
        VoiceGarrison                        = DwarfBattleWagonVoiceMove
        VoiceEnterUnitElvenTransportShip    = DwarfBattleWagonVoiceMoveShip
        VoiceInitiateCaptureBuilding        = DwarfBattleWagonVoiceMove

    End

    SoundAmbient                            = DwarfRhinocerousVoxAmbientLoop
    SoundImpact                             = ImpactHorse
    SoundMoveLoop                            = DwarfBattleWagonMoveLoop

    CrowdResponseKey = Dwarf

    Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
        Key = Humanoid_Male Dwarf Dwarf_Male Dwarf_BattleWagon Dwarf_Siege
        UnitWeight = 2
    End

    ClientBehavior = ModelConditionAudioLoopClientBehavior ModuleTag_foo
        ModelCondition = Required:EMOTION_CELEBRATING    Excluded:DYING ENGAGED    Sound:EmotionDwarfCompilationVoxCheerSinglesLoop
        ModelCondition = Required:EMOTION_POINTING        Excluded:DYING ENGAGED    Sound:EmotionDwarfCompilationVoxTauntSinglesLoop
        ModelCondition = Required:EMOTION_TAUNTING        Excluded:DYING ENGAGED    Sound:EmotionDwarfCompilationVoxTauntSinglesLoop
        ModelCondition = Required:RAISING_FLAG            Excluded:DYING ENGAGED    Sound:EmotionDwarfCompilationVoxTauntSinglesLoop
    End

    #include "..\..\..\includes\StandardHordeEvaEvents.inc"
    #include "..\..\..\includes\DwarvenRunesUnits.inc"


    RadarPriority = UNIT
    KindOf = PRELOAD SELECTABLE CAN_CAST_REFLECTIONS CAVALRY SCORE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT PATH_THROUGH_INFANTRY TRANSPORT CAN_ATTACK_WALLS ARMY_SUMMARY NOTIFY_OF_PREATTACK MACHINE
    CamouflageDetectionMultiplier = 0.8

    BuildCost = DWARVEN_BATTLEWAGON_BUILDCOST
    BuildTime = STRONG_BUILDTIME

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = Hero
    End


    BuildFadeInOnCreateTime = 6.7

    Body = DelayedDeathBody ModuleTag_02
        CheerRadius                  = EMOTION_CHEER_RADIUS
        MaxHealth                    = DWARVEN_BATTLEWAGON_HEALTH
        MaxHealthDamaged             = DWARVEN_BATTLEWAGON_HEALTH_DAMAGED
        DoHealthCheck                = No
        DelayedDeathTime             = 5000
        CanRespawn                   = No
        ImmortalUntilDeathTime       = No
    End




    Behavior = SpecialPowerModule ModuleTag_BannerCarrierUpdate
        SpecialPowerTemplate     = SpecialAbilityFakeLeadership
        UpdateModuleStartsAttack = No
        StartsPaused             = No
    End

    Behavior = AttributeModifierAuraUpdate ModuleTag_BannerCarrierBuff
        StartsActive            = No
        BonusName               = BattleWagonLeadership
        TriggeredBy             = Upgrade_BattleWagonBannerCarrier
        RefreshDelay            = 2000
        Range                   = 200

        ObjectFilter            = GENERIC_BUFF_RECIPIENT_OBJECT_FILTER -DwarvenBattleWagonAxeThrower -DwarvenBattleWagonMenOfDale -DwarvenBattleWagonPhalanx -DwarvenBattleWagonBow -DwarvenBattleWagonCrossbow
    End



    Behavior = AutoHealBehavior ModuleTag_BannerCarrierHeal
        StartsActive            = No
        TriggeredBy                = Upgrade_ObjectLevel2
        HealingAmount = 30
        HealingDelay = 1000
        StartHealingDelay = 2000
        HealOnlyIfNotInCombat = Yes
    End



    Behavior = ModelConditionUpgrade ModuleTag_BannerObject
        TriggeredBy                = Upgrade_BattleWagonBannerCarrier
        AddConditionFlags        = USER_1
    End

    Behavior = SubObjectsUpgrade Show_Topper
        TriggeredBy        = Upgrade_AllFactionUpgrade
        RequiresAllTriggers = Yes
        HideSubObjects    = Glow
    End


    Behavior = PassiveAreaEffectBehavior ModuleTag_HearthHeal
        EffectRadius            = 100
        UpgradeRequired         = Upgrade_BattleWagonHearth
        PingDelay               = 3000
        HealPercentPerSecond    = 2%
        AllowFilter             = ANY +INFANTRY +CAVALRY -MACHINE -IMMOBILE +DOZER -STRUCTURE -DwarvenBattleWagon ALLIES
        NonStackable            = Yes
        HealFX                  = FX_SpellHealUnitHealBuff
    End


    Behavior = AutoHealBehavior ModuleTag_AutoHearthHeal
        StartsActive          = No
        TriggeredBy           = Upgrade_BattleWagonHearth
        HealingAmount         = MONSTER_HEAL_AMOUNT
        HealingDelay          = 1000
        StartHealingDelay     = MONSTER_HEAL_DELAY
        HealOnlyIfNotInCombat = Yes
    End

    Behavior = StealthDetectorUpdate ModuleTag_HearthStealthDetect
        DetectionRange            = 200
        DetectionRate            = 2000
        CancelOneRingEffect     = Yes
        RequiredUpgrade            = Upgrade_BattleWagonHearth
    End

    Behavior = SpecialPowerModule ModuleTag_OilBarrelsStarter
        SpecialPowerTemplate        = SpecialAbilityDwarvenBattleWagonOilBarrels
        UpdateModuleStartsAttack    = Yes
        InitiateSound                = DwarfBattleWagonVoiceAttackOilBarrels
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_OilBarrelUpdate
        SpecialPowerTemplate        = SpecialAbilityDwarvenBattleWagonOilBarrels
        WhichSpecialWeapon            = 1
        PackTime                    = 500
        StartAbilityRange            = BATTLEWAGON_OILBARREL_RANGE
        SpecialWeapon                = BattleWagonOilBarrel
        IgnoreFacingCheck            = Yes
    End









    Behavior = AIUpdateInterface ModuleTag_03
        AILuaEventsList             = DwarvenBattleWagonFunctions
        AutoAcquireEnemiesWhenIdle  = No
        AttackPriority              = AttackPriority_Cavalry
    End

    Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        AddEmotion            =    Terror_Base
        AddEmotion            =    Doom_Base
        AddEmotion            =   BraceForBeingCrushed_Base
        AddEmotion            =    UncontrollableFear_Base
        AddEmotion            =    FearIdle_Base
        AddEmotion            =    FearBusy_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
         AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    HeroCheerIdle_Base
        AddEmotion            =    HeroCheerBusy_Base
        AddEmotion            =    Alert_Base
        AddEmotion            =    CheerForAboutToCrush_Base
    End

    Behavior = NotifyTargetsOfImminentProbableCrushingUpdate ModuleTag_NotifyCrushScan
    End

    Behavior LifetimeUpdate LifetimeTag
        WaitForWakeUp    =    Yes
    End

    Behavior = TransportContain  ModuleTag_12
        ObjectStatusOfContained                = UNSELECTABLE CAN_ATTACK
        Slots                                = 2
        DamagePercentToUnits                = 100%
        PassengerFilter                        = ANY +DwarvenBattleWagonAxeThrower +DwarvenBattleWagonBow +DwarvenBattleWagonCrossbow +DwarvenBattleWagonPhalanx
        AllowOwnPlayerInsideOverride        = Yes
        AllowAlliesInside                    = Yes
        AllowEnemiesInside                    = No
        AllowNeutralInside                    = No
        ExitDelay                            = 0
        ForceOrientationContainer            = Yes
        PassengerBonePrefix                    = PassengerBone:PASS KindOf:INFANTRY


        BoneSpecificConditionState 1 PASSENGER_VARIATION_1

        BoneSpecificConditionState 2 PASSENGER_VARIATION_2

        ShowPips                            = No
        EjectPassengersOnDeath                = No
        KillPassengersOnDeath                = Yes

        FadeFilter                            = ALL

        UpgradeCreationTrigger                = Upgrade_BattleWagonAxeThrowers DwarvenBattleWagonAxeThrower 2
        UpgradeCreationTrigger                = Upgrade_BattleWagonBow DwarvenBattleWagonBow 2
        UpgradeCreationTrigger                = Upgrade_BattleWagonCrossbow DwarvenBattleWagonCrossbow 2
        UpgradeCreationTrigger                = Upgrade_BattleWagonBannerCarrier DwarvenBattleWagonPhalanx 2
    End

    Behavior = ModelConditionUpgrade ModuleTag_SpawnFX
        TriggeredBy              = Upgrade_BattleWagonAxeThrowers Upgrade_BattleWagonCrossbow Upgrade_BattleWagonBow Upgrade_BattleWagonBannerCarrier
        AddTempConditionFlag     = ModelConditionState:USER_2
        TempConditionTime        = 0.01
    End

    LocomotorSet
        Locomotor = BattleWagonLocomotor
        Condition = SET_NORMAL
        Speed     = 95
    End

    Behavior = PhysicsBehavior ModuleTag_04
    End

    Behavior = SlowDeathBehavior ModuleTag_05
        DeathTypes            = ALL
        SinkDelay            = 5000
        SinkRate            = 2.4
        DestructionDelay    = 15000
        DecayBeginTime        = 6000
        ProbabilityModifier    = 10
        DeathFlags            = DEATH_1
        ShadowWhenDead        = Yes
        Sound                = INITIAL DwarfBattleWagonDieMS
    End

    Behavior = SquishCollide ModuleTag_06
    End

    Behavior = HitReactionBehavior HitReactionBehaviorModuleTag
        HitReactionLifeTimer1 = 1000
        HitReactionThreshold1 = 200.0
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
        MaxQueueEntries = 1
    End



    Behavior = CommandSetUpgrade ModuleTag_CommandSetUpgradeLangbarte
        TriggeredBy          = Upgrade_SubFactionErebor
        CommandSet           = DwarvenBattleWagonCommandSetErebor
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSetUpgradeFeuerbarte
        TriggeredBy          = Upgrade_SubFactionIronHills
        CommandSet           = DwarvenBattleWagonCommandSetEisenberge
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSetUpgradeBreitschultern
        TriggeredBy          = Upgrade_SubFactionEredLuin
        CommandSet           = DwarvenBattleWagonCommandSetEredLuin
    End


    Behavior = SubObjectsUpgrade Armor_UpgradeLangbarte
        TriggeredBy       = Upgrade_SubFactionErebor
        UpgradeTexture    = duaxdban1.tga 0 duereborban.tga
    End

    Behavior = SubObjectsUpgrade Armor_UpgradeFeuerbarte
        TriggeredBy       = Upgrade_SubFactionIronHills
        UpgradeTexture    = duaxdban1.tga 0 dueisenban.tga
    End

    Behavior = SubObjectsUpgrade Armor_UpgradeBreitschultern
        TriggeredBy       = Upgrade_SubFactionEredLuin
        UpgradeTexture    = duaxdban1.tga 0 dueredluinban.tga
    End

    Behavior = SubObjectsUpgrade Armor_Upgrade1
        TriggeredBy          = Upgrade_SubFactionIronHills
        UpgradeTexture       = EUDwarfmin.tga 0 EUDwarfmin_eisen.tga
        UpgradeTexture       = eudwarfeng.tga 0 eudwarfeng_eisen.tga
        UpgradeTexture       = eudwarfram_eng.tga 0 eudwarfram_eisen.tga
        UpgradeTexture       = duaxdban1.tga 0 dueisenban.tga
        ExcludeSubobjects    = Forged_Blade
    End

    Behavior = SubObjectsUpgrade Armor_Upgrade2
        TriggeredBy          = Upgrade_SubFactionErebor
        UpgradeTexture       = EUDwarfmin.tga 0 EUDwarfmin_ereb.tga
        UpgradeTexture       = eudwarfeng.tga 0 eudwarfeng_ereb.tga
        UpgradeTexture       = eudwarfram_eng.tga 0 eudwarfram_ereb.tga
        UpgradeTexture       = duaxdban1.tga 0 duereborban.tga
        ExcludeSubobjects    = Forged_Blade
    End

    Behavior = SubObjectsUpgrade Armor_Upgrade3
        TriggeredBy          = Upgrade_SubFactionEredLuin
        UpgradeTexture       = EUDwarfmin.tga 0 EUDwarfmin_ered.tga
        UpgradeTexture       = eudwarfeng.tga 0 eudwarfeng_ered.tga
        UpgradeTexture       = eudwarfram_eng.tga 0 eudwarfram_ered.tga
        UpgradeTexture       = duaxdban1.tga 0 dueredluinban.tga
        ExcludeSubobjects    = Forged_Blade
    End


    Behavior = CommandSetUpgrade ModuleTag_CommandSetUpgrade1
        TriggeredBy          = Upgrade_BattleWagonAxeThrowers
        CommandSet           = DwarvenBattleWagonCommandSet_Upgraded
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSetUpgrade2
        TriggeredBy          = Upgrade_BattleWagonCrossbow
        CommandSet           = DwarvenBattleWagonCommandSet_Upgraded
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSetUpgrade3
        TriggeredBy          = Upgrade_BattleWagonBow
        CommandSet           = DwarvenBattleWagonCommandSet_Upgraded
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSetUpgrade4
        TriggeredBy          = Upgrade_BattleWagonHearth
        CommandSet           = DwarvenBattleWagonCommandSet_Upgraded
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSetUpgrade5
        TriggeredBy          = Upgrade_BattleWagonBannerCarrier
        CommandSet           = DwarvenBattleWagonCommandSet_Upgraded
    End

    Behavior = ArmorUpgrade ArmorUpgradeModuleTag
        TriggeredBy = Upgrade_DwarvenMithrilMail
    End

    Behavior = SubObjectsUpgrade Armor_Upgrade
        TriggeredBy        = Upgrade_DwarvenMithrilMail
        UpgradeTexture    = dwarf_a.tga 0 rudwarf_b.tga
        RecolorHouse    = Yes
        ExcludeSubobjects = Forged_Blade
    End

    Behavior = SubObjectsUpgrade Armor_Hearth
        TriggeredBy       = Upgrade_BattleWagonHearth
        ShowSubObjects    = dwarfHearth dwarfHearthFire
    End

    Behavior = SubObjectsUpgrade Banner_Upgrade
        TriggeredBy       = Upgrade_BattleWagonBannerCarrier
        ShowSubObjects    = Banner_L
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_ForgedBlades
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality3
        TriggeredBy = Upgrade_DwarvenMithrilMail
    End





    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End


    Behavior = AISpecialPowerUpdate DwarfBattlewagonOilBarrels
        CommandButtonName = Command_SpecialAbilityOilBarrels
        SpecialPowerAIType = AI_SPECIAL_POWER_RANGED_AOE_ATTACK
    End

    FormationPreviewDecal
            Texture = FPBattleWagonDecal
            Width = 96
            Height = 96
    End

    Geometry = Box
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 17.0
    GeometryHeight = 44.8
    GeometryOffset = X:5.0 Y:0.0 Z:0.0

    GeometryIsSmall = No
    DeadCollideSize = LARGE

    Shadow = SHADOW_VOLUME_NON_SELF_2
    ShadowSizeX = 36



    AutoResolveUnitType = AutoResolveUnit_Cavalry
    AutoResolveCombatChain = AutoResolve_CavalryCombatChain

    AutoResolveBody = AutoResolve_DwarvenBattleWagonBody

    AutoResolveArmor
        Armor = AutoResolve_DwarvenBattleWagonArmor
    End

    AutoResolveWeapon
        Weapon = AutoResolve_DwarvenBattleWagonWeapon
    End
End

