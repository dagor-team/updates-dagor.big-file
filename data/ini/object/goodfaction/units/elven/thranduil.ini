Object ElvenThranduil_mod

    SelectPortrait = HPKingThranduil
    ButtonImage = HIKingThranduil

    DescriptionStrategic = CONTROLBAR:LW_ToolTip_LeaderHero

    Draw = W3DScriptedModelDraw ModuleTag_01

        ExtraPublicBone = SPEAR

        RandomTexture = exthransphere01.tga 0 excloudrs05.tga
        RandomTexture = exthransphere02.tga 0 exlightning03.tga
        RandomTexture = exthransphere03.tga 0 exring01.tga
        RandomTexture = exthransphere04.tga 0 gugandalfcrstl.tga

        DefaultModelConditionState
            Model               = euthranea_skn
            WeaponLaunchBone    = PRIMARY SPEAR
        End    
   
        ;ModelConditionState = FORTRESS_IMPROVEMENT_1
            ;Model           = GUGANDALFCRSTL
            ;Texture         = excloudrs05.tga exthransphere01.tga
            ;Texture         = exlightning03.tga exthransphere02.tga
            ;Texture         = exring01.tga exthransphere03.tga
            ;Texture         = gugandalfcrstl.tga exthransphere04.tga
        ;End
        ;ModelConditionState = FORTRESS_IMPROVEMENT_2
            ;Model           = GUGANDALFCRSTL
            ;Texture         = excloudrs05.tga exthransphere01_b.tga
            ;Texture         = exlightning03.tga exthransphere02_b.tga
            ;Texture         = exring01.tga exthransphere03_b.tga
            ;Texture         = gugandalfcrstl.tga exthransphere04_b.tga
            ;Texture         = exthransphere01.tga exthransphere01_b.tga
            ;Texture         = exthransphere02.tga exthransphere02_b.tga
            ;Texture         = exthransphere03.tga exthransphere03_b.tga
            ;Texture         = exthransphere04.tga exthransphere04_b.tga
        ;End

        ;ModelConditionState     = USER_6
            ;Model               = euthrandc_skn
            ;WeaponLaunchBone    = PRIMARY SPEAR
        ;End

        ;ModelConditionState     = USER_8
            ;Model               = euthrandb_skn
            ;WeaponLaunchBone    = PRIMARY SPEAR
        ;End
		
		ModelConditionState = USER_5
			ParticleSysBone = None ThranduilWrath FollowBone:Yes
            ParticleSysBone = None ThranduilWrath2 FollowBone:Yes
        End

        IdleAnimationState
            Animation                = IDLB
                AnimationName        = RUEowyn_SKL.RUEowyn_IDLB
                AnimationMode        = ONCE
                AnimationPriority   = 20
            End
            Animation                = IDLC
                AnimationName        = RUEowyn_SKL.RUEowyn_IDLC
                AnimationMode        = ONCE
                AnimationPriority   = 1
            End
            Animation                = IDLD
                AnimationName        = RUEowyn_SKL.RUEowyn_IDLD
                AnimationMode        = ONCE
                AnimationPriority   = 1
            End
            StateName                = Idle
            BeginScript
                CurDrawableHideSubObject("spear")
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Selected" then CurDrawableSetTransitionAnimState("TRANS_Selected_To_Idle") end
            EndScript
        End

        AnimationState            = STUNNED_FLAILING
            Flags               = RANDOMSTART
            Animation           = RUEowyn_FLYA
                AnimationName   = RUEowyn_SKL.RUEowyn_FLYA
                AnimationMode   = LOOP
                AnimationSpeedFactorRange    = 0.4 0.6
            End
            StateName           = NoSword
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Sword" then CurDrawableSetTransitionAnimState("TRANS_SheatheSword") end
            EndScript
        End


        AnimationState                =    DYING SPLATTED
            Animation                =    RUEowyn_LNDA
                AnimationName        =    RUEowyn_SKL.RUEowyn_LNDA
                AnimationMode        =    ONCE
            End
            StateName                =    NoSword
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Sword" then CurDrawableSetTransitionAnimState("TRANS_SheatheSword") end
            EndScript
        End
        AnimationState                =    DYING
            Animation                =    RUEowyn_DIEA
                AnimationName        =    RUEowyn_SKL.RUEowyn_DIEA
                AnimationMode        =    ONCE
                AnimationPriority   =   10
            End
        End


        AnimationState            = STUNNED_STANDING_UP
            Animation           = RUEowyn_GTPA
                AnimationName   = RUEowyn_SKL.RUEowyn_GTPA
                AnimationMode   = ONCE
                AnimationSpeedFactorRange= 1.5 1.5
            End
        End
        AnimationState            = STUNNED
            Animation           = RUEowyn_LNDA
                AnimationName   = RUEowyn_SKL.RUEowyn_LNDA
                AnimationMode   = ONCE
            End
            StateName           = NoSword
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Sword" then CurDrawableSetTransitionAnimState("TRANS_SheatheSword") end
            EndScript
        End


        AnimationState        = MOVING FIRING_OR_PREATTACK_A
            ShareAnimation        = Yes
            Animation           = RunAndFire
                AnimationName       = RUEowyn_SKL.RUEowyn_ATRA
                AnimationMode       = LOOP
                AnimationSpeedFactorRange = 1.5 1.5
            End
            Flags               = RANDOMSTART
            BeginScript
                CurDrawableHideSubObject("spear")
            EndScript
        End

        AnimationState        = MOVING FIRING_OR_PREATTACK_A USER_6
            ShareAnimation        = Yes
            Animation           = RunAndFire
                AnimationName       = RUEowyn_SKL.RUEowyn_ATRA
                AnimationMode       = LOOP
            End
            Flags               = RANDOMSTART
            BeginScript
                CurDrawableHideSubObject("spear")
            EndScript
        End

        AnimationState        = MOVING FIRING_OR_PREATTACK_A USER_8
            ShareAnimation        = Yes
            Animation           = RunAndFire
                AnimationName       = RUEowyn_SKL.RUEowyn_ATRA
                AnimationMode       = LOOP
            End
            Flags               = RANDOMSTART
            BeginScript
                CurDrawableHideSubObject("spear")
            EndScript
        End

        AnimationState                =    MOVING ATTACKING
            Flags                    =    RANDOMSTART

            Animation                =    RUNB
                AnimationName        =    RUEowyn_SKL.RUEowyn_RUNB
                AnimationMode        =    LOOP
                AnimationSpeedFactorRange = 1.5 1.5
            End
            StateName                =    NoSword
            BeginScript
                CurDrawableHideSubObject("spear")
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Sword" then CurDrawableSetTransitionAnimState("TRANS_SheatheSword") end
            EndScript
        End

        AnimationState                =    MOVING ATTACKING USER_6
            Flags                    =    RANDOMSTART

            Animation                =    RUNB
                AnimationName        =    RUEowyn_SKL.RUEowyn_RUNB
                AnimationMode        =    LOOP
            End
            StateName                =    NoSword
            BeginScript
                CurDrawableHideSubObject("spear")
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Sword" then CurDrawableSetTransitionAnimState("TRANS_SheatheSword") end
            EndScript
        End

        AnimationState                =    MOVING ATTACKING USER_8
            Flags                    =    RANDOMSTART

            Animation                =    RUNB
                AnimationName        =    RUEowyn_SKL.RUEowyn_RUNB
                AnimationMode        =    LOOP
            End
            StateName                =    NoSword
            BeginScript
                CurDrawableHideSubObject("spear")
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Sword" then CurDrawableSetTransitionAnimState("TRANS_SheatheSword") end
            EndScript
        End


        AnimationState                =    MOVING

            Flags                    =    RANDOMSTART
            Animation                =    RUNA
                AnimationName        =    RUEowyn_SKL.RUEowyn_RUNA
                AnimationMode        =    LOOP
            End
            StateName                =    NoSword
            BeginScript
                CurDrawableHideSubObject("spear")
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Sword" then CurDrawableSetTransitionAnimState("TRANS_SheatheSword") end
            EndScript
        End

        AnimationState                        = PARALYZED
            Animation
                AnimationName                = RUEowyn_IDLB
                AnimationMode                = LOOP
            End
        End


        AnimationState                =    FIRING_OR_PREATTACK_A
            StateName                =    Sword
            Animation                =    ATKA
                AnimationName        =    RUEowyn_SKL.RUEowyn_ATKA
                AnimationMode        =    ONCE
                UseWeaponTiming        =    Yes
                AnimationSpeedFactorRange = 1.5 1.5
            End
            Animation                =    ATKB
                AnimationName        =    RUEowyn_SKL.RUEowyn_ATKB
                AnimationMode        =    ONCE
                UseWeaponTiming        =    Yes
                AnimationSpeedFactorRange = 1.5 1.5
            End
            Animation                =    ATKC
                AnimationName        =    RUEowyn_SKL.RUEowyn_ATKC
                AnimationMode        =    ONCE
                UseWeaponTiming        =    Yes
                AnimationSpeedFactorRange = 1.5 1.5
            End
            Flags                    =    RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                CurDrawableHideSubObject("spear")
            EndScript
        End

        AnimationState                =    FIRING_OR_PREATTACK_A USER_6
            StateName                =    Sword
            Animation                =    ATKA
                AnimationName        =    RUEowyn_SKL.RUEowyn_ATKA
                AnimationMode        =    ONCE
                UseWeaponTiming        =    Yes
            End
            Animation                =    ATKB
                AnimationName        =    RUEowyn_SKL.RUEowyn_ATKB
                AnimationMode        =    ONCE
                UseWeaponTiming        =    Yes
            End
            Animation                =    ATKC
                AnimationName        =    RUEowyn_SKL.RUEowyn_ATKC
                AnimationMode        =    ONCE
                UseWeaponTiming        =    Yes
            End
            Flags                    =    RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                CurDrawableHideSubObject("spear")
            EndScript
        End

        AnimationState                =    FIRING_OR_PREATTACK_A USER_8
            StateName                =    Sword
            Animation                =    ATKA
                AnimationName        =    RUEowyn_SKL.RUEowyn_ATKA
                AnimationMode        =    ONCE
                UseWeaponTiming        =    Yes
            End
            Animation                =    ATKB
                AnimationName        =    RUEowyn_SKL.RUEowyn_ATKB
                AnimationMode        =    ONCE
                UseWeaponTiming        =    Yes
            End
            Animation                =    ATKC
                AnimationName        =    RUEowyn_SKL.RUEowyn_ATKC
                AnimationMode        =    ONCE
                UseWeaponTiming        =    Yes
            End
            Flags                    =    RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                CurDrawableHideSubObject("spear")
            EndScript
        End


        AnimationState        =  SPECIAL_WEAPON_ONE
            StateName = Attacking_throw
            Animation
                AnimationName        = RUEowyn_SKL.RUEowyn_ATKD
                AnimationMode       = ONCE
                AnimationBlendTime    = 0
            End
            BeginScript
                CurDrawableShowSubObject("spear")
            EndScript
        End




        AnimationState        = ATTACKING
            Animation           = ALERT_1
                AnimationName     = RUEowyn_SKL.RUEowyn_IDLA
                AnimationMode     = ONCE
                AnimationSpeedFactorRange = 1.5 1.5
            End
            Flags               = RESTART_ANIM_WHEN_COMPLETE
        End

        AnimationState        = ATTACKING USER_6
            Animation           = ALERT_1
                AnimationName     = RUEowyn_SKL.RUEowyn_IDLA
                AnimationMode     = ONCE
            End
            Flags               = RESTART_ANIM_WHEN_COMPLETE
        End

        AnimationState        = ATTACKING USER_8
            Animation           = ALERT_1
                AnimationName     = RUEowyn_SKL.RUEowyn_IDLA
                AnimationMode     = ONCE
            End
            Flags               = RESTART_ANIM_WHEN_COMPLETE
        End


        AnimationState            = HIT_REACTION HIT_LEVEL_1
            StateName            = STATE_Bored_Sword
            Animation            = Hit_Level_1_A
                AnimationName    = RUEowyn_SKL.RUEowyn_HITA
                AnimationMode    = ONCE
            End
        End


        TransitionState                    =    TRANS_Idle_to_Selected
            Animation                    =    ATNC
                AnimationName            =    RUEowyn_SKL.RUEowyn_ATNA
                AnimationMode            =    ONCE
            End
        End

        TransitionState                    =    TRANS_Selected_To_Idle
            Animation                    =    ATNE
                AnimationName            =    RUEowyn_SKL.RUEowyn_ATNC
                AnimationMode            =    ONCE
            End
        End

        AnimationState                = LEVELED
            Animation                = LevelUp
                AnimationName        = RUEowyn_SKL.RUEowyn_TNTB
                AnimationMode        = ONCE
            End
        End

        AnimationState                = RAISING_FLAG
            Animation                = LevelUp
                AnimationName        = RUEowyn_SKL.RUEowyn_CHRA
                AnimationMode        = LOOP
            End
        End

        AnimationState                =    SELECTED
            StateName                =    Selected
            SimilarRestart            =   Yes
            Animation                =    ATNB
                AnimationName        =    RUEowyn_SKL.RUEowyn_ATNB
                AnimationMode        =    LOOP
            End
            BeginScript
                CurDrawableHideSubObject("spear")
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Idle" then CurDrawableSetTransitionAnimState("TRANS_Idle_to_Selected") end
            EndScript
        End


        AnimationState                =    EMOTION_CELEBRATING
            Animation                =    CHRA
                AnimationName        =    RUEowyn_SKL.RUEowyn_CHRA
                AnimationMode        =    ONCE
            End
            Flags                    =    RESTART_ANIM_WHEN_COMPLETE
        End

        AnimationState                    = EMOTION_TAUNTING
            Animation                    = Taunting
                AnimationName            =  RUEowyn_SKL.RUEowyn_TNTB
                AnimationMode            = ONCE
            End
            Flags                        = RANDOMSTART RESTART_ANIM_WHEN_COMPLETE
        End


        AnimationState        = EMOTION_ALERT
            Animation           = ALERT_1
                AnimationName     = RUEowyn_SKL.RUEowyn_IDLA
                AnimationMode     = ONCE
            End
            Flags               = RESTART_ANIM_WHEN_COMPLETE
        End
    End

    Draw = W3DScriptedModelDraw Icon
        ModelConditionState = NONE
            Model           = bbox
        End
    End

    #include "..\..\..\includes\StunDrawModuleSmall.inc"


        Side             		= Lothlorien
        EditorSorting           = UNIT
        ThreatLevel             = THARANDUIL_THREAT_LEVEL
        ThingClass              = CHARACTER_UNIT
        BuildCost               = THRANDUILDAG_COST
        BuildTime               = MEDIUM_HERO_BUILDTIME
        ShockwaveResistance     = SHOCKWAVE_RESISTANCE_STRONG
        TransportSlotCount      = TRANSPORTSLOTCOUNT_HERO
        MaxSimultaneousOfType   = 1
        DisplayMeleeDamage      = THRANDUILDAG_DAMAGE
        Scale                   = 1.05
        CommandSet              = NewElvenThranduilCommandSetMod
        CommandPoints           = 0

    WeaponSet
        Conditions        = None
        Weapon            = PRIMARY    NewThranduilSwordWeapon1
        AutoChooseSources = PRIMARY    FROM_PLAYER FROM_SCRIPT FROM_AI
    End
	
	WeaponSet
        Conditions        = WEAPONSET_HERO_MODE
        Weapon            = PRIMARY    NewThranduilSwordWeapon1
    End

    WeaponSet
        Conditions        = WEAPONSET_CREATE_A_HERO_WS_01
        Weapon            = PRIMARY    NewThranduilSwordWeapon3
        AutoChooseSources = PRIMARY    FROM_PLAYER FROM_SCRIPT FROM_AI
    End

    WeaponSet
        Conditions        = WEAPONSET_CREATE_A_HERO_WS_02
        Weapon            = PRIMARY    NewThranduilSwordWeapon2
        AutoChooseSources = PRIMARY    FROM_PLAYER FROM_SCRIPT FROM_AI
    End


    ArmorSet
        Conditions      = None
        Armor           = MediumHeroArmor
        DamageFX        = NormalDamageFX
    End

    VisionRange                  = VISION_HERO_STANDARD
    ShroudClearingRange          = SHROUD_CLEAR_HERO
    MaxVisionBonusPercent        = 300%
    VisionBonusTestRadius        = 200
    VisionBonusPercentPerFoot    = 1.0%

    BountyValue                  = 600
    DisplayName                  = OBJECT:ElvenThranduil
    RecruitText                  = CONTROLBAR:ElvenThranduilRecruit
    ReviveText                   = CONTROLBAR:ElvenThranduilRevive
    Hotkey                       = CONTROLBAR:ElvenThranduilHotkey

    CrusherLevel               	 = 0
    CrushableLevel            	 = 2


    AutoResolveUnitType = AutoResolveUnit_Hero
    AutoResolveCombatChain = AutoResolve_HeroCombatChain

    AutoResolveBody = AutoResolve_ThranduilBody

    AutoResolveArmor
        Armor = AutoResolve_ThranduilArmor
    End

    AutoResolveWeapon
        Weapon = AutoResolve_ThranduilWeapon
    End


    VoiceAttack                             = ThranduilEdainVoiceAttack
    VoiceAttackAir                          = ThranduilEdainVoiceAttack
    VoiceAttackCharge                       = ThranduilEdainVoiceAttack
    VoiceAttackMachine                      = ThranduilEdainVoiceAttack
    VoiceAttackStructure                    = ThranduilEdainVoiceAttack
    VoiceCreated                            = ThranduilEdainVoiceRecruit
    VoiceFullyCreated                       = ThranduilEdainVoiceRecruit
    VoiceGuard                              = ThranduilEdainVoiceMove
    VoiceMove                               = ThranduilEdainVoiceMove
    VoiceMoveToCamp                         = ThranduilEdainVoiceMove
    VoiceMoveWhileAttacking                 = ThranduilEdainVoiceMove
    VoicePriority                           = 85
    VoiceRetreatToCastle                    = ThranduilEdainVoiceMove
    VoiceSelect                             = ThranduilEdainVoiceSelect
    VoiceSelectBattle                       = ThranduilEdainVoiceSelect

    SoundImpact                             = ImpactHorse

    UnitSpecificSounds
        VoiceMoveToTrees                    = ThranduilEdainVoiceMove
        VoiceEnterUnitElvenTransportShip    = ThranduilEdainVoiceMove
        VoiceGarrison                       = ThranduilEdainVoiceMove
        VoiceInitiateCaptureBuilding        = ThranduilEdainVoiceMove
    End

    ClientBehavior = ModelConditionSoundSelectorClientBehavior ModuleTag_MCSoundSelector
    SoundState = MOUNTED
        VoiceMove        = ThranduilEdainVoiceMove
        VoiceSelect        = ThranduilEdainVoiceSelect
    End
    End

    CrowdResponseKey = ElfHero

    Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
        Key    = Humanoid_Male Elf Elf_Male Unit Infantry Hero
    End

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound:FootstepDirtA              Animation:RUEowyn_SKL.RUEowyn_RUNTH         Frames:7 19 30 41
        AnimationSound = Sound:FootstepDirtA              Animation:RUEowyn_SKL.RUEowyn_RUNB          Frames:9 19 29 40
        AnimationSound = Sound:SwordIntoScabbard1         Animation:RUEowyn_SKL.RUEowyn_ATKD          Frames:1
        AnimationSound = Sound:EowynVoiceAttackSmite      Animation:RUEowyn_SKL.RUEowyn_ATKD          Frames:35
        AnimationSound = Sound:SwordShingClean1           Animation:RUEowyn_SKL.RUEowyn_ATKD          Frames:59
        AnimationSound = Sound:BodyFallGenericNoArmor     Animation:RUEowyn_SKL.RUEowyn_DIEA          Frames:30
        AnimationSound = Sound:BodyFallSoldier            Animation:RUEowyn_SKL.RUEowyn_LNDA          Frames:2
    End

    #include "..\..\..\includes\StandardUnitEvaEvents.inc"
    EvaEventDieOwner            = ThranduilDie

    Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance               = 200
        TauntAndPointUpdateDelay            = 2000
        PointAt                             = ANY +HERO
        AddEmotion            =    Doom_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
        AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    Alert_Base
        AddEmotion            =    CheerForAboutToCrush_Base
    End


    RadarPriority = UNIT
    KindOf = HERO PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE THROWN_OBJECT ARMY_SUMMARY ATTACK_NEEDS_LINE_OF_SIGHT HEAVY_MELEE_HITTER NOTIFY_OF_PREATTACK SCARY
    PathfindDiameter = 40.0
    CamouflageDetectionMultiplier = CAMOUFLAGE_DETECTION_DISTANCE_MEDIUM


    Body = RespawnBody ModuleTag_RespawnBody
        CheerRadius                 = EMOTION_CHEER_RADIUS
        MaxHealth                   = THRANDUILDAG_HEALTH
        PermanentlyKilledByFilter   = NONE
        DodgePercent                = HERO_DODGE_PERCENT
    End

    Behavior = RespawnUpdate ModuleTag_RespawnUpdate
        DeathAnim                     = DYING
        DeathAnimationTime            = 3000
        RespawnAnim                   = LEVELED
        RespawnAnimationTime          = 2000
        AutoRespawnAtObjectFilter     = NONE +CASTLE_KEEP
        ButtonImage                   = HIThranduilne
        RespawnAsTemplate             = ElvenThranduil_mod

        RespawnRules =    AutoSpawn:No           Cost:THRANDUILDAG_COST       Time:MEDIUM_HERO_RESPAWNTIME        Health:100%
   End

    Behavior = AutoHealBehavior ModuleTag_LegolasHealing
        StartsActive            = Yes
        HealingAmount           = HERO_HEAL_AMOUNT
        HealingDelay            = 1000
        StartHealingDelay       = HERO_HEAL_DELAY
        HealOnlyIfNotInCombat   = Yes
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = HeroThranduil
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = AIUpdateInterface ModuleTag_04
        AutoAcquireEnemiesWhenIdle = Yes ATTACK_BUILDINGS
        AILuaEventsList            = ElvenThranduilFunctions
    End

    LocomotorSet
        Locomotor = HeroHumanLocomotor
        Condition = SET_NORMAL
        Speed     = NORMAL_GOOD_HERO_SPEED
    End

    Behavior = PhysicsBehavior ModuleTag_09
        GravityMult = 1.0
        ShockStandingTime = 3800
    End

    Behavior = SlowDeathBehavior ModuleTag_05
        DeathTypes = ALL -KNOCKBACK
        SinkDelay = 3000
        SinkRate = 0.40
        DestructionDelay = 8000
        Sound = INITIAL ThranduilEdainVoiceDie
        DeathFlags = DEATH_1
    End

    Behavior = SquishCollide ModuleTag_06

    End

    Behavior = SlowDeathBehavior ModuleTag_07

        DeathTypes = NONE +KNOCKBACK
        SinkDelay = 3000
        SinkRate = 0.40
        DestructionDelay = 8000
    End

    Behavior = HitReactionBehavior HitReactionBehaviorModuleTag
        HitReactionLifeTimer1 = 1993
        HitReactionLifeTimer2 = 1993
        HitReactionLifeTimer3 = 1993

        HitReactionThreshold1 = 5.0
        HitReactionThreshold2 = 25.0
        HitReactionThreshold3 = 50.0
    End


    Behavior = CommandSetUpgrade ModuleTag_CommandSetGeschenke
        TriggeredBy       = Upgrade_GeschenkeLoriens
        CommandSet        = NewElvenThranduilCommandSetMod_Geschenke
    End

    Behavior = AttributeModifierUpgrade ModuleTag_GeschenkeBonus
        TriggeredBy       = Upgrade_GeschenkeLoriens
        AttributeModifier = GeschenkeThranduilModifier
    End

    Behavior = SubObjectsUpgrade Upgrade_Geschenke
        TriggeredBy       = Upgrade_GeschenkeLoriens
        ShowSubObjects    = HEAD_HA THRANDUIL_HA SLDRS GNTL HANDS FEET CROWN_HA MANTEL PLANE01
        HideSubObjects    = HEAD THRANDUIL CROWN BROOCH
    End

    Behavior = PassiveAreaEffectBehavior ModuleTag_TaurielKampf
        EffectRadius            = 300
        PingDelay               = 2000
        UpgradeRequired         = Upgrade_TestBuilding_2
        ModifierName            = ThranduilTaurielModifier
        AllowFilter             = ANY +LothlorienTauriel ALLIES
    End


    Behavior = AttributeModifierAuraUpdate ModuleTag_DefaultStance
        StartsActive             = No
        BonusName                = HeroThranduilStanceDefault
        TriggeredBy              = Upgrade_PlantShield
        RefreshDelay             = 500
		AllowSelf		 = Yes
    End


    Behavior = WeaponSetUpgrade Schwert_Weapon
        TriggeredBy             = Upgrade_TestBuilding_2
        WeaponCondition         = WEAPONSET_CREATE_A_HERO_WS_01
    End

    Behavior = WeaponSetUpgrade Schild_Weapon
        TriggeredBy             = Upgrade_TestBuilding
        WeaponCondition         = WEAPONSET_CREATE_A_HERO_WS_02
    End






    Behavior = AttributeModifierAuraUpdate ModuleTag_Leadership3
        StartsActive             = No
        BonusName                = ThranduilLeadership
        TriggeredBy              = Upgrade_Level_2
        RefreshDelay             = 2000
        Range                    = 250
        AntiCategory             = BUFF
        ObjectFilter             = THRANDUIL_OBJECTFILTER
    End





    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_UnpauseHorseToggle
        SpecialPowerTemplate            = SpecialAbilityToggleMounted
        TriggeredBy                     = Upgrade_Level_1
        ObeyRechageOnTrigger            = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_HorseToggleStarter
         SpecialPowerTemplate           = SpecialAbilityToggleMounted
         UpdateModuleStartsAttack       = Yes
         StartsPaused                   = Yes
    End

    Behavior = ToggleMountedSpecialAbilityUpdate ModuleTag_HorseToggle
         SpecialPowerTemplate           = SpecialAbilityToggleMounted
         MountedTemplate                = ElvenThranduil_Mounted
         SynchronizeTimerOnSpecialPower = SpecialAbilityCelebornSilberneBlatter SpecialAbilityFestplatzMirkwood SpecialAbilityTheodenGloriousCharge SpecialAbilityPersonalFlood
         UnpackTime                     = GOOD_MOUNT_TIME
         PreparationTime                = 0
         PackTime                       = 0
         OpacityTarget                  = .0
         AwardXPForTriggering           = 0
         IgnoreFacingCheck              = Yes
    End

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_UnpauseHorseToggle_Geschenke
        SpecialPowerTemplate            = SpecialAbilityToggleMountedHKRing
        TriggeredBy                     = Upgrade_Level_1
        ObeyRechageOnTrigger            = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_HorseToggleStarter_Geschenke
         SpecialPowerTemplate           = SpecialAbilityToggleMountedHKRing
         UpdateModuleStartsAttack       = Yes
         StartsPaused                   = Yes
    End

    Behavior = ToggleMountedSpecialAbilityUpdate ModuleTag_HorseToggle_Geschenke
         SpecialPowerTemplate           = SpecialAbilityToggleMountedHKRing
         MountedTemplate                = ElvenThranduilMounted_Geschenke
         SynchronizeTimerOnSpecialPower = SpecialAbilityCelebornSilberneBlatter SpecialAbilityFestplatzMirkwood SpecialAbilityTheodenGloriousCharge SpecialAbilityPersonalFlood
         UnpackTime                     = GOOD_MOUNT_TIME
         PreparationTime                = 0
         PackTime                       = 0
         OpacityTarget                  = .0
         AwardXPForTriggering           = 0
         IgnoreFacingCheck              = Yes
    End





    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_TheodenGloriousChargeEnabler
        SpecialPowerTemplate      = SpecialAbilityTheodenGloriousCharge
        TriggeredBy               = Upgrade_Level_5
        ObeyRechageOnTrigger            = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_TheodenGloriousChargeUpdate
        SpecialPowerTemplate      = SpecialAbilityTheodenGloriousCharge
        UpdateModuleStartsAttack  = Yes
        StartsPaused = Yes
        AttributeModifier = KonigDusterwaldsModifier
        AttributeModifierRange = 300
        AttributeModifierAffectsSelf = No
        AttributeModifierAffects = ANY +MirkwoodElkrider +MirkwoodWarrior +MirkwoodArcher +MirkwoodSpearmen +MirkwoodAvariWarrior +ElvenMirkwoodArcher +LothlorienMirkwoodPalaceGuard ALLIES
        AttributeModifierFX = FX_TheodenGloriousChargeFX
    End

    Behavior = SpecialAbilityUpdate ModuleTag_GloriousChargeAnimation
        UnpackTime                = 1000
        UnpackingVariation        = 1
        SpecialPowerTemplate      = SpecialAbilityTheodenGloriousCharge
        PreparationTime           = 0
        PersistentPrepTime        = 0
        PackTime                  = 1330
     End





    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_FormenosArmorUpgradeEnabler
        SpecialPowerTemplate           = SpecialAbilityFakeLeadership2
        TriggeredBy                    = Upgrade_Level_7
    End

    Behavior = SpecialPowerModule ModuleTag_FormenosArmorUpgradeStarter
        SpecialPowerTemplate           = SpecialAbilityFakeLeadership2
        UpdateModuleStartsAttack       = Yes
        StartsPaused                   = Yes
    End

    Behavior = ArmorUpgrade ArmorUpgradeModuleTag
        TriggeredBy                    = Upgrade_Level_7
        ArmorSetFlag                   = PLAYER_UPGRADE
    End





    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_SchildwallEnabler
        SpecialPowerTemplate       = SpecialAbilityCelebornSilberneBlatter
        TriggeredBy                = Upgrade_Level_7
        ObeyRechageOnTrigger            = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_SchildwallStarter
        SpecialPowerTemplate       = SpecialAbilityCelebornSilberneBlatter
        UpdateModuleStartsAttack   = Yes
        StartsPaused               = Yes
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_SchildwallWeaponFireUpdate
        SpecialPowerTemplate       = SpecialAbilityCelebornSilberneBlatter
        WhichSpecialWeapon         = 3
        SkipContinue               = Yes
        UnpackTime                 = 2000
        PackTime                   = 1
        FreezeAfterTriggerDuration = 1500
        AwardXPForTriggering       = 0
        StartAbilityRange          = 80.0
        SpecialWeapon              = ThranduilSchildwallWeapon
    End

    Behavior = AutoAbilityBehavior ModuleTag_SchildwallAutoAbility
        SpecialAbility             = SpecialAbilityCelebornSilberneBlatter
        MaxScanRange               = 50
        Query                      = 1 ANY +HERO +MONSTER NOT_FLYING_UNITS
    End


	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_FloodEnabler
        SpecialPowerTemplate        = SpecialAbilityPersonalFlood
        TriggeredBy                 = Upgrade_Level_10
    End

    Behavior = SpecialPowerModule ModuleTag_FloodStarter
        SpecialPowerTemplate        = SpecialAbilityPersonalFlood
        UpdateModuleStartsAttack    = Yes
        StartsPaused                = Yes
        InitiateSound               = EomerCharge3
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_FloodUpdate
        SpecialPowerTemplate        = SpecialAbilityPersonalFlood
        UnpackTime                  = 1300
        PackTime                    = 1500
        StartAbilityRange           = 150.0
        SpecialWeapon               = ReiterdesRegenwaldes
        WhichSpecialWeapon          = 2
    End


	Behavior = SubObjectsUpgrade Upgrade_Level_1
        TriggeredBy       = Upgrade_Level_1
        ShowSubObjects    = HEAD_HA THRANDUIL_HA SLDRS GNTL HANDS FEET CROWN_HA PLANE01 MANTEL
        HideSubObjects    = HEAD THRANDUIL CROWN BROOCH STAB
    End


    Behavior = ObjectCreationUpgrade ModuleTag_IamAI1
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 250000
        GrantUpgrade = Upgrade_GeschenkeLoriens
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_ThranduilSetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_ThranduilSetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = UCThranduilStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Behavior = AISpecialPowerUpdate ElvenLorienWarriorHordeCaptureBuildingAI
        CommandButtonName  = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate ThranduilMountedAI
        CommandButtonName  = Command_ThranduilMounted
    	SpecialPowerAIType = AI_SPECIAL_POWER_TOGGLE_MOUNTED
    End

    Behavior = AISpecialPowerUpdate ThranduilKonigDusterwaldsAI
        CommandButtonName  = Command_ThranduilKonigDusterwalds
        SpecialPowerAIType = AI_SPECIAL_POWER_BASIC_SELF_BUFF
    End

    Behavior = AISpecialPowerUpdate ThranduilSchildwallAI
        CommandButtonName  = Command_SpecialAbilityThranduilSchildwall
        SpecialPowerAIType = AI_SPECIAL_POWER_BASIC_SELF_BUFF
    	SpecialPowerRadius = 250
    End

    Behavior = AISpecialPowerUpdate SummonFest_AI
        CommandButtonName  = Command_SpecialAbilityFesteDusterwalds
        SpecialPowerAIType = AI_SPECIAL_POWER_TARGETAOE_SUMMON
        SpecialPowerRadius = 30.0
    End

    Geometry             = CYLINDER
    GeometryMajorRadius  = 8.0
    GeometryHeight       = 25
    GeometryIsSmall      = Yes

    Shadow               = SHADOW_DECAL
    ShadowSizeX          = 20
    ShadowSizeY          = 20
    ShadowTexture        = ShadowI
End


Object ElvenThranduil_Mounted

    SelectPortrait = HPKingThranduil
    ButtonImage = HIKingThranduil

    DescriptionStrategic = CONTROLBAR:LW_ToolTip_Thranduil

     EquivalentTo = ElvenThranduil_mod

    Draw = W3DScriptedModelDraw ModuleTag_01

        ExtraPublicBone = SPEAR
        ExtraPublicBone = PASSENGERBONE
        DependencySharedModelFlags = TURN_LEFT_HIGH_SPEED TURN_RIGHT_HIGH_SPEED MOVING ACCELERATE DECELERATE TURN_LEFT TURN_RIGHT ATTACKING BACKING_UP

        DefaultModelConditionState
            Model               = euthranea_mnt ;euthranda_hrs
            WeaponLaunchBone    = PRIMARY PASSENGERBONE
            WeaponLaunchBone    = TERTIARY STAFF
        End

        ;ModelConditionState     = USER_6
            ;Model               = euthrandc_hrs
            ;WeaponLaunchBone    = PRIMARY PASSENGERBONE
            ;WeaponLaunchBone    = TERTIARY STAFF
        ;End

        ;ModelConditionState     = USER_8
            ;Model               = euthrandb_hrs
            ;WeaponLaunchBone    = PRIMARY PASSENGERBONE
            ;WeaponLaunchBone    = TERTIARY STAFF
        ;End

        AnimationState                =    STUNNED_FLAILING
            Animation                =    JustDie
                AnimationName        =    GUGdfHrs_SKL.GUGdfHrs_FLYB
                AnimationMode        =    LOOP
            End
            Flags                    =    RANDOMSTART
        End

        AnimationState                =    DYING SPLATTED DEATH_1
            Animation                =    Land
                AnimationName        =    GUGdfHrs_SKL.GUGdfHrs_LNDA
                AnimationMode        =    ONCE
            End
        End

        AnimationState                =    DYING DEATH_1
            Animation                =    JustDie
                AnimationName        =    GUGdfHrs_SKL.GUGdfHrs_DIEA
                AnimationMode        =    ONCE
            End
        End

        AnimationState                =    DYING DEATH_2
            Animation                =    ByeBye
                AnimationName        =    GUGdfHrs_SKL.GUGdfHrs_IDLA
                AnimationMode        =    LOOP
            End
        End

        AnimationState                =    STUNNED_STANDING_UP
            Animation                =    StandUp
                AnimationName        =    GUGdfHrs_SKL.GUGdfHrs_GTPA
                AnimationMode        =    ONCE
            End
        End

        AnimationState                =    STUNNED
            Animation                =    Land
                AnimationName        =    GUGdfHrs_SKL.GUGdfHrs_LNDA
                AnimationMode        =    ONCE
            End
        End

        AnimationState                        = PARALYZED
            Animation
                AnimationName                = GUGdfHrs_SKL.GUGdfHrs_IDLA
                AnimationMode                = LOOP
            End
        End

        AnimationState        =  SPECIAL_WEAPON_ONE
            StateName = Attacking
            Animation
                AnimationName        = GUGdfHrs_SKL.GUGdfHrs_SPLA
                AnimationMode       = ONCE
                AnimationBlendTime    =    4
            End
        End

        AnimationState        =  SPECIAL_WEAPON_TWO
            StateName = Attacking
            Animation
                AnimationName        = GUGdfHrs_SKL.GUGdfHrs_SPLD
                AnimationMode       = ONCE
            End
        End

        AnimationState        =  PACKING_TYPE_1 UNPACKING
            StateName = Attacking
            Animation = LightningSwordStart
                AnimationName           = GUGdfHrs_SKL.GUGdfHrs_SPE1
                AnimationMode       = ONCE
            End
        End

        AnimationState        =  PACKING_TYPE_1 PREPARING
            StateName = Attacking
            Animation = LightningSwordLoop
                AnimationName           = GUGdfHrs_SKL.GUGdfHrs_SPE2
                AnimationMode       = LOOP
            End
        End

        AnimationState        =  PACKING_TYPE_1 PACKING
            StateName = Attacking
            Animation = LightningSwordPutAway
                AnimationName           = GUGdfHrs_SKL.GUGdfHrs_SPE3
                AnimationMode       = ONCE
            End
        End

        AnimationState        =  SPECIAL_WEAPON_THREE
            StateName = Attacking
            Animation = StaffLaser
                AnimationName           = GUGdfHrs_SKL.GUGdfHrs_SPLG
                AnimationMode       = ONCE
            End
        End


        AnimationState                =    FIRING_OR_PREATTACK_A MOVING
            Animation                =    MountedRunAndFire
                AnimationName        =    GUGdfHrs_SKL.GUGdfHrs_ATRA
                AnimationMode        =    LOOP
                Distance            =    60
                AnimationSpeedFactorRange = 1.5 1.5
            End
        End

        AnimationState                =    FIRING_OR_PREATTACK_A MOVING USER_6
            Animation                =    MountedRunAndFire
                AnimationName        =    GUGdfHrs_SKL.GUGdfHrs_ATRA
                AnimationMode        =    LOOP
                Distance            =    60
            End
        End

        AnimationState                =    FIRING_OR_PREATTACK_A MOVING USER_8
            Animation                =    MountedRunAndFire
                AnimationName        =    GUGdfHrs_SKL.GUGdfHrs_ATRA
                AnimationMode        =    LOOP
                Distance            =    60
            End
        End

        AnimationState                =    BETWEEN_FIRING_SHOTS_A MOVING
            Animation                =    TrotBetweenShotsMoving
                AnimationName        =    GUGdfHrs_SKL.GUGdfHrs_WLKA
                AnimationMode        =    LOOP
                Distance            =    30
                AnimationSpeedFactorRange = 1.5 1.5
            End
        End

        AnimationState                =    BETWEEN_FIRING_SHOTS_A MOVING USER_6
            Animation                =    TrotBetweenShotsMoving
                AnimationName        =    GUGdfHrs_SKL.GUGdfHrs_WLKA
                AnimationMode        =    LOOP
                Distance            =    30
            End
        End

        AnimationState                =    BETWEEN_FIRING_SHOTS_A MOVING USER_8
            Animation                =    TrotBetweenShotsMoving
                AnimationName        =    GUGdfHrs_SKL.GUGdfHrs_WLKA
                AnimationMode        =    LOOP
                Distance            =    30
            End
        End


        AnimationState                =    FIRING_OR_PREATTACK_A
            Animation                =    MountedSlash
                AnimationName        =    GUGdfHrs_SKL.GUGdfHrs_ATKA
                AnimationMode        =    ONCE
                UseWeaponTiming        = Yes
                AnimationSpeedFactorRange = 1.5 1.5
            End
            Animation                =    MountedStab
                AnimationName        =    GUGdfHrs_SKL.GUGdfHrs_ATKB
                AnimationMode        =    ONCE
                UseWeaponTiming        = Yes
                AnimationSpeedFactorRange = 1.5 1.5
            End
        End

        AnimationState                =    FIRING_OR_PREATTACK_A USER_6
            Animation                =    MountedSlash
                AnimationName        =    GUGdfHrs_SKL.GUGdfHrs_ATKA
                AnimationMode        =    ONCE
                UseWeaponTiming        = Yes
            End
            Animation                =    MountedStab
                AnimationName        =    GUGdfHrs_SKL.GUGdfHrs_ATKB
                AnimationMode        =    ONCE
                UseWeaponTiming        = Yes
            End
        End

        AnimationState                =    FIRING_OR_PREATTACK_A USER_8
            Animation                =    MountedSlash
                AnimationName        =    GUGdfHrs_SKL.GUGdfHrs_ATKA
                AnimationMode        =    ONCE
                UseWeaponTiming        = Yes
            End
            Animation                =    MountedStab
                AnimationName        =    GUGdfHrs_SKL.GUGdfHrs_ATKB
                AnimationMode        =    ONCE
                UseWeaponTiming        = Yes
            End
        End


        AnimationState                =    TURN_RIGHT_HIGH_SPEED
            Animation                =    TurnRight
                AnimationName        =    GUGdfHrs_SKL.GUGdfHrs_TNR1
                AnimationMode        =    LOOP
            End

        End

        AnimationState                =    TURN_LEFT_HIGH_SPEED
            Animation                =    TurnRight
                AnimationName        =    GUGdfHrs_SKL.GUGdfHrs_TNL1
                AnimationMode        =    LOOP
            End

        End

        AnimationState                =    TURN_LEFT
            Animation                =    TurnLeft
                AnimationName        =    GUGdfHrs_SKL.GUGdfHrs_TRNL
                AnimationMode        =    LOOP
            End

        End

        AnimationState                =    TURN_RIGHT
            Animation                =    TurnRight
                AnimationName        =    GUGdfHrs_SKL.GUGdfHrs_TRNR
                AnimationMode        =    LOOP
            End

        End

        AnimationState                =    MOVING ACCELERATE
            Animation                =    Accelerate
                AnimationName        =    GUGdfHrs_SKL.GUGdfHrs_ACCL
                AnimationMode        =    LOOP
            End

        End

        AnimationState                =    MOVING DECELERATE
            Animation                =    Decelerate
                AnimationName        =    GUGdfHrs_SKL.GUGdfHrs_DECL
                AnimationMode        =    ONCE
                AnimationSpeedFactorRange = 0.6 0.6
            End

        End

        AnimationState                =    MOVING WALKING
            Animation                =    Walk
                AnimationName        =    GUGdfHrs_SKL.GUGdfHrs_WLKA
                AnimationMode        =    LOOP
            End
            Flags                    =    RANDOMSTART

        End

        AnimationState                =    MOVING BACKING_UP
            Animation                =    BackingUp
                AnimationName        =    GUGdfHrs_SKL.GUGdfHrs_BAKA
                AnimationMode        =    LOOP
            End
            Flags                    =    RANDOMSTART

        End


        AnimationState                =    MOVING
            Animation                =    RunA
                AnimationName        =    GUGdfHrs_SKL.GUGdfHrs_RUNA
                AnimationMode        =    LOOP
            End
             Flags                    =    RANDOMSTART

        End


        AnimationState        = LEVELED
            Animation = Yippee
                AnimationName           = GUGdfHrs_SKL.GUGdfHrs_LVLA
                AnimationMode       = ONCE
            End
        End


        AnimationState        = EMOTION_ALERT
            Animation           = ALERT_1
                AnimationName     = GUGdfHrs_SKL.GUGdfHrs_IDLA
                AnimationMode     = LOOP
            End
        End


        AnimationState        = RAISING_FLAG
            Animation
                AnimationName           = GUGdfHrs_SKL.GUGdfHrs_LVLA
                AnimationMode       = LOOP
            End
        End

        AnimationState        = EMOTION_CELEBRATING
            Animation
                AnimationName           = GUGdfHrs_SKL.GUGdfHrs_LVLA
                AnimationMode       = LOOP
            End
        End

        AnimationState        = EMOTION_TAUNTING
            Animation
                AnimationName           = GUGdfHrs_SKL.GUGdfHrs_LVLA
                AnimationMode       = LOOP
            End
        End

        AnimationState                =    SELECTED
            SimilarRestart            =   Yes
            StateName                =    AtAttentionIdle
            Animation                =    ATNB
                AnimationName        =    GUGdfHrs_SKL.GUGdfHrs_ATNB
                AnimationMode        =    LOOP
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Idle" then CurDrawableSetTransitionAnimState("TRANS_MountedSelect") end
                if Prev == "AtAttentionIdle" then CurDrawableSetTransitionAnimState("TRANS_MountedSelect") end
            EndScript
        End

        TransitionState                =    TRANS_MountedSelect
            Animation                =    ATNA
                AnimationName        =    GUGdfHrs_SKL.GUGdfHrs_ATNA
                AnimationMode        =    ONCE
            End
        End


        IdleAnimationState
            StateName = Idle
            Animation    =    IdleA
                AnimationName        =    GUGdfHrs_SKL.GUGdfHrs_IDLA
                AnimationPriority    =    30
                AnimationMode        =    ONCE
                AnimationBlendTime    =    15
            End
            Animation                =    IdleC
                AnimationName        =    GUGdfHrs_SKL.GUGdfHrs_IDLC
                AnimationMode        =    ONCE
                AnimationBlendTime    =    15
            End
            Flags                    =    RESTART_ANIM_WHEN_COMPLETE
        End
    End

    Draw = W3DScriptedModelDraw Icon
        ModelConditionState = NONE
            Model           = bbox
        End
    End

    Draw = W3DScriptedModelDraw DustEffects
        DefaultModelConditionState
          Model = None
        End
        IdleAnimationState
        End
        AnimationState = MOUNTED MOVING WADING
            ParticleSysBone = None FootstepSlash
        End
        AnimationState = MOUNTED MOVING ACCELERATE
            ParticleSysBone = None GenericSiegeTrailDust
        End
        AnimationState = MOUNTED MOVING ACCELERATE
            ParticleSysBone = None GenericSiegeTrailDust
        End
        AnimationState = MOVING
        End
    End


    #include "..\..\..\includes\StunDrawModuleSmall.inc"


        Side             = Lothlorien
        EditorSorting           = UNIT
        ThreatLevel             = THARANDUIL_THREAT_LEVEL
        ThingClass              = CHARACTER_UNIT
        BuildCost               = THRANDUILDAG_COST
        BuildTime               = MEDIUM_HERO_BUILDTIME
        ShockwaveResistance     = SHOCKWAVE_RESISTANCE_STRONG
        TransportSlotCount        = TRANSPORTSLOTCOUNT_HERO
        MaxSimultaneousOfType     = 1

        DisplayMeleeDamage      = THRANDUILDAG_DAMAGE

    CommandSet        = NewElvenThranduilCommandSetMod
    CommandPoints        = 0

    WeaponSet
        Conditions        = None
        Weapon            = PRIMARY    NewThranduilSwordWeapon1
        AutoChooseSources = PRIMARY    FROM_PLAYER FROM_SCRIPT FROM_AI
    End

    WeaponSet
        Conditions        = WEAPONSET_CREATE_A_HERO_WS_01
        Weapon            = PRIMARY    NewThranduilSwordWeapon3
        AutoChooseSources = PRIMARY    FROM_PLAYER FROM_SCRIPT FROM_AI
    End

    WeaponSet
        Conditions        = WEAPONSET_CREATE_A_HERO_WS_02
        Weapon            = PRIMARY    NewThranduilSwordWeapon2
        AutoChooseSources = PRIMARY    FROM_PLAYER FROM_SCRIPT FROM_AI
    End

        ArmorSet
            Conditions      = None
            Armor           = StrongHeroArmor
            DamageFX        = NormalDamageFX
        End

        ArmorSet
            Conditions      = MOUNTED
            Armor           = StrongElvenHeroArmorMounted
            DamageFX        = NormalDamageFX
        End

    VisionRange                   = VISION_HERO_STANDARD
    ShroudClearingRange           = SHROUD_CLEAR_HERO
    MaxVisionBonusPercent         = 300%
    VisionBonusTestRadius         = 200
    VisionBonusPercentPerFoot     = 1.0%

    BountyValue                   = 600
    DisplayName                   = OBJECT:ElvenThranduil
    RecruitText                   = CONTROLBAR:ElvenThranduilRecruit
    ReviveText                    = CONTROLBAR:ElvenThranduilRevive
    Hotkey                        = CONTROLBAR:ElvenThranduilHotkey

    CrusherLevel                  = 1
    MountedCrusherLevel           = 1
    CrushableLevel                = 2
    MountedCrushableLevel         = 2
    CrushWeapon                   = StrongHeroCrush

    MinCrushVelocityPercent       = MINCRUSHVELOCITYPERCENT_HERO
    CrushDecelerationPercent      = CRUSHDECELERATIONPERCENT_HERO

    CrushKnockback                = 40
    CrushZFactor                  = 1.0



    AutoResolveUnitType = AutoResolveUnit_Hero
    AutoResolveCombatChain = AutoResolve_HeroCombatChain

    AutoResolveBody = AutoResolve_ThranduilBody

    AutoResolveArmor
        Armor = AutoResolve_ThranduilArmor
    End

    AutoResolveWeapon
        Weapon = AutoResolve_ThranduilWeapon
    End



    VoiceAttack                             = ThranduilEdainVoiceAttack
    VoiceAttackAir                          = ThranduilEdainVoiceAttack
    VoiceAttackCharge                       = ThranduilEdainVoiceAttack
    VoiceAttackMachine                      = ThranduilEdainVoiceAttack
    VoiceAttackStructure                    = ThranduilEdainVoiceAttack
    VoiceCreated                            = ThranduilEdainVoiceRecruit
    VoiceFullyCreated                       = ThranduilEdainVoiceRecruit
    VoiceGuard                              = ThranduilEdainVoiceMove
    VoiceMove                               = ThranduilEdainVoiceMove
    VoiceMoveToCamp                         = ThranduilEdainVoiceMove
    VoiceMoveWhileAttacking                 = ThranduilEdainVoiceMove
    VoicePriority                           = 85
    VoiceRetreatToCastle                    = ThranduilEdainVoiceMove
    VoiceSelect                             = ThranduilEdainVoiceSelect
    VoiceSelectBattle                       = ThranduilEdainVoiceSelect

    SoundImpact                             = ImpactHorse

    UnitSpecificSounds
        VoiceMoveToTrees                    = ThranduilEdainVoiceMove
        VoiceEnterUnitElvenTransportShip    = ThranduilEdainVoiceMove
        VoiceGarrison                       = ThranduilEdainVoiceMove
        VoiceInitiateCaptureBuilding        = ThranduilEdainVoiceMove
    End

    CrowdResponseKey = ElfHero

    Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
        Key    = Humanoid_Male Elf Elf_Male Unit Infantry Hero
    End

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound:FootstepDirtA              Animation:RUEowyn_SKL.RUEowyn_RUNTH         Frames:7 19 30 41
        AnimationSound = Sound:FootstepDirtA              Animation:RUEowyn_SKL.RUEowyn_RUNB          Frames:9 19 29 40
        AnimationSound = Sound:SwordIntoScabbard1         Animation:RUEowyn_SKL.RUEowyn_ATKD          Frames:1
        AnimationSound = Sound:EowynVoiceAttackSmite      Animation:RUEowyn_SKL.RUEowyn_ATKD          Frames:35
        AnimationSound = Sound:SwordShingClean1           Animation:RUEowyn_SKL.RUEowyn_ATKD          Frames:59
        AnimationSound = Sound:BodyFallGenericNoArmor     Animation:RUEowyn_SKL.RUEowyn_DIEA          Frames:30
        AnimationSound = Sound:BodyFallSoldier            Animation:RUEowyn_SKL.RUEowyn_LNDA          Frames:2
        AnimationSound = Sound:HorseMoveFootsteps         Animation:GUGdfHrs_SKL.GUGdfHrs_ACCL        Frames:15 32
        AnimationSound = Sound:HorseMoveFootsteps         Animation:GUGdfHrs_SKL.GUGdfHrs_RUNA        Frames:0
        AnimationSound = Sound:HorseMoveFootsteps         Animation:GUGdfHrs_SKL.GUGdfHrs_TNL1        Frames:0
        AnimationSound = Sound:HorseMoveFootsteps         Animation:GUGdfHrs_SKL.GUGdfHrs_TNR1        Frames:0
        AnimationSound = Sound:DeerWhinny                 Animation:GUGdfHrs_SKL.GUGdfHrs_IDLC        Frames:0
        AnimationSound = Sound:DeerWhinny                 Animation:GUGdfHrs_SKL.GUGdfHrs_LVLA        Frames:64
        AnimationSound = Sound:DeerWhinny                 Animation:GUGdfHrs_SKL.GUGdfHrs_SPLA        Frames:74
        AnimationSound = Sound:BodyFallGenericNoArmor     Animation:GUGdfHrs_SKL.GUGdfHrs_DIEA        Frames:2 42
        AnimationSound = Sound:DeerWhinny                 Animation:GUGdfHrs_SKL.GUGdfHrs_DIEA        Frames:1
    End

    #include "..\..\..\includes\StandardUnitEvaEvents.inc"

    EvaEventDieOwner            = ThranduilDie

    Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance              = 200
        TauntAndPointUpdateDelay           = 2000
        PointAt                            = ANY +HERO
        AddEmotion            =    Doom_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
        AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    Alert_Base
        AddEmotion            =    CheerForAboutToCrush_Base
    End



    RadarPriority = UNIT
    KindOf = HERO PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE THROWN_OBJECT ARMY_SUMMARY ATTACK_NEEDS_LINE_OF_SIGHT HEAVY_MELEE_HITTER NOTIFY_OF_PREATTACK SCARY
    PathfindDiameter = 40.0
    CamouflageDetectionMultiplier = CAMOUFLAGE_DETECTION_DISTANCE_MEDIUM


    Body = RespawnBody ModuleTag_RespawnBody
        CheerRadius                 = EMOTION_CHEER_RADIUS
        MaxHealth                   = THRANDUILDAG_HEALTH
        PermanentlyKilledByFilter   = NONE
        DodgePercent                = HERO_DODGE_PERCENT
    End

    Behavior = RespawnUpdate ModuleTag_RespawnUpdate
        DeathAnim                    = DYING
        DeathAnimationTime           = 3000
        RespawnAnim                  = LEVELED
        RespawnAnimationTime         = 2000
        AutoRespawnAtObjectFilter    = NONE +CASTLE_KEEP
        ButtonImage                  = HIThranduilMod
        RespawnAsTemplate            = ElvenThranduil_mod

        RespawnRules =    AutoSpawn:No           Cost:THRANDUILDAG_COST       Time:MEDIUM_HERO_RESPAWNTIME        Health:100%
   End

    Behavior = AutoHealBehavior ModuleTag_LegolasHealing
        StartsActive            = Yes
        HealingAmount           = HERO_HEAL_AMOUNT
        HealingDelay            = 1000
        StartHealingDelay       = HERO_HEAL_DELAY
        HealOnlyIfNotInCombat   = Yes
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = HeroThranduil
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = AIUpdateInterface ModuleTag_04
        AutoAcquireEnemiesWhenIdle = Yes ATTACK_BUILDINGS
        AILuaEventsList            = ElvenThranduilFunctions
    End

    LocomotorSet
        Locomotor = HeroHorseLocomotor
        Condition = SET_NORMAL
        Speed     = 120
    End

    Behavior = PhysicsBehavior ModuleTag_09
        GravityMult = 1.0
        ShockStandingTime = 3800
    End

    Behavior = SlowDeathBehavior ModuleTag_05
        DeathTypes = ALL -KNOCKBACK
        SinkDelay = 3000
        SinkRate = 0.40
        DestructionDelay = 8000
        Sound = INITIAL ThranduilEdainVoiceDie
        DeathFlags = DEATH_1
    End

    Behavior = SquishCollide ModuleTag_06

    End

    Behavior = SlowDeathBehavior ModuleTag_07

        DeathTypes = NONE +KNOCKBACK
        SinkDelay = 3000
        SinkRate = 0.40
        DestructionDelay = 8000
    End

    Behavior = HitReactionBehavior HitReactionBehaviorModuleTag
        HitReactionLifeTimer1 = 1993
        HitReactionLifeTimer2 = 1993
        HitReactionLifeTimer3 = 1993

        HitReactionThreshold1 = 5.0
        HitReactionThreshold2 = 25.0
        HitReactionThreshold3 = 50.0
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSetGeschenke
        TriggeredBy       = Upgrade_GeschenkeLoriens
        CommandSet        = NewElvenThranduilCommandSetMod_Geschenke
    End

    Behavior = AttributeModifierUpgrade ModuleTag_GeschenkeBonus
        TriggeredBy       = Upgrade_GeschenkeLoriens
        AttributeModifier = GeschenkeThranduilModifier
    End

    Behavior = SubObjectsUpgrade Upgrade_Geschenke
        TriggeredBy       = Upgrade_GeschenkeLoriens
        ShowSubObjects    = HEAD_HA THRANDUIL_HA SLDRS GNTL HANDS FEET CROWN_HA MANTEL PLANE01
        HideSubObjects    = HEAD THRANDUIL CROWN BROOCH
    End

    Behavior = PassiveAreaEffectBehavior ModuleTag_TaurielKampf
        EffectRadius            = 300
        PingDelay               = 2000
        UpgradeRequired         = Upgrade_TestBuilding_2
        ModifierName            = ThranduilTaurielModifier
        AllowFilter             = ANY +LothlorienTauriel ALLIES
    End

    Behavior = AttributeModifierAuraUpdate ModuleTag_DefaultStance
        StartsActive             = No
        BonusName                = HeroThranduilStanceDefault
        TriggeredBy              = Upgrade_PlantShield
        RefreshDelay             = 500
		AllowSelf		 = Yes
    End

    Behavior = WeaponSetUpgrade Schwert_Weapon
        TriggeredBy               = Upgrade_TestBuilding_2
        WeaponCondition           = WEAPONSET_CREATE_A_HERO_WS_01
    End

    Behavior = WeaponSetUpgrade Schild_Weapon
        TriggeredBy               = Upgrade_TestBuilding
        WeaponCondition           = WEAPONSET_CREATE_A_HERO_WS_02
    End





    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_ElrondsErfahrungsLeadership2
        SpecialPowerTemplate     = SpecialAbilityFakeLeadership
        TriggeredBy              = Upgrade_Level_3
    End

    Behavior = SpecialPowerModule ModuleTag_ElrondsErfahrungsLeadershipUpdate2
        SpecialPowerTemplate     = SpecialAbilityFakeLeadership
        UpdateModuleStartsAttack = No
        StartsPaused             = Yes
    End

    Behavior = AttributeModifierAuraUpdate ModuleTag_Leadership3
        StartsActive             = No
        BonusName                = ThranduilLeadership
        TriggeredBy              = Upgrade_Level_3
        RefreshDelay             = 2000
        Range                    = 250
        AntiCategory             = BUFF
        ObjectFilter             = THRANDUIL_OBJECTFILTER
    End





    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_UnpauseHorseToggle
        SpecialPowerTemplate            = SpecialAbilityToggleMounted
        TriggeredBy                     = Upgrade_Level_1
        ObeyRechageOnTrigger            = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_HorseToggleStarter
         SpecialPowerTemplate           = SpecialAbilityToggleMounted
         UpdateModuleStartsAttack       = Yes
         StartsPaused                   = Yes
    End

    Behavior = ToggleMountedSpecialAbilityUpdate ModuleTag_HorseToggle
         SpecialPowerTemplate           = SpecialAbilityToggleMounted
         MountedTemplate                = ElvenThranduil_mod
         SynchronizeTimerOnSpecialPower = SpecialAbilityCelebornSilberneBlatter SpecialAbilityFestplatzMirkwood SpecialAbilityTheodenGloriousCharge SpecialAbilityPersonalFlood
         UnpackTime                     = GOOD_MOUNT_TIME
         PreparationTime                = 0
         PackTime                       = 0
         OpacityTarget                  = .0
         AwardXPForTriggering           = 0
         IgnoreFacingCheck              = Yes
    End

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_UnpauseHorseToggle_Geschenke
        SpecialPowerTemplate            = SpecialAbilityToggleMountedHKRing
        TriggeredBy                     = Upgrade_Level_1
        ObeyRechageOnTrigger            = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_HorseToggleStarter_Geschenke
         SpecialPowerTemplate           = SpecialAbilityToggleMountedHKRing
         UpdateModuleStartsAttack       = Yes
         StartsPaused                   = Yes
    End

    Behavior = ToggleMountedSpecialAbilityUpdate ModuleTag_HorseToggle_Geschenke
         SpecialPowerTemplate           = SpecialAbilityToggleMountedHKRing
         MountedTemplate                = ElvenThranduil_Geschenke
         SynchronizeTimerOnSpecialPower = SpecialAbilityCelebornSilberneBlatter SpecialAbilityFestplatzMirkwood SpecialAbilityTheodenGloriousCharge SpecialAbilityPersonalFlood
         UnpackTime                     = GOOD_MOUNT_TIME
         PreparationTime                = 0
         PackTime                       = 0
         OpacityTarget                  = .0
         AwardXPForTriggering           = 0
         IgnoreFacingCheck              = Yes
    End





    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_TheodenGloriousChargeEnabler
        SpecialPowerTemplate      = SpecialAbilityTheodenGloriousCharge
        TriggeredBy               = Upgrade_Level_5
        ObeyRechageOnTrigger            = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_TheodenGloriousChargeUpdate
        SpecialPowerTemplate      = SpecialAbilityTheodenGloriousCharge
        UpdateModuleStartsAttack  = Yes
        StartsPaused = Yes
        AttributeModifier = KonigDusterwaldsModifier
        AttributeModifierRange = 300
        AttributeModifierAffectsSelf = No
        AttributeModifierAffects = ANY +MirkwoodElkrider +MirkwoodWarrior +MirkwoodArcher +MirkwoodSpearmen +ElvenMirkwoodArcher +LothlorienMirkwoodPalaceGuard ALLIES
        AttributeModifierFX = FX_ThranduilWrath        ;FX_TheodenGloriousChargeFX
    End

    Behavior = SpecialAbilityUpdate ModuleTag_GloriousChargeAnimation
        UnpackTime                = 1000
        UnpackingVariation        = 1
        SpecialPowerTemplate      = SpecialAbilityTheodenGloriousCharge
        PreparationTime           = 0
        PersistentPrepTime        = 0
        PackTime                  = 1330
    End





    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_FormenosArmorUpgradeEnabler
        SpecialPowerTemplate           = SpecialAbilityFakeLeadership2
        TriggeredBy                    = Upgrade_Level_7
    End

    Behavior = SpecialPowerModule ModuleTag_FormenosArmorUpgradeStarter
        SpecialPowerTemplate           = SpecialAbilityFakeLeadership2
        UpdateModuleStartsAttack       = Yes
        StartsPaused                   = Yes
    End

    Behavior = ArmorUpgrade ArmorUpgradeModuleTag
        TriggeredBy                    = Upgrade_Level_7
        ArmorSetFlag                   = PLAYER_UPGRADE
    End





    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_SchildwallEnabler
        SpecialPowerTemplate       = SpecialAbilityCelebornSilberneBlatter
        TriggeredBy                = Upgrade_Level_8
        ObeyRechageOnTrigger            = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_SchildwallStarter
        SpecialPowerTemplate       = SpecialAbilityCelebornSilberneBlatter
        UpdateModuleStartsAttack   = Yes
        StartsPaused               = Yes
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_SchildwallWeaponFireUpdate
        SpecialPowerTemplate       = SpecialAbilityCelebornSilberneBlatter
        WhichSpecialWeapon         = 3
        SkipContinue               = Yes
        UnpackTime                 = 2000
        PackTime                   = 1
        FreezeAfterTriggerDuration = 1500
        AwardXPForTriggering       = 0
        StartAbilityRange          = 80.0
        SpecialWeapon              = ThranduilSchildwallWeapon
    End

    Behavior = AutoAbilityBehavior ModuleTag_SchildwallAutoAbility
        SpecialAbility             = SpecialAbilityCelebornSilberneBlatter
        MaxScanRange               = 50
        Query                      = 1 ANY +HERO +MONSTER NOT_FLYING_UNITS
    End



	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_FloodEnabler
        SpecialPowerTemplate        = SpecialAbilityPersonalFlood
        TriggeredBy                 = Upgrade_Level_10
    End

    Behavior = SpecialPowerModule ModuleTag_FloodStarter
        SpecialPowerTemplate        = SpecialAbilityPersonalFlood
        UpdateModuleStartsAttack    = Yes
        StartsPaused                = Yes
        InitiateSound               = EomerCharge3
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_FloodUpdate
        SpecialPowerTemplate        = SpecialAbilityPersonalFlood
        UnpackTime                  = 1300
        PackTime                    = 1500
        StartAbilityRange           = 150.0
        SpecialWeapon               = ReiterdesRegenwaldes
        WhichSpecialWeapon          = 2
    End



	Behavior = SubObjectsUpgrade Upgrade_Mounted2
        TriggeredBy       = Upgrade_Level_1
        ShowSubObjects    = HEAD_HA THRANDUIL_HA SLDRS GNTL HANDS FEET CROWN_HA PLANE01 MANTEL
        HideSubObjects    = HEAD THRANDUIL CROWN BROOCH STAB
    End




    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_ThranduilSetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_ThranduilSetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = UCThranduilStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Behavior = AISpecialPowerUpdate ElvenLorienWarriorHordeCaptureBuildingAI
        CommandButtonName  = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate ThranduilMountedAI
        CommandButtonName  = Command_ThranduilMounted
    SpecialPowerAIType = AI_SPECIAL_POWER_TOGGLE_MOUNTED
    End

    Behavior = AISpecialPowerUpdate ThranduilKonigDusterwaldsAI
        CommandButtonName  = Command_ThranduilKonigDusterwalds
        SpecialPowerAIType = AI_SPECIAL_POWER_BASIC_SELF_BUFF
    End

    Behavior = AISpecialPowerUpdate ThranduilSchildwallAI
        CommandButtonName  = Command_SpecialAbilityThranduilSchildwall
        SpecialPowerAIType = AI_SPECIAL_POWER_BASIC_SELF_BUFF
    	SpecialPowerRadius = 250
    End

    Behavior = AISpecialPowerUpdate SummonFest_AI
        CommandButtonName  = Command_SpecialAbilityFesteDusterwalds
        SpecialPowerAIType = AI_SPECIAL_POWER_TARGETAOE_SUMMON
        SpecialPowerRadius = 30.0
    End

    Scale 		= 1.05
    Geometry 		= CYLINDER
    GeometryMajorRadius = 8.0
    GeometryMinorRadius = 8.0
    GeometryHeight 	= 19.2
    GeometryIsSmall 	= Yes
    Shadow 		= SHADOW_DECAL
    ShadowSizeX 	= 19
    ShadowSizeY 	= 19
    ShadowTexture 	= ShadowI
End

ChildObject ElvenThranduil_Geschenke ElvenThranduil_mod

    Behavior = CommandSetUpgrade ModuleTag_CommandSetGeschenke
        TriggeredBy       = Upgrade_Level_1
        CommandSet        = NewElvenThranduilCommandSetMod_Geschenke
    End

    Behavior = AttributeModifierUpgrade ModuleTag_GeschenkeBonus
        TriggeredBy       = Upgrade_Level_1
        AttributeModifier = GeschenkeThranduilModifier
    End

    Behavior = SubObjectsUpgrade Upgrade_Geschenke
        TriggeredBy       = Upgrade_Level_1
        ShowSubObjects    = HEAD_HA THRANDUIL_HA SLDRS GNTL HANDS FEET CROWN_HA MANTEL PLANE01
        HideSubObjects    = HEAD THRANDUIL CROWN BROOCH
    End





    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_SchildwallEnabler
        SpecialPowerTemplate       = SpecialAbilityCelebornSilberneBlatter
        TriggeredBy                = Upgrade_Level_8
        ObeyRechageOnTrigger       = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_SchildwallStarter
        SpecialPowerTemplate       = SpecialAbilityCelebornSilberneBlatter
        UpdateModuleStartsAttack   = Yes
        StartsPaused               = Yes
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_SchildwallWeaponFireUpdate
        SpecialPowerTemplate       = SpecialAbilityCelebornSilberneBlatter
        WhichSpecialWeapon         = 4
        SkipContinue               = Yes
        UnpackTime                 = 2000
        PackTime                   = 1
        FreezeAfterTriggerDuration = 1500
        AwardXPForTriggering       = 0
        StartAbilityRange          = 80.0
        SpecialWeapon              = ThranduilSchildwallWeapon_Geschenke
    End

    Behavior = AutoAbilityBehavior ModuleTag_SchildwallAutoAbility
        SpecialAbility             = SpecialAbilityCelebornSilberneBlatter
        MaxScanRange               = 50
        Query                      = 1 ANY +HERO +MONSTER NOT_FLYING_UNITS
    End

End

ChildObject ElvenThranduilMounted_Geschenke ElvenThranduil_Mounted

    Behavior = CommandSetUpgrade ModuleTag_CommandSetGeschenke
        TriggeredBy       = Upgrade_Level_1
        CommandSet        = NewElvenThranduilCommandSetMod_Geschenke
    End

    Behavior = AttributeModifierUpgrade ModuleTag_GeschenkeBonus
        TriggeredBy       = Upgrade_Level_1
        AttributeModifier = GeschenkeThranduilModifier
    End

    Behavior = SubObjectsUpgrade Upgrade_Geschenke
        TriggeredBy       = Upgrade_Level_1
        ShowSubObjects    = HEAD_HA THRANDUIL_HA SLDRS GNTL HANDS FEET CROWN_HA MANTEL PLANE01
        HideSubObjects    = HEAD THRANDUIL CROWN BROOCH
    End





    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_SchildwallEnabler
        SpecialPowerTemplate       = SpecialAbilityCelebornSilberneBlatter
        TriggeredBy                = Upgrade_Level_8
        ObeyRechageOnTrigger       = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_SchildwallStarter
        SpecialPowerTemplate       = SpecialAbilityCelebornSilberneBlatter
        UpdateModuleStartsAttack   = Yes
        StartsPaused               = Yes
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_SchildwallWeaponFireUpdate
        SpecialPowerTemplate       = SpecialAbilityCelebornSilberneBlatter
        WhichSpecialWeapon         = 4
        SkipContinue               = Yes
        UnpackTime                 = 2000
        PackTime                   = 1
        FreezeAfterTriggerDuration = 1500
        AwardXPForTriggering       = 0
        StartAbilityRange          = 80.0
        SpecialWeapon              = ThranduilSchildwallWeapon_Geschenke
    End

    Behavior = AutoAbilityBehavior ModuleTag_SchildwallAutoAbility
        SpecialAbility             = SpecialAbilityCelebornSilberneBlatter
        MaxScanRange               = 50
        Query                      = 1 ANY +HERO +MONSTER NOT_FLYING_UNITS
    End

End

Object ElvenThranduil_Summoned

    SelectPortrait = HPThranduilMod
    ButtonImage    = HIThranduilne

    DescriptionStrategic = CONTROLBAR:LW_ToolTip_Thranduil

    Draw = W3DScriptedModelDraw ModuleTag_01

        DefaultModelConditionState
            Model                = euthransword
            Skeleton             = CHCM_CM_U_SKL
        End

        ModelConditionState      = WEAPONSET_TOGGLE_1
            Model                = euthranbow
            Skeleton             = CHCM_CM_U_SKL
            WeaponLaunchBone     = PRIMARY ARROW
        End

        ModelConditionState      = USER_2
            ParticleSysBone      = BAT_RIBS SmaragdeGirions FXTrigger:NONE Persist:SPAWN PersistID:100
            ParticleSysBone      = BAT_RIBS SmaragdeGirions FXTrigger:NONE Persist:SPAWN PersistID:100
        End



        IdleAnimationState
            StateName               = STATE_Idle_Sword
            Animation = Foot_IDLC
                AnimationName       = CHCM_CM_U_IDLB
                AnimationMode       = ONCE
                AnimationPriority   = 4
            End
            BeginScript
                CurDrawableHideSubObject("arrow")
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Selected_Sword" then CurDrawableSetTransitionAnimState("TRANS_SelectedToBoredSword") end
                if Prev == "STATE_Idle_Bow" then CurDrawableSetTransitionAnimState("TRANS_BowToSword") end
            EndScript
        End

        TransitionState = TRANS_BoredToSelectedSword

            Animation = ANTD
                AnimationName    = CHCM_CM_U_ATNA
                AnimationMode    = ONCE
            End
        End

        TransitionState = TRANS_SelectedToBoredSword
            Animation            = ATNF
                AnimationName    = CHCM_CM_U_ATNC
                AnimationMode    = ONCE
            End
        End

        TransitionState = TRANS_BoredToSelectedBow
            Animation = ATNC
                AnimationName        = CHCM_CM_B_ATNA
                AnimationMode        = ONCE
            End
        End

        TransitionState = TRANS_CaptainBowToSelectedBow
            Animation = ATNC
                AnimationName        = CHCM_CM_B_ATNA
                AnimationMode        = ONCE
                AnimationBlendTime    = 10
                AnimationSpeedFactorRange = 1.5 1.5
            End
        End

        TransitionState = TRANS_SelectedToBoredBow
            Animation            = ATNA
                AnimationName    = CHCM_CM_B_ATNC
                AnimationMode    = ONCE
            End
        End


        TransitionState       = TRANS_BowToSword
            Animation           = BowToSword
                AnimationName     = CHCM_CM_B_STHA
                AnimationMode     = ONCE
            End
        End

        TransitionState       = TRANS_SwordToBow
            Animation           = SwordToBow
                AnimationName     = CHCM_CM_U_STHA
                AnimationMode     = ONCE
            End
        End

        TransitionState               = TRANS_BowToSword_Running
            Animation               = DrawSwords
                AnimationName       = CHCM_CM_B_STHB
                AnimationMode       = ONCE
            End
        End

        TransitionState               = TRANS_SwordToBow_Running
            Animation               = DrawBow
                AnimationName       = CHCM_CM_U_STHB
                AnimationMode       = ONCE
            End
        End

AnimationState        = STUNNED_FLAILING WEAPONSET_TOGGLE_1
    StateName           = STATE_Bow
    Animation
        AnimationName     = CHCM_CM_B_FLYA
        AnimationMode     = LOOP
    End
    Flags               = RANDOMSTART
End

AnimationState        = STUNNED_FLAILING
    StateName           = STATE_Sword
    Animation
        AnimationName     = CHCM_CM_U_FLYA
        AnimationMode     = LOOP
    End
    Flags               = RANDOMSTART
End


AnimationState        = DYING SPLATTED WEAPONSET_TOGGLE_1
    StateName           = STATE_Bow
    Animation
        AnimationName     = CHCM_CM_B_LNDA
        AnimationMode     = ONCE
    End
End

AnimationState        = DYING SPLATTED
    StateName           = STATE_Sword
    Animation
        AnimationName     = CHCM_CM_U_LNDA
        AnimationMode     = ONCE
    End
End

AnimationState        = DYING WEAPONSET_TOGGLE_1
    StateName           = STATE_Bow
    Animation
        AnimationName     = CHCM_CM_B_DIEA
        AnimationMode     = ONCE
    End
End

AnimationState        = DYING
    StateName           = STATE_Sword
    Animation
        AnimationName     = CHCM_CM_U_DIEA
        AnimationMode     = ONCE
    End
End





AnimationState        = STUNNED_STANDING_UP WEAPONSET_TOGGLE_1
    StateName           = STATE_Bow
    Animation
        AnimationName     = CHCM_CM_B_GTPA
        AnimationMode     = ONCE
        AnimationSpeedFactorRange = 1.5 1.5
    End
End

AnimationState        = STUNNED_STANDING_UP
    StateName           = STATE_Sword
    Animation
        AnimationName     = CHCM_CM)_U_GTPA
        AnimationMode     = ONCE
        AnimationSpeedFactorRange = 1.5 1.5
    End
End

AnimationState        = STUNNED WEAPONSET_TOGGLE_1
    StateName           = STATE_Bow
    Animation
        AnimationName     = CHCM_CM_B_LNDA
        AnimationMode     = ONCE
    End
End

AnimationState        = STUNNED
    StateName           = STATE_Sword
    Animation           = GUHero_LNDA
        AnimationName     = CHCM_CM_U_LNDA
        AnimationMode     = ONCE
    End
End





AnimationState                = PACKING_TYPE_1  WEAPONSET_TOGGLE_1
    StateName                = rainofarrows
    Animation
        AnimationName        = CHCM_CM_B_ATKA2
        AnimationMode        = LOOP
    End
End


AnimationState                = PACKING_TYPE_1
    StateName                = Curse
    Animation
        AnimationName        = CHCM_CM_U_LVLA
        AnimationMode        = ONCE
    End
End

AnimationState                = PACKING_TYPE_3
    StateName                = Curse
    Animation
        AnimationName        = CHCM_CM_U_SPCA
        AnimationMode        = ONCE
    End
End


AnimationState        =  SPECIAL_WEAPON_TWO
    StateName = STATE_Bow
    Animation
        AnimationName       = CHCM_CM_U_SPCL
        AnimationMode       = ONCE
    End
    FrameForPristineBonePositions = 59
    BeginScript
        CurDrawableShowSubObject("arrow")
    EndScript
End







        AnimationState            = MOVING WEAPONSET_TOGGLE_1
            StateName           = STATE_RunningBow
            Flags               = RANDOMSTART

            Animation
                AnimationName   = CHCM_CM_B_RUNA

                AnimationSpeedFactorRange = 0.85 0.85

            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Sword" then CurDrawableSetTransitionAnimState("TRANS_SwordToBow") end
                if Prev == "STATE_RunningSword" then CurDrawableSetTransitionAnimState("TRANS_SwordToBow_Running") end
                if Prev == "STATE_Rappelling"  then CurDrawableSetTransitionAnimState("Trans_RappellingToRunning_WeaponToggle") return end
            EndScript
        End


        AnimationState            = MOVING
            StateName           = STATE_RunningSword
            Flags               = RANDOMSTART

            Animation
                AnimationName   = CHCM_CM_U_RUNA

                AnimationSpeedFactorRange = 0.85 0.85

            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Bow" then CurDrawableSetTransitionAnimState("TRANS_BowToSword") end
                if Prev == "STATE_RunningBow" then CurDrawableSetTransitionAnimState("TRANS_BowToSword_Running") end
                if Prev == "STATE_Rappelling"  then CurDrawableSetTransitionAnimState("Trans_RappellingToRunning") return end
            EndScript
        End



        AnimationState                        = FIRING_OR_PREATTACK_A WEAPONSET_TOGGLE_1
            StateName                        = Attacking_Bow
            Animation
                AnimationName                = CHCM_CM_B_ATKA2
                AnimationMode                = ONCE
                UseWeaponTiming                = Yes
                AnimationBlendTime            = 20
            End
        End

        AnimationState                        = PREATTACK_A WEAPONSET_TOGGLE_1
            Animation                        = ReadyToDrawn
                AnimationName                = CHCM_CM_B_ATKA1
                AnimationMode                = ONCE
                AnimationBlendTime            = 0
                UseWeaponTiming                = Yes
            End
        End

        AnimationState                        = FIRING_OR_RELOADING_A WEAPONSET_TOGGLE_1
            StateName                        = STATE_Firing
            Animation
                AnimationName                = CHCM_CM_B_ATKA2
                AnimationMode                = ONCE
                AnimationBlendTime            = 30
                UseWeaponTiming                = Yes
                AnimationSpeedFactorRange    = 1.5 1.5
            End
            Flags                            = START_FRAME_FIRST
        End

        AnimationState                        = CONTINUOUS_FIRE_MEAN
            Animation                        = HangFrameWhileCoasting
                AnimationName                = CHCM_CM_B_ATKA2
                AnimationMode                = MANUAL
                AnimationBlendTime            = 20
            End
            Flags                            = START_FRAME_LAST
        End

        AnimationState                        = CONTINUOUS_FIRE_SLOW
            StateName                        = Ready_Bow
            Animation                        = PutAwayArrow
                AnimationName                = CHCM_CM_B_ATKA3
                AnimationMode                = ONCE
            End
        End


        AnimationState                = FIRING_OR_PREATTACK_A
            Animation
                AnimationName        = CHCM_CM_U_ATKA
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
            End
            Animation
                AnimationName        = CHCM_CM_U_ATKB
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
            End
            Animation
                AnimationName        = CHCM_CM_U_ATKC
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
            End
        End






        AnimationState = EMOTION_ALERT HIT_REACTION WEAPONSET_TOGGLE_1
            Animation
                AnimationName = CHCM_CM_B_HITA
                AnimationMode = ONCE
            End
        End

        AnimationState = HIT_REACTION WEAPONSET_TOGGLE_1
            Animation
                AnimationName = CHCM_CM_B_HITA
                AnimationMode = ONCE
            End
        End

        AnimationState = HIT_REACTION
            Animation = Sword_HITA
                AnimationName = CHCM_CM_U_HITA
                AnimationMode = ONCE
            End
            Animation = Sword_HITB
                AnimationName = CHCM_CM_U_HITB
                AnimationMode = ONCE
            End

            BeginScript
                PrevAnim = CurDrawablePrevAnimation()
                if PrevAnim == "Foot_IDLB"
                then
                    return "Sword_HITB"
                else
                    return "Swort_HITA"
                end
            EndScript
        End



        AnimationState          =    THROWN_PROJECTILE
            Animation
                AnimationName =    CHCM_CM_U_LEP2
                AnimationMode =    LOOP
            End
        End

        AnimationState          =    ABOUT_TO_HIT
            Animation
                AnimationName =    CHCM_CM_U_LEP3
                AnimationMode =    ONCE
            End
        End

        AnimationState                = SPECIAL_POWER_1
            StateName                = STATE_ready
            Animation
                AnimationName        = CHCM_CM_U_SPCA
                AnimationMode        = ONCE
            End
        End


        AnimationState          =    SPECIAL_WEAPON_ONE
            StateName          =    Attacking
            Animation
                AnimationName =    CHCM_CM_B_ATKA
                AnimationMode =    ONCE
            End
        End

        AnimationState          =    SPECIAL_WEAPON_ONE WEAPONSET_TOGGLE_1
            StateName          =    Attacking
            Animation
                AnimationName =    CHCM_CM_B_ATKA
                AnimationMode =    ONCE
            End
        End

        AnimationState          =    SPECIAL_WEAPON_TWO
            StateName          =    Attacking
            Animation
                AnimationName =    CHCM_CM_U_SPCB
                AnimationMode =    ONCE
            End
        End


        AnimationState          =    SPECIAL_WEAPON_THREE
            StateName          =    Attacking
            Animation          =    StaffLaser
                AnimationName =    CHCM_CM_U_SPCE
                AnimationMode =    ONCE
            End
        End



        AnimationState          =    PACKING_TYPE_1 UNPACKING
            StateName          =    Attacking
            Animation          =    LightningSwordStart
                AnimationName =    CHCM_CM_U_SPCC
                AnimationMode =    ONCE
            End
        End

        AnimationState          =    PACKING_TYPE_1 PREPARING
            StateName          =    Attacking
            Animation          =    LightningSwordLoop
                AnimationName =    CHCM_CM_U_SPCA
                AnimationMode =    LOOP
            End
        End

        AnimationState          =    PACKING_TYPE_1 PACKING
            StateName          =    Attacking
            Animation          =    LightningSwordPutAway
                AnimationName =    CHCM_CM_U_SPCB
                AnimationMode =    ONCE
            End
        End


        AnimationState          =    PACKING_TYPE_2 CREATE_A_HERO_20 CREATE_A_HERO_21
            Animation
                AnimationName =    CHCM_CM_U_SPCC
                AnimationMode =    LOOP
            End
        End


        AnimationState          =    PACKING_TYPE_2 UNPACKING
            StateName          =    Attacking
            Animation          =    LightningSwordStart
                AnimationName =    CHCM_CM_U_SPCC
                AnimationMode =    ONCE
            End
        End

        AnimationState          =    PACKING_TYPE_2 PREPARING
            StateName          =    Attacking
            Animation          =    LightningSwordLoop
                AnimationName =    CHCM_CM_U_SPCA
                AnimationMode =    LOOP
            End
        End

        AnimationState          =    PACKING_TYPE_2 PACKING
            StateName          =    Attacking
            Animation          =    LightningSwordPutAway
                AnimationName =    CHCM_CM_U_SPCB
                AnimationMode =    ONCE
            End
        End


        AnimationState        = PACKING_TYPE_2 WEAPONSET_TOGGLE_1
            StateName          =    CaptainPower
            Animation           = GUHero_CHRC
                AnimationName     = CHCM_CM_U_CHRC
                AnimationMode     = ONCE
                AnimationSpeedFactorRange = 1.2 1.2
            End
        End


        AnimationState        = PACKING_TYPE_2
            StateName          =    STATE_CaptainBow
            Animation           = GUHero_CHRD
                AnimationName     = CHCM_CM_U_SPCE
                AnimationMode     = ONCE

            End
        End



        AnimationState                = LEVELED WEAPONSET_TOGGLE_1
            Animation                = LevelUp
                AnimationName        = CHCM_CM_B_LVLA
                AnimationMode        = ONCE
            End
        End

        AnimationState                = LEVELED
            Animation                = LevelUp
                AnimationName        = CHCM_CM_U_LVLA
                AnimationMode        = ONCE
            End
        End





        AnimationState                =    EMOTION_CELEBRATING WEAPONSET_TOGGLE_1
            Animation
                AnimationName        =    CHCM_CM_B_CHRA
                AnimationMode        =    ONCE
            End
            Flags                    =    RESTART_ANIM_WHEN_COMPLETE
        End


        AnimationState                =    EMOTION_CELEBRATING
            Animation CHRA
                AnimationName        =    CHCM_CM_U_CHRA
                AnimationMode        =    ONCE
            End
            Animation CHRB
                AnimationName        =    CHCM_CM_U_CHRB
                AnimationMode        =    ONCE
            End
            Flags                    =    RESTART_ANIM_WHEN_COMPLETE
        End


        AnimationState                =    RAISING_FLAG WEAPONSET_TOGGLE_1
            Animation
                AnimationName        =    CHCM_CM_B_CHRA
                AnimationMode        =    ONCE
            End
            Flags                    =    RESTART_ANIM_WHEN_COMPLETE
        End


        AnimationState                =    RAISING_FLAG
            Animation CHRA
                AnimationName        =    CHCM_CM_U_CHRA
                AnimationMode        =    ONCE
            End
            Animation CHRB
                AnimationName        =    CHCM_CM_U_CHRB
                AnimationMode        =    ONCE
            End
            Flags                    =    RESTART_ANIM_WHEN_COMPLETE
        End



        AnimationState                =    EMOTION_TAUNTING WEAPONSET_TOGGLE_1
            Animation
                AnimationName        =    CHCM_CM_B_TNTA
                AnimationMode        =    ONCE
            End
            Flags                    =    RESTART_ANIM_WHEN_COMPLETE
        End


        AnimationState                =    EMOTION_TAUNTING
            Animation CHRA
                AnimationName        =    CHCM_CM_U_TNTA
                AnimationMode        =    ONCE
            End
            Animation CHRB
                AnimationName        =    CHCM_CM_U_TNTB
                AnimationMode        =    ONCE
            End
            Flags                    =    RESTART_ANIM_WHEN_COMPLETE
        End


        AnimationState                = ENGAGED WEAPONSET_TOGGLE_1
            StateName                = STATE_ready
            Animation
                AnimationName        = CHCM_CM_B_IDLA
                AnimationMode        = ONCE
            End
        End
        AnimationState                = ENGAGED
            StateName                = STATE_ready
            Animation
                AnimationName        = CHCM_CM_U_IDLA
                AnimationMode        = ONCE
            End
        End
        AnimationState                = BETWEEN_FIRING_SHOTS_A WEAPONSET_TOGGLE_1
            StateName                = STATE_ready
            Animation
                AnimationName        = CHCM_CM_B_IDLA
                AnimationMode        = ONCE
            End
        End
        AnimationState                = BETWEEN_FIRING_SHOTS_A
            StateName                = STATE_ready
            Animation
                AnimationName        = CHCM_CM_U_IDLA
                AnimationMode        = ONCE
            End
        End



        AnimationState = SELECTED WEAPONSET_TOGGLE_1
            StateName                = STATE_Selected_Bow
            Animation                = Selected_Loop
                AnimationName        = CHCM_CM_B_ATNB
                AnimationMode        = LOOP
                AnimationBlendTime    = 10
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Idle_Bow" then CurDrawableSetTransitionAnimState("TRANS_BoredToSelectedBow") end
            EndScript
            Flags = RESTART_ANIM_WHEN_COMPLETE
        End

        AnimationState = SELECTED
            StateName                = STATE_Selected_Sword
            Animation                = Selected_Loop
                AnimationName        = CHCM_CM_U_ATNB
                AnimationMode        = LOOP
                AnimationBlendTime    = 10
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Idle_Sword" then CurDrawableSetTransitionAnimState("TRANS_BoredToSelectedSword") end
            EndScript
            Flags = RESTART_ANIM_WHEN_COMPLETE
        End


        AnimationState                = WEAPONSET_TOGGLE_1
            StateName                = STATE_Idle_Bow
            Animation
                AnimationName        =    CHCM_CM_B_IDLA
                AnimationPriority    =    20
                AnimationMode        =    ONCE
                AnimationBlendTime    =    15
            End
            Flags                =    RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Idle_Sword" then CurDrawableSetTransitionAnimState("TRANS_SwordToBow") end
            EndScript
        End

    End


    Draw = W3DScriptedModelDraw Icon
        ModelConditionState = NONE
            Model           = bbox
        End
    End


    #include "..\..\..\includes\StunDrawModuleSmall.inc"


    Side = Lothlorien
    EditorSorting       = UNIT
    ThreatLevel         = THARANDUIL_THREAT_LEVEL
    ThingClass          = CHARACTER_UNIT
    BuildCost           = THRANDUILDAG_COST
    BuildTime           = MEDIUM_HERO_BUILDTIME

    TransportSlotCount    = TRANSPORTSLOTCOUNT_HERO
    MaxSimultaneousOfType = 1
    DisplayMeleeDamage  = THRANDUILDAG_DAMAGE
    IsTrainable         = No
    DisplayRangedDamage = THRANDUILDAG_DAMAGE

    WeaponSet
        Conditions        = None
        Weapon            = PRIMARY    ThranduilSwordWeapon
        AutoChooseSources = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End

    WeaponSet
        Conditions        = WEAPONSET_TOGGLE_1
        Weapon            = PRIMARY    ThranduilBowWeapon
        AutoChooseSources = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End

    ArmorSet
        Conditions      = None
        Armor           = StrongHeroArmor
        DamageFX        = NormalDamageFX
    End


    VisionRange            = VISION_HERO_RANGED
    ShroudClearingRange    = SHROUD_CLEAR_RANGED_HERO

    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = 200
    VisionBonusPercentPerFoot = 1.0%

    BountyValue           = ELVEN_THRANDUIL_BOUNTY_VALUE
    DisplayName           = OBJECT:ElvenThranduil
    RecruitText           = CONTROLBAR:ElvenThranduilRecruit
    ReviveText            = CONTROLBAR:ElvenThranduilRevive
    Hotkey                = CONTROLBAR:ElvenThranduilHotkey
    CrushableLevel        = 2

    CommandSet       = ElvenThranduilCommandSetMod
    CommandPoints    = 0


    HeroSortOrder = 30



    AutoResolveUnitType = AutoResolveUnit_Hero
    AutoResolveCombatChain = AutoResolve_HeroCombatChain

    AutoResolveBody = AutoResolve_ThranduilBody

    AutoResolveArmor
        Armor = AutoResolve_ThranduilArmor
    End

    AutoResolveWeapon
        Weapon = AutoResolve_ThranduilWeapon
    End



    VoiceAttack                             = ThranduilVoiceAttack
    VoiceAttackAir                            = ThranduilVoiceAttack
    VoiceAttackCharge                         = ThranduilVoiceAttackCharge
    VoiceAttackMachine                         = ThranduilVoiceAttack
    VoiceAttackStructure                     = ThranduilVoiceAttackBuilding
    VoiceCreated                                = ThranduilVoiceSalute
    VoiceFullyCreated                             = ThranduilVoiceSalute
    VoiceFear                                = ThranduilVoiceHelpMe
    VoiceGuard                                = ThranduilVoiceMove
    VoiceMove                                 = ThranduilVoiceMove
    VoiceMoveToCamp                         = ThranduilVoiceMoveCamp
    VoiceMoveWhileAttacking                 = ThranduilVoiceDisengage
    VoicePriority                            = 85
    VoiceRetreatToCastle                     = ThranduilVoiceRetreat
    VoiceSelect                             = ThranduilVoiceSelectMS
    VoiceSelectBattle                          = ThranduilVoiceSelectBattle

    SoundImpact                                = ImpactHorse

    UnitSpecificSounds
        VoiceMoveToTrees                    = ThranduilVoiceMoveForest
        VoiceEnterUnitElvenTransportShip    = ThranduilVoiceMoveShip
        VoiceGarrison                        = ThranduilVoiceMoveGarrison
        VoiceInitiateCaptureBuilding        = ThranduilVoiceCaptureBuilding
    End

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound:FootstepDirtA             Animation:GUGandalfG_SKL.GUGandalfG_RUNA        Frames:10 20
        AnimationSound = Sound:FootstepDirtA             Animation:GUGandalfG_SKL.GUGandalfG_RUNB        Frames:10 22 33 45
        AnimationSound = Sound:BodyFallGenericNoArmor    Animation:GUGandalfG_SKL.GUGandalfG_DIEB        Frames:63
        AnimationSound = Sound:BodyFallGenericNoArmor    Animation:GUGandalfG_SKL.GUGandalfG_LNDA        Frames:2
    End

    CrowdResponseKey = ElfHero

    Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
        Key = Humanoid_Male Elf Elf_Male Unit Infantry Hero
    End

    #include "..\..\..\includes\StandardUnitEvaEvents.inc"
    EvaEventDieOwner            = ThranduilDie

    Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance                = 200
        TauntAndPointUpdateDelay            = 2000
        PointAt                                = ANY +HERO
        AddEmotion            =    Doom_Base



        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
         AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base


        AddEmotion            =    Alert_Base
        AddEmotion            =    CheerForAboutToCrush_Base
    End



    RadarPriority = UNIT
    KindOf = HERO PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE THROWN_OBJECT ARMY_SUMMARY ATTACK_NEEDS_LINE_OF_SIGHT HEAVY_MELEE_HITTER NOTIFY_OF_PREATTACK SUMMONED
    PathfindDiameter = 40.0
    CamouflageDetectionMultiplier = CAMOUFLAGE_DETECTION_DISTANCE_MEDIUM


    Body = RespawnBody ModuleTag_RespawnBody
        CheerRadius                 = EMOTION_CHEER_RADIUS
        MaxHealth                   = THRANDUILDAG_HEALTH
        PermanentlyKilledByFilter   = NONE
        DodgePercent                = HERO_DODGE_PERCENT
    End







    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_TheodenGloriousChargeEnabler
        SpecialPowerTemplate      = SpecialAbilityTheodenGloriousCharge
        TriggeredBy               = Upgrade_Level_3
    End

    Behavior = SpecialPowerModule ModuleTag_TheodenGloriousChargeUpdate
        SpecialPowerTemplate      = SpecialAbilityTheodenGloriousCharge
        UpdateModuleStartsAttack  = Yes
        StartsPaused = Yes
        AttributeModifier = KonigDusterwaldsModifier
        AttributeModifierRange = 300
        AttributeModifierAffectsSelf = No
        AttributeModifierAffects = ANY +MirkwoodElkrider +MirkwoodWarrior +MirkwoodArcher +MirkwoodSpearmen +MirkwoodAvariWarrior +ElvenMirkwoodArcher +LothlorienMirkwoodPalaceGuard ALLIES
        AttributeModifierFX = FX_TheodenGloriousChargeFX
    End

    Behavior = SpecialAbilityUpdate ModuleTag_GloriousChargeAnimation
        UnpackTime                = 1000
        UnpackingVariation        = 1
        SpecialPowerTemplate      = SpecialAbilityTheodenGloriousCharge
        PreparationTime           = 0
        PersistentPrepTime        = 0
        PackTime                  = 1330
     End







    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_ThornArrowEnabler
        SpecialPowerTemplate        = SpecialAbilityThornVengeance
        TriggeredBy                 = Upgrade_Level_5
    End

    Behavior = SpecialPowerModule ModuleTag_ThornArrow
        SpecialPowerTemplate        = SpecialAbilityThornVengeance
        UpdateModuleStartsAttack    = Yes
        StartsPaused                = Yes
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_ThornArrowUpdate
        SpecialPowerTemplate        = SpecialAbilityThornVengeance
        SkipContinue                = Yes
        UnpackTime                  = 1600
        PreparationTime             = 2
        PackTime                    = 850
        AwardXPForTriggering        = 0
        StartAbilityRange           = 325.0
        ApproachRequiresLOS         = Yes
        SpecialWeapon               = ThranduilThornofVengeance
        WhichSpecialWeapon          = 1
    End

    Behavior = AutoAbilityBehavior ModuleTag_ThornArrowAutoAbility
        SpecialAbility              = SpecialAbilityThornVengeance
        MaxScanRange                = 300
        Query                       = 1 ANY ENEMIES +HERO +MONSTER
        Query                       = 1 ALL ENEMIES
    End







    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_SummonEnabler
        SpecialPowerTemplate     = SpecialAbilityDieSpeereDusterwalds
        TriggeredBy              = Upgrade_Level_7
    End

    Behavior = OCLSpecialPower ModuleTag_OCLSpecialPower
        SpecialPowerTemplate     = SpecialAbilityDieSpeereDusterwalds
        OCL                      = OCL_SpawnMirkwoddSpearmenEgg
        CreateLocation           = CREATE_AT_LOCATION
        TriggerFX                = FX_ElvenAlliesSummon
        StartsPaused             = Yes


    End







    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_ReinigungnEnabler
        SpecialPowerTemplate    = SpecialAbilityReinigungnordlicheWalder
        TriggeredBy             = Upgrade_Level_10
    End

    Behavior = OCLSpecialPower ModuleTag_ReinigungOCLSpecialPower
        SpecialPowerTemplate    = SpecialAbilityReinigungnordlicheWalder
        OCL                     = OCL_ThranduilWoodSeed
        TriggerFX               = FX_ThranduilWoodSpellFX
        CreateLocation          = CREATE_AT_LOCATION
        StartsPaused            = Yes
        SetModelCondition       = ModelConditionState:USER_1
        SetModelConditionTime   = 8.1
    End





    Behavior = AutoHealBehavior ModuleTag_LegolasHealing
        StartsActive            = Yes
        HealingAmount           = HERO_HEAL_AMOUNT
        HealingDelay            = 1000
        StartHealingDelay       = HERO_HEAL_DELAY
        HealOnlyIfNotInCombat   = Yes
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = Hero
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = AIUpdateInterface ModuleTag_04
        AutoAcquireEnemiesWhenIdle = Yes ATTACK_BUILDINGS
        AILuaEventsList            = GandalfFunctions
    End

    LocomotorSet
        Locomotor = HeroHumanLocomotor
        Condition = SET_NORMAL
        Speed     = NORMAL_GOOD_HERO_SPEED
    End

    Behavior = PhysicsBehavior ModuleTag_09
        GravityMult = 1.0
    End

    Behavior = SlowDeathBehavior ModuleTag_05
        DeathTypes = ALL -KNOCKBACK
        SinkDelay = 3000
        SinkRate = 0.40
        DestructionDelay = 8000
        Sound = INITIAL ThranduilVoiceDie
        DeathFlags = DEATH_1
    End

    Behavior = SlowDeathBehavior ModuleTag_FadeDeath
        DeathTypes = NONE +FADED
        FadeDelay = 0
        FadeTime = 2500
        DestructionDelay = 2500
        Sound = INITIAL SpellGenericUnsummonFasterMS
        DeathFlags = DEATH_2
    End

    Behavior = ExperienceLevelCreate ModuleTag_MPLevelBonus
        LevelToGrant = 7
    End

    Behavior = LifetimeUpdate ModuleTag_LifetimeUpdate
        MinLifetime        = 120000
        MaxLifetime        = 120000
        DeathType        = FADED
    End

    Behavior = SquishCollide ModuleTag_06

    End

    Behavior = SlowDeathBehavior ModuleTag_07

        DeathTypes = NONE +KNOCKBACK
        SinkDelay = 3000
        SinkRate = 0.40
        DestructionDelay = 8000
    End

    Behavior = BezierProjectileBehavior ModuleTag_08

        FirstHeight                    = 24
        SecondHeight                = 24
        FirstPercentIndent            = 30%
        SecondPercentIndent            = 70%
        TumbleRandomly                = Yes

        CrushStyle                    = Yes
        DieOnImpact                    = Yes
        BounceCount                    = 1
        BounceDistance                = 40
        BounceFirstHeight            = 24
        BounceSecondHeight            = 24
        BounceFirstPercentIndent    = 20%
        BounceSecondPercentIndent    = 80%

        GroundHitFX                    = FX_ThrownRockGroundHit
        GroundBounceFX                = FX_ThrownRockBounceHit
    End


    Behavior = AttributeModifierUpgrade ModuleTag_ElvenGiftBonus
        TriggeredBy = Upgrade_ElvenGift
        AttributeModifier = SpellBookElvenGifts
    End

    Behavior = HitReactionBehavior HitReactionBehaviorModuleTag
        HitReactionLifeTimer1 = 1993
        HitReactionLifeTimer2 = 1993
        HitReactionLifeTimer3 = 1993

        HitReactionThreshold1 = 5.0
        HitReactionThreshold2 = 25.0
        HitReactionThreshold3 = 50.0


    End


    Behavior = AttributeModifierUpgrade ModuleTag_Bonus
        TriggeredBy                = Upgrade_HerrinLicht
        AttributeModifier          = SpellBookWaffenderNoldor
    End





    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End


    Behavior = AISpecialPowerUpdate MoveUnseenAI
        CommandButtonName = Command_SpecialAbilityMoveUnseen
        SpecialPowerAIType = AI_SPECIAL_POWER_GIVEXP_AOE
        SpecialPowerRadius = 250
    End

    Behavior = AISpecialPowerUpdate ElfCloakAI
        CommandButtonName = Command_SpecialAbilityElfCloakThranduil
        SpecialPowerAIType = AI_SPECIAL_POWER_BASIC_SELF_BUFF
    End

    Behavior = AISpecialPowerUpdate DeadEyeAI
        CommandButtonName = Command_SpecialAbilityDeadEye
        SpecialPowerAIType = AI_SPECIAL_POWER_BASIC_SELF_BUFF
    End

    Behavior = AISpecialPowerUpdate ThornOfVengeanceAI
        CommandButtonName = Command_SpecialAbilityThornofVengeance
        SpecialPowerAIType = AI_SPECIAL_POWER_ENEMY_TYPE_KILLER
    End

    Geometry = CYLINDER
    GeometryMajorRadius = 8.0
    GeometryMinorRadius = 8.0
    GeometryHeight = 19.2
    GeometryIsSmall = Yes
    Shadow = SHADOW_DECAL
    ShadowSizeX = 19
    ShadowSizeY = 19
    ShadowTexture = ShadowI
End


ChildObject ElvenThranduil ElvenThranduil_mod
End

