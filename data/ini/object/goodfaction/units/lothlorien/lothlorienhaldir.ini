Object LothlorienHaldir

    SelectPortrait     = HPHaldirNew
    ButtonImage        = HIHaldir

    DescriptionStrategic = CONTROLBAR:LW_ToolTip_LeaderHero

    Draw = W3DScriptedModelDraw ModuleTag_DRAW

		DefaultModelConditionState
			Model				= euhaldir_lightb
			Skeleton			= EUHaldir_SKL
		End

		ModelConditionState			= WEAPONSET_TOGGLE_1 USER_4
			Model				= euhaldir_ha
			Skeleton			= EUHaldir_SKL
			WeaponLaunchBone		= PRIMARY ARROW
		End

		ModelConditionState			= USER_4
			Model				= euhaldir_hab
			Skeleton			= EUHaldir_SKL
		End

		ModelConditionState			= WEAPONSET_TOGGLE_1
			Model				= euhaldir_lighta
			Skeleton			= EUHaldir_SKL
		End

		ModelConditionState			= USER_4 RIDER1
			Model				= euhaldir_ha
			ParticleSysBone 		= BAT_SPINE1 BladeOfPurity FollowBone:Yes
		End

		ModelConditionState			= RIDER1
			ParticleSysBone 		= BAT_SPINE1 BladeOfPurity FollowBone:Yes
		End

        ModelConditionState    = INVISIBLE_STEALTH
            ParticleSysBone    = NONE Predator FollowBone:Yes Persist:SPAWN PersistID:100
            ParticleSysBone    = NONE Predator02 FollowBone:Yes Persist:SPAWN PersistID:100
        End






        AnimationState                    = PASSENGER WEAPONSET_TOGGLE_1
            StateName                    = STATE_Grabbed
            Animation                    = Sword
                AnimationName            = EUHaldir_FLYB
                AnimationMode            = LOOP
            End
        End

        AnimationState                    = PASSENGER
            StateName                    = STATE_Grabbed
            Animation                    = Bow
                AnimationName            = EUHaldir_FLYA
                AnimationMode            = LOOP
            End
        End

        AnimationState                    = FREEFALL WEAPONSET_TOGGLE_1
            StateName                    = STATE_Falling
            Animation                    = Sword
                AnimationName            = EUHaldir_FLYB
                AnimationMode            = LOOP
                AnimationBlendTime        = 10
                AnimationSpeedFactorRange    = 0.24    0.24
            End
        End

        AnimationState                    = FREEFALL
            StateName                    = STATE_Falling
            Animation                    = Bow
                AnimationName            = EUHaldir_FLYA
                AnimationMode            = LOOP
                AnimationBlendTime        = 10
                AnimationSpeedFactorRange    = 0.5    0.5
            End
        End

        AnimationState                    = STUNNED_FLAILING WEAPONSET_TOGGLE_1
            StateName                    = STATE_Fly
            Animation                   = Sword
                AnimationName           = EUHaldir_FLYB
                AnimationMode           = LOOP
            End
            Flags                        = MAINTAIN_FRAME_ACROSS_STATES2
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                PrevAnim = CurDrawablePrevAnimation()
                if PrevState == "Ready_Bow" or PrevState == "Moving_Bow" or PrevState == "Bored_Bow"
                then
                    CurDrawableShowSubObject("arrow")
                    CurDrawableShowSubObject("arrownock")
                    return "WantSword"
                elseif PrevState == "STATE_Fly"
                then
                    if PrevAnim == "Bow" or PrevAnim == "WantSword"
                    then
                        CurDrawableShowSubObject("arrow")
                        CurDrawableShowSubObject("arrownock")
                        return "WantSword"
                    end
                end

                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
                return "Sword"
            EndScript
        End

        AnimationState                    = STUNNED_FLAILING
            StateName                    = STATE_Fly
            Animation
                AnimationName           = EUHaldir_FLYA
                AnimationMode           = LOOP
            End
            Flags                        = MAINTAIN_FRAME_ACROSS_STATES2
        End

        AnimationState                    = DYING DEATH_1 SPLATTED WEAPONSET_TOGGLE_1
            StateName                    = STATE_Dead
            Animation                    = Sword
                AnimationName            = EUHaldir_LNDB
                AnimationMode            = ONCE
            End
        End

        AnimationState                    = DYING DEATH_1 SPLATTED
            StateName                    = STATE_Dead
            Animation                    = Bow
                AnimationName            = EUHaldir_LNDA
                AnimationMode            = ONCE
            End
        End



        AnimationState                    = DYING DEATH_1 WEAPONSET_TOGGLE_1
            Animation                        = Sword1
                AnimationName                = EUHaldir_DIESv5
                AnimationMode                = ONCE
            End
            Animation                        = Sword2
                AnimationName                = EUHaldir_DIESV5
                AnimationMode                = ONCE
            End
            Animation                        = WantSword
                AnimationName                = EUHaldir_LNDB
                AnimationMode                = ONCE
            End

            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                PrevAnim = CurDrawablePrevAnimation()
                if PrevState == "STATE_Fly"
                then
                    CurDrawableShowSubObject("arrow")
                    CurDrawableShowSubObject("arrownock")
                    return "WantSword"
                end

                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
                if GetClientRandomNumberReal(0,2) < 1
                then
                    return "Sword1"
                else
                    return "Sword2"
                end
            EndScript
        End

        AnimationState                    = DYING DEATH_2 WEAPONSET_TOGGLE_1
            Animation                   = FadeOut
                AnimationName           = EUHaldir_IDLF
                AnimationMode           = LOOP
            End
        End

        AnimationState                    = DYING DEATH_1
            Animation                        = Bow1
                AnimationName                = EUHaldir_DIEBV5
                AnimationMode                = ONCE
            End
            Animation                        = Bow2
                AnimationName                = EUHaldir_DIEBV5
                AnimationMode                = ONCE
            End
            Animation                        = WantBow
                AnimationName                = EUHaldir_LNDA
                AnimationMode                = ONCE
            End
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                PrevAnim = CurDrawablePrevAnimation()

                if PrevState == "STATE_Fly"
                then
                    CurDrawableHideSubObject("ArrowNock")
                    CurDrawableHideSubObject("arrow")
                    return "WantBow"
                end

                if GetClientRandomNumberReal(0,2) < 1
                then
                    CurDrawableShowSubObject("arrow")
                    CurDrawableShowSubObject("arrownock")
                    return "Bow1"
                else
                    CurDrawableShowSubObject("arrow")
                    CurDrawableShowSubObject("arrownock")
                    return "Bow2"
                end
            EndScript
        End

        AnimationState                    = DYING DEATH_2
            Animation                        = FadeOut
                AnimationName                = EUHaldir_IDLE
                AnimationMode                = ONCE
            End
        End


        AnimationState                    = STUNNED_STANDING_UP WEAPONSET_TOGGLE_1
            StateName                    = STATE_GetUp
            Animation                        = Sword
                AnimationName                = EUHaldir_GTPSX1
                AnimationMode                = ONCE
                AnimationSpeedFactorRange    = 1.2    1.2
            End
            Animation                        = WantSword
                AnimationName                = EUHaldir_GTPB
                AnimationMode                = ONCE
            End
            Flags                        = MAINTAIN_FRAME_ACROSS_STATES4
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                PrevAnim = CurDrawablePrevAnimation()
                if PrevState == "STATE_GetUp" or PrevState == "STATE_Land"
                then
                    if PrevAnim == "Bow" or PrevAnim == "WantSword"
                    then
                        CurDrawableShowSubObject("arrow")
                        CurDrawableShowSubObject("arrownock")
                        return "WantSword"
                    end
                end

                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
                return "Sword"
            EndScript
        End



        AnimationState                    = STUNNED_STANDING_UP
            StateName                    = STATE_GetUp
            Animation                        = Bow
                AnimationName                = EUHaldir_GTPB
                AnimationMode                = ONCE
                AnimationSpeedFactorRange    = 1.42 1.42
            End
            Animation                        = WantBow
                AnimationName                = EUHaldir_GTPSX1
                AnimationMode                = ONCE
            End
            Flags                        = MAINTAIN_FRAME_ACROSS_STATES4
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                PrevAnim = CurDrawablePrevAnimation()
                if PrevState == "STATE_GetUp" or PrevState == "STATE_Land"
                then
                    if PrevAnim == "WantBow" or PrevAnim == "Sword"
                    then
                        CurDrawableHideSubObject("ArrowNock")
                        CurDrawableHideSubObject("arrow")
                        return "WantBow"
                    end
                else
                    CurDrawableShowSubObject("arrow")
                    CurDrawableShowSubObject("arrownock")
                    return "Bow"
                end
            EndScript
        End

        AnimationState                    = STUNNED WEAPONSET_TOGGLE_1
            StateName                    = STATE_Land
            Animation                        = Sword
                AnimationName                = EUHaldir_LNDB
                AnimationMode                = ONCE
            End
            Animation                        = WantSword
                AnimationName                = EUHaldir_LNDA
                AnimationMode                = ONCE
            End
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                PrevAnim = CurDrawablePrevAnimation()
                if PrevState == "STATE_Fly"
                then
                    if PrevAnim == "WantSword" or PrevAnim == "Bow"
                    then
                        CurDrawableShowSubObject("arrow")
                        CurDrawableShowSubObject("arrownock")
                        return "WantSword"
                    end
                end
                Flags                        = MAINTAIN_FRAME_ACROSS_STATES3
                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
                return "Sword"
            EndScript
        End

        AnimationState                    = STUNNED
            StateName                    = STATE_Land
            Animation                        = Bow
                AnimationName                = EUHaldir_LNDA
                AnimationMode                = ONCE
            End
            Animation                        = WantBow
                AnimationName                = EUHaldir_LNDB
                AnimationMode                = ONCE
            End
            Flags                        = MAINTAIN_FRAME_ACROSS_STATES3
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                PrevAnim = CurDrawablePrevAnimation()
                if PrevState == "STATE_Fly"
                then
                    if PrevAnim == "WantBow" or PrevAnim == "Sword"
                    then
                        CurDrawableHideSubObject("ArrowNock")
                        CurDrawableHideSubObject("arrow")
                        return "WantBow"
                    end
                end

                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("arrownock")
                return "Bow"
            EndScript
        End





        AnimationState                    = FIRING_OR_PREATTACK_A WEAPONSET_TOGGLE_1
            StateName                        = Ready_Sword

            Animation                        = AttackWithSwordA
                AnimationName                = EUHaldir_ATKSV2
                AnimationMode                = ONCE
                UseWeaponTiming                = Yes
            End
            Animation                        = AttackWithSwordB
                AnimationName                = EUHaldir_ATKSV2
                AnimationMode                = ONCE
                UseWeaponTiming                = Yes
            End
            Animation                        = AttackWithSwordD
                AnimationName                = EUHaldir_ATKSV4
                AnimationMode                = ONCE
                UseWeaponTiming                = Yes
            End
            BeginScript
                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
            EndScript
        End

        AnimationState                        = FIRING_OR_PREATTACK_A
            StateName                        = Attacking_Bow
            Animation
                AnimationName                = EUHaldir_ATA2
                AnimationMode                = ONCE
                UseWeaponTiming                = Yes
                AnimationBlendTime            = 20
            End
            BeginScript
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("ArrowNock")
            EndScript
        End


        AnimationState                    = PREATTACK_A
            Animation                        = ReadyToDrawn
                AnimationName                = EUHaldir_ATA1
                AnimationMode                = ONCE
                AnimationBlendTime            = 0
                UseWeaponTiming                = Yes
            End
            BeginScript
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("ArrowNock")
            EndScript
        End

        AnimationState                    = FIRING_OR_RELOADING_A
            StateName                        = STATE_Firing
            Animation
                AnimationName                = EUHaldir_ATA2
                AnimationMode                = ONCE
                AnimationBlendTime            = 30
                UseWeaponTiming                = Yes
                AnimationSpeedFactorRange    = 1.5 1.5
            End
            Flags                            = START_FRAME_FIRST
            BeginScript
                CurDrawableHideSubObject("arrow")
                CurDrawableHideSubObject("ArrowNock")
            EndScript
        End





        AnimationState                    = MOVING BACKING_UP WEAPONSET_TOGGLE_1
            StateName                        = STATE_BackingUp
            Animation                        = Sword
                AnimationName                = EUHaldir_BAKS
                AnimationMode                = LOOP
            End
            Animation                        = WantSword
                AnimationName                = EUHaldir_BAKS
                AnimationMode                = LOOP
            End
            Flags                            = MAINTAIN_FRAME_ACROSS_STATES4
            BeginScript
                CurDrawableHideSubObject("ARROW")
                CurDrawableHideSubObject("ARROWNOCK")
                PrevAnim    = CurDrawablePrevAnimation()
                PrevState    = CurDrawablePrevAnimationState()
                if PrevState == "STATE_BackingUp"
                then
                    if PrevAnim == "Bow" or PrevAnim == "WantSword"
                    then
                        return "WantSword"
                    end
                end
                return "Sword"
            EndScript
        End

        AnimationState                    = MOVING BACKING_UP
            StateName                        = STATE_BackingUp
            Animation                        = Bow
                AnimationName                = EUHaldir_BAKB
                AnimationMode                = LOOP
            End
            Animation                        = WantBow
                AnimationName                = EUHaldir_BAKS
                AnimationMode                = LOOP
            End
            Flags                            = MAINTAIN_FRAME_ACROSS_STATES4
            BeginScript
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("arrownock")
                PrevAnim    = CurDrawablePrevAnimation()
                PrevState    = CurDrawablePrevAnimationState()
                if PrevState == "STATE_BackingUp"
                then
                    if PrevAnim == "WantBow" or PrevAnim == "Sword"
                    then
                        return "WantBow"
                    end
                end
                return "Bow"
            EndScript
        End



        AnimationState                    = MOVING WEAPONSET_TOGGLE_1
            StateName                        = Moving_Sword
            Animation
                AnimationName                = EUHaldir_RUNS
                AnimationMode                = LOOP
            End
            Flags = RANDOMSTART
            BeginScript
                CurDrawableHideSubObject("arrow")
                CurDrawableHideSubObject("arrownock")
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Moving_Bow" then CurDrawableSetTransitionAnimState("TRANS_BowToSword_Moving") end
            EndScript
        End

        AnimationState                    = MOVING
            StateName                        = Moving_Bow
            Animation
                AnimationName                = EUHaldir_RUNB
                AnimationMode                = LOOP
            End
            Flags = RANDOMSTART
            BeginScript
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("arrownock")
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Moving_Sword" then CurDrawableSetTransitionAnimState("TRANS_SwordToBow_Moving") end
            EndScript
        End

        AnimationState                        = SPECIAL_WEAPON_ONE
            Animation
                AnimationName                = EUHaldir_SPCA
                AnimationMode                = ONCE
            End
            FrameForPristineBonePositions    = 60
            BeginScript
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("arrownock")
            EndScript
        End



        AnimationState                    = CONTINUOUS_FIRE_MEAN
            Animation                        = HangFrameWhileCoasting
                AnimationName                = EUHaldir_ATA2
                AnimationMode                = MANUAL
                AnimationBlendTime            = 20
            End
            Flags                            = START_FRAME_LAST
            BeginScript
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("ARROWNOCK")
                if CurDrawablePrevAnimationState() == "STATE_Firing" then CurDrawableAllowToContinue() end
            EndScript
        End
        AnimationState                        = CONTINUOUS_FIRE_SLOW
            StateName                        = Ready_Bow
            Animation                        = PutAwayArrow
                AnimationName                = EUHaldir_ATA3
                AnimationMode                = ONCE
            End
            BeginScript
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("ARROWNOCK")
            EndScript
        End






        AnimationState                    = EMOTION_ALERT WEAPONSET_TOGGLE_1
            StateName                    = Ready_Sword
            Animation                        = Alert_1
                AnimationName                = EUHaldir_IDLST1
                AnimationMode                = LOOP
            End
            BeginScript
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
                if Prev == "Bored_Sword"        then CurDrawableSetTransitionAnimState("TRANS_BR_Sword")            end
                if Prev == "Selected_Sword"        then CurDrawableSetTransitionAnimState("TRANS_SR_Sword")            end
                if Prev == "Selected_Bow" or Prev == "Moving_Bow" or Prev == "Ready_Bow" or Prev == "Bored_Bow" or PrevAnim == "WantSword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BowToSword_Ready")
                end
            EndScript
        End
        AnimationState                    = ENGAGED WEAPONSET_TOGGLE_1
            StateName                    = Ready_Sword
            Animation                        = Alert_1
                AnimationName                = EUHaldir_IDLST1
                AnimationMode                = LOOP
            End
            BeginScript
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
                if Prev == "Bored_Sword"        then CurDrawableSetTransitionAnimState("TRANS_BR_Sword")            end
                if Prev == "Selected_Sword"        then CurDrawableSetTransitionAnimState("TRANS_SR_Sword")            end
                if Prev == "Selected_Bow" or Prev == "Moving_Bow" or Prev == "Ready_Bow" or Prev == "Bored_Bow" or PrevAnim == "WantSword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BowToSword_Ready")
                end
            EndScript
        End
        AnimationState                    = ATTACKING WEAPONSET_TOGGLE_1
            StateName                    = Ready_Sword
            Animation                        = Alert_1
                AnimationName                = EUHaldir_IDLST1
                AnimationMode                = LOOP
            End
            BeginScript
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("ArrowNock")

                CurDrawableHideSubObject("arrow")
                if Prev == "Bored_Sword"        then CurDrawableSetTransitionAnimState("TRANS_BR_Sword")            end
                if Prev == "Selected_Sword"        then CurDrawableSetTransitionAnimState("TRANS_SR_Sword")            end
                if Prev == "Selected_Bow" or Prev == "Moving_Bow" or Prev == "Ready_Bow" or Prev == "Bored_Bow" or PrevAnim == "WantSword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BowToSword_Ready")
                end
            EndScript
        End

        AnimationState                        = ATTACKING
            StateName                        = Ready_Bow
            Animation                        = IDLB
                AnimationName                = EUHaldir_IDLB
                AnimationMode                = LOOP
            End
            BeginScript
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("arrownock")
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Bored_Bow" then CurDrawableSetTransitionAnimState("TRANS_BR_Bow") end
                if Prev == "Selected_Bow" then CurDrawableSetTransitionAnimState("TRANS_SelectedToReady_Bow") end
                if Prev == "Selected_Sword" or Prev == "Moving_Sword" or Prev == "Ready_Sword" or Prev == "Bored_Sword" or PrevAnim == "WantBow"
                then
                    CurDrawableSetTransitionAnimState("TRANS_SwordToBow_Ready")
                end
            EndScript
        End

        AnimationState                    = EMOTION_ALERT
            StateName                    = Ready_Bow
            Animation                        = IDLB
                AnimationName                = EUHaldir_IDLB
                AnimationMode                = LOOP
            End
            BeginScript
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("arrownock")
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Bored_Bow"        then CurDrawableSetTransitionAnimState("TRANS_BR_Bow")                end
                if Prev == "Selected_Bow"    then CurDrawableSetTransitionAnimState("TRANS_SR_Bow")                end
                if Prev == "Selected_Sword" or Prev == "Moving_Sword" or Prev == "Ready_Sword" or Prev == "Bored_Sword" or PrevAnim == "WantBow"
                then
                    CurDrawableSetTransitionAnimState("TRANS_SwordToBow_Ready")
                end
            EndScript
        End

        AnimationState                    = RAISING_FLAG WEAPONSET_TOGGLE_1
            StateName                    = STATE_Emotion_Sword
            Animation                        = Sword
                AnimationName                = EUHaldir_CHRS
                AnimationMode                = ONCE
            End
            Animation                        = Sword2
                AnimationName                = EUHaldir_CHRS
                AnimationMode                = ONCE
            End
            Flags                        = MAINTAIN_FRAME_ACROSS_STATES RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("arrow")
                CurDrawableHideSubObject("arrownock")

                if PrevState == "STATE_Emotion_Bow"
                then
                    CurDrawableAllowToContinue()
                    if( CurDrawablePrevAnimFraction() > .89 )
                    then
                        CurDrawableSetTransitionAnimState("TRANS_BowToSword_Ready")
                    end
                elseif PrevState == "STATE_Emotion_Sword"
                then
                    CurDrawableAllowToContinue()
                elseif PrevState == "Selected_Sword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_SR_Sword")
                elseif PrevState == "Bored_Sword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BR_Sword")
                end
            EndScript
        End
        AnimationState                    = RAISING_FLAG
            StateName                    = STATE_Emotion_Bow
            Animation                        = Bow
                AnimationName                = EUHaldir_CHRB
                AnimationMode                = ONCE
            End
            Animation                        = Bow2
                AnimationName                = EUHaldir_CHRB
                AnimationMode                = ONCE
            End
            Flags                        = MAINTAIN_FRAME_ACROSS_STATES RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("arrownock")

                if PrevState == "STATE_Emotion_Sword"
                then
                    CurDrawableAllowToContinue()
                    if( CurDrawablePrevAnimFraction() > .89 )
                    then
                        CurDrawableSetTransitionAnimState("TRANS_SwordToBow_Ready")
                    end
                elseif PrevState == "STATE_Emotion_Bow"
                then
                    CurDrawableAllowToContinue()
                elseif PrevState == "Selected_Bow"
                then
                    CurDrawableSetTransitionAnimState("TRANS_SR_Bow")
                end
            EndScript
        End


        AnimationState                    = ENGAGED
            StateName                        = Ready_Bow
            Animation                        = IDLB
                AnimationName                = EUHaldir_IDLB
                AnimationMode                = LOOP
            End
            BeginScript
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("arrownock")
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Bored_Bow"        then CurDrawableSetTransitionAnimState("TRANS_BR_Bow")                end
                if Prev == "Selected_Bow"    then CurDrawableSetTransitionAnimState("TRANS_SelectedToReady_Bow")                end
                if Prev == "Selected_Sword" or Prev == "Moving_Sword" or Prev == "Ready_Sword" or Prev == "Bored_Sword" or PrevAnim == "WantBow"
                then
                    CurDrawableSetTransitionAnimState("TRANS_SwordToBow_Ready")
                end
            EndScript
        End







        AnimationState                    = EMOTION_CELEBRATING WEAPONSET_TOGGLE_1
            StateName                    = STATE_Emotion_Sword
            Animation                        = Sword
                AnimationName                = EUHaldir_CHRS
                AnimationMode                = ONCE
            End
            Animation                        = Sword2
                AnimationName                = EUHaldir_CHRS
                AnimationMode                = ONCE
            End
            Flags                        = MAINTAIN_FRAME_ACROSS_STATES RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("arrow")
                CurDrawableHideSubObject("arrownock")

                if PrevState == "STATE_Emotion_Bow"
                then
                    CurDrawableAllowToContinue()
                    if( CurDrawablePrevAnimFraction() > .89 )
                    then
                        CurDrawableSetTransitionAnimState("TRANS_BowToSword_Ready")
                    end
                elseif PrevState == "STATE_Emotion_Sword"
                then
                    CurDrawableAllowToContinue()
                elseif PrevState == "Selected_Sword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_SR_Sword")
                elseif PrevState == "Bored_Sword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BR_Sword")
                end
            EndScript
        End
        AnimationState                    = EMOTION_CELEBRATING
            StateName                    = STATE_Emotion_Bow
            Animation                        = Bow
                AnimationName                = EUHaldir_CHRB
                AnimationMode                = ONCE
            End
            Animation                        = Bow2
                AnimationName                = EUHaldir_CHRB
                AnimationMode                = ONCE
            End
            Flags                        = MAINTAIN_FRAME_ACROSS_STATES RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("arrownock")

                if PrevState == "STATE_Emotion_Sword"
                then
                    CurDrawableAllowToContinue()
                    if( CurDrawablePrevAnimFraction() > .89 )
                    then
                        CurDrawableSetTransitionAnimState("TRANS_SwordToBow_Ready")
                    end
                elseif PrevState == "STATE_Emotion_Bow"
                then
                    CurDrawableAllowToContinue()
                elseif PrevState == "Selected_Bow"
                then
                    CurDrawableSetTransitionAnimState("TRANS_SR_Bow")
                end
            EndScript
        End



        AnimationState                    = EMOTION_TAUNTING WEAPONSET_TOGGLE_1
            StateName                    = STATE_Emotion_Sword
            Animation                        = Sword
                AnimationName                = EUHaldir_TNTB
                AnimationMode                = ONCE
            End
            Animation                        = Sword2
                AnimationName                = EUHaldir_TNTB
                AnimationMode                = ONCE
            End
            Flags                        = RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("arrow")
                CurDrawableHideSubObject("arrownock")

                if PrevState == "STATE_Emotion_Bow"
                then
                    CurDrawableAllowToContinue()
                    if( CurDrawablePrevAnimFraction() > .89 )
                    then
                        CurDrawableSetTransitionAnimState("TRANS_BowToSword_Ready")
                    end
                elseif PrevState == "STATE_Emotion_Sword"
                    then
                        CurDrawableAllowToContinue()
                elseif PrevState == "Selected_Sword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_SR_Sword")
                elseif PrevState == "Bored_Sword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BR_Sword")
                end
            EndScript
        End
        AnimationState                    = EMOTION_TAUNTING
            StateName                    = STATE_Emotion_Bow
            Animation                        = Bow1
                AnimationName                = EUHaldir_TNTA
                AnimationMode                = ONCE
            End
            Animation                        = Bow2
                AnimationName                = EUHaldir_TNTA
                AnimationMode                = ONCE
            End
            Flags                        = RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("arrownock")

                if PrevState == "STATE_Emotion_Sword"
                then
                    CurDrawableAllowToContinue()
                    if( CurDrawablePrevAnimFraction() > .89 )
                    then
                        CurDrawableSetTransitionAnimState("TRANS_SwordToBow_Ready")
                    end
                elseif PrevState == "STATE_Emotion_Bow"
                then
                    CurDrawableAllowToContinue()
                elseif PrevState == "Selected_Bow"
                then
                    CurDrawableSetTransitionAnimState("TRANS_SR_Bow")
                elseif PrevState == "Bored_Bow"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BR_Bow")
                end
            EndScript
        End



        AnimationState                    = EMOTION_POINTING WEAPONSET_TOGGLE_1
            StateName                    = STATE_Emotion_Sword
            Animation                        = Sword
                AnimationName                = EUHaldir_PNTB
                AnimationMode                = ONCE
            End
            Animation                        = Sword2
                AnimationName                = EUHaldir_PNTB
                AnimationMode                = ONCE
            End
            Flags                        = MAINTAIN_FRAME_ACROSS_STATES RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("arrow")
                CurDrawableHideSubObject("arrownock")

                if PrevState == "STATE_Emotion_Bow"
                then
                    CurDrawableAllowToContinue()
                    if( CurDrawablePrevAnimFraction() > .89 )
                    then
                        CurDrawableSetTransitionAnimState("TRANS_BowToSword_Ready")
                    end
                elseif PrevState == "STATE_Emotion_Sword"
                then
                    CurDrawableAllowToContinue()
                elseif PrevState == "Selected_Sword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_SR_Sword")
                elseif PrevState == "Bored_Sword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BR_Sword")
                end
            EndScript
        End
        AnimationState                    = EMOTION_POINTING
            StateName                    = STATE_Emotion_Bow
            Animation                        = Bow
                AnimationName                = EUHaldir_PNTA
                AnimationMode                = ONCE
            End
            Animation                        = Bow2
                AnimationName                = EUHaldir_PNTA
                AnimationMode                = ONCE
            End
            Flags                        = MAINTAIN_FRAME_ACROSS_STATES RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("arrownock")

                if PrevState == "STATE_Emotion_Sword"
                then
                    CurDrawableAllowToContinue()
                    if( CurDrawablePrevAnimFraction() > .89 )
                    then
                        CurDrawableSetTransitionAnimState("TRANS_SwordToBow_Ready")
                    end
                elseif PrevState == "STATE_Emotion_Bow"
                then
                    CurDrawableAllowToContinue()
                elseif PrevState == "Selected_Bow"
                then
                    CurDrawableSetTransitionAnimState("TRANS_SR_Bow")
                elseif PrevState == "Bored_Bow"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BR_Bow")
                end
            EndScript
        End



        AnimationState                =    SELECTED WEAPONSET_TOGGLE_1
            StateName                =    Selected_Sword
            Animation                        = ATNA
                AnimationName                = EUHaldir_ATNS
                AnimationMode                = LOOP
            End
            BeginScript
                CurDrawableHideSubObject("ARROW")
                CurDrawableHideSubObject("ARROWNOCK")

                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Emotion_Bow" or Prev == "STATE_Emotion_Sword" then CurDrawableAllowToContinue() end
                if Prev == "Bored_Sword"        then CurDrawableSetTransitionAnimState("TRANS_BS_Sword")        end
                if Prev == "Ready_Sword"        then CurDrawableSetTransitionAnimState("TRANS_RS_Sword")        end
                if Prev == "Selected_Bow" or Prev == "Moving_Bow" or Prev == "Ready_Bow" or Prev == "Bored_Bow" or PrevAnim == "WantSword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BowToSword_Selected")
                end

            EndScript
        End

        AnimationState                =    SELECTED
            StateName                        = Selected_Bow
            Animation                        = ATNE
                AnimationName                = EUHaldir_ATNE
                AnimationMode                = LOOP
            End
            BeginScript
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("arrownock")
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Emotion_Bow" or Prev == "STATE_Emotion_Sword" then CurDrawableAllowToContinue() end
                if Prev == "Bored_Bow" then CurDrawableSetTransitionAnimState("TRANS_BoredToSelected_Bow") end
                if Prev == "Ready_Bow" then CurDrawableSetTransitionAnimState("TRANS_RS_Bow") end
                if Prev == "Selected_Sword" or Prev == "Moving_Sword" or Prev == "Ready_Sword" or Prev == "Bored_Sword" or PrevAnim == "WantBow"
                then
                    CurDrawableSetTransitionAnimState("TRANS_SwordToBow_Selected")
                end
            EndScript
        End




        AnimationState                        = HIT_REACTION HIT_LEVEL_1 WEAPONSET_TOGGLE_1
            StateName                        = Bored_Sword
            Animation
                AnimationName                = EUHaldir_HITE
                AnimationMode                = ONCE
            End
        End

        AnimationState                         = HIT_REACTION HIT_LEVEL_1
            StateName                        = Bored_Bow
            Animation
                AnimationName                = EUHaldir_HITA
                AnimationMode                 = ONCE
                AnimationSpeedFactorRange    = .9 .9
            End
        End




        AnimationState                    = WEAPONSET_TOGGLE_1
            StateName                    = Bored_Sword
            Animation                        = Idle_Sword1
                AnimationName                = EUHaldir_IDLF
                AnimationMode                = ONCE
            End
            Animation                        = Idle_Sword2
                AnimationName                = EUHaldir_IDLF
                AnimationMode                = ONCE
            End
            Animation                        = Idle_Sword3
                AnimationName                = EUHaldir_IDLF
                AnimationMode                = ONCE
            End
            Animation                        = IdleNoFidget
                AnimationName                = EUHaldir_IDLF
                AnimationMode                = ONCE
                AnimationPriority            = 20
            End
            Animation                        = IdleNoFidget2
                AnimationName                = EUHaldir_IDLF
                AnimationMode                = ONCE
                AnimationPriority            = 0
            End
            Flags                        = RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                CurDrawableHideSubObject("ARROW")
                CurDrawableHideSubObject("ARROWNOCK")

                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                if Prev == "TRANS_SB_Sword" or Prev == "TRANS_RB_Sword" then return "IdleNoFidget" end
                if Prev == "Selected_Sword"        then CurDrawableSetTransitionAnimState("TRANS_SB_Sword")        end
                if Prev == "Ready_Sword"        then CurDrawableSetTransitionAnimState("TRANS_RB_Sword")        end
                if Prev == "Selected_Bow" or Prev == "Moving_Bow" or Prev == "Ready_Bow" or Prev == "Bored_Bow" or PrevAnim == "WantSword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BowToSword_Selected")
                end
            EndScript
        End

        IdleAnimationState
            StateName                    = Bored_Bow
            Animation                        = IdleBowB
                AnimationName                = EUHaldir_IDLE
                AnimationMode                = ONCE
            End
            Animation                        = IdleBowD
                AnimationName                = EUHaldir_IDLE
                AnimationMode                = ONCE
            End
            Animation                        = IdleNoFidget
                AnimationName                = EUHaldir_IDLE
                AnimationMode                = ONCE
                AnimationPriority            = 20
            End
            Animation                        = IdleNoFidget2
                AnimationName                = EUHaldir_IDLE
                AnimationMode                = ONCE
                AnimationPriority            = 10
            End
            Flags                        = RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("arrownock")
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                if Prev == "TRANS_SB_Bow" or Prev == "TRANS_RB_Bow" then return "IdleNoFidget" end
                if Prev == "Selected_Bow"        then CurDrawableSetTransitionAnimState("TRANS_SB_Bow")        end
                if Prev == "Ready_Bow"            then CurDrawableSetTransitionAnimState("TRANS_RB_Bow")        end
                if Prev == "Selected_Sword" or Prev == "Moving_Sword" or Prev == "Ready_Sword" or Prev == "Bored_Sword" or PrevAnim == "WantBow"
                then
                    CurDrawableSetTransitionAnimState("TRANS_SwordToBow_Selected")
                end
            EndScript
        End




        TransitionState                   = TRANS_BS_Bow
            Animation
                AnimationName                = EUHaldir_ATNB
                AnimationMode                = ONCE
                AnimationBlendTime            = 10
            End
        End

        TransitionState                   = TRANS_SR_Bow
            Animation                        = ATNE
                AnimationName                = EUHaldir_IDLB
                AnimationMode                = ONCE
                AnimationBlendTime            = 10
            End
        End

        TransitionState                   = TRANS_SB_Bow
            Animation
                AnimationName                = EUHaldir_ATNB
                AnimationMode                = ONCE_BACKWARDS
            End
            Flags                        = START_FRAME_LAST
        End

        TransitionState                   = TRANS_RS_Bow
            Animation                        = ATNF
                AnimationName                = EUHaldir_IDLB
                AnimationMode                = ONCE_BACKWARDS
                AnimationBlendTime            = 10
            End
            Flags                        = START_FRAME_LAST
        End

        TransitionState                   = TRANS_BR_Bow
            Animation                        = IDLB
                AnimationName                = EUHaldir_IDLST1
                AnimationMode                = ONCE
                AnimationBlendTime            = 20
            End
        End

        TransitionState                   = TRANS_RB_Bow
            Animation                        = IDLD
                AnimationName                = EUHaldir_IDLB
                AnimationMode                = ONCE
                AnimationBlendTime            = 20
            End
        End



        TransitionState                        = TRANS_BoredToSelected_Bow
            Animation
                AnimationName                = EUHaldir_ATNB
                AnimationMode                = ONCE
                AnimationBlendTime            = 10
            End
        End


        TransitionState                        = TRANS_SelectedToReady_Bow
            Animation                        = ATNE
                AnimationName                = EUHaldir_IDLB
                AnimationMode                = ONCE
                AnimationBlendTime            = 10
            End
        End


        TransitionState                        = TRANS_SelectedToBored_Bow
            Animation
                AnimationName                = EUHaldir_ATNB
                AnimationMode                = ONCE_BACKWARDS
            End
            Flags                            = START_FRAME_LAST
        End


        TransitionState                        = TRANS_RS_Bow
            Animation                        = ATNF
                AnimationName                = EUHaldir_IDLB
                AnimationMode                = ONCE_BACKWARDS
                AnimationBlendTime            = 10
            End
            Flags                            = START_FRAME_LAST
        End


        TransitionState                        = TRANS_BR_Bow
            Animation                        = IDLB
                AnimationName                = EUHaldir_IDLST1
                AnimationMode                = ONCE
                AnimationBlendTime            = 20
            End
        End


        TransitionState                        = TRANS_RB_Bow
            Animation                        = IDLD
                AnimationName                = EUHaldir_IDLB
                AnimationMode                = ONCE
                AnimationBlendTime            = 20
            End
        End


        TransitionState                    = TRANS_BoredToSelected_Sword
            Animation                    = ATNA
                AnimationName            = EUHaldir_ATNA
                AnimationMode            = ONCE
            End
        End


        TransitionState                    = TRANS_SR_Sword
            Animation                    = ATNC
                AnimationName            = EUHaldir_STHA
                AnimationMode            = ONCE
            End
        End


        TransitionState                    = TRANS_SelectedToBored_Sword
            Animation                    = ATNA
                AnimationName            = EUHaldir_ATNA
                AnimationMode            = ONCE_BACKWARDS
            End
            Flags                        = START_FRAME_LAST
        End


        TransitionState                    = TRANS_ReadyToSelected_Sword
            Animation                    = ATNC
                AnimationName            = EUHaldir_IDLST1
                AnimationMode            = ONCE_BACKWARDS
                AnimationBlendTime        = 20
            End
            Flags                        = START_FRAME_LAST
        End


        TransitionState                    = TRANS_BR_Sword
            Animation                    = ATNS
                AnimationName            = EUHaldir_STHA
                AnimationMode            = ONCE
                AnimationBlendTime        = 20
            End
        End


        TransitionState                    = TRANS_RB_Sword
            Animation                    = IDLG
                AnimationName            = EUHaldir_STHA
                AnimationMode            = ONCE
                AnimationBlendTime        = 20
            End
        End



        TransitionState                    = TRANS_SwordToBow_Moving
            Animation                    = DrawBow
                AnimationName            = EUHaldir_STHC
                AnimationMode            = ONCE
            End
        End


        TransitionState                    = TRANS_BowToSword_Moving
            Animation                    = DrawSword
                AnimationName            = EUHaldir_STHD
                AnimationMode            = ONCE
            End
        End


        TransitionState                    = TRANS_BowToSword_Ready
            Animation                    = DrawSwords
                AnimationName            = EUHaldir_STHA
                AnimationMode            = ONCE
            End
        End


        TransitionState                    = TRANS_SwordToBow_Ready
            Animation                    = DrawBow
                AnimationName            = EUHaldir_STHB
                AnimationMode            = ONCE
            End
        End


        TransitionState                    = TRANS_BowToSword_Selected
            Animation                    = DrawSwords
                AnimationName            = EUHaldir_STHA
                AnimationMode            = ONCE
            End
        End


        TransitionState                    = TRANS_SwordToBow_Selected
            Animation                    = DrawBow
                AnimationName            = EUHaldir_STHB
                AnimationMode            = ONCE
            End
        End
    End

    #include "..\..\..\includes\StunDrawModuleSmall.inc"


    Side                        = Lothlorien
    EditorSorting               = UNIT
    ThreatLevel                 = HALDIR_THREAT_LEVEL
    ThingClass                  = CHARACTER_UNIT
    BuildCost                   = HALDIRDAG_COST
    BuildTime                   = MEDIUM_HERO_BUILDTIME

    TransportSlotCount          = TRANSPORTSLOTCOUNT_HERO
    VisionRange                 = VISION_HERO_RANGED
    ShroudClearingRange         = SHROUD_CLEAR_RANGED_HERO
    MaxVisionBonusPercent       = 300%
    VisionBonusTestRadius       = 200
    VisionBonusPercentPerFoot   = 1.0%

    BountyValue                 = ELVEN_HALDIR_BOUNTY_VALUE
    RecruitText                 = CONTROLBAR:HaldirRecruit
    ReviveText                  = CONTROLBAR:HaldirRevive
    Hotkey                      = CONTROLBAR:ElvenHaldirHotkey
    DisplayName                 = OBJECT:ElvenHaldir
    CrushableLevel              = 2
    CommandSet                  = LothlorienHaldirCommandSet
    CommandPoints               = 0
    DisplayMeleeDamage          = HALDIRDAG_DAMAGE
    DisplayRangedDamage         = HALDIRDAG_DAMAGE
    HeroSortOrder               = 40


    WeaponSet
        Conditions              = None
        Weapon                  = PRIMARY HaldirBowEdain
        AutoChooseSources       = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End

    WeaponSet
        Conditions              = CONTAINED
        Weapon                  = PRIMARY HaldirBowEdain
        AutoChooseSources       = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End

    WeaponSet
        Conditions              = WEAPONSET_TOGGLE_1
        Weapon                  = PRIMARY HaldirSwordEdain
        AutoChooseSources       = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End


    ArmorSet
        Conditions      = None
        Armor           = WeakHeroArmor
        DamageFX        = NormalDamageFX
    End

    ArmorSet
        Conditions      = PLAYER_UPGRADE
        Armor           = MediumHeroArmor
        DamageFX        = NormalDamageFX
    End



    AutoResolveUnitType = AutoResolveUnit_Hero
    AutoResolveCombatChain = AutoResolve_HeroCombatChain

    AutoResolveBody = AutoResolve_HaldirBody

    AutoResolveArmor
        Armor = AutoResolve_HaldirArmor
    End

    AutoResolveWeapon
        Weapon = AutoResolve_HaldirWeapon
    End

    AutoResolveLeadership = AutoResolve_HaldirBonus




    VoiceAttack                             = HaldirModVoiceAttack
    VoiceAttackAir                          = HaldirModVoiceAttack
    VoiceAttackCharge                       = HaldirModVoiceAttack
    VoiceAttackMachine                      = HaldirModVoiceAttack
    VoiceAttackStructure                    = HaldirModVoiceAttack
    VoiceFear                               = HaldirModVoiceHelpMe
    VoiceGuard                              = HaldirModVoiceMove
    VoiceMove                               = HaldirModVoiceMove
    VoiceMoveToCamp                         = HaldirModVoiceMove
    VoiceMoveWhileAttacking                 = HaldirModVoiceMove
    VoicePriority                           = 85
    VoiceRetreatToCastle                    = HaldirModVoiceRetreat
    VoiceSelect                             = HaldirModVoiceSelect
    VoiceSelectBattle                       = HaldirModVoiceSelect
    VoiceCreated                            = HaldirModVoiceSalute
    VoiceFullyCreated                       = HaldirModVoiceSalute
    SoundImpact                             = ImpactHorse

    UnitSpecificSounds
        VoiceEnterUnitElvenTransportShip    = HaldirModVoiceMove
        VoiceGarrison                       = HaldirModVoiceMove
        VoiceInitiateCaptureBuilding        = HaldirModVoiceSelect
    End

    CrowdResponseKey = ElfHero

    #include "..\..\..\includes\StandardUnitEvaEvents.inc"
    EvaEventDieOwner                        = HaldirDie

    Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
        Key    = Humanoid_Male Elf Elf_Male Unit Infantry Hero
    End

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap                    = 800
        AnimationSound                        = Sound:ArrowDrawBow                    Animation:EUHaldir_SKL.EUHaldir_ATA1    Frames:6
        AnimationSound                        = Sound:ArrowDrawBow                    Animation:EUHaldir_SKL.EUHaldir_ATA2    Frames:18

        AnimationSound                        = Sound:SwordShingClean1                Animation:EUHaldir_SKL.EUHaldir_STHA     Frames:24
        AnimationSound                        = Sound:SwordIntoScabbard1                Animation:EUHaldir_SKL.EUHaldir_STHB     Frames:9
        AnimationSound                        = Sound:WeaponSwitchBow                    Animation:EUHaldir_SKL.EUHaldir_STHB     Frames:15

        AnimationSound                        = Sound:SwordShingClean1                 Animation:EUHaldir_SKL.EUHaldir_STHC     Frames:20
        AnimationSound                        = Sound:SwordIntoScabbard1                Animation:EUHaldir_SKL.EUHaldir_STHD     Frames:5
        AnimationSound                        = Sound:WeaponSwitchBow                 Animation:EUHaldir_SKL.EUHaldir_STHD     Frames:8

        AnimationSound                        = Sound:SwordShingClean1                 Animation:EUHaldir_SKL.EUHaldir_RUNC     Frames:14
        AnimationSound                        = Sound:SwordIntoScabbard1                Animation:EUHaldir_SKL.EUHaldir_RUNT     Frames:4
        AnimationSound                        = Sound:WeaponSwitchBow                 Animation:EUHaldir_SKL.EUHaldir_RUNT     Frames:16

        AnimationSound                        = Sound:BodyFallSoldier                    Animation:EUHaldir_SKL.EUHaldir_LNDA    Frames:9
        AnimationSound                        = Sound:BodyFallSoldier                    Animation:EUHaldir_SKL.EUHaldir_LNDB    Frames:1

        AnimationSound                        = Sound:BodyFallGenericNoArmor            Animation:EUHaldir_SKL.EUHaldir_DIEB     Frames:82
        AnimationSound                        = Sound:BodyFallSoldier                    Animation:EUHaldir_SKL.EUHaldir_DIEBV5     Frames:25
        AnimationSound                        = Sound:BodyFallSoldier                    Animation:EUHaldir_SKL.EUHaldir_DIESV4     Frames:26
        AnimationSound                        = Sound:BodyFallGenericNoArmor            Animation:EUHaldir_SKL.EUHaldir_DIESV5    Frames:100
    End






    RadarPriority                 = UNIT
    KindOf                        = HERO PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE THROWN_OBJECT ARMY_SUMMARY ATTACK_NEEDS_LINE_OF_SIGHT HEAVY_MELEE_HITTER
    CamouflageDetectionMultiplier = CAMOUFLAGE_DETECTION_DISTANCE_MEDIUM
    PathfindDiameter              = 40.0


    Body = RespawnBody ModuleTag_RespawnBody
        CheerRadius                          = EMOTION_CHEER_RADIUS
        MaxHealth                            = HALDIRDAG_HEALTH
        PermanentlyKilledByFilter            = NONE
        DodgePercent                         = HERO_DODGE_PERCENT
    End

    Behavior = RespawnUpdate ModuleTag_RespawnUpdate
        DeathAnim                            = DYING
        DeathAnimationTime                   = 3000
        RespawnAnim                          = LEVELED
        RespawnAnimationTime                 = 2000
        AutoRespawnAtObjectFilter            = NONE +CASTLE_KEEP
        ButtonImage                          = HIHaldir

        RespawnRules =    AutoSpawn:No           Cost:HALDIRDAG_COST       Time:MEDIUM_HERO_RESPAWNTIME        Health:100%
    End

    Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance               = 200
        TauntAndPointUpdateDelay            = 10000
        PointAt                             = ANY +HERO
        AddEmotion            =    Doom_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
        AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    Alert_Base
        AddEmotion            =    CheerForAboutToCrush_Base
    End

    Behavior = AutoHealBehavior ModuleTag_LegolasHealing
        StartsActive                        = Yes
        HealingAmount                       = HERO_HEAL_AMOUNT
        HealingDelay                        = 1000
        StartHealingDelay                   = HERO_HEAL_DELAY
        HealOnlyIfNotInCombat               = Yes
    End

    Behavior = AutoHealBehavior ModuleTag_ElvenGiftHealing
        StartsActive                  = No
        TriggeredBy                   = Upgrade_ElvenGift
        HealingAmount                 = ELVEN_GIFT_REGEN_AMOUNT
        HealingDelay                  = ELVEN_GIFT_REGEN_DELAY
        StartHealingDelay             = HERO_HEAL_DELAY
        HealOnlyIfNotInCombat         = Yes
    End

    Behavior = AttributeModifierUpgrade ModuleTag_ElvenGiftBonus
        TriggeredBy       = Upgrade_ElvenGift
        AttributeModifier = SpellBookElvenGifts
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate                        = Hero
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = AIUpdateInterface ModuleTag_03
        AutoAcquireEnemiesWhenIdle            = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate                    = 500
        CanAttackWhileContained                = Yes
        AILuaEventsList                        = LegolasFunctions
    End


    #include "..\..\..\includes\DefaultInvisibilityUpdate.inc"

    Behavior = HitReactionBehavior HitReactionBehaviorModuleTag
        HitReactionLifeTimer1                = 1500
        HitReactionThreshold1                = 400
        FastHitsResetReaction                = Yes
    End

    Behavior = PassiveAreaEffectBehavior ModuleTag_TaurielKampf
        EffectRadius            = 300
        PingDelay               = 2000
        UpgradeRequired         = Upgrade_TestBuilding_2
        ModifierName            = HaldirTaurielModifier
        AllowFilter             = ANY +LothlorienTauriel ALLIES
    End





    Behavior = SpecialPowerModule ModuleTag_ElfCloakStarter
        SpecialPowerTemplate      = SpecialAbilityElfCloak
        UpdateModuleStartsAttack  = Yes
    End

    Behavior = ToggleHiddenSpecialAbilityUpdate ModuleTag_ElfCloakUpdate
        SpecialPowerTemplate    = SpecialAbilityElfCloak
        AwardXPForTriggering    = 0
    End

    Behavior = InvisibilityUpdate ModuleTag_StealthForEscape
        InvisibilityNugget
            InvisibilityType        = STEALTH
            ForbiddenConditions     = MOVING  FIRING_ANY TAKING_DAMAGE USING_ABILITY
            BecomeStealthedFX       = FX_ElvenCloakOn
            ExitStealthFX           = FX_ElvenCloakOff
            Options                 = UNTOGGLE_HIDDEN_WHEN_LEAVING_STEALTH
        End
        StartsActive                = No
        UpdatePeriod                = 2000
    End


    Behavior = InvisibilityUpdate ModuleTag_Camouflage
        InvisibilityNugget
            InvisibilityType        = CAMOUFLAGE
            ForbiddenConditions     = TAKING_DAMAGE FIRING_ANY USING_ABILITY
            DetectionRange          = CAMOUFLAGE_RADIUS
            Options                 = ALLOW_NEAR_TREES
        End
        UnitSpecificSoundNameToUseAsVoiceMoveToStealthyArea = VoiceMoveToTrees
        UnitSpecificSoundNameToUseAsVoiceEnterStateMoveToStealthyArea = VoiceEnterStateMoveToTrees
        StartsActive                = Yes
        UpdatePeriod                = 2000
    End






    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_MoveUnseenEnabler
        SpecialPowerTemplate        = SpecialAbilityMoveUnseen
        TriggeredBy                 = Upgrade_Level_2
    End

    Behavior = InvisibilitySpecialPower ModuleTag_MoveUnseen
        SpecialPowerTemplate        = SpecialAbilityMoveUnseen
        AvailableAtStart            = No
        StartsPaused                = Yes
        BroadcastRadius             = THRANDUIL_MOVEUNSEEN_EFFECT_RADIUS
        ObjectFilter                = ANY +INFANTRY +CAVALRY +HORDE +HERO +DOZER ALLIES
        Duration                    = 20000
        InvisibilityNugget
            ForbiddenConditions     = FIRING_ANY
            DetectionRange          = CAMOUFLAGE_RADIUS
            InvisibilityType        = CAMOUFLAGE
        End
    End






    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_HaldirGoldenArrowUnpause
        SpecialPowerTemplate                = SpecialAbilityHaldirGoldenArrow
        TriggeredBy                         = Upgrade_Level_4
    End

    Behavior = SpecialPowerModule ModuleTag_HaldirGoldenArrowSpecialPower
        SpecialPowerTemplate                = SpecialAbilityHaldirGoldenArrow
        StartsPaused                        = Yes
        UpdateModuleStartsAttack            = Yes

    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_HaldirGoldenArrowWeaponFireUpdate
        SpecialPowerTemplate                = SpecialAbilityHaldirGoldenArrow
        WhichSpecialWeapon                  = 1
        UnpackTime                          = 600
        PreparationTime                     = 1
        PackTime                            = 2000
        StartAbilityRange                   = HALDIR_BOW_RANGE
        MustFinishAbility                   = Yes
        SpecialWeapon                       = HaldirGoldenArrow
    End

    Behavior = AutoAbilityBehavior ModuleTag_GoldenArrowAutoAbility
	SpecialAbility		= SpecialAbilityHaldirGoldenArrow
	ForbiddenStatus 	= INSIDE_GARRISON
	MaxScanRange		= HALDIR_BOW_RANGE
        Query			= 1 ANY ENEMIES +HERO +MONSTER
	Query			= 40 ANY ENEMIES +INFANTRY +CAVALRY -STRUCTURE
    End





    Behavior = AttributeModifierAuraUpdate ModuleTag_Leadership
        StartsActive                        = No
        BonusName                           = AnfuhrerGaladhrim
        TriggeredBy                         = Upgrade_Level_6
        RefreshDelay                        = 2000
        Range                               = 200
        ObjectFilter                        = ANY +INFANTRY -HERO -CAVALRY -MONSTER -SHIP -MACHINE ALLIES
    End

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_HaldirLeadership
        SpecialPowerTemplate                = SpecialAbilityFakeLeadership
        TriggeredBy                         = Upgrade_Level_6
    End

    Behavior = SpecialPowerModule ModuleTag_HaldirLeadershipUpdate
        SpecialPowerTemplate                = SpecialAbilityFakeLeadership
        UpdateModuleStartsAttack            = No
        StartsPaused                        = Yes
    End

    Behavior = ArmorUpgrade ModuleTag_ArmorUpgrade
        TriggeredBy          = Upgrade_Level_6
        ArmorSetFlag         = PLAYER_UPGRADE
    End

    Behavior = ModelConditionUpgrade ModuleTag_TurnArmorOn
        TriggeredBy          = Upgrade_Level_6
        AddConditionFlags    = USER_4
    End

    Behavior = SubObjectsUpgrade Armor_Upgrade
        TriggeredBy          = Upgrade_Level_6
        UpgradeTexture       = euhaldir_regular.tga 0 euhaldir_armor.tga
        ShowSubObjects       = GNTL
        RecolorHouse         = No
    End





    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_GrenzenEnabler
        SpecialPowerTemplate    = SpecialAbilityDieSpeereDusterwalds
        TriggeredBy             = Upgrade_Level_8
    End

    Behavior = OCLSpecialPower ModuleTag_OCLGrenzenSpecialPower
        SpecialPowerTemplate    = SpecialAbilityDieSpeereDusterwalds
        OCL                     = OCL_HaldirCampGuard
        CreateLocation          = CREATE_AT_LOCATION
        TriggerFX               = FX_HaldirAlliesSummon
        StartsPaused            = Yes
    End






    Behavior = AttributeModifierAuraUpdate ModuleTag_GaladhrimUpgrade1
        StartsActive     = No
        TriggeredBy      = Upgrade_Level_3
        BonusName        = HaldirsGaladhrimUpgradeModifier1
        RefreshDelay     = 2000
        Range            = 9999999999
        ObjectFilter     = NONE +LothlorienHaldirsElves ALLIES
    End

    Behavior = AttributeModifierAuraUpdate ModuleTag_GaladhrimUpgrade2
        StartsActive     = No
        TriggeredBy      = Upgrade_Level_7
        BonusName        = HaldirsGaladhrimUpgradeModifier2
        RefreshDelay     = 2000
        Range            = 9999999999
        ObjectFilter     = NONE +LothlorienHaldirsElves ALLIES
    End


    LocomotorSet
        Locomotor                            = HumanLocomotor
        Condition                            = SET_NORMAL
        Speed                                = 67
    End

    LocomotorSet
        Locomotor                            = HumanWanderLocomotor
        Condition                            = SET_WANDER
        Speed                                = 62
    End

    LocomotorSet
        Locomotor                            = HumanPanicLocomotor
        Condition                            = SET_PANIC
        Speed                                = 67
    End

    LocomotorSet
        Locomotor                            = HumanScaredLocomotor
        Condition                            = SET_SCARED
        Speed                                = 67
    End

    Behavior = PhysicsBehavior ModuleTag_04
        GravityMult                          = 1.0
        ShockStandingTime                    = 2000
    End

    Behavior = SlowDeathBehavior ModuleTag_05
        DeathTypes                           = ALL -FADED
        SinkDelay                            = 3000
        SinkRate                             = 0.5
        DestructionDelay                     = 15000
        Sound                                = INITIAL HaldirModVoiceDie
        DeathFlags                           = DEATH_1
    End

    Behavior = SlowDeathBehavior ModuleTag_FadeDeath
        DeathTypes                           = NONE +FADED
        FadeDelay                            = 0
        FadeTime                             = 5000
        DestructionDelay                     = 5000
        DeathFlags                           = DEATH_2
        FX                                   = INITIAL FX_UnSummonElvenAllies
    End

    Behavior = SquishCollide ModuleTag_06
    End

    Behavior = BezierProjectileBehavior ModuleTag_08
        FirstHeight                            = 25
        SecondHeight                           = 25
        FirstPercentIndent                     = 30%
        SecondPercentIndent                    = 70%
        TumbleRandomly                         = Yes
        CrushStyle                             = Yes
        DieOnImpact                            = Yes
        BounceCount                            = 1
        BounceDistance                         = 41
        BounceFirstHeight                      = 25
        BounceSecondHeight                     = 25
        BounceFirstPercentIndent               = 20%
        BounceSecondPercentIndent              = 80%
        GroundHitFX                            = FX_ThrownRockGroundHit
        GroundBounceFX                         = FX_ThrownRockBounceHit
    End

    Behavior = WeaponSetUpgrade WeaponSetUpgradeModuleTag
        TriggeredBy       = Upgrade_GeschenkeLoriens
    End

    Behavior = CommandSetUpgrade ModueTag_CommandSetGeschenke
        TriggeredBy       = Upgrade_GeschenkeLoriens
        CommandSet        = LothlorienHaldirCommandSet_Geschenke
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI1
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 250000
        GrantUpgrade = Upgrade_GeschenkeLoriens
    End





    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Behavior = AISpecialPowerUpdate AToggleWeaponAI
        CommandButtonName = Command_ToggleHaldirWeapon
        SpecialPowerAIType = AI_SPECIAL_POWER_TOGGLE_MELEE_AND_RANGE
    End


    Behavior = AISpecialPowerUpdate GoldenArrowAI
        CommandButtonName = Command_HaldirGoldenArrow
        SpecialPowerAIType = AI_SPECIAL_POWER_ENEMY_TYPE_KILLER
        SpecialPowerRadius = 250
    End

    Behavior = AISpecialPowerUpdate WhiteArrowAI
        CommandButtonName = Command_HaldirWhiteArrow
        SpecialPowerAIType = AI_SPECIAL_POWER_ENEMY_TYPE_KILLER
        SpecialPowerRadius = 250
    End

    Behavior = AISpecialPowerUpdate MightyRageAI
        CommandButtonName = Command_SpecialAbilityHaldirSchutztdieGrenzen
        SpecialPowerAIType = AI_SPECIAL_POWER_HEAL_AOE
        SpecialPowerRadius = 200.0
    End

    Behavior = AISpecialPowerUpdate MoveUnseenAI
        CommandButtonName = Command_SpecialAbilityMoveUnseenHaldir
        SpecialPowerAIType = AI_SPECIAL_POWER_GIVEXP_AOE
        SpecialPowerRadius = 250
    End

    Scale 		= 0.95
    Geometry            = CYLINDER
    GeometryMajorRadius = 8.0
    GeometryHeight      = 19.2
    GeometryIsSmall     = Yes
    Shadow              = SHADOW_DECAL
    ShadowSizeX         = 19
    ShadowSizeY         = 19
    ShadowTexture       = ShadowI
End

ChildObject LothlorienHaldir_Summoned LothlorienHaldir
    CommandPoints = 0
    KindOf = PRELOAD HERO SELECTABLE CAN_CAST_REFLECTIONS SCORE NO_FREEWILL_ENTER MONSTER SCARY CANNOT_RETALIATE SUMMONED

    Behavior = LifetimeUpdate ModuleTag_LifetimeUpdate
        MinLifetime      = 120000
        MaxLifetime      = 120000
        DeathType        = FADED
    End

    Behavior = ExperienceLevelCreate ModuleTag_LevelBonus
        LevelToGrant = 10
        MPOnly = No
    End
End

Object LothlorienHaldir_Dummy
End

Object LothlorienHaldir_Rohan


    SelectPortrait     = HPHaldirNew
    ButtonImage        = HIHaldir

    DescriptionStrategic = CONTROLBAR:LW_ToolTip_LeaderHero

    Draw = W3DScriptedModelDraw ModuleTag_DRAW

        DefaultModelConditionState
            Model              = euruhaldir_ska
            Skeleton           = EUHaldir_SKL
        End

        ModelConditionState    = WEAPONSET_TOGGLE_1
            Model              = euruhaldir_skb
            Skeleton           = EUHaldir_SKL
            WeaponLaunchBone   = PRIMARY ARROW
        End

        ModelConditionState    = INVISIBLE_STEALTH
            ParticleSysBone    = NONE Predator FollowBone:Yes Persist:SPAWN PersistID:100
            ParticleSysBone    = NONE Predator02 FollowBone:Yes Persist:SPAWN PersistID:100
        End






        AnimationState                    = PASSENGER WEAPONSET_TOGGLE_1
            StateName                    = STATE_Grabbed
            Animation                    = Sword
                AnimationName            = EUHaldir_FLYB
                AnimationMode            = LOOP
            End
        End

        AnimationState                    = PASSENGER
            StateName                    = STATE_Grabbed
            Animation                    = Bow
                AnimationName            = EUHaldir_FLYA
                AnimationMode            = LOOP
            End
        End

        AnimationState                    = FREEFALL WEAPONSET_TOGGLE_1
            StateName                    = STATE_Falling
            Animation                    = Sword
                AnimationName            = EUHaldir_FLYB
                AnimationMode            = LOOP
                AnimationBlendTime        = 10
                AnimationSpeedFactorRange    = 0.24    0.24
            End
        End

        AnimationState                    = FREEFALL
            StateName                    = STATE_Falling
            Animation                    = Bow
                AnimationName            = EUHaldir_FLYA
                AnimationMode            = LOOP
                AnimationBlendTime        = 10
                AnimationSpeedFactorRange    = 0.5    0.5
            End
        End

        AnimationState                    = STUNNED_FLAILING WEAPONSET_TOGGLE_1
            StateName                    = STATE_Fly
            Animation                   = Sword
                AnimationName           = EUHaldir_FLYB
                AnimationMode           = LOOP
            End
            Flags                        = MAINTAIN_FRAME_ACROSS_STATES2
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                PrevAnim = CurDrawablePrevAnimation()
                if PrevState == "Ready_Bow" or PrevState == "Moving_Bow" or PrevState == "Bored_Bow"
                then
                    CurDrawableShowSubObject("arrow")
                    CurDrawableShowSubObject("arrownock")
                    return "WantSword"
                elseif PrevState == "STATE_Fly"
                then
                    if PrevAnim == "Bow" or PrevAnim == "WantSword"
                    then
                        CurDrawableShowSubObject("arrow")
                        CurDrawableShowSubObject("arrownock")
                        return "WantSword"
                    end
                end

                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
                return "Sword"
            EndScript
        End

        AnimationState                    = STUNNED_FLAILING
            StateName                    = STATE_Fly
            Animation
                AnimationName           = EUHaldir_FLYA
                AnimationMode           = LOOP
            End
            Flags                        = MAINTAIN_FRAME_ACROSS_STATES2
        End

        AnimationState                    = DYING DEATH_1 SPLATTED WEAPONSET_TOGGLE_1
            StateName                    = STATE_Dead
            Animation                    = Sword
                AnimationName            = EUHaldir_LNDB
                AnimationMode            = ONCE
            End
        End

        AnimationState                    = DYING DEATH_1 SPLATTED
            StateName                    = STATE_Dead
            Animation                    = Bow
                AnimationName            = EUHaldir_LNDA
                AnimationMode            = ONCE
            End
        End



        AnimationState                    = DYING DEATH_1 WEAPONSET_TOGGLE_1
            Animation                        = Sword1
                AnimationName                = EUHaldir_DIESv5
                AnimationMode                = ONCE
            End
            Animation                        = Sword2
                AnimationName                = EUHaldir_DIESV5
                AnimationMode                = ONCE
            End
            Animation                        = WantSword
                AnimationName                = EUHaldir_LNDB
                AnimationMode                = ONCE
            End

            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                PrevAnim = CurDrawablePrevAnimation()
                if PrevState == "STATE_Fly"
                then
                    CurDrawableShowSubObject("arrow")
                    CurDrawableShowSubObject("arrownock")
                    return "WantSword"
                end

                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
                if GetClientRandomNumberReal(0,2) < 1
                then
                    return "Sword1"
                else
                    return "Sword2"
                end
            EndScript
        End

        AnimationState                    = DYING DEATH_2 WEAPONSET_TOGGLE_1
            Animation                   = FadeOut
                AnimationName           = EUHaldir_IDLF
                AnimationMode           = LOOP
            End
        End

        AnimationState                    = DYING DEATH_1
            Animation                        = Bow1
                AnimationName                = EUHaldir_DIEBV5
                AnimationMode                = ONCE
            End
            Animation                        = Bow2
                AnimationName                = EUHaldir_DIEBV5
                AnimationMode                = ONCE
            End
            Animation                        = WantBow
                AnimationName                = EUHaldir_LNDA
                AnimationMode                = ONCE
            End
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                PrevAnim = CurDrawablePrevAnimation()

                if PrevState == "STATE_Fly"
                then
                    CurDrawableHideSubObject("ArrowNock")
                    CurDrawableHideSubObject("arrow")
                    return "WantBow"
                end

                if GetClientRandomNumberReal(0,2) < 1
                then
                    CurDrawableShowSubObject("arrow")
                    CurDrawableShowSubObject("arrownock")
                    return "Bow1"
                else
                    CurDrawableShowSubObject("arrow")
                    CurDrawableShowSubObject("arrownock")
                    return "Bow2"
                end
            EndScript
        End

        AnimationState                    = DYING DEATH_2
            Animation                        = FadeOut
                AnimationName                = EUHaldir_IDLE
                AnimationMode                = ONCE
            End
        End


        AnimationState                    = STUNNED_STANDING_UP WEAPONSET_TOGGLE_1
            StateName                    = STATE_GetUp
            Animation                        = Sword
                AnimationName                = EUHaldir_GTPSX1
                AnimationMode                = ONCE
                AnimationSpeedFactorRange    = 1.2    1.2
            End
            Animation                        = WantSword
                AnimationName                = EUHaldir_GTPB
                AnimationMode                = ONCE
            End
            Flags                        = MAINTAIN_FRAME_ACROSS_STATES4
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                PrevAnim = CurDrawablePrevAnimation()
                if PrevState == "STATE_GetUp" or PrevState == "STATE_Land"
                then
                    if PrevAnim == "Bow" or PrevAnim == "WantSword"
                    then
                        CurDrawableShowSubObject("arrow")
                        CurDrawableShowSubObject("arrownock")
                        return "WantSword"
                    end
                end

                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
                return "Sword"
            EndScript
        End



        AnimationState                    = STUNNED_STANDING_UP
            StateName                    = STATE_GetUp
            Animation                        = Bow
                AnimationName                = EUHaldir_GTPB
                AnimationMode                = ONCE
                AnimationSpeedFactorRange    = 1.42 1.42
            End
            Animation                        = WantBow
                AnimationName                = EUHaldir_GTPSX1
                AnimationMode                = ONCE
            End
            Flags                        = MAINTAIN_FRAME_ACROSS_STATES4
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                PrevAnim = CurDrawablePrevAnimation()
                if PrevState == "STATE_GetUp" or PrevState == "STATE_Land"
                then
                    if PrevAnim == "WantBow" or PrevAnim == "Sword"
                    then
                        CurDrawableHideSubObject("ArrowNock")
                        CurDrawableHideSubObject("arrow")
                        return "WantBow"
                    end
                else
                    CurDrawableShowSubObject("arrow")
                    CurDrawableShowSubObject("arrownock")
                    return "Bow"
                end
            EndScript
        End

        AnimationState                    = STUNNED WEAPONSET_TOGGLE_1
            StateName                    = STATE_Land
            Animation                        = Sword
                AnimationName                = EUHaldir_LNDB
                AnimationMode                = ONCE
            End
            Animation                        = WantSword
                AnimationName                = EUHaldir_LNDA
                AnimationMode                = ONCE
            End
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                PrevAnim = CurDrawablePrevAnimation()
                if PrevState == "STATE_Fly"
                then
                    if PrevAnim == "WantSword" or PrevAnim == "Bow"
                    then
                        CurDrawableShowSubObject("arrow")
                        CurDrawableShowSubObject("arrownock")
                        return "WantSword"
                    end
                end
                Flags                        = MAINTAIN_FRAME_ACROSS_STATES3
                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
                return "Sword"
            EndScript
        End

        AnimationState                    = STUNNED
            StateName                    = STATE_Land
            Animation                        = Bow
                AnimationName                = EUHaldir_LNDA
                AnimationMode                = ONCE
            End
            Animation                        = WantBow
                AnimationName                = EUHaldir_LNDB
                AnimationMode                = ONCE
            End
            Flags                        = MAINTAIN_FRAME_ACROSS_STATES3
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                PrevAnim = CurDrawablePrevAnimation()
                if PrevState == "STATE_Fly"
                then
                    if PrevAnim == "WantBow" or PrevAnim == "Sword"
                    then
                        CurDrawableHideSubObject("ArrowNock")
                        CurDrawableHideSubObject("arrow")
                        return "WantBow"
                    end
                end

                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("arrownock")
                return "Bow"
            EndScript
        End





        AnimationState                    = FIRING_OR_PREATTACK_A WEAPONSET_TOGGLE_1
            StateName                        = Ready_Sword

            Animation                        = AttackWithSwordA
                AnimationName                = EUHaldir_ATKSV2
                AnimationMode                = ONCE
                UseWeaponTiming                = Yes
            End
            Animation                        = AttackWithSwordB
                AnimationName                = EUHaldir_ATKSV2
                AnimationMode                = ONCE
                UseWeaponTiming                = Yes
            End
            Animation                        = AttackWithSwordD
                AnimationName                = EUHaldir_ATKSV4
                AnimationMode                = ONCE
                UseWeaponTiming                = Yes
            End
            BeginScript
                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
            EndScript
        End

        AnimationState                        = FIRING_OR_PREATTACK_A
            StateName                        = Attacking_Bow
            Animation
                AnimationName                = EUHaldir_ATA2
                AnimationMode                = ONCE
                UseWeaponTiming                = Yes
                AnimationBlendTime            = 20
            End
            BeginScript
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("ArrowNock")
            EndScript
        End


        AnimationState                    = PREATTACK_A
            Animation                        = ReadyToDrawn
                AnimationName                = EUHaldir_ATA1
                AnimationMode                = ONCE
                AnimationBlendTime            = 0
                UseWeaponTiming                = Yes
            End
            BeginScript
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("ArrowNock")
            EndScript
        End

        AnimationState                    = FIRING_OR_RELOADING_A
            StateName                        = STATE_Firing
            Animation
                AnimationName                = EUHaldir_ATA2
                AnimationMode                = ONCE
                AnimationBlendTime            = 30
                UseWeaponTiming                = Yes
                AnimationSpeedFactorRange    = 1.5 1.5
            End
            Flags                            = START_FRAME_FIRST
            BeginScript
                CurDrawableHideSubObject("arrow")
                CurDrawableHideSubObject("ArrowNock")
            EndScript
        End





        AnimationState                    = MOVING BACKING_UP WEAPONSET_TOGGLE_1
            StateName                        = STATE_BackingUp
            Animation                        = Sword
                AnimationName                = EUHaldir_BAKS
                AnimationMode                = LOOP
            End
            Animation                        = WantSword
                AnimationName                = EUHaldir_BAKS
                AnimationMode                = LOOP
            End
            Flags                            = MAINTAIN_FRAME_ACROSS_STATES4
            BeginScript
                CurDrawableHideSubObject("ARROW")
                CurDrawableHideSubObject("ARROWNOCK")
                PrevAnim    = CurDrawablePrevAnimation()
                PrevState    = CurDrawablePrevAnimationState()
                if PrevState == "STATE_BackingUp"
                then
                    if PrevAnim == "Bow" or PrevAnim == "WantSword"
                    then
                        return "WantSword"
                    end
                end
                return "Sword"
            EndScript
        End

        AnimationState                    = MOVING BACKING_UP
            StateName                        = STATE_BackingUp
            Animation                        = Bow
                AnimationName                = EUHaldir_BAKB
                AnimationMode                = LOOP
            End
            Animation                        = WantBow
                AnimationName                = EUHaldir_BAKS
                AnimationMode                = LOOP
            End
            Flags                            = MAINTAIN_FRAME_ACROSS_STATES4
            BeginScript
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("arrownock")
                PrevAnim    = CurDrawablePrevAnimation()
                PrevState    = CurDrawablePrevAnimationState()
                if PrevState == "STATE_BackingUp"
                then
                    if PrevAnim == "WantBow" or PrevAnim == "Sword"
                    then
                        return "WantBow"
                    end
                end
                return "Bow"
            EndScript
        End



        AnimationState                    = MOVING WEAPONSET_TOGGLE_1
            StateName                        = Moving_Sword
            Animation
                AnimationName                = EUHaldir_RUNS
                AnimationMode                = LOOP
            End
            Flags = RANDOMSTART
            BeginScript
                CurDrawableHideSubObject("arrow")
                CurDrawableHideSubObject("arrownock")
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Moving_Bow" then CurDrawableSetTransitionAnimState("TRANS_BowToSword_Moving") end
            EndScript
        End

        AnimationState                    = MOVING
            StateName                        = Moving_Bow
            Animation
                AnimationName                = EUHaldir_RUNB
                AnimationMode                = LOOP
            End
            Flags = RANDOMSTART
            BeginScript
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("arrownock")
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Moving_Sword" then CurDrawableSetTransitionAnimState("TRANS_SwordToBow_Moving") end
            EndScript
        End

        AnimationState                        = SPECIAL_WEAPON_ONE
            Animation
                AnimationName                = EUHaldir_SPCA
                AnimationMode                = ONCE
            End
            FrameForPristineBonePositions    = 60
            BeginScript
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("arrownock")
            EndScript
        End



        AnimationState                    = CONTINUOUS_FIRE_MEAN
            Animation                        = HangFrameWhileCoasting
                AnimationName                = EUHaldir_ATA2
                AnimationMode                = MANUAL
                AnimationBlendTime            = 20
            End
            Flags                            = START_FRAME_LAST
            BeginScript
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("ARROWNOCK")
                if CurDrawablePrevAnimationState() == "STATE_Firing" then CurDrawableAllowToContinue() end
            EndScript
        End
        AnimationState                        = CONTINUOUS_FIRE_SLOW
            StateName                        = Ready_Bow
            Animation                        = PutAwayArrow
                AnimationName                = EUHaldir_ATA3
                AnimationMode                = ONCE
            End
            BeginScript
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("ARROWNOCK")
            EndScript
        End



        AnimationState                    = EMOTION_ALERT WEAPONSET_TOGGLE_1
            StateName                    = Ready_Sword
            Animation                        = Alert_1
                AnimationName                = EUHaldir_IDLST1
                AnimationMode                = LOOP
            End
            BeginScript
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
                if Prev == "Bored_Sword"        then CurDrawableSetTransitionAnimState("TRANS_BR_Sword")            end
                if Prev == "Selected_Sword"        then CurDrawableSetTransitionAnimState("TRANS_SR_Sword")            end
                if Prev == "Selected_Bow" or Prev == "Moving_Bow" or Prev == "Ready_Bow" or Prev == "Bored_Bow" or PrevAnim == "WantSword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BowToSword_Ready")
                end
            EndScript
        End
        AnimationState                    = ENGAGED WEAPONSET_TOGGLE_1
            StateName                    = Ready_Sword
            Animation                        = Alert_1
                AnimationName                = EUHaldir_IDLST1
                AnimationMode                = LOOP
            End
            BeginScript
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
                if Prev == "Bored_Sword"        then CurDrawableSetTransitionAnimState("TRANS_BR_Sword")            end
                if Prev == "Selected_Sword"        then CurDrawableSetTransitionAnimState("TRANS_SR_Sword")            end
                if Prev == "Selected_Bow" or Prev == "Moving_Bow" or Prev == "Ready_Bow" or Prev == "Bored_Bow" or PrevAnim == "WantSword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BowToSword_Ready")
                end
            EndScript
        End
        AnimationState                    = ATTACKING WEAPONSET_TOGGLE_1
            StateName                    = Ready_Sword
            Animation                        = Alert_1
                AnimationName                = EUHaldir_IDLST1
                AnimationMode                = LOOP
            End
            BeginScript
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("ArrowNock")

                CurDrawableHideSubObject("arrow")
                if Prev == "Bored_Sword"        then CurDrawableSetTransitionAnimState("TRANS_BR_Sword")            end
                if Prev == "Selected_Sword"        then CurDrawableSetTransitionAnimState("TRANS_SR_Sword")            end
                if Prev == "Selected_Bow" or Prev == "Moving_Bow" or Prev == "Ready_Bow" or Prev == "Bored_Bow" or PrevAnim == "WantSword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BowToSword_Ready")
                end
            EndScript
        End

        AnimationState                        = ATTACKING
            StateName                        = Ready_Bow
            Animation                        = IDLB
                AnimationName                = EUHaldir_IDLB
                AnimationMode                = LOOP
            End
            BeginScript
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("arrownock")
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Bored_Bow" then CurDrawableSetTransitionAnimState("TRANS_BR_Bow") end
                if Prev == "Selected_Bow" then CurDrawableSetTransitionAnimState("TRANS_SelectedToReady_Bow") end
                if Prev == "Selected_Sword" or Prev == "Moving_Sword" or Prev == "Ready_Sword" or Prev == "Bored_Sword" or PrevAnim == "WantBow"
                then
                    CurDrawableSetTransitionAnimState("TRANS_SwordToBow_Ready")
                end
            EndScript
        End

        AnimationState                    = EMOTION_ALERT
            StateName                    = Ready_Bow
            Animation                        = IDLB
                AnimationName                = EUHaldir_IDLB
                AnimationMode                = LOOP
            End
            BeginScript
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("arrownock")
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Bored_Bow"        then CurDrawableSetTransitionAnimState("TRANS_BR_Bow")                end
                if Prev == "Selected_Bow"    then CurDrawableSetTransitionAnimState("TRANS_SR_Bow")                end
                if Prev == "Selected_Sword" or Prev == "Moving_Sword" or Prev == "Ready_Sword" or Prev == "Bored_Sword" or PrevAnim == "WantBow"
                then
                    CurDrawableSetTransitionAnimState("TRANS_SwordToBow_Ready")
                end
            EndScript
        End

        AnimationState                    = RAISING_FLAG WEAPONSET_TOGGLE_1
            StateName                    = STATE_Emotion_Sword
            Animation                        = Sword
                AnimationName                = EUHaldir_CHRS
                AnimationMode                = ONCE
            End
            Animation                        = Sword2
                AnimationName                = EUHaldir_CHRS
                AnimationMode                = ONCE
            End
            Flags                        = MAINTAIN_FRAME_ACROSS_STATES RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("arrow")
                CurDrawableHideSubObject("arrownock")

                if PrevState == "STATE_Emotion_Bow"
                then
                    CurDrawableAllowToContinue()
                    if( CurDrawablePrevAnimFraction() > .89 )
                    then
                        CurDrawableSetTransitionAnimState("TRANS_BowToSword_Ready")
                    end
                elseif PrevState == "STATE_Emotion_Sword"
                then
                    CurDrawableAllowToContinue()
                elseif PrevState == "Selected_Sword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_SR_Sword")
                elseif PrevState == "Bored_Sword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BR_Sword")
                end
            EndScript
        End
        AnimationState                    = RAISING_FLAG
            StateName                    = STATE_Emotion_Bow
            Animation                        = Bow
                AnimationName                = EUHaldir_CHRB
                AnimationMode                = ONCE
            End
            Animation                        = Bow2
                AnimationName                = EUHaldir_CHRB
                AnimationMode                = ONCE
            End
            Flags                        = MAINTAIN_FRAME_ACROSS_STATES RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("arrownock")

                if PrevState == "STATE_Emotion_Sword"
                then
                    CurDrawableAllowToContinue()
                    if( CurDrawablePrevAnimFraction() > .89 )
                    then
                        CurDrawableSetTransitionAnimState("TRANS_SwordToBow_Ready")
                    end
                elseif PrevState == "STATE_Emotion_Bow"
                then
                    CurDrawableAllowToContinue()
                elseif PrevState == "Selected_Bow"
                then
                    CurDrawableSetTransitionAnimState("TRANS_SR_Bow")
                end
            EndScript
        End


        AnimationState                    = ENGAGED
            StateName                        = Ready_Bow
            Animation                        = IDLB
                AnimationName                = EUHaldir_IDLB
                AnimationMode                = LOOP
            End
            BeginScript
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("arrownock")
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Bored_Bow"        then CurDrawableSetTransitionAnimState("TRANS_BR_Bow")                end
                if Prev == "Selected_Bow"    then CurDrawableSetTransitionAnimState("TRANS_SelectedToReady_Bow")                end
                if Prev == "Selected_Sword" or Prev == "Moving_Sword" or Prev == "Ready_Sword" or Prev == "Bored_Sword" or PrevAnim == "WantBow"
                then
                    CurDrawableSetTransitionAnimState("TRANS_SwordToBow_Ready")
                end
            EndScript
        End







        AnimationState                    = EMOTION_CELEBRATING WEAPONSET_TOGGLE_1
            StateName                    = STATE_Emotion_Sword
            Animation                        = Sword
                AnimationName                = EUHaldir_CHRS
                AnimationMode                = ONCE
            End
            Animation                        = Sword2
                AnimationName                = EUHaldir_CHRS
                AnimationMode                = ONCE
            End
            Flags                        = MAINTAIN_FRAME_ACROSS_STATES RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("arrow")
                CurDrawableHideSubObject("arrownock")

                if PrevState == "STATE_Emotion_Bow"
                then
                    CurDrawableAllowToContinue()
                    if( CurDrawablePrevAnimFraction() > .89 )
                    then
                        CurDrawableSetTransitionAnimState("TRANS_BowToSword_Ready")
                    end
                elseif PrevState == "STATE_Emotion_Sword"
                then
                    CurDrawableAllowToContinue()
                elseif PrevState == "Selected_Sword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_SR_Sword")
                elseif PrevState == "Bored_Sword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BR_Sword")
                end
            EndScript
        End
        AnimationState                    = EMOTION_CELEBRATING
            StateName                    = STATE_Emotion_Bow
            Animation                        = Bow
                AnimationName                = EUHaldir_CHRB
                AnimationMode                = ONCE
            End
            Animation                        = Bow2
                AnimationName                = EUHaldir_CHRB
                AnimationMode                = ONCE
            End
            Flags                        = MAINTAIN_FRAME_ACROSS_STATES RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("arrownock")

                if PrevState == "STATE_Emotion_Sword"
                then
                    CurDrawableAllowToContinue()
                    if( CurDrawablePrevAnimFraction() > .89 )
                    then
                        CurDrawableSetTransitionAnimState("TRANS_SwordToBow_Ready")
                    end
                elseif PrevState == "STATE_Emotion_Bow"
                then
                    CurDrawableAllowToContinue()
                elseif PrevState == "Selected_Bow"
                then
                    CurDrawableSetTransitionAnimState("TRANS_SR_Bow")
                end
            EndScript
        End



        AnimationState                    = EMOTION_TAUNTING WEAPONSET_TOGGLE_1
            StateName                    = STATE_Emotion_Sword
            Animation                        = Sword
                AnimationName                = EUHaldir_TNTB
                AnimationMode                = ONCE
            End
            Animation                        = Sword2
                AnimationName                = EUHaldir_TNTB
                AnimationMode                = ONCE
            End
            Flags                        = RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("arrow")
                CurDrawableHideSubObject("arrownock")

                if PrevState == "STATE_Emotion_Bow"
                then
                    CurDrawableAllowToContinue()
                    if( CurDrawablePrevAnimFraction() > .89 )
                    then
                        CurDrawableSetTransitionAnimState("TRANS_BowToSword_Ready")
                    end
                elseif PrevState == "STATE_Emotion_Sword"
                    then
                        CurDrawableAllowToContinue()
                elseif PrevState == "Selected_Sword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_SR_Sword")
                elseif PrevState == "Bored_Sword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BR_Sword")
                end
            EndScript
        End
        AnimationState                    = EMOTION_TAUNTING
            StateName                    = STATE_Emotion_Bow
            Animation                        = Bow1
                AnimationName                = EUHaldir_TNTA
                AnimationMode                = ONCE
            End
            Animation                        = Bow2
                AnimationName                = EUHaldir_TNTA
                AnimationMode                = ONCE
            End
            Flags                        = RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("arrownock")

                if PrevState == "STATE_Emotion_Sword"
                then
                    CurDrawableAllowToContinue()
                    if( CurDrawablePrevAnimFraction() > .89 )
                    then
                        CurDrawableSetTransitionAnimState("TRANS_SwordToBow_Ready")
                    end
                elseif PrevState == "STATE_Emotion_Bow"
                then
                    CurDrawableAllowToContinue()
                elseif PrevState == "Selected_Bow"
                then
                    CurDrawableSetTransitionAnimState("TRANS_SR_Bow")
                elseif PrevState == "Bored_Bow"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BR_Bow")
                end
            EndScript
        End



        AnimationState                    = EMOTION_POINTING WEAPONSET_TOGGLE_1
            StateName                    = STATE_Emotion_Sword
            Animation                        = Sword
                AnimationName                = EUHaldir_PNTB
                AnimationMode                = ONCE
            End
            Animation                        = Sword2
                AnimationName                = EUHaldir_PNTB
                AnimationMode                = ONCE
            End
            Flags                        = MAINTAIN_FRAME_ACROSS_STATES RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("arrow")
                CurDrawableHideSubObject("arrownock")

                if PrevState == "STATE_Emotion_Bow"
                then
                    CurDrawableAllowToContinue()
                    if( CurDrawablePrevAnimFraction() > .89 )
                    then
                        CurDrawableSetTransitionAnimState("TRANS_BowToSword_Ready")
                    end
                elseif PrevState == "STATE_Emotion_Sword"
                then
                    CurDrawableAllowToContinue()
                elseif PrevState == "Selected_Sword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_SR_Sword")
                elseif PrevState == "Bored_Sword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BR_Sword")
                end
            EndScript
        End
        AnimationState                    = EMOTION_POINTING
            StateName                    = STATE_Emotion_Bow
            Animation                        = Bow
                AnimationName                = EUHaldir_PNTA
                AnimationMode                = ONCE
            End
            Animation                        = Bow2
                AnimationName                = EUHaldir_PNTA
                AnimationMode                = ONCE
            End
            Flags                        = MAINTAIN_FRAME_ACROSS_STATES RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("arrownock")

                if PrevState == "STATE_Emotion_Sword"
                then
                    CurDrawableAllowToContinue()
                    if( CurDrawablePrevAnimFraction() > .89 )
                    then
                        CurDrawableSetTransitionAnimState("TRANS_SwordToBow_Ready")
                    end
                elseif PrevState == "STATE_Emotion_Bow"
                then
                    CurDrawableAllowToContinue()
                elseif PrevState == "Selected_Bow"
                then
                    CurDrawableSetTransitionAnimState("TRANS_SR_Bow")
                elseif PrevState == "Bored_Bow"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BR_Bow")
                end
            EndScript
        End



        AnimationState                =    SELECTED WEAPONSET_TOGGLE_1
            StateName                =    Selected_Sword
            Animation                        = ATNA
                AnimationName                = EUHaldir_ATNS
                AnimationMode                = LOOP
            End
            BeginScript
                CurDrawableHideSubObject("ARROW")
                CurDrawableHideSubObject("ARROWNOCK")

                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Emotion_Bow" or Prev == "STATE_Emotion_Sword" then CurDrawableAllowToContinue() end
                if Prev == "Bored_Sword"        then CurDrawableSetTransitionAnimState("TRANS_BS_Sword")        end
                if Prev == "Ready_Sword"        then CurDrawableSetTransitionAnimState("TRANS_RS_Sword")        end
                if Prev == "Selected_Bow" or Prev == "Moving_Bow" or Prev == "Ready_Bow" or Prev == "Bored_Bow" or PrevAnim == "WantSword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BowToSword_Selected")
                end

            EndScript
        End

        AnimationState                =    SELECTED
            StateName                        = Selected_Bow
            Animation                        = ATNE
                AnimationName                = EUHaldir_ATNE
                AnimationMode                = LOOP
            End
            BeginScript
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("arrownock")
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Emotion_Bow" or Prev == "STATE_Emotion_Sword" then CurDrawableAllowToContinue() end
                if Prev == "Bored_Bow" then CurDrawableSetTransitionAnimState("TRANS_BoredToSelected_Bow") end
                if Prev == "Ready_Bow" then CurDrawableSetTransitionAnimState("TRANS_RS_Bow") end
                if Prev == "Selected_Sword" or Prev == "Moving_Sword" or Prev == "Ready_Sword" or Prev == "Bored_Sword" or PrevAnim == "WantBow"
                then
                    CurDrawableSetTransitionAnimState("TRANS_SwordToBow_Selected")
                end
            EndScript
        End




        AnimationState                        = HIT_REACTION HIT_LEVEL_1 WEAPONSET_TOGGLE_1
            StateName                        = Bored_Sword
            Animation
                AnimationName                = EUHaldir_HITE
                AnimationMode                = ONCE
            End
        End

        AnimationState                         = HIT_REACTION HIT_LEVEL_1
            StateName                        = Bored_Bow
            Animation
                AnimationName                = EUHaldir_HITA
                AnimationMode                 = ONCE
                AnimationSpeedFactorRange    = .9 .9
            End
        End




        AnimationState                    = WEAPONSET_TOGGLE_1
            StateName                    = Bored_Sword
            Animation                        = Idle_Sword1
                AnimationName                = EUHaldir_IDLF
                AnimationMode                = ONCE
            End
            Animation                        = Idle_Sword2
                AnimationName                = EUHaldir_IDLF
                AnimationMode                = ONCE
            End
            Animation                        = Idle_Sword3
                AnimationName                = EUHaldir_IDLF
                AnimationMode                = ONCE
            End
            Animation                        = IdleNoFidget
                AnimationName                = EUHaldir_IDLF
                AnimationMode                = ONCE
                AnimationPriority            = 20
            End
            Animation                        = IdleNoFidget2
                AnimationName                = EUHaldir_IDLF
                AnimationMode                = ONCE
                AnimationPriority            = 0
            End
            Flags                        = RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                CurDrawableHideSubObject("ARROW")
                CurDrawableHideSubObject("ARROWNOCK")

                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                if Prev == "TRANS_SB_Sword" or Prev == "TRANS_RB_Sword" then return "IdleNoFidget" end
                if Prev == "Selected_Sword"        then CurDrawableSetTransitionAnimState("TRANS_SB_Sword")        end
                if Prev == "Ready_Sword"        then CurDrawableSetTransitionAnimState("TRANS_RB_Sword")        end
                if Prev == "Selected_Bow" or Prev == "Moving_Bow" or Prev == "Ready_Bow" or Prev == "Bored_Bow" or PrevAnim == "WantSword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BowToSword_Selected")
                end
            EndScript
        End

        IdleAnimationState
            StateName                    = Bored_Bow
            Animation                        = IdleBowB
                AnimationName                = EUHaldir_IDLE
                AnimationMode                = ONCE
            End
            Animation                        = IdleBowD
                AnimationName                = EUHaldir_IDLE
                AnimationMode                = ONCE
            End
            Animation                        = IdleNoFidget
                AnimationName                = EUHaldir_IDLE
                AnimationMode                = ONCE
                AnimationPriority            = 20
            End
            Animation                        = IdleNoFidget2
                AnimationName                = EUHaldir_IDLE
                AnimationMode                = ONCE
                AnimationPriority            = 10
            End
            Flags                        = RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("arrownock")
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                if Prev == "TRANS_SB_Bow" or Prev == "TRANS_RB_Bow" then return "IdleNoFidget" end
                if Prev == "Selected_Bow"        then CurDrawableSetTransitionAnimState("TRANS_SB_Bow")        end
                if Prev == "Ready_Bow"            then CurDrawableSetTransitionAnimState("TRANS_RB_Bow")        end
                if Prev == "Selected_Sword" or Prev == "Moving_Sword" or Prev == "Ready_Sword" or Prev == "Bored_Sword" or PrevAnim == "WantBow"
                then
                    CurDrawableSetTransitionAnimState("TRANS_SwordToBow_Selected")
                end
            EndScript
        End




        TransitionState                   = TRANS_BS_Bow
            Animation
                AnimationName                = EUHaldir_ATNB
                AnimationMode                = ONCE
                AnimationBlendTime            = 10
            End
        End

        TransitionState                   = TRANS_SR_Bow
            Animation                        = ATNE
                AnimationName                = EUHaldir_IDLB
                AnimationMode                = ONCE
                AnimationBlendTime            = 10
            End
        End

        TransitionState                   = TRANS_SB_Bow
            Animation
                AnimationName                = EUHaldir_ATNB
                AnimationMode                = ONCE_BACKWARDS
            End
            Flags                        = START_FRAME_LAST
        End

        TransitionState                   = TRANS_RS_Bow
            Animation                        = ATNF
                AnimationName                = EUHaldir_IDLB
                AnimationMode                = ONCE_BACKWARDS
                AnimationBlendTime            = 10
            End
            Flags                        = START_FRAME_LAST
        End

        TransitionState                   = TRANS_BR_Bow
            Animation                        = IDLB
                AnimationName                = EUHaldir_IDLST1
                AnimationMode                = ONCE
                AnimationBlendTime            = 20
            End
        End

        TransitionState                   = TRANS_RB_Bow
            Animation                        = IDLD
                AnimationName                = EUHaldir_IDLB
                AnimationMode                = ONCE
                AnimationBlendTime            = 20
            End
        End



        TransitionState                        = TRANS_BoredToSelected_Bow
            Animation
                AnimationName                = EUHaldir_ATNB
                AnimationMode                = ONCE
                AnimationBlendTime            = 10
            End
        End


        TransitionState                        = TRANS_SelectedToReady_Bow
            Animation                        = ATNE
                AnimationName                = EUHaldir_IDLB
                AnimationMode                = ONCE
                AnimationBlendTime            = 10
            End
        End


        TransitionState                        = TRANS_SelectedToBored_Bow
            Animation
                AnimationName                = EUHaldir_ATNB
                AnimationMode                = ONCE_BACKWARDS
            End
            Flags                            = START_FRAME_LAST
        End


        TransitionState                        = TRANS_RS_Bow
            Animation                        = ATNF
                AnimationName                = EUHaldir_IDLB
                AnimationMode                = ONCE_BACKWARDS
                AnimationBlendTime            = 10
            End
            Flags                            = START_FRAME_LAST
        End


        TransitionState                        = TRANS_BR_Bow
            Animation                        = IDLB
                AnimationName                = EUHaldir_IDLST1
                AnimationMode                = ONCE
                AnimationBlendTime            = 20
            End
        End


        TransitionState                        = TRANS_RB_Bow
            Animation                        = IDLD
                AnimationName                = EUHaldir_IDLB
                AnimationMode                = ONCE
                AnimationBlendTime            = 20
            End
        End


        TransitionState                    = TRANS_BoredToSelected_Sword
            Animation                    = ATNA
                AnimationName            = EUHaldir_ATNA
                AnimationMode            = ONCE
            End
        End


        TransitionState                    = TRANS_SR_Sword
            Animation                    = ATNC
                AnimationName            = EUHaldir_STHA
                AnimationMode            = ONCE
            End
        End


        TransitionState                    = TRANS_SelectedToBored_Sword
            Animation                    = ATNA
                AnimationName            = EUHaldir_ATNA
                AnimationMode            = ONCE_BACKWARDS
            End
            Flags                        = START_FRAME_LAST
        End


        TransitionState                    = TRANS_ReadyToSelected_Sword
            Animation                    = ATNC
                AnimationName            = EUHaldir_IDLST1
                AnimationMode            = ONCE_BACKWARDS
                AnimationBlendTime        = 20
            End
            Flags                        = START_FRAME_LAST
        End


        TransitionState                    = TRANS_BR_Sword
            Animation                    = ATNS
                AnimationName            = EUHaldir_STHA
                AnimationMode            = ONCE
                AnimationBlendTime        = 20
            End
        End


        TransitionState                    = TRANS_RB_Sword
            Animation                    = IDLG
                AnimationName            = EUHaldir_STHA
                AnimationMode            = ONCE
                AnimationBlendTime        = 20
            End
        End



        TransitionState                    = TRANS_SwordToBow_Moving
            Animation                    = DrawBow
                AnimationName            = EUHaldir_STHC
                AnimationMode            = ONCE
            End
        End


        TransitionState                    = TRANS_BowToSword_Moving
            Animation                    = DrawSword
                AnimationName            = EUHaldir_STHD
                AnimationMode            = ONCE
            End
        End


        TransitionState                    = TRANS_BowToSword_Ready
            Animation                    = DrawSwords
                AnimationName            = EUHaldir_STHA
                AnimationMode            = ONCE
            End
        End


        TransitionState                    = TRANS_SwordToBow_Ready
            Animation                    = DrawBow
                AnimationName            = EUHaldir_STHB
                AnimationMode            = ONCE
            End
        End


        TransitionState                    = TRANS_BowToSword_Selected
            Animation                    = DrawSwords
                AnimationName            = EUHaldir_STHA
                AnimationMode            = ONCE
            End
        End


        TransitionState                    = TRANS_SwordToBow_Selected
            Animation                    = DrawBow
                AnimationName            = EUHaldir_STHB
                AnimationMode            = ONCE
            End
        End
    End

    #include "..\..\..\includes\StunDrawModuleSmall.inc"


    Side                        = Lothlorien
    EditorSorting               = UNIT
    ThreatLevel                 = HALDIR_THREAT_LEVEL
    ThingClass                  = CHARACTER_UNIT
    BuildCost                   = HALDIRDAG_COST
    BuildTime                   = MEDIUM_HERO_BUILDTIME
    TransportSlotCount          = TRANSPORTSLOTCOUNT_HERO
    VisionRange                 = VISION_HERO_RANGED
    ShroudClearingRange         = SHROUD_CLEAR_RANGED_HERO
    MaxVisionBonusPercent       = 300%
    VisionBonusTestRadius       = 200
    VisionBonusPercentPerFoot   = 1.0%
    BountyValue                 = ELVEN_HALDIR_BOUNTY_VALUE
    RecruitText                 = CONTROLBAR:HaldirRecruit_Rohan
    ReviveText                  = CONTROLBAR:HaldirRevive
    Hotkey                      = CONTROLBAR:ElvenHaldirHotkey
    DisplayName                 = OBJECT:ElvenHaldir
    CrushableLevel              = 2
    CommandSet                  = RohanHaldirCommandSet
    CommandPoints               = 0
    DisplayMeleeDamage          = HALDIRDAG_DAMAGE
    DisplayRangedDamage         = HALDIRDAG_DAMAGE
    HeroSortOrder               = 40

    IsTrainable                       = No
    MaxSimultaneousOfType             = 1


    WeaponSet
        Conditions              = None
        Weapon                  = PRIMARY HaldirBowEdain
        AutoChooseSources       = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End

    WeaponSet
        Conditions              = CONTAINED
        Weapon                  = PRIMARY HaldirBowEdain
        AutoChooseSources       = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End

    WeaponSet
        Conditions              = WEAPONSET_TOGGLE_1
        Weapon                  = PRIMARY HaldirSwordEdain
        AutoChooseSources       = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End

    ArmorSet
        Conditions      = None
        Armor           = MediumHeroArmor
        DamageFX        = NormalDamageFX
    End




    VoiceAttack                             = HaldirModVoiceAttack
    VoiceAttackAir                          = HaldirModVoiceAttack
    VoiceAttackCharge                       = HaldirModVoiceAttack
    VoiceAttackMachine                      = HaldirModVoiceAttack
    VoiceAttackStructure                    = HaldirModVoiceAttack
    VoiceFear                               = HaldirVoiceHelpMe
    VoiceGuard                              = HaldirModVoiceMove
    VoiceMove                               = HaldirModVoiceMove
    VoiceMoveToCamp                         = HaldirModVoiceMove
    VoiceMoveWhileAttacking                 = HaldirModVoiceMove
    VoicePriority                           = 85
    VoiceRetreatToCastle                    = HaldirModVoiceRetreat
    VoiceSelect                             = HaldirModVoiceSelect
    VoiceSelectBattle                       = HaldirModVoiceSelect
    VoiceCreated                            = HaldirModVoiceSalute
    VoiceFullyCreated                       = HaldirModVoiceSalute
    SoundImpact                             = ImpactHorse

    UnitSpecificSounds
        VoiceEnterUnitElvenTransportShip    = HaldirModVoiceMove
        VoiceGarrison                       = HaldirModVoiceMove
        VoiceInitiateCaptureBuilding        = HaldirModVoiceSelect
    End

    CrowdResponseKey = ElfHero

    #include "..\..\..\includes\StandardUnitEvaEvents.inc"
    EvaEventDieOwner                        = HaldirDie

    Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
        Key    = Humanoid_Male Elf Elf_Male Unit Infantry Hero
    End

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap                    = 800
        AnimationSound                        = Sound:ArrowDrawBow                    Animation:EUHaldir_SKL.EUHaldir_ATA1    Frames:6
        AnimationSound                        = Sound:ArrowDrawBow                    Animation:EUHaldir_SKL.EUHaldir_ATA2    Frames:18

        AnimationSound                        = Sound:SwordShingClean1                Animation:EUHaldir_SKL.EUHaldir_STHA     Frames:24
        AnimationSound                        = Sound:SwordIntoScabbard1                Animation:EUHaldir_SKL.EUHaldir_STHB     Frames:9
        AnimationSound                        = Sound:WeaponSwitchBow                    Animation:EUHaldir_SKL.EUHaldir_STHB     Frames:15

        AnimationSound                        = Sound:SwordShingClean1                 Animation:EUHaldir_SKL.EUHaldir_STHC     Frames:20
        AnimationSound                        = Sound:SwordIntoScabbard1                Animation:EUHaldir_SKL.EUHaldir_STHD     Frames:5
        AnimationSound                        = Sound:WeaponSwitchBow                 Animation:EUHaldir_SKL.EUHaldir_STHD     Frames:8

        AnimationSound                        = Sound:SwordShingClean1                 Animation:EUHaldir_SKL.EUHaldir_RUNC     Frames:14
        AnimationSound                        = Sound:SwordIntoScabbard1                Animation:EUHaldir_SKL.EUHaldir_RUNT     Frames:4
        AnimationSound                        = Sound:WeaponSwitchBow                 Animation:EUHaldir_SKL.EUHaldir_RUNT     Frames:16

        AnimationSound                        = Sound:BodyFallSoldier                    Animation:EUHaldir_SKL.EUHaldir_LNDA    Frames:9
        AnimationSound                        = Sound:BodyFallSoldier                    Animation:EUHaldir_SKL.EUHaldir_LNDB    Frames:1

        AnimationSound                        = Sound:BodyFallGenericNoArmor            Animation:EUHaldir_SKL.EUHaldir_DIEB     Frames:82
        AnimationSound                        = Sound:BodyFallSoldier                    Animation:EUHaldir_SKL.EUHaldir_DIEBV5     Frames:25
        AnimationSound                        = Sound:BodyFallSoldier                    Animation:EUHaldir_SKL.EUHaldir_DIESV4     Frames:26
        AnimationSound                        = Sound:BodyFallGenericNoArmor            Animation:EUHaldir_SKL.EUHaldir_DIESV5    Frames:100
    End






    RadarPriority                   = UNIT
    KindOf  			    = HERO PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE THROWN_OBJECT ARMY_SUMMARY ATTACK_NEEDS_LINE_OF_SIGHT HEAVY_MELEE_HITTER
    CamouflageDetectionMultiplier   = CAMOUFLAGE_DETECTION_DISTANCE_MEDIUM
    PathfindDiameter                = 40.0

    Body = RespawnBody ModuleTag_RespawnBody
        CheerRadius                          = EMOTION_CHEER_RADIUS
        MaxHealth                            = 2800
        PermanentlyKilledByFilter            = NONE
        DodgePercent                         = HERO_DODGE_PERCENT
    End

    Behavior = RespawnUpdate ModuleTag_RespawnUpdate
    End

    Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance               = 200
        TauntAndPointUpdateDelay            = 10000
        PointAt                             = ANY +HERO
        AddEmotion            =    Doom_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
        AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    Alert_Base
        AddEmotion            =    CheerForAboutToCrush_Base
    End

    Behavior = AutoHealBehavior ModuleTag_LegolasHealing
        StartsActive                        = Yes
        HealingAmount                        = HERO_HEAL_AMOUNT
        HealingDelay                        = 1000
        StartHealingDelay                    = HERO_HEAL_DELAY
        HealOnlyIfNotInCombat                = Yes
    End

    Behavior = AutoHealBehavior ModuleTag_ElvenGiftHealing
        StartsActive                 = No
        TriggeredBy                  = Upgrade_ElvenGift
        HealingAmount                = ELVEN_GIFT_REGEN_AMOUNT
        HealingDelay                 = ELVEN_GIFT_REGEN_DELAY
        StartHealingDelay 	     = HERO_HEAL_DELAY
        HealOnlyIfNotInCombat        = Yes
    End
    Behavior = AttributeModifierUpgrade ModuleTag_ElvenGiftBonus
        TriggeredBy = Upgrade_ElvenGift
        AttributeModifier = SpellBookElvenGifts
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate                        = Hero
    End

    Behavior = AIUpdateInterface ModuleTag_03
        AutoAcquireEnemiesWhenIdle            = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate                    = 500
        CanAttackWhileContained                = Yes
        AILuaEventsList                        = LegolasFunctions
    End

    #include "..\..\..\includes\DefaultInvisibilityUpdate.inc"

    Behavior = HitReactionBehavior HitReactionBehaviorModuleTag
        HitReactionLifeTimer1                = 1500
        HitReactionThreshold1                = 400
        FastHitsResetReaction                = Yes
    End

    ;Behavior = LifetimeUpdate ModuleTag_LifetimeUpdate
        ;MinLifetime              = 120000
        ;MaxLifetime              = 120000
        ;DeathType                = FADED
    ;End

    Behavior = AttributeModifierAuraUpdate ModuleTag_Leadership
        StartsActive                        = No
        BonusName                           = AnfuhrerGaladhrim
        TriggeredBy                         = Upgrade_Level_6
        RefreshDelay                        = 2000
        Range                               = 200
        ObjectFilter                        = ANY +INFANTRY SAME_PLAYER
    End

    Behavior = GrantUpgradeCreate ModuleTag_Enable
        UpgradeToGrant      = Upgrade_KhazadDumFaction
        GiveOnBuildComplete = Yes
    End

    Behavior = ObjectCreationUpgrade ModuleTag_GiveUpgrade3
        TriggeredBy     = Upgrade_Level_3
        Delay           = 0
        ThingToSpawn    = HaldirStufe3Ping
    End

    Behavior = ObjectCreationUpgrade ModuleTag_GiveUpgrade5
        TriggeredBy     = Upgrade_Level_5
        Delay           = 0
        ThingToSpawn    = HaldirStufe5Ping
    End

    Behavior = ObjectCreationUpgrade ModuleTag_GiveUpgrade7
        TriggeredBy     = Upgrade_Level_7
        Delay           = 0
        ThingToSpawn    = HaldirStufe7Ping
    End

    Behavior = ObjectCreationUpgrade ModuleTag_GiveUpgrade10
        TriggeredBy     = Upgrade_Level_10
        Delay           = 0
        ThingToSpawn    = HaldirStufe10Ping
    End





    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_HaldirBlueArrowUnpause
        SpecialPowerTemplate                = SpecialAbilityHaldirBlueArrow
        TriggeredBy                         = Upgrade_Level_2
    End

    Behavior = SpecialPowerModule ModuleTag_HaldirBlueArrowSpecialPower
        SpecialPowerTemplate                = SpecialAbilityHaldirBlueArrow
        StartsPaused                        = Yes
        UpdateModuleStartsAttack            = Yes
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_HaldirBlueArrowWeaponFireUpdate
        SpecialPowerTemplate                = SpecialAbilityHaldirBlueArrow
        WhichSpecialWeapon                  = 1
        UnpackTime                          = 600
        PreparationTime                     = 1
        PackTime                            = 2000
        StartAbilityRange                   = HALDIR_BOW_RANGE
        MustFinishAbility                   = Yes
        SpecialWeapon                       = HaldirBlueArrow
    End

    Behavior = AutoAbilityBehavior ModuleTag_BlueArrowAutoAbility
        SpecialAbility                      = SpecialAbilityHaldirBlueArrow
        MaxScanRange                        = HALDIR_BOW_RANGE
        Query                               = 1 ANY ENEMIES +HERO +MONSTER -STRUCTURE
        Query                               = 1 ANY ENEMIES +INFANTRY +CAVALRY -STRUCTURE
    End





    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_HaldirGoldenArrowUnpause
        SpecialPowerTemplate                = SpecialAbilityHaldirGoldenArrow
        TriggeredBy                         = Upgrade_Level_4
    End

    Behavior = SpecialPowerModule ModuleTag_HaldirGoldenArrowSpecialPower
        SpecialPowerTemplate                = SpecialAbilityHaldirGoldenArrow
        StartsPaused                        = Yes
        UpdateModuleStartsAttack            = Yes
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_HaldirGoldenArrowWeaponFireUpdate
        SpecialPowerTemplate                = SpecialAbilityHaldirGoldenArrow
        WhichSpecialWeapon                  = 1
        UnpackTime                          = 600
        PreparationTime                     = 1
        PackTime                            = 2000
        StartAbilityRange                   = HALDIR_BOW_RANGE
        MustFinishAbility                   = Yes
        SpecialWeapon                       = HaldirGoldenArrow
    End

    Behavior = AutoAbilityBehavior ModuleTag_GoldenArrowAutoAbility
        SpecialAbility                      = SpecialAbilityHaldirGoldenArrow
        MaxScanRange                        = HALDIR_BOW_RANGE
        Query                               = 1 ANY ENEMIES +HERO +MONSTER -STRUCTURE
        Query                               = 1 ANY ENEMIES +INFANTRY +CAVALRY -STRUCTURE
    End






    Behavior = SubObjectsUpgrade Armor_Upgrade
        TriggeredBy                         = Upgrade_Level_1
        UpgradeTexture                      = euhaldir.tga 0 euhaldir_c.tga
        ShowSubObjects                      = GNTL
        RecolorHouse                        = No
    End







    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_BoteEnabler
        SpecialPowerTemplate     = SpecialAbilitySchmiedekunstZwillinge
        TriggeredBy              = Upgrade_Level_6
    End

    Behavior = SpecialPowerModule ModuleTag_BoteStarter
        SpecialPowerTemplate     = SpecialAbilitySchmiedekunstZwillinge
        UpdateModuleStartsAttack = Yes
        StartsPaused             = Yes
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_BoteUpdate
        SpecialPowerTemplate     = SpecialAbilitySchmiedekunstZwillinge
        SkipContinue             = Yes
        UnpackTime               = 1100
        PreparationTime          = 1
        PersistentPrepTime       = 500
        PackTime                 = 500
        MustFinishAbility        = Yes
        AwardXPForTriggering     = 0
        StartAbilityRange        = 200
        SpecialWeapon            = BotederHoffnungWeapon
        WhichSpecialWeapon       = 2
    End







    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_PfeilregenEnabler
        SpecialPowerTemplate = SpecialAbilityUnablassigerPfeilregen
        TriggeredBy = Upgrade_Level_8
    End

    Behavior = SpecialPowerModule ModuleTag_PfeilregenUpdate
        SpecialPowerTemplate      = SpecialAbilityUnablassigerPfeilregen
        UpdateModuleStartsAttack  = Yes
        StartsPaused = Yes
        AttributeModifier = PfeilregenModifier
        AttributeModifierRange = 250
        AttributeModifierAffectsSelf = Yes
        AttributeModifierAffects = ANY +LothlorienHaldirsElves +LothlorienHaldir_Rohan ALLIES
        AttributeModifierFX = FX_HaldirPfeilregenFX
    End

    Behavior = SpecialAbilityUpdate ModuleTag_PfeilregenAnimation
        UnpackTime              = 1000
        UnpackingVariation      = 1
        SpecialPowerTemplate    = SpecialAbilityUnablassigerPfeilregen
        PreparationTime         = 0
        PersistentPrepTime      = 0
        PackTime                = 1330
     End





    Behavior = AttributeModifierAuraUpdate ModuleTag_GaladhrimUpgrade1
        StartsActive     = No
        TriggeredBy      = Upgrade_Level_3
        BonusName        = HaldirsGaladhrimUpgradeModifier1
        RefreshDelay     = 2000
        Range            = 9999999999
        ObjectFilter     = NONE +LothlorienHaldirsElves ALLIES
    End

    Behavior = AttributeModifierAuraUpdate ModuleTag_GaladhrimUpgrade2
        StartsActive     = No
        TriggeredBy      = Upgrade_Level_7
        BonusName        = HaldirsGaladhrimUpgradeModifier2
        RefreshDelay     = 2000
        Range            = 9999999999
        ObjectFilter     = NONE +LothlorienHaldirsElves ALLIES
    End



    LocomotorSet
        Locomotor                            = HumanLocomotor
        Condition                            = SET_NORMAL
        Speed                                = 67
    End

    LocomotorSet
        Locomotor                            = HumanWanderLocomotor
        Condition                            = SET_WANDER
        Speed                                = 62
    End

    LocomotorSet
        Locomotor                            = HumanPanicLocomotor
        Condition                            = SET_PANIC
        Speed                                = 67
    End

    LocomotorSet
        Locomotor                            = HumanScaredLocomotor
        Condition                            = SET_SCARED
        Speed                                = 67
    End

    Behavior = PhysicsBehavior ModuleTag_04
        GravityMult                          = 1.0
        ShockStandingTime                    = 2000
    End

    Behavior = SlowDeathBehavior ModuleTag_05
        DeathTypes                           = ALL -FADED
        SinkDelay                            = 3000
        SinkRate                             = 0.5
        DestructionDelay                     = 15000
        Sound                                = INITIAL HaldirModVoiceDie
        DeathFlags                           = DEATH_1
    End

    Behavior = SlowDeathBehavior ModuleTag_FadeDeath
        DeathTypes                            = NONE +FADED
        FadeDelay                            = 0
        FadeTime                            = 5000
        DestructionDelay                    = 5000
        DeathFlags                            = DEATH_2
        FX                                    = INITIAL FX_UnSummonElvenAllies
    End

    Behavior = SquishCollide ModuleTag_06
    End

    Behavior = BezierProjectileBehavior ModuleTag_08
        FirstHeight                            = 25
        SecondHeight                        = 25
        FirstPercentIndent                    = 30%
        SecondPercentIndent                    = 70%
        TumbleRandomly                        = Yes
        CrushStyle                            = Yes
        DieOnImpact                            = Yes
        BounceCount                            = 1
        BounceDistance                        = 41
        BounceFirstHeight                    = 25
        BounceSecondHeight                    = 25
        BounceFirstPercentIndent            = 20%
        BounceSecondPercentIndent            = 80%
        GroundHitFX                            = FX_ThrownRockGroundHit
        GroundBounceFX                        = FX_ThrownRockBounceHit
    End






    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Behavior = AISpecialPowerUpdate AToggleWeaponAI
        CommandButtonName = Command_ToggleHaldirWeapon
        SpecialPowerAIType = AI_SPECIAL_POWER_TOGGLE_MELEE_AND_RANGE
    End

    Behavior = AISpecialPowerUpdate BlueArrowAI
        CommandButtonName = Command_HaldirBlueArrow
        SpecialPowerAIType = AI_SPECIAL_POWER_ENEMY_TYPE_KILLER
        SpecialPowerRadius = 250
    End

    Behavior = AISpecialPowerUpdate GoldenArrowAI
        CommandButtonName = Command_HaldirGoldenArrow
        SpecialPowerAIType = AI_SPECIAL_POWER_ENEMY_TYPE_KILLER
        SpecialPowerRadius = 250
    End


    Scale = 0.95
    Geometry            = CYLINDER
    GeometryMajorRadius = 8.0
    GeometryHeight        = 19.2
    GeometryIsSmall        = Yes
    Shadow                = SHADOW_DECAL
    ShadowSizeX            = 19
    ShadowSizeY            = 19
    ShadowTexture        = ShadowI
End

