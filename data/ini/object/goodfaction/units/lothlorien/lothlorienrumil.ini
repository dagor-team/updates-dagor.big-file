Object LothlorienRumil

    SelectPortrait = HPRumil
    ButtonImage    = HIRumil

    DescriptionStrategic = CONTROLBAR:LW_ToolTip_SupportHero

    Draw = W3DScriptedModelDraw ModuleTag_DRAW
    OkToChangeModelColor = Yes
    StaticModelLODMode   = No
    ExtraPublicBone      = arrow

    RandomTexture = eurumil_L.tga 0 euhaldir_ha.tga
    RandomTexture = eulorien_qvr_L.tga 0 eulorien_qvr.tga
    RandomTexture = char_el_gear_01_L.tga 0 char_el_gear_01.tga



        DefaultModelConditionState
            Model                       = EUHALDIR_ARM
            Skeleton                    = euhaldir_skl
            WeaponLaunchBone            = PRIMARY ARROW
            WeaponLaunchBone            = SECONDARY ARROWNOCK
        End

        ModelConditionState    = INVISIBLE_STEALTH
            ParticleSysBone    = NONE Predator FollowBone:Yes Persist:SPAWN PersistID:100
            ParticleSysBone    = NONE Predator02 FollowBone:Yes Persist:SPAWN PersistID:100
        End



        AnimationState                        = PASSENGER
            StateName                        = STATE_Grabbed
            Animation                        = Bow
                AnimationName                = EUHaldir_FLYA
                AnimationMode                = LOOP
            End
        End
        AnimationState                        = PASSENGER WEAPONSET_TOGGLE_1
            StateName                        = STATE_Grabbed
            Animation                        = Sword
                AnimationName                = EUHaldir_FLYB
                AnimationMode                = LOOP
            End
        End


        AnimationState                        = FREEFALL
            StateName                        = STATE_Falling
            Animation                        = Bow
                AnimationName                = EUHaldir_FLYA
                AnimationMode                = LOOP
                AnimationBlendTime            = 10
                AnimationSpeedFactorRange    = 0.5    0.5
            End
        End
        AnimationState                        = FREEFALL WEAPONSET_TOGGLE_1
            StateName                        = STATE_Falling
            Animation                        = Sword
                AnimationName                = EUHaldir_FLYB
                AnimationMode                = LOOP
                AnimationBlendTime            = 10
                AnimationSpeedFactorRange    = 0.24 0.24
            End
        End


        AnimationState                        = STUNNED_FLAILING
            StateName                        = STATE_Fly
            Animation
                AnimationName                = EUHaldir_FLYA
                AnimationMode                = LOOP
                AnimationSpeedFactorRange    = 0.4 0.6
            End
            Flags                            = MAINTAIN_FRAME_ACROSS_STATES2
        End
        AnimationState                        = STUNNED_FLAILING WEAPONSET_TOGGLE_1
            StateName                        = STATE_Fly
            Animation                        = Sword
                AnimationName                = EUHaldir_FLYB
                AnimationMode                = LOOP
                AnimationSpeedFactorRange    = 0.4 0.6
            End
            Flags                            = MAINTAIN_FRAME_ACROSS_STATES2
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                PrevAnim = CurDrawablePrevAnimation()
                if PrevState == "Ready_Bow" or PrevState == "Moving_Bow" or PrevState == "Bored_Bow"
                then
                    CurDrawableShowSubObject("arrow")
                    CurDrawableShowSubObject("arrownock")
                    return "WantSword"
                elseif PrevState == "STATE_Fly"
                then
                    if PrevAnim == "Bow" or PrevAnim == "WantSword"
                    then
                        CurDrawableShowSubObject("arrow")
                        CurDrawableShowSubObject("arrownock")
                        return "WantSword"
                    end
                end
                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
                return "Sword"
            EndScript
        End


        AnimationState                        = DYING SPLATTED
            StateName                        = STATE_Dead
            Animation                        = Bow
                AnimationName                = EUHaldir_LNDA
                AnimationMode                = ONCE
            End
        End
        AnimationState                        = DYING SPLATTED WEAPONSET_TOGGLE_1
            StateName                        = STATE_Dead
            Animation                        = Sword
                AnimationName                = EUHaldir_LNDB
                AnimationMode                = ONCE
            End
        End


        AnimationState                        = DYING
            Animation                        = Bow1
                AnimationName                = EUHaldir_DIEBV5
                AnimationMode                = ONCE
            End
            Animation                        = Bow2
                AnimationName                = EUHaldir_DIEBV5
                AnimationMode                = ONCE
            End
            Animation                        = WantBow
                AnimationName                = EUHaldir_LNDA
                AnimationMode                = ONCE
            End
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                PrevAnim = CurDrawablePrevAnimation()
                if PrevState == "STATE_Fly"
                then
                    CurDrawableHideSubObject("ArrowNock")
                    CurDrawableHideSubObject("arrow")
                    return "WantBow"
                end
                if GetClientRandomNumberReal(0,2) < 1
                then
                    CurDrawableShowSubObject("arrow")
                    CurDrawableShowSubObject("arrownock")
                    return "Bow1"
                else
                    CurDrawableShowSubObject("arrow")
                    CurDrawableShowSubObject("arrownock")
                    return "Bow2"
                end
            EndScript
        End
        AnimationState                        = DYING WEAPONSET_TOGGLE_1
            Animation                        = Sword1
                AnimationName                = EUHaldir_DIESv5
                AnimationMode                = ONCE
            End
            Animation                        = Sword2
                AnimationName                = EUHaldir_DIESV5
                AnimationMode                = ONCE
            End
            Animation                        = WantSword
                AnimationName                = EUHaldir_LNDB
                AnimationMode                = ONCE
            End
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                PrevAnim = CurDrawablePrevAnimation()
                if PrevState == "STATE_Fly"
                then
                    CurDrawableShowSubObject("arrow")
                    CurDrawableShowSubObject("arrownock")
                    return "WantSword"
                end
                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
                if GetClientRandomNumberReal(0,2) < 1
                then
                    return "Sword1"
                else
                    return "Sword2"
                end
            EndScript
        End


        AnimationState                        = DYING DEATH_2
            Animation                        = FadeOut
                AnimationName                = EUHaldir_DIEBV5
                AnimationMode                = ONCE
            End
        End
        AnimationState                        = DYING DEATH_2 WEAPONSET_TOGGLE_1
            Animation                        = FadeOut
                AnimationName                = EUHaldir_DIESV5
                AnimationMode                = LOOP
            End
        End


        AnimationState                        = STUNNED_STANDING_UP
            StateName                        = STATE_GetUp
            Animation                        = Bow
                AnimationName                = EUHaldir_GTPB
                AnimationMode                = ONCE
                AnimationSpeedFactorRange    = 1.42 1.42
            End
            Animation                        = WantBow
                AnimationName                = EUHaldir_GTPSX1
                AnimationMode                = ONCE
            End
            Flags                        = MAINTAIN_FRAME_ACROSS_STATES4
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                PrevAnim = CurDrawablePrevAnimation()
                if PrevState == "STATE_GetUp" or PrevState == "STATE_Land"
                then
                    if PrevAnim == "WantBow" or PrevAnim == "Sword"
                    then
                        CurDrawableHideSubObject("ArrowNock")
                        CurDrawableHideSubObject("arrow")
                        return "WantBow"
                    end
                else
                    CurDrawableShowSubObject("arrow")
                    CurDrawableShowSubObject("arrownock")
                    return "Bow"
                end
            EndScript
        End
        AnimationState                        = STUNNED_STANDING_UP WEAPONSET_TOGGLE_1
            StateName                        = STATE_GetUp
            Animation                        = Sword
                AnimationName                = EUHaldir_GTPSX1
                AnimationMode                = ONCE
                AnimationSpeedFactorRange    = 1.2    1.2
            End
            Animation                        = WantSword
                AnimationName                = EUHaldir_GTPB
                AnimationMode                = ONCE
            End
            Flags                            = MAINTAIN_FRAME_ACROSS_STATES4
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                PrevAnim = CurDrawablePrevAnimation()
                if PrevState == "STATE_GetUp" or PrevState == "STATE_Land"
                then
                    if PrevAnim == "Bow" or PrevAnim == "WantSword"
                    then
                        CurDrawableShowSubObject("arrow")
                        CurDrawableShowSubObject("arrownock")
                        return "WantSword"
                    end
                end
                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
                return "Sword"
            EndScript
        End


        AnimationState                        = STUNNED
            StateName                        = STATE_Land
            Animation                        = Bow
                AnimationName                = EUHaldir_LNDA
                AnimationMode                = ONCE
            End
            Animation                        = WantBow
                AnimationName                = EUHaldir_LNDB
                AnimationMode                = ONCE
            End
            Flags                            = MAINTAIN_FRAME_ACROSS_STATES3
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                PrevAnim = CurDrawablePrevAnimation()
                if PrevState == "STATE_Fly"
                then
                    if PrevAnim == "WantBow" or PrevAnim == "Sword"
                    then
                        CurDrawableHideSubObject("ArrowNock")
                        CurDrawableHideSubObject("arrow")
                        return "WantBow"
                    end
                end
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("arrownock")
                return "Bow"
            EndScript
        End
        AnimationState                        = STUNNED WEAPONSET_TOGGLE_1
            StateName                        = STATE_Land
            Animation                        = Sword
                AnimationName                = EUHaldir_LNDB
                AnimationMode                = ONCE
            End
            Animation                        = WantSword
                AnimationName                = EUHaldir_LNDA
                AnimationMode                = ONCE
            End
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                PrevAnim = CurDrawablePrevAnimation()
                if PrevState == "STATE_Fly"
                then
                    if PrevAnim == "WantSword" or PrevAnim == "Bow"
                    then
                        CurDrawableShowSubObject("arrow")
                        CurDrawableShowSubObject("arrownock")
                        return "WantSword"
                    end
                end
                Flags                        = MAINTAIN_FRAME_ACROSS_STATES3
                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
                return "Sword"
            EndScript
        End

        AnimationState                        = PARALYZED
            Animation
                AnimationName                = EUHaldir_IDLF
                AnimationMode                = LOOP
            End
        End


        AnimationState                        = FIRING_OR_PREATTACK_A
            StateName                        = Attacking_Bow
            Animation
                AnimationName                = EUHaldir_ATA2
                AnimationMode                = ONCE
                UseWeaponTiming                = Yes
                AnimationBlendTime            = 20
            End
            BeginScript
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("ArrowNock")
            EndScript
        End
        AnimationState                        = FIRING_OR_PREATTACK_A WEAPONSET_TOGGLE_1
            StateName                        = Ready_Sword

            Animation                        = AttackWithSwordA
                AnimationName                = EUHaldir_ATKSV2
                AnimationMode                = ONCE
                UseWeaponTiming                = Yes
            End
            Animation                        = AttackWithSwordB
                AnimationName                = EUHaldir_ATKSV2
                AnimationMode                = ONCE
                UseWeaponTiming                = Yes
            End
            Animation                        = AttackWithSwordD
                AnimationName                = EUHaldir_ATKSV4
                AnimationMode                = ONCE
                UseWeaponTiming                = Yes
            End
            BeginScript
                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
            EndScript
        End

        AnimationState                        = SPECIAL_WEAPON_ONE
            Animation
                AnimationName                = EUHaldir_SPCA
                AnimationMode                = ONCE
            End
            FrameForPristineBonePositions    = 60
            BeginScript
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("arrownock")
            EndScript
        End


        AnimationState                        = MOVING
            StateName                        = Moving_Bow
            Animation
                AnimationName                = EUHaldir_RUNB
                AnimationMode                = LOOP
            End
            Flags = RANDOMSTART
            BeginScript
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("arrownock")
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Moving_Sword" then CurDrawableSetTransitionAnimState("TRANS_SwordToBow_Moving") end
            EndScript
        End
        AnimationState                        = MOVING WEAPONSET_TOGGLE_1
            StateName                        = Moving_Sword
            Animation
                AnimationName                = EUHaldir_RUNS
                AnimationMode                = LOOP
            End
            Flags = RANDOMSTART
            BeginScript
                CurDrawableHideSubObject("arrow")
                CurDrawableHideSubObject("arrownock")
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Moving_Bow" then CurDrawableSetTransitionAnimState("TRANS_BowToSword_Moving") end
            EndScript
        End


        AnimationState                        = PREATTACK_A
            Animation                        = ReadyToDrawn
                AnimationName                = EUHaldir_ATA1
                AnimationMode                = ONCE
                AnimationBlendTime            = 0
                UseWeaponTiming                = Yes
            End
            BeginScript
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("ArrowNock")
            EndScript
        End

        AnimationState                        = FIRING_OR_RELOADING_A
            StateName                        = STATE_Firing
            Animation
                AnimationName                = EUHaldir_ATA2
                AnimationMode                = ONCE
                AnimationBlendTime            = 30
                UseWeaponTiming                = Yes
                AnimationSpeedFactorRange    = 1.5 1.5
            End
            Flags                            = START_FRAME_FIRST
            BeginScript
                CurDrawableHideSubObject("arrow")
                CurDrawableHideSubObject("ArrowNock")
            EndScript
        End


        AnimationState                        = MOVING BACKING_UP
            StateName                        = STATE_BackingUp
            Animation                        = Bow
                AnimationName                = EUHaldir_BAKB
                AnimationMode                = LOOP
            End
            Animation                        = WantBow
                AnimationName                = EUHaldir_BAKS
                AnimationMode                = LOOP
            End
            Flags                            = MAINTAIN_FRAME_ACROSS_STATES4
            BeginScript
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("arrownock")
                PrevAnim    = CurDrawablePrevAnimation()
                PrevState    = CurDrawablePrevAnimationState()
                if PrevState == "STATE_BackingUp"
                then
                    if PrevAnim == "WantBow" or PrevAnim == "Sword"
                    then
                        return "WantBow"
                    end
                end
                return "Bow"
            EndScript
        End
        AnimationState                        = MOVING BACKING_UP WEAPONSET_TOGGLE_1
            StateName                        = STATE_BackingUp
            Animation                        = Sword
                AnimationName                = EUHaldir_BAKS
                AnimationMode                = LOOP
            End
            Animation                        = WantSword
                AnimationName                = EUHaldir_BAKS
                AnimationMode                = LOOP
            End
            Flags                            = MAINTAIN_FRAME_ACROSS_STATES4
            BeginScript
                CurDrawableHideSubObject("ARROW")
                CurDrawableHideSubObject("ARROWNOCK")
                PrevAnim    = CurDrawablePrevAnimation()
                PrevState    = CurDrawablePrevAnimationState()
                if PrevState == "STATE_BackingUp"
                then
                    if PrevAnim == "Bow" or PrevAnim == "WantSword"
                    then
                        return "WantSword"
                    end
                end
                return "Sword"
            EndScript
        End


        AnimationState                        = CONTINUOUS_FIRE_MEAN
            Animation                        = HangFrameWhileCoasting
                AnimationName                = EUHaldir_ATA2
                AnimationMode                = MANUAL
                AnimationBlendTime            = 20
            End
            Flags                            = START_FRAME_LAST
            BeginScript
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("ARROWNOCK")
                if CurDrawablePrevAnimationState() == "STATE_Firing" then CurDrawableAllowToContinue() end
            EndScript









        End
        AnimationState                        = CONTINUOUS_FIRE_SLOW
            StateName                        = Ready_Bow
            Animation                        = PutAwayArrow
                AnimationName                = EUHaldir_ATA3
                AnimationMode                = ONCE
            End
            BeginScript
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("ARROWNOCK")
            EndScript
        End


        AnimationState                        = ATTACKING
            StateName                        = Ready_Bow
            Animation                        = IDLB
                AnimationName                = EUHaldir_IDLB
                AnimationMode                = LOOP
            End
            BeginScript
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("arrownock")
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Bored_Bow" then CurDrawableSetTransitionAnimState("TRANS_BR_Bow") end
                if Prev == "Selected_Bow" then CurDrawableSetTransitionAnimState("TRANS_SelectedToReady_Bow") end
                if Prev == "Selected_Sword" or Prev == "Moving_Sword" or Prev == "Ready_Sword" or Prev == "Bored_Sword" or PrevAnim == "WantBow"
                then
                    CurDrawableSetTransitionAnimState("TRANS_SwordToBow_Ready")
                end
            EndScript
        End
        AnimationState                        = ATTACKING WEAPONSET_TOGGLE_1
            StateName                        = Ready_Sword
            Animation                        = Alert_1
                AnimationName                = EUHaldir_IDLST1
                AnimationMode                = LOOP
            End
            BeginScript
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
                if Prev == "Bored_Sword" then CurDrawableSetTransitionAnimState("TRANS_BR_Sword") end
                if Prev == "Selected_Bow" or Prev == "Moving_Bow" or Prev == "Ready_Bow" or Prev == "Bored_Bow" or PrevAnim == "WantSword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BowToSword_Ready")
                end
            EndScript
        End


        AnimationState                        = ENGAGED WEAPONSET_TOGGLE_1
            StateName                        = Ready_Bow
            Animation                        = IDLB
                AnimationName                = EUHaldir_IDLB
                AnimationMode                = LOOP
            End
            BeginScript
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("arrownock")
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Bored_Bow"        then CurDrawableSetTransitionAnimState("TRANS_BR_Bow")                end
                if Prev == "Selected_Bow"    then CurDrawableSetTransitionAnimState("TRANS_SelectedToReady_Bow")                end
                if Prev == "Selected_Sword" or Prev == "Moving_Sword" or Prev == "Ready_Sword" or Prev == "Bored_Sword" or PrevAnim == "WantBow"
                then
                    CurDrawableSetTransitionAnimState("TRANS_SwordToBow_Ready")
                end
            EndScript
        End
        AnimationState                        = ENGAGED WEAPONSET_TOGGLE_1
            StateName                        = Ready_Sword
            Animation                        = Alert_1
                AnimationName                = EUHaldir_IDLST1
                AnimationMode                = LOOP
            End
            BeginScript
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
                if Prev == "Bored_Sword"        then CurDrawableSetTransitionAnimState("TRANS_BR_Sword")            end
                if Prev == "Selected_Bow" or Prev == "Moving_Bow" or Prev == "Ready_Bow" or Prev == "Bored_Bow" or PrevAnim == "WantSword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BowToSword_Ready")
                end
            EndScript
        End


        AnimationState                        = EMOTION_ALERT
            StateName                        = Ready_Bow
            Animation                        = IDLB
                AnimationName                = EUHaldir_IDLB
                AnimationMode                = LOOP
            End
            BeginScript
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("arrownock")
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Bored_Bow"        then CurDrawableSetTransitionAnimState("TRANS_BR_Bow") end
                if Prev == "Selected_Bow"    then CurDrawableSetTransitionAnimState("TRANS_SelectedToReady_Bow") end
                if Prev == "Selected_Sword" or Prev == "Moving_Sword" or Prev == "Ready_Sword" or Prev == "Bored_Sword" or PrevAnim == "WantBow"
                then
                    CurDrawableSetTransitionAnimState("TRANS_SwordToBow_Ready")
                end
            EndScript
        End
        AnimationState                        = EMOTION_ALERT WEAPONSET_TOGGLE_1
            StateName                        = Ready_Sword
            Animation                        = Alert_1
                AnimationName                = EUHaldir_IDLST1
                AnimationMode                = LOOP
            End
            BeginScript
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
                if Prev == "Bored_Sword" then CurDrawableSetTransitionAnimState("TRANS_BR_Sword") end
                if Prev == "Selected_Bow" or Prev == "Moving_Bow" or Prev == "Ready_Bow" or Prev == "Bored_Bow" or PrevAnim == "WantSword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BowToSword_Ready")
                end
            EndScript
        End


        AnimationState                        = EMOTION_CELEBRATING
            StateName                        = STATE_Emotion_Bow
            Animation                        = Bow
                AnimationName                = EUHaldir_CHRB
                AnimationMode                = ONCE
            End
            Animation                        = Bow2
                AnimationName                = EUHaldir_CHRB
                AnimationMode                = ONCE
            End
            Flags                            = MAINTAIN_FRAME_ACROSS_STATES RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("arrownock")
                if PrevState == "STATE_Emotion_Sword"
                then
                    CurDrawableAllowToContinue()
                    if( CurDrawablePrevAnimFraction() > .89 )
                    then
                        CurDrawableSetTransitionAnimState("TRANS_SwordToBow_Ready")
                    end
                elseif PrevState == "STATE_Emotion_Bow"
                then
                    CurDrawableAllowToContinue()
                elseif PrevState == "Selected_Bow"
                then
                    CurDrawableSetTransitionAnimState("TRANS_SelectedToReady_Bow")
                end
            EndScript
        End
        AnimationState                        = EMOTION_CELEBRATING WEAPONSET_TOGGLE_1
            StateName                        = STATE_Emotion_Sword
            Animation                        = Sword
                AnimationName                = EUHaldir_CHRS
                AnimationMode                = ONCE
            End
            Animation                        = Sword2
                AnimationName                = EUHaldir_CHRS
                AnimationMode                = ONCE
            End
            Flags                            = MAINTAIN_FRAME_ACROSS_STATES RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("arrow")
                CurDrawableHideSubObject("arrownock")

                if PrevState == "STATE_Emotion_Bow"
                then
                    CurDrawableAllowToContinue()
                    if( CurDrawablePrevAnimFraction() > .89 )
                    then
                        CurDrawableSetTransitionAnimState("TRANS_BowToSword_Ready")
                    end
                elseif PrevState == "STATE_Emotion_Sword"
                then
                    CurDrawableAllowToContinue()
                elseif PrevState == "Bored_Sword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BR_Sword")
                end
            EndScript
        End



        AnimationState                        = EMOTION_TAUNTING
            StateName                        = STATE_Emotion_Bow
            Animation                        = Bow1
                AnimationName                = EUHaldir_TNTA
                AnimationMode                = ONCE
            End
            Animation                        = Bow2
                AnimationName                = EUHaldir_TNTA
                AnimationMode                = ONCE
            End
            Flags                            = RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("arrownock")

                if PrevState == "STATE_Emotion_Sword"
                then
                    CurDrawableAllowToContinue()
                    if( CurDrawablePrevAnimFraction() > .89 )
                    then
                        CurDrawableSetTransitionAnimState("TRANS_SwordToBow_Ready")
                    end
                elseif PrevState == "STATE_Emotion_Bow"
                then
                    CurDrawableAllowToContinue()
                elseif PrevState == "Selected_Bow"
                then
                    CurDrawableSetTransitionAnimState("TRANS_SelectedToReady_Bow")
                elseif PrevState == "Bored_Bow"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BR_Bow")
                end
            EndScript
        End
        AnimationState                        = EMOTION_TAUNTING WEAPONSET_TOGGLE_1
            StateName                        = STATE_Emotion_Sword
            Animation                        = Sword
                AnimationName                = EUHaldir_TNTB
                AnimationMode                = ONCE
            End
            Animation                        = Sword2
                AnimationName                = EUHaldir_TNTB
                AnimationMode                = ONCE
            End
            Flags                            = RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("arrow")
                CurDrawableHideSubObject("arrownock")
                if PrevState == "STATE_Emotion_Bow"
                then
                    CurDrawableAllowToContinue()
                    if( CurDrawablePrevAnimFraction() > .89 )
                    then
                        CurDrawableSetTransitionAnimState("TRANS_BowToSword_Ready")
                    end
                elseif PrevState == "STATE_Emotion_Sword"
                    then
                        CurDrawableAllowToContinue()
                elseif PrevState == "Bored_Sword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BR_Sword")
                end
            EndScript
        End


        AnimationState                        = EMOTION_POINTING
            StateName                        = STATE_Emotion_Bow
            Animation                        = Bow
                AnimationName                = EUHaldir_PNTA
                AnimationMode                = ONCE
            End
            Animation                        = Bow2
                AnimationName                = EUHaldir_PNTA
                AnimationMode                = ONCE
            End
            Flags                            = MAINTAIN_FRAME_ACROSS_STATES RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("arrownock")

                if PrevState == "STATE_Emotion_Sword"
                then
                    CurDrawableAllowToContinue()
                    if( CurDrawablePrevAnimFraction() > .89 )
                    then
                        CurDrawableSetTransitionAnimState("TRANS_SwordToBow_Ready")
                    end
                elseif PrevState == "STATE_Emotion_Bow"
                then
                    CurDrawableAllowToContinue()
                elseif PrevState == "Selected_Bow"
                then
                    CurDrawableSetTransitionAnimState("TRANS_SelectedToReady_Bow")
                elseif PrevState == "Bored_Bow"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BR_Bow")
                end
            EndScript
        End
        AnimationState                        = EMOTION_POINTING WEAPONSET_TOGGLE_1
            StateName                        = STATE_Emotion_Sword
            Animation                        = Sword
                AnimationName                = EUHaldir_PNTB
                AnimationMode                = ONCE
            End
            Animation                        = Sword2
                AnimationName                = EUHaldir_PNTB
                AnimationMode                = ONCE
            End
            Flags                            = MAINTAIN_FRAME_ACROSS_STATES RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("arrow")
                CurDrawableHideSubObject("arrownock")

                if PrevState == "STATE_Emotion_Bow"
                then
                    CurDrawableAllowToContinue()
                    if( CurDrawablePrevAnimFraction() > .89 )
                    then
                        CurDrawableSetTransitionAnimState("TRANS_BowToSword_Ready")
                    end
                elseif PrevState == "STATE_Emotion_Sword"
                then
                    CurDrawableAllowToContinue()
                elseif PrevState == "Bored_Sword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BR_Sword")
                end
            EndScript
        End


        AnimationState                         = HIT_REACTION HIT_LEVEL_1
            StateName                        = Bored_Bow
            Animation
                AnimationName                = EUHaldir_HITA
                AnimationMode                 = ONCE
                AnimationSpeedFactorRange    = .9 .9
            End
        End
        AnimationState                        = HIT_REACTION HIT_LEVEL_1 WEAPONSET_TOGGLE_1
            StateName                        = Bored_Sword
            Animation
                AnimationName                = EUHaldir_HITE
                AnimationMode                = ONCE
            End
        End

        AnimationState                        = RAISING_FLAG
            StateName                        = STATE_Emotion_Bow
            Animation                        = Bow
                AnimationName                = EUHaldir_CHRB
                AnimationMode                = ONCE
            End
            Animation                        = Bow2
                AnimationName                = EUHaldir_CHRB
                AnimationMode                = ONCE
            End
            Flags                            = RESTART_ANIM_WHEN_COMPLETE
        End

        AnimationState                        = SELECTED
            StateName                        = Selected_Bow
            Animation                        = ATNE
                AnimationName                = EUHaldir_ATNE
                AnimationMode                = LOOP
            End
            BeginScript
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("arrownock")
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Emotion_Bow" or Prev == "STATE_Emotion_Sword" then CurDrawableAllowToContinue() end
                if Prev == "Bored_Bow" then CurDrawableSetTransitionAnimState("TRANS_BoredToSelected_Bow") end
                if Prev == "Ready_Bow" then CurDrawableSetTransitionAnimState("TRANS_RS_Bow") end
                if Prev == "Selected_Sword" or Prev == "Moving_Sword" or Prev == "Ready_Sword" or Prev == "Bored_Sword" or PrevAnim == "WantBow"
                then
                    CurDrawableSetTransitionAnimState("TRANS_SwordToBow_Selected")
                end
            EndScript
        End

        AnimationState                        = RAISING_FLAG WEAPONSET_TOGGLE_1
            StateName                        = STATE_Emotion_Sword
            Animation                        = Sword
                AnimationName                = EUHaldir_CHRS
                AnimationMode                = ONCE
            End
            Animation                        = Sword2
                AnimationName                = EUHaldir_CHRS
                AnimationMode                = ONCE
            End
            Flags                            = RESTART_ANIM_WHEN_COMPLETE
        End

        AnimationState                        = SELECTED WEAPONSET_TOGGLE_1
            StateName                        = Selected_Sword
            Animation                        = ATNA
                AnimationName                = EUHaldir_ATNS
                AnimationMode                = LOOP
            End
            BeginScript
                CurDrawableHideSubObject("ARROW")
                CurDrawableHideSubObject("ARROWNOCK")
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Emotion_Bow" or Prev == "STATE_Emotion_Sword" then CurDrawableAllowToContinue() end
                if Prev == "Bored_Sword" then CurDrawableSetTransitionAnimState("TRANS_BoredToSelected_Sword") end
                if Prev == "Ready_Sword" then CurDrawableSetTransitionAnimState("TRANS_ReadyToSelected_Sword") end
                if Prev == "Selected_Bow" or Prev == "Moving_Bow" or Prev == "Ready_Bow" or Prev == "Bored_Bow" or PrevAnim == "WantSword" or PrevAnim == "EUHaldir_STHB"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BowToSword_Selected")
                end
            EndScript
        End

        AnimationState                        = WEAPONSET_TOGGLE_1
            StateName                        = Bored_Sword
            Animation                        = Idle_Sword1
                AnimationName                = EUHaldir_IDLF
                AnimationMode                = ONCE
            End
            Animation                        = Idle_Sword2
                AnimationName                = EUHaldir_IDLF
                AnimationMode                = ONCE
            End
            Animation                        = Idle_Sword3
                AnimationName                = EUHaldir_IDLF
                AnimationMode                = ONCE
            End
            Animation                        = IdleNoFidget
                AnimationName                = EUHaldir_IDLF
                AnimationMode                = ONCE
                AnimationPriority            = 20
            End
            Animation                        = IdleNoFidget2
                AnimationName                = EUHaldir_IDLF
                AnimationMode                = ONCE
                AnimationPriority            = 0
            End
            Flags                            = RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                CurDrawableHideSubObject("ARROW")
                CurDrawableHideSubObject("ARROWNOCK")
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                if Prev == "TRANS_SelectedToBored_Sword" or Prev == "TRANS_RB_Sword" then return "IdleNoFidget" end
                if Prev == "Selected_Sword" then CurDrawableSetTransitionAnimState("TRANS_SelectedToBored_Sword") end
                if Prev == "Ready_Sword" then CurDrawableSetTransitionAnimState("TRANS_RB_Sword") end
                if Prev == "Selected_Bow" or Prev == "Moving_Bow" or Prev == "Ready_Bow" or Prev == "Bored_Bow" or PrevAnim == "WantSword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BowToSword_Selected")
                end
            EndScript
        End


        IdleAnimationState
            StateName                        = Bored_Bow
            Animation                        = IdleBowB
                AnimationName                = EUHaldir_IDLE
                AnimationMode                = ONCE
            End
            Animation                        = IdleBowD
                AnimationName                = EUHaldir_IDLE
                AnimationMode                = ONCE
            End
            Animation                        = IdleNoFidget
                AnimationName                = EUHaldir_IDLE
                AnimationMode                = ONCE
                AnimationPriority            = 20
            End
            Animation                        = IdleNoFidget2
                AnimationName                = EUHaldir_IDLE
                AnimationMode                = ONCE
                AnimationPriority            = 10
            End
            Flags                            = RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("arrownock")
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                if Prev == "TRANS_SelectedToBored_Bow" or Prev == "TRANS_RB_Bow" then return "IdleNoFidget" end
                if Prev == "Selected_Bow" then CurDrawableSetTransitionAnimState("TRANS_SelectedToBored_Bow") end
                if Prev == "Ready_Bow" then CurDrawableSetTransitionAnimState("TRANS_RB_Bow") end
                if Prev == "Selected_Sword" or Prev == "Moving_Sword" or Prev == "Ready_Sword" or Prev == "Bored_Sword" or PrevAnim == "WantBow"
                then
                    CurDrawableSetTransitionAnimState("TRANS_SwordToBow_Selected")
                end
            EndScript
        End




        TransitionState                        = TRANS_BoredToSelected_Bow
            Animation
                AnimationName                = EUHaldir_ATNB
                AnimationMode                = ONCE
                AnimationBlendTime            = 10
            End
        End


        TransitionState                        = TRANS_SelectedToReady_Bow
            Animation                        = ATNE
                AnimationName                = EUHaldir_IDLB
                AnimationMode                = ONCE
                AnimationBlendTime            = 10
            End
        End


        TransitionState                        = TRANS_SelectedToBored_Bow
            Animation
                AnimationName                = EUHaldir_ATNB
                AnimationMode                = ONCE_BACKWARDS
            End
            Flags                            = START_FRAME_LAST
        End


        TransitionState                        = TRANS_RS_Bow
            Animation                        = ATNF
                AnimationName                = EUHaldir_IDLB
                AnimationMode                = ONCE_BACKWARDS
                AnimationBlendTime            = 10
            End
            Flags                            = START_FRAME_LAST
        End


        TransitionState                        = TRANS_BR_Bow
            Animation                        = IDLB
                AnimationName                = EUHaldir_IDLST1
                AnimationMode                = ONCE
                AnimationBlendTime            = 20
            End
        End


        TransitionState                        = TRANS_RB_Bow
            Animation                        = IDLD
                AnimationName                = EUHaldir_IDLB
                AnimationMode                = ONCE
                AnimationBlendTime            = 20
            End
        End


        TransitionState                    = TRANS_BoredToSelected_Sword
            Animation                    = ATNA
                AnimationName            = EUHaldir_ATNA
                AnimationMode            = ONCE
            End
        End


        TransitionState                    = TRANS_SR_Sword
            Animation                    = ATNC
                AnimationName            = EUHaldir_STHA
                AnimationMode            = ONCE
            End
        End


        TransitionState                    = TRANS_SelectedToBored_Sword
            Animation                    = ATNA
                AnimationName            = EUHaldir_ATNA
                AnimationMode            = ONCE_BACKWARDS
            End
            Flags                        = START_FRAME_LAST
        End


        TransitionState                    = TRANS_ReadyToSelected_Sword
            Animation                    = ATNC
                AnimationName            = EUHaldir_IDLST1
                AnimationMode            = ONCE_BACKWARDS
                AnimationBlendTime        = 20
            End
            Flags                        = START_FRAME_LAST
        End


        TransitionState                    = TRANS_BR_Sword
            Animation                    = ATNS
                AnimationName            = EUHaldir_STHA
                AnimationMode            = ONCE
                AnimationBlendTime        = 20
            End
        End


        TransitionState                    = TRANS_RB_Sword
            Animation                    = IDLG
                AnimationName            = EUHaldir_STHA
                AnimationMode            = ONCE
                AnimationBlendTime        = 20
            End
        End



        TransitionState                    = TRANS_SwordToBow_Moving
            Animation                    = DrawBow
                AnimationName            = EUHaldir_STHC
                AnimationMode            = ONCE
            End
        End


        TransitionState                    = TRANS_BowToSword_Moving
            Animation                    = DrawSword
                AnimationName            = EUHaldir_STHD
                AnimationMode            = ONCE
            End
        End


        TransitionState                    = TRANS_BowToSword_Ready
            Animation                    = DrawSwords
                AnimationName            = EUHaldir_STHA
                AnimationMode            = ONCE
            End
        End


        TransitionState                    = TRANS_SwordToBow_Ready
            Animation                    = DrawBow
                AnimationName            = EUHaldir_STHB
                AnimationMode            = ONCE
            End
        End


        TransitionState                    = TRANS_BowToSword_Selected
            Animation                    = DrawSwords
                AnimationName            = EUHaldir_STHA
                AnimationMode            = ONCE
            End
        End


        TransitionState                    = TRANS_SwordToBow_Selected
            Animation                    = DrawBow
                AnimationName            = EUHaldir_STHB
                AnimationMode            = ONCE
            End
        End
    End


    Draw = W3DScriptedModelDraw Icon
        ModelConditionState = NONE
            Model           = bbox
        End
    End




    #include "..\..\..\includes\StunDrawModuleSmall.inc"




    Side                         = Lothlorien
    EditorSorting                = UNIT
    ThreatLevel                  = HALDIR_THREAT_LEVEL
    ThingClass                   = CHARACTER_UNIT
    BuildCost                    = 500
    BuildTime                    = VERY_WEAK_HERO_BUILDTIME
    TransportSlotCount           = TRANSPORTSLOTCOUNT_HERO
    VisionRange                  = VISION_HERO_RANGED
    ShroudClearingRange          = SHROUD_CLEAR_RANGED_HERO
    MaxSimultaneousOfType        = 1
    MaxVisionBonusPercent        = 300%
    VisionBonusTestRadius        = 200
    VisionBonusPercentPerFoot    = 1.0%
    BountyValue                  = ELVEN_HALDIR_BOUNTY_VALUE
    RecruitText                  = CONTROLBAR:LothlorienHaldirsBruderRecruit
    ReviveText                   = CONTROLBAR:LothlorienHaldirsBruderRevive
    Hotkey                       = CONTROLBAR:LothlorienHaldirsBruderHotkey
    DisplayName                  = OBJECT:LothlorienRumil
    CrushableLevel               = 2
    CommandSet                   = LothlorienRumilCommandSet
    CommandPoints                = 0
    DisplayRangedDamage          = 125
    HeroSortOrder                = 40


    WeaponSet
        Conditions               = None
        Weapon            		 = PRIMARY RumilBowWeapon
        AutoChooseSources        = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End

    WeaponSet
        Conditions               = CONTAINED
        Weapon            		 = PRIMARY RumilBowWeapon
        AutoChooseSources        = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End

    WeaponSet
        Conditions               = WEAPONSET_HERO_MODE
        Weapon                   = PRIMARY RumilSilverthornBowWeapon
        AutoChooseSources        = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End


    ArmorSet
        Conditions      = None
        Armor           = VeryWeakHeroArmor
        DamageFX        = NormalDamageFX
    End

    ArmorSet
        Conditions      = PLAYER_UPGRADE
        Armor           = WeakHeroArmor
        DamageFX        = NormalDamageFX
    End




    VoiceAttack                             = HaldirVoiceAttack
    VoiceAttackAir                            = HaldirVoiceAttack
    VoiceAttackCharge                         = HaldirVoiceAttackCharge
    VoiceAttackMachine                         = HaldirVoiceAttack
    VoiceAttackStructure                     = HaldirVoiceAttackBuilding
    VoiceFear                                = HaldirVoiceHelpMe
    VoiceGuard                                = HaldirVoiceMove
    VoiceMove                                 = HaldirVoiceMove
    VoiceMoveToCamp                         = HaldirVoiceMoveCamp
    VoiceMoveWhileAttacking                 = HaldirVoiceDisengage
    VoicePriority                            = 80
    VoiceRetreatToCastle                     = HaldirVoiceRetreat
    VoiceSelect                             = HaldirVoiceSelectMS
    VoiceSelectBattle                          = HaldirVoiceSelectBattle

    SoundImpact                                = ImpactHorse

    UnitSpecificSounds
        VoiceEnterUnitElvenTransportShip    = HaldirVoiceMoveShip
        VoiceGarrison                        = HaldirVoiceMoveGarrison
        VoiceInitiateCaptureBuilding        = HaldirVoiceCaptureBuilding
    End

    Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
        Key    = Humanoid_Male Elf Elf_Male Unit Infantry Hero
    End

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound:ArrowDrawBow                    Animation:RUElfWar_SKL.RUElfWar_ATKA1    Frames:6
        AnimationSound = Sound:ArrowDrawBow                    Animation:RUElfWar_SKL.RUElfWar_ATKA2    Frames:18

        AnimationSound = Sound:SwordShingClean1ForHordes         Animation:RUElfWar_SKL.RUElfWar_STHA     Frames:24
        AnimationSound = Sound:SwordIntoScabbard1ForHordes        Animation:RUElfWar_SKL.RUElfWar_STHB     Frames:9
        AnimationSound = Sound:WeaponSwitchBowForHordes             Animation:RUElfWar_SKL.RUElfWar_STHB     Frames:15

        AnimationSound = Sound:SwordShingClean1ForHordes         Animation:RUElfWar_SKL.RUElfWar_STHC     Frames:20
        AnimationSound = Sound:SwordIntoScabbard1ForHordes        Animation:RUElfWar_SKL.RUElfWar_STHD     Frames:5
        AnimationSound = Sound:WeaponSwitchBowForHordes         Animation:RUElfWar_SKL.RUElfWar_STHD     Frames:8

        AnimationSound = Sound:SwordShingClean1ForHordes         Animation:RUElfWar_SKL.RUElfWar_RUNC     Frames:14
        AnimationSound = Sound:SwordIntoScabbard1ForHordes         Animation:RUElfWar_SKL.RUElfWar_RUNT     Frames:4
        AnimationSound = Sound:WeaponSwitchBowForHordes         Animation:RUElfWar_SKL.RUElfWar_RUNT     Frames:16

        AnimationSound = Sound:BodyFallSoldier                Animation:RUElfWar_SKL.RUElfWar_LNDA    Frames:9
        AnimationSound = Sound:BodyFallSoldier                Animation:RUElfWar_SKL.RUElfWar_LNDB    Frames:1

        AnimationSound = Sound:BodyFallGenericNoArmor            Animation:RUElfWar_SKL.RUElfWar_DIEB     Frames:82
        AnimationSound = Sound:BodyFallSoldier                Animation:RUElfWar_SKL.RUElfWar_DIEBV5     Frames:25
        AnimationSound = Sound:BodyFallSoldier                Animation:RUElfWar_SKL.RUElfWar_DIESV4     Frames:26
        AnimationSound = Sound:BodyFallGenericNoArmor            Animation:RUElfWar_SKL.RUElfWar_DIESV5    Frames:100
    End

    EvaEventDamagedOwner        = UnitUnderAttack



    RadarPriority = UNIT
    KindOf = HERO PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE ARMY_SUMMARY ATTACK_NEEDS_LINE_OF_SIGHT MOVE_FOR_NOONE
    CamouflageDetectionMultiplier            = CAMOUFLAGE_DETECTION_DISTANCE_MEDIUM
    PathfindDiameter                        = 40.0

    Body = RespawnBody ModuleTag_RespawnBody
        CheerRadius                         = EMOTION_CHEER_RADIUS
        MaxHealth                           = 2000
        PermanentlyKilledByFilter           = NONE
        DodgePercent                        = HERO_DODGE_PERCENT
    End

    Behavior = RespawnUpdate ModuleTag_RespawnUpdate
        DeathAnim                            = DYING
        DeathAnimationTime                   = 3000
        RespawnAnim                          = LEVELED
        RespawnAnimationTime                 = 2000
        AutoRespawnAtObjectFilter            = NONE +CASTLE_KEEP
        ButtonImage                          = HIRumil

        RespawnRules =    AutoSpawn:No           Cost:300        Time:VERY_WEAK_HERO_RESPAWNTIME        Health:100%
    End

    Behavior = ObjectCreationUpgrade ModuleTag_Orophin
        TriggeredBy     = Upgrade_Level_1
        Delay           = 1000
	ConflictsWith	= Upgrade_ObjectUnderAIControl
        ThingToSpawn    = LothlorienOrophin
    End


    Behavior = PassiveAreaEffectBehavior ModuleTag_TaurielKampf
        EffectRadius            = 300
        PingDelay               = 2000
        UpgradeRequired         = Upgrade_TestBuilding_2
        ModifierName            = RumilTaurielModifier
        AllowFilter             = ANY +LothlorienTauriel ALLIES
    End





    Behavior = ObjectCreationUpgrade ModuleTag_GiveUpgradeForRespawnLevel2
        TriggeredBy     = Upgrade_Level_2
        Delay           = 0
        ThingToSpawn    = Held2RespawnLevel
    End

    Behavior = LevelUpUpgrade ModuleTag_RespawnLevel2
        TriggeredBy     = Upgrade_Held2RespawnLevel
        RequiresAllTriggers = Yes
        LevelsToGain    = 1
        LevelCap        = 2
    End

    Behavior = ObjectCreationUpgrade ModuleTag_GiveUpgradeForRespawnLevel3
        TriggeredBy     = Upgrade_Level_3
        Delay           = 0
        ThingToSpawn    = Held3RespawnLevel
    End

    Behavior = LevelUpUpgrade ModuleTag_RespawnLevel3
        TriggeredBy     = Upgrade_Held3RespawnLevel
        RequiresAllTriggers = Yes
        LevelsToGain    = 1
        LevelCap        = 3
    End

    Behavior = ObjectCreationUpgrade ModuleTag_GiveUpgradeForRespawnLevel4
        TriggeredBy     = Upgrade_Level_4
        Delay           = 0
        ThingToSpawn    = Held4RespawnLevel
    End

    Behavior = LevelUpUpgrade ModuleTag_RespawnLevel4
        TriggeredBy     = Upgrade_Held4RespawnLevel
        RequiresAllTriggers = Yes
        LevelsToGain    = 1
        LevelCap        = 4
    End

    Behavior = ObjectCreationUpgrade ModuleTag_GiveUpgradeForRespawnLevel5
        TriggeredBy     = Upgrade_Level_5
        Delay           = 0
        ThingToSpawn    = Held5RespawnLevel
    End

    Behavior = LevelUpUpgrade ModuleTag_RespawnLevel5
        TriggeredBy     = Upgrade_Held5RespawnLevel
        RequiresAllTriggers = Yes
        LevelsToGain    = 1
        LevelCap        = 5
    End

    Behavior = ObjectCreationUpgrade ModuleTag_GiveUpgradeForRespawnLevel6
        TriggeredBy     = Upgrade_Level_6
        Delay           = 0
        ThingToSpawn    = Held6RespawnLevel
    End

    Behavior = LevelUpUpgrade ModuleTag_RespawnLevel6
        TriggeredBy     = Upgrade_Held6RespawnLevel
        RequiresAllTriggers = Yes
        LevelsToGain    = 1
        LevelCap        = 6
    End

    Behavior = ObjectCreationUpgrade ModuleTag_GiveUpgradeForRespawnLevel7
        TriggeredBy     = Upgrade_Level_7
        Delay           = 0
        ThingToSpawn    = Held7RespawnLevel
    End

    Behavior = LevelUpUpgrade ModuleTag_RespawnLevel7
        TriggeredBy     = Upgrade_Held7RespawnLevel
        RequiresAllTriggers = Yes
        LevelsToGain    = 1
        LevelCap        = 7
    End

    Behavior = ObjectCreationUpgrade ModuleTag_GiveUpgradeForRespawnLevel8
        TriggeredBy     = Upgrade_Level_8
        Delay           = 0
        ThingToSpawn    = Held8RespawnLevel
    End

    Behavior = LevelUpUpgrade ModuleTag_RespawnLevel8
        TriggeredBy     = Upgrade_Held8RespawnLevel
        RequiresAllTriggers = Yes
        LevelsToGain    = 1
        LevelCap        = 8
    End

    Behavior = ObjectCreationUpgrade ModuleTag_GiveUpgradeForRespawnLevel9
        TriggeredBy     = Upgrade_Level_9
        Delay           = 0
        ThingToSpawn    = Held9RespawnLevel
    End

    Behavior = LevelUpUpgrade ModuleTag_RespawnLevel9
        TriggeredBy     = Upgrade_Held9RespawnLevel
        RequiresAllTriggers = Yes
        LevelsToGain    = 1
        LevelCap        = 9
    End












    Behavior = SpecialPowerModule ModuleTag_ElfCloakStarter
        SpecialPowerTemplate      = SpecialAbilityElfCloak
        UpdateModuleStartsAttack  = Yes
    End

    Behavior = ToggleHiddenSpecialAbilityUpdate ModuleTag_ElfCloakUpdate
        SpecialPowerTemplate    = SpecialAbilityElfCloak
        AwardXPForTriggering    = 0
    End

    Behavior = InvisibilityUpdate ModuleTag_Camouflage
        InvisibilityNugget
            InvisibilityType        = CAMOUFLAGE
            ForbiddenConditions     = TAKING_DAMAGE FIRING_ANY USING_ABILITY
            DetectionRange          = CAMOUFLAGE_RADIUS
            Options                 = ALLOW_NEAR_TREES
        End
        UnitSpecificSoundNameToUseAsVoiceMoveToStealthyArea           = VoiceMoveToTrees
        UnitSpecificSoundNameToUseAsVoiceEnterStateMoveToStealthyArea = VoiceEnterStateMoveToTrees
        StartsActive                = Yes
        UpdatePeriod                = 2000
    End







    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_WoundArrowUnpause
        SpecialPowerTemplate      = SpecialAbilityWoundArrow
        TriggeredBy               = Upgrade_Level_1
    End

    Behavior = SpecialPowerModule ModuleTag_WoundArrow
        SpecialPowerTemplate      = SpecialAbilityWoundArrow
        UpdateModuleStartsAttack  = Yes
        StartsPaused              = Yes
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_WoundArrowUpdate
        SpecialPowerTemplate    = SpecialAbilityWoundArrow
        SkipContinue            = Yes
        UnpackTime              = 600
        PackTime                = 2000
        PreparationTime         = 1
        PersistentPrepTime      = 1000
        AwardXPForTriggering    = 0
        StartAbilityRange       = HALDIR_BOW_RANGE
        ApproachRequiresLOS     = Yes
        MustFinishAbility       = Yes
        SpecialWeapon           = OrophinWoundArrow
        WhichSpecialWeapon      = 1
    End

    Behavior = AutoAbilityBehavior ModuleTag_WoundArrowAutoAbility
    SpecialAbility        = SpecialAbilityWoundArrow
    ForbiddenStatus     = INSIDE_GARRISON
    MaxScanRange        = FARAMIR_WOUNDING_ARROW_RANGE
    Query            = 1 ANY ENEMIES +MONSTER +HERO
    End






    Behavior = SpecialPowerModule ModuleTag_AragornAthelas
        SpecialPowerTemplate      = SpecialAbilityAragornAthelas
        UpdateModuleStartsAttack  = Yes
        TriggerFX                 = FX_SpellLembasbrotHealUnitHealBuff
        SetModelCondition         = ModelConditionState:USER_2
        SetModelConditionTime     = 2.1
    End

    Behavior = SpecialAbilityUpdate ModuleTag_AragornAthelasUpdate
        SpecialPowerTemplate      = SpecialAbilityAragornAthelas
        StartAbilityRange         = 1.6
        UnpackTime                = 1
        PreparationTime           = 3
        PackTime                  = 2096
        AwardXPForTriggering      = 0
    End

    Behavior = AutoAbilityBehavior ModuleTag_AthelasAutoAbility
        SpecialAbility            = SpecialAbilityAragornAthelas
        MaxScanRange              = 150
        Query                     = 1 NONE +HERO ALLIES
    End


    Behavior = AutoHealBehavior ModuleTag_AthelasHealing
        StartsActive              = Yes
        ButtonTriggered           = Yes
        HealingAmount             = 300
        Radius                    = 1
        HealOnlyOthers            = No
        SingleBurst               = Yes
        UnitHealPulseFX           = FX_SpellLembasbrotHealUnitHealBuff
        KindOf                    = HERO
    End







    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_SternenpfeileEnabler
        SpecialPowerTemplate  = SpecialAbilityAragornBladeMaster
        TriggeredBy           = Upgrade_Level_5
    End

    Behavior = SpecialPowerModule ModuleTag_SternenpfeileStarter
        SpecialPowerTemplate  = SpecialAbilityAragornBladeMaster
        StartsPaused          = Yes
    End

    Behavior = HeroModeSpecialAbilityUpdate ModuleTag_SternenpfeileUpdate
        SpecialPowerTemplate  = SpecialAbilityAragornBladeMaster
        HeroAttributeModifier = OrophinSpellBonus
        HeroEffectDuration    = 30000
        UnpackTime            = 1
        TriggerSound          = AragornBladeMaster
    End

    Behavior = AutoAbilityBehavior ModuleTag_SternenpfeileAutoAbility
	SpecialAbility		= SpecialAbilityAragornBladeMaster
	ForbiddenStatus 	= INSIDE_GARRISON
	MaxScanRange		= 250
	Query			= 5 ALL ENEMIES
	Query			= 1 ANY ENEMIES +HERO +MONSTER
   End





    Behavior = AttributeModifierAuraUpdate ModuleTag_Leadership
        StartsActive                        = No
        BonusName                           = KampfrustungRumil
        TriggeredBy                         = Upgrade_GeschenkeLoriens
        RefreshDelay                        = 2000
        Range                               = 1
        AllowSelf                           = Yes
        AntiCategory                        = BUFF
        ObjectFilter                        = NONE +LothlorienRumil ALLIES
    End

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_HaldirLeadership
        SpecialPowerTemplate                = SpecialAbilityFakeLeadership
        TriggeredBy                         = Upgrade_GeschenkeLoriens
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI1
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 250000
        GrantUpgrade = Upgrade_GeschenkeLoriens
    End

    Behavior = SpecialPowerModule ModuleTag_HaldirLeadershipUpdate
        SpecialPowerTemplate                = SpecialAbilityFakeLeadership
        UpdateModuleStartsAttack            = No
        StartsPaused                        = Yes
    End


    Behavior = ArmorUpgrade ModuleTag_ArmorUpgrade
        TriggeredBy                         = Upgrade_GeschenkeLoriens
        ArmorSetFlag                        = PLAYER_UPGRADE
    End



    Behavior = SubObjectsUpgrade ModuleTag_Making
        TriggeredBy       = Upgrade_AllFactionUpgrade
        HideSubObjects    = GNLT_01 LEG_ARMOR SLDR_01
    End



    Behavior = SubObjectsUpgrade Armor_Upgrade
        TriggeredBy                         = Upgrade_GeschenkeLoriens
        UpgradeTexture    = euhaldir_ha.tga     0 eurumil_LH.tga
        UpgradeTexture    = eulorien_qvr.tga    0 eulorien_qvr_LH.tga
        UpgradeTexture    = char_el_gear_01.tga 0 char_el_gear_01_L.tga
        RecolorHouse      = Yes
        ShowSubObjects    = GNLT_01 SLDR_01 LEG_ARMOR
    End

    Behavior = SubObjectsUpgrade Armor_Upgrade2
        TriggeredBy                         = Upgrade_Level_1
    End


    Behavior = SpecialPowerModule ModuleTag_HaldirLeadershipUpdate2
        SpecialPowerTemplate                = SpecialAbilityFakeLeadership2
        UpdateModuleStartsAttack            = No
        StartsPaused                        = No
    End

    Behavior = AutoHealBehavior ModuleTag_OrophinHealing
        StartsActive = Yes
        HealingAmount = HERO_HEAL_AMOUNT
        HealingDelay = 1000
        StartHealingDelay = HERO_HEAL_DELAY
        HealOnlyIfNotInCombat = No
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate                        = Hero
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = AIUpdateInterface ModuleTag_03
        AutoAcquireEnemiesWhenIdle = Yes ATTACK_BUILDINGS STEALTHED
        MoodAttackCheckRate        = 500
    End

    Behavior = EmotionTrackerUpdate Module_EmotionTracker
        TauntAndPointDistance  = 250
        TauntAndPointUpdateDelay = 1000
        AddEmotion = Alert_Base
    End


   

    LocomotorSet
        Locomotor                            = HumanLocomotor
        Condition                            = SET_NORMAL
        Speed                                = 67
    End

    LocomotorSet
        Locomotor                            = HumanWanderLocomotor
        Condition                            = SET_WANDER
        Speed                                = 62
    End

    LocomotorSet
        Locomotor                            = HumanPanicLocomotor
        Condition                            = SET_PANIC
        Speed                                = 67
    End

    LocomotorSet
        Locomotor                            = HumanScaredLocomotor
        Condition                            = SET_SCARED
        Speed                                = 67
    End


    Behavior = PhysicsBehavior ModuleTag_04
        GravityMult   = 1.0
        ShockStandingTime = 3000
        ShockStunnedTimeLow = 1000
        ShockStunnedTimeHigh= 1200
    End

    Behavior = SlowDeathBehavior ModuleTag_05
        DeathTypes                          = ALL -FADED
        SinkDelay                           = 3000
        SinkRate                            = 0.5
        DestructionDelay                    = 15000
        Sound                               = INITIAL HaldirVoiceDie
        DeathFlags                          = DEATH_1
        Weapon                              = FINAL RumilundOrophinDeath
    End

    Behavior = SlowDeathBehavior ModuleTag_FadeDeath
        DeathTypes                          = NONE +FADED
        FadeDelay                           = 0
        FadeTime                            = 5000
        DestructionDelay                    = 5000
        DeathFlags                          = DEATH_2
        FX                                  = INITIAL FX_UnSummonElvenAllies
    End

    Behavior = SquishCollide ModuleTag_06

    End


    Behavior = AutoHealBehavior ModuleTag_ElvenGiftHealing
        StartsActive                = No
        TriggeredBy                    = Upgrade_ElvenGift
        HealingAmount                = ELVEN_GIFT_REGEN_AMOUNT
        HealingDelay                = ELVEN_GIFT_REGEN_DELAY
        StartHealingDelay = HERO_HEAL_DELAY
        HealOnlyIfNotInCombat = Yes
    End

    Behavior = AttributeModifierUpgrade ModuleTag_ElvenGiftBonus
        TriggeredBy = Upgrade_ElvenGift
        AttributeModifier = SpellBookElvenGifts
    End

    Behavior = HitReactionBehavior HitReactionBehaviorModuleTag
        HitReactionLifeTimer1 = 7
        HitReactionLifeTimer2 = 15
        HitReactionLifeTimer3 = 10

        HitReactionThreshold1 = 0.0
        HitReactionThreshold2 = 25.0
        HitReactionThreshold3 = 50.0
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP        = Yes
    End

    Behavior = FireWeaponUpdate ModuleTag_WINDY
        FireWeaponNugget
            WeaponName = OrophinRumilBuildWeapon
            FireDelay = 0
            OneShot = No
        End
    End

    Behavior = AnnounceBirthAndDeathBehavior ModuleTag_AnnounceBirthAndDeathBehavior
    End





    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Behavior = AISpecialPowerUpdate SpecialWoundingArrowAoE
        CommandButtonName = Command_SpecialAbilityRumilWoundArrow
        SpecialPowerAIType = AI_SPECIAL_POWER_ENEMY_TYPE_KILLER
    End

    Behavior = AISpecialPowerUpdate AragornBladeMasterAI
        CommandButtonName = Command_RumilSternenpfeile
        SpecialPowerAIType = AI_SPECIAL_POWER_BASIC_SELF_BUFF
    End

    Scale = 1.05
    Geometry = CYLINDER
    GeometryMajorRadius = 8.0
    GeometryMinorRadius = 8.0
    GeometryHeight = 19.2
    GeometryIsSmall = Yes
    Shadow = SHADOW_DECAL
    ShadowSizeX = 20
    ShadowSizeY = 20
    ShadowTexture = ShadowI
End

