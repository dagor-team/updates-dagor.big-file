Object GondolinEcthelion

    SelectPortrait = HPEcthelion
    ButtonImage    = HPAmroth

    DescriptionStrategic = CONTROLBAR:LW_ToolTip_SupportHero



    Draw = W3DScriptedModelDraw ModuleTag_DRAW

		;WadingParticleSys = EntRipples
		StaticModelLODMode = no; Will append M or L to the skin name depending on GameLOD
		OkToChangeModelColor = No
	
		DefaultModelConditionState
			Model					= euamroth_skn1
			Skeleton				= EUGlrfdl_SKL
		End

        ;ModelConditionState = WEAPONSET_HERO_MODE
            ;ParticleSysBone             = None NimrodelSongRays      FollowBone:Yes
            ;ParticleSysBone             = None NimrodelSongRays2 FollowBone:Yes
        ;End

		ModelConditionState = WEAPONSET_HERO_MODE
            ParticleSysBone             = None NimrodelSongRays      FollowBone:Yes
            ParticleSysBone             = None NimrodelSongRays2 FollowBone:Yes
        End

        ModelConditionState = USER_3
            ParticleSysBone         = None GilGaladRingFlare FollowBone:Yes
        End



        ; --- Idle Anims
		IdleAnimationState
			Animation				= IDLB
				AnimationName		= EUGlrfdl_IDLB
				AnimationMode		= ONCE
			End
			Animation				= IDLC
				AnimationName		= EUGlrfdl_IDLC
				AnimationMode		= ONCE
			End
			Animation				= IDLD
				AnimationName		= EUGlrfdl_IDLD
				AnimationMode		= ONCE
			End
			Animation				= IDLE
				AnimationName		= EUGlrfdl_IDLE
				AnimationMode		= ONCE
			End
			StateName				= Idle
			BeginScript
				CurDrawableHideSubObject("spear")
				Prev = CurDrawablePrevAnimationState()
				if Prev == "Selected" then CurDrawableSetTransitionAnimState("TRANS_Selected_To_Idle") end
			EndScript

		End


		TransitionState				=	TRANS_MountedSelect
			Animation				=	ATNA
				AnimationName		=	RUHHs_Theo_ATNA
				AnimationMode		=	ONCE
			End
		End
		
;------------- mounted ---------		

		; --- Moving Anims

		AnimationState				=	MOUNTED FREEFALL 
			Animation				=	freefall
				AnimationName		=	RUHHs_Theo_FLYC
				AnimationMode		=	LOOP
			End
			Flags					=	RANDOMSTART
		End

		AnimationState				=	MOUNTED STUNNED_FLAILING 
			Animation				=	JustDie
				AnimationName		=	RUHHs_Theo_FLYA
				AnimationMode		=	LOOP
				AnimationSpeedFactorRange	= 0.2 0.3
			End
			Flags					=	RANDOMSTART
		End

		AnimationState				=	MOUNTED DYING SPLATTED
			Animation				=	Land
				AnimationName		=	RUHHs_Theo_LNDA
				AnimationMode		=	ONCE
			End
		End

		AnimationState				=	MOUNTED DYING
			Animation				=	DieA
				AnimationName		=	RUHHs_Theo_DIEA
				AnimationMode		=	ONCE
			End
		End
		
		AnimationState				=	MOUNTED STUNNED_STANDING_UP
			Animation				=	StandUp
				AnimationName		=	RUHHs_Theo_GTPA
				AnimationMode		=	ONCE
				AnimationSpeedFactorRange = 1.3 1.3
			End
		End
		
		AnimationState				=	MOUNTED STUNNED
			Animation				=	Land
				AnimationName		=	RUHHs_Theo_LNDA
				AnimationMode		=	ONCE
			End
		End

		AnimationState						= PARALYZED MOUNTED
			Animation
				AnimationName				= RUHHs_Theo_IDLA
				AnimationMode				= LOOP
			End
		End

		AnimationState        = MOUNTED MOVING FIRING_OR_PREATTACK_A
			ShareAnimation		= Yes
			Animation           = MountedRunAndFire
				AnimationName       = RUHHs_Theo_ATRB
				AnimationMode       = LOOP
			End
			Flags               = RANDOMSTART  
		End

		AnimationState				=	MOUNTED FIRING_OR_PREATTACK_A
			Animation				=	AttackA
				AnimationName		=	RUHHs_Theo_ATKA
				AnimationMode		=	LOOP
				UseWeaponTiming		=	Yes
			End
			Animation				=	AttackB
				AnimationName		=	RUHHs_Theo_ATKB
				AnimationMode		=	LOOP
				UseWeaponTiming		=	Yes
			End
		End

		AnimationState				=	MOUNTED TURN_LEFT_HIGH_SPEED
			Animation				=	TurnLeft
				AnimationName		=	RUHHs_Theo_TNL1
				AnimationMode		=	LOOP
			End
		End

		AnimationState				=	MOUNTED TURN_RIGHT_HIGH_SPEED
			Animation				=	TurnRight
				AnimationName		=	RUHHs_Theo_TNR1
				AnimationMode		=	LOOP
			End
		End

		AnimationState				=	MOUNTED MOVING ACCELERATE
			Animation				=	Accelerate
				AnimationName		=	RUHHs_Theo_ACCL
				AnimationMode		=	LOOP
			End
		End

		AnimationState				=	MOUNTED MOVING DECELERATE
			Animation				=	Decelerate
				AnimationName		=	RUHHs_Theo_DECL
				AnimationMode		=	ONCE
				AnimationSpeedFactorRange = 0.6 0.6	
			End
		End
		
		AnimationState				=	MOUNTED TURN_LEFT 
			Animation				=	TurnLeft
				AnimationName		=	RUHHs_Theo_TRNL
				AnimationMode		=	LOOP
			End
		End

		AnimationState				=	MOUNTED TURN_RIGHT 
			Animation				=	TurnRight
				AnimationName		=	RUHHs_Theo_TRNR
				AnimationMode		=	LOOP
			End
		End

		AnimationState				=	MOUNTED MOVING WALKING
			Animation				=	Walk
				AnimationName		=	RUHHs_Theo_WLKA
				AnimationMode		=	LOOP
			End
			Flags					=	RANDOMSTART
		End
		
		AnimationState				=	MOUNTED MOVING BACKING_UP
			Animation				=	BackingUp
				AnimationName		=	RUHHs_Theo_BAKA
				AnimationMode		=	LOOP
			End
			Flags					=	RANDOMSTART
		End


		AnimationState				=	MOUNTED MOVING
			Animation				=	RunA
				AnimationName		=	RUHHs_Theo_RUNA
				AnimationMode		=	LOOP
			End
 			Flags					=	RANDOMSTART
		End
		
		AnimationState = MOUNTED USER_1
			Animation
				AnimationName				= EUGlrfnMnt_SPCA
				AnimationMode				= ONCE
				AnimationSpeedFactorRange	= 0.7 0.7
			End
		End

		AnimationState = MOUNTED USER_2 
			Animation
				AnimationName				= EUGlrfnMnt_SPCB
				AnimationMode				= ONCE
				AnimationSpeedFactorRange	= 0.8 0.8
			End
		End

		AnimationState				=	RAISING_FLAG MOUNTED
				Animation           =	CHRA
					AnimationName   =	RUHHs_Theo_CHRA
					AnimationMode   =	LOOP
				End
		End

		AnimationState				=	MOUNTED SELECTED
			SimilarRestart			=   Yes			
			StateName				=	AtAttentionIdle
			Animation				=	ATNB
				AnimationName		=	RUHHs_Theo_IDLH
				AnimationMode		=	LOOP
			End
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "Idle" then CurDrawableSetTransitionAnimState("TRANS_MountedSelect") end
			EndScript
		End

		TransitionState				=	TRANS_MountedSelect
			Animation				=	ATNA
				AnimationName		=	RUHHs_Theo_ATNA
				AnimationMode		=	ONCE
			End
		End

		AnimationState				= MOUNTED LEVELED
			Animation				= LevelUp
				AnimationName		= RUHHs_Theo_CHRA
				AnimationMode		= ONCE
			End
		End
		
		AnimationState = MOUNTED
			StateName = Idle
			Animation				=	IdleA
				AnimationName		=	RUHHs_Theo_IDLA
				AnimationPriority	=	30
				AnimationMode		=	LOOP
				AnimationBlendTime	=	15
			End			
			Animation	=	IDLB
				AnimationName		=	RUHHs_Theo_IDLB
				AnimationPriority	=	15
				AnimationMode		=	LOOP
				AnimationBlendTime	=	30
			End
			Animation	=	IDLC
				AnimationName		=	RUHHs_Theo_IDLC
				AnimationPriority	=	15
				AnimationMode		=	LOOP
				AnimationBlendTime	=	30
			End
			Flags					=	RANDOMSTART RESTART_ANIM_WHEN_COMPLETE
		End

;---------not mounted

		AnimationState			= STUNNED_FLAILING 
			Flags               = RANDOMSTART
			Animation
				AnimationName   = EUGlrfdl_FLYA
				AnimationMode   = LOOP
				AnimationSpeedFactorRange	= 0.4 0.6
			End
			StateName           = NoSword
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "Sword" then CurDrawableSetTransitionAnimState("TRANS_SheatheSword") end
			EndScript
		End

		AnimationState			= STUNNED_STANDING_UP
			Animation
				AnimationName   = EUGlrfdl_GTPA
				AnimationMode   = ONCE
				AnimationSpeedFactorRange= 1.5 1.5
			End
		End

		AnimationState			= STUNNED 
			Animation
				AnimationName   = EUGlrfdl_LNDA
				AnimationMode   = ONCE
			End
			StateName           = NoSword
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "Sword" then CurDrawableSetTransitionAnimState("TRANS_SheatheSword") end
			EndScript
		End

		; --- Dying anims
		AnimationState				=	DYING SPLATTED
			Animation
				AnimationName		=	EUGlrfdl_LNDA
				AnimationMode		=	ONCE
			End
			StateName				=	NoSword
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "Sword" then CurDrawableSetTransitionAnimState("TRANS_SheatheSword") end
			EndScript
		End
		AnimationState        = DYING AFLAME
			Animation = DieAflame
				AnimationName           = EUGlrfdl_MFDA
				AnimationMode       = LOOP
			End
		End
		

		AnimationState				=	DYING
			Animation
				AnimationName		=	EUGlrfdl_DTHA
				AnimationMode		=	ONCE
				AnimationPriority   =   10
			End
		End
		
		AnimationState						= PARALYZED
			Animation
				AnimationName				= EUGlrfdl_IDLB
				AnimationMode				= LOOP
			End
		End

		
		
		AnimationState        = MOVING FIRING_OR_PREATTACK_A
			ShareAnimation		= Yes
			Animation           = RunAndFire
				AnimationName       = EUGlrfdl_ATKSV2
				AnimationMode       = LOOP
			End
			Flags               = RANDOMSTART 
			BeginScript
				CurDrawableHideSubObject("spear")
			EndScript
		End

		AnimationState				=	MOVING ATTACKING
			Flags					=	RANDOMSTART
			Animation				=	RUNB
				AnimationName		=	EUGlrfdl_RUNB
				AnimationMode		=	LOOP
			End
			StateName				=	NoSword
			BeginScript
				CurDrawableHideSubObject("spear")
				Prev = CurDrawablePrevAnimationState()
				if Prev == "Sword" then CurDrawableSetTransitionAnimState("TRANS_SheatheSword") end
			EndScript
		End


		AnimationState				=	MOVING
			Flags					=	RANDOMSTART
			Animation				=	RUNA
				AnimationName		=	EUGlrfdl_RUNA
				AnimationMode		=	LOOP
			End
			StateName				=	NoSword
			BeginScript
				CurDrawableHideSubObject("spear")
				Prev = CurDrawablePrevAnimationState()
				if Prev == "Sword" then CurDrawableSetTransitionAnimState("TRANS_SheatheSword") end
			EndScript
		End


		AnimationState = WEAPONSET_HERO_MODE
			Animation = ReactToTrollPoke 
				AnimationName = EUGlrfdl_SPCB
				AnimationMode = LOOP
                AnimationSpeedFactorRange = 0.2 0.3
			End
		End
		
		AnimationState = USER_1
			Animation
				AnimationName				= EUGlrfdl_SPCA
				AnimationMode				= ONCE
				AnimationSpeedFactorRange	= 0.75 0.75
			End
		End

		AnimationState = USER_2
			Animation
				AnimationName				= EUGlrfdl_SPCB
				AnimationMode				= ONCE
				AnimationSpeedFactorRange	= 0.8 0.8
			End
		End

		; Attacking Anims [Weapon_A]
		AnimationState				=	FIRING_OR_PREATTACK_A
			StateName				=	Sword
			Animation				=	ATKA
				AnimationName		=	EUGlrfdl_ATKA
				AnimationMode		=	ONCE
				UseWeaponTiming		=	Yes
			End
			Animation				=	ATKB
				AnimationName		=	EUGlrfdl_ATKB
				AnimationMode		=	ONCE
				UseWeaponTiming		=	Yes
			End
			Animation				=	ATKC
				AnimationName		=	EUGlrfdl_ATKC
				AnimationMode		=	ONCE
				UseWeaponTiming		=	Yes
			End
			Flags					=	RESTART_ANIM_WHEN_COMPLETE
			BeginScript
				CurDrawableHideSubObject("spear")
			EndScript
		End

		; ATTACKING
		AnimationState        = ATTACKING
			Animation           = ALERT_1
				AnimationName     = EUGlrfdl_IDLA
				AnimationMode     = ONCE
			End
			Flags               = RESTART_ANIM_WHEN_COMPLETE
		End
		


; Special
		AnimationState        = SPECIAL_WEAPON_ONE
			Animation
				AnimationName     = EUGlrfdl_CHRA
				AnimationMode     = ONCE
			End
		End

		; --------- Click and Hit Reactions ------------
		AnimationState			= HIT_REACTION HIT_LEVEL_1
			StateName			= STATE_Bored_Sword
			Animation			= Hit_Level_1_A
				AnimationName	= EUGlrfdl_HITA
				AnimationMode	= ONCE
			End
		End
		
		AnimationState			= HIT_REACTION HIT_LEVEL_2
			StateName			= STATE_Bored_Sword
			Animation			= Hit_Level_1_A
				AnimationName	= EUGlrfdl_HITA
				AnimationMode	= ONCE
			End
		End
		
		AnimationState			= HIT_REACTION HIT_LEVEL_3
			StateName			= STATE_Bored_Sword
			Animation			= Hit_Level_1_A
				AnimationName	= EUGlrfdl_HITA
				AnimationMode	= ONCE
			End
		End
		
		; --------- Selected Anims and Transitions
		TransitionState					=	TRANS_Idle_to_Selected
			Animation					=	ATNA
				AnimationName			=	EUGlrfdl_ATNA
				AnimationMode			=	ONCE
			End
		End
		
		TransitionState					=	TRANS_Selected_To_Idle
			Animation					=	ATNC
				AnimationName			=	EUGlrfdl_ATNC
				AnimationMode			=	ONCE
			End
		End
		
		AnimationState						= LEVELED
			Animation						= LevelUp
				AnimationName				= EUGlrfdl_LVLA
				AnimationMode				= ONCE
				AnimationSpeedFactorRange	= 0.75 0.75
			End
		End
		
		AnimationState				=	RAISING_FLAG
			Animation				=	CHRA
				AnimationName		=	EUGlrfdl_CHRA
				AnimationMode		=	LOOP
			End
		End

		AnimationState				=	SELECTED
			StateName				=	Selected
			SimilarRestart			=   Yes			
			Animation				=	ATNB
				AnimationName		=	EUGlrfdl_ATNB
				AnimationMode		=	LOOP
			End
			BeginScript
				CurDrawableHideSubObject("spear")
				Prev = CurDrawablePrevAnimationState()
				if Prev == "Idle" then CurDrawableSetTransitionAnimState("TRANS_Idle_to_Selected") end
			EndScript
		End
		
		;----Emotion Animations
		AnimationState				=	EMOTION_CELEBRATING
			Animation				=	CHRA
				AnimationName		=	EUGlrfdl_CHRA
				AnimationMode		=	ONCE
				AnimationPriority	=	10
			End
			Flags					=	RESTART_ANIM_WHEN_COMPLETE				
		End
		
		AnimationState					= EMOTION_TAUNTING
			Animation
				AnimationName			= EUGlrfdl_TNTA
				AnimationMode			= LOOP
			End
		End
		
		AnimationState					= EMOTION_ALERT EMOTION_MORALE_HIGH
			Animation					= Taunting
				AnimationName			= EUGlrfdl_TNTA
				AnimationMode			= ONCE
			End
			Flags						= RANDOMSTART RESTART_ANIM_WHEN_COMPLETE
		End
		
		; READY IDLE
		AnimationState        = EMOTION_ALERT
			Animation           = ALERT_1
				AnimationName     = EUGlrfdl_IDLA
				AnimationMode     = ONCE
			End
			Flags               = RESTART_ANIM_WHEN_COMPLETE
		End	
		
	End

	Draw = W3DScriptedModelDraw DustEffects
	    DefaultModelConditionState
	      Model = None
	    End
	    IdleAnimationState
	    End
	    AnimationState = MOUNTED MOVING WADING
			ParticleSysBone = None FootstepSlash
	    End
	    AnimationState = MOUNTED MOVING ACCELERATE
			ParticleSysBone = None GenericSiegeTrailDust
	    End
	    AnimationState = MOUNTED MOVING ACCELERATE
			ParticleSysBone = None GenericSiegeTrailDust
	    End
	    AnimationState = MOUNTED MOVING
	    End
	End

    #include "..\..\..\includes\StunDrawModuleSmall.inc"


    Side                                  = Imladris
    EditorSorting                         = UNIT
    ThreatLevel                           = 4.0
    ThingClass                            = CHARACTER_UNIT
    BuildCost                             = 3000
    BuildTime                             = MEDIUM_FIRST_AGE_HERO_BUILDTIME
    ShockwaveResistance                   = SHOCKWAVE_RESISTANCE_STRONG
    TransportSlotCount                    = TRANSPORTSLOTCOUNT_HERO
    BountyValue                           = 200
    MaxSimultaneousOfType                 = 1
    DisplayMeleeDamage                    = MEDIUM_FIRST_AGE_HERO_DAMAGE
    VisionRange                           = 340
    ShroudClearingRange                   = 400
    MaxVisionBonusPercent                 = 300%
    VisionBonusTestRadius                 = 200
    VisionBonusPercentPerFoot             = 1.0%

    DisplayName                           = OBJECT:GondolinEcthelion
	RecruitText 						  = CONTROLBAR:GondolinEcthelionRecruit
    ReviveText    						  = CONTROLBAR:GondolinEcthelionRevive
    Hotkey                                = CONTROLBAR:GondolinEcthelionHotkey

    CrushableLevel                        = 2
    CrusherLevel                          = 0
    CrushRevengeWeapon                    = SuperInfantryCrushRevenge

    CommandSet                            = GondolinEcthelionCommandset
    CommandPoints                         = 0


    WeaponSet
        Conditions                        = None
        Weapon                            = PRIMARY  GondolinEcthelionWeapon
        AutoChooseSources                 = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End


    ArmorSet
        Conditions                        = None
        Armor                             = FirstAgeMediumHeroArmor
        DamageFX                          = NormalDamageFX
    End

    ArmorSet
        Conditions                        = PLAYER_UPGRADE
        Armor                             = FirstAgeStrongHeroArmor
        DamageFX                          = NormalDamageFX
    End





    AutoResolveUnitType                 = AutoResolveUnit_Hero
    AutoResolveCombatChain              = AutoResolve_HeroCombatChain

    AutoResolveBody                     = AutoResolve_GandalfBody

    AutoResolveWeapon
        Weapon                          = AutoResolve_GandalfWeapon
    End
    AutoResolveArmor
        Armor                           = AutoResolve_GandalfArmor
    End





    VoiceCreated                        = EcthelionVoiceSalute
    VoiceFullyCreated                   = EcthelionVoiceSalute
    VoiceAttack                         = EcthelionVoiceAttack
    VoiceAttackAir                      = EcthelionVoiceAttack
    VoiceAttackCharge                   = EcthelionVoiceAttack
    VoiceAttackMachine                  = EcthelionVoiceAttack
    VoiceAttackStructure                = EcthelionVoiceAttack
    VoiceGuard                          = EcthelionVoiceMove
    VoiceMove                           = EcthelionVoiceMove
    VoiceMoveToCamp                     = EcthelionVoiceMove
    VoiceMoveWhileAttacking             = EcthelionVoiceAttack
    VoicePriority                       = 90
    VoiceRetreatToCastle                = EcthelionVoiceMove
    VoiceSelect                         = EcthelionVoiceSelect
    VoiceSelectBattle                   = EcthelionVoiceSelect

    SoundImpact                         = ImpactHorse

    UnitSpecificSounds
        VoiceEnterUnitElvenTransportShip = EcthelionVoiceMove
        VoiceGarrison                    = EcthelionVoiceMove
        VoiceInitiateCaptureBuilding     = EcthelionVoiceMove
    End

    #include "..\..\..\includes\StandardUnitEvaEvents.inc"

    Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
        Key = Humanoid_Male Man Man_Male Unit Infantry Gondor_Guard
    End

    ClientBehavior = ModelConditionAudioLoopClientBehavior ModuleTag_foo
        ModelCondition = Required:RAISING_FLAG   Excluded:DYING ENGAGED
    End

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound:TauntHitShieldPitchShifted      Animation:GUTwrGrd_SKL.GUTwrGrd_TNTB    Frames: 23 43
        AnimationSound = Sound:BodyFallGeneric1                Animation:GUTWRGRD_SKL.GUTWRGRD_DIEA    Frames:30 51
        AnimationSound = Sound:BodyFallGeneric1                Animation:GUTWRGRD_SKL.GUTWRGRD_DIEB    Frames:57
        AnimationSound = Sound:BodyFallGeneric1                Animation:GUTWRGRD_SKL.GUTWRGRD_DIEC    Frames:38
        AnimationSound = Sound:BodyFallSoldier                 Animation:GUTWRGRD_SKL.GUTWRGRD_LNDA    Frames:4
        AnimationSound = Sound:BodyFallSoldier                 Animation:GUTwrGrd_SKL.GUTwrGrd_LNDB    Frames:2
    End







    RadarPriority = UNIT
    KindOf = PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE THROWN_OBJECT ARMY_SUMMARY CANNOT_RETALIATE HERO

    Body = RespawnBody ModuleTag_RespawnBody
        CheerRadius                     = EMOTION_CHEER_RADIUS
        MaxHealth                       = MEDIUM_FIRST_AGE_HERO_HEALTH
        PermanentlyKilledByFilter       = NONE
        DodgePercent                      = HERO_DODGE_PERCENT
    End
	
	Behavior = RespawnUpdate ModuleTag_RespawnUpdate
            DeathAnim                  = DYING
            DeathAnimationTime         = 3933
            RespawnAnim                = LEVELED
            RespawnAnimationTime       = 2000
            AutoRespawnAtObjectFilter  = NONE +CASTLE_KEEP
            ButtonImage                = HPAmroth

        RespawnRules =    AutoSpawn:No           Cost:3000            Time:SILMARIL_HERO_RESPAWNTIME        Health:100%
    End

    Behavior = AIUpdateInterface ModuleTag_03
        AutoAcquireEnemiesWhenIdle         = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate                = 500
        CanAttackWhileContained            = Yes
        AILuaEventsList                    = GilGaladFunctions
    End

    Behavior = AutoHealBehavior ModuleTag_AragornHealing
        StartsActive                 = Yes
        HealingAmount                 = HERO_HEAL_AMOUNT
        HealingDelay                 = 1000
        StartHealingDelay             = HERO_HEAL_DELAY
        HealOnlyIfNotInCombat             = Yes
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = Hero
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    LocomotorSet
        Locomotor = HeroHumanLocomotor
        Condition = SET_NORMAL
        Speed     = 56
    End

    Behavior = PhysicsBehavior ModuleTag_04
        GravityMult                 = 1.0
        ShockStunnedTimeLow                = 1400
        ShockStunnedTimeHigh            = 2400
        ShockStandingTime                = 1333
    End

    Behavior = SlowDeathBehavior ModuleTag_05
        DeathTypes                     = ALL -FADED
        SinkDelay                     = 3000
        SinkRate                     = 0.40
        DestructionDelay             = 8000
        Sound                         = INITIAL GilGaladVoiceDie
        DeathFlags                     = DEATH_1
    End

    Behavior = SlowDeathBehavior ModuleTag_FadeDeath
        DeathTypes                     = NONE +FADED
        FadeDelay                     = 0
        FadeTime                     = 2500
        DestructionDelay             = 2500
        Sound                         = INITIAL SpellGenericUnsummonFasterMS
        DeathFlags                     = DEATH_2
    End

    Behavior = HitReactionBehavior HitReactionBehaviorModuleTag
        HitReactionLifeTimer1             = 2700
        HitReactionLifeTimer2             = 3366
        HitReactionLifeTimer3             = 10

        HitReactionThreshold1             = 5.0
        HitReactionThreshold2             = 100.0
        HitReactionThreshold3             = 300.0
    End
	
	    Behavior = AttributeModifierUpgrade ModuleTag_SwordBonus
        TriggeredBy = Upgrade_ZwillingeWaffeSchmieden
        AttributeModifier = SchmiedekunstderZwillingeBruchtalsEcthelion
    End

; --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    Behavior = AttributeModifierAuraUpdate ModuleTag_Leadership
        StartsActive                     = Yes
        BonusName                        = EcthelionLeadership
        RefreshDelay                     = 2000
        Range                            = 300
        ObjectFilter                     = IMLADRIS_LEADERSHIP_UNITS_OBF ;ANY +INFANTRY +CAVALRY +HERO -MACHINE +MONSTER -STRUCTURE -IMMOBILE +DOZER
    End

    Behavior = PassiveAreaEffectBehavior ModuleTag_SplashOfHealingWater_Ahh
        EffectRadius                     = 200
        PingDelay                        = 2000
        HealPercentPerSecond             = 2%
        AllowFilter                      = NONE +INFANTRY +CAVALRY +DOZER -HERO SAME_PLAYER
        NonStackable                     = No
        HealFX                           = FX_SpellHealUnitHealBuff
    End

; --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    Behavior = SpecialPowerModule ModuleTag_ShieldBubbleStarter
        SpecialPowerTemplate             = SpecialPowerShieldBubbleEdain
        UpdateModuleStartsAttack         = No
        AttributeModifier                = EcthelionShieldBonus
        AttributeModifierRange           = 1
        AttributeModifierAffectsSelf     = Yes
        AttributeModifierAffects         = IMLADRIS_LEADERSHIP_UNITS_OBF
        SetModelCondition                = ModelConditionState:USER_1
        SetModelConditionTime            = 2.5
    End

    Behavior = SpecialAbilityUpdate ModuleTag_ShieldBubbleUpdate
        SpecialPowerTemplate             = SpecialPowerShieldBubbleEdain
        UnpackTime                       = 0
        PreparationTime                  = 0.1
        PackTime                         = 0.15
        AwardXPForTriggering             = 0
    End

    Behavior = AutoAbilityBehavior ModuleTag_AutoAbilitySpecialPowerShieldBubble
        SpecialAbility                   = SpecialPowerShieldBubbleEdain
        StartsActive                     = Yes
        MaxScanRange                     = 50
        Query                            = 1 ANY ENEMIES +MONSTER
    End

    Behavior = ReflectDamage ModuleTag_ReflectDamage
        DamageTypesToReflect             = +MAGIC
        ReflectDamagePercentage          = 50%
        MinimumDamageToReflect           = 0.2
    End

    Behavior = ArmorUpgrade ArmorUpgradeModuleTag
        TriggeredBy                      = Upgrade_Level_10
    End

; --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_EnableElendil
        SpecialPowerTemplate            = SpecialAbilityEcthelionBlessingAura
        TriggeredBy                     = Upgrade_Level_3
    End

    Behavior = SpecialPowerModule ModuleTag_ElendilStarter
        SpecialPowerTemplate            = SpecialAbilityEcthelionBlessingAura
        UpdateModuleStartsAttack        = Yes
        AntiCategory                    = LEADERSHIP
        AttributeModifier               = AnticommiePropagandasModifier
        AttributeModifierRange          = 450
        StartsPaused                    = Yes
        SetModelCondition               = ModelConditionState:USER_3
        SetModelConditionTime           = 15.0
    End

    Behavior = ModelConditionSpecialAbilityUpdate ModuleTag_ElendilUpdate
        SpecialPowerTemplate            = SpecialAbilityEcthelionBlessingAura
        UnpackTime                      = 1400
        PreparationTime                 = 1
        PersistentPrepTime              = 1000
        PackTime                        = 1000
        AwardXPForTriggering            = 0
    End
; --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------


   Behavior = UnpauseSpecialPowerUpgrade ModuleTag_CirdanStormEnabler
        SpecialPowerTemplate    = SpecialAbilityEcthelionWaterExplosion
        TriggeredBy             = Upgrade_Level_3
    End

    Behavior = OCLSpecialPower ModuleTag_OCLSpecialPowerCirdanStorm
        SpecialPowerTemplate    = SpecialAbilityEcthelionWaterExplosion
        OCL                     = OCL_SpawnExthelionGeysir
        CreateLocation          = CREATE_AT_LOCATION
        TriggerFX               = FX_CirdanWhirlpool
        StartsPaused            = Yes
    End

; --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_VilyaEnabler
        SpecialPowerTemplate            = SpecialAbilityEcthelionWaterBall
        TriggeredBy                     = Upgrade_Level_5
    End

    Behavior = SpecialPowerModule ModuleTag_ArrowWindStarter
        SpecialPowerTemplate            = SpecialAbilityEcthelionWaterBall
        UpdateModuleStartsAttack        = No
        StartsPaused                    = Yes
    End

    Behavior = ArrowStormUpdate ModuleTag_VilyaUpdate
        SpecialPowerTemplate            = SpecialAbilityEcthelionWaterBall
        StartAbilityRange               = 320.0
        UnpackTime                      = 1000
        PreparationTime                 = 800
        PersistentPrepTime              = 600
        PackTime                        = 1200
        UnpackingVariation                = 1
        ParalyzeDurationWhenCompleted   = 600
        ParalyzeDurationWhenAborted     = 800
        ApproachRequiresLOS             = Yes
        AwardXPForTriggering            = 0

        WeaponTemplate              = GilGaladVilya
        TargetRadius                = 120
        ShotsPerTarget              = 1
        ShotsPerBurst               = 3
        MaxShots                    = 3
        CanShootEmptyGround             = Yes
    End

    Behavior = AutoAbilityBehavior ModuleTag_VilyaAutoAbility
        SpecialAbility                    = SpecialAbilityEcthelionWaterBall
        MaxScanRange                    = 55
        Query                            = 1 ALL -STRUCTURE ENEMIES
    End

; --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_KompanieEnabler
        SpecialPowerTemplate    = SpecialAbilityBeregondKompanie
        TriggeredBy             = Upgrade_Level_5
    End

    Behavior = OCLSpecialPower ModuleTag_KompanieSpecialPower
        SpecialPowerTemplate    = SpecialAbilityBeregondKompanie
        OCL                     = OCL_SummonBeregondKompanie
        TriggerFX               = FX_GamlingHeroldSummon
        CreateLocation          = CREATE_AT_LOCATION
        StartsPaused            = Yes
    End

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_KommandantKompanieEnabler
        SpecialPowerTemplate    = SpecialAbilityBeregondKommandantKompanie
        TriggeredBy             = Upgrade_Level_5
    End

    Behavior = OCLSpecialPower ModuleTag_KommandantKompanieSpecialPower
        SpecialPowerTemplate    = SpecialAbilityBeregondKommandantKompanie
        OCL                     = OCL_SummonEcthelionKompanie
        TriggerFX               = FX_GamlingHeroldSummon
        CreateLocation          = CREATE_AT_LOCATION
        StartsPaused            = Yes
    End

; --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_WhiteTreeEnabler
        SpecialPowerTemplate            = SpecialAbilityEcthelionGondolinFountain
        TriggeredBy                     = Upgrade_Level_7
    End

    Behavior = OCLSpecialPower ModuleTag_OCLWhiteTree
        SpecialPowerTemplate            = SpecialAbilityEcthelionGondolinFountain
        OCL                             = OCL_GondolinFountain
        CreateLocation                  = CREATE_AT_LOCATION
        TriggerFX                       = FX_GondolinFountainSummon
        StartsPaused                    = Yes
    End

    Behavior = SpecialAbilityUpdate ModuleTag_OCLWhiteTreeUpdate
        SpecialPowerTemplate            = SpecialAbilityEcthelionGondolinFountain
        UnpackTime                      = 1
        PreparationTime                 = 3
        PackTime                        = 2096
        AwardXPForTriggering            = 0
        FreezeAfterTriggerDuration      = 0
    End

; --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_AEcthelionFluteEnabler
        SpecialPowerTemplate         = SpecialAbilityEcthelionFlute
        TriggeredBy             = Upgrade_Level_9
        ObeyRechageOnTrigger            = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_EcthelionFluteStarter
        SpecialPowerTemplate        = SpecialAbilityEcthelionFlute
        StartsPaused                = Yes
    End

    Behavior = HeroModeSpecialAbilityUpdate ModuleTag_EcthelionFluteUpdate
        SpecialPowerTemplate        = SpecialAbilityEcthelionFlute
        HeroAttributeModifier       = EcthelionFluteSelfBuff
        HeroEffectDuration          = 40000
        UnpackTime                  = 1
    End

    Behavior = AutoAbilityBehavior ModuleTag_AutoAbilityEcthelionFlute
        SpecialAbility              = SpecialAbilityEcthelionFlute
        MaxScanRange                = 30
        Query                       = 1 ANY ENEMIES +INFANTRY +CAVALRY +HERO -STRUCTURE
    End

    Behavior = FireWeaponUpdate ModuleTag_WeaponFiring
        FireWeaponNugget
            WeaponName = EcthelionFluteWeapon
            Offset = X:0 Y:0 Z:0
            FireDelay = 0
            OneShot = No
        End
        HeroModeTrigger = Yes
;TriggerFX = FX_NimrodelSong
		;SetModelCondition		= ModelConditionState:USER_6
		;SetModelConditionTime	= 40.5
		;DisableDuringAnimDuration = Yes
    End
	
; --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	
	Behavior = SubObjectsUpgrade ShowSubObject
		TriggeredBy		= Upgrade_Level_1
		ShowSubObjects	= HLMT_02 SLDR_02 BOOT_01 GNLT_01 LOWLOD HAIR3
		HideSubObjects	= OBJCHAR_EL2 OBJECT02 HAIR
	End

	Behavior = SubObjectsUpgrade Costume_01
		TriggeredBy		= Upgrade_Level_1
		UpgradeTexture	= euamroth.tga 0 euamroth_arm.tga
		RecolorHouse	= No
    End

; --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName  = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName  = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName  = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Behavior = AISpecialPowerUpdate ElvenLorienWarriorHordeCaptureBuildingAI
        CommandButtonName  = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End



    Behavior = AISpecialPowerUpdate BlessingAura_AI
        CommandButtonName  = Command_EcthelionBlessingAura
        SpecialPowerAIType = AI_SPECIAL_POWER_ELENDIL
        SpecialPowerRadius = 200
    End

    Behavior = AISpecialPowerUpdate WaterBallAI
        CommandButtonName  = Command_EcthelionWaterBall
        SpecialPowerAIType = AI_SPECIAL_POWER_ENEMY_TYPE_KILLER
    End

    Behavior = AISpecialPowerUpdate GondolinFountain_AI
        CommandButtonName  = Command_EcthelionGondolinFountain
        SpecialPowerAIType = AI_SPECIAL_POWER_TARGETAOE_SUMMON
        SpecialPowerRadius = 30.0
    End

    Behavior = AISpecialPowerUpdate Flute_AI
        CommandButtonName  = Command_EcthelionFlute
        SpecialPowerAIType = AI_SPECIAL_POWER_BASIC_SELF_BUFF
    End




    Scale             = 1.07
    Geometry             = CYLINDER
    GeometryMajorRadius = 8.0
    GeometryMinorRadius = 8.0
    GeometryHeight         = 18.8
    GeometryIsSmall     = Yes
    Shadow             = SHADOW_DECAL
    ShadowSizeX         = 19
    ShadowSizeY         = 19
    ShadowTexture         = ShadowI
End



Object GondolinEcthelion_summoned

    SelectPortrait = HPEcthelion
    ButtonImage    = HPEcthelion

    DescriptionStrategic = CONTROLBAR:LW_ToolTip_SupportHero

    Draw = W3DHordeModelDraw ModuleTag_01

        DefaultModelConditionState
            Model                        = euecthelion
            Skeleton                     = GUTowerGrd_SKL
        End

        ModelConditionState = WEAPONSET_HERO_MODE
            ParticleSysBone             = BAT_RIBS GilGaladSternenschildGlow      FollowBone:Yes
            ParticleSysBone             = BAT_RIBS GilGaladSternenschildGlowWhite FollowBone:Yes
        End

        ModelConditionState = USER_3
            ParticleSysBone         = None GilGaladRingFlare FollowBone:Yes
        End



        AnimationState        = THROWN_PROJECTILE
            Animation           = FLYA
                AnimationName     = GUTowerGrd_FLYA
                AnimationMode     = LOOP
            End
        End

        AnimationState                            = PASSENGER FREEFALL
            Animation                            = Grabbed
                AnimationName                    = GUTowerGrd_FLLA
                AnimationMode                    = LOOP
            End
        End

        AnimationState                            = FREEFALL
            Animation                            = Falling
                AnimationName                    = GUTowerGrd_FLYA
                AnimationMode                    = LOOP
                AnimationBlendTime                = 10
            End
        End

        AnimationState        = MOVING FIRING_OR_PREATTACK_A
            ShareAnimation        = Yes
            Animation           = RunAndFire
                AnimationName       = GUTowerGrd_ATRA
                AnimationMode       = LOOP
            End
            Flags               = RANDOMSTART
        End

        AnimationState        = MOVING WEAPONSET_HERO_MODE

            Animation           = RUNA
                AnimationName     = GUTowerGrd_PSHA
                AnimationMode     = LOOP
            End
            Flags               = RANDOMSTART
            ParticleSysBone     = None InfantryDustTrails
        End

        AnimationState        =  FIRING_OR_PREATTACK_A WEAPONSET_HERO_MODE
            Animation           = ATKA
                AnimationName     = GUTowerGrd_ATKA
                AnimationMode     = ONCE
                AnimationSpeedFactorRange = 1.328 1.328

            End

            Flags    = RESTART_ANIM_WHEN_COMPLETE
            FXEvent    = Frame:25 Name: FX_BladeMasterHitOrient
            FXEvent    = Frame:45 Name: FX_BladeMasterHitOrient
        End

        AnimationState                    = SELECTED WEAPONSET_HERO_MODE

            StateName                = STATE_Selected
            Animation                = IDLB
                AnimationName            = GUTowerGrd_PNTA
                AnimationMode            = ONCE
            End
        End

        AnimationState                    = WEAPONSET_HERO_MODE
            StateName                = STATE_Selected

            Animation                = IDLB
                AnimationName            = GUTowerGrd_PNTA
                AnimationMode            = ONCE
            End
        End




        AnimationState                    = MOVING EMOTION_TERROR EMOTION_LOOK_TO_SKY
            ShareAnimation                = Yes
            Animation                    = TerrorFromTheSky
                AnimationName            = GUTowerGrd_RUNB
                AnimationMode            = LOOP
            End
        End
        AnimationState                    = MOVING EMOTION_TERROR
            ShareAnimation                = Yes
            Animation                    = Terror
                AnimationName            = GUTowerGrd_RUNB
                AnimationMode            = LOOP
            End
        End


        AnimationState                =    MOVING BACKING_UP
            ShareAnimation = Yes
            Animation                =    BackingUp
                AnimationName        =    GUTowerGrd_BAKA
                AnimationMode        =    LOOP
            End
            Flags                    =    RANDOMSTART
        End


        AnimationState        = MOVING ALTERNATE_FORMATION
            ShareAnimation = Yes
            Animation           = RUNA
                AnimationName     = GUTowerGrd_PSHA
                AnimationMode     = LOOP
            End
            Flags               = RANDOMSTART

        End

        AnimationState        = MOVING USING_COMBO_LOCOMOTOR
            ShareAnimation        = Yes
            Animation           = RUNA
                AnimationName     = GUTowerGrd_WLKA
                AnimationMode     = LOOP
                Distance          = 40
            End
            Flags               = RANDOMSTART

        End

        AnimationState        = MOVING
            ShareAnimation = Yes
            Animation           = RUNA
                AnimationName     = GUTowerGrd_RUNA
                AnimationMode     = LOOP
            End
            Flags               = RANDOMSTART

        End

        AnimationState        =  FIRING_OR_PREATTACK_A
            Animation           = ATKA
                AnimationName     = EUGilGalad_ATKA
                AnimationMode     = ONCE
                AnimationSpeedFactorRange = 1.328 1.328

            End

            Animation           = ATKB
                AnimationName     = GUTowerGrd_ATKA
                AnimationMode     = ONCE
                AnimationSpeedFactorRange = 1.15 1.15

            End

            Animation           = ATKC
                AnimationName     = EUGilGalad_ATKB
                AnimationMode     = ONCE
                AnimationSpeedFactorRange = 1.1 1.1

            End

        End



        AnimationState        = UNPACKING PACKING_TYPE_1
            Animation           = CHRA
                AnimationName     = GUTowerGrd_CHRA
                AnimationMode     = ONCE
            End
        End

        AnimationState        = PREPARING PACKING_TYPE_1
            Animation           = ATKA1
                AnimationName     = GUTowerGrd_ATKA
                AnimationMode     = ONCE
            End
        End

        AnimationState        = STUNNED_FLAILING
            Animation           = FLYA
                AnimationName     = GUTowerGrd_FLYA
                AnimationMode     = LOOP
            End
            Flags               = RANDOMSTART
        End

        AnimationState        = DYING SPLATTED DEATH_1
            Animation           = LNDA
                AnimationName     = GUTowerGrd_LNDB
                AnimationMode     = ONCE
            End
        End

        AnimationState        = DYING DEATH_2
            Animation           = ByeBye
                AnimationName     =GUTowerGrd_CHRA
                AnimationMode     = ONCE
            End
        End

        AnimationState        = DYING
            Animation           = DIE
                AnimationName     = GUTowerGrd_DIEA
                AnimationMode     = ONCE
                AnimationSpeedFactorRange = 0.8 1.2
            End
        End

        AnimationState        = DYING DEATH_1
            Animation           = DIEA
                AnimationName     = GUTowerGrd_DIEA
                AnimationMode     = ONCE
                AnimationSpeedFactorRange = 0.8 1.2
            End
        End

        AnimationState        = STUNNED_STANDING_UP
            Animation           = GTPA
                AnimationName     = GUTowerGrd_GTPA
                AnimationMode     = ONCE
                AnimationSpeedFactorRange = 1.5 1.5
            End
        End

        AnimationState        = STUNNED
            Animation           = LNDA
                AnimationName     = GUTowerGrd_LNDB
                AnimationMode     = ONCE
            End
        End

        TransitionState       = TRANS_Plant
            Animation           = PLTA
                AnimationName     = GUTowerGrd_PLTA
                AnimationMode     = ONCE
                AnimationSpeedFactorRange = 0.8 1.2
            End
        End

        TransitionState       = TRANS_Unplant
            Animation           = PLTB
                AnimationName     = GUTowerGrd_PLTB
                AnimationMode     = ONCE
                AnimationSpeedFactorRange = 0.5 1.2
            End
        End

        AnimationState                        = HIT_REACTION
            Animation                        = HIT REACTION
                AnimationName                = GUTowerGrd_HITA
                AnimationMode                = ONCE
            End
        End


        AnimationState                    = EMOTION_ALERT EMOTION_AFRAID
            ShareAnimation                = Yes
            Animation                    = Apprehensive
                AnimationName            = GUTowerGrd_APPA
                AnimationMode            = LOOP
            End
        End



        AnimationState                    = EMOTION_AFRAID
            ShareAnimation                = Yes
            Animation                    = FERA
                AnimationName            = GUTowerGrd_FERA
                AnimationMode            = LOOP
            End
            Animation                    = FERB
                AnimationName            = GUTowerGrd_FERB
                AnimationMode            = LOOP
            End
        End



        AnimationState                    = EMOTION_TAUNTING ALTERNATE_FORMATION
            Animation                    = TNTA
                AnimationName            = GUTowerGrd_TNTA
                AnimationMode            = LOOP
            End
        End
        AnimationState                    = EMOTION_TAUNTING
            Animation                    = Taunting
                AnimationName            = GUTowerGrd_TNTA
                AnimationMode            = ONCE
            End
            Animation                    = Taunting2
                AnimationName            = GUTowerGrd_TNTB
                AnimationMode            = ONCE
            End
            Flags                        = RESTART_ANIM_WHEN_COMPLETE
        End



        AnimationState                    = EMOTION_POINTING
            Animation                    = Pointing1
                AnimationName            = GUTowerGrd_PNTA
                AnimationMode            = LOOP
            End
            Flags                        = RANDOMSTART
        End



        AnimationState                    = EMOTION_CELEBRATING
            Animation                    = CHRA
                AnimationName            = GUTowerGrd_CHRA
                AnimationMode            = LOOP
            End
        End


        AnimationState                    = EMOTION_ALERT
            Animation                    = CHRA
                AnimationName            = GUTowerGrd_IDLA
                AnimationMode            = LOOP
            End
        End




        AnimationState                    = SELECTED ALTERNATE_FORMATION
            ShareAnimation                = Yes
            StateName                    = STATE_SelectedAlternateFormation
            Animation                    = IDLB
                AnimationName            = GUTowerGrd_IDLB
                AnimationMode            = LOOP
            End
        End
        AnimationState                    = SELECTED
            StateName                    = STATE_Selected

            ShareAnimation                = Yes
            Animation                    = ATNB
                AnimationName            = GUTowerGrd_ATNB
                AnimationMode            = LOOP
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Planted" then CurDrawableSetTransitionAnimState("TRANS_Unplant") end
            EndScript
        End



        AnimationState                    = ALTERNATE_FORMATION
            StateName                    = STATE_SelectedAlternateFormation

            ShareAnimation                = Yes
            Animation                    = IDLB
                AnimationName            = GUTowerGrd_IDLB
                AnimationMode            = LOOP
            End
        End
        IdleAnimationState
            StateName                    = STATE_Idle
            Animation                    = IDLA
                AnimationName            = GUTowerGrd_IDLA
                AnimationMode            = ONCE
                AnimationBlendTime        = 15
                AnimationSpeedFactorRange = 0.8 1.2
            End
            Animation                    = IDLA
                AnimationName            = GUTowerGrd_IDLA
                AnimationMode            = ONCE_BACKWARDS
                AnimationBlendTime        = 9
                AnimationSpeedFactorRange = 0.8 1.2
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Planted" then CurDrawableSetTransitionAnimState("TRANS_Unplant") end
            EndScript
        End
    End



    Draw = W3DScriptedModelDraw ModuleTag_ShieldBubble
        DefaultModelConditionState
            Model = None
        End
        ModelConditionState = USER_1
            Model = GUGANDALFCRSTL
            ParticleSysBone     = ROOTTRANSFORM GandalfCrystalSphere FollowBone:Yes
            ParticleSysBone     = ROOTTRANSFORM GandalfBeamGlow2 FollowBone:Yes
        End
    End

    Draw = W3DScriptedModelDraw Icon
        ModelConditionState = NONE
            Model           = bbox
        End
    End

    #include "..\..\..\includes\StunDrawModuleSmall.inc"







    Side                                  = Imladris
    EditorSorting                         = UNIT
    ThreatLevel                           = 4.0
    ThingClass                            = CHARACTER_UNIT
    BuildCost                             = STRONG_HERO_COST
    BuildTime                             = STRONG_HERO_BUILDTIME
    ShockwaveResistance                   = SHOCKWAVE_RESISTANCE_STRONG
    TransportSlotCount                    = TRANSPORTSLOTCOUNT_HERO
    BountyValue                           = 200
    MaxSimultaneousOfType                 = 1
    DisplayMeleeDamage                    = WEAK_FIRST_AGE_HERO_DAMAGE
    VisionRange                           = 340
    ShroudClearingRange                   = 400
    MaxVisionBonusPercent                 = 300%
    VisionBonusTestRadius                 = 200
    VisionBonusPercentPerFoot             = 1.0%

    DisplayName                           = OBJECT:GondolinEcthelion
    Hotkey                                = CONTROLBAR:GondolinEcthelionHotkey

    CrushableLevel                        = 2
    CrusherLevel                          = 0
    CrushRevengeWeapon                    = SuperInfantryCrushRevenge

    CommandSet                            = GondolinEcthelionCommandset_S
    CommandPoints                         = 0

    WeaponSet
        Conditions                        = None
        Weapon                            = PRIMARY  GilGaladWeapon
        AutoChooseSources                 = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End



    ArmorSet
        Conditions                        = None
        Armor                             = FirstAgeMediumHeroArmor
        DamageFX                          = NormalDamageFX
    End

    ArmorSet
        Conditions                        = PLAYER_UPGRADE
        Armor                             = FirstAgeStrongHeroArmor
        DamageFX                          = NormalDamageFX
    End





    VoiceCreated                        = EcthelionVoiceSalute
    VoiceFullyCreated                   = EcthelionVoiceSalute
    VoiceAttack                         = EcthelionVoiceAttack
    VoiceAttackAir                      = EcthelionVoiceAttack
    VoiceAttackCharge                   = EcthelionVoiceAttack
    VoiceAttackMachine                  = EcthelionVoiceAttack
    VoiceAttackStructure                = EcthelionVoiceAttack
    VoiceGuard                          = EcthelionVoiceMove
    VoiceMove                           = EcthelionVoiceMove
    VoiceMoveToCamp                     = EcthelionVoiceMove
    VoiceMoveWhileAttacking             = EcthelionVoiceAttack
    VoicePriority                       = 90
    VoiceRetreatToCastle                = EcthelionVoiceMove
    VoiceSelect                         = EcthelionVoiceSelect
    VoiceSelectBattle                   = EcthelionVoiceSelect

    SoundImpact                         = ImpactHorse

    UnitSpecificSounds
        VoiceEnterUnitElvenTransportShip = EcthelionVoiceMove
        VoiceGarrison                   = EcthelionVoiceMove
        VoiceInitiateCaptureBuilding    = EcthelionVoiceMove
    End

    #include "..\..\..\includes\StandardUnitEvaEvents.inc"


	;Behavior = DoCommandUpgrade Module_DoCommandUpgradeKillGlorfindel
        ;TriggeredBy                     = Upgrade_HouseofTheGoldenFlowerup
        ;GetUpgradeCommandButtonName     = Command_SpecialAbilityGandalfderWeie
    ;End


    Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
        Key = Humanoid_Male Man Man_Male Unit Infantry Gondor_Guard
    End

    ClientBehavior = ModelConditionAudioLoopClientBehavior ModuleTag_foo
        ModelCondition = Required:RAISING_FLAG   Excluded:DYING ENGAGED
    End

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound:TauntHitShieldPitchShifted      Animation:GUTwrGrd_SKL.GUTwrGrd_TNTB    Frames: 23 43
        AnimationSound = Sound:BodyFallGeneric1                Animation:GUTWRGRD_SKL.GUTWRGRD_DIEA    Frames:30 51
        AnimationSound = Sound:BodyFallGeneric1                Animation:GUTWRGRD_SKL.GUTWRGRD_DIEB    Frames:57
        AnimationSound = Sound:BodyFallGeneric1                Animation:GUTWRGRD_SKL.GUTWRGRD_DIEC    Frames:38
        AnimationSound = Sound:BodyFallSoldier                 Animation:GUTWRGRD_SKL.GUTWRGRD_LNDA    Frames:4
        AnimationSound = Sound:BodyFallSoldier                 Animation:GUTwrGrd_SKL.GUTwrGrd_LNDB    Frames:2
    End







    RadarPriority = UNIT
    KindOf = PRELOAD HERO SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE THROWN_OBJECT ARMY_SUMMARY CANNOT_RETALIATE SUMMONED

    Body = RespawnBody ModuleTag_RespawnBody
        CheerRadius                     = EMOTION_CHEER_RADIUS
        MaxHealth                       = STRONG_HERO_HEALTH
        PermanentlyKilledByFilter       = NONE
        DodgePercent                      = HERO_DODGE_PERCENT
    End

    Behavior = AIUpdateInterface ModuleTag_03
        AutoAcquireEnemiesWhenIdle         = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate                = 500
        CanAttackWhileContained            = Yes
        AILuaEventsList                    = GilGaladFunctions
    End

    Behavior = AutoHealBehavior ModuleTag_AragornHealing
        StartsActive                 = Yes
        HealingAmount                 = HERO_HEAL_AMOUNT
        HealingDelay                 = 1000
        StartHealingDelay             = HERO_HEAL_DELAY
        HealOnlyIfNotInCombat             = Yes
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = Hero
    End

    LocomotorSet
        Locomotor = GondorTowerShieldGuardLocomotor
        Condition = SET_NORMAL
        Speed     = 54
    End

    Behavior = PhysicsBehavior ModuleTag_04
        GravityMult                 = 1.0
        ShockStunnedTimeLow                = 1400
        ShockStunnedTimeHigh            = 2400
        ShockStandingTime                = 1333
    End

    Behavior = SlowDeathBehavior ModuleTag_05
        DeathTypes                     = ALL -FADED
        SinkDelay                     = 3000
        SinkRate                     = 0.40
        DestructionDelay             = 8000
        Sound                         = INITIAL GilGaladVoiceDie
        DeathFlags                     = DEATH_1
    End

    Behavior = SlowDeathBehavior ModuleTag_FadeDeath
        DeathTypes                     = NONE +FADED
        FadeDelay                     = 0
        FadeTime                     = 2500
        DestructionDelay             = 2500
        Sound                         = INITIAL SpellGenericUnsummonFasterMS
        DeathFlags                     = DEATH_2
    End

    Behavior = HitReactionBehavior HitReactionBehaviorModuleTag
        HitReactionLifeTimer1             = 2700
        HitReactionLifeTimer2             = 3366
        HitReactionLifeTimer3             = 10

        HitReactionThreshold1             = 5.0
        HitReactionThreshold2             = 100.0
        HitReactionThreshold3             = 300.0
    End

    Behavior = ExperienceLevelCreate ModuleTag_LevelBonus
        LevelToGrant = 10
        MPOnly = No
    End

    Behavior = LifetimeUpdate ModuleTag_LifetimeUpdate
        MinLifetime                  = 180000
        MaxLifetime                  = 180000
        DeathType                    = FADED
    End











    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_LuthienLeadership
        SpecialPowerTemplate             = SpecialAbilityFakeLeadership
        TriggeredBy                      = Upgrade_Level_1
    End

    Behavior = SpecialPowerModule ModuleTag_LuthienLeadershipUpdate
        SpecialPowerTemplate             = SpecialAbilityFakeLeadership
        UpdateModuleStartsAttack         = No
        StartsPaused                     = No
    End

    Behavior = AttributeModifierAuraUpdate ModuleTag_Leadership
        StartsActive                     = Yes
        BonusName                        = LuthienLeadership
        RefreshDelay                     = 2000
        Range                            = 300
        ObjectFilter                     = ANY +INFANTRY +CAVALRY +HERO -MACHINE +MONSTER -STRUCTURE -IMMOBILE +DOZER
    End

    Behavior = PassiveAreaEffectBehavior ModuleTag_SplashOfHealingWater_Ahh
        EffectRadius                     = 200
        PingDelay                        = 2000
        HealPercentPerSecond             = 5%
        AllowFilter                      = ANY +INFANTRY +CAVALRY +HERO -MACHINE +MONSTER -STRUCTURE -IMMOBILE +DOZER ALLIES
        NonStackable                     = Yes
        HealFX                           = FX_SpellHealUnitHealBuff
    End





    Behavior = SpecialPowerModule ModuleTag_ShieldBubbleStarter
        SpecialPowerTemplate             = SpecialPowerShieldBubbleEdain
        UpdateModuleStartsAttack         = No
        AttributeModifier                = EcthelionShieldBonus
        AttributeModifierRange           = 1
        AttributeModifierAffectsSelf     = Yes
        AttributeModifierAffects         = ANY +CAVALRY +INFANTRY
        SetModelCondition                = ModelConditionState:USER_1
        SetModelConditionTime            = 2.5
    End

    Behavior = SpecialAbilityUpdate ModuleTag_ShieldBubbleUpdate
        SpecialPowerTemplate             = SpecialPowerShieldBubbleEdain
        UnpackTime                       = 0
        PreparationTime                  = 0.1
        PackTime                         = 0.15
        AwardXPForTriggering             = 0
    End

    Behavior = AutoAbilityBehavior ModuleTag_AutoAbilitySpecialPowerShieldBubble
        SpecialAbility                   = SpecialPowerShieldBubbleEdain
        StartsActive                     = Yes
        MaxScanRange                     = 50
        Query                            = 1 ANY ENEMIES +MONSTER
    End

    Behavior = ReflectDamage ModuleTag_ReflectDamage
        DamageTypesToReflect             = +MAGIC
        ReflectDamagePercentage          = 50%
        MinimumDamageToReflect           = 0.2
    End

    Behavior = ArmorUpgrade ArmorUpgradeModuleTag
        TriggeredBy                      = Upgrade_Level_10
    End





    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_AEcthelionFluteEnabler
        SpecialPowerTemplate         = SpecialAbilityEcthelionFlute
        TriggeredBy             = Upgrade_Level_10
        ObeyRechageOnTrigger            = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_EcthelionFluteStarter
        SpecialPowerTemplate        = SpecialAbilityEcthelionFlute
        StartsPaused                = Yes
    End

    Behavior = HeroModeSpecialAbilityUpdate ModuleTag_EcthelionFluteUpdate
        SpecialPowerTemplate        = SpecialAbilityEcthelionFlute
        HeroAttributeModifier       = EcthelionFluteSelfBuff
        HeroEffectDuration          = 40000
        UnpackTime                  = 1
    End

    Behavior = AutoAbilityBehavior ModuleTag_AutoAbilityEcthelionFlute
        SpecialAbility              = SpecialAbilityEcthelionFlute
        MaxScanRange                = 30
        Query                       = 1 ANY ENEMIES +INFANTRY +CAVALRY +HERO -STRUCTURE
    End

    Behavior = FireWeaponUpdate ModuleTag_WeaponFiring
        FireWeaponNugget
            WeaponName = EcthelionFluteWeapon
            Offset = X:0 Y:0 Z:0
            FireDelay = 0
            OneShot = No
        End
        HeroModeTrigger = Yes
    End



    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName  = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName  = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName  = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Behavior = AISpecialPowerUpdate Flute_AI
        CommandButtonName  = Command_EcthelionFlute
        SpecialPowerAIType = AI_SPECIAL_POWER_BASIC_SELF_BUFF
    End


    Scale             	= 1.07
    Geometry            = CYLINDER
    GeometryMajorRadius = 8.0
    GeometryMinorRadius = 8.0
    GeometryHeight      = 19.2
    GeometryIsSmall     = Yes
    Shadow              = SHADOW_DECAL
    ShadowSizeX         = 19
    ShadowSizeY         = 19
    ShadowTexture       = ShadowI
End