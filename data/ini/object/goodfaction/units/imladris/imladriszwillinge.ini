Object ImladrisZwillingeEdain

    SelectPortrait        = HPZwillinge2
    ButtonImage           = HPZwillinge2

    DescriptionStrategic = CONTROLBAR:LW_ToolTip_LeaderHero

    Draw = W3DScriptedModelDraw ModuleTag_DRAW

        DefaultModelConditionState
            Model           = EUZwilling_SKN
            Skeleton        = zwilling_skl
        End

        ModelConditionState = WEAPONSET_HERO_MODE
            ParticleSysBone = BAT_RIBS ExpBonus FollowBone:Yes
            ParticleSysBone = BAT_RIBS1 ExpBonus FollowBone:Yes
        End


        TransitionState                = TRANS_boredToAttention
            Animation            = stha
                AnimationName        = zwilling_stha
                AnimationMode        = ONCE
            End
        End

        TransitionState                = TRANS_attentionToBored
            Animation            = stha
                AnimationName        = zwilling_stha
                AnimationMode        = ONCE_BACKWARDS
            End
            Flags                = START_FRAME_LAST
        End

       IdleAnimationState
            StateName            = STATE_bored
            Animation            = chra
                AnimationName        = zwilling_chra
                AnimationMode        = ONCE
                AnimationPriority    = 1
            End
            Animation            = idla
                AnimationName        = zwilling_idla
                AnimationMode        = ONCE
                AnimationPriority    = 7
            End
            Animation            = idlb
                AnimationName        = zwilling_idlb
                AnimationMode        = ONCE
                AnimationPriority    = 2
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if    Prev == "STATE_attention" or
                    Prev == "STATE_running" or
                    Prev == "OATH_BREAKERS" then CurDrawableSetTransitionAnimState("TRANS_attentionToBored") end
            EndScript
        End


        AnimationState            = THROWN_PROJECTILE
            Animation        = FLYA
                AnimationName    = zwilling_flya
                AnimationMode    = LOOP
            End
        End


        AnimationState            = STUNNED_FLAILING
            Animation        = FLYA
                AnimationName    = zwilling_flya
                AnimationMode    = LOOP
            End
        End

        AnimationState             = DYING SPLATTED DEATH_1
            Animation         = Splatted_On_Ground
                AnimationName    = zwilling_lnda
                AnimationMode    = ONCE
            End
            EnteringStateFX        = FX_SoldierHitGround
        End

        AnimationState                = DYING DEATH_1
            Animation            = diea
                AnimationName        = zwilling_diea
                AnimationMode        = ONCE
            End

        End

        AnimationState                = DYING DEATH_2
            Animation            = ByeBye
                AnimationName        = zwilling_idla
                AnimationMode        = LOOP
            End

        End

        AnimationState                = STUNNED
            Animation            = lnda
                AnimationName        = zwilling_lnda
                AnimationMode        = ONCE
            End
            EnteringStateFX            = FX_SoldierHitGround
        End


        AnimationState                = STUNNED_STANDING_UP
            Animation            = zwilling_gtpa
                AnimationName        = zwilling_gtpa
                AnimationMode        = ONCE
                AnimationSpeedFactorRange = 1.5 1.5
            End
        End

       AnimationState                    = MOVING FIRING_OR_PREATTACK_A
            ShareAnimation            = Yes
            Animation                   = RunAndFire
                AnimationName          = zwilling_atra
                AnimationMode           = LOOP
            End
            Flags                       = RANDOMSTART

        End
        AnimationState                    = MOVING FIRING_OR_PREATTACK_A WEAPONSET_HERO_MODE
            ShareAnimation            = Yes
            Animation                   = RunAndFire
                AnimationName          = zwilling_atra
                AnimationMode           = LOOP
            End
            Flags                       = RANDOMSTART
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if    Prev == "STATE_bored" then CurDrawableSetTransitionAnimState("TRANS_boredToAttention") end
            EndScript
        End

        AnimationState                = FIRING_OR_PREATTACK_A WEAPONSET_HERO_MODE
            StateName            = STATE_attention
            Animation            = ATKD
                AnimationName        = zwilling_atkd
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 5
            End
            Animation            = ATKJ
                AnimationName        = zwilling_atkj
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 2
            End
            Animation            = ATKE
                AnimationName        = zwilling_atke
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 4
            End
            Animation            = ATKD1
                AnimationName        = zwilling_atkd1
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 4
            End
            Animation            = ATKD2
                AnimationName        = zwilling_atkd2
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 3
            End
            Flags                = RESTART_ANIM_WHEN_COMPLETE
            FXEvent    = Frame:25 Name: FX_BladeMasterHitOrient
            FXEvent    = Frame:45 Name: FX_BladeMasterHitOrient
        End

        AnimationState                = FIRING_OR_PREATTACK_A
            StateName            = STATE_attention
            Animation            = ATKD
                AnimationName        = zwilling_atkd
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 5
            End
            Animation            = ATKJ
                AnimationName        = zwilling_atkj
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 2
            End
            Animation            = ATKE
                AnimationName        = zwilling_atke
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 4
            End
            Animation            = ATKD1
                AnimationName        = zwilling_atkd1
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 3
            End
            Animation            = ATKD2
                AnimationName        = zwilling_atkd2
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 3
            End
            Flags                = RESTART_ANIM_WHEN_COMPLETE
        End

        AnimationState                = FIRING_OR_PREATTACK_C
            StateName            = STATE_attention
            Animation            = ATKD
                AnimationName        = zwilling_atkd
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 5
            End
            Animation            = ATKJ
                AnimationName        = zwilling_atkj
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 2
            End
            Animation            = ATKE
                AnimationName        = zwilling_atke
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 4
            End
            Animation            = ATKD1
                AnimationName        = zwilling_atkd1
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 3
            End
            Animation            = ATKD2
                AnimationName        = zwilling_atkd2
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 3
            End
        End

        AnimationState          =  SPECIAL_WEAPON_ONE
            Animation           = ATKK
                AnimationName   = zwilling_atkk
                AnimationMode   = ONCE
                UseWeaponTiming = Yes
            End
        End

        AnimationState                = MOVING
            StateName            = STATE_running
            Animation            = zwilling_runb
                AnimationName        = zwilling_runb
                AnimationMode        = LOOP
            End
        End

       AnimationState                = LEVELED
            Animation            = LevelUp
                AnimationName        = zwilling_chra
                AnimationMode        = ONCE
            End
        End

        AnimationState                = USER_2
            StateName            = ATHELAS
            Animation            = ATKP
                AnimationName        = zwilling_chra
                AnimationMode        = ONCE
            End
        End

        AnimationState                = USER_1
            StateName            = OATH_BREAKERS
            Animation            = ATKN
                AnimationName        = zwilling_chrb
                AnimationMode        = ONCE
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if    Prev == "STATE_attention" then CurDrawableSetTransitionAnimState("TRANS_attentionToBored") end
            EndScript
        End

        AnimationState                = SPECIAL_WEAPON_TWO
            StateName            = STATE_ready
            Animation            = chrb
                AnimationName        = zwilling_chrb
                AnimationMode        = ONCE
            End
        End

        AnimationState                = RAISING_FLAG
            StateName                = STATE_ready
            Animation                = chra
                AnimationName        = zwilling_chra
                AnimationMode        = LOOP
            End
        End

        AnimationState                = EMOTION_CELEBRATING
            StateName            = STATE_ready
            Animation            = chrb
                AnimationName        = zwilling_chrb
                AnimationMode        = ONCE
                AnimationPriority    = 1
            End
            Flags                = RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if    Prev == "STATE_attention" then CurDrawableSetTransitionAnimState("TRANS_attentionToBored") end
            EndScript
        End

        AnimationState                = EMOTION_ALERT
            StateName            = STATE_ready
            Animation            = idlj
                AnimationName        = zwilling_idlj
                AnimationMode        = ONCE
                AnimationPriority    = 1
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if    Prev == "STATE_attention" then CurDrawableSetTransitionAnimState("TRANS_attentionToBored") end
            EndScript
        End

        AnimationState                = ENGAGED
            StateName            = STATE_ready
            Animation            = idlj
                AnimationName        = zwilling_idlj
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 1
            End
            Flags                = RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if    Prev == "STATE_attention" then CurDrawableSetTransitionAnimState("TRANS_attentionToBored") end
            EndScript
        End

        AnimationState                 = SELECTED
             StateName             = STATE_attention
                Animation             = idlj
                     AnimationName         = zwilling_idlj
                      AnimationMode         = LOOP
                AnimationBlendTime    = 5
                AnimationMustCompleteBlend = Yes
             End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if    Prev == "STATE_bored" or
                    Prev == "STATE_ready" then CurDrawableSetTransitionAnimState("TRANS_boredToAttention") end
            EndScript
         End

    End


    Draw = W3DScriptedModelDraw Icon
        ModelConditionState = NONE
            Model           = bbox
        End
    End

    #include "..\..\..\includes\StunDrawModuleSmall.inc"


    Side                         = Imladris
    EditorSorting                = UNIT
    ThreatLevel                  = HALDIR_THREAT_LEVEL
    ThingClass                   = CHARACTER_UNIT
    BuildCost                    = THETWINSDAG_COST
    BuildTime                    = WEAK_HERO_BUILDTIME

    TransportSlotCount           = TRANSPORTSLOTCOUNT_HERO
    VisionRange                  = VISION_HERO_STANDARD
    ShroudClearingRange          = SHROUD_CLEAR_HERO
    MaxVisionBonusPercent        = 300%
    VisionBonusTestRadius        = 200
    VisionBonusPercentPerFoot    = 1.0%
    DisplayMeleeDamage           = THETWINSDAG_DAMAGE

    BountyValue                  = ELVEN_HALDIR_BOUNTY_VALUE
    RecruitText                  = CONTROLBAR:ImladrisZwillingRecruit
    ReviveText                   = CONTROLBAR:ImladrisZwillingRevive
    Hotkey                       = CONTROLBAR:ImladrisZwillingHotkeyNew
    DisplayName                  = OBJECT:ImladrisZwillingNewModeNew
    CrushableLevel               = 2
    CommandSet                   = BruchtalZwillingeCommandSet
    CommandPoints                = 0
    HeroSortOrder                = 40

    WeaponSet
        Conditions               = None
        Weapon                   = PRIMARY  ZwillingeSword
        AutoChooseSources        = PRIMARY  FROM_PLAYER FROM_SCRIPT FROM_AI
    End

    WeaponSet
        Conditions               = HIDDEN
        Weapon                   = PRIMARY  ZwillingeSwordKriegslist
        AutoChooseSources        = PRIMARY  FROM_PLAYER FROM_SCRIPT FROM_AI
    End

    ArmorSet
        Conditions               = None
        Armor                    = MediumHeroArmor
        DamageFX                 = NormalDamageFX
    End



    AutoResolveUnitType = AutoResolveUnit_Hero
    AutoResolveCombatChain = AutoResolve_HeroCombatChain

    AutoResolveBody = AutoResolve_HaldirBody

    AutoResolveArmor
        Armor = AutoResolve_HaldirArmor
    End

    AutoResolveWeapon
        Weapon = AutoResolve_HaldirWeapon
    End





    VoiceAttack                             = ZwillingeVoiceAttack
    VoiceAttackCharge                       = ZwillingeVoiceAttack
    VoiceAttackMachine                      = ZwillingeVoiceAttack
    VoiceAttackStructure                    = ZwillingeVoiceAttack
    VoiceFear                               = ZwillingeVoiceHelpMe
    VoiceCreated                            = ZwillingeVoiceVoiceSalute
    VoiceFullyCreated                       = ZwillingeVoiceVoiceSalute
    VoiceGuard                              = ZwillingeVoiceMove
    VoiceMove                               = ZwillingeVoiceMove
    VoiceMoveToCamp                         = ZwillingeVoiceMove
    VoiceMoveWhileAttacking                 = ZwillingeVoiceRetreat
    VoicePriority                           = 62
    VoiceRetreatToCastle                    = ZwillingeVoiceRetreat
    VoiceSelect                             = ZwillingeVoiceSelect
    VoiceSelectBattle                       = ZwillingeVoiceSelectinBattle

    SoundImpact                             = ImpactHorse

    UnitSpecificSounds
        VoiceEnterUnitElvenTransportShip    = ZwillingeVoiceMove
        VoiceGarrison                       = ZwillingeVoiceMove
        VoiceInitiateCaptureBuilding        = ZwillingeVoiceMove
    End


    CrowdResponseKey = ElfHero

    #include "..\..\..\includes\StandardUnitEvaEvents.inc"


    Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
        Key    = Humanoid_Male Elf Elf_Male Unit Infantry Hero
    End


    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound:FootstepDirtA                               Animation:Zwilling_SKL.Zwillinge_RUNB    Frames:8 17 26 36
        AnimationSound = Sound:BodyFallGenericNoArmor                      Animation:Zwilling_SKL.Zwillinge_DIEA    Frames:55
        AnimationSound = Sound:BodyFallGenericNoArmor                      Animation:Zwilling_SKL.Zwillinge_DIEB    Frames:70
        AnimationSound = Sound:BodyFallSoldier                             Animation:Zwilling_SKL.Zwillinge_LNDA    Frames:1
    End





    RadarPriority                           = UNIT
    KindOf                                  = HERO PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE ARMY_SUMMARY ATTACK_NEEDS_LINE_OF_SIGHT HEAVY_MELEE_HITTER
    CamouflageDetectionMultiplier           = CAMOUFLAGE_DETECTION_DISTANCE_MEDIUM
    PathfindDiameter                        = 40.0


    Body = RespawnBody ModuleTag_RespawnBody
        CheerRadius                         = EMOTION_CHEER_RADIUS
        MaxHealth                           = THETWINSDAG_HEALTH
        PermanentlyKilledByFilter           = NONE
        DodgePercent                        = HERO_DODGE_PERCENT
    End

    Behavior = RespawnUpdate ModuleTag_RespawnUpdate
        DeathAnim                    = STUNNED
        DeathAnim                    = DYING
        DeathAnimationTime           = 6500
        RespawnAnim                  = LEVELED
        RespawnAnimationTime         = 2000
        AutoRespawnAtObjectFilter    = NONE +CASTLE_KEEP
        ButtonImage                  = HPZwillinge2
        RespawnAsTemplate            = ImladrisZwillingeEdain

        RespawnRules =    AutoSpawn:No           Cost:THETWINSDAG_COST       Time:MEDIUM_HERO_RESPAWNTIME        Health:100%
   End


    Behavior = AIUpdateInterface ModuleTag_03
        AutoAcquireEnemiesWhenIdle             = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate                    = 500
        CanAttackWhileContained                = Yes
        AILuaEventsList                        = ZwillingeFunctions2
    End






    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_betretenUnpause
        SpecialPowerTemplate         = SpecialAbilityToggleZwillingeSchmiede
        TriggeredBy                  = Upgrade_Level_1
        ObeyRechageOnTrigger         = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_betretenStarter
        SpecialPowerTemplate        = SpecialAbilityToggleZwillingeSchmiede
        UpdateModuleStartsAttack    = Yes
        StartsPaused                = Yes
        AvailableAtStart            = No
    End

    Behavior = ToggleMountedSpecialAbilityUpdate ModuleTag_betreten
         SpecialPowerTemplate       = SpecialAbilityToggleZwillingeSchmiede
         StartAbilityRange          = 50.0
         MountedTemplate            = ImladrisZwillingeEdain_Schmiede
         SynchronizeTimerOnSpecialPower = SpecialAbilityNazgulGeisterform SpecialAbilityKlingentanz SpecialAbilityAragornBladeMaster
         UnpackTime                 = OBJECT_TOGGLE_TIME
         PreparationTime            = 1
         PackTime                   = 0
         OpacityTarget              = 1
         AwardXPForTriggering       = 0
         IgnoreFacingCheck          = Yes
    End







    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_KriegerEnabler
        SpecialPowerTemplate  = SpecialAbilityAragornBladeMaster
        TriggeredBy           = Upgrade_Level_3
        ObeyRechageOnTrigger  = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_KriegerStarter
        SpecialPowerTemplate  = SpecialAbilityAragornBladeMaster
        StartsPaused          = Yes
    End

    Behavior = HeroModeSpecialAbilityUpdate ModuleTag_KriegerUpdate
        SpecialPowerTemplate  = SpecialAbilityAragornBladeMaster
        HeroAttributeModifier = ZwillingeEdainBladeMaster
        HeroEffectDuration    = 30000
        UnpackTime            = 1
        TriggerSound          = AragornBladeMaster
    End

    Behavior = HitReactionBehavior HitReactionBehaviorModuleTag
        HitReactionLifeTimer1 = 100
        HitReactionLifeTimer2 = 1000
        HitReactionLifeTimer3 = 1993

        HitReactionThreshold1 = 0.0
        HitReactionThreshold2 = 25.0
        HitReactionThreshold3 = 50.0
    End







    Behavior = AttributeModifierAuraUpdate ModuleTag_KriegsrustungLeadershipUpdate
        StartsActive     = No
        BonusName        = Kriegsrustung
        TriggeredBy      = Upgrade_Level_5
        RefreshDelay     = 2000
        Range            = 1
        AllowSelf        = Yes

        ObjectFilter     = NONE +ImladrisZwillingeEdain
    End

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_KriegsrustungLeadershipUnpause
        SpecialPowerTemplate = SpecialAbilityFakeLeadership
        TriggeredBy = Upgrade_Level_5
    End

    Behavior = SpecialPowerModule ModuleTag_KriegsrustungLeadershipPower
        SpecialPowerTemplate      = SpecialAbilityFakeLeadership
        UpdateModuleStartsAttack  = No
        StartsPaused = Yes
    End

    Behavior = SubObjectsUpgrade ForgedBlades_UpgradeHideALl
        TriggeredBy       = Upgrade_Level_1
        HideSubObjects    = ELROHIRGEAR ELLADANGEAR
    End

    Behavior = SubObjectsUpgrade ForgedBlades_Upgrade
        TriggeredBy       = Upgrade_Level_5
        ShowSubObjects    = ELROHIRGEAR ELLADANGEAR
    End







    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_KriegslistEnabler
        SpecialPowerTemplate        = SpecialAbilityNazgulGeisterform
        TriggeredBy                 = Upgrade_Level_7
        ObeyRechageOnTrigger        = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_KriegslistStarter
        SpecialPowerTemplate        = SpecialAbilityNazgulGeisterform
        UpdateModuleStartsAttack    = Yes
        StartsPaused                = Yes
    End

    Behavior = ToggleHiddenSpecialAbilityUpdate ModuleTag_KriegslistUpdate
        SpecialPowerTemplate        = F
        EffectDuration              = 10000
        ShowPalantirTimer           = Yes
    End

    Behavior = InvisibilityUpdate ModuleTag_StealthForEscape
        InvisibilityNugget
            InvisibilityType        = STEALTH
            ForbiddenConditions     = FIRING_ANY
            BecomeStealthedFX       = FX_ElvenCloakOn
            ExitStealthFX           = FX_ElvenCloakOff
            Options                 = UNTOGGLE_HIDDEN_WHEN_LEAVING_STEALTH
        End
        StartsActive                = No
        UpdatePeriod                = 2000
    End







    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_TrennenUnpause
        SpecialPowerTemplate         = SpecialAbilityVampirzuGorthaur
        TriggeredBy                  = Upgrade_Level_10
        ObeyRechageOnTrigger         = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_TrennenStarter
        SpecialPowerTemplate        = SpecialAbilityVampirzuGorthaur
        UpdateModuleStartsAttack    = Yes
        StartsPaused                = Yes
        AvailableAtStart            = No
    End

    Behavior = ToggleMountedSpecialAbilityUpdate ModuleTag_Trennen
         SpecialPowerTemplate       = SpecialAbilityVampirzuGorthaur
         StartAbilityRange          = 50.0
         MountedTemplate            = ImladrisZwillinge_Elrohir
         SynchronizeTimerOnSpecialPower = SpecialAbilityNazgulGeisterform SpecialAbilityKlingentanz SpecialAbilityAragornBladeMaster
         UnpackTime                 = OBJECT_TOGGLE_TIME
         PreparationTime            = 1
         PackTime                   = 0
         OpacityTarget              = 1
         AwardXPForTriggering       = 0
         IgnoreFacingCheck          = Yes
    End




    Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance                = 200
        TauntAndPointUpdateDelay             = 10000
        PointAt                              = ANY +HERO
        AddEmotion            =    Doom_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
        AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    Alert_Base
        AddEmotion            =    CheerForAboutToCrush_Base
    End

    Behavior = AutoHealBehavior ModuleTag_LegolasHealing
        StartsActive                        = Yes
        HealingAmount                        = HERO_HEAL_AMOUNT
        HealingDelay                        = 1000
        StartHealingDelay                    = HERO_HEAL_DELAY
        HealOnlyIfNotInCombat                = Yes
    End

    Behavior = AutoHealBehavior ModuleTag_ElvenGiftHealing
        StartsActive                	= No
        TriggeredBy                     = Upgrade_ElvenGift
        HealingAmount                	= ELVEN_GIFT_REGEN_AMOUNT
        HealingDelay                	= ELVEN_GIFT_REGEN_DELAY
        StartHealingDelay 		= HERO_HEAL_DELAY
        HealOnlyIfNotInCombat 		= Yes
    End

    Behavior = AttributeModifierUpgrade ModuleTag_ElvenGiftBonus
        TriggeredBy = Upgrade_ElvenGift
        AttributeModifier = SpellBookElvenGifts
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate                        = Hero
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    LocomotorSet
        Locomotor                            = HumanLocomotor
        Condition                            = SET_NORMAL
        Speed                                = NORMAL_ELVEN_FAST_MEMBER_SPEED
    End

    LocomotorSet
        Locomotor                            = HumanWanderLocomotor
        Condition                            = SET_WANDER
        Speed                                = NORMAL_GOOD_FAST_MEMBER_SPEED
    End


    Behavior = PhysicsBehavior ModuleTag_04
        GravityMult                          = 1.0
        ShockStandingTime                    = 2000
    End

    Behavior = SlowDeathBehavior ModuleTag_05
        DeathTypes                          = ALL -FADED
        SinkDelay                           = 3000
        SinkRate                            = 0.5
        DestructionDelay                    = 15000
        Sound                               = INITIAL ZwillingeVoiceDie
        DeathFlags                          = DEATH_1
    End

    Behavior = SlowDeathBehavior ModuleTag_FadeDeath
        DeathTypes                          = NONE +FADED
        FadeDelay                           = 0
        FadeTime                            = 0
        DestructionDelay                    = 0
        DeathFlags                          = DEATH_2
    End

    Behavior = SquishCollide ModuleTag_06
    End

    Behavior = FireWeaponUpdate FireWeaponUpdateModuleTag
        FireWeaponNugget
            WeaponName = ZwillingeTrennenWeapon
            FireDelay = 0
            OneShot = No
        End
    End






    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End


    Behavior = AISpecialPowerUpdate AragornBladeMasterAI
        CommandButtonName = Command_SpecialAbilityKriegerBruchtals
        SpecialPowerAIType = AI_SPECIAL_POWER_BASIC_SELF_BUFF
    End

    Behavior = AISpecialPowerUpdate GandalfWordOfPowerAI
        CommandButtonName = Command_SpecialAbilityKlingentanzNoldorZwillinge
        SpecialPowerAIType = AI_SPECIAL_POWER_BASIC_SELF_BUFF
        SpecialPowerRadius = 250
    End


    Geometry             = CYLINDER
    GeometryMajorRadius  = 10.0
    GeometryHeight       = 19.0
    GeometryIsSmall      = Yes
    Shadow               = SHADOW_DECAL
    ShadowSizeX          = 19
    ShadowSizeY          = 19
    ShadowTexture        = ShadowI
End

Object ImladrisZwillinge_Elrohir

    SelectPortrait        = HPZwillingeElrohir
    ButtonImage           = HIZwillingeElrohir

    DescriptionStrategic = CONTROLBAR:LW_ToolTip_LeaderHero

    Draw = W3DScriptedModelDraw ModuleTag_DRAW

        DefaultModelConditionState
            Model           = EUZwilling_SKN
            Skeleton        = zwilling_skl
        End

        ModelConditionState = WEAPONSET_HERO_MODE
            ParticleSysBone = BAT_RIBS1 ExpBonus FollowBone:Yes
        End


        TransitionState                = TRANS_boredToAttention
            Animation            = stha
                AnimationName        = zwilling_stha
                AnimationMode        = ONCE
            End
        End

        TransitionState                = TRANS_attentionToBored
            Animation            = stha
                AnimationName        = zwilling_stha
                AnimationMode        = ONCE_BACKWARDS
            End
            Flags                = START_FRAME_LAST
        End

       IdleAnimationState
            StateName            = STATE_bored
            Animation            = chra
                AnimationName        = zwilling_chra
                AnimationMode        = ONCE
                AnimationPriority    = 1
            End
            Animation            = idla
                AnimationName        = zwilling_idla
                AnimationMode        = ONCE
                AnimationPriority    = 7
            End
            Animation            = idlb
                AnimationName        = zwilling_idlb
                AnimationMode        = ONCE
                AnimationPriority    = 2
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if    Prev == "STATE_attention" or
                    Prev == "STATE_running" or
                    Prev == "OATH_BREAKERS" then CurDrawableSetTransitionAnimState("TRANS_attentionToBored") end
            EndScript
        End


        AnimationState            = THROWN_PROJECTILE
            Animation        = FLYA
                AnimationName    = zwilling_flya
                AnimationMode    = LOOP
            End
        End


        AnimationState            = STUNNED_FLAILING
            Animation        = FLYA
                AnimationName    = zwilling_flya
                AnimationMode    = LOOP
            End
        End

        AnimationState             = DYING SPLATTED DEATH_1
            Animation         = Splatted_On_Ground
                AnimationName    = zwilling_lnda
                AnimationMode    = ONCE
            End
            EnteringStateFX        = FX_SoldierHitGround
        End

        AnimationState                = DYING DEATH_1
            Animation            = diea
                AnimationName        = zwilling_diea
                AnimationMode        = ONCE
            End

        End

        AnimationState                = DYING DEATH_2
            Animation            = ByeBye
                AnimationName        = zwilling_idla
                AnimationMode        = LOOP
            End

        End

        AnimationState                = STUNNED
            Animation            = lnda
                AnimationName        = zwilling_lnda
                AnimationMode        = ONCE
            End
            EnteringStateFX            = FX_SoldierHitGround
        End


        AnimationState                = STUNNED_STANDING_UP
            Animation            = zwilling_gtpa
                AnimationName        = zwilling_gtpa
                AnimationMode        = ONCE
                AnimationSpeedFactorRange = 1.5 1.5
            End
        End

       AnimationState                    = MOVING FIRING_OR_PREATTACK_A
            ShareAnimation            = Yes
            Animation                   = RunAndFire
                AnimationName          = zwilling_atra
                AnimationMode           = LOOP
            End
            Flags                       = RANDOMSTART

        End
        AnimationState                    = MOVING FIRING_OR_PREATTACK_A WEAPONSET_HERO_MODE
            ShareAnimation            = Yes
            Animation                   = RunAndFire
                AnimationName          = zwilling_atra
                AnimationMode           = LOOP
            End
            Flags                       = RANDOMSTART
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if    Prev == "STATE_bored" then CurDrawableSetTransitionAnimState("TRANS_boredToAttention") end
            EndScript
        End

        AnimationState                = FIRING_OR_PREATTACK_A WEAPONSET_HERO_MODE
            StateName            = STATE_attention
            Animation            = ATKD
                AnimationName        = zwilling_atkd
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 5
            End
            Animation            = ATKJ
                AnimationName        = zwilling_atkj
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 2
            End
            Animation            = ATKE
                AnimationName        = zwilling_atke
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 4
            End
            Animation            = ATKD1
                AnimationName        = zwilling_atkd1
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 4
            End
            Animation            = ATKD2
                AnimationName        = zwilling_atkd2
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 3
            End
            Flags                = RESTART_ANIM_WHEN_COMPLETE
            FXEvent    = Frame:25 Name: FX_BladeMasterHitOrient
            FXEvent    = Frame:45 Name: FX_BladeMasterHitOrient
        End

        AnimationState                = FIRING_OR_PREATTACK_A
            StateName            = STATE_attention
            Animation            = ATKD
                AnimationName        = zwilling_atkd
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 5
            End
            Animation            = ATKJ
                AnimationName        = zwilling_atkj
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 2
            End
            Animation            = ATKE
                AnimationName        = zwilling_atke
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 4
            End
            Animation            = ATKD1
                AnimationName        = zwilling_atkd1
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 3
            End
            Animation            = ATKD2
                AnimationName        = zwilling_atkd2
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 3
            End
            Flags                = RESTART_ANIM_WHEN_COMPLETE
        End

        AnimationState                = FIRING_OR_PREATTACK_C
            StateName            = STATE_attention
            Animation            = ATKD
                AnimationName        = zwilling_atkd
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 5
            End
            Animation            = ATKJ
                AnimationName        = zwilling_atkj
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 2
            End
            Animation            = ATKE
                AnimationName        = zwilling_atke
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 4
            End
            Animation            = ATKD1
                AnimationName        = zwilling_atkd1
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 3
            End
            Animation            = ATKD2
                AnimationName        = zwilling_atkd2
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 3
            End
        End

        AnimationState          =  SPECIAL_WEAPON_ONE
            Animation           = ATKK
                AnimationName   = zwilling_atkk
                AnimationMode   = ONCE
                UseWeaponTiming = Yes
            End
        End

        AnimationState                = MOVING
            StateName            = STATE_running
            Animation            = zwilling_runb
                AnimationName        = zwilling_runb
                AnimationMode        = LOOP
            End
        End

       AnimationState                = LEVELED
            Animation            = LevelUp
                AnimationName        = zwilling_chra
                AnimationMode        = ONCE
            End
        End

        AnimationState                = USER_2
            StateName            = ATHELAS
            Animation            = ATKP
                AnimationName        = zwilling_chra
                AnimationMode        = ONCE
            End
        End

        AnimationState                = USER_1
            StateName            = OATH_BREAKERS
            Animation            = ATKN
                AnimationName        = zwilling_chrb
                AnimationMode        = ONCE
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if    Prev == "STATE_attention" then CurDrawableSetTransitionAnimState("TRANS_attentionToBored") end
            EndScript
        End

        AnimationState                = SPECIAL_WEAPON_TWO
            StateName            = STATE_ready
            Animation            = chrb
                AnimationName        = zwilling_chrb
                AnimationMode        = ONCE
            End
        End

        AnimationState                = RAISING_FLAG
            StateName                = STATE_ready
            Animation                = chra
                AnimationName        = zwilling_chra
                AnimationMode        = LOOP
            End
        End

        AnimationState                = EMOTION_CELEBRATING
            StateName            = STATE_ready
            Animation            = chrb
                AnimationName        = zwilling_chrb
                AnimationMode        = ONCE
                AnimationPriority    = 1
            End
            Flags                = RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if    Prev == "STATE_attention" then CurDrawableSetTransitionAnimState("TRANS_attentionToBored") end
            EndScript
        End

        AnimationState                = EMOTION_ALERT
            StateName            = STATE_ready
            Animation            = idlj
                AnimationName        = zwilling_idlj
                AnimationMode        = ONCE
                AnimationPriority    = 1
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if    Prev == "STATE_attention" then CurDrawableSetTransitionAnimState("TRANS_attentionToBored") end
            EndScript
        End

        AnimationState                = ENGAGED
            StateName            = STATE_ready
            Animation            = idlj
                AnimationName        = zwilling_idlj
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 1
            End
            Flags                = RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if    Prev == "STATE_attention" then CurDrawableSetTransitionAnimState("TRANS_attentionToBored") end
            EndScript
        End

        AnimationState                 = SELECTED
             StateName             = STATE_attention
                Animation             = idlj
                     AnimationName         = zwilling_idlj
                      AnimationMode         = LOOP
                AnimationBlendTime    = 5
                AnimationMustCompleteBlend = Yes
             End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if    Prev == "STATE_bored" or
                    Prev == "STATE_ready" then CurDrawableSetTransitionAnimState("TRANS_boredToAttention") end
            EndScript
         End

    End


    Draw = W3DScriptedModelDraw Icon
        ModelConditionState = NONE
            Model           = bbox
        End
    End

    #include "..\..\..\includes\StunDrawModuleSmall.inc"


    Side                         = Imladris
    EditorSorting                = UNIT
    ThreatLevel                  = HALDIR_THREAT_LEVEL
    ThingClass                   = CHARACTER_UNIT
    BuildCost                    = THETWINSDAG_COST
    BuildTime                    = MEDIUM_HERO_BUILDTIME
    TransportSlotCount           = TRANSPORTSLOTCOUNT_HERO
    VisionRange                  = VISION_HERO_STANDARD
    ShroudClearingRange          = SHROUD_CLEAR_HERO
    MaxVisionBonusPercent        = 300%
    VisionBonusTestRadius        = 200
    VisionBonusPercentPerFoot    = 1.0%
    DisplayMeleeDamage           = THETWINSDAG_DAMAGE

    BountyValue                  = ELVEN_HALDIR_BOUNTY_VALUE
    RecruitText                  = CONTROLBAR:ImladrisZwillingRecruit
    ReviveText                   = CONTROLBAR:ImladrisZwillingRevive
    Hotkey                       = CONTROLBAR:ImladrisZwillingHotkeyNew
    DisplayName                  = OBJECT:ImladrisZwilling2
    CrushableLevel               = 2
    CommandSet                   = BruchtalZwillingeCommandSet_Elrohir
    CommandPoints                = 0
    HeroSortOrder                = 40

    WeaponSet
        Conditions               = None
        Weapon                   = PRIMARY   ZwillingeSword_Elrohir
        AutoChooseSources        = PRIMARY   FROM_PLAYER FROM_SCRIPT FROM_AI
    End

    ArmorSet
        Conditions               = None
        Armor                    = MediumHeroArmor
        DamageFX                 = NormalDamageFX
    End


    AutoResolveUnitType = AutoResolveUnit_Hero
    AutoResolveCombatChain = AutoResolve_HeroCombatChain

    AutoResolveBody = AutoResolve_HaldirBody

    AutoResolveArmor
        Armor = AutoResolve_HaldirArmor
    End

    AutoResolveWeapon
        Weapon = AutoResolve_HaldirWeapon
    End





    VoiceAttack                             = ZwillingeVoiceAttack
    VoiceAttackCharge                       = ZwillingeVoiceAttack
    VoiceAttackMachine                      = ZwillingeVoiceAttack
    VoiceAttackStructure                    = ZwillingeVoiceAttack
    VoiceFear                               = ZwillingeVoiceHelpMe
    VoiceCreated                            = ZwillingeVoiceVoiceSalute
    VoiceFullyCreated                       = ZwillingeVoiceVoiceSalute
    VoiceGuard                              = ZwillingeVoiceMove
    VoiceMove                               = ZwillingeVoiceMove
    VoiceMoveToCamp                         = ZwillingeVoiceMove
    VoiceMoveWhileAttacking                 = ZwillingeVoiceRetreat
    VoicePriority                           = 62
    VoiceRetreatToCastle                    = ZwillingeVoiceRetreat
    VoiceSelect                             = ZwillingeVoiceSelect
    VoiceSelectBattle                       = ZwillingeVoiceSelectinBattle

    SoundImpact                             = ImpactHorse

    UnitSpecificSounds
        VoiceEnterUnitElvenTransportShip    = ZwillingeVoiceMove
        VoiceGarrison                       = ZwillingeVoiceMove
        VoiceInitiateCaptureBuilding        = ZwillingeVoiceMove
    End


    CrowdResponseKey = ElfHero

    #include "..\..\..\includes\StandardUnitEvaEvents.inc"


    Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
        Key    = Humanoid_Male Elf Elf_Male Unit Infantry Hero
    End


    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound:FootstepDirtA                               Animation:Zwilling_SKL.Zwillinge_RUNB    Frames:8 17 26 36
        AnimationSound = Sound:BodyFallGenericNoArmor                      Animation:Zwilling_SKL.Zwillinge_DIEA    Frames:55
        AnimationSound = Sound:BodyFallGenericNoArmor                      Animation:Zwilling_SKL.Zwillinge_DIEB    Frames:70
        AnimationSound = Sound:BodyFallSoldier                             Animation:Zwilling_SKL.Zwillinge_LNDA    Frames:1
    End


    RadarPriority                           = UNIT
    KindOf                                  = HERO PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER ARMY_SUMMARY ATTACK_NEEDS_LINE_OF_SIGHT HEAVY_MELEE_HITTER SCORE
    CamouflageDetectionMultiplier           = CAMOUFLAGE_DETECTION_DISTANCE_MEDIUM
    PathfindDiameter                        = 40.0


    Body = RespawnBody ModuleTag_RespawnBody
        CheerRadius                         = EMOTION_CHEER_RADIUS
        MaxHealth                           = THETWINSDAG_HEALTH
        PermanentlyKilledByFilter           = NONE
        DodgePercent                        = HERO_DODGE_PERCENT
    End

    Behavior = RespawnUpdate ModuleTag_RespawnUpdate
        DeathAnim                    = STUNNED
        DeathAnim                    = DYING
        DeathAnimationTime           = 6500
        RespawnAnim                  = LEVELED
        RespawnAnimationTime         = 2000
        AutoRespawnAtObjectFilter    = NONE +CASTLE_KEEP
        ButtonImage                  = HIZwillingeNeu
        RespawnAsTemplate            = ImladrisZwillingeEdain

        RespawnRules =    AutoSpawn:No        Cost:THETWINSDAG_COST        Time:MEDIUM_HERO_RESPAWNTIME        Health:100%
    End







    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_KriegerEnabler
        SpecialPowerTemplate  = SpecialAbilityAragornBladeMaster
        TriggeredBy           = Upgrade_Level_3
        ObeyRechageOnTrigger  = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_KriegerStarter
        SpecialPowerTemplate  = SpecialAbilityAragornBladeMaster
        StartsPaused          = Yes
    End

    Behavior = HeroModeSpecialAbilityUpdate ModuleTag_KriegerUpdate
        SpecialPowerTemplate  = SpecialAbilityAragornBladeMaster
        HeroAttributeModifier = ZwillingeEdainBladeMaster
        HeroEffectDuration    = 30000
        UnpackTime            = 1
        TriggerSound          = AragornBladeMaster
    End

    Behavior = HitReactionBehavior HitReactionBehaviorModuleTag
        HitReactionLifeTimer1 = 100
        HitReactionLifeTimer2 = 1000
        HitReactionLifeTimer3 = 1993

        HitReactionThreshold1 = 0.0
        HitReactionThreshold2 = 25.0
        HitReactionThreshold3 = 50.0
    End



    Behavior = FireWeaponUpdate FireWeaponUpdateModuleTag
        FireWeaponNugget
            WeaponName = ZwillingeSpawnElladanWeapon
            FireDelay = 0
            OneShot = Yes
        End
    End








    Behavior = AttributeModifierAuraUpdate ModuleTag_KriegsrustungLeadershipUpdate
        StartsActive     = No
        BonusName        = Kriegsrustung
        TriggeredBy      = Upgrade_Level_5
        RefreshDelay     = 2000
        Range            = 1
        AllowSelf        = Yes
        ObjectFilter     = NONE +ImladrisZwillinge_Elrohir
    End

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_KriegsrustungLeadershipUnpause
        SpecialPowerTemplate = SpecialAbilityFakeLeadership
        TriggeredBy = Upgrade_Level_5
    End

    Behavior = SpecialPowerModule ModuleTag_KriegsrustungLeadershipPower
        SpecialPowerTemplate      = SpecialAbilityFakeLeadership
        UpdateModuleStartsAttack  = No
        StartsPaused = Yes
    End

    Behavior = SubObjectsUpgrade ForgedBlades_UpgradeHideALl
        TriggeredBy       = Upgrade_Level_1
        HideSubObjects    = ELLADANGEAR ELROHIR01 ELROHIRGEAR ELLADANSTOFF01 ELLADANSTOFF02 ELLADANMANTEL SWORD01 SWORD02
    End

    Behavior = SubObjectsUpgrade ForgedBlades_Upgrade
        TriggeredBy       = Upgrade_Level_5
        ShowSubObjects    = ELROHIRGEAR
    End








    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_KriegslistEnabler
        SpecialPowerTemplate        = SpecialAbilityNazgulGeisterform
        TriggeredBy                 = Upgrade_Level_7
        ObeyRechageOnTrigger        = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_KriegslistStarter
        SpecialPowerTemplate        = SpecialAbilityNazgulGeisterform
        UpdateModuleStartsAttack    = Yes
        StartsPaused                = Yes
    End

    Behavior = ToggleHiddenSpecialAbilityUpdate ModuleTag_KriegslistUpdate
        SpecialPowerTemplate        = SpecialAbilityNazgulGeisterform
        EffectDuration              = 10000
        ShowPalantirTimer           = Yes
    End

    Behavior = InvisibilityUpdate ModuleTag_StealthForEscape
        InvisibilityNugget
            InvisibilityType        = STEALTH
            ForbiddenConditions     = FIRING_ANY USING_ABILITY
            BecomeStealthedFX       = FX_WormtongueEscapeOn
            ExitStealthFX           = FX_WormtongueEscapeOff
        End
        StartsActive                = No
        UpdatePeriod                = 2000
    End









    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_BlastUnpause
        SpecialPowerTemplate         = SpecialAbilityKlingentanz
        TriggeredBy                  = Upgrade_Level_10
        ObeyRechageOnTrigger         = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_BlastStarter
        SpecialPowerTemplate         = SpecialAbilityKlingentanz
        UpdateModuleStartsAttack     = No
        StartsPaused                 = Yes
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_WizardBlastWeaponFireUpdate
        SpecialPowerTemplate          = SpecialAbilityKlingentanz
        WhichSpecialWeapon            = 1
        SkipContinue                  = Yes
        UnpackTime                    = 2500
        PackTime                      = 1
        FreezeAfterTriggerDuration    = 500
        AwardXPForTriggering          = 0
        StartAbilityRange             = 80.0
        SpecialWeapon                 = ZwillingeKlingentanzWeapon
    End








    Behavior = SpecialPowerModule ModuleTag_TrennenStarter
        SpecialPowerTemplate        = SpecialAbilityGandalfVerfuhrte
        UpdateModuleStartsAttack    = Yes
        StartsPaused                = No
    End

    Behavior = ToggleMountedSpecialAbilityUpdate ModuleTag_Trennen
         SpecialPowerTemplate       = SpecialAbilityGandalfVerfuhrte
         StartAbilityRange          = 50.0
         MountedTemplate            = ImladrisZwillingeEdain
         SynchronizeTimerOnSpecialPower = SpecialAbilityNazgulGeisterform SpecialAbilityKlingentanz SpecialAbilityAragornBladeMaster
         UnpackTime                 = 0
         PreparationTime            = 1

         PackTime                   = 0
         OpacityTarget              = 1
         AwardXPForTriggering       = 0
         IgnoreFacingCheck          = Yes
    End

    Behavior = DoCommandUpgrade Module_DoCommandUpgrade1
        TriggeredBy                 = Upgrade_TestBuilding_2
        GetUpgradeCommandButtonName = Command_SpecialAbilityZwillingeTrennen
    End




    Behavior = PassiveAreaEffectBehavior ModuleTag_FeelGood
        EffectRadius            = 50
        PingDelay               = 100
        ModifierName            = AllowedEllladanButtons
        AllowFilter             = NONE +ImladrisZwillinge_Elladan ALLIES
    End




    Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance                = 200
        TauntAndPointUpdateDelay             = 10000
        PointAt                              = ANY +HERO
        AddEmotion            =    Doom_Base



        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
         AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base


        AddEmotion            =    Alert_Base
        AddEmotion            =    CheerForAboutToCrush_Base
    End

    Behavior = AutoHealBehavior ModuleTag_LegolasHealing
        StartsActive                        = Yes
        HealingAmount                        = HERO_HEAL_AMOUNT
        HealingDelay                        = 1000
        StartHealingDelay                    = HERO_HEAL_DELAY
        HealOnlyIfNotInCombat                = Yes
    End

    Behavior = AutoHealBehavior ModuleTag_ElvenGiftHealing
        StartsActive                = No
        TriggeredBy                    = Upgrade_ElvenGift
        HealingAmount                = ELVEN_GIFT_REGEN_AMOUNT
        HealingDelay                = ELVEN_GIFT_REGEN_DELAY
        StartHealingDelay = HERO_HEAL_DELAY
        HealOnlyIfNotInCombat = Yes
    End

    Behavior = AttributeModifierUpgrade ModuleTag_ElvenGiftBonus
        TriggeredBy = Upgrade_ElvenGift
        AttributeModifier = SpellBookElvenGifts
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate                        = Hero
    End



    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = AIUpdateInterface ModuleTag_03
        AutoAcquireEnemiesWhenIdle             = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate                    = 500
        CanAttackWhileContained                = Yes
        AILuaEventsList                        = DwarvenHeroFunctions
    End


    LocomotorSet
        Locomotor                            = HumanLocomotor
        Condition                            = SET_NORMAL
        Speed                                = NORMAL_ELVEN_FAST_MEMBER_SPEED
    End

    LocomotorSet
        Locomotor                            = HumanWanderLocomotor
        Condition                            = SET_WANDER
        Speed                                = NORMAL_GOOD_FAST_MEMBER_SPEED
    End


    Behavior = PhysicsBehavior ModuleTag_04
        GravityMult                          = 1.0
        ShockStandingTime                    = 2000
    End

    Behavior = SlowDeathBehavior ModuleTag_05
        DeathTypes                          = ALL -FADED
        SinkDelay                           = 3000
        SinkRate                            = 0.5
        DestructionDelay                    = 15000
        Sound                               = INITIAL ZwillingeVoiceDie
        DeathFlags                          = DEATH_1
    End

    Behavior = SlowDeathBehavior ModuleTag_FadeDeath
        DeathTypes                          = NONE +FADED
        FadeDelay                           = 0
        FadeTime                            = 0
        DestructionDelay                    = 0
        DeathFlags                          = DEATH_2

    End



    Behavior = SquishCollide ModuleTag_06
    End







    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End


    Behavior = AISpecialPowerUpdate AragornBladeMasterAI
        CommandButtonName = Command_SpecialAbilityKriegerBruchtals
        SpecialPowerAIType = AI_SPECIAL_POWER_BASIC_SELF_BUFF
    End

    Behavior = AISpecialPowerUpdate GandalfWordOfPowerAI
        CommandButtonName = Command_SpecialAbilityKlingentanzNoldorZwillinge
        SpecialPowerAIType = AI_SPECIAL_POWER_BASIC_SELF_BUFF
        SpecialPowerRadius = 250
    End


    Geometry             = CYLINDER
    GeometryMajorRadius  = 10.0
    GeometryHeight       = 19.0
    GeometryIsSmall      = Yes
    Shadow               = SHADOW_DECAL
    ShadowSizeX          = 19
    ShadowSizeY          = 19
    ShadowTexture        = ShadowI
End

Object ImladrisZwillinge_Elladan

    SelectPortrait        = HPZwillingeElladan
    ButtonImage           = HIZwillingeElladan

    DescriptionStrategic = CONTROLBAR:LW_ToolTip_LeaderHero

    Draw = W3DScriptedModelDraw ModuleTag_DRAW

        DefaultModelConditionState
            Model           = EUZwilling_SKN
            Skeleton        = zwilling_skl
        End

        ModelConditionState = WEAPONSET_HERO_MODE
            ParticleSysBone = BAT_RIBS ExpBonus FollowBone:Yes
        End


        TransitionState                = TRANS_boredToAttention
            Animation            = stha
                AnimationName        = zwilling_stha
                AnimationMode        = ONCE
            End
        End

        TransitionState                = TRANS_attentionToBored
            Animation            = stha
                AnimationName        = zwilling_stha
                AnimationMode        = ONCE_BACKWARDS
            End
            Flags                = START_FRAME_LAST
        End

       IdleAnimationState
            StateName            = STATE_bored
            Animation            = chra
                AnimationName        = zwilling_chra
                AnimationMode        = ONCE
                AnimationPriority    = 1
            End
            Animation            = idla
                AnimationName        = zwilling_idla
                AnimationMode        = ONCE
                AnimationPriority    = 7
            End
            Animation            = idlb
                AnimationName        = zwilling_idlb
                AnimationMode        = ONCE
                AnimationPriority    = 2
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if    Prev == "STATE_attention" or
                    Prev == "STATE_running" or
                    Prev == "OATH_BREAKERS" then CurDrawableSetTransitionAnimState("TRANS_attentionToBored") end
            EndScript
        End


        AnimationState            = THROWN_PROJECTILE
            Animation        = FLYA
                AnimationName    = zwilling_flya
                AnimationMode    = LOOP
            End
        End


        AnimationState            = STUNNED_FLAILING
            Animation        = FLYA
                AnimationName    = zwilling_flya
                AnimationMode    = LOOP
            End
        End

        AnimationState             = DYING SPLATTED DEATH_1
            Animation         = Splatted_On_Ground
                AnimationName    = zwilling_lnda
                AnimationMode    = ONCE
            End
            EnteringStateFX        = FX_SoldierHitGround
        End

        AnimationState                = DYING DEATH_1
            Animation            = diea
                AnimationName        = zwilling_diea
                AnimationMode        = ONCE
            End

        End

        AnimationState                = DYING DEATH_2
            Animation            = ByeBye
                AnimationName        = zwilling_idla
                AnimationMode        = LOOP
            End

        End

        AnimationState                = STUNNED
            Animation            = lnda
                AnimationName        = zwilling_lnda
                AnimationMode        = ONCE
            End
            EnteringStateFX            = FX_SoldierHitGround
        End


        AnimationState                = STUNNED_STANDING_UP
            Animation            = zwilling_gtpa
                AnimationName        = zwilling_gtpa
                AnimationMode        = ONCE
                AnimationSpeedFactorRange = 1.5 1.5
            End
        End

       AnimationState                    = MOVING FIRING_OR_PREATTACK_A
            ShareAnimation            = Yes
            Animation                   = RunAndFire
                AnimationName          = zwilling_atra
                AnimationMode           = LOOP
            End
            Flags                       = RANDOMSTART

        End
        AnimationState                    = MOVING FIRING_OR_PREATTACK_A WEAPONSET_HERO_MODE
            ShareAnimation            = Yes
            Animation                   = RunAndFire
                AnimationName          = zwilling_atra
                AnimationMode           = LOOP
            End
            Flags                       = RANDOMSTART
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if    Prev == "STATE_bored" then CurDrawableSetTransitionAnimState("TRANS_boredToAttention") end
            EndScript
        End

        AnimationState                = FIRING_OR_PREATTACK_A WEAPONSET_HERO_MODE
            StateName            = STATE_attention
            Animation            = ATKD
                AnimationName        = zwilling_atkd
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 5
            End
            Animation            = ATKJ
                AnimationName        = zwilling_atkj
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 2
            End
            Animation            = ATKE
                AnimationName        = zwilling_atke
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 4
            End
            Animation            = ATKD1
                AnimationName        = zwilling_atkd1
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 4
            End
            Animation            = ATKD2
                AnimationName        = zwilling_atkd2
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 3
            End
            Flags                = RESTART_ANIM_WHEN_COMPLETE
            FXEvent    = Frame:25 Name: FX_BladeMasterHitOrient
            FXEvent    = Frame:45 Name: FX_BladeMasterHitOrient
        End

        AnimationState                = FIRING_OR_PREATTACK_A
            StateName            = STATE_attention
            Animation            = ATKD
                AnimationName        = zwilling_atkd
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 5
            End
            Animation            = ATKJ
                AnimationName        = zwilling_atkj
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 2
            End
            Animation            = ATKE
                AnimationName        = zwilling_atke
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 4
            End
            Animation            = ATKD1
                AnimationName        = zwilling_atkd1
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 3
            End
            Animation            = ATKD2
                AnimationName        = zwilling_atkd2
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 3
            End
            Flags                = RESTART_ANIM_WHEN_COMPLETE
        End

        AnimationState                = FIRING_OR_PREATTACK_C
            StateName            = STATE_attention
            Animation            = ATKD
                AnimationName        = zwilling_atkd
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 5
            End
            Animation            = ATKJ
                AnimationName        = zwilling_atkj
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 2
            End
            Animation            = ATKE
                AnimationName        = zwilling_atke
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 4
            End
            Animation            = ATKD1
                AnimationName        = zwilling_atkd1
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 3
            End
            Animation            = ATKD2
                AnimationName        = zwilling_atkd2
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 3
            End
        End

        AnimationState          =  SPECIAL_WEAPON_ONE
            Animation           = ATKK
                AnimationName   = zwilling_atkk
                AnimationMode   = ONCE
                UseWeaponTiming = Yes
            End
        End

        AnimationState                = MOVING
            StateName            = STATE_running
            Animation            = zwilling_runb
                AnimationName        = zwilling_runb
                AnimationMode        = LOOP
            End
        End

       AnimationState                = LEVELED
            Animation            = LevelUp
                AnimationName        = zwilling_chra
                AnimationMode        = ONCE
            End
        End

        AnimationState                = USER_2
            StateName            = ATHELAS
            Animation            = ATKP
                AnimationName        = zwilling_chra
                AnimationMode        = ONCE
            End
        End

        AnimationState                = USER_1
            StateName            = OATH_BREAKERS
            Animation            = ATKN
                AnimationName        = zwilling_chrb
                AnimationMode        = ONCE
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if    Prev == "STATE_attention" then CurDrawableSetTransitionAnimState("TRANS_attentionToBored") end
            EndScript
        End

        AnimationState                = SPECIAL_WEAPON_TWO
            StateName            = STATE_ready
            Animation            = chrb
                AnimationName        = zwilling_chrb
                AnimationMode        = ONCE
            End
        End

        AnimationState                = RAISING_FLAG
            StateName                = STATE_ready
            Animation                = chra
                AnimationName        = zwilling_chra
                AnimationMode        = LOOP
            End
        End

        AnimationState                = EMOTION_CELEBRATING
            StateName            = STATE_ready
            Animation            = chrb
                AnimationName        = zwilling_chrb
                AnimationMode        = ONCE
                AnimationPriority    = 1
            End
            Flags                = RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if    Prev == "STATE_attention" then CurDrawableSetTransitionAnimState("TRANS_attentionToBored") end
            EndScript
        End

        AnimationState                = EMOTION_ALERT
            StateName            = STATE_ready
            Animation            = idlj
                AnimationName        = zwilling_idlj
                AnimationMode        = ONCE
                AnimationPriority    = 1
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if    Prev == "STATE_attention" then CurDrawableSetTransitionAnimState("TRANS_attentionToBored") end
            EndScript
        End

        AnimationState                = ENGAGED
            StateName            = STATE_ready
            Animation            = idlj
                AnimationName        = zwilling_idlj
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 1
            End
            Flags                = RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if    Prev == "STATE_attention" then CurDrawableSetTransitionAnimState("TRANS_attentionToBored") end
            EndScript
        End

        AnimationState                 = SELECTED
             StateName             = STATE_attention
                Animation             = idlj
                     AnimationName         = zwilling_idlj
                      AnimationMode         = LOOP
                AnimationBlendTime    = 5
                AnimationMustCompleteBlend = Yes
             End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if    Prev == "STATE_bored" or
                    Prev == "STATE_ready" then CurDrawableSetTransitionAnimState("TRANS_boredToAttention") end
            EndScript
         End

    End


    Draw = W3DScriptedModelDraw Icon
        ModelConditionState = NONE
            Model           = bbox
        End
    End

    #include "..\..\..\includes\StunDrawModuleSmall.inc"


    Side                         = Imladris
    EditorSorting                = UNIT
    ThreatLevel                  = HALDIR_THREAT_LEVEL
    ThingClass                   = CHARACTER_UNIT
    BuildCost                    = THETWINSDAG_COST
    BuildTime                    = MEDIUM_HERO_BUILDTIME

    TransportSlotCount           = TRANSPORTSLOTCOUNT_HERO
    VisionRange                  = VISION_HERO_STANDARD
    ShroudClearingRange          = SHROUD_CLEAR_HERO
    MaxVisionBonusPercent        = 300%
    VisionBonusTestRadius        = 200
    VisionBonusPercentPerFoot    = 1.0%
    DisplayMeleeDamage           = THETWINSDAG_DAMAGE
    MaxSimultaneousOfType        = 1

    BountyValue                  = ELVEN_HALDIR_BOUNTY_VALUE
    RecruitText                  = CONTROLBAR:ImladrisZwillingRecruit
    ReviveText                   = CONTROLBAR:ImladrisZwillingRevive
    Hotkey                       = CONTROLBAR:ImladrisZwillingHotkeyNew
    DisplayName                  = OBJECT:ImladrisZwilling1
    CrushableLevel               = 2
    CommandSet                   = BruchtalZwillingeCommandSet_Elladan
    CommandPoints                = 0
    HeroSortOrder                = 40

    WeaponSet
        Conditions               = None
        Weapon                   = PRIMARY   ZwillingeSword_Elladan
        AutoChooseSources        = PRIMARY   FROM_PLAYER FROM_SCRIPT FROM_AI
    End

    ArmorSet
        Conditions               = None
        Armor                    = MediumHeroArmor
        DamageFX                 = NormalDamageFX
    End





    VoiceAttack                             = ZwillingeVoiceAttack
    VoiceAttackCharge                       = ZwillingeVoiceAttack
    VoiceAttackMachine                      = ZwillingeVoiceAttack
    VoiceAttackStructure                    = ZwillingeVoiceAttack
    VoiceFear                               = ZwillingeVoiceHelpMe
    VoiceCreated                            = ZwillingeVoiceVoiceSalute
    VoiceFullyCreated                       = ZwillingeVoiceVoiceSalute
    VoiceGuard                              = ZwillingeVoiceMove
    VoiceMove                               = ZwillingeVoiceMove
    VoiceMoveToCamp                         = ZwillingeVoiceMove
    VoiceMoveWhileAttacking                 = ZwillingeVoiceRetreat
    VoicePriority                           = 62
    VoiceRetreatToCastle                    = ZwillingeVoiceRetreat
    VoiceSelect                             = ZwillingeVoiceSelect
    VoiceSelectBattle                       = ZwillingeVoiceSelectinBattle

    SoundImpact                             = ImpactHorse

    UnitSpecificSounds
        VoiceEnterUnitElvenTransportShip    = ZwillingeVoiceMove
        VoiceGarrison                       = ZwillingeVoiceMove
        VoiceInitiateCaptureBuilding        = ZwillingeVoiceMove
    End

    CrowdResponseKey = ElfHero

    #include "..\..\..\includes\StandardUnitEvaEvents.inc"


    Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
        Key    = Humanoid_Male Elf Elf_Male Unit Infantry Hero
    End


    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800


        AnimationSound = Sound:FootstepDirtA                               Animation:Zwilling_SKL.Zwillinge_RUNB    Frames:8 17 26 36
        AnimationSound = Sound:BodyFallGenericNoArmor                      Animation:Zwilling_SKL.Zwillinge_DIEA    Frames:55
        AnimationSound = Sound:BodyFallGenericNoArmor                      Animation:Zwilling_SKL.Zwillinge_DIEB    Frames:70
        AnimationSound = Sound:BodyFallSoldier                             Animation:Zwilling_SKL.Zwillinge_LNDA    Frames:1
    End





    RadarPriority                           = UNIT
    KindOf                                  = PASS_EXPERIENCE_TO_PRODUCER HERO PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE ARMY_SUMMARY ATTACK_NEEDS_LINE_OF_SIGHT HEAVY_MELEE_HITTER
    CamouflageDetectionMultiplier           = CAMOUFLAGE_DETECTION_DISTANCE_MEDIUM
    PathfindDiameter                        = 40.0


    Body = ActiveBody ModuleTag_RespawnBody
        CheerRadius                         = EMOTION_CHEER_RADIUS
        MaxHealth                           = THETWINSDAG_HEALTH
        DodgePercent                        = HERO_DODGE_PERCENT
    End


    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_KriegerEnabler
        SpecialPowerTemplate  = SpecialAbilityAragornBladeMaster
        TriggeredBy           = Upgrade_Level_3
        ObeyRechageOnTrigger  = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_KriegerStarter
        SpecialPowerTemplate  = SpecialAbilityAragornBladeMaster
        StartsPaused          = Yes
    End

    Behavior = HeroModeSpecialAbilityUpdate ModuleTag_KriegerUpdate
        SpecialPowerTemplate  = SpecialAbilityAragornBladeMaster
        HeroAttributeModifier = ZwillingeEdainBladeMaster
        HeroEffectDuration    = 30000
        UnpackTime            = 1
        TriggerSound          = AragornBladeMaster
    End

    Behavior = HitReactionBehavior HitReactionBehaviorModuleTag
        HitReactionLifeTimer1 = 100
        HitReactionLifeTimer2 = 1000
        HitReactionLifeTimer3 = 1993

        HitReactionThreshold1 = 0.0
        HitReactionThreshold2 = 25.0
        HitReactionThreshold3 = 50.0
    End







    Behavior = AttributeModifierAuraUpdate ModuleTag_KriegsrustungLeadershipUpdate
        StartsActive     = No
        BonusName        = Kriegsrustung
        TriggeredBy      = Upgrade_Level_5
        RefreshDelay     = 2000
        Range            = 1
        AllowSelf        = Yes

        ObjectFilter     = NONE +ImladrisZwillinge_Elladan
    End

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_KriegsrustungLeadershipUnpause
        SpecialPowerTemplate = SpecialAbilityFakeLeadership
        TriggeredBy = Upgrade_Level_5
    End

    Behavior = SpecialPowerModule ModuleTag_KriegsrustungLeadershipPower
        SpecialPowerTemplate      = SpecialAbilityFakeLeadership
        UpdateModuleStartsAttack  = No
        StartsPaused = Yes
    End

    Behavior = SubObjectsUpgrade ForgedBlades_UpgradeHideALl
        TriggeredBy       = Upgrade_Level_1
        HideSubObjects    = ELLADANGEAR ELROHIR ELROHIRGEAR ELROHIRSSTOFF01 ELROHIRSSTOFF02 ELROHIRMANTEL ELROHIRSWORD01 ELROHIRSWORD02
    End

    Behavior = SubObjectsUpgrade ForgedBlades_Upgrade
        TriggeredBy       = Upgrade_Level_5
        ShowSubObjects    = ELLADANGEAR
    End


    Behavior = PassiveAreaEffectBehavior ModuleTag_FeelGood
        EffectRadius            = 50
        PingDelay               = 100
        ModifierName            = AllowedEllladanButtons
        AllowFilter             = NONE +ImladrisZwillinge_Elrohir ALLIES
    End

    Behavior = PassiveAreaEffectBehavior ModuleTag_FeelGood2
        EffectRadius            = 1000000
        PingDelay               = 2000
        ModifierName            = AllowedGartenButtons
        AllowFilter             = ANY +Elrondshaus ALLIES
    End




    Behavior = SpecialPowerModule ModuleTag_TheodenGloriousChargeUpdate
        SpecialPowerTemplate      = SpecialAbilityHeulenRudelfuhrer
        UpdateModuleStartsAttack  = Yes
        StartsPaused              = No
        AttributeModifier         = ElrohirButtonKlickModifier
        AttributeModifierRange    = 100000
        AttributeModifierAffectsSelf = No
        AttributeModifierAffects  = ANY +ImladrisZwillinge_Elrohir ALLIES
    End

    Behavior = SpecialAbilityUpdate ModuleTag_GloriousChargeAnimation
        UnpackTime                = 0
        UnpackingVariation        = 1
        SpecialPowerTemplate      = SpecialAbilityHeulenRudelfuhrer
        PreparationTime           = 0
        PersistentPrepTime        = 0
        PackTime                  = 0
    End









    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_BlastUnpause
        SpecialPowerTemplate         = SpecialAbilityKlingentanz
        TriggeredBy                  = Upgrade_Level_10
        ObeyRechageOnTrigger         = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_BlastStarter
        SpecialPowerTemplate         = SpecialAbilityKlingentanz
        UpdateModuleStartsAttack     = No
        StartsPaused                 = Yes
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_WizardBlastWeaponFireUpdate
        SpecialPowerTemplate          = SpecialAbilityKlingentanz
        WhichSpecialWeapon            = 1
        SkipContinue                  = Yes
        UnpackTime                    = 2500
        PackTime                      = 1
        FreezeAfterTriggerDuration    = 500
        AwardXPForTriggering          = 0
        StartAbilityRange             = 80.0
        SpecialWeapon                 = ZwillingeKlingentanzWeapon
    End




    Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance                = 200
        TauntAndPointUpdateDelay             = 10000
        PointAt                              = ANY +HERO
        AddEmotion            =    Doom_Base



        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
         AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base


        AddEmotion            =    Alert_Base
        AddEmotion            =    CheerForAboutToCrush_Base
    End

    Behavior = AutoHealBehavior ModuleTag_LegolasHealing
        StartsActive                        = Yes
        HealingAmount                        = HERO_HEAL_AMOUNT
        HealingDelay                        = 1000
        StartHealingDelay                    = HERO_HEAL_DELAY
        HealOnlyIfNotInCombat                = Yes
    End

    Behavior = AutoHealBehavior ModuleTag_ElvenGiftHealing
        StartsActive                = No
        TriggeredBy                    = Upgrade_ElvenGift
        HealingAmount                = ELVEN_GIFT_REGEN_AMOUNT
        HealingDelay                = ELVEN_GIFT_REGEN_DELAY
        StartHealingDelay = HERO_HEAL_DELAY
        HealOnlyIfNotInCombat = Yes
    End

    Behavior = AttributeModifierUpgrade ModuleTag_ElvenGiftBonus
        TriggeredBy = Upgrade_ElvenGift
        AttributeModifier = SpellBookElvenGifts
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate                        = Hero
    End



    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = AIUpdateInterface ModuleTag_03
        AutoAcquireEnemiesWhenIdle             = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate                    = 500
        CanAttackWhileContained                = Yes
    End


    LocomotorSet
        Locomotor                            = HumanLocomotor
        Condition                            = SET_NORMAL
        Speed                                = NORMAL_ELVEN_FAST_MEMBER_SPEED
    End

    LocomotorSet
        Locomotor                            = HumanWanderLocomotor
        Condition                            = SET_WANDER
        Speed                                = NORMAL_GOOD_FAST_MEMBER_SPEED
    End


    Behavior = PhysicsBehavior ModuleTag_04
        GravityMult                          = 1.0
        ShockStandingTime                    = 2000
    End

    Behavior = SlowDeathBehavior ModuleTag_05
        DeathTypes                          = ALL -FADED
        SinkDelay                           = 3000
        SinkRate                            = 0.5
        DestructionDelay                    = 15000
        Sound                               = INITIAL ZwillingeVoiceDie
        DeathFlags                          = DEATH_1
    End

    Behavior = SlowDeathBehavior ModuleTag_FadeDeath
        DeathTypes                          = NONE +FADED
        FadeDelay                           = 0
        FadeTime                            = 0
        DestructionDelay                    = 0
        DeathFlags                          = DEATH_2
    End


    Behavior = SquishCollide ModuleTag_06
    End







    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End


    Behavior = AISpecialPowerUpdate AragornBladeMasterAI
        CommandButtonName = Command_SpecialAbilityKriegerBruchtals
        SpecialPowerAIType = AI_SPECIAL_POWER_BASIC_SELF_BUFF
    End

    Behavior = AISpecialPowerUpdate GandalfWordOfPowerAI
        CommandButtonName = Command_SpecialAbilityKlingentanzNoldorZwillinge
        SpecialPowerAIType = AI_SPECIAL_POWER_BASIC_SELF_BUFF
        SpecialPowerRadius = 250
    End


    Geometry             = CYLINDER
    GeometryMajorRadius  = 10.0
    GeometryHeight       = 19.0
    GeometryIsSmall      = Yes
    Shadow               = SHADOW_DECAL
    ShadowSizeX          = 19
    ShadowSizeY          = 19
    ShadowTexture        = ShadowI
END

ChildObject ImladrisZwillinge_Elladan2 ImladrisZwillinge_Elladan

    EquivalentTo = ImladrisZwillinge_Elladan

    MaxSimultaneousOfType = 1

    Behavior                 = ExperienceLevelCreate ModuleTag_MPLevelBonus
        LevelToGrant          = 2
        MPOnly                = Yes
    End
    Behavior = SpecialPowerModule ModuleTag_TheodenGloriousChargeUpdate
        SpecialPowerTemplate      = SpecialAbilityHeulenRudelfuhrer
        UpdateModuleStartsAttack  = Yes
        StartsPaused              = No
        AttributeModifier         = ElrohirButtonKlickModifier
        AttributeModifierRange    = 100000
        AttributeModifierAffectsSelf = No
        AttributeModifierAffects  = ANY +ImladrisZwillinge_Elrohir ALLIES
    End

    Behavior = SpecialAbilityUpdate ModuleTag_GloriousChargeAnimation
        UnpackTime                = 0
        UnpackingVariation        = 1
        SpecialPowerTemplate      = SpecialAbilityHeulenRudelfuhrer
        PreparationTime           = 0
        PersistentPrepTime        = 0
        PackTime                  = 0
    End
End

ChildObject ImladrisZwillinge_Elladan3 ImladrisZwillinge_Elladan

    EquivalentTo = ImladrisZwillinge_Elladan

    MaxSimultaneousOfType = 1

    Behavior                 = ExperienceLevelCreate ModuleTag_MPLevelBonus
        LevelToGrant          = 3
        MPOnly                = Yes
    End
    Behavior = SpecialPowerModule ModuleTag_TheodenGloriousChargeUpdate
        SpecialPowerTemplate      = SpecialAbilityHeulenRudelfuhrer
        UpdateModuleStartsAttack  = Yes
        StartsPaused              = No
        AttributeModifier         = ElrohirButtonKlickModifier
        AttributeModifierRange    = 100000
        AttributeModifierAffectsSelf = No
        AttributeModifierAffects  = ANY +ImladrisZwillinge_Elrohir ALLIES
    End

    Behavior = SpecialAbilityUpdate ModuleTag_GloriousChargeAnimation
        UnpackTime                = 0
        UnpackingVariation        = 1
        SpecialPowerTemplate      = SpecialAbilityHeulenRudelfuhrer
        PreparationTime           = 0
        PersistentPrepTime        = 0
        PackTime                  = 0
    End
End

ChildObject ImladrisZwillinge_Elladan4 ImladrisZwillinge_Elladan

    EquivalentTo = ImladrisZwillinge_Elladan

    MaxSimultaneousOfType = 1

    Behavior                 = ExperienceLevelCreate ModuleTag_MPLevelBonus
        LevelToGrant          = 4
        MPOnly                = Yes
    End
    Behavior = SpecialPowerModule ModuleTag_TheodenGloriousChargeUpdate
        SpecialPowerTemplate      = SpecialAbilityHeulenRudelfuhrer
        UpdateModuleStartsAttack  = Yes
        StartsPaused              = No
        AttributeModifier         = ElrohirButtonKlickModifier
        AttributeModifierRange    = 100000
        AttributeModifierAffectsSelf = No
        AttributeModifierAffects  = ANY +ImladrisZwillinge_Elrohir ALLIES
    End

    Behavior = SpecialAbilityUpdate ModuleTag_GloriousChargeAnimation
        UnpackTime                = 0
        UnpackingVariation        = 1
        SpecialPowerTemplate      = SpecialAbilityHeulenRudelfuhrer
        PreparationTime           = 0
        PersistentPrepTime        = 0
        PackTime                  = 0
    End
End

ChildObject ImladrisZwillinge_Elladan5 ImladrisZwillinge_Elladan

    EquivalentTo = ImladrisZwillinge_Elladan

    MaxSimultaneousOfType = 1

    Behavior                 = ExperienceLevelCreate ModuleTag_MPLevelBonus
        LevelToGrant          = 5
        MPOnly                = Yes
    End
    Behavior = SpecialPowerModule ModuleTag_TheodenGloriousChargeUpdate
        SpecialPowerTemplate      = SpecialAbilityHeulenRudelfuhrer
        UpdateModuleStartsAttack  = Yes
        StartsPaused              = No
        AttributeModifier         = ElrohirButtonKlickModifier
        AttributeModifierRange    = 100000
        AttributeModifierAffectsSelf = No
        AttributeModifierAffects  = ANY +ImladrisZwillinge_Elrohir ALLIES
    End

    Behavior = SpecialAbilityUpdate ModuleTag_GloriousChargeAnimation
        UnpackTime                = 0
        UnpackingVariation        = 1
        SpecialPowerTemplate      = SpecialAbilityHeulenRudelfuhrer
        PreparationTime           = 0
        PersistentPrepTime        = 0
        PackTime                  = 0
    End
End

ChildObject ImladrisZwillinge_Elladan6 ImladrisZwillinge_Elladan

    EquivalentTo = ImladrisZwillinge_Elladan

    MaxSimultaneousOfType = 1

    Behavior                 = ExperienceLevelCreate ModuleTag_MPLevelBonus
        LevelToGrant          = 6
        MPOnly                = Yes
    End
    Behavior = SpecialPowerModule ModuleTag_TheodenGloriousChargeUpdate
        SpecialPowerTemplate      = SpecialAbilityHeulenRudelfuhrer
        UpdateModuleStartsAttack  = Yes
        StartsPaused              = No
        AttributeModifier         = ElrohirButtonKlickModifier
        AttributeModifierRange    = 100000
        AttributeModifierAffectsSelf = No
        AttributeModifierAffects  = ANY +ImladrisZwillinge_Elrohir ALLIES
    End

    Behavior = SpecialAbilityUpdate ModuleTag_GloriousChargeAnimation
        UnpackTime                = 0
        UnpackingVariation        = 1
        SpecialPowerTemplate      = SpecialAbilityHeulenRudelfuhrer
        PreparationTime           = 0
        PersistentPrepTime        = 0
        PackTime                  = 0
    End
End

ChildObject ImladrisZwillinge_Elladan7 ImladrisZwillinge_Elladan

    EquivalentTo = ImladrisZwillinge_Elladan

    MaxSimultaneousOfType = 1

    Behavior                 = ExperienceLevelCreate ModuleTag_MPLevelBonus
        LevelToGrant          = 7
        MPOnly                = Yes
    End
    Behavior = SpecialPowerModule ModuleTag_TheodenGloriousChargeUpdate
        SpecialPowerTemplate      = SpecialAbilityHeulenRudelfuhrer
        UpdateModuleStartsAttack  = Yes
        StartsPaused              = No
        AttributeModifier         = ElrohirButtonKlickModifier
        AttributeModifierRange    = 100000
        AttributeModifierAffectsSelf = No
        AttributeModifierAffects  = ANY +ImladrisZwillinge_Elrohir ALLIES
    End

    Behavior = SpecialAbilityUpdate ModuleTag_GloriousChargeAnimation
        UnpackTime                = 0
        UnpackingVariation        = 1
        SpecialPowerTemplate      = SpecialAbilityHeulenRudelfuhrer
        PreparationTime           = 0
        PersistentPrepTime        = 0
        PackTime                  = 0
    End
End

ChildObject ImladrisZwillinge_Elladan8 ImladrisZwillinge_Elladan

    EquivalentTo = ImladrisZwillinge_Elladan

    MaxSimultaneousOfType = 1

    Behavior                 = ExperienceLevelCreate ModuleTag_MPLevelBonus
        LevelToGrant          = 8
        MPOnly                = Yes
    End
    Behavior = SpecialPowerModule ModuleTag_TheodenGloriousChargeUpdate
        SpecialPowerTemplate      = SpecialAbilityHeulenRudelfuhrer
        UpdateModuleStartsAttack  = Yes
        StartsPaused              = No
        AttributeModifier         = ElrohirButtonKlickModifier
        AttributeModifierRange    = 100000
        AttributeModifierAffectsSelf = No
        AttributeModifierAffects  = ANY +ImladrisZwillinge_Elrohir ALLIES
    End

    Behavior = SpecialAbilityUpdate ModuleTag_GloriousChargeAnimation
        UnpackTime                = 0
        UnpackingVariation        = 1
        SpecialPowerTemplate      = SpecialAbilityHeulenRudelfuhrer
        PreparationTime           = 0
        PersistentPrepTime        = 0
        PackTime                  = 0
    End
End

ChildObject ImladrisZwillinge_Elladan9 ImladrisZwillinge_Elladan

    EquivalentTo = ImladrisZwillinge_Elladan

    MaxSimultaneousOfType = 1

    Behavior                 = ExperienceLevelCreate ModuleTag_MPLevelBonus
        LevelToGrant          = 9
        MPOnly                = Yes
    End
    Behavior = SpecialPowerModule ModuleTag_TheodenGloriousChargeUpdate
        SpecialPowerTemplate      = SpecialAbilityHeulenRudelfuhrer
        UpdateModuleStartsAttack  = Yes
        StartsPaused              = No
        AttributeModifier         = ElrohirButtonKlickModifier
        AttributeModifierRange    = 100000
        AttributeModifierAffectsSelf = No
        AttributeModifierAffects  = ANY +ImladrisZwillinge_Elrohir ALLIES
    End

    Behavior = SpecialAbilityUpdate ModuleTag_GloriousChargeAnimation
        UnpackTime                = 0
        UnpackingVariation        = 1
        SpecialPowerTemplate      = SpecialAbilityHeulenRudelfuhrer
        PreparationTime           = 0
        PersistentPrepTime        = 0
        PackTime                  = 0
    End
End

ChildObject ImladrisZwillinge_Elladan10 ImladrisZwillinge_Elladan

    EquivalentTo = ImladrisZwillinge_Elladan

    MaxSimultaneousOfType = 1

    Behavior                 = ExperienceLevelCreate ModuleTag_MPLevelBonus
        LevelToGrant          = 10
        MPOnly                = Yes
    End
    Behavior = SpecialPowerModule ModuleTag_TheodenGloriousChargeUpdate
        SpecialPowerTemplate      = SpecialAbilityHeulenRudelfuhrer
        UpdateModuleStartsAttack  = Yes
        StartsPaused              = No
        AttributeModifier         = ElrohirButtonKlickModifier
        AttributeModifierRange    = 100000
        AttributeModifierAffectsSelf = No
        AttributeModifierAffects  = ANY +ImladrisZwillinge_Elrohir ALLIES
    End

    Behavior = SpecialAbilityUpdate ModuleTag_GloriousChargeAnimation
        UnpackTime                = 0
        UnpackingVariation        = 1
        SpecialPowerTemplate      = SpecialAbilityHeulenRudelfuhrer
        PreparationTime           = 0
        PersistentPrepTime        = 0
        PackTime                  = 0
    End
End


Object ImladrisZwillingeEdain_Schmiede

    DescriptionStrategic = CONTROLBAR:LW_ToolTip_LeaderHero

    Draw = W3DScriptedModelDraw ModuleTag_DRAW
        DefaultModelConditionState
            Model           = None
        End
    End

    #include "..\..\..\includes\StunDrawModuleSmall.inc"


    Side                         = Imladris
    EditorSorting                = UNIT
    ThreatLevel                  = HALDIR_THREAT_LEVEL
    ThingClass                   = CHARACTER_UNIT
    TransportSlotCount           = TRANSPORTSLOTCOUNT_HERO
    VisionRange                  = 80
    ShroudClearingRange          = 80
    MaxVisionBonusPercent        = 300%
    VisionBonusTestRadius        = 100
    VisionBonusPercentPerFoot    = 1.0%
    DisplayMeleeDamage           = THETWINSDAG_DAMAGE
    ShowHealthInSelectionDecal   = No

    BountyValue                  = ELVEN_HALDIR_BOUNTY_VALUE
    RecruitText                  = CONTROLBAR:ImladrisZwillingRecruit
    ReviveText                   = CONTROLBAR:ImladrisZwillingRevive
    Hotkey                       = CONTROLBAR:ImladrisZwillingHotkeyNew
    DisplayName                  = OBJECT:ImladrisZwillingNewModeNew
    CrushableLevel               = 4
    CommandSet                   =  BruchtalZwillingeCommandSet_Schmiede
    CommandPoints                = 0
    HeroSortOrder                = 40

    ArmorSet
        Conditions               = None
        Armor                    = MediumHeroArmor
        DamageFX                 = NormalDamageFX
    End


    AutoResolveUnitType = AutoResolveUnit_Hero
    AutoResolveCombatChain = AutoResolve_HeroCombatChain

    AutoResolveBody = AutoResolve_HaldirBody

    AutoResolveArmor
        Armor = AutoResolve_HaldirArmor
    End

    AutoResolveWeapon
        Weapon = AutoResolve_HaldirWeapon
    End



    CrowdResponseKey = ElfHero

    #include "..\..\..\includes\StandardUnitEvaEvents.inc"


    Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
        Key    = Humanoid_Male Elf Elf_Male Unit Infantry Hero
    End






    KindOf = IGNORE_FOR_VICTORY HERO PRELOAD CAN_CAST_REFLECTIONS INFANTRY ATTACK_NEEDS_LINE_OF_SIGHT PATH_THROUGH_EACH_OTHER SCORE ARMY_SUMMARY HEAVY_MELEE_HITTER



    Behavior = AttributeModifierAuraUpdate ModuleTag_Leadership
        StartsActive        = Yes
        BonusName           = ZwillingeUnvwerwundbar
        RefreshDelay        = 2000
        Range               = 1
        ObjectFilter        = ANY +ImladrisZwillingeEdain_Schmiede ALLIES
        AllowSelf           = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_SwitchStarter
         SpecialPowerTemplate           = SpecialAbilityToggleMountedWitchkingonHorse
         UpdateModuleStartsAttack       = Yes
         StartsPaused                   = No
    End

    Behavior = ToggleMountedSpecialAbilityUpdate ModuleTag_Switch
         SpecialPowerTemplate           = SpecialAbilityToggleMountedWitchkingonHorse
         MountedTemplate                = ImladrisZwillingeEdain
         SynchronizeTimerOnSpecialPower = SpecialAbilityNazgulGeisterform SpecialAbilityKlingentanz SpecialAbilityAragornBladeMaster
         UnpackTime                     = OBJECT_TOGGLE_TIME
         PreparationTime                = 0
         PackTime                       = 0
         OpacityTarget                  = .0
         AwardXPForTriggering           = 0
         IgnoreFacingCheck              = Yes
    End


    Behavior = FireWeaponUpdate ModuleTag_Weapon
        FireWeaponNugget
            WeaponName = WeaponEregionForgeModelCondition
            FireDelay = 0
            OneShot = No
        End
    End

    Behavior = AIUpdateInterface ModuleTag_03
        AutoAcquireEnemiesWhenIdle             = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate                    = 500
        CanAttackWhileContained                = Yes
        AILuaEventsList                        = ZwillingeFunctions
    End


    Behavior = DoCommandUpgrade Module_DoCommandUpgrade
        TriggeredBy                     = Upgrade_TestBuilding_2
        GetUpgradeCommandButtonName     = Command_ToggleZwillinge
    End

    Body = RespawnBody ModuleTag_RespawnBody
        CheerRadius                         = EMOTION_CHEER_RADIUS
        MaxHealth                           = THETWINSDAG_HEALTH
        PermanentlyKilledByFilter           = NONE
        DodgePercent                        = HERO_DODGE_PERCENT
    End

    Behavior = RespawnUpdate ModuleTag_RespawnUpdate
        DeathAnim                    = STUNNED
        DeathAnim                    = DYING
        DeathAnimationTime            = 6500
        RespawnAnim                    = LEVELED
        RespawnAnimationTime         = 2000
        AutoRespawnAtObjectFilter    = NONE +CASTLE_KEEP
        ButtonImage                  = HIZwillingeNeu
        RespawnAsTemplate             = ImladrisZwillingeEdain

        RespawnRules =    AutoSpawn:No        Cost:THETWINSDAG_COST        Time:MEDIUM_HERO_RESPAWNTIME        Health:100%
    End



    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_KriegerEnabler
        SpecialPowerTemplate  = SpecialAbilityAragornBladeMaster
        TriggeredBy           = Upgrade_Level_3
        ObeyRechageOnTrigger = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_KriegerStarter
        SpecialPowerTemplate  = SpecialAbilityAragornBladeMaster
        StartsPaused          = No
        StartsPaused          = Yes
    End

    Behavior = HeroModeSpecialAbilityUpdate ModuleTag_KriegerUpdate
        SpecialPowerTemplate  = SpecialAbilityAragornBladeMaster
        HeroAttributeModifier = ZwillingeEdainBladeMaster
        HeroEffectDuration    = 30000
        UnpackTime            = 1
        TriggerSound          = AragornBladeMaster
    End

    Behavior = HitReactionBehavior HitReactionBehaviorModuleTag
        HitReactionLifeTimer1 = 100
        HitReactionLifeTimer2 = 1000
        HitReactionLifeTimer3 = 1993

        HitReactionThreshold1 = 0.0
        HitReactionThreshold2 = 25.0
        HitReactionThreshold3 = 50.0
    End







    Behavior = AttributeModifierAuraUpdate ModuleTag_KriegsrustungLeadershipUpdate
        StartsActive     = No
        BonusName        = Kriegsrustung
        TriggeredBy      = Upgrade_Level_5
        RefreshDelay     = 2000
        Range            = 1
        AllowSelf        = Yes

        ObjectFilter     = NONE +ImladrisZwillingeEdain
    End

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_KriegsrustungLeadershipUnpause
        SpecialPowerTemplate = SpecialAbilityFakeLeadership
        TriggeredBy = Upgrade_Level_5
    End

    Behavior = SpecialPowerModule ModuleTag_KriegsrustungLeadershipPower
        SpecialPowerTemplate      = SpecialAbilityFakeLeadership
        UpdateModuleStartsAttack  = No
        StartsPaused = Yes
    End

    Behavior = SubObjectsUpgrade ModuleTag_Skinwelchsel
        TriggeredBy = Upgrade_Level_5
        UpgradeTexture = guelladan.tga 0 guelladan_ha.tga
        UpgradeTexture = guelrohir.tga 0 guelrohir_ha.tga
    End







    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_KriegslistEnabler
        SpecialPowerTemplate        = SpecialAbilityNazgulGeisterform
        TriggeredBy                 = Upgrade_Level_7
        ObeyRechageOnTrigger        = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_KriegslistStarter
        SpecialPowerTemplate        = SpecialAbilityNazgulGeisterform
        UpdateModuleStartsAttack    = Yes
        StartsPaused                = Yes
    End

    Behavior = ToggleHiddenSpecialAbilityUpdate ModuleTag_KriegslistUpdate
        SpecialPowerTemplate        = SpecialAbilityNazgulGeisterform
        EffectDuration              = 10000
        ShowPalantirTimer           = Yes
    End

    Behavior = InvisibilityUpdate ModuleTag_StealthForEscape
        InvisibilityNugget
            InvisibilityType        = STEALTH
            ForbiddenConditions     = FIRING_ANY USING_ABILITY
            BecomeStealthedFX       = FX_WormtongueEscapeOn
            ExitStealthFX           = FX_WormtongueEscapeOff
        End
        StartsActive                = No
        UpdatePeriod                = 2000
    End










    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_BlastUnpause
        SpecialPowerTemplate         = SpecialAbilityKlingentanz
        TriggeredBy                  = Upgrade_Level_10
        ObeyRechageOnTrigger         = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_BlastStarter
        SpecialPowerTemplate         = SpecialAbilityKlingentanz
        UpdateModuleStartsAttack     = No
        StartsPaused                 = Yes
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_WizardBlastWeaponFireUpdate
        SpecialPowerTemplate          = SpecialAbilityKlingentanz
        WhichSpecialWeapon            = 1
        SkipContinue                  = Yes
        UnpackTime                    = 2500
        PackTime                      = 1
        FreezeAfterTriggerDuration    = 500
        AwardXPForTriggering          = 0
        StartAbilityRange             = 80.0
        SpecialWeapon                 = ZwillingeKlingentanzWeapon
    End

    LocomotorSet
        Locomotor                            = HumanLocomotor
        Condition                            = SET_NORMAL
        Speed                                = 1
    End

    LocomotorSet
        Locomotor                            = HumanWanderLocomotor
        Condition                            = SET_WANDER
        Speed                                = 1
    End


    Behavior = PhysicsBehavior ModuleTag_04
        GravityMult                          = 1.0
        ShockStandingTime                    = 2000
    End

    Behavior = SlowDeathBehavior ModuleTag_05
        DeathTypes                          = ALL -FADED
        SinkDelay                           = 3000
        SinkRate                            = 0.5
        DestructionDelay                    = 15000
        Sound                               = INITIAL ZwillingeVoiceDie
        DeathFlags                          = DEATH_1
    End

    Behavior = SlowDeathBehavior ModuleTag_FadeDeath
        DeathTypes                          = NONE +FADED
        FadeDelay                           = 0
        FadeTime                            = 0
        DestructionDelay                    = 0
        DeathFlags                          = DEATH_2

    End


    Behavior = CostModifierUpgrade ModuleTag_EnchantedAnvilUpgrades
        LabelForPalantirString    = GUI:UPGRADE_DISCOUNT
        TriggeredBy               = Upgrade_Level_1
        UpgradeDiscount           = Yes
        ApplyToTheseUpgrades      = Upgrade_ForgedBlades Upgrade_HeavyArmor Upgrade_BasicTraining Upgrade_SilverThornArrows
        Percentage                = -10%
    End
End

ChildObject ImladrisZwillingeEdain_Summoned ImladrisZwillingeEdain
    IsTrainable = No
    CommandPoints = 0
    CommandSet = BruchtalZwillingeCommandSet_Summoned

    KindOf = +SUMMONED

    Behavior                 = ExperienceLevelCreate ModuleTag_MPLevelBonus
        LevelToGrant         = 5
        MPOnly               = Yes
    End

   Behavior = RespawnUpdate ModuleTag_RespawnUpdate
   End

    Behavior = LifetimeUpdate ModuleTag_LifetimeUpdate
        MinLifetime        = CREATE_A_HERO_REINFORCEMENT_LIFETIME
        MaxLifetime        = CREATE_A_HERO_REINFORCEMENT_LIFETIME
        DeathType        = FADED
    End

    Behavior = SlowDeathBehavior ModuleTag_FadeDeath
        DeathTypes = NONE +FADED
        FadeDelay = 0
        FadeTime = 2500
        DestructionDelay = 2500
        Sound = INITIAL SpellGenericUnsummonFasterMS
        DeathFlags = DEATH_2
    End
End

ChildObject ImladrisZwillingeEdain_GraueSchar ImladrisZwillingeEdain

    Behavior = RespawnUpdate ModuleTag_RespawnUpdate
        DeathAnim                    = STUNNED
        DeathAnim                    = DYING
        DeathAnimationTime            = 6500
        RespawnAnim                    = LEVELED
        RespawnAnimationTime         = 2000
        AutoRespawnAtObjectFilter    = NONE +CASTLE_KEEP
        ButtonImage                  = HIZwillingeNeu
        RespawnAsTemplate            = ImladrisZwillingeEdain_GraueSchar

        RespawnRules =    AutoSpawn:No        Cost:THETWINSDAG_COST        Time:MEDIUM_HERO_RESPAWNTIME        Health:100%
    End


    Behavior = AttributeModifierAuraUpdate ModuleTag_KriegsrustungLeadershipUpdate
        StartsActive     = No
        BonusName        = Kriegsrustung
        TriggeredBy      = Upgrade_EreinionsRuckkehrSB
        RefreshDelay     = 2000
        Range            = 1
        AllowSelf        = No

        ObjectFilter     = NONE +ImladrisZwillingeEdain
    End

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_KriegsrustungLeadershipUnpause
        SpecialPowerTemplate = SpecialAbilityFakeLeadership
        TriggeredBy = Upgrade_EreinionsRuckkehrSB
    End

    Behavior = SpecialPowerModule ModuleTag_KriegsrustungLeadershipPower
        SpecialPowerTemplate      = SpecialAbilityFakeLeadership
        UpdateModuleStartsAttack  = No
        StartsPaused = Yes
    End

    Behavior = SubObjectsUpgrade ModuleTag_Skinwelchsel
        TriggeredBy = Upgrade_EreinionsRuckkehrSB
    End

    CommandSet                   = BruchtalZwillingeCommandSet_GraueSchar
End


ChildObject ImladrisZwillingeEdain_forMM ImladrisZwillingeEdain

    Behavior = RespawnUpdate ModuleTag_RespawnUpdate
        DeathAnim                    = STUNNED
        DeathAnim                    = DYING
        DeathAnimationTime            = 6500
        RespawnAnim                    = LEVELED
        RespawnAnimationTime         = 2000
        AutoRespawnAtObjectFilter    = NONE +CASTLE_KEEP
        ButtonImage                  = HIZwillingeNeu
        RespawnAsTemplate            = ImladrisZwillingeEdain_forMM

        RespawnRules =    AutoSpawn:No        Cost:THETWINSDAG_COST        Time:MEDIUM_HERO_RESPAWNTIME        Health:100%
    End

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_SchmiedekunstEnabler
        SpecialPowerTemplate         = SpecialAbilitySchmiedekunstZwillinge
        TriggeredBy                  = Upgrade_Level_3
    End

    Behavior = SpecialPowerModule ModuleTag_SchmiedekunstStarter
        SpecialPowerTemplate         = SpecialAbilitySchmiedekunstZwillinge
        StartsPaused                 = Yes
        UpdateModuleStartsAttack     = Yes
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_IstariLightUpdate
        SpecialPowerTemplate         = SpecialAbilitySchmiedekunstZwillinge
        SkipContinue                 = Yes
        UnpackTime                   = 1500
        PreparationTime              = 1
        PersistentPrepTime           = 1000
        PackTime                     = 500
        AwardXPForTriggering         = 0
        StartAbilityRange            = 40
        ApproachRequiresLOS          = Yes
        SpecialWeapon                = SchmiedekunstderZwillingeWeaponGondor
        MustFinishAbility            = Yes
        WhichSpecialWeapon           = 3
        BusyForDuration              = 2500
    End






    Behavior = AttributeModifierAuraUpdate ModuleTag_KriegsrustungLeadershipUpdate
        StartsActive     = No
        BonusName        = Kriegsrustung
        TriggeredBy      = Upgrade_EreinionsRuckkehrSB
        RefreshDelay     = 2000
        Range            = 1
        AllowSelf        = No

        ObjectFilter     = NONE +ImladrisZwillingeEdain
    End

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_KriegsrustungLeadershipUnpause
        SpecialPowerTemplate = SpecialAbilityFakeLeadership
        TriggeredBy = Upgrade_EreinionsRuckkehrSB
    End

    Behavior = SpecialPowerModule ModuleTag_KriegsrustungLeadershipPower
        SpecialPowerTemplate      = SpecialAbilityFakeLeadership
        UpdateModuleStartsAttack  = No
        StartsPaused = Yes
    End

    Behavior = SubObjectsUpgrade ModuleTag_Skinwelchsel
        TriggeredBy = Upgrade_EreinionsRuckkehrSB
    End

    MaxSimultaneousOfType    = 1

    CommandSet                   = BruchtalZwillingeCommandSet_GraueSchar

End

ChildObject ImladrisZwillingeEdain_forMM_Summoned ImladrisZwillingeEdain_forMM
    IsTrainable = No
    CommandPoints = 0
    CommandSet = BruchtalZwillingeCommandSet_Summoned

    KindOf = +SUMMONED

    Behavior                 = ExperienceLevelCreate ModuleTag_MPLevelBonus
        LevelToGrant         = 5
        MPOnly               = Yes
    End

   Behavior = RespawnUpdate ModuleTag_RespawnUpdate
   End

    Behavior = LifetimeUpdate ModuleTag_LifetimeUpdate
        MinLifetime      = 120000
        MaxLifetime      = 120000
        DeathType        = FADED
    End

    Behavior = SlowDeathBehavior ModuleTag_FadeDeath
        DeathTypes = NONE +FADED
        FadeDelay = 0
        FadeTime = 2500
        DestructionDelay = 2500
        Sound = INITIAL SpellGenericUnsummonFasterMS
        DeathFlags = DEATH_2
    End
End