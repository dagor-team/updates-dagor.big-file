Object ImladrisElrond

    SelectPortrait  = HPElrond2
    ButtonImage     = HIElrondRivendell

    DescriptionStrategic = CONTROLBAR:LW_ToolTip_LeaderHero

    Draw = W3DScriptedModelDraw ModuleTag_DRAW

        DefaultModelConditionState
            Model             = RUElrond_SKN
            Skeleton          = EUHaldir_SKL
        End

        ModelConditionState   = USER_4
            Model             = RUElrond_SKN
            Skeleton          = EUHaldir_SKL
        End

        ModelConditionState ONE_RING
            Model             = RUElrond_SKN
            ParticleSysBone   = B_SWORDBONE ElrondWaterKlingenFX FollowBone:Yes
        End

        ModelConditionState ONE_RING USER_4
            Model             = RUElrond_SKN
            ParticleSysBone   = B_SWORDBONE ElrondWaterKlingenFX FollowBone:Yes
        End

        ModelConditionState = WORLD_BUILDER
            Model = RUElrond_SKN
        End

        AnimationState          =    PACKING_TYPE_1
            StateName          =    Attacking
            Animation
                AnimationName =    EUHaldir_PNTB
                AnimationMode =    ONCE
            End
        End

        AnimationState          =    PACKING_TYPE_2
            StateName          =    Attacking
            Animation
                AnimationName =    EUHaldir_PNTB
                AnimationMode =    ONCE
            End
        End

        AnimationState          =    SPECIAL_WEAPON_ONE
            StateName          =    Attacking
            Animation
                AnimationName =    EUHaldir_TNTB
                AnimationMode =    ONCE
            End
        End



        AnimationState          = USER_3
            Animation                = Throwing Fireball
                AnimationName        = EUHaldir_PNTA
                AnimationMode        = ONCE
            End
            FXEvent            = Frame:10 Name:FX_ElrondVilyaRing
            FrameForPristineBonePositions = 27
        End


        AnimationState                        = PASSENGER
            StateName                        = STATE_Grabbed
            Animation                        = Sword
                AnimationName                = EUHaldir_FLYB
                AnimationMode                = LOOP
            End
        End


        AnimationState                        = FREEFALL
            StateName                        = STATE_Falling
            Animation                        = Sword
                AnimationName                = EUHaldir_FLYB
                AnimationMode                = LOOP
                AnimationBlendTime            = 10
                AnimationSpeedFactorRange    = 0.24 0.24
            End
        End


        AnimationState                        = STUNNED_FLAILING
            StateName                        = STATE_Fly
            Animation                        = Sword
                AnimationName                = EUHaldir_FLYB
                AnimationMode                = LOOP
                AnimationSpeedFactorRange    = 0.4 0.6
            End
            Flags                            = MAINTAIN_FRAME_ACROSS_STATES2
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                PrevAnim = CurDrawablePrevAnimation()
                if PrevState == "Ready_Bow" or PrevState == "Moving_Bow" or PrevState == "Bored_Bow"
                then
                    CurDrawableShowSubObject("arrow")
                    CurDrawableShowSubObject("arrownock")
                    return "WantSword"
                elseif PrevState == "STATE_Fly"
                then
                    if PrevAnim == "Bow" or PrevAnim == "WantSword"
                    then
                        CurDrawableShowSubObject("arrow")
                        CurDrawableShowSubObject("arrownock")
                        return "WantSword"
                    end
                end
                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
                return "Sword"
            EndScript
        End


        AnimationState                        = DYING DEATH_1 SPLATTED
            StateName                        = STATE_Dead
            Animation                        = Sword
                AnimationName                = EUHaldir_LNDB
                AnimationMode                = ONCE
            End
        End


        AnimationState                        = DYING DEATH_1
            Animation                        = Sword1
                AnimationName                = EUHaldir_DIESv5
                AnimationMode                = ONCE
            End
            Animation                        = Sword2
                AnimationName                = EUHaldir_DIESV5
                AnimationMode                = ONCE
            End
            Animation                        = WantSword
                AnimationName                = EUHaldir_LNDB
                AnimationMode                = ONCE
            End
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                PrevAnim = CurDrawablePrevAnimation()
                if PrevState == "STATE_Fly"
                then
                    CurDrawableShowSubObject("arrow")
                    CurDrawableShowSubObject("arrownock")
                    return "WantSword"
                end
                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
                if GetClientRandomNumberReal(0,2) < 1
                then
                    return "Sword1"
                else
                    return "Sword2"
                end
            EndScript
        End



        AnimationState                        = STUNNED_STANDING_UP
            StateName                        = STATE_GetUp
            Animation                        = Sword
                AnimationName                = EUHaldir_GTPSX1
                AnimationMode                = ONCE
                AnimationSpeedFactorRange    = 1.2    1.2
            End
            Animation                        = WantSword
                AnimationName                = EUHaldir_GTPB
                AnimationMode                = ONCE
            End
            Flags                            = MAINTAIN_FRAME_ACROSS_STATES4
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                PrevAnim = CurDrawablePrevAnimation()
                if PrevState == "STATE_GetUp" or PrevState == "STATE_Land"
                then
                    if PrevAnim == "Bow" or PrevAnim == "WantSword"
                    then
                        CurDrawableShowSubObject("arrow")
                        CurDrawableShowSubObject("arrownock")
                        return "WantSword"
                    end
                end
                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
                return "Sword"
            EndScript
        End


        AnimationState                        = STUNNED
            StateName                        = STATE_Land
            Animation                        = Sword
                AnimationName                = EUHaldir_LNDB
                AnimationMode                = ONCE
            End
            Animation                        = WantSword
                AnimationName                = EUHaldir_LNDA
                AnimationMode                = ONCE
            End
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                PrevAnim = CurDrawablePrevAnimation()
                if PrevState == "STATE_Fly"
                then
                    if PrevAnim == "WantSword" or PrevAnim == "Bow"
                    then
                        CurDrawableShowSubObject("arrow")
                        CurDrawableShowSubObject("arrownock")
                        return "WantSword"
                    end
                end
                Flags                        = MAINTAIN_FRAME_ACROSS_STATES3
                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
                return "Sword"
            EndScript
        End

        AnimationState                        = PARALYZED
            Animation
                AnimationName                = EUHaldir_IDLF
                AnimationMode                = LOOP
            End
        End


        AnimationState                        = FIRING_OR_PREATTACK_A
            StateName                        = Ready_Sword

            Animation                        = AttackWithSwordA
                AnimationName                = EUHaldir_ATKSV2
                AnimationMode                = ONCE
                UseWeaponTiming                = Yes
            End
            Animation                        = AttackWithSwordB
                AnimationName                = EUHaldir_ATKSV2
                AnimationMode                = ONCE
                UseWeaponTiming                = Yes
            End
            Animation                        = AttackWithSwordD
                AnimationName                = EUHaldir_ATKSV4
                AnimationMode                = ONCE
                UseWeaponTiming                = Yes
            End
            BeginScript
                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
            EndScript
        End

        AnimationState                        = FIRING_OR_PREATTACK_B
            StateName                        = Ready_Sword

            Animation                        = AttackWithSwordA
                AnimationName                = EUHaldir_ATKSV2
                AnimationMode                = ONCE
                UseWeaponTiming                = Yes
            End
            Animation                        = AttackWithSwordB
                AnimationName                = EUHaldir_ATKSV2
                AnimationMode                = ONCE
                UseWeaponTiming                = Yes
            End
            Animation                        = AttackWithSwordD
                AnimationName                = EUHaldir_ATKSV4
                AnimationMode                = ONCE
                UseWeaponTiming                = Yes
            End
            BeginScript
                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
            EndScript
        End


        AnimationState                        = MOVING
            StateName                        = Moving_Sword
            Animation
                AnimationName                = EUHaldir_RUNS
                AnimationMode                = LOOP
            End
            Flags = RANDOMSTART
            BeginScript
                CurDrawableHideSubObject("arrow")
                CurDrawableHideSubObject("arrownock")
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Moving_Bow" then CurDrawableSetTransitionAnimState("TRANS_BowToSword_Moving") end
            EndScript
        End


        AnimationState                        = MOVING BACKING_UP
            StateName                        = STATE_BackingUp
            Animation                        = Sword
                AnimationName                = EUHaldir_BAKS
                AnimationMode                = LOOP
            End
            Animation                        = WantSword
                AnimationName                = EUHaldir_BAKS
                AnimationMode                = LOOP
            End
            Flags                            = MAINTAIN_FRAME_ACROSS_STATES4
            BeginScript
                CurDrawableHideSubObject("ARROW")
                CurDrawableHideSubObject("ARROWNOCK")
                PrevAnim    = CurDrawablePrevAnimation()
                PrevState    = CurDrawablePrevAnimationState()
                if PrevState == "STATE_BackingUp"
                then
                    if PrevAnim == "Bow" or PrevAnim == "WantSword"
                    then
                        return "WantSword"
                    end
                end
                return "Sword"
            EndScript
        End


        AnimationState                        = CONTINUOUS_FIRE_MEAN
            Animation                        = HangFrameWhileCoasting
                AnimationName                = EUHaldir_ATA2
                AnimationMode                = MANUAL
                AnimationBlendTime            = 20
            End
            Flags                            = START_FRAME_LAST
            BeginScript
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("ARROWNOCK")
                if CurDrawablePrevAnimationState() == "STATE_Firing" then CurDrawableAllowToContinue() end
            EndScript
        End
        AnimationState                        = CONTINUOUS_FIRE_SLOW
            StateName                        = Ready_Bow
            Animation                        = PutAwayArrow
                AnimationName                = EUHaldir_ATA3
                AnimationMode                = ONCE
            End
            BeginScript
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("ARROWNOCK")
            EndScript
        End


        AnimationState                        = ATTACKING
            StateName                        = Ready_Sword
            Animation                        = Alert_1
                AnimationName                = EUHaldir_IDLST1
                AnimationMode                = LOOP
            End
            BeginScript
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
                if Prev == "Bored_Sword" then CurDrawableSetTransitionAnimState("TRANS_BR_Sword") end
                if Prev == "Selected_Bow" or Prev == "Moving_Bow" or Prev == "Ready_Bow" or Prev == "Bored_Bow" or PrevAnim == "WantSword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BowToSword_Ready")
                end
            EndScript
        End


        AnimationState                        = ENGAGED
            StateName                        = Ready_Sword
            Animation                        = Alert_1
                AnimationName                = EUHaldir_IDLST1
                AnimationMode                = LOOP
            End
            BeginScript
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
                if Prev == "Bored_Sword"        then CurDrawableSetTransitionAnimState("TRANS_BR_Sword")            end
                if Prev == "Selected_Bow" or Prev == "Moving_Bow" or Prev == "Ready_Bow" or Prev == "Bored_Bow" or PrevAnim == "WantSword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BowToSword_Ready")
                end
            EndScript
        End


        AnimationState                        = EMOTION_ALERT
            StateName                        = Ready_Sword
            Animation                        = Alert_1
                AnimationName                = EUHaldir_IDLST1
                AnimationMode                = LOOP
            End
            BeginScript
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
                if Prev == "Bored_Sword" then CurDrawableSetTransitionAnimState("TRANS_BR_Sword") end
                if Prev == "Selected_Bow" or Prev == "Moving_Bow" or Prev == "Ready_Bow" or Prev == "Bored_Bow" or PrevAnim == "WantSword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BowToSword_Ready")
                end
            EndScript
        End


        AnimationState                        = EMOTION_CELEBRATING
            StateName                        = STATE_Emotion_Sword
            Animation                        = Sword
                AnimationName                = EUHaldir_CHRS
                AnimationMode                = ONCE
            End
            Animation                        = Sword2
                AnimationName                = EUHaldir_CHRS
                AnimationMode                = ONCE
            End
            Flags                            = MAINTAIN_FRAME_ACROSS_STATES RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("arrow")
                CurDrawableHideSubObject("arrownock")

                if PrevState == "STATE_Emotion_Bow"
                then
                    CurDrawableAllowToContinue()
                    if( CurDrawablePrevAnimFraction() > .89 )
                    then
                        CurDrawableSetTransitionAnimState("TRANS_BowToSword_Ready")
                    end
                elseif PrevState == "STATE_Emotion_Sword"
                then
                    CurDrawableAllowToContinue()
                elseif PrevState == "Bored_Sword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BR_Sword")
                end
            EndScript
        End


        AnimationState                        = EMOTION_TAUNTING
            StateName                        = STATE_Emotion_Sword
            Animation                        = Sword
                AnimationName                = EUHaldir_TNTB
                AnimationMode                = ONCE
            End
            Animation                        = Sword2
                AnimationName                = EUHaldir_TNTB
                AnimationMode                = ONCE
            End
            Flags                            = RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("arrow")
                CurDrawableHideSubObject("arrownock")
                if PrevState == "STATE_Emotion_Bow"
                then
                    CurDrawableAllowToContinue()
                    if( CurDrawablePrevAnimFraction() > .89 )
                    then
                        CurDrawableSetTransitionAnimState("TRANS_BowToSword_Ready")
                    end
                elseif PrevState == "STATE_Emotion_Sword"
                    then
                        CurDrawableAllowToContinue()
                elseif PrevState == "Bored_Sword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BR_Sword")
                end
            EndScript
        End


        AnimationState                        = EMOTION_POINTING
            StateName                        = STATE_Emotion_Sword
            Animation                        = Sword
                AnimationName                = EUHaldir_PNTB
                AnimationMode                = ONCE
            End
            Animation                        = Sword2
                AnimationName                = EUHaldir_PNTB
                AnimationMode                = ONCE
            End
            Flags                            = MAINTAIN_FRAME_ACROSS_STATES RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("arrow")
                CurDrawableHideSubObject("arrownock")

                if PrevState == "STATE_Emotion_Bow"
                then
                    CurDrawableAllowToContinue()
                    if( CurDrawablePrevAnimFraction() > .89 )
                    then
                        CurDrawableSetTransitionAnimState("TRANS_BowToSword_Ready")
                    end
                elseif PrevState == "STATE_Emotion_Sword"
                then
                    CurDrawableAllowToContinue()
                elseif PrevState == "Bored_Sword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BR_Sword")
                end
            EndScript
        End


        AnimationState                        = HIT_REACTION HIT_LEVEL_1
            StateName                        = Bored_Sword
            Animation
                AnimationName                = EUHaldir_HITE
                AnimationMode                = ONCE
            End
        End


        AnimationState                        = RAISING_FLAG
            StateName                        = STATE_Emotion_Sword
            Animation                        = Sword
                AnimationName                = EUHaldir_CHRS
                AnimationMode                = ONCE
            End
            Animation                        = Sword2
                AnimationName                = EUHaldir_CHRS
                AnimationMode                = ONCE
            End
            Flags                            = RESTART_ANIM_WHEN_COMPLETE
        End

        AnimationState                        = SELECTED
            StateName                        = Selected_Sword
            Animation                        = ATNA
                AnimationName                = EUHaldir_ATNS
                AnimationMode                = LOOP
            End
            BeginScript
                CurDrawableHideSubObject("ARROW")
                CurDrawableHideSubObject("ARROWNOCK")
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Emotion_Bow" or Prev == "STATE_Emotion_Sword" then CurDrawableAllowToContinue() end
                if Prev == "Bored_Sword" then CurDrawableSetTransitionAnimState("TRANS_BoredToSelected_Sword") end
                if Prev == "Ready_Sword" then CurDrawableSetTransitionAnimState("TRANS_ReadyToSelected_Sword") end
                if Prev == "Selected_Bow" or Prev == "Moving_Bow" or Prev == "Ready_Bow" or Prev == "Bored_Bow" or PrevAnim == "WantSword" or PrevAnim == "EUHaldir_STHB"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BowToSword_Selected")
                end
            EndScript
        End


        IdleAnimationState
            StateName                        = Bored_Sword
            Animation                        = Idle_Sword1
                AnimationName                = EUHaldir_IDLF
                AnimationMode                = ONCE
            End
            Animation                        = Idle_Sword2
                AnimationName                = EUHaldir_IDLF
                AnimationMode                = ONCE
            End
            Animation                        = Idle_Sword3
                AnimationName                = EUHaldir_IDLF
                AnimationMode                = ONCE
            End
            Animation                        = IdleNoFidget
                AnimationName                = EUHaldir_IDLF
                AnimationMode                = ONCE
                AnimationPriority            = 20
            End
            Animation                        = IdleNoFidget2
                AnimationName                = EUHaldir_IDLF
                AnimationMode                = ONCE
                AnimationPriority            = 0
            End
            Flags                            = RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                CurDrawableHideSubObject("ARROW")
                CurDrawableHideSubObject("ARROWNOCK")
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                if Prev == "TRANS_SelectedToBored_Sword" or Prev == "TRANS_RB_Sword" then return "IdleNoFidget" end
                if Prev == "Selected_Sword" then CurDrawableSetTransitionAnimState("TRANS_SelectedToBored_Sword") end
                if Prev == "Ready_Sword" then CurDrawableSetTransitionAnimState("TRANS_RB_Sword") end
                if Prev == "Selected_Bow" or Prev == "Moving_Bow" or Prev == "Ready_Bow" or Prev == "Bored_Bow" or PrevAnim == "WantSword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BowToSword_Selected")
                end
            EndScript
        End




        TransitionState                        = TRANS_BoredToSelected_Bow
            Animation
                AnimationName                = EUHaldir_ATNB
                AnimationMode                = ONCE
                AnimationBlendTime            = 10
            End
        End


        TransitionState                        = TRANS_SelectedToReady_Bow
            Animation                        = ATNE
                AnimationName                = EUHaldir_IDLB
                AnimationMode                = ONCE
                AnimationBlendTime            = 10
            End
        End


        TransitionState                        = TRANS_SelectedToBored_Bow
            Animation
                AnimationName                = EUHaldir_ATNB
                AnimationMode                = ONCE_BACKWARDS
            End
            Flags                            = START_FRAME_LAST
        End


        TransitionState                        = TRANS_RS_Bow
            Animation                        = ATNF
                AnimationName                = EUHaldir_IDLB
                AnimationMode                = ONCE_BACKWARDS
                AnimationBlendTime            = 10
            End
            Flags                            = START_FRAME_LAST
        End


        TransitionState                        = TRANS_BR_Bow
            Animation                        = IDLB
                AnimationName                = EUHaldir_IDLST1
                AnimationMode                = ONCE
                AnimationBlendTime            = 20
            End
        End


        TransitionState                        = TRANS_RB_Bow
            Animation                        = IDLD
                AnimationName                = EUHaldir_IDLB
                AnimationMode                = ONCE
                AnimationBlendTime            = 20
            End
        End


        TransitionState                    = TRANS_BoredToSelected_Sword
            Animation                    = ATNA
                AnimationName            = EUHaldir_ATNA
                AnimationMode            = ONCE
            End
        End


        TransitionState                    = TRANS_SR_Sword
            Animation                    = ATNC
                AnimationName            = EUHaldir_STHA
                AnimationMode            = ONCE
            End
        End


        TransitionState                    = TRANS_SelectedToBored_Sword
            Animation                    = ATNA
                AnimationName            = EUHaldir_ATNA
                AnimationMode            = ONCE_BACKWARDS
            End
            Flags                        = START_FRAME_LAST
        End


        TransitionState                    = TRANS_ReadyToSelected_Sword
            Animation                    = ATNC
                AnimationName            = EUHaldir_IDLST1
                AnimationMode            = ONCE_BACKWARDS
                AnimationBlendTime        = 20
            End
            Flags                        = START_FRAME_LAST
        End


        TransitionState                    = TRANS_BR_Sword
            Animation                    = ATNS
                AnimationName            = EUHaldir_STHA
                AnimationMode            = ONCE
                AnimationBlendTime        = 20
            End
        End


        TransitionState                    = TRANS_RB_Sword
            Animation                    = IDLG
                AnimationName            = EUHaldir_STHA
                AnimationMode            = ONCE
                AnimationBlendTime        = 20
            End
        End



        TransitionState                    = TRANS_SwordToBow_Moving
            Animation                    = DrawBow
                AnimationName            = EUHaldir_STHC
                AnimationMode            = ONCE
            End
        End


        TransitionState                    = TRANS_BowToSword_Moving
            Animation                    = DrawSword
                AnimationName            = EUHaldir_STHD
                AnimationMode            = ONCE
            End
        End


        TransitionState                    = TRANS_BowToSword_Ready
            Animation                    = DrawSwords
                AnimationName            = EUHaldir_STHA
                AnimationMode            = ONCE
            End
        End


        TransitionState                    = TRANS_SwordToBow_Ready
            Animation                    = DrawBow
                AnimationName            = EUHaldir_STHB
                AnimationMode            = ONCE
            End
        End


        TransitionState                    = TRANS_BowToSword_Selected
            Animation                    = DrawSwords
                AnimationName            = EUHaldir_STHA
                AnimationMode            = ONCE
            End
        End


        TransitionState                    = TRANS_SwordToBow_Selected
            Animation                    = DrawBow
                AnimationName            = EUHaldir_STHB
                AnimationMode            = ONCE
            End
        End
    End



    Draw = W3DScriptedModelDraw Icon
        ModelConditionState = NONE
            Model           = bbox
        End
    End



    #include "..\..\..\includes\StunDrawModuleSmall.inc"


    Side = Imladris
    EditorSorting = UNIT
    ThreatLevel = ELROND_THREAT
    ThingClass = CHARACTER_UNIT
    TransportSlotCount = TRANSPORTSLOTCOUNT_HERO
    DisplayMeleeDamage  = STRONG_HERO_DAMAGE
    MaxSimultaneousOfType                 = 1
    BuildCost = ELRONDDAG_COST
    BuildTime = SILMARIL_HERO_BUILDTIME

   WeaponSet
        ; Conditions        = SPECIAL_ONE
        Weapon            = PRIMARY    ElrondWaterSword
        ; Weapon            = SECONDARY  ElrondNewSword
        ; OnlyAgainst       = SECONDARY  STRUCTURE BLOCKING_GATE
        AutoChooseSources = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End

    ArmorSet
        Conditions      = None
        Armor           = StrongHeroArmor
        DamageFX        = NormalDamageFX
    End

    VisionRange = 300
    ShroudClearingRange = 400

    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = 200
    VisionBonusPercentPerFoot = 1.0%

    BountyValue = ELVEN_ELROND_BOUNTY_VALUE
    RecruitText = CONTROLBAR:ElrondRecruit
    ReviveText  = CONTROLBAR:ElrondRevive
    Hotkey      = CONTROLBAR:ElvenElrondHotkey
    DisplayName = OBJECT:ElvenElrond
    CrushableLevel = 3

    CommandSet = ElrondMODCommandSet
    CommandPoints = 0


    AutoResolveUnitType = AutoResolveUnit_Hero
    AutoResolveCombatChain = AutoResolve_HeroCombatChain

    AutoResolveBody = AutoResolve_ElrondBody

    AutoResolveArmor
        Armor = AutoResolve_ElrondArmor
    End

    AutoResolveWeapon
        Weapon = AutoResolve_ElrondWeapon
    End

    AutoResolveLeadership = AutoResolve_ElrondBonus




    VoiceCreated                                  = ElrondModVoiceCreate
    VoiceFullyCreated                             = ElrondModVoiceCreate
    VoiceAttack                                   = ElrondModVoiceAttack
    VoiceAttackCharge                             = ElrondModVoiceAttack
    VoiceAttackMachine                            = ElrondModVoiceAttack
    VoiceAttackStructure                          = ElrondModVoiceAttack
    VoiceFear                                     = ElrondModVoiceHelp
    VoiceGuard                                    = ElrondModVoiceMove
    VoiceMove                                     = ElrondModVoiceMove
    VoiceMoveToCamp                               = ElrondModVoiceMove
    VoicePriority                                 = 95
    VoiceRetreatToCastle                          = ElrondVoiceRetreat
    VoiceSelect                                   = ElrondModVoiceSelect
    VoiceSelectBattle                             = ElrondModVoiceSelect

    SoundImpact                                   = ImpactHorse

    UnitSpecificSounds
        VoiceEnterUnitElvenTransportShip          = ElrondModVoiceMove
        VoiceGarrison                             = ElrondModVoiceMove
        VoiceInitiateCaptureBuilding              = ElrondModVoiceMove
    End


    CrowdResponseKey = ElfHero

    #include "..\..\..\includes\StandardUnitEvaEvents.inc"
    EvaEventDieOwner            = ElrondDie


    Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
        Key = Humanoid_Male Elf_Male Unit Infantry Hero

    End

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap                    = 800
        AnimationSound                        = Sound:ArrowDrawBow                    Animation:EUHaldir_SKL.EUHaldir_ATA1    Frames:6
        AnimationSound                        = Sound:ArrowDrawBow                    Animation:EUHaldir_SKL.EUHaldir_ATA2    Frames:18
        AnimationSound                        = Sound:SwordShingClean1                Animation:EUHaldir_SKL.EUHaldir_STHA     Frames:24
        AnimationSound                        = Sound:SwordIntoScabbard1              Animation:EUHaldir_SKL.EUHaldir_STHB     Frames:9
        AnimationSound                        = Sound:WeaponSwitchBow                 Animation:EUHaldir_SKL.EUHaldir_STHB     Frames:15
        AnimationSound                        = Sound:SwordShingClean1                Animation:EUHaldir_SKL.EUHaldir_STHC     Frames:20
        AnimationSound                        = Sound:SwordIntoScabbard1              Animation:EUHaldir_SKL.EUHaldir_STHD     Frames:5
        AnimationSound                        = Sound:WeaponSwitchBow                 Animation:EUHaldir_SKL.EUHaldir_STHD     Frames:8
        AnimationSound                        = Sound:SwordShingClean1                Animation:EUHaldir_SKL.EUHaldir_RUNC     Frames:14
        AnimationSound                        = Sound:SwordIntoScabbard1              Animation:EUHaldir_SKL.EUHaldir_RUNT     Frames:4
        AnimationSound                        = Sound:WeaponSwitchBow                 Animation:EUHaldir_SKL.EUHaldir_RUNT     Frames:16
        AnimationSound                        = Sound:BodyFallSoldier                 Animation:EUHaldir_SKL.EUHaldir_LNDA     Frames:9
        AnimationSound                        = Sound:BodyFallSoldier                 Animation:EUHaldir_SKL.EUHaldir_LNDB     Frames:1
        AnimationSound                        = Sound:BodyFallGenericNoArmor          Animation:EUHaldir_SKL.EUHaldir_DIEB     Frames:82
        AnimationSound                        = Sound:BodyFallSoldier                 Animation:EUHaldir_SKL.EUHaldir_DIEBV5   Frames:25
        AnimationSound                        = Sound:BodyFallSoldier                 Animation:EUHaldir_SKL.EUHaldir_DIESV4   Frames:26
        AnimationSound                        = Sound:BodyFallGenericNoArmor          Animation:EUHaldir_SKL.EUHaldir_DIESV5   Frames:100
    End



    RadarPriority = UNIT
    KindOf = HERO PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY ATTACK_NEEDS_LINE_OF_SIGHT PATH_THROUGH_EACH_OTHER SCORE ARMY_SUMMARY HEAVY_MELEE_HITTER
    PathfindDiameter = 40.0
    CamouflageDetectionMultiplier = CAMOUFLAGE_DETECTION_DISTANCE_MEDIUM


    Body = RespawnBody ModuleTag_RespawnBody
        CheerRadius                  = EMOTION_CHEER_RADIUS
        MaxHealth                    = ELRONDDAG_HEALTH
        PermanentlyKilledByFilter    = NONE
        DodgePercent                 = HERO_DODGE_PERCENT
    End

    Behavior = RespawnUpdate ModuleTag_RespawnUpdate
        DeathAnim                     = DYING
        DeathAnimationTime            = 4000
        RespawnAnim                   = LEVELED
        RespawnAnimationTime          = 2000
        AutoRespawnAtObjectFilter     = NONE +CASTLE_KEEP
        ButtonImage                   = HIElrondRivendell
        RespawnAsTemplate             = ImladrisElrond

        RespawnRules =    AutoSpawn:No           Cost:ELRONDDAG_COST       Time:SILMARIL_HERO_RESPAWNTIME        Health:100%
   End


    #include "..\..\..\includes\DefaultInvisibilityUpdate.inc"

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = Hero
    End





    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_FactionLeaderLeadershipStart
        SpecialPowerTemplate    = SpecialAbilityFakeLeadership3
    End

    Behavior = SpecialPowerModule ModuleTag_FactionLeaderLeadershipUpdate
        SpecialPowerTemplate        = SpecialAbilityFakeLeadership3
        UpdateModuleStartsAttack    = No
        StartsPaused                = No
    End

    Behavior = AttributeModifierAuraUpdate ModuleTag_FactionLeaderLeadership
        StartsActive     = Yes
        BonusName        = FactionLeaderGlobalLeadership
        RefreshDelay     = 2000
        Range            = 625
        ObjectFilter     = IMLADRIS_LEADERSHIP_UNITS_OBF
    End





    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_FarsightUnpause
        SpecialPowerTemplate    = SpecialAbilityElrondFarsight
        TriggeredBy             = Upgrade_Level_1
    End
    Behavior = OCLSpecialPower ModuleTag_FarsightOCL
        StartsPaused            = Yes
        SpecialPowerTemplate    = SpecialAbilityElrondFarsight
        OCL                     = OCL_SpecialPowerFarSeeing
        CreateLocation          = CREATE_AT_LOCATION
    End







    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_LautwasserEnabler
        SpecialPowerTemplate = SpecialAbilityZornderLautwasser
        TriggeredBy = Upgrade_Level_10
    End

    Behavior = SpecialPowerModule ModuleTag_LautwasserStarter
        SpecialPowerTemplate        = SpecialAbilityZornderLautwasser
        UpdateModuleStartsAttack    = Yes
        StartsPaused                = Yes
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_LautwasserUpdate
        SpecialPowerTemplate    = SpecialAbilityZornderLautwasser
        UnpackTime              = 1300
        PackTime                = 1500
	StartAbilityRange       = 100.0
        SpecialWeapon           = ElrondPersonalFlood
        WhichSpecialWeapon      = 1
    End

    Behavior = AutoAbilityBehavior ModuleTag_LautwasserAutoAbility
        SpecialAbility              = SpecialAbilityZornderLautwasser
        MinScanRange                = 100
        MaxScanRange                = 200
        Query                       = 1 ANY ENEMIES +STRUCTURE +HERO
        Query                       = 20 ALL ENEMIES
    End


	Behavior                   = UnpauseSpecialPowerUpgrade ModuleTag_ElrondsWisdom
		SpecialPowerTemplate    = SpecialAbilityElrondsWisdom
		TriggeredBy             = Upgrade_Level_5
	End

	Behavior                   = OCLSpecialPower ModuleTag_OCLElrondsWisdom
		SpecialPowerTemplate     = SpecialAbilityElrondsWisdom
		OCL                      = OCL_ElrondsWisdom
		TriggerFX                = FX_SummonTowerGuards
		CreateLocation           = CREATE_AT_LOCATION
		StartsPaused             = Yes
		SetModelCondition        = ModelConditionState:LEVELED
		SetModelConditionTime    = 8.1
	End
	
	Behavior = SpecialAbilityUpdate ModuleTag_ElrondsWisdomUpdate
        SpecialPowerTemplate         = SpecialAbilityElrondsWisdom
        UnpackTime                   = 0
        PreparationTime              = 0
        PackTime                     = 0
        AwardXPForTriggering         = 90
    End




	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_VetsransOfthelastAlliance
        SpecialPowerTemplate = SpecialAbilityFakeLeadership
        TriggeredBy = Upgrade_Level_5
	
    End

    Behavior = SpecialPowerModule ModuleTag_VetsransOfthelastAllianceUpdate
        SpecialPowerTemplate      = SpecialAbilityFakeLeadership
        UpdateModuleStartsAttack  = Yes
        StartsPaused = No
    End

	Behavior = AttributeModifierAuraUpdate ModuleTag_VetsransOfthelastAllianceLeadership
        StartsActive     = Yes
        BonusName        = VetsransOfthelastAllianceLeadership
        TriggeredBy      = Upgrade_Level_5
        RefreshDelay     = 2000
        Range            = 300
        ObjectFilter     = ANY +BruchtalVeteran  -HERO -STRUCTURE -DOZER -MACHINE -SHIP -CAVALRY ALLIES
    End


	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_VetsransOfthelastAlliance2
        SpecialPowerTemplate = SpecialAbilityFakeLeadership
        TriggeredBy = Upgrade_Level_10
	
    End

    Behavior = SpecialPowerModule ModuleTag_VetsransOfthelastAllianceUpdate2
        SpecialPowerTemplate      = SpecialAbilityFakeLeadership
        UpdateModuleStartsAttack  = Yes
        StartsPaused = No
    End

	Behavior = AttributeModifierAuraUpdate ModuleTag_VetsransOfthelastAllianceLeadership2
        StartsActive     = Yes
        BonusName        = VetsransOfthelastAllianceLeadership2
        TriggeredBy      = Upgrade_Level_10
        RefreshDelay     = 2000
        Range            = 300
        ObjectFilter     = ANY +BruchtalVeteran  -HERO -STRUCTURE -DOZER -MACHINE -SHIP -CAVALRY ALLIES
    End


	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_VetsransOfthelastAlliance3
        SpecialPowerTemplate = SpecialAbilityFakeLeadership
        TriggeredBy = Upgrade_Level_15
	
    End

    Behavior = SpecialPowerModule ModuleTag_VetsransOfthelastAllianceUpdate3
        SpecialPowerTemplate      = SpecialAbilityFakeLeadership
        UpdateModuleStartsAttack  = Yes
        StartsPaused = No
    End

	Behavior = AttributeModifierAuraUpdate ModuleTag_VetsransOfthelastAllianceLeadership3
        StartsActive     = Yes
        BonusName        = VetsransOfthelastAllianceLeadership3
        TriggeredBy      = Upgrade_Level_15
        RefreshDelay     = 2000
        Range            = 300
        ObjectFilter     = ANY +BruchtalVeteran  -HERO -STRUCTURE -DOZER -MACHINE -SHIP -CAVALRY ALLIES
    End




    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_FloodEnabler
        SpecialPowerTemplate = SpecialAbilityPersonalFlood
        TriggeredBy = Upgrade_Level_7
    End

    Behavior = SpecialPowerModule ModuleTag_FloodStarter
        SpecialPowerTemplate        = SpecialAbilityPersonalFlood
        UpdateModuleStartsAttack    = Yes
        StartsPaused                = Yes
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_FloodUpdate
        SpecialPowerTemplate    = SpecialAbilityPersonalFlood
        UnpackTime              = 1300
        PackTime                = 1500
        StartAbilityRange       = 150.0
        SpecialWeapon 	    	= ElrondRingPersonalFlood
        WhichSpecialWeapon 	= 1
    End

    Behavior = AutoAbilityBehavior ModuleTag_PersonalFloodAutoAbility
        SpecialAbility              = SpecialAbilityPersonalFlood
        MinScanRange                = 150
        MaxScanRange                = 250
        Query                       = 1 ANY ENEMIES +STRUCTURE +HERO
        Query                       = 20 ALL ENEMIES
    End






    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_RatschlagEnabler
        SpecialPowerTemplate         = SpecialAbilityElrondsRatschlag
        TriggeredBy                  = Upgrade_Level_3
    End

    Behavior = SpecialPowerModule ModuleTag_RatschlagSpecialPowerModule
        SpecialPowerTemplate         = SpecialAbilityElrondsRatschlag
        StartsPaused                 = Yes
        UpdateModuleStartsAttack     = Yes
        InitiateSound                = ElrondsRatschlagSound
    End

    Behavior = LevelGrantSpecialPower ModuleTag_Ratschlag
        SpecialPowerTemplate         = SpecialAbilityElrondsRatschlag
        UnpackingVariation           = 2
        StartAbilityRange            = 200.0
        LevelFX                      = FX_ElrondsRatschlagFX
        Experience                   = 200
        RadiusEffect                 = 30
        AcceptanceFilter             = NONE +HERO +GasthausPalando +GasthausAlatar +ImladrisGwaihirFortressEagle +ImladrisGwaihir -ImladrisElrond -ImladrisElrond_RingHero -ImladrisElrond_Summoned ALLIES
        UnpackTime                   = 1200
        PreparationTime              = 0
        FreezeAfterTriggerDuration   = 2000
    End







    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_LehrenEnabler
        SpecialPowerTemplate         = SpecialAbilityElrondsLehren
        TriggeredBy                  = Upgrade_Level_3
    End

    Behavior = SpecialPowerModule ModuleTag_LehrenSpecialPowerModule
        SpecialPowerTemplate         = SpecialAbilityElrondsLehren
        StartsPaused                 = Yes
        UpdateModuleStartsAttack     = Yes
        InitiateSound                = ElrondsRatschlagSound
    End

    Behavior = LevelGrantSpecialPower ModuleTag_Lehren
        SpecialPowerTemplate         = SpecialAbilityElrondsLehren
        UnpackingVariation           = 2
        StartAbilityRange            = 200.0
        LevelFX                      = FX_ElrondsRatschlagFX
        Experience                   = 10000
        RadiusEffect                 = 30
        AcceptanceFilter             = NONE +HERO +GasthausPalando +GasthausAlatar +ImladrisGwaihirFortressEagle +ImladrisGwaihir -ImladrisElrond -ImladrisElrond_RingHero -ImladrisElrond_Summoned ALLIES
        UnpackTime                   = 1200
        PreparationTime              = 0
        FreezeAfterTriggerDuration   = 2000
    End







    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_ElrondsErfahrungsLeadership
        SpecialPowerTemplate      = SpecialAbilityFakeLeadership3
        TriggeredBy               = Upgrade_Level_1
    End

    Behavior = SpecialPowerModule ModuleTag_ElrondsErfahrungsLeadershipUpdate
        SpecialPowerTemplate      = SpecialAbilityFakeLeadership3
        UpdateModuleStartsAttack  = No
        StartsPaused              = No
    End

    Behavior = AttributeModifierAuraUpdate ModuleTag_Leadership2
        StartsActive              = Yes
        BonusName                 = ElrondScale1
        TriggeredBy               = Upgrade_Level_1
        RefreshDelay              = 2000
        Range                     = 200
		AntiCategory              = BUFF
        ObjectFilter              = IMLADRIS_LEADERSHIP_UNITS_OBF ;GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
    End
	
	   Behavior = AttributeModifierAuraUpdate ModuleTag_Leadership3
        StartsActive              = No
        BonusName                 = ElrondScale2
        TriggeredBy               = Upgrade_Level_2
        RefreshDelay              = 2000
        Range                     = 200
		AntiCategory              = BUFF
        ObjectFilter              = IMLADRIS_LEADERSHIP_UNITS_OBF ;GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
    End
	
	   Behavior = AttributeModifierAuraUpdate ModuleTag_Leadership4
        StartsActive              = No
        BonusName                 = ElrondScale3
        TriggeredBy               = Upgrade_Level_3
        RefreshDelay              = 2000
        Range                     = 200
		AntiCategory              = BUFF
        ObjectFilter              = IMLADRIS_LEADERSHIP_UNITS_OBF ;GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
    End
	
	   Behavior = AttributeModifierAuraUpdate ModuleTag_Leadership5
        StartsActive              = No
        BonusName                 = ElrondScale4
        TriggeredBy               = Upgrade_Level_4
        RefreshDelay              = 2000
        Range                     = 200
		AntiCategory              = BUFF
        ObjectFilter              = IMLADRIS_LEADERSHIP_UNITS_OBF ;GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
    End
	
	   Behavior = AttributeModifierAuraUpdate ModuleTag_Leadership6
        StartsActive              = No
        BonusName                 = ElrondScale5
        TriggeredBy               = Upgrade_Level_5
        RefreshDelay              = 2000
        Range                     = 200
		AntiCategory              = BUFF
        ObjectFilter              = IMLADRIS_LEADERSHIP_UNITS_OBF ;GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
    End
	
	   Behavior = AttributeModifierAuraUpdate ModuleTag_Leadership7
        StartsActive              = No
        BonusName                 = ElrondScale5
        TriggeredBy               = Upgrade_Level_6
        RefreshDelay              = 2000
        Range                     = 200
		AntiCategory              = BUFF
        ObjectFilter              = IMLADRIS_LEADERSHIP_UNITS_OBF ;GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
    End
	
	   Behavior = AttributeModifierAuraUpdate ModuleTag_Leadership8
        StartsActive              = No
        BonusName                 = ElrondScale6
        TriggeredBy               = Upgrade_Level_7
        RefreshDelay              = 2000
        Range                     = 200
		AntiCategory              = BUFF
        ObjectFilter              = IMLADRIS_LEADERSHIP_UNITS_OBF ;GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
    End
	
	   Behavior = AttributeModifierAuraUpdate ModuleTag_Leadership9
        StartsActive              = No
        BonusName                 = ElrondScale7
        TriggeredBy               = Upgrade_Level_8
        RefreshDelay              = 2000
        Range                     = 200
		AntiCategory              = BUFF
        ObjectFilter              = IMLADRIS_LEADERSHIP_UNITS_OBF ;GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
    End
	
	   Behavior = AttributeModifierAuraUpdate ModuleTag_Leadership10
        StartsActive              = No
        BonusName                 = ElrondScale8
        TriggeredBy               = Upgrade_Level_9
        RefreshDelay              = 2000
        Range                     = 200
		AntiCategory              = BUFF
        ObjectFilter              = IMLADRIS_LEADERSHIP_UNITS_OBF ;GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
    End

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_TheodenLeadership
        SpecialPowerTemplate     = SpecialAbilityFakeLeadership
        TriggeredBy              = Upgrade_Level_5
    End

    Behavior = SpecialPowerModule ModuleTag_TheodenLeadershipUpdate
        SpecialPowerTemplate     = SpecialAbilityFakeLeadership
        UpdateModuleStartsAttack = No
        StartsPaused             = Yes
    End

    Behavior = AttributeModifierAuraUpdate ModuleTag_Leadership
        StartsActive             = No
        BonusName                = ElrondNoldorRustung
        TriggeredBy              = Upgrade_Level_5
        RefreshDelay             = 2000
        Range                    = 1
        AllowSelf                = Yes
        ObjectFilter             = NONE +ImladrisElrond +ImladrisElrond_Arnor
    End

    Behavior = WeaponSetUpgrade WeaponSetUpgradeModuleTagHadhafang
        TriggeredBy              = Upgrade_Level_1
    End

    Behavior = ModelConditionUpgrade ModuleTag_ModellRustung
        TriggeredBy              = Upgrade_Level_5
        AddConditionFlags        = USER_4
    End






    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_RestorationUnpause
        SpecialPowerTemplate        = SpecialAbilityElrondRestoration
        TriggeredBy                 = Upgrade_Level_8
    End
    Behavior = SpecialPowerTimerRefreshSpecialPower ModuleTag_RestorationRefresh
        SpecialPowerTemplate        = SpecialAbilityElrondRestoration
        StartsPaused                = Yes
        UpdateModuleStartsAttack    = No
        AffectAllies                = Yes
        AttributeModifierRange      = 150
        AttributeModifierAffects    = NONE +HERO -ElvenElrond -ArnorAranarth -ImladrisElrond -AngbandFortress -AngbandThangorodrim -TolinGaurhothFortress -UnderworldPortal -BelegostFortress -DorthonionFortress -ArmenelosFortress -GondolinTower -GondolinTower_Summoned -FormenosFortress -MenegrothFortress -TaniquetilFortress -AngbandMelkor -AngbandMelkor_WOR -TolinGaurhothTarMairon -TolinGaurhothTarMairon_WOR -AvatharUngoliant -AvatharUngoliant_WOR -ValinorManwe -ValinorManwe_WOR -DoriathMelian -DoriathMelian_WOR -ValinorEonwe -ValinorEonwe_WOR -ValinorTulkas -ValinorTulkas_WOR -ValinorAule -ValinorAule_WOR ALLIES
    End

    Behavior = PlayerHealSpecialPower ModuleTag_RestorationHeal
        SpecialPowerTemplate          = SpecialAbilityElrondRestorationHeal
        HealAffects                   = HERO
        HealAmount                    = 0.5
        HealRadius                    = 150
        HealFX                        = FX_ElrondHealSpecialPower
    End

    Behavior = AutoHealBehavior ModuleTag_ElrondHealing
        StartsActive = Yes
        HealingAmount = HERO_HEAL_AMOUNT
        HealingDelay = 1000
        StartHealingDelay = HERO_HEAL_DELAY
        HealOnlyIfNotInCombat = Yes
    End

    #include "..\..\..\includes\CaptureBuilding.inc"






    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_ElrondTornadoEnabler
        SpecialPowerTemplate        = SpecialAbilityElrondYilyaTornado
        TriggeredBy                 = Upgrade_Level_5
    End

    Behavior = OCLSpecialPower ModuleTag_OCLSpawnTornado
        StartsPaused                = Yes
        SpecialPowerTemplate        = SpecialAbilityElrondYilyaTornado
        OCL                         = OCL_ElrondVilyaSturmObject
        CreateLocation              = CREATE_AT_LOCATION
        SetModelCondition        = ModelConditionState:USER_1
        SetModelConditionTime    = 2.333
    End


    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_RingLeadership
        SpecialPowerTemplate     = SpecialAbilityFakeLeadership2
        TriggeredBy              = Upgrade_Level_1
    End

    Behavior = SpecialPowerModule ModuleTag_RingLeadershipUpdate
        SpecialPowerTemplate     = SpecialAbilityFakeLeadership2
        UpdateModuleStartsAttack = No
        StartsPaused             = Yes
    End

    Behavior = AIUpdateInterface ModuleTag_03
        AutoAcquireEnemiesWhenIdle = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate        = 500
        CanAttackWhileContained    = Yes
        AILuaEventsList            = ElrondImladrisFunctions
    End

    Behavior = CitadelSlaughterHordeContain ModuleTag_SlaughterMe
        PassengerFilter              = NONE +TheDroppedRing
        ObjectStatusOfContained      = UNSELECTABLE ENCLOSED
        ContainMax                   = 1
        AllowEnemiesInside           = No
        AllowAlliesInside            = Yes
        AllowNeutralInside           = No
        AllowOwnPlayerInsideOverride = Yes
        EnterSound                   = Elrond_Ringgemeinschaft
        EntryOffset                  = X:0.0 Y:0.0 Z:0.0
        EntryPosition                = X:0.0 Y:0.0 Z:0.0
        ExitOffset                   = X:0.0 Y:0.0 Z:0.0
        StatusForRingEntry           = HOLDING_THE_RING
        UpgradeForRingEntry          = Upgrade_RingHero
        ObjectToDestroyForRingEntry  = NONE +TheDroppedRing
        FXForRingEntry               = FX_OneRingFlare
    End

    Behavior = ModelConditionUpgrade ModulTag_RingHeroMC
        TriggeredBy         = Upgrade_RingHero Upgrade_FortressRingHero
        RequiresAllTriggers = Yes
        AddConditionFlags   = ONE_RING
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = NONE +TheDroppedRing
        ScanRange = 3000
        ScanIntervalSeconds = 0.5
    End

    Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        = 250
        TauntAndPointUpdateDelay     = 1000

        AddEmotion            =    Doom_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
        AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    Alert_Base
        AddEmotion            =    CheerForAboutToCrush_Base
     End

    LocomotorSet
        Locomotor = IsildurHumanLocomotor
        Condition = SET_NORMAL
        Speed     = NORMAL_ELVEN_FAST_MEMBER_SPEED
    End

    Behavior = PhysicsBehavior ModuleTag_04
        GravityMult            = 1.0
        ShockStandingTime    = 3000
        ShockStunnedTimeLow    = 1000
        ShockStunnedTimeHigh = 1200
    End

    Behavior = SlowDeathBehavior ModuleTag_05
        DeathTypes = ALL -FADED
        SinkDelay = 4300
        SinkRate = 3.0
        DestructionDelay = 8000
        Sound = INITIAL    ElrondVoiceDie
        DeathFlags = DEATH_1
    End

    Behavior = SquishCollide ModuleTag_06

    End

    Behavior = HitReactionBehavior HitReactionBehaviorModuleTag
        HitReactionLifeTimer1 = 7
        HitReactionLifeTimer2 = 15
        HitReactionLifeTimer3 = 10

        HitReactionThreshold1 = 0.0
        HitReactionThreshold2 = 25.0
        HitReactionThreshold3 = 50.0
    End

    Behavior = AutoHealBehavior ModuleTag_ElvenGiftHealing
        StartsActive                = No
        TriggeredBy                 = Upgrade_Level_1
        HealingAmount               = ELVEN_GIFT_REGEN_AMOUNT
        HealingDelay                = ELVEN_GIFT_REGEN_DELAY
        StartHealingDelay           = HERO_HEAL_DELAY
        HealOnlyIfNotInCombat       = Yes
    End

    Behavior = AttributeModifierUpgrade ModuleTag_ElvenGiftBonus
        TriggeredBy = Upgrade_ElvenGift
        AttributeModifier = SpellBookElvenGifts
    End





    Behavior = SpecialPowerModule ModuleTag_GeprufteStarter
         SpecialPowerTemplate           = SpecialAbilityGandalfGeprufte
         UpdateModuleStartsAttack       = Yes
         StartsPaused                   = No
    End

    Behavior = ToggleMountedSpecialAbilityUpdate ModuleTag_Geprufte
         SpecialPowerTemplate           = SpecialAbilityGandalfGeprufte
         MountedTemplate                = ImladrisElrond_RingHero
         SynchronizeTimerOnSpecialPower = SpecialAbilityPersonalFlood SpecialAbilityZornderLautwasser SpecialAbilityElrondsRatschlag SpecialAbilityElrondsLehren SpecialAbilityElrondRestoration
         UnpackTime                     = OBJECT_TOGGLE_TIME
         PreparationTime                = 0
         PackTime                       = 0
         OpacityTarget                  = .0
         AwardXPForTriggering           = 0
         IgnoreFacingCheck              = Yes
    End

    Behavior = DoCommandUpgrade Module_DoCommandUpgrade
        TriggeredBy                     = Upgrade_RingHero
        GetUpgradeCommandButtonName     = Command_SpecialAbilityGlorfindelRingSwitch
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    Behavior = AttributeModifierUpgrade ModuleTag_SwordBonus
        TriggeredBy = Upgrade_ZwillingeWaffeSchmieden
        AttributeModifier = GeschmiedeteKlingeElrondModifier
    End






    Behavior = AISpecialPowerUpdate ElrondStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate ElrondStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate ElrondHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Behavior = AISpecialPowerUpdate ElrondCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate ElrondFloodPowerAI
        CommandButtonName = Command_SpecialAbilityZornderLautwasser
        SpecialPowerAIType = AI_SPECIAL_POWER_RANGED_AOE_ATTACK
        SpecialPowerRadius = 100
    End

    Behavior = AISpecialPowerUpdate SpecialPowerElrondGiveXPAoE
        CommandButtonName = Command_SpecialAbilityElrondsRatschlag
        SpecialPowerAIType = AI_SPECIAL_POWER_GIVEXP_AOE
        SpecialPowerRadius = 30.0
    End

    Behavior = AISpecialPowerUpdate ElrondRestorationAI
        CommandButtonName = Command_SpecialAbilityElrondRestoration
        SpecialPowerAIType = AI_SPECIAL_POWER_SELFAOEHEALHEROS
    End

    Behavior = AISpecialPowerUpdate ElrondYilyaTornadoAI
        CommandButtonName = Command_SpecialAbilityElrondYilyaTornado
        SpecialPowerAIType = AI_SPECIAL_POWER_BASIC_SELF_BUFF
        SpecialPowerRadius = 150
    End


    Geometry = CYLINDER
    GeometryMajorRadius = 8.0
    GeometryMinorRadius = 8.0
    GeometryHeight = 19.2
    GeometryIsSmall = Yes
    Shadow = SHADOW_DECAL
    ShadowSizeX = 20
    ShadowSizeY = 20
    ShadowTexture = ShadowI
End



Object ImladrisElrond_Summoned

    SelectPortrait  = HPElrondMod
    ButtonImage     = HIElrondRivendell

    DescriptionStrategic = CONTROLBAR:LW_ToolTip_LeaderHero

    Draw = W3DScriptedModelDraw ModuleTag_DRAW




        DefaultModelConditionState
            Model             = euelrond_warig
            Skeleton          = EUHaldir_SKL
        End

        AnimationState          =    PACKING_TYPE_1
            StateName          =    Attacking
            Animation
                AnimationName =    EUHaldir_PNTB
                AnimationMode =    ONCE
            End
        End

        AnimationState          =    PACKING_TYPE_2
            StateName          =    Attacking
            Animation
                AnimationName =    EUHaldir_PNTB
                AnimationMode =    ONCE
            End
        End

        AnimationState          =    SPECIAL_WEAPON_ONE
            StateName          =    Attacking
            Animation
                AnimationName =    EUHaldir_TNTB
                AnimationMode =    ONCE
            End
        End



        AnimationState          = USER_3
            Animation                = Throwing Fireball
                AnimationName        = EUHaldir_PNTA
                AnimationMode        = ONCE
            End
            FXEvent            = Frame:10 Name:FX_ElrondVilyaRing
            FrameForPristineBonePositions = 27
        End


        AnimationState                        = PASSENGER
            StateName                        = STATE_Grabbed
            Animation                        = Sword
                AnimationName                = EUHaldir_FLYB
                AnimationMode                = LOOP
            End
        End


        AnimationState                        = FREEFALL
            StateName                        = STATE_Falling
            Animation                        = Sword
                AnimationName                = EUHaldir_FLYB
                AnimationMode                = LOOP
                AnimationBlendTime            = 10
                AnimationSpeedFactorRange    = 0.24 0.24
            End
        End


        AnimationState                        = STUNNED_FLAILING
            StateName                        = STATE_Fly
            Animation                        = Sword
                AnimationName                = EUHaldir_FLYB
                AnimationMode                = LOOP
                AnimationSpeedFactorRange    = 0.4 0.6
            End
            Flags                            = MAINTAIN_FRAME_ACROSS_STATES2
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                PrevAnim = CurDrawablePrevAnimation()
                if PrevState == "Ready_Bow" or PrevState == "Moving_Bow" or PrevState == "Bored_Bow"
                then
                    CurDrawableShowSubObject("arrow")
                    CurDrawableShowSubObject("arrownock")
                    return "WantSword"
                elseif PrevState == "STATE_Fly"
                then
                    if PrevAnim == "Bow" or PrevAnim == "WantSword"
                    then
                        CurDrawableShowSubObject("arrow")
                        CurDrawableShowSubObject("arrownock")
                        return "WantSword"
                    end
                end
                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
                return "Sword"
            EndScript
        End


        AnimationState                        = DYING DEATH_1 SPLATTED
            StateName                        = STATE_Dead
            Animation                        = Sword
                AnimationName                = EUHaldir_LNDB
                AnimationMode                = ONCE
            End
        End


        AnimationState                        = DYING DEATH_1
            Animation                        = Sword1
                AnimationName                = EUHaldir_DIESv5
                AnimationMode                = ONCE
            End
            Animation                        = Sword2
                AnimationName                = EUHaldir_DIESV5
                AnimationMode                = ONCE
            End
            Animation                        = WantSword
                AnimationName                = EUHaldir_LNDB
                AnimationMode                = ONCE
            End
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                PrevAnim = CurDrawablePrevAnimation()
                if PrevState == "STATE_Fly"
                then
                    CurDrawableShowSubObject("arrow")
                    CurDrawableShowSubObject("arrownock")
                    return "WantSword"
                end
                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
                if GetClientRandomNumberReal(0,2) < 1
                then
                    return "Sword1"
                else
                    return "Sword2"
                end
            EndScript
        End



        AnimationState                        = STUNNED_STANDING_UP
            StateName                        = STATE_GetUp
            Animation                        = Sword
                AnimationName                = EUHaldir_GTPSX1
                AnimationMode                = ONCE
                AnimationSpeedFactorRange    = 1.2    1.2
            End
            Animation                        = WantSword
                AnimationName                = EUHaldir_GTPB
                AnimationMode                = ONCE
            End
            Flags                            = MAINTAIN_FRAME_ACROSS_STATES4
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                PrevAnim = CurDrawablePrevAnimation()
                if PrevState == "STATE_GetUp" or PrevState == "STATE_Land"
                then
                    if PrevAnim == "Bow" or PrevAnim == "WantSword"
                    then
                        CurDrawableShowSubObject("arrow")
                        CurDrawableShowSubObject("arrownock")
                        return "WantSword"
                    end
                end
                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
                return "Sword"
            EndScript
        End


        AnimationState                        = STUNNED
            StateName                        = STATE_Land
            Animation                        = Sword
                AnimationName                = EUHaldir_LNDB
                AnimationMode                = ONCE
            End
            Animation                        = WantSword
                AnimationName                = EUHaldir_LNDA
                AnimationMode                = ONCE
            End
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                PrevAnim = CurDrawablePrevAnimation()
                if PrevState == "STATE_Fly"
                then
                    if PrevAnim == "WantSword" or PrevAnim == "Bow"
                    then
                        CurDrawableShowSubObject("arrow")
                        CurDrawableShowSubObject("arrownock")
                        return "WantSword"
                    end
                end
                Flags                        = MAINTAIN_FRAME_ACROSS_STATES3
                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
                return "Sword"
            EndScript
        End

        AnimationState                        = PARALYZED
            Animation
                AnimationName                = EUHaldir_IDLF
                AnimationMode                = LOOP
            End
        End


        AnimationState                        = FIRING_OR_PREATTACK_A
            StateName                        = Ready_Sword

            Animation                        = AttackWithSwordA
                AnimationName                = EUHaldir_ATKSV2
                AnimationMode                = ONCE
                UseWeaponTiming                = Yes
            End
            Animation                        = AttackWithSwordB
                AnimationName                = EUHaldir_ATKSV2
                AnimationMode                = ONCE
                UseWeaponTiming                = Yes
            End
            Animation                        = AttackWithSwordD
                AnimationName                = EUHaldir_ATKSV4
                AnimationMode                = ONCE
                UseWeaponTiming                = Yes
            End
            BeginScript
                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
            EndScript
        End

        AnimationState                        = FIRING_OR_PREATTACK_B
            StateName                        = Ready_Sword

            Animation                        = AttackWithSwordA
                AnimationName                = EUHaldir_ATKSV2
                AnimationMode                = ONCE
                UseWeaponTiming                = Yes
            End
            Animation                        = AttackWithSwordB
                AnimationName                = EUHaldir_ATKSV2
                AnimationMode                = ONCE
                UseWeaponTiming                = Yes
            End
            Animation                        = AttackWithSwordD
                AnimationName                = EUHaldir_ATKSV4
                AnimationMode                = ONCE
                UseWeaponTiming                = Yes
            End
            BeginScript
                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
            EndScript
        End


        AnimationState                        = MOVING
            StateName                        = Moving_Sword
            Animation
                AnimationName                = EUHaldir_RUNS
                AnimationMode                = LOOP
            End
            Flags = RANDOMSTART
            BeginScript
                CurDrawableHideSubObject("arrow")
                CurDrawableHideSubObject("arrownock")
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Moving_Bow" then CurDrawableSetTransitionAnimState("TRANS_BowToSword_Moving") end
            EndScript
        End


        AnimationState                        = MOVING BACKING_UP
            StateName                        = STATE_BackingUp
            Animation                        = Sword
                AnimationName                = EUHaldir_BAKS
                AnimationMode                = LOOP
            End
            Animation                        = WantSword
                AnimationName                = EUHaldir_BAKS
                AnimationMode                = LOOP
            End
            Flags                            = MAINTAIN_FRAME_ACROSS_STATES4
            BeginScript
                CurDrawableHideSubObject("ARROW")
                CurDrawableHideSubObject("ARROWNOCK")
                PrevAnim    = CurDrawablePrevAnimation()
                PrevState    = CurDrawablePrevAnimationState()
                if PrevState == "STATE_BackingUp"
                then
                    if PrevAnim == "Bow" or PrevAnim == "WantSword"
                    then
                        return "WantSword"
                    end
                end
                return "Sword"
            EndScript
        End


        AnimationState                        = CONTINUOUS_FIRE_MEAN
            Animation                        = HangFrameWhileCoasting
                AnimationName                = EUHaldir_ATA2
                AnimationMode                = MANUAL
                AnimationBlendTime            = 20
            End
            Flags                            = START_FRAME_LAST
            BeginScript
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("ARROWNOCK")
                if CurDrawablePrevAnimationState() == "STATE_Firing" then CurDrawableAllowToContinue() end
            EndScript
        End
        AnimationState                        = CONTINUOUS_FIRE_SLOW
            StateName                        = Ready_Bow
            Animation                        = PutAwayArrow
                AnimationName                = EUHaldir_ATA3
                AnimationMode                = ONCE
            End
            BeginScript
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("ARROWNOCK")
            EndScript
        End


        AnimationState                        = ATTACKING
            StateName                        = Ready_Sword
            Animation                        = Alert_1
                AnimationName                = EUHaldir_IDLST1
                AnimationMode                = LOOP
            End
            BeginScript
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
                if Prev == "Bored_Sword" then CurDrawableSetTransitionAnimState("TRANS_BR_Sword") end
                if Prev == "Selected_Bow" or Prev == "Moving_Bow" or Prev == "Ready_Bow" or Prev == "Bored_Bow" or PrevAnim == "WantSword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BowToSword_Ready")
                end
            EndScript
        End


        AnimationState                        = ENGAGED
            StateName                        = Ready_Sword
            Animation                        = Alert_1
                AnimationName                = EUHaldir_IDLST1
                AnimationMode                = LOOP
            End
            BeginScript
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
                if Prev == "Bored_Sword"        then CurDrawableSetTransitionAnimState("TRANS_BR_Sword")            end
                if Prev == "Selected_Bow" or Prev == "Moving_Bow" or Prev == "Ready_Bow" or Prev == "Bored_Bow" or PrevAnim == "WantSword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BowToSword_Ready")
                end
            EndScript
        End


        AnimationState                        = EMOTION_ALERT
            StateName                        = Ready_Sword
            Animation                        = Alert_1
                AnimationName                = EUHaldir_IDLST1
                AnimationMode                = LOOP
            End
            BeginScript
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
                if Prev == "Bored_Sword" then CurDrawableSetTransitionAnimState("TRANS_BR_Sword") end
                if Prev == "Selected_Bow" or Prev == "Moving_Bow" or Prev == "Ready_Bow" or Prev == "Bored_Bow" or PrevAnim == "WantSword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BowToSword_Ready")
                end
            EndScript
        End


        AnimationState                        = EMOTION_CELEBRATING
            StateName                        = STATE_Emotion_Sword
            Animation                        = Sword
                AnimationName                = EUHaldir_CHRS
                AnimationMode                = ONCE
            End
            Animation                        = Sword2
                AnimationName                = EUHaldir_CHRS
                AnimationMode                = ONCE
            End
            Flags                            = MAINTAIN_FRAME_ACROSS_STATES RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("arrow")
                CurDrawableHideSubObject("arrownock")

                if PrevState == "STATE_Emotion_Bow"
                then
                    CurDrawableAllowToContinue()
                    if( CurDrawablePrevAnimFraction() > .89 )
                    then
                        CurDrawableSetTransitionAnimState("TRANS_BowToSword_Ready")
                    end
                elseif PrevState == "STATE_Emotion_Sword"
                then
                    CurDrawableAllowToContinue()
                elseif PrevState == "Bored_Sword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BR_Sword")
                end
            EndScript
        End


        AnimationState                        = EMOTION_TAUNTING
            StateName                        = STATE_Emotion_Sword
            Animation                        = Sword
                AnimationName                = EUHaldir_TNTB
                AnimationMode                = ONCE
            End
            Animation                        = Sword2
                AnimationName                = EUHaldir_TNTB
                AnimationMode                = ONCE
            End
            Flags                            = RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("arrow")
                CurDrawableHideSubObject("arrownock")
                if PrevState == "STATE_Emotion_Bow"
                then
                    CurDrawableAllowToContinue()
                    if( CurDrawablePrevAnimFraction() > .89 )
                    then
                        CurDrawableSetTransitionAnimState("TRANS_BowToSword_Ready")
                    end
                elseif PrevState == "STATE_Emotion_Sword"
                    then
                        CurDrawableAllowToContinue()
                elseif PrevState == "Bored_Sword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BR_Sword")
                end
            EndScript
        End


        AnimationState                        = EMOTION_POINTING
            StateName                        = STATE_Emotion_Sword
            Animation                        = Sword
                AnimationName                = EUHaldir_PNTB
                AnimationMode                = ONCE
            End
            Animation                        = Sword2
                AnimationName                = EUHaldir_PNTB
                AnimationMode                = ONCE
            End
            Flags                            = MAINTAIN_FRAME_ACROSS_STATES RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("arrow")
                CurDrawableHideSubObject("arrownock")

                if PrevState == "STATE_Emotion_Bow"
                then
                    CurDrawableAllowToContinue()
                    if( CurDrawablePrevAnimFraction() > .89 )
                    then
                        CurDrawableSetTransitionAnimState("TRANS_BowToSword_Ready")
                    end
                elseif PrevState == "STATE_Emotion_Sword"
                then
                    CurDrawableAllowToContinue()
                elseif PrevState == "Bored_Sword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BR_Sword")
                end
            EndScript
        End


        AnimationState                        = HIT_REACTION HIT_LEVEL_1
            StateName                        = Bored_Sword
            Animation
                AnimationName                = EUHaldir_HITE
                AnimationMode                = ONCE
            End
        End


        AnimationState                        = RAISING_FLAG
            StateName                        = STATE_Emotion_Sword
            Animation                        = Sword
                AnimationName                = EUHaldir_CHRS
                AnimationMode                = ONCE
            End
            Animation                        = Sword2
                AnimationName                = EUHaldir_CHRS
                AnimationMode                = ONCE
            End
            Flags                            = RESTART_ANIM_WHEN_COMPLETE
        End

        AnimationState                        = SELECTED
            StateName                        = Selected_Sword
            Animation                        = ATNA
                AnimationName                = EUHaldir_ATNS
                AnimationMode                = LOOP
            End
            BeginScript
                CurDrawableHideSubObject("ARROW")
                CurDrawableHideSubObject("ARROWNOCK")
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Emotion_Bow" or Prev == "STATE_Emotion_Sword" then CurDrawableAllowToContinue() end
                if Prev == "Bored_Sword" then CurDrawableSetTransitionAnimState("TRANS_BoredToSelected_Sword") end
                if Prev == "Ready_Sword" then CurDrawableSetTransitionAnimState("TRANS_ReadyToSelected_Sword") end
                if Prev == "Selected_Bow" or Prev == "Moving_Bow" or Prev == "Ready_Bow" or Prev == "Bored_Bow" or PrevAnim == "WantSword" or PrevAnim == "EUHaldir_STHB"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BowToSword_Selected")
                end
            EndScript
        End


        IdleAnimationState
            StateName                        = Bored_Sword
            Animation                        = Idle_Sword1
                AnimationName                = EUHaldir_IDLF
                AnimationMode                = ONCE
            End
            Animation                        = Idle_Sword2
                AnimationName                = EUHaldir_IDLF
                AnimationMode                = ONCE
            End
            Animation                        = Idle_Sword3
                AnimationName                = EUHaldir_IDLF
                AnimationMode                = ONCE
            End
            Animation                        = IdleNoFidget
                AnimationName                = EUHaldir_IDLF
                AnimationMode                = ONCE
                AnimationPriority            = 20
            End
            Animation                        = IdleNoFidget2
                AnimationName                = EUHaldir_IDLF
                AnimationMode                = ONCE
                AnimationPriority            = 0
            End
            Flags                            = RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                CurDrawableHideSubObject("ARROW")
                CurDrawableHideSubObject("ARROWNOCK")
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                if Prev == "TRANS_SelectedToBored_Sword" or Prev == "TRANS_RB_Sword" then return "IdleNoFidget" end
                if Prev == "Selected_Sword" then CurDrawableSetTransitionAnimState("TRANS_SelectedToBored_Sword") end
                if Prev == "Ready_Sword" then CurDrawableSetTransitionAnimState("TRANS_RB_Sword") end
                if Prev == "Selected_Bow" or Prev == "Moving_Bow" or Prev == "Ready_Bow" or Prev == "Bored_Bow" or PrevAnim == "WantSword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BowToSword_Selected")
                end
            EndScript
        End




        TransitionState                        = TRANS_BoredToSelected_Bow
            Animation
                AnimationName                = EUHaldir_ATNB
                AnimationMode                = ONCE
                AnimationBlendTime            = 10
            End
        End


        TransitionState                        = TRANS_SelectedToReady_Bow
            Animation                        = ATNE
                AnimationName                = EUHaldir_IDLB
                AnimationMode                = ONCE
                AnimationBlendTime            = 10
            End
        End


        TransitionState                        = TRANS_SelectedToBored_Bow
            Animation
                AnimationName                = EUHaldir_ATNB
                AnimationMode                = ONCE_BACKWARDS
            End
            Flags                            = START_FRAME_LAST
        End


        TransitionState                        = TRANS_RS_Bow
            Animation                        = ATNF
                AnimationName                = EUHaldir_IDLB
                AnimationMode                = ONCE_BACKWARDS
                AnimationBlendTime            = 10
            End
            Flags                            = START_FRAME_LAST
        End


        TransitionState                        = TRANS_BR_Bow
            Animation                        = IDLB
                AnimationName                = EUHaldir_IDLST1
                AnimationMode                = ONCE
                AnimationBlendTime            = 20
            End
        End


        TransitionState                        = TRANS_RB_Bow
            Animation                        = IDLD
                AnimationName                = EUHaldir_IDLB
                AnimationMode                = ONCE
                AnimationBlendTime            = 20
            End
        End


        TransitionState                    = TRANS_BoredToSelected_Sword
            Animation                    = ATNA
                AnimationName            = EUHaldir_ATNA
                AnimationMode            = ONCE
            End
        End


        TransitionState                    = TRANS_SR_Sword
            Animation                    = ATNC
                AnimationName            = EUHaldir_STHA
                AnimationMode            = ONCE
            End
        End


        TransitionState                    = TRANS_SelectedToBored_Sword
            Animation                    = ATNA
                AnimationName            = EUHaldir_ATNA
                AnimationMode            = ONCE_BACKWARDS
            End
            Flags                        = START_FRAME_LAST
        End


        TransitionState                    = TRANS_ReadyToSelected_Sword
            Animation                    = ATNC
                AnimationName            = EUHaldir_IDLST1
                AnimationMode            = ONCE_BACKWARDS
                AnimationBlendTime        = 20
            End
            Flags                        = START_FRAME_LAST
        End


        TransitionState                    = TRANS_BR_Sword
            Animation                    = ATNS
                AnimationName            = EUHaldir_STHA
                AnimationMode            = ONCE
                AnimationBlendTime        = 20
            End
        End


        TransitionState                    = TRANS_RB_Sword
            Animation                    = IDLG
                AnimationName            = EUHaldir_STHA
                AnimationMode            = ONCE
                AnimationBlendTime        = 20
            End
        End



        TransitionState                    = TRANS_SwordToBow_Moving
            Animation                    = DrawBow
                AnimationName            = EUHaldir_STHC
                AnimationMode            = ONCE
            End
        End


        TransitionState                    = TRANS_BowToSword_Moving
            Animation                    = DrawSword
                AnimationName            = EUHaldir_STHD
                AnimationMode            = ONCE
            End
        End


        TransitionState                    = TRANS_BowToSword_Ready
            Animation                    = DrawSwords
                AnimationName            = EUHaldir_STHA
                AnimationMode            = ONCE
            End
        End


        TransitionState                    = TRANS_SwordToBow_Ready
            Animation                    = DrawBow
                AnimationName            = EUHaldir_STHB
                AnimationMode            = ONCE
            End
        End


        TransitionState                    = TRANS_BowToSword_Selected
            Animation                    = DrawSwords
                AnimationName            = EUHaldir_STHA
                AnimationMode            = ONCE
            End
        End


        TransitionState                    = TRANS_SwordToBow_Selected
            Animation                    = DrawBow
                AnimationName            = EUHaldir_STHB
                AnimationMode            = ONCE
            End
        End
    End



    Draw = W3DScriptedModelDraw Icon
        ModelConditionState = NONE
            Model           = bbox
        End
    End

    #include "..\..\..\includes\StunDrawModuleSmall.inc"


    Side = Imladris
    EditorSorting = UNIT
    ThreatLevel = ELROND_THREAT
    ThingClass = CHARACTER_UNIT
    TransportSlotCount = TRANSPORTSLOTCOUNT_HERO
    DisplayMeleeDamage  = STRONG_HERO_DAMAGE
    BuildCost = ELRONDDAG_COST
    ; BuildTime = SILMARIL_HERO_BUILDTIME
	BuildTime = 1
    IsTrainable = No
    CommandPoints = 0
    CommandSet = ElrondMODCommandSet_Summoned

    MaxSimultaneousOfType                 = 1

    ; WeaponSet
        ; Conditions        = None
        ; Weapon            = PRIMARY    ElrondNewSword
        ; AutoChooseSources = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    ; End

    WeaponSet
        ; Conditions        = SPECIAL_ONE
        Weapon            = PRIMARY    ElrondWaterSword
        ; Weapon            = SECONDARY  ElrondNewSword
        ; OnlyAgainst       = SECONDARY  STRUCTURE BLOCKING_GATE
        AutoChooseSources = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End

    ArmorSet
        Conditions      = None
        Armor           = StrongHeroArmor
        DamageFX        = NormalDamageFX
    End

    VisionRange = 300
    ShroudClearingRange = 400

    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = 200
    VisionBonusPercentPerFoot = 1.0%


    BountyValue = ELVEN_ELROND_BOUNTY_VALUE
    RecruitText = CONTROLBAR:ElrondRecruit
    ReviveText  = CONTROLBAR:ElrondRevive
    Hotkey      = CONTROLBAR:ElvenElrondHotkey
    DisplayName = OBJECT:ElvenElrond
    CrushableLevel = 3



    AutoResolveUnitType = AutoResolveUnit_Hero
    AutoResolveCombatChain = AutoResolve_HeroCombatChain

    AutoResolveBody = AutoResolve_ElrondBody

    AutoResolveArmor
        Armor = AutoResolve_ElrondArmor
    End

    AutoResolveWeapon
        Weapon = AutoResolve_ElrondWeapon
    End

    AutoResolveLeadership = AutoResolve_ElrondBonus




    VoiceCreated                                  = ElrondModVoiceCreate
    VoiceFullyCreated                             = ElrondModVoiceCreate
    VoiceAttack                                   = ElrondModVoiceAttack
    VoiceAttackCharge                             = ElrondModVoiceAttack
    VoiceAttackMachine                            = ElrondModVoiceAttack
    VoiceAttackStructure                          = ElrondModVoiceAttack
    VoiceFear                                     = ElrondModVoiceHelp
    VoiceGuard                                    = ElrondModVoiceMove
    VoiceMove                                     = ElrondModVoiceMove
    VoiceMoveToCamp                               = ElrondModVoiceMove
    VoicePriority                                 = 95
    VoiceRetreatToCastle                          = ElrondVoiceRetreat
    VoiceSelect                                   = ElrondModVoiceSelect
    VoiceSelectBattle                             = ElrondModVoiceSelect

    SoundImpact                                   = ImpactHorse

    UnitSpecificSounds
        VoiceEnterUnitElvenTransportShip          = ElrondModVoiceMove
        VoiceGarrison                             = ElrondModVoiceMove
        VoiceInitiateCaptureBuilding              = ElrondModVoiceMove
    End


    CrowdResponseKey = ElfHero

    #include "..\..\..\includes\StandardUnitEvaEvents.inc"
    EvaEventDieOwner            = ElrondDie


    Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
        Key = Humanoid_Male Elf_Male Unit Infantry Hero

    End

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap                    = 800
        AnimationSound                        = Sound:ArrowDrawBow                    Animation:EUHaldir_SKL.EUHaldir_ATA1    Frames:6
        AnimationSound                        = Sound:ArrowDrawBow                    Animation:EUHaldir_SKL.EUHaldir_ATA2    Frames:18
        AnimationSound                        = Sound:SwordShingClean1                Animation:EUHaldir_SKL.EUHaldir_STHA     Frames:24
        AnimationSound                        = Sound:SwordIntoScabbard1              Animation:EUHaldir_SKL.EUHaldir_STHB     Frames:9
        AnimationSound                        = Sound:WeaponSwitchBow                 Animation:EUHaldir_SKL.EUHaldir_STHB     Frames:15
        AnimationSound                        = Sound:SwordShingClean1                Animation:EUHaldir_SKL.EUHaldir_STHC     Frames:20
        AnimationSound                        = Sound:SwordIntoScabbard1              Animation:EUHaldir_SKL.EUHaldir_STHD     Frames:5
        AnimationSound                        = Sound:WeaponSwitchBow                 Animation:EUHaldir_SKL.EUHaldir_STHD     Frames:8
        AnimationSound                        = Sound:SwordShingClean1                Animation:EUHaldir_SKL.EUHaldir_RUNC     Frames:14
        AnimationSound                        = Sound:SwordIntoScabbard1              Animation:EUHaldir_SKL.EUHaldir_RUNT     Frames:4
        AnimationSound                        = Sound:WeaponSwitchBow                 Animation:EUHaldir_SKL.EUHaldir_RUNT     Frames:16
        AnimationSound                        = Sound:BodyFallSoldier                 Animation:EUHaldir_SKL.EUHaldir_LNDA     Frames:9
        AnimationSound                        = Sound:BodyFallSoldier                 Animation:EUHaldir_SKL.EUHaldir_LNDB     Frames:1
        AnimationSound                        = Sound:BodyFallGenericNoArmor          Animation:EUHaldir_SKL.EUHaldir_DIEB     Frames:82
        AnimationSound                        = Sound:BodyFallSoldier                 Animation:EUHaldir_SKL.EUHaldir_DIEBV5   Frames:25
        AnimationSound                        = Sound:BodyFallSoldier                 Animation:EUHaldir_SKL.EUHaldir_DIESV4   Frames:26
        AnimationSound                        = Sound:BodyFallGenericNoArmor          Animation:EUHaldir_SKL.EUHaldir_DIESV5   Frames:100
    End



    RadarPriority = UNIT
    PathfindDiameter = 40.0
    CamouflageDetectionMultiplier = CAMOUFLAGE_DETECTION_DISTANCE_MEDIUM

    Body = RespawnBody ModuleTag_RespawnBody
        CheerRadius                  = EMOTION_CHEER_RADIUS
        MaxHealth                    = ELRONDDAG_HEALTH
        PermanentlyKilledByFilter    = NONE
        DodgePercent                 = HERO_DODGE_PERCENT
    End

    KindOf = HERO PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY ATTACK_NEEDS_LINE_OF_SIGHT PATH_THROUGH_EACH_OTHER SCORE HEAVY_MELEE_HITTER SUMMONED

    Behavior = ExperienceLevelCreate ModuleTag_MPLevelBonus
        LevelToGrant = 7
    End

    Behavior = RespawnUpdate ModuleTag_RespawnUpdate
    End

    Behavior = LifetimeUpdate ModuleTag_LifetimeUpdate
        MinLifetime        = 180000
        MaxLifetime        = 180000
        DeathType          = FADED
    End

    #include "..\..\..\includes\DefaultInvisibilityUpdate.inc"

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = Hero
    End

    Behavior = AIUpdateInterface ModuleTag_03
        AutoAcquireEnemiesWhenIdle = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate        = 500
        CanAttackWhileContained    = Yes
        AILuaEventsList            = ElrondImladrisFunctions
    End


    Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    250
        TauntAndPointUpdateDelay    =    1000

        AddEmotion            =    Doom_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
        AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    Alert_Base
        AddEmotion            =    CheerForAboutToCrush_Base
     End

    LocomotorSet
        Locomotor = IsildurHumanLocomotor
        Condition = SET_NORMAL
        Speed     = NORMAL_ELVEN_FAST_MEMBER_SPEED
    End

    Behavior = PhysicsBehavior ModuleTag_04
        GravityMult            = 1.0
        ShockStandingTime    = 3000
        ShockStunnedTimeLow    = 1000
        ShockStunnedTimeHigh = 1200
    End

    Behavior = SlowDeathBehavior ModuleTag_05
        DeathTypes = ALL -FADED
        SinkDelay = 4300
        SinkRate = 3.0
        DestructionDelay = 8000
        Sound = INITIAL    ElrondVoiceDie
        DeathFlags = DEATH_1
    End

    Behavior = SlowDeathBehavior ModuleTag_FadeDeath
        DeathTypes = NONE +FADED
        FadeDelay = 0
        FadeTime = 2500
        DestructionDelay = 2500
        Sound = INITIAL SpellGenericUnsummonFasterMS
        DeathFlags = DEATH_2
    End

    Behavior = SquishCollide ModuleTag_06

    End


    Behavior = HitReactionBehavior HitReactionBehaviorModuleTag
        HitReactionLifeTimer1 = 7
        HitReactionLifeTimer2 = 15
        HitReactionLifeTimer3 = 10

        HitReactionThreshold1 = 0.0
        HitReactionThreshold2 = 25.0
        HitReactionThreshold3 = 50.0
    End

    Behavior = AutoHealBehavior ModuleTag_ElvenGiftHealing
        StartsActive                = No
        TriggeredBy                 = Upgrade_Level_1
        HealingAmount               = ELVEN_GIFT_REGEN_AMOUNT
        HealingDelay                = ELVEN_GIFT_REGEN_DELAY
        StartHealingDelay           = HERO_HEAL_DELAY
        HealOnlyIfNotInCombat       = Yes
    End

    Behavior = AttributeModifierUpgrade ModuleTag_ElvenGiftBonus
        TriggeredBy = Upgrade_ElvenGift
        AttributeModifier = SpellBookElvenGifts
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End





    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_FactionLeaderLeadershipStart
        SpecialPowerTemplate    = SpecialAbilityFakeLeadership3
    End

    Behavior = SpecialPowerModule ModuleTag_FactionLeaderLeadershipUpdate
        SpecialPowerTemplate        = SpecialAbilityFakeLeadership3
        UpdateModuleStartsAttack    = No
        StartsPaused                = No
    End

    Behavior = AttributeModifierAuraUpdate ModuleTag_FactionLeaderLeadership
        StartsActive     = Yes
        BonusName        = FactionLeaderGlobalLeadership
        RefreshDelay     = 2000
        Range            = 625
        ObjectFilter     = ALL -HERO -MACHINE -SHIP -DOZER -STRUCTURE ALLIES
    End





    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_ElrondsErfahrungsLeadership
        SpecialPowerTemplate      = SpecialAbilityFakeLeadership3
        TriggeredBy               = Upgrade_Level_1
    End

    Behavior = SpecialPowerModule ModuleTag_ElrondsErfahrungsLeadershipUpdate
        SpecialPowerTemplate      = SpecialAbilityFakeLeadership3
        UpdateModuleStartsAttack  = No
        StartsPaused              = Yes
    End
    Behavior = AttributeModifierAuraUpdate ModuleTag_Leadership2
        StartsActive              = No
        BonusName                 = ElrondLeadershipSpell
        TriggeredBy               = Upgrade_Level_1
        RefreshDelay              = 2000
        Range                     = 200

        ObjectFilter              = ANY +GondorIsildur_Mod_Summoned +GondorAnarion_Summoned +GondorElendil_Summoned +BruchtalGilGalad_Summoned +ArnorGilGalad_Summoned ALLIES
    End







    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_RestorationUnpause
        SpecialPowerTemplate        = SpecialAbilityElrondRestoration
        TriggeredBy                 = Upgrade_Level_1
    End

    Behavior = SpecialPowerTimerRefreshSpecialPower ModuleTag_RestorationRefresh
        SpecialPowerTemplate        = SpecialAbilityElrondRestoration
        StartsPaused                = Yes
        UpdateModuleStartsAttack    = No
        AffectAllies                = Yes
        AttributeModifierRange      = 150
        AttributeModifierAffects    = NONE +HERO +GondorIsildur_Mod_Summoned +GondorAnarion_Summoned +GondorElendil_Summoned +BruchtalGilGalad_Summoned +ArnorGilGalad_Summoned  -AngbandFortress -AngbandThangorodrim -TolinGaurhothFortress -UnderworldPortal -BelegostFortress -DorthonionFortress -ArmenelosFortress -GondolinTower -GondolinTower_Summoned -FormenosFortress -MenegrothFortress -TaniquetilFortress -AngbandMelkor -AngbandMelkor_WOR -TolinGaurhothTarMairon -TolinGaurhothTarMairon_WOR -AvatharUngoliant -AvatharUngoliant_WOR -ValinorManwe -ValinorManwe_WOR -DoriathMelian -DoriathMelian_WOR -ValinorEonwe -ValinorEonwe_WOR -ValinorTulkas -ValinorTulkas_WOR -ValinorAule -ValinorAule_WOR ALLIES


    End

    Behavior = PlayerHealSpecialPower ModuleTag_RestorationHeal
        SpecialPowerTemplate        = SpecialAbilityElrondRestorationHeal
        HealAffects                 = HERO
        HealAmount                  = 0.5
        HealRadius                  = 150
        HealFX                      = FX_ElrondHealSpecialPower
    End





    Behavior = AISpecialPowerUpdate ElrondStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate ElrondStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate ElrondHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Behavior = AISpecialPowerUpdate ElrondCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate ElrondFloodPowerAI
        CommandButtonName = Command_SpecialAbilityZornderLautwasser
        SpecialPowerAIType = AI_SPECIAL_POWER_RANGED_AOE_ATTACK
        SpecialPowerRadius = 100
    End

    Behavior = AISpecialPowerUpdate SpecialPowerElrondGiveXPAoE
        CommandButtonName = Command_SpecialAbilityElrondsRatschlag
        SpecialPowerAIType = AI_SPECIAL_POWER_GIVEXP_AOE
        SpecialPowerRadius = 30.0
    End

    Behavior = AISpecialPowerUpdate ElrondRestorationAI
        CommandButtonName = Command_SpecialAbilityElrondRestoration
        SpecialPowerAIType = AI_SPECIAL_POWER_SELFAOEHEALHEROS
    End

    Behavior = AISpecialPowerUpdate ElrondYilyaTornadoAI
        CommandButtonName = Command_SpecialAbilityElrondYilyaTornado
        SpecialPowerAIType = AI_SPECIAL_POWER_BASIC_SELF_BUFF
        SpecialPowerRadius = 150
    End


    Behavior = AISpecialPowerUpdate ElrondRestorationSummonAI
        CommandButtonName = Command_SpecialAbilityElrondRestoration_Spell
        SpecialPowerAIType = AI_SPECIAL_POWER_SELFAOEHEALHEROS
    End


    Geometry = CYLINDER
    GeometryMajorRadius = 8.0
    GeometryMinorRadius = 8.0
    GeometryHeight = 19.2
    GeometryIsSmall = Yes
    Shadow = SHADOW_DECAL
    ShadowSizeX = 20
    ShadowSizeY = 20
    ShadowTexture = ShadowI
End



Object ImladrisElrond_RingHero

    SelectPortrait  = HPElrondMod
    ButtonImage     = HIElrondRivendell

    DescriptionStrategic = CONTROLBAR:LW_ToolTip_Elrond

    Draw = W3DScriptedModelDraw ModuleTag_DRAW

        DefaultModelConditionState
            Model             = euelrond_warig
            Skeleton          = EUHaldir_SKL
            ParticleSysBone   = B_SWORDBONE ElrondWaterKlingenFX FollowBone:Yes
        End


        AnimationState          =    PACKING_TYPE_1
            StateName          =    Attacking
            Animation
                AnimationName =    EUHaldir_PNTB
                AnimationMode =    ONCE
            End
        End

        AnimationState          =    PACKING_TYPE_2
            StateName          =    Attacking
            Animation
                AnimationName =    EUHaldir_PNTB
                AnimationMode =    ONCE
            End
        End

        AnimationState          =    SPECIAL_WEAPON_ONE
            StateName          =    Attacking
            Animation
                AnimationName =    EUHaldir_CHRS
                AnimationMode =    ONCE
            End
        End


        AnimationState          = USER_3
            Animation                = Throwing Fireball
                AnimationName        = EUHaldir_PNTA
                AnimationMode        = ONCE
            End
            FXEvent            = Frame:10 Name:FX_ElrondVilyaRing
            FrameForPristineBonePositions = 27
        End

        AnimationState                        = PASSENGER WEAPONSET_TOGGLE_1
            StateName                        = STATE_Grabbed
            Animation                        = Bow
                AnimationName                = EUHaldir_FLYA
                AnimationMode                = LOOP
            End
        End
        AnimationState                        = PASSENGER
            StateName                        = STATE_Grabbed
            Animation                        = Sword
                AnimationName                = EUHaldir_FLYB
                AnimationMode                = LOOP
            End
        End


        AnimationState                        = FREEFALL WEAPONSET_TOGGLE_1
            StateName                        = STATE_Falling
            Animation                        = Bow
                AnimationName                = EUHaldir_FLYA
                AnimationMode                = LOOP
                AnimationBlendTime            = 10
                AnimationSpeedFactorRange    = 0.5    0.5
            End
        End
        AnimationState                        = FREEFALL
            StateName                        = STATE_Falling
            Animation                        = Sword
                AnimationName                = EUHaldir_FLYB
                AnimationMode                = LOOP
                AnimationBlendTime            = 10
                AnimationSpeedFactorRange    = 0.24 0.24
            End
        End


        AnimationState                        = STUNNED_FLAILING WEAPONSET_TOGGLE_1
            StateName                        = STATE_Fly
            Animation
                AnimationName                = EUHaldir_FLYA
                AnimationMode                = LOOP
                AnimationSpeedFactorRange    = 0.4 0.6
            End
            Flags                            = MAINTAIN_FRAME_ACROSS_STATES2
        End
        AnimationState                        = STUNNED_FLAILING
            StateName                        = STATE_Fly
            Animation                        = Sword
                AnimationName                = EUHaldir_FLYB
                AnimationMode                = LOOP
                AnimationSpeedFactorRange    = 0.4 0.6
            End
            Flags                            = MAINTAIN_FRAME_ACROSS_STATES2
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                PrevAnim = CurDrawablePrevAnimation()
                if PrevState == "Ready_Bow" or PrevState == "Moving_Bow" or PrevState == "Bored_Bow"
                then
                    CurDrawableShowSubObject("arrow")
                    CurDrawableShowSubObject("arrownock")
                    return "WantSword"
                elseif PrevState == "STATE_Fly"
                then
                    if PrevAnim == "Bow" or PrevAnim == "WantSword"
                    then
                        CurDrawableShowSubObject("arrow")
                        CurDrawableShowSubObject("arrownock")
                        return "WantSword"
                    end
                end
                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
                return "Sword"
            EndScript
        End


        AnimationState                        = DYING DEATH_1 SPLATTED WEAPONSET_TOGGLE_1
            StateName                        = STATE_Dead
            Animation                        = Bow
                AnimationName                = EUHaldir_LNDA
                AnimationMode                = ONCE
            End
        End
        AnimationState                        = DYING DEATH_1 SPLATTED
            StateName                        = STATE_Dead
            Animation                        = Sword
                AnimationName                = EUHaldir_LNDB
                AnimationMode                = ONCE
            End
        End


        AnimationState                        = DYING DEATH_1 WEAPONSET_TOGGLE_1
            Animation                        = Bow1
                AnimationName                = EUHaldir_DIEBV5
                AnimationMode                = ONCE
            End
            Animation                        = Bow2
                AnimationName                = EUHaldir_DIEBV5
                AnimationMode                = ONCE
            End
            Animation                        = WantBow
                AnimationName                = EUHaldir_LNDA
                AnimationMode                = ONCE
            End
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                PrevAnim = CurDrawablePrevAnimation()
                if PrevState == "STATE_Fly"
                then
                    CurDrawableHideSubObject("ArrowNock")
                    CurDrawableHideSubObject("arrow")
                    return "WantBow"
                end
                if GetClientRandomNumberReal(0,2) < 1
                then
                    CurDrawableShowSubObject("arrow")
                    CurDrawableShowSubObject("arrownock")
                    return "Bow1"
                else
                    CurDrawableShowSubObject("arrow")
                    CurDrawableShowSubObject("arrownock")
                    return "Bow2"
                end
            EndScript
        End
        AnimationState                        = DYING DEATH_1
            Animation                        = Sword1
                AnimationName                = EUHaldir_DIESv5
                AnimationMode                = ONCE
            End
            Animation                        = Sword2
                AnimationName                = EUHaldir_DIESV5
                AnimationMode                = ONCE
            End
            Animation                        = WantSword
                AnimationName                = EUHaldir_LNDB
                AnimationMode                = ONCE
            End
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                PrevAnim = CurDrawablePrevAnimation()
                if PrevState == "STATE_Fly"
                then
                    CurDrawableShowSubObject("arrow")
                    CurDrawableShowSubObject("arrownock")
                    return "WantSword"
                end
                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
                if GetClientRandomNumberReal(0,2) < 1
                then
                    return "Sword1"
                else
                    return "Sword2"
                end
            EndScript
        End


        AnimationState                        = DYING DEATH_2 WEAPONSET_TOGGLE_1
            Animation                        = FadeOut
                AnimationName                = EUHaldir_DIEBV5
                AnimationMode                = ONCE
            End
        End
        AnimationState                        = DYING DEATH_2
            Animation                        = FadeOut
                AnimationName                = EUHaldir_DIESV5
                AnimationMode                = LOOP
            End
        End


        AnimationState                        = STUNNED_STANDING_UP WEAPONSET_TOGGLE_1
            StateName                        = STATE_GetUp
            Animation                        = Bow
                AnimationName                = EUHaldir_GTPB
                AnimationMode                = ONCE
                AnimationSpeedFactorRange    = 1.42 1.42
            End
            Animation                        = WantBow
                AnimationName                = EUHaldir_GTPSX1
                AnimationMode                = ONCE
            End
            Flags                        = MAINTAIN_FRAME_ACROSS_STATES4
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                PrevAnim = CurDrawablePrevAnimation()
                if PrevState == "STATE_GetUp" or PrevState == "STATE_Land"
                then
                    if PrevAnim == "WantBow" or PrevAnim == "Sword"
                    then
                        CurDrawableHideSubObject("ArrowNock")
                        CurDrawableHideSubObject("arrow")
                        return "WantBow"
                    end
                else
                    CurDrawableShowSubObject("arrow")
                    CurDrawableShowSubObject("arrownock")
                    return "Bow"
                end
            EndScript
        End
        AnimationState                        = STUNNED_STANDING_UP
            StateName                        = STATE_GetUp
            Animation                        = Sword
                AnimationName                = EUHaldir_GTPSX1
                AnimationMode                = ONCE
                AnimationSpeedFactorRange    = 1.2    1.2
            End
            Animation                        = WantSword
                AnimationName                = EUHaldir_GTPB
                AnimationMode                = ONCE
            End
            Flags                            = MAINTAIN_FRAME_ACROSS_STATES4
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                PrevAnim = CurDrawablePrevAnimation()
                if PrevState == "STATE_GetUp" or PrevState == "STATE_Land"
                then
                    if PrevAnim == "Bow" or PrevAnim == "WantSword"
                    then
                        CurDrawableShowSubObject("arrow")
                        CurDrawableShowSubObject("arrownock")
                        return "WantSword"
                    end
                end
                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
                return "Sword"
            EndScript
        End


        AnimationState                        = STUNNED WEAPONSET_TOGGLE_1
            StateName                        = STATE_Land
            Animation                        = Bow
                AnimationName                = EUHaldir_LNDA
                AnimationMode                = ONCE
            End
            Animation                        = WantBow
                AnimationName                = EUHaldir_LNDB
                AnimationMode                = ONCE
            End
            Flags                            = MAINTAIN_FRAME_ACROSS_STATES3
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                PrevAnim = CurDrawablePrevAnimation()
                if PrevState == "STATE_Fly"
                then
                    if PrevAnim == "WantBow" or PrevAnim == "Sword"
                    then
                        CurDrawableHideSubObject("ArrowNock")
                        CurDrawableHideSubObject("arrow")
                        return "WantBow"
                    end
                end
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("arrownock")
                return "Bow"
            EndScript
        End
        AnimationState                        = STUNNED
            StateName                        = STATE_Land
            Animation                        = Sword
                AnimationName                = EUHaldir_LNDB
                AnimationMode                = ONCE
            End
            Animation                        = WantSword
                AnimationName                = EUHaldir_LNDA
                AnimationMode                = ONCE
            End
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                PrevAnim = CurDrawablePrevAnimation()
                if PrevState == "STATE_Fly"
                then
                    if PrevAnim == "WantSword" or PrevAnim == "Bow"
                    then
                        CurDrawableShowSubObject("arrow")
                        CurDrawableShowSubObject("arrownock")
                        return "WantSword"
                    end
                end
                Flags                        = MAINTAIN_FRAME_ACROSS_STATES3
                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
                return "Sword"
            EndScript
        End

        AnimationState                        = PARALYZED
            Animation
                AnimationName                = EUHaldir_IDLF
                AnimationMode                = LOOP
            End
        End


        AnimationState                        = FIRING_OR_PREATTACK_A WEAPONSET_TOGGLE_1
            StateName                        = Attacking_Bow
            Animation
                AnimationName                = EUHaldir_ATA2
                AnimationMode                = ONCE
                UseWeaponTiming                = Yes
                AnimationBlendTime            = 20
            End
            BeginScript
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("ArrowNock")
            EndScript
        End
        AnimationState                        = FIRING_OR_PREATTACK_A
            StateName                        = Ready_Sword

            Animation                        = AttackWithSwordA
                AnimationName                = EUHaldir_ATKSV2
                AnimationMode                = ONCE
                UseWeaponTiming                = Yes
            End
            Animation                        = AttackWithSwordB
                AnimationName                = EUHaldir_ATKSV2
                AnimationMode                = ONCE
                UseWeaponTiming                = Yes
            End
            Animation                        = AttackWithSwordD
                AnimationName                = EUHaldir_ATKSV4
                AnimationMode                = ONCE
                UseWeaponTiming                = Yes
            End
            BeginScript
                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
            EndScript
        End

        AnimationState                        = FIRING_OR_PREATTACK_B
            StateName                        = Ready_Sword

            Animation                        = AttackWithSwordA
                AnimationName                = EUHaldir_ATKSV2
                AnimationMode                = ONCE
                UseWeaponTiming                = Yes
            End
            Animation                        = AttackWithSwordB
                AnimationName                = EUHaldir_ATKSV2
                AnimationMode                = ONCE
                UseWeaponTiming                = Yes
            End
            Animation                        = AttackWithSwordD
                AnimationName                = EUHaldir_ATKSV4
                AnimationMode                = ONCE
                UseWeaponTiming                = Yes
            End
            BeginScript
                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
            EndScript
        End

        AnimationState                        = MOVING WEAPONSET_TOGGLE_1
            StateName                        = Moving_Bow
            Animation
                AnimationName                = EUHaldir_RUNB
                AnimationMode                = LOOP
            End
            Flags = RANDOMSTART
            BeginScript
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("arrownock")
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Moving_Sword" then CurDrawableSetTransitionAnimState("TRANS_SwordToBow_Moving") end
            EndScript
        End
        AnimationState                        = MOVING
            StateName                        = Moving_Sword
            Animation
                AnimationName                = EUHaldir_RUNS
                AnimationMode                = LOOP
            End
            Flags = RANDOMSTART
            BeginScript
                CurDrawableHideSubObject("arrow")
                CurDrawableHideSubObject("arrownock")
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Moving_Bow" then CurDrawableSetTransitionAnimState("TRANS_BowToSword_Moving") end
            EndScript
        End


        AnimationState                        = PREATTACK_A WEAPONSET_TOGGLE_1
            Animation                        = ReadyToDrawn
                AnimationName                = EUHaldir_ATA1
                AnimationMode                = ONCE
                AnimationBlendTime            = 0
                UseWeaponTiming                = Yes
            End
            BeginScript
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("ArrowNock")
            EndScript
        End

        AnimationState                        = FIRING_OR_RELOADING_A WEAPONSET_TOGGLE_1
            StateName                        = STATE_Firing
            Animation
                AnimationName                = EUHaldir_ATA2
                AnimationMode                = ONCE
                AnimationBlendTime            = 30
                UseWeaponTiming                = Yes
                AnimationSpeedFactorRange    = 1.5 1.5
            End
            Flags                            = START_FRAME_FIRST
            BeginScript
                CurDrawableHideSubObject("arrow")
                CurDrawableHideSubObject("ArrowNock")
            EndScript
        End


        AnimationState                        = MOVING BACKING_UP WEAPONSET_TOGGLE_1
            StateName                        = STATE_BackingUp
            Animation                        = Bow
                AnimationName                = EUHaldir_BAKB
                AnimationMode                = LOOP
            End
            Animation                        = WantBow
                AnimationName                = EUHaldir_BAKS
                AnimationMode                = LOOP
            End
            Flags                            = MAINTAIN_FRAME_ACROSS_STATES4
            BeginScript
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("arrownock")
                PrevAnim    = CurDrawablePrevAnimation()
                PrevState    = CurDrawablePrevAnimationState()
                if PrevState == "STATE_BackingUp"
                then
                    if PrevAnim == "WantBow" or PrevAnim == "Sword"
                    then
                        return "WantBow"
                    end
                end
                return "Bow"
            EndScript
        End
        AnimationState                        = MOVING BACKING_UP
            StateName                        = STATE_BackingUp
            Animation                        = Sword
                AnimationName                = EUHaldir_BAKS
                AnimationMode                = LOOP
            End
            Animation                        = WantSword
                AnimationName                = EUHaldir_BAKS
                AnimationMode                = LOOP
            End
            Flags                            = MAINTAIN_FRAME_ACROSS_STATES4
            BeginScript
                CurDrawableHideSubObject("ARROW")
                CurDrawableHideSubObject("ARROWNOCK")
                PrevAnim    = CurDrawablePrevAnimation()
                PrevState    = CurDrawablePrevAnimationState()
                if PrevState == "STATE_BackingUp"
                then
                    if PrevAnim == "Bow" or PrevAnim == "WantSword"
                    then
                        return "WantSword"
                    end
                end
                return "Sword"
            EndScript
        End


        AnimationState                        = CONTINUOUS_FIRE_MEAN
            Animation                        = HangFrameWhileCoasting
                AnimationName                = EUHaldir_ATA2
                AnimationMode                = MANUAL
                AnimationBlendTime            = 20
            End
            Flags                            = START_FRAME_LAST
            BeginScript
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("ARROWNOCK")
                if CurDrawablePrevAnimationState() == "STATE_Firing" then CurDrawableAllowToContinue() end
            EndScript

        End
        AnimationState                        = CONTINUOUS_FIRE_SLOW
            StateName                        = Ready_Bow
            Animation                        = PutAwayArrow
                AnimationName                = EUHaldir_ATA3
                AnimationMode                = ONCE
            End
            BeginScript
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("ARROWNOCK")
            EndScript
        End


        AnimationState                        = ATTACKING WEAPONSET_TOGGLE_1
            StateName                        = Ready_Bow
            Animation                        = IDLB
                AnimationName                = EUHaldir_IDLB
                AnimationMode                = LOOP
            End
            BeginScript
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("arrownock")
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Bored_Bow" then CurDrawableSetTransitionAnimState("TRANS_BR_Bow") end
                if Prev == "Selected_Bow" then CurDrawableSetTransitionAnimState("TRANS_SelectedToReady_Bow") end
                if Prev == "Selected_Sword" or Prev == "Moving_Sword" or Prev == "Ready_Sword" or Prev == "Bored_Sword" or PrevAnim == "WantBow"
                then
                    CurDrawableSetTransitionAnimState("TRANS_SwordToBow_Ready")
                end
            EndScript
        End
        AnimationState                        = ATTACKING
            StateName                        = Ready_Sword
            Animation                        = Alert_1
                AnimationName                = EUHaldir_IDLST1
                AnimationMode                = LOOP
            End
            BeginScript
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
                if Prev == "Bored_Sword" then CurDrawableSetTransitionAnimState("TRANS_BR_Sword") end
                if Prev == "Selected_Bow" or Prev == "Moving_Bow" or Prev == "Ready_Bow" or Prev == "Bored_Bow" or PrevAnim == "WantSword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BowToSword_Ready")
                end
            EndScript
        End


        AnimationState                        = ENGAGED WEAPONSET_TOGGLE_1
            StateName                        = Ready_Bow
            Animation                        = IDLB
                AnimationName                = EUHaldir_IDLB
                AnimationMode                = LOOP
            End
            BeginScript
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("arrownock")
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Bored_Bow"        then CurDrawableSetTransitionAnimState("TRANS_BR_Bow")                end
                if Prev == "Selected_Bow"    then CurDrawableSetTransitionAnimState("TRANS_SelectedToReady_Bow")                end
                if Prev == "Selected_Sword" or Prev == "Moving_Sword" or Prev == "Ready_Sword" or Prev == "Bored_Sword" or PrevAnim == "WantBow"
                then
                    CurDrawableSetTransitionAnimState("TRANS_SwordToBow_Ready")
                end
            EndScript
        End
        AnimationState                        = ENGAGED
            StateName                        = Ready_Sword
            Animation                        = Alert_1
                AnimationName                = EUHaldir_IDLST1
                AnimationMode                = LOOP
            End
            BeginScript
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
                if Prev == "Bored_Sword"        then CurDrawableSetTransitionAnimState("TRANS_BR_Sword")            end
                if Prev == "Selected_Bow" or Prev == "Moving_Bow" or Prev == "Ready_Bow" or Prev == "Bored_Bow" or PrevAnim == "WantSword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BowToSword_Ready")
                end
            EndScript
        End


        AnimationState                        = EMOTION_ALERT WEAPONSET_TOGGLE_1
            StateName                        = Ready_Bow
            Animation                        = IDLB
                AnimationName                = EUHaldir_IDLB
                AnimationMode                = LOOP
            End
            BeginScript
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("arrownock")
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Bored_Bow"        then CurDrawableSetTransitionAnimState("TRANS_BR_Bow") end
                if Prev == "Selected_Bow"    then CurDrawableSetTransitionAnimState("TRANS_SelectedToReady_Bow") end
                if Prev == "Selected_Sword" or Prev == "Moving_Sword" or Prev == "Ready_Sword" or Prev == "Bored_Sword" or PrevAnim == "WantBow"
                then
                    CurDrawableSetTransitionAnimState("TRANS_SwordToBow_Ready")
                end
            EndScript
        End
        AnimationState                        = EMOTION_ALERT
            StateName                        = Ready_Sword
            Animation                        = Alert_1
                AnimationName                = EUHaldir_IDLST1
                AnimationMode                = LOOP
            End
            BeginScript
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
                if Prev == "Bored_Sword" then CurDrawableSetTransitionAnimState("TRANS_BR_Sword") end
                if Prev == "Selected_Bow" or Prev == "Moving_Bow" or Prev == "Ready_Bow" or Prev == "Bored_Bow" or PrevAnim == "WantSword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BowToSword_Ready")
                end
            EndScript
        End


        AnimationState                        = EMOTION_CELEBRATING WEAPONSET_TOGGLE_1
            StateName                        = STATE_Emotion_Bow
            Animation                        = Bow
                AnimationName                = EUHaldir_CHRB
                AnimationMode                = ONCE
            End
            Animation                        = Bow2
                AnimationName                = EUHaldir_CHRB
                AnimationMode                = ONCE
            End
            Flags                            = MAINTAIN_FRAME_ACROSS_STATES RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("arrownock")
                if PrevState == "STATE_Emotion_Sword"
                then
                    CurDrawableAllowToContinue()
                    if( CurDrawablePrevAnimFraction() > .89 )
                    then
                        CurDrawableSetTransitionAnimState("TRANS_SwordToBow_Ready")
                    end
                elseif PrevState == "STATE_Emotion_Bow"
                then
                    CurDrawableAllowToContinue()
                elseif PrevState == "Selected_Bow"
                then
                    CurDrawableSetTransitionAnimState("TRANS_SelectedToReady_Bow")
                end
            EndScript
        End
        AnimationState                        = EMOTION_CELEBRATING
            StateName                        = STATE_Emotion_Sword
            Animation                        = Sword
                AnimationName                = EUHaldir_CHRS
                AnimationMode                = ONCE
            End
            Animation                        = Sword2
                AnimationName                = EUHaldir_CHRS
                AnimationMode                = ONCE
            End
            Flags                            = MAINTAIN_FRAME_ACROSS_STATES RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("arrow")
                CurDrawableHideSubObject("arrownock")

                if PrevState == "STATE_Emotion_Bow"
                then
                    CurDrawableAllowToContinue()
                    if( CurDrawablePrevAnimFraction() > .89 )
                    then
                        CurDrawableSetTransitionAnimState("TRANS_BowToSword_Ready")
                    end
                elseif PrevState == "STATE_Emotion_Sword"
                then
                    CurDrawableAllowToContinue()
                elseif PrevState == "Bored_Sword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BR_Sword")
                end
            EndScript
        End



        AnimationState                        = EMOTION_TAUNTING WEAPONSET_TOGGLE_1
            StateName                        = STATE_Emotion_Bow
            Animation                        = Bow1
                AnimationName                = EUHaldir_TNTA
                AnimationMode                = ONCE
            End
            Animation                        = Bow2
                AnimationName                = EUHaldir_TNTA
                AnimationMode                = ONCE
            End
            Flags                            = RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("arrownock")

                if PrevState == "STATE_Emotion_Sword"
                then
                    CurDrawableAllowToContinue()
                    if( CurDrawablePrevAnimFraction() > .89 )
                    then
                        CurDrawableSetTransitionAnimState("TRANS_SwordToBow_Ready")
                    end
                elseif PrevState == "STATE_Emotion_Bow"
                then
                    CurDrawableAllowToContinue()
                elseif PrevState == "Selected_Bow"
                then
                    CurDrawableSetTransitionAnimState("TRANS_SelectedToReady_Bow")
                elseif PrevState == "Bored_Bow"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BR_Bow")
                end
            EndScript
        End
        AnimationState                        = EMOTION_TAUNTING
            StateName                        = STATE_Emotion_Sword
            Animation                        = Sword
                AnimationName                = EUHaldir_TNTB
                AnimationMode                = ONCE
            End
            Animation                        = Sword2
                AnimationName                = EUHaldir_TNTB
                AnimationMode                = ONCE
            End
            Flags                            = RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("arrow")
                CurDrawableHideSubObject("arrownock")
                if PrevState == "STATE_Emotion_Bow"
                then
                    CurDrawableAllowToContinue()
                    if( CurDrawablePrevAnimFraction() > .89 )
                    then
                        CurDrawableSetTransitionAnimState("TRANS_BowToSword_Ready")
                    end
                elseif PrevState == "STATE_Emotion_Sword"
                    then
                        CurDrawableAllowToContinue()
                elseif PrevState == "Bored_Sword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BR_Sword")
                end
            EndScript
        End


        AnimationState                        = EMOTION_POINTING WEAPONSET_TOGGLE_1
            StateName                        = STATE_Emotion_Bow
            Animation                        = Bow
                AnimationName                = EUHaldir_PNTA
                AnimationMode                = ONCE
            End
            Animation                        = Bow2
                AnimationName                = EUHaldir_PNTA
                AnimationMode                = ONCE
            End
            Flags                            = MAINTAIN_FRAME_ACROSS_STATES RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("arrownock")

                if PrevState == "STATE_Emotion_Sword"
                then
                    CurDrawableAllowToContinue()
                    if( CurDrawablePrevAnimFraction() > .89 )
                    then
                        CurDrawableSetTransitionAnimState("TRANS_SwordToBow_Ready")
                    end
                elseif PrevState == "STATE_Emotion_Bow"
                then
                    CurDrawableAllowToContinue()
                elseif PrevState == "Selected_Bow"
                then
                    CurDrawableSetTransitionAnimState("TRANS_SelectedToReady_Bow")
                elseif PrevState == "Bored_Bow"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BR_Bow")
                end
            EndScript
        End
        AnimationState                        = EMOTION_POINTING
            StateName                        = STATE_Emotion_Sword
            Animation                        = Sword
                AnimationName                = EUHaldir_PNTB
                AnimationMode                = ONCE
            End
            Animation                        = Sword2
                AnimationName                = EUHaldir_PNTB
                AnimationMode                = ONCE
            End
            Flags                            = MAINTAIN_FRAME_ACROSS_STATES RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("arrow")
                CurDrawableHideSubObject("arrownock")

                if PrevState == "STATE_Emotion_Bow"
                then
                    CurDrawableAllowToContinue()
                    if( CurDrawablePrevAnimFraction() > .89 )
                    then
                        CurDrawableSetTransitionAnimState("TRANS_BowToSword_Ready")
                    end
                elseif PrevState == "STATE_Emotion_Sword"
                then
                    CurDrawableAllowToContinue()
                elseif PrevState == "Bored_Sword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BR_Sword")
                end
            EndScript
        End


        AnimationState                         = HIT_REACTION HIT_LEVEL_1 WEAPONSET_TOGGLE_1
            StateName                        = Bored_Bow
            Animation
                AnimationName                = EUHaldir_HITA
                AnimationMode                 = ONCE
                AnimationSpeedFactorRange    = .9 .9
            End
        End
        AnimationState                        = HIT_REACTION HIT_LEVEL_1
            StateName                        = Bored_Sword
            Animation
                AnimationName                = EUHaldir_HITE
                AnimationMode                = ONCE
            End
        End

        AnimationState                        = RAISING_FLAG WEAPONSET_TOGGLE_1
            StateName                        = STATE_Emotion_Bow
            Animation                        = Bow
                AnimationName                = EUHaldir_CHRB
                AnimationMode                = ONCE
            End
            Animation                        = Bow2
                AnimationName                = EUHaldir_CHRB
                AnimationMode                = ONCE
            End
            Flags                            = RESTART_ANIM_WHEN_COMPLETE
        End

        AnimationState                        = SELECTED WEAPONSET_TOGGLE_1
            StateName                        = Selected_Bow
            Animation                        = ATNE
                AnimationName                = EUHaldir_ATNE
                AnimationMode                = LOOP
            End
            BeginScript
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("arrownock")
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Emotion_Bow" or Prev == "STATE_Emotion_Sword" then CurDrawableAllowToContinue() end
                if Prev == "Bored_Bow" then CurDrawableSetTransitionAnimState("TRANS_BoredToSelected_Bow") end
                if Prev == "Ready_Bow" then CurDrawableSetTransitionAnimState("TRANS_RS_Bow") end
                if Prev == "Selected_Sword" or Prev == "Moving_Sword" or Prev == "Ready_Sword" or Prev == "Bored_Sword" or PrevAnim == "WantBow"
                then
                    CurDrawableSetTransitionAnimState("TRANS_SwordToBow_Selected")
                end
            EndScript
        End

        AnimationState                        = RAISING_FLAG
            StateName                        = STATE_Emotion_Sword
            Animation                        = Sword
                AnimationName                = EUHaldir_CHRS
                AnimationMode                = ONCE
            End
            Animation                        = Sword2
                AnimationName                = EUHaldir_CHRS
                AnimationMode                = ONCE
            End
            Flags                            = RESTART_ANIM_WHEN_COMPLETE
        End

        AnimationState                        = SELECTED
            StateName                        = Selected_Sword
            Animation                        = ATNA
                AnimationName                = EUHaldir_ATNS
                AnimationMode                = LOOP
            End
            BeginScript
                CurDrawableHideSubObject("ARROW")
                CurDrawableHideSubObject("ARROWNOCK")
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Emotion_Bow" or Prev == "STATE_Emotion_Sword" then CurDrawableAllowToContinue() end
                if Prev == "Bored_Sword" then CurDrawableSetTransitionAnimState("TRANS_BoredToSelected_Sword") end
                if Prev == "Ready_Sword" then CurDrawableSetTransitionAnimState("TRANS_ReadyToSelected_Sword") end
                if Prev == "Selected_Bow" or Prev == "Moving_Bow" or Prev == "Ready_Bow" or Prev == "Bored_Bow" or PrevAnim == "WantSword" or PrevAnim == "EUHaldir_STHB"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BowToSword_Selected")
                end
            EndScript
        End


        IdleAnimationState
            StateName                        = Bored_Sword
            Animation                        = Idle_Sword1
                AnimationName                = EUHaldir_IDLF
                AnimationMode                = ONCE
            End
            Animation                        = Idle_Sword2
                AnimationName                = EUHaldir_IDLF
                AnimationMode                = ONCE
            End
            Animation                        = Idle_Sword3
                AnimationName                = EUHaldir_IDLF
                AnimationMode                = ONCE
            End
            Animation                        = IdleNoFidget
                AnimationName                = EUHaldir_IDLF
                AnimationMode                = ONCE
                AnimationPriority            = 20
            End
            Animation                        = IdleNoFidget2
                AnimationName                = EUHaldir_IDLF
                AnimationMode                = ONCE
                AnimationPriority            = 0
            End
            Flags                            = RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                CurDrawableHideSubObject("ARROW")
                CurDrawableHideSubObject("ARROWNOCK")
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                if Prev == "TRANS_SelectedToBored_Sword" or Prev == "TRANS_RB_Sword" then return "IdleNoFidget" end
                if Prev == "Selected_Sword" then CurDrawableSetTransitionAnimState("TRANS_SelectedToBored_Sword") end
                if Prev == "Ready_Sword" then CurDrawableSetTransitionAnimState("TRANS_RB_Sword") end
                if Prev == "Selected_Bow" or Prev == "Moving_Bow" or Prev == "Ready_Bow" or Prev == "Bored_Bow" or PrevAnim == "WantSword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BowToSword_Selected")
                end
            EndScript
        End


        AnimationState                        = WEAPONSET_TOGGLE_1
            StateName                        = Bored_Bow
            Animation                        = IdleBowB
                AnimationName                = EUHaldir_IDLE
                AnimationMode                = ONCE
            End
            Animation                        = IdleBowD
                AnimationName                = EUHaldir_IDLE
                AnimationMode                = ONCE
            End
            Animation                        = IdleNoFidget
                AnimationName                = EUHaldir_IDLE
                AnimationMode                = ONCE
                AnimationPriority            = 20
            End
            Animation                        = IdleNoFidget2
                AnimationName                = EUHaldir_IDLE
                AnimationMode                = ONCE
                AnimationPriority            = 10
            End
            Flags                            = RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("arrownock")
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                if Prev == "TRANS_SelectedToBored_Bow" or Prev == "TRANS_RB_Bow" then return "IdleNoFidget" end
                if Prev == "Selected_Bow" then CurDrawableSetTransitionAnimState("TRANS_SelectedToBored_Bow") end
                if Prev == "Ready_Bow" then CurDrawableSetTransitionAnimState("TRANS_RB_Bow") end
                if Prev == "Selected_Sword" or Prev == "Moving_Sword" or Prev == "Ready_Sword" or Prev == "Bored_Sword" or PrevAnim == "WantBow"
                then
                    CurDrawableSetTransitionAnimState("TRANS_SwordToBow_Selected")
                end
            EndScript
        End




        TransitionState                        = TRANS_BoredToSelected_Bow
            Animation
                AnimationName                = EUHaldir_ATNB
                AnimationMode                = ONCE
                AnimationBlendTime            = 10
            End
        End


        TransitionState                        = TRANS_SelectedToReady_Bow
            Animation                        = ATNE
                AnimationName                = EUHaldir_IDLB
                AnimationMode                = ONCE
                AnimationBlendTime            = 10
            End
        End


        TransitionState                        = TRANS_SelectedToBored_Bow
            Animation
                AnimationName                = EUHaldir_ATNB
                AnimationMode                = ONCE_BACKWARDS
            End
            Flags                            = START_FRAME_LAST
        End


        TransitionState                        = TRANS_RS_Bow
            Animation                        = ATNF
                AnimationName                = EUHaldir_IDLB
                AnimationMode                = ONCE_BACKWARDS
                AnimationBlendTime            = 10
            End
            Flags                            = START_FRAME_LAST
        End


        TransitionState                        = TRANS_BR_Bow
            Animation                        = IDLB
                AnimationName                = EUHaldir_IDLST1
                AnimationMode                = ONCE
                AnimationBlendTime            = 20
            End
        End


        TransitionState                        = TRANS_RB_Bow
            Animation                        = IDLD
                AnimationName                = EUHaldir_IDLB
                AnimationMode                = ONCE
                AnimationBlendTime            = 20
            End
        End


        TransitionState                    = TRANS_BoredToSelected_Sword
            Animation                    = ATNA
                AnimationName            = EUHaldir_ATNA
                AnimationMode            = ONCE
            End
        End


        TransitionState                    = TRANS_SR_Sword
            Animation                    = ATNC
                AnimationName            = EUHaldir_STHA
                AnimationMode            = ONCE
            End
        End


        TransitionState                    = TRANS_SelectedToBored_Sword
            Animation                    = ATNA
                AnimationName            = EUHaldir_ATNA
                AnimationMode            = ONCE_BACKWARDS
            End
            Flags                        = START_FRAME_LAST
        End


        TransitionState                    = TRANS_ReadyToSelected_Sword
            Animation                    = ATNC
                AnimationName            = EUHaldir_IDLST1
                AnimationMode            = ONCE_BACKWARDS
                AnimationBlendTime        = 20
            End
            Flags                        = START_FRAME_LAST
        End


        TransitionState                    = TRANS_BR_Sword
            Animation                    = ATNS
                AnimationName            = EUHaldir_STHA
                AnimationMode            = ONCE
                AnimationBlendTime        = 20
            End
        End


        TransitionState                    = TRANS_RB_Sword
            Animation                    = IDLG
                AnimationName            = EUHaldir_STHA
                AnimationMode            = ONCE
                AnimationBlendTime        = 20
            End
        End



        TransitionState                    = TRANS_SwordToBow_Moving
            Animation                    = DrawBow
                AnimationName            = EUHaldir_STHC
                AnimationMode            = ONCE
            End
        End


        TransitionState                    = TRANS_BowToSword_Moving
            Animation                    = DrawSword
                AnimationName            = EUHaldir_STHD
                AnimationMode            = ONCE
            End
        End


        TransitionState                    = TRANS_BowToSword_Ready
            Animation                    = DrawSwords
                AnimationName            = EUHaldir_STHA
                AnimationMode            = ONCE
            End
        End


        TransitionState                    = TRANS_SwordToBow_Ready
            Animation                    = DrawBow
                AnimationName            = EUHaldir_STHB
                AnimationMode            = ONCE
            End
        End


        TransitionState                    = TRANS_BowToSword_Selected
            Animation                    = DrawSwords
                AnimationName            = EUHaldir_STHA
                AnimationMode            = ONCE
            End
        End


        TransitionState                    = TRANS_SwordToBow_Selected
            Animation                    = DrawBow
                AnimationName            = EUHaldir_STHB
                AnimationMode            = ONCE
            End
        End
    End


    Draw = W3DScriptedModelDraw ModuleTag_LightController
        DefaultModelConditionState
            Model = None
        End
        ModelConditionState = HERO
            Model           = exldrspimla
        End
    End


    Draw = W3DScriptedModelDraw Icon
        ModelConditionState = NONE
            Model           = bbox
        End
    End



    #include "..\..\..\includes\StunDrawModuleSmall.inc"


    Side = Imladris
    EditorSorting = UNIT
    ThreatLevel = ELROND_THREAT
    ThingClass = CHARACTER_UNIT
    TransportSlotCount = TRANSPORTSLOTCOUNT_HERO
    DisplayMeleeDamage  = ELRONDDAG_DAMAGE
    ShockwaveResistance = SHOCKWAVE_RESISTANCE_STRONG
    CommandSet = ElrondMODCommandSet
    CommandPoints = 0
    BuildCost = ELRONDDAG_COST
    BuildTime = SILMARIL_HERO_BUILDTIME
    EquivalentTo         = ImladrisElrond
    MaxSimultaneousOfType                 = 1

    WeaponSet
        Conditions = None
        Weapon            = PRIMARY    ElrondWaterSword
        Weapon            = SECONDARY  ElrondNewSwordSilmaril
        OnlyAgainst       = SECONDARY  STRUCTURE BLOCKING_GATE
        AutoChooseSources = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End

    ArmorSet
        Conditions      = None
        Armor           = SilmarilHeroArmor
        DamageFX        = NormalDamageFX
    End

    VisionRange = 300
    ShroudClearingRange = 400

    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = 200
    VisionBonusPercentPerFoot = 1.0%


    BountyValue = ELVEN_ELROND_BOUNTY_VALUE
    RecruitText = CONTROLBAR:ElrondRecruit
    ReviveText  = CONTROLBAR:ElrondRevive
    Hotkey      = CONTROLBAR:ElvenElrondHotkey
    DisplayName = OBJECT:ElvenElrond
    CrushableLevel = 4


    AutoResolveUnitType = AutoResolveUnit_Hero
    AutoResolveCombatChain = AutoResolve_HeroCombatChain

    AutoResolveBody = AutoResolve_ElrondBody

    AutoResolveArmor
        Armor = AutoResolve_ElrondArmor
    End

    AutoResolveWeapon
        Weapon = AutoResolve_ElrondWeapon
    End

    AutoResolveLeadership = AutoResolve_ElrondBonus





	VoiceCreated                                  = SH_ThreeForElves
	VoiceFullyCreated                             = SH_ThreeForElves
    VoiceAttack                                   = ElrondModVoiceAttack
    VoiceAttackCharge                             = ElrondModVoiceAttack
    VoiceAttackMachine                            = ElrondModVoiceAttack
    VoiceAttackStructure                          = ElrondModVoiceAttack
    VoiceFear                                     = ElrondModVoiceHelp
    VoiceGuard                                    = ElrondModVoiceMove
    VoiceMove                                     = ElrondModVoiceMove
    VoiceMoveToCamp                               = ElrondModVoiceMove
    VoicePriority                                 = 95
    VoiceRetreatToCastle                          = ElrondVoiceRetreat
    VoiceSelect                                   = ElrondModVoiceSelect
    VoiceSelectBattle                             = ElrondModVoiceSelect

    SoundImpact                                   = ImpactHorse

    UnitSpecificSounds
        VoiceEnterUnitElvenTransportShip          = ElrondModVoiceMove
        VoiceGarrison                             = ElrondModVoiceMove
        VoiceInitiateCaptureBuilding              = ElrondModVoiceMove
    End


    CrowdResponseKey = ElfHero

    #include "..\..\..\includes\StandardUnitEvaEvents.inc"
    EvaEventDieOwner            = ElrondDie

    Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
        Key = Humanoid_Male Elf_Male Unit Infantry Hero
    End

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap                     = 800
        AnimationSound                        = Sound:ArrowDrawBow                    Animation:EUHaldir_SKL.EUHaldir_ATA1    Frames:6
        AnimationSound                        = Sound:ArrowDrawBow                    Animation:EUHaldir_SKL.EUHaldir_ATA2    Frames:18
        AnimationSound                        = Sound:SwordShingClean1                Animation:EUHaldir_SKL.EUHaldir_STHA     Frames:24
        AnimationSound                        = Sound:SwordIntoScabbard1              Animation:EUHaldir_SKL.EUHaldir_STHB     Frames:9
        AnimationSound                        = Sound:WeaponSwitchBow                 Animation:EUHaldir_SKL.EUHaldir_STHB     Frames:15
        AnimationSound                        = Sound:SwordShingClean1                Animation:EUHaldir_SKL.EUHaldir_STHC     Frames:20
        AnimationSound                        = Sound:SwordIntoScabbard1              Animation:EUHaldir_SKL.EUHaldir_STHD     Frames:5
        AnimationSound                        = Sound:WeaponSwitchBow                 Animation:EUHaldir_SKL.EUHaldir_STHD     Frames:8
        AnimationSound                        = Sound:SwordShingClean1                Animation:EUHaldir_SKL.EUHaldir_RUNC     Frames:14
        AnimationSound                        = Sound:SwordIntoScabbard1              Animation:EUHaldir_SKL.EUHaldir_RUNT     Frames:4
        AnimationSound                        = Sound:WeaponSwitchBow                 Animation:EUHaldir_SKL.EUHaldir_RUNT     Frames:16
        AnimationSound                        = Sound:BodyFallSoldier                 Animation:EUHaldir_SKL.EUHaldir_LNDA     Frames:9
        AnimationSound                        = Sound:BodyFallSoldier                 Animation:EUHaldir_SKL.EUHaldir_LNDB     Frames:1
        AnimationSound                        = Sound:BodyFallGenericNoArmor          Animation:EUHaldir_SKL.EUHaldir_DIEB     Frames:82
        AnimationSound                        = Sound:BodyFallSoldier                 Animation:EUHaldir_SKL.EUHaldir_DIEBV5   Frames:25
        AnimationSound                        = Sound:BodyFallSoldier                 Animation:EUHaldir_SKL.EUHaldir_DIESV4   Frames:26
        AnimationSound                        = Sound:BodyFallGenericNoArmor          Animation:EUHaldir_SKL.EUHaldir_DIESV5   Frames:100
    End



    RadarPriority = UNIT
    KindOf = HERO PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY ATTACK_NEEDS_LINE_OF_SIGHT PATH_THROUGH_EACH_OTHER SCORE ARMY_SUMMARY HEAVY_MELEE_HITTER
    PathfindDiameter = 40.0
    CamouflageDetectionMultiplier = CAMOUFLAGE_DETECTION_DISTANCE_MEDIUM

    Body = RespawnBody ModuleTag_RespawnBody
        CheerRadius                 = EMOTION_CHEER_RADIUS
        MaxHealth                   = ELRONDDAG_HEALTH
        PermanentlyKilledByFilter   = NONE
        DodgePercent                = HERO_DODGE_PERCENT
    End

    Behavior = RespawnUpdate ModuleTag_RespawnUpdate
        DeathAnim                    = DYING
        DeathAnimationTime           = 4000
        RespawnAnim                  = LEVELED
        RespawnAnimationTime         = 2000
        AutoRespawnAtObjectFilter    = NONE +CASTLE_KEEP
        ButtonImage                  = HIElrondRivendell
        RespawnAsTemplate            = ImladrisElrond

        RespawnRules =    AutoSpawn:No    Cost:ELRONDDAG_COST  Time:SILMARIL_HERO_RESPAWNTIME    Health:100%
    End


    #include "..\..\..\includes\DefaultInvisibilityUpdate.inc"

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = Hero
    End

    Behavior = AttributeModifierAuraUpdate ModuleTag_SummonGondolin
        StartsActive     = Yes
        BonusName        = RingSummonGondolin
        RefreshDelay     = 2000
        Range            = 9999999999
        ObjectFilter     = NONE +ImladrisBibliothek
    End





    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_SilmarilHeroLeadershipStart
        SpecialPowerTemplate    = SpecialAbilityFakeLeadership3
    End

    Behavior = SpecialPowerModule ModuleTag_SilmarilHeroLeadershipUpdate
        SpecialPowerTemplate        = SpecialAbilityFakeLeadership3
        UpdateModuleStartsAttack    = No
        StartsPaused                = No
    End

    Behavior = AttributeModifierAuraUpdate ModuleTag_SilmarilHeroLeadership
        StartsActive     = Yes
        BonusName        = SilmarilHeroGlobalLeadership
        RefreshDelay     = 2000
        Range            = 1250
        ObjectFilter     = ALL -HERO -MACHINE -SHIP -DOZER -STRUCTURE ALLIES
    End





    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_FarsightUnpause
        SpecialPowerTemplate    = SpecialAbilityElrondFarsight
        TriggeredBy             = Upgrade_Level_1
    End
    Behavior = OCLSpecialPower ModuleTag_FarsightOCL
        StartsPaused            = Yes
        SpecialPowerTemplate    = SpecialAbilityElrondFarsight
        OCL                     = OCL_SpecialPowerFarSeeing
        CreateLocation          = CREATE_AT_LOCATION
    End







    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_LautwasserEnabler
        SpecialPowerTemplate = SpecialAbilityZornderLautwasser
        TriggeredBy = Upgrade_Level_10
    End

    Behavior = SpecialPowerModule ModuleTag_LautwasserStarter
        SpecialPowerTemplate        = SpecialAbilityZornderLautwasser
        UpdateModuleStartsAttack    = Yes
        StartsPaused                = Yes
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_LautwasserUpdate
        SpecialPowerTemplate    = SpecialAbilityZornderLautwasser
        UnpackTime              = 1300
        PackTime                = 1500
        StartAbilityRange 	= 100.0
        SpecialWeapon 		= ElrondPersonalFlood
        WhichSpecialWeapon 	= 1
    End

    Behavior = AutoAbilityBehavior ModuleTag_LautwasserAutoAbility
        SpecialAbility              = SpecialAbilityZornderLautwasser
        MinScanRange                = 100
        MaxScanRange                = 200
        Query                       = 1 ANY ENEMIES +STRUCTURE +HERO
        Query                       = 20 ALL ENEMIES
    End







    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_FloodEnabler
        SpecialPowerTemplate = SpecialAbilityPersonalFlood
        TriggeredBy = Upgrade_Level_2
    End

    Behavior = SpecialPowerModule ModuleTag_FloodStarter
        SpecialPowerTemplate        = SpecialAbilityPersonalFlood
        UpdateModuleStartsAttack    = Yes
        StartsPaused                = Yes
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_FloodUpdate
        SpecialPowerTemplate    = SpecialAbilityPersonalFlood
        UnpackTime              = 1300
        PackTime                = 1500
	StartAbilityRange       = 150.0
        SpecialWeapon           = ElrondRingPersonalFlood
        WhichSpecialWeapon      = 1
    End

    Behavior = AutoAbilityBehavior ModuleTag_PersonalFloodAutoAbility
        SpecialAbility              = SpecialAbilityPersonalFlood
        MinScanRange                = 150
        MaxScanRange                = 250
        Query                       = 1 ANY ENEMIES +STRUCTURE +HERO
        Query                       = 20 ALL ENEMIES
    End







    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_RatschlagEnabler
        SpecialPowerTemplate         = SpecialAbilityElrondsRatschlag
        TriggeredBy                  = Upgrade_Level_3
    End

    Behavior = SpecialPowerModule ModuleTag_RatschlagSpecialPowerModule
        SpecialPowerTemplate         = SpecialAbilityElrondsRatschlag
        StartsPaused                 = Yes
        UpdateModuleStartsAttack     = Yes
        InitiateSound                = ElrondsRatschlagSound
    End

    Behavior = LevelGrantSpecialPower ModuleTag_Ratschlag
        SpecialPowerTemplate         = SpecialAbilityElrondsRatschlag
        UnpackingVariation           = 2
        StartAbilityRange            = 200.0
        LevelFX                      = FX_ElrondsRatschlagFX
        Experience                   = 200
        RadiusEffect                 = 30
        AcceptanceFilter             = NONE +HERO +GasthausPalando +GasthausAlatar +ImladrisGwaihirFortressEagle +ImladrisGwaihir -ImladrisElrond -ImladrisElrond_RingHero -ImladrisElrond_Summoned ALLIES
        UnpackTime                   = 1200
        PreparationTime              = 0
        FreezeAfterTriggerDuration   = 2000
    End







    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_LehrenEnabler
        SpecialPowerTemplate         = SpecialAbilityElrondsLehren
        TriggeredBy                  = Upgrade_Level_3
    End

    Behavior = SpecialPowerModule ModuleTag_LehrenSpecialPowerModule
        SpecialPowerTemplate         = SpecialAbilityElrondsLehren
        StartsPaused                 = Yes
        UpdateModuleStartsAttack     = Yes
        InitiateSound                = ElrondsRatschlagSound
    End

    Behavior = LevelGrantSpecialPower ModuleTag_Lehren
        SpecialPowerTemplate         = SpecialAbilityElrondsLehren
        UnpackingVariation           = 2
        StartAbilityRange            = 200.0
        LevelFX                      = FX_ElrondsRatschlagFX
        Experience                   = 10000
        RadiusEffect                 = 30
        AcceptanceFilter             = NONE +HERO +GasthausPalando +GasthausAlatar +ImladrisGwaihirFortressEagle +ImladrisGwaihir -ImladrisElrond -ImladrisElrond_RingHero -ImladrisElrond_Summoned ALLIES
        UnpackTime                   = 1200
        PreparationTime              = 0
        FreezeAfterTriggerDuration   = 2000
    End





	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_VetsransOfthelastAllianceRing
        SpecialPowerTemplate = SpecialAbilityFakeLeadership
        TriggeredBy = Upgrade_Level_5
	
    End

    Behavior = SpecialPowerModule ModuleTag_VetsransOfthelastAllianceUpdateRing
        SpecialPowerTemplate      = SpecialAbilityFakeLeadership
        UpdateModuleStartsAttack  = Yes
        StartsPaused = No
    End

	Behavior = AttributeModifierAuraUpdate ModuleTag_VetsransOfthelastAllianceLeadershipRing
        StartsActive     = Yes
        BonusName        = VetsransOfthelastAllianceLeadership
        TriggeredBy      = Upgrade_Level_5
        RefreshDelay     = 2000
        Range            = 300
        ObjectFilter     = ANY +BruchtalVeteran  -HERO -STRUCTURE -DOZER -MACHINE -SHIP -CAVALRY ALLIES
    End


	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_VetsransOfthelastAlliance2Ring
        SpecialPowerTemplate = SpecialAbilityFakeLeadership
        TriggeredBy = Upgrade_Level_10
	
    End

    Behavior = SpecialPowerModule ModuleTag_VetsransOfthelastAllianceUpdate2Ring
        SpecialPowerTemplate      = SpecialAbilityFakeLeadership
        UpdateModuleStartsAttack  = Yes
        StartsPaused = No
    End

	Behavior = AttributeModifierAuraUpdate ModuleTag_VetsransOfthelastAllianceLeadership2Ring
        StartsActive     = Yes
        BonusName        = VetsransOfthelastAllianceLeadership2
        TriggeredBy      = Upgrade_Level_10
        RefreshDelay     = 2000
        Range            = 300
        ObjectFilter     = ANY +BruchtalVeteran  -HERO -STRUCTURE -DOZER -MACHINE -SHIP -CAVALRY ALLIES
    End


	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_VetsransOfthelastAlliance3Ring
        SpecialPowerTemplate = SpecialAbilityFakeLeadership
        TriggeredBy = Upgrade_Level_15
	
    End

    Behavior = SpecialPowerModule ModuleTag_VetsransOfthelastAllianceUpdate3Ring
        SpecialPowerTemplate      = SpecialAbilityFakeLeadership
        UpdateModuleStartsAttack  = Yes
        StartsPaused = No
    End

	Behavior = AttributeModifierAuraUpdate ModuleTag_VetsransOfthelastAllianceLeadership3Ring
        StartsActive     = Yes
        BonusName        = VetsransOfthelastAllianceLeadership3
        TriggeredBy      = Upgrade_Level_15
        RefreshDelay     = 2000
        Range            = 300
        ObjectFilter     = ANY +BruchtalVeteran  -HERO -STRUCTURE -DOZER -MACHINE -SHIP -CAVALRY ALLIES
    End




    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_ElrondsErfahrungsLeadership
        SpecialPowerTemplate      = SpecialAbilityFakeLeadership3
        TriggeredBy               = Upgrade_Level_1
    End

    Behavior = SpecialPowerModule ModuleTag_ElrondsErfahrungsLeadershipUpdate
        SpecialPowerTemplate      = SpecialAbilityFakeLeadership3
        UpdateModuleStartsAttack  = No
        StartsPaused              = Yes
    End
    Behavior = AttributeModifierAuraUpdate ModuleTag_Leadership2
        StartsActive              = No
        BonusName                 = ElrondNeueLeadership
        TriggeredBy               = Upgrade_Level_1
        RefreshDelay              = 2000
        Range                     = 200
        ObjectFilter              = GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
    End

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_TheodenLeadership
        SpecialPowerTemplate     = SpecialAbilityFakeLeadership
        TriggeredBy              = Upgrade_Level_1
    End

    Behavior = SpecialPowerModule ModuleTag_TheodenLeadershipUpdate
        SpecialPowerTemplate     = SpecialAbilityFakeLeadership
        UpdateModuleStartsAttack = No
        StartsPaused             = Yes
    End

    Behavior = AttributeModifierAuraUpdate ModuleTag_Leadership
        StartsActive             = No
        BonusName                = ElrondNoldorRustung
        TriggeredBy              = Upgrade_Level_5
        RefreshDelay             = 2000
        Range                    = 1
        AllowSelf                = Yes

        ObjectFilter             = NONE +ImladrisElrond +ImladrisElrond_Arnor
    End

    Behavior = WeaponSetUpgrade WeaponSetUpgradeModuleTagHadhafang
        TriggeredBy              = Upgrade_Level_5
    End






    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_RestorationUnpause
        SpecialPowerTemplate        = SpecialAbilityElrondRestoration
        TriggeredBy                 = Upgrade_Level_8
    End
    Behavior = SpecialPowerTimerRefreshSpecialPower ModuleTag_RestorationRefresh
        SpecialPowerTemplate        = SpecialAbilityElrondRestoration
        StartsPaused                = Yes
        UpdateModuleStartsAttack    = No
        AffectAllies                = Yes
        AttributeModifierRange      = 150
        AttributeModifierAffects    = NONE +HERO -ElvenElrond -ImladrisElrond -AngbandFortress -AngbandThangorodrim -TolinGaurhothFortress -UnderworldPortal -BelegostFortress -DorthonionFortress -ArmenelosFortress -GondolinTower -GondolinTower_Summoned -FormenosFortress -MenegrothFortress -TaniquetilFortress -AngbandMelkor -AngbandMelkor_WOR -TolinGaurhothTarMairon -TolinGaurhothTarMairon_WOR -AvatharUngoliant -AvatharUngoliant_WOR -ValinorManwe -ValinorManwe_WOR -DoriathMelian -DoriathMelian_WOR -ValinorEonwe -ValinorEonwe_WOR -ValinorTulkas -ValinorTulkas_WOR -ValinorAule -ValinorAule_WOR ALLIES


    End
    Behavior = PlayerHealSpecialPower ModuleTag_RestorationHeal
        SpecialPowerTemplate        = SpecialAbilityElrondRestorationHeal
        HealAffects                    = HERO
        HealAmount                    = 0.5
        HealRadius                    = 150
        HealFX                        = FX_ElrondHealSpecialPower
    End

    Behavior = AutoHealBehavior ModuleTag_ElrondHealing
        StartsActive = Yes
        HealingAmount = HERO_HEAL_AMOUNT
        HealingDelay = 1000
        StartHealingDelay = HERO_HEAL_DELAY
        HealOnlyIfNotInCombat = Yes
    End

    #include "..\..\..\includes\CaptureBuilding.inc"







    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_ElrondTornadoEnabler
        SpecialPowerTemplate        = SpecialAbilityElrondYilyaTornado
        TriggeredBy                 = Upgrade_Level_5
    End

    Behavior = OCLSpecialPower ModuleTag_OCLSpawnTornado
        StartsPaused             = Yes
        SpecialPowerTemplate     = SpecialAbilityElrondYilyaTornado
        OCL                      = OCL_ElrondVilyaSturmObject
        CreateLocation           = CREATE_AT_LOCATION
        SetModelCondition        = ModelConditionState:USER_1
        SetModelConditionTime    = 2.333
    End

    Behavior = CommandSetUpgrade ModueTag_CommandSet
        TriggeredBy   = Upgrade_Level_1
        CommandSet    = ElrondMODRingCommandSet
    End

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_RingLeadership
        SpecialPowerTemplate     = SpecialAbilityFakeLeadership2
        TriggeredBy              = Upgrade_Level_1
    End

    Behavior = SpecialPowerModule ModuleTag_RingLeadershipUpdate
        SpecialPowerTemplate     = SpecialAbilityFakeLeadership2
        UpdateModuleStartsAttack = No
        StartsPaused             = Yes
    End

    Behavior = AIUpdateInterface ModuleTag_03
        AutoAcquireEnemiesWhenIdle = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate        = 500
        CanAttackWhileContained    = Yes
        AILuaEventsList            = ElrondImladrisFunctions
    End

    Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance       = 250
        TauntAndPointUpdateDelay    = 1000

        AddEmotion            =    Doom_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
        AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    Alert_Base
        AddEmotion            =    CheerForAboutToCrush_Base
     End

    LocomotorSet
        Locomotor = IsildurHumanLocomotor
        Condition = SET_NORMAL
        Speed     = NORMAL_ELVEN_FAST_MEMBER_SPEED
    End

    Behavior = PhysicsBehavior ModuleTag_04
        GravityMult            = 1.0
        ShockStandingTime    = 3000
        ShockStunnedTimeLow    = 1000
        ShockStunnedTimeHigh = 1200
    End

    Behavior = SlowDeathBehavior ModuleTag_05
        DeathTypes = ALL -FADED
        SinkDelay = 4300
        SinkRate = 3.0
        DestructionDelay = 8000
        Sound = INITIAL    ElrondVoiceDie
        OCL         = FINAL OCL_HeroRespawnModuleElrondFake
        DeathFlags = DEATH_1
    End

    Behavior = SquishCollide ModuleTag_06

    End


    Behavior = HitReactionBehavior HitReactionBehaviorModuleTag
        HitReactionLifeTimer1 = 7
        HitReactionLifeTimer2 = 15
        HitReactionLifeTimer3 = 10

        HitReactionThreshold1 = 0.0
        HitReactionThreshold2 = 25.0
        HitReactionThreshold3 = 50.0
    End

    Behavior = PassiveAreaEffectBehavior ModuleTag_SplashOfHealingWater_Ahh
        UpgradeRequired      = Upgrade_Level_1
        EffectRadius         = 150
        PingDelay            = 2000
        HealPercentPerSecond = 5%
        AllowFilter          = ANY +INFANTRY +CAVALRY +HERO +DOZER -MACHINE -MONSTER -IMMOBILE -STRUCTURE ALLIES
        NonStackable         = Yes
        HealFX               = FX_SpellHealUnitHealBuff
    End

    Behavior = BannerCarrierUpdate BannerCarrierUpdateModuleTag
        UpgradeRequired      = Upgrade_Level_1
        IdleSpawnRate        = 6000
        UnitSpawnFX          = FX_BannerCarrierSpawnUnit
        ReplenishNearbyHorde = Yes
        ScanHordeDistance    = 150
    End

    Behavior = RemoveUpgradeUpgrade ModuleTag_RemoveSilmaril
        TriggeredBy                   = Upgrade_AllFactionUpgrade
        UpgradeToRemove               = Upgrade_FortressRingHero Upgrade_RingHero
        RemoveFromAllPlayerObjects    = Yes
        SuppressEvaEventForRemoval    = Yes
    End

    Behavior = FXListDie ModuleTag_AnnounceWeLostTheRing
        DeathFX             = GandalfAnnounceFortressDeathLostRingFX
    End

    Behavior = CreateObjectDie ModuleTag_DropTheRing
        CreationList             = OCL_TheOneRing
    End

    Behavior = CreateObjectDie ModuleTag_RemoveFX
        CreationList    = OCL_ElrondSilamrilDead
    End







    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    Behavior = AttributeModifierUpgrade ModuleTag_SwordBonus
        TriggeredBy = Upgrade_ZwillingeWaffeSchmieden
        AttributeModifier = GeschmiedeteKlingeElrondModifier
    End






    Behavior = AISpecialPowerUpdate ElrondStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate ElrondStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate ElrondHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Behavior = AISpecialPowerUpdate ElrondCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate ElrondFloodPowerSilmarilAI
        CommandButtonName = Command_SpecialAbilityElrondMachtderBruinen
        SpecialPowerAIType = AI_SPECIAL_POWER_RANGED_AOE_ATTACK
        SpecialPowerRadius = 150
    End

    Behavior = AISpecialPowerUpdate SpecialPowerElrondSilmarilGiveXPAoE
        CommandButtonName = Command_SpecialAbilityElrondsLehren
        SpecialPowerAIType = AI_SPECIAL_POWER_GIVEXP_AOE
        SpecialPowerRadius = 30.0
    End

    Behavior = AISpecialPowerUpdate ElrondRestorationAI
        CommandButtonName = Command_SpecialAbilityElrondRestoration
        SpecialPowerAIType = AI_SPECIAL_POWER_SELFAOEHEALHEROS
    End

    Behavior = AISpecialPowerUpdate ElrondYilyaTornadoAI
        CommandButtonName = Command_SpecialAbilityElrondYilyaTornado
        SpecialPowerAIType = AI_SPECIAL_POWER_BASIC_SELF_BUFF
        SpecialPowerRadius = 150
    End

    Geometry = CYLINDER
    GeometryMajorRadius = 8.0
    GeometryMinorRadius = 8.0
    GeometryHeight = 19.2
    GeometryIsSmall = Yes
    Shadow = SHADOW_DECAL
    ShadowSizeX = 20
    ShadowSizeY = 20
    ShadowTexture = ShadowI
End

Object ImladrisElrond_Arnor

    SelectPortrait  = HPElrondMod
    ButtonImage     = HIElrondRivendell

    DescriptionStrategic = CONTROLBAR:LW_ToolTip_LeaderHero

    Draw = W3DScriptedModelDraw ModuleTag_DRAW

        DefaultModelConditionState
            Model             = RUElrond_SKN
            Skeleton          = EUHaldir_SKL
        End

        ModelConditionState   = USER_4
            Model             = RUElrond_SKN
            Skeleton          = EUHaldir_SKL
        End

        ModelConditionState ONE_RING
            Model             = RUElrond_SKN
            ParticleSysBone   = B_SWORDBONE ElrondWaterKlingenFX FollowBone:Yes
        End

        ModelConditionState ONE_RING USER_4
            Model             = RUElrond_SKN
            ParticleSysBone   = B_SWORDBONE ElrondWaterKlingenFX FollowBone:Yes
        End

        ModelConditionState = WORLD_BUILDER
            Model = RUElrond_SKN
        End

        AnimationState          =    PACKING_TYPE_1
            StateName          =    Attacking
            Animation
                AnimationName =    EUHaldir_PNTB
                AnimationMode =    ONCE
            End
        End

        AnimationState          =    PACKING_TYPE_2
            StateName          =    Attacking
            Animation
                AnimationName =    EUHaldir_PNTB
                AnimationMode =    ONCE
            End
        End

        AnimationState          =    SPECIAL_WEAPON_ONE
            StateName          =    Attacking
            Animation
                AnimationName =    EUHaldir_TNTB
                AnimationMode =    ONCE
            End
        End



        AnimationState          = USER_3
            Animation                = Throwing Fireball
                AnimationName        = EUHaldir_PNTA
                AnimationMode        = ONCE
            End
            FXEvent            = Frame:10 Name:FX_ElrondVilyaRing
            FrameForPristineBonePositions = 27
        End


        AnimationState                        = PASSENGER
            StateName                        = STATE_Grabbed
            Animation                        = Sword
                AnimationName                = EUHaldir_FLYB
                AnimationMode                = LOOP
            End
        End


        AnimationState                        = FREEFALL
            StateName                        = STATE_Falling
            Animation                        = Sword
                AnimationName                = EUHaldir_FLYB
                AnimationMode                = LOOP
                AnimationBlendTime            = 10
                AnimationSpeedFactorRange    = 0.24 0.24
            End
        End


        AnimationState                        = STUNNED_FLAILING
            StateName                        = STATE_Fly
            Animation                        = Sword
                AnimationName                = EUHaldir_FLYB
                AnimationMode                = LOOP
                AnimationSpeedFactorRange    = 0.4 0.6
            End
            Flags                            = MAINTAIN_FRAME_ACROSS_STATES2
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                PrevAnim = CurDrawablePrevAnimation()
                if PrevState == "Ready_Bow" or PrevState == "Moving_Bow" or PrevState == "Bored_Bow"
                then
                    CurDrawableShowSubObject("arrow")
                    CurDrawableShowSubObject("arrownock")
                    return "WantSword"
                elseif PrevState == "STATE_Fly"
                then
                    if PrevAnim == "Bow" or PrevAnim == "WantSword"
                    then
                        CurDrawableShowSubObject("arrow")
                        CurDrawableShowSubObject("arrownock")
                        return "WantSword"
                    end
                end
                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
                return "Sword"
            EndScript
        End


        AnimationState                        = DYING DEATH_1 SPLATTED
            StateName                        = STATE_Dead
            Animation                        = Sword
                AnimationName                = EUHaldir_LNDB
                AnimationMode                = ONCE
            End
        End


        AnimationState                        = DYING DEATH_1
            Animation                        = Sword1
                AnimationName                = EUHaldir_DIESv5
                AnimationMode                = ONCE
            End
            Animation                        = Sword2
                AnimationName                = EUHaldir_DIESV5
                AnimationMode                = ONCE
            End
            Animation                        = WantSword
                AnimationName                = EUHaldir_LNDB
                AnimationMode                = ONCE
            End
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                PrevAnim = CurDrawablePrevAnimation()
                if PrevState == "STATE_Fly"
                then
                    CurDrawableShowSubObject("arrow")
                    CurDrawableShowSubObject("arrownock")
                    return "WantSword"
                end
                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
                if GetClientRandomNumberReal(0,2) < 1
                then
                    return "Sword1"
                else
                    return "Sword2"
                end
            EndScript
        End



        AnimationState                        = STUNNED_STANDING_UP
            StateName                        = STATE_GetUp
            Animation                        = Sword
                AnimationName                = EUHaldir_GTPSX1
                AnimationMode                = ONCE
                AnimationSpeedFactorRange    = 1.2    1.2
            End
            Animation                        = WantSword
                AnimationName                = EUHaldir_GTPB
                AnimationMode                = ONCE
            End
            Flags                            = MAINTAIN_FRAME_ACROSS_STATES4
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                PrevAnim = CurDrawablePrevAnimation()
                if PrevState == "STATE_GetUp" or PrevState == "STATE_Land"
                then
                    if PrevAnim == "Bow" or PrevAnim == "WantSword"
                    then
                        CurDrawableShowSubObject("arrow")
                        CurDrawableShowSubObject("arrownock")
                        return "WantSword"
                    end
                end
                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
                return "Sword"
            EndScript
        End


        AnimationState                        = STUNNED
            StateName                        = STATE_Land
            Animation                        = Sword
                AnimationName                = EUHaldir_LNDB
                AnimationMode                = ONCE
            End
            Animation                        = WantSword
                AnimationName                = EUHaldir_LNDA
                AnimationMode                = ONCE
            End
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                PrevAnim = CurDrawablePrevAnimation()
                if PrevState == "STATE_Fly"
                then
                    if PrevAnim == "WantSword" or PrevAnim == "Bow"
                    then
                        CurDrawableShowSubObject("arrow")
                        CurDrawableShowSubObject("arrownock")
                        return "WantSword"
                    end
                end
                Flags                        = MAINTAIN_FRAME_ACROSS_STATES3
                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
                return "Sword"
            EndScript
        End

        AnimationState                        = PARALYZED
            Animation
                AnimationName                = EUHaldir_IDLF
                AnimationMode                = LOOP
            End
        End


        AnimationState                        = FIRING_OR_PREATTACK_A
            StateName                        = Ready_Sword

            Animation                        = AttackWithSwordA
                AnimationName                = EUHaldir_ATKSV2
                AnimationMode                = ONCE
                UseWeaponTiming                = Yes
            End
            Animation                        = AttackWithSwordB
                AnimationName                = EUHaldir_ATKSV2
                AnimationMode                = ONCE
                UseWeaponTiming                = Yes
            End
            Animation                        = AttackWithSwordD
                AnimationName                = EUHaldir_ATKSV4
                AnimationMode                = ONCE
                UseWeaponTiming                = Yes
            End
            BeginScript
                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
            EndScript
        End

        AnimationState                        = FIRING_OR_PREATTACK_B
            StateName                        = Ready_Sword

            Animation                        = AttackWithSwordA
                AnimationName                = EUHaldir_ATKSV2
                AnimationMode                = ONCE
                UseWeaponTiming                = Yes
            End
            Animation                        = AttackWithSwordB
                AnimationName                = EUHaldir_ATKSV2
                AnimationMode                = ONCE
                UseWeaponTiming                = Yes
            End
            Animation                        = AttackWithSwordD
                AnimationName                = EUHaldir_ATKSV4
                AnimationMode                = ONCE
                UseWeaponTiming                = Yes
            End
            BeginScript
                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
            EndScript
        End


        AnimationState                        = MOVING
            StateName                        = Moving_Sword
            Animation
                AnimationName                = EUHaldir_RUNS
                AnimationMode                = LOOP
            End
            Flags = RANDOMSTART
            BeginScript
                CurDrawableHideSubObject("arrow")
                CurDrawableHideSubObject("arrownock")
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Moving_Bow" then CurDrawableSetTransitionAnimState("TRANS_BowToSword_Moving") end
            EndScript
        End


        AnimationState                        = MOVING BACKING_UP
            StateName                        = STATE_BackingUp
            Animation                        = Sword
                AnimationName                = EUHaldir_BAKS
                AnimationMode                = LOOP
            End
            Animation                        = WantSword
                AnimationName                = EUHaldir_BAKS
                AnimationMode                = LOOP
            End
            Flags                            = MAINTAIN_FRAME_ACROSS_STATES4
            BeginScript
                CurDrawableHideSubObject("ARROW")
                CurDrawableHideSubObject("ARROWNOCK")
                PrevAnim    = CurDrawablePrevAnimation()
                PrevState    = CurDrawablePrevAnimationState()
                if PrevState == "STATE_BackingUp"
                then
                    if PrevAnim == "Bow" or PrevAnim == "WantSword"
                    then
                        return "WantSword"
                    end
                end
                return "Sword"
            EndScript
        End


        AnimationState                        = CONTINUOUS_FIRE_MEAN
            Animation                        = HangFrameWhileCoasting
                AnimationName                = EUHaldir_ATA2
                AnimationMode                = MANUAL
                AnimationBlendTime            = 20
            End
            Flags                            = START_FRAME_LAST
            BeginScript
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("ARROWNOCK")
                if CurDrawablePrevAnimationState() == "STATE_Firing" then CurDrawableAllowToContinue() end
            EndScript
        End
        AnimationState                        = CONTINUOUS_FIRE_SLOW
            StateName                        = Ready_Bow
            Animation                        = PutAwayArrow
                AnimationName                = EUHaldir_ATA3
                AnimationMode                = ONCE
            End
            BeginScript
                CurDrawableShowSubObject("arrow")
                CurDrawableShowSubObject("ARROWNOCK")
            EndScript
        End


        AnimationState                        = ATTACKING
            StateName                        = Ready_Sword
            Animation                        = Alert_1
                AnimationName                = EUHaldir_IDLST1
                AnimationMode                = LOOP
            End
            BeginScript
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
                if Prev == "Bored_Sword" then CurDrawableSetTransitionAnimState("TRANS_BR_Sword") end
                if Prev == "Selected_Bow" or Prev == "Moving_Bow" or Prev == "Ready_Bow" or Prev == "Bored_Bow" or PrevAnim == "WantSword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BowToSword_Ready")
                end
            EndScript
        End


        AnimationState                        = ENGAGED
            StateName                        = Ready_Sword
            Animation                        = Alert_1
                AnimationName                = EUHaldir_IDLST1
                AnimationMode                = LOOP
            End
            BeginScript
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
                if Prev == "Bored_Sword"        then CurDrawableSetTransitionAnimState("TRANS_BR_Sword")            end
                if Prev == "Selected_Bow" or Prev == "Moving_Bow" or Prev == "Ready_Bow" or Prev == "Bored_Bow" or PrevAnim == "WantSword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BowToSword_Ready")
                end
            EndScript
        End


        AnimationState                        = EMOTION_ALERT
            StateName                        = Ready_Sword
            Animation                        = Alert_1
                AnimationName                = EUHaldir_IDLST1
                AnimationMode                = LOOP
            End
            BeginScript
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("ArrowNock")
                CurDrawableHideSubObject("arrow")
                if Prev == "Bored_Sword" then CurDrawableSetTransitionAnimState("TRANS_BR_Sword") end
                if Prev == "Selected_Bow" or Prev == "Moving_Bow" or Prev == "Ready_Bow" or Prev == "Bored_Bow" or PrevAnim == "WantSword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BowToSword_Ready")
                end
            EndScript
        End


        AnimationState                        = EMOTION_CELEBRATING
            StateName                        = STATE_Emotion_Sword
            Animation                        = Sword
                AnimationName                = EUHaldir_CHRS
                AnimationMode                = ONCE
            End
            Animation                        = Sword2
                AnimationName                = EUHaldir_CHRS
                AnimationMode                = ONCE
            End
            Flags                            = MAINTAIN_FRAME_ACROSS_STATES RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("arrow")
                CurDrawableHideSubObject("arrownock")

                if PrevState == "STATE_Emotion_Bow"
                then
                    CurDrawableAllowToContinue()
                    if( CurDrawablePrevAnimFraction() > .89 )
                    then
                        CurDrawableSetTransitionAnimState("TRANS_BowToSword_Ready")
                    end
                elseif PrevState == "STATE_Emotion_Sword"
                then
                    CurDrawableAllowToContinue()
                elseif PrevState == "Bored_Sword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BR_Sword")
                end
            EndScript
        End


        AnimationState                        = EMOTION_TAUNTING
            StateName                        = STATE_Emotion_Sword
            Animation                        = Sword
                AnimationName                = EUHaldir_TNTB
                AnimationMode                = ONCE
            End
            Animation                        = Sword2
                AnimationName                = EUHaldir_TNTB
                AnimationMode                = ONCE
            End
            Flags                            = RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("arrow")
                CurDrawableHideSubObject("arrownock")
                if PrevState == "STATE_Emotion_Bow"
                then
                    CurDrawableAllowToContinue()
                    if( CurDrawablePrevAnimFraction() > .89 )
                    then
                        CurDrawableSetTransitionAnimState("TRANS_BowToSword_Ready")
                    end
                elseif PrevState == "STATE_Emotion_Sword"
                    then
                        CurDrawableAllowToContinue()
                elseif PrevState == "Bored_Sword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BR_Sword")
                end
            EndScript
        End


        AnimationState                        = EMOTION_POINTING
            StateName                        = STATE_Emotion_Sword
            Animation                        = Sword
                AnimationName                = EUHaldir_PNTB
                AnimationMode                = ONCE
            End
            Animation                        = Sword2
                AnimationName                = EUHaldir_PNTB
                AnimationMode                = ONCE
            End
            Flags                            = MAINTAIN_FRAME_ACROSS_STATES RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("arrow")
                CurDrawableHideSubObject("arrownock")

                if PrevState == "STATE_Emotion_Bow"
                then
                    CurDrawableAllowToContinue()
                    if( CurDrawablePrevAnimFraction() > .89 )
                    then
                        CurDrawableSetTransitionAnimState("TRANS_BowToSword_Ready")
                    end
                elseif PrevState == "STATE_Emotion_Sword"
                then
                    CurDrawableAllowToContinue()
                elseif PrevState == "Bored_Sword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BR_Sword")
                end
            EndScript
        End


        AnimationState                        = HIT_REACTION HIT_LEVEL_1
            StateName                        = Bored_Sword
            Animation
                AnimationName                = EUHaldir_HITE
                AnimationMode                = ONCE
            End
        End


        AnimationState                        = RAISING_FLAG
            StateName                        = STATE_Emotion_Sword
            Animation                        = Sword
                AnimationName                = EUHaldir_CHRS
                AnimationMode                = ONCE
            End
            Animation                        = Sword2
                AnimationName                = EUHaldir_CHRS
                AnimationMode                = ONCE
            End
            Flags                            = RESTART_ANIM_WHEN_COMPLETE
        End

        AnimationState                        = SELECTED
            StateName                        = Selected_Sword
            Animation                        = ATNA
                AnimationName                = EUHaldir_ATNS
                AnimationMode                = LOOP
            End
            BeginScript
                CurDrawableHideSubObject("ARROW")
                CurDrawableHideSubObject("ARROWNOCK")
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Emotion_Bow" or Prev == "STATE_Emotion_Sword" then CurDrawableAllowToContinue() end
                if Prev == "Bored_Sword" then CurDrawableSetTransitionAnimState("TRANS_BoredToSelected_Sword") end
                if Prev == "Ready_Sword" then CurDrawableSetTransitionAnimState("TRANS_ReadyToSelected_Sword") end
                if Prev == "Selected_Bow" or Prev == "Moving_Bow" or Prev == "Ready_Bow" or Prev == "Bored_Bow" or PrevAnim == "WantSword" or PrevAnim == "EUHaldir_STHB"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BowToSword_Selected")
                end
            EndScript
        End


        IdleAnimationState
            StateName                        = Bored_Sword
            Animation                        = Idle_Sword1
                AnimationName                = EUHaldir_IDLF
                AnimationMode                = ONCE
            End
            Animation                        = Idle_Sword2
                AnimationName                = EUHaldir_IDLF
                AnimationMode                = ONCE
            End
            Animation                        = Idle_Sword3
                AnimationName                = EUHaldir_IDLF
                AnimationMode                = ONCE
            End
            Animation                        = IdleNoFidget
                AnimationName                = EUHaldir_IDLF
                AnimationMode                = ONCE
                AnimationPriority            = 20
            End
            Animation                        = IdleNoFidget2
                AnimationName                = EUHaldir_IDLF
                AnimationMode                = ONCE
                AnimationPriority            = 0
            End
            Flags                            = RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                CurDrawableHideSubObject("ARROW")
                CurDrawableHideSubObject("ARROWNOCK")
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                if Prev == "TRANS_SelectedToBored_Sword" or Prev == "TRANS_RB_Sword" then return "IdleNoFidget" end
                if Prev == "Selected_Sword" then CurDrawableSetTransitionAnimState("TRANS_SelectedToBored_Sword") end
                if Prev == "Ready_Sword" then CurDrawableSetTransitionAnimState("TRANS_RB_Sword") end
                if Prev == "Selected_Bow" or Prev == "Moving_Bow" or Prev == "Ready_Bow" or Prev == "Bored_Bow" or PrevAnim == "WantSword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BowToSword_Selected")
                end
            EndScript
        End




        TransitionState                        = TRANS_BoredToSelected_Bow
            Animation
                AnimationName                = EUHaldir_ATNB
                AnimationMode                = ONCE
                AnimationBlendTime            = 10
            End
        End


        TransitionState                        = TRANS_SelectedToReady_Bow
            Animation                        = ATNE
                AnimationName                = EUHaldir_IDLB
                AnimationMode                = ONCE
                AnimationBlendTime            = 10
            End
        End


        TransitionState                        = TRANS_SelectedToBored_Bow
            Animation
                AnimationName                = EUHaldir_ATNB
                AnimationMode                = ONCE_BACKWARDS
            End
            Flags                            = START_FRAME_LAST
        End


        TransitionState                        = TRANS_RS_Bow
            Animation                        = ATNF
                AnimationName                = EUHaldir_IDLB
                AnimationMode                = ONCE_BACKWARDS
                AnimationBlendTime            = 10
            End
            Flags                            = START_FRAME_LAST
        End


        TransitionState                        = TRANS_BR_Bow
            Animation                        = IDLB
                AnimationName                = EUHaldir_IDLST1
                AnimationMode                = ONCE
                AnimationBlendTime            = 20
            End
        End


        TransitionState                        = TRANS_RB_Bow
            Animation                        = IDLD
                AnimationName                = EUHaldir_IDLB
                AnimationMode                = ONCE
                AnimationBlendTime            = 20
            End
        End


        TransitionState                    = TRANS_BoredToSelected_Sword
            Animation                    = ATNA
                AnimationName            = EUHaldir_ATNA
                AnimationMode            = ONCE
            End
        End


        TransitionState                    = TRANS_SR_Sword
            Animation                    = ATNC
                AnimationName            = EUHaldir_STHA
                AnimationMode            = ONCE
            End
        End


        TransitionState                    = TRANS_SelectedToBored_Sword
            Animation                    = ATNA
                AnimationName            = EUHaldir_ATNA
                AnimationMode            = ONCE_BACKWARDS
            End
            Flags                        = START_FRAME_LAST
        End


        TransitionState                    = TRANS_ReadyToSelected_Sword
            Animation                    = ATNC
                AnimationName            = EUHaldir_IDLST1
                AnimationMode            = ONCE_BACKWARDS
                AnimationBlendTime        = 20
            End
            Flags                        = START_FRAME_LAST
        End


        TransitionState                    = TRANS_BR_Sword
            Animation                    = ATNS
                AnimationName            = EUHaldir_STHA
                AnimationMode            = ONCE
                AnimationBlendTime        = 20
            End
        End


        TransitionState                    = TRANS_RB_Sword
            Animation                    = IDLG
                AnimationName            = EUHaldir_STHA
                AnimationMode            = ONCE
                AnimationBlendTime        = 20
            End
        End



        TransitionState                    = TRANS_SwordToBow_Moving
            Animation                    = DrawBow
                AnimationName            = EUHaldir_STHC
                AnimationMode            = ONCE
            End
        End


        TransitionState                    = TRANS_BowToSword_Moving
            Animation                    = DrawSword
                AnimationName            = EUHaldir_STHD
                AnimationMode            = ONCE
            End
        End


        TransitionState                    = TRANS_BowToSword_Ready
            Animation                    = DrawSwords
                AnimationName            = EUHaldir_STHA
                AnimationMode            = ONCE
            End
        End


        TransitionState                    = TRANS_SwordToBow_Ready
            Animation                    = DrawBow
                AnimationName            = EUHaldir_STHB
                AnimationMode            = ONCE
            End
        End


        TransitionState                    = TRANS_BowToSword_Selected
            Animation                    = DrawSwords
                AnimationName            = EUHaldir_STHA
                AnimationMode            = ONCE
            End
        End


        TransitionState                    = TRANS_SwordToBow_Selected
            Animation                    = DrawBow
                AnimationName            = EUHaldir_STHB
                AnimationMode            = ONCE
            End
        End
    End



    Draw = W3DScriptedModelDraw Icon
        ModelConditionState = NONE
            Model           = bbox
        End
    End



    #include "..\..\..\includes\StunDrawModuleSmall.inc"


    Side = Imladris
    EditorSorting = UNIT
    ThreatLevel = ELROND_THREAT
    ThingClass = CHARACTER_UNIT
    TransportSlotCount = TRANSPORTSLOTCOUNT_HERO
    DisplayMeleeDamage  = STRONG_HERO_DAMAGE
    BuildCost = ELRONDDAG_COST
    BuildTime = SILMARIL_HERO_BUILDTIME
    MaxSimultaneousOfType                 = 1

    ; WeaponSet
        ; Conditions        = None
        ; Weapon            = PRIMARY    ElrondNewSword
        ; AutoChooseSources = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    ; End

    WeaponSet
      ; Conditions        = SPECIAL_ONE
        Weapon            = PRIMARY    ElrondWaterSword
      ; Weapon            = SECONDARY  ElrondNewSword
        OnlyAgainst       = SECONDARY  STRUCTURE BLOCKING_GATE
        AutoChooseSources = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End

    ArmorSet
        Conditions      = None
        Armor           = StrongHeroArmor
        DamageFX        = NormalDamageFX
    End

    VisionRange = 300
    ShroudClearingRange = 400

    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = 200
    VisionBonusPercentPerFoot = 1.0%


    BountyValue = ELVEN_ELROND_BOUNTY_VALUE
    RecruitText = CONTROLBAR:ElrondRecruit
    ReviveText  = CONTROLBAR:ElrondRevive
    Hotkey      = CONTROLBAR:ElvenElrondHotkey
    DisplayName = OBJECT:ElvenElrond
    CrushableLevel = 3

    CommandSet = ElrondMODCommandSet
    CommandPoints = 0


    AutoResolveUnitType = AutoResolveUnit_Hero
    AutoResolveCombatChain = AutoResolve_HeroCombatChain

    AutoResolveBody = AutoResolve_ElrondBody

    AutoResolveArmor
        Armor = AutoResolve_ElrondArmor
    End

    AutoResolveWeapon
        Weapon = AutoResolve_ElrondWeapon
    End

    AutoResolveLeadership = AutoResolve_ElrondBonus




    VoiceCreated                                  = ElrondModVoiceCreate
    VoiceFullyCreated                             = ElrondModVoiceCreate
    VoiceAttack                                   = ElrondModVoiceAttack
    VoiceAttackCharge                             = ElrondModVoiceAttack
    VoiceAttackMachine                            = ElrondModVoiceAttack
    VoiceAttackStructure                          = ElrondModVoiceAttack
    VoiceFear                                     = ElrondModVoiceHelp
    VoiceGuard                                    = ElrondModVoiceMove
    VoiceMove                                     = ElrondModVoiceMove
    VoiceMoveToCamp                               = ElrondModVoiceMove
    VoicePriority                                 = 95
    VoiceRetreatToCastle                          = ElrondVoiceRetreat
    VoiceSelect                                   = ElrondModVoiceSelect
    VoiceSelectBattle                             = ElrondModVoiceSelect

    SoundImpact                                   = ImpactHorse

    UnitSpecificSounds
        VoiceEnterUnitElvenTransportShip          = ElrondModVoiceMove
        VoiceGarrison                             = ElrondModVoiceMove
        VoiceInitiateCaptureBuilding              = ElrondModVoiceMove
    End


    CrowdResponseKey = ElfHero

    #include "..\..\..\includes\StandardUnitEvaEvents.inc"
    EvaEventDieOwner            = ElrondDie

    Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
        Key = Humanoid_Male Elf_Male Unit Infantry Hero
    End

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap                    = 800
        AnimationSound                        = Sound:ArrowDrawBow                    Animation:EUHaldir_SKL.EUHaldir_ATA1    Frames:6
        AnimationSound                        = Sound:ArrowDrawBow                    Animation:EUHaldir_SKL.EUHaldir_ATA2    Frames:18
        AnimationSound                        = Sound:SwordShingClean1                Animation:EUHaldir_SKL.EUHaldir_STHA     Frames:24
        AnimationSound                        = Sound:SwordIntoScabbard1              Animation:EUHaldir_SKL.EUHaldir_STHB     Frames:9
        AnimationSound                        = Sound:WeaponSwitchBow                 Animation:EUHaldir_SKL.EUHaldir_STHB     Frames:15
        AnimationSound                        = Sound:SwordShingClean1                Animation:EUHaldir_SKL.EUHaldir_STHC     Frames:20
        AnimationSound                        = Sound:SwordIntoScabbard1              Animation:EUHaldir_SKL.EUHaldir_STHD     Frames:5
        AnimationSound                        = Sound:WeaponSwitchBow                 Animation:EUHaldir_SKL.EUHaldir_STHD     Frames:8
        AnimationSound                        = Sound:SwordShingClean1                Animation:EUHaldir_SKL.EUHaldir_RUNC     Frames:14
        AnimationSound                        = Sound:SwordIntoScabbard1              Animation:EUHaldir_SKL.EUHaldir_RUNT     Frames:4
        AnimationSound                        = Sound:WeaponSwitchBow                 Animation:EUHaldir_SKL.EUHaldir_RUNT     Frames:16
        AnimationSound                        = Sound:BodyFallSoldier                 Animation:EUHaldir_SKL.EUHaldir_LNDA     Frames:9
        AnimationSound                        = Sound:BodyFallSoldier                 Animation:EUHaldir_SKL.EUHaldir_LNDB     Frames:1
        AnimationSound                        = Sound:BodyFallGenericNoArmor          Animation:EUHaldir_SKL.EUHaldir_DIEB     Frames:82
        AnimationSound                        = Sound:BodyFallSoldier                 Animation:EUHaldir_SKL.EUHaldir_DIEBV5   Frames:25
        AnimationSound                        = Sound:BodyFallSoldier                 Animation:EUHaldir_SKL.EUHaldir_DIESV4   Frames:26
        AnimationSound                        = Sound:BodyFallGenericNoArmor          Animation:EUHaldir_SKL.EUHaldir_DIESV5   Frames:100
    End



    RadarPriority = UNIT
    KindOf = HERO PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY ATTACK_NEEDS_LINE_OF_SIGHT PATH_THROUGH_EACH_OTHER SCORE ARMY_SUMMARY HEAVY_MELEE_HITTER
    PathfindDiameter = 40.0
    CamouflageDetectionMultiplier = CAMOUFLAGE_DETECTION_DISTANCE_MEDIUM

    Body = RespawnBody ModuleTag_RespawnBody
        CheerRadius                  = EMOTION_CHEER_RADIUS
        MaxHealth                    = ELRONDDAG_HEALTH
        PermanentlyKilledByFilter    = NONE
        DodgePercent                 = HERO_DODGE_PERCENT
    End

    Behavior = RespawnUpdate ModuleTag_RespawnUpdate
    End


    #include "..\..\..\includes\DefaultInvisibilityUpdate.inc"

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = Hero
    End







    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_FarsightUnpause
        SpecialPowerTemplate    = SpecialAbilityElrondFarsight
        TriggeredBy             = Upgrade_Level_1
    End
    Behavior = OCLSpecialPower ModuleTag_FarsightOCL
        StartsPaused            = Yes
        SpecialPowerTemplate    = SpecialAbilityElrondFarsight
        OCL                     = OCL_SpecialPowerFarSeeing
        CreateLocation          = CREATE_AT_LOCATION
    End







    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_LautwasserEnabler
        SpecialPowerTemplate = SpecialAbilityZornderLautwasser
        TriggeredBy = Upgrade_Level_10
    End

    Behavior = SpecialPowerModule ModuleTag_LautwasserStarter
        SpecialPowerTemplate        = SpecialAbilityZornderLautwasser
        UpdateModuleStartsAttack    = Yes
        StartsPaused                = Yes
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_LautwasserUpdate
        SpecialPowerTemplate    = SpecialAbilityZornderLautwasser
        UnpackTime              = 1300
        PackTime                = 1500
        StartAbilityRange 	= 100.0
        SpecialWeapon 		= ElrondPersonalFlood
        WhichSpecialWeapon 	= 1
    End

    Behavior = AutoAbilityBehavior ModuleTag_LautwasserAutoAbility
        SpecialAbility              = SpecialAbilityZornderLautwasser
        MinScanRange                = 100
        MaxScanRange                = 200
        Query                       = 1 ANY ENEMIES +STRUCTURE +HERO
        Query                       = 20 ALL ENEMIES
    End







    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_FloodEnabler
        SpecialPowerTemplate = SpecialAbilityPersonalFlood
        TriggeredBy = Upgrade_Level_10
    End

    Behavior = SpecialPowerModule ModuleTag_FloodStarter
        SpecialPowerTemplate        = SpecialAbilityPersonalFlood
        UpdateModuleStartsAttack    = Yes
        StartsPaused                = Yes
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_FloodUpdate
        SpecialPowerTemplate    = SpecialAbilityPersonalFlood
        UnpackTime              = 1300
        PackTime                = 1500
        StartAbilityRange 	= 150.0
        SpecialWeapon 		= ElrondRingPersonalFlood
        WhichSpecialWeapon 	= 1
    End

    Behavior = AutoAbilityBehavior ModuleTag_PersonalFloodAutoAbility
        SpecialAbility              = SpecialAbilityPersonalFlood
        MinScanRange                = 150
        MaxScanRange                = 250
        Query                       = 1 ANY ENEMIES +STRUCTURE +HERO
        Query                       = 20 ALL ENEMIES
    End






    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_RatschlagEnabler
        SpecialPowerTemplate         = SpecialAbilityElrondsRatschlag
        TriggeredBy                  = Upgrade_Level_3
    End

    Behavior = SpecialPowerModule ModuleTag_RatschlagSpecialPowerModule
        SpecialPowerTemplate         = SpecialAbilityElrondsRatschlag
        StartsPaused                 = Yes
        UpdateModuleStartsAttack     = Yes
        InitiateSound                = ElrondsRatschlagSound
    End

    Behavior = LevelGrantSpecialPower ModuleTag_Ratschlag
        SpecialPowerTemplate         = SpecialAbilityElrondsRatschlag
        UnpackingVariation           = 2
        StartAbilityRange            = 200.0
        LevelFX                      = FX_ElrondsRatschlagFX
        Experience                   = 500
        RadiusEffect                 = 30
        AcceptanceFilter             = NONE +HERO +GasthausPalando +GasthausAlatar +ImladrisGwaihirFortressEagle +ImladrisGwaihir -ImladrisElrond -ImladrisElrond_RingHero -ImladrisElrond_Summoned ALLIES
        UnpackTime                   = 1200
        PreparationTime              = 0
        FreezeAfterTriggerDuration   = 2000
    End






    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_LehrenEnabler
        SpecialPowerTemplate         = SpecialAbilityElrondsLehren
        TriggeredBy                  = Upgrade_Level_3
    End

    Behavior = SpecialPowerModule ModuleTag_LehrenSpecialPowerModule
        SpecialPowerTemplate         = SpecialAbilityElrondsLehren
        StartsPaused                 = Yes
        UpdateModuleStartsAttack     = Yes
        InitiateSound                = ElrondsRatschlagSound
    End

    Behavior = LevelGrantSpecialPower ModuleTag_Lehren
        SpecialPowerTemplate         = SpecialAbilityElrondsLehren
        UnpackingVariation           = 2
        StartAbilityRange            = 200.0
        LevelFX                      = FX_ElrondsRatschlagFX
        Experience                   = 10000
        RadiusEffect                 = 30
        AcceptanceFilter             = NONE +HERO +GasthausPalando +GasthausAlatar +ImladrisGwaihirFortressEagle +ImladrisGwaihir -ImladrisElrond -ImladrisElrond_RingHero -ImladrisElrond_Summoned ALLIES
        UnpackTime                   = 1200
        PreparationTime              = 0
        FreezeAfterTriggerDuration   = 2000
    End







    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_ElrondsErfahrungsLeadership
        SpecialPowerTemplate      = SpecialAbilityFakeLeadership3
        TriggeredBy               = Upgrade_Level_1
    End

    Behavior = SpecialPowerModule ModuleTag_ElrondsErfahrungsLeadershipUpdate
        SpecialPowerTemplate      = SpecialAbilityFakeLeadership3
        UpdateModuleStartsAttack  = No
        StartsPaused              = Yes
    End
    Behavior = AttributeModifierAuraUpdate ModuleTag_Leadership2
        StartsActive              = No
        BonusName                 = ElrondNeueLeadership
        TriggeredBy               = Upgrade_Level_1
        RefreshDelay              = 2000
        Range                     = 200

        ObjectFilter              = GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
    End

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_TheodenLeadership
        SpecialPowerTemplate     = SpecialAbilityFakeLeadership
        TriggeredBy              = Upgrade_Level_1
    End

    Behavior = SpecialPowerModule ModuleTag_TheodenLeadershipUpdate
        SpecialPowerTemplate     = SpecialAbilityFakeLeadership
        UpdateModuleStartsAttack = No
        StartsPaused             = Yes
    End

    Behavior = AttributeModifierAuraUpdate ModuleTag_Leadership
        StartsActive             = No
        BonusName                = ElrondNoldorRustung
        TriggeredBy              = Upgrade_Level_5
        RefreshDelay             = 2000
        Range                    = 1
        AllowSelf                = Yes

        ObjectFilter             = NONE +ImladrisElrond +ImladrisElrond_Arnor
    End

    Behavior = WeaponSetUpgrade WeaponSetUpgradeModuleTagHadhafang
        TriggeredBy              = Upgrade_Level_1
    End

    Behavior = ModelConditionUpgrade ModuleTag_ModellRustung
        TriggeredBy              = Upgrade_Level_1
        AddConditionFlags        = USER_4
    End






    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_RestorationUnpause
        SpecialPowerTemplate        = SpecialAbilityElrondRestoration
        TriggeredBy                 = Upgrade_Level_8
    End
    Behavior = SpecialPowerTimerRefreshSpecialPower ModuleTag_RestorationRefresh
        SpecialPowerTemplate        = SpecialAbilityElrondRestoration
        StartsPaused                = Yes
        UpdateModuleStartsAttack    = No
        AffectAllies                = Yes
        AttributeModifierRange      = 150
        AttributeModifierAffects    = NONE +HERO -ElvenElrond -ImladrisElrond -AngbandFortress -AngbandThangorodrim -TolinGaurhothFortress -UnderworldPortal -BelegostFortress -DorthonionFortress -ArmenelosFortress -GondolinTower -GondolinTower_Summoned -FormenosFortress -MenegrothFortress -TaniquetilFortress -AngbandMelkor -AngbandMelkor_WOR -TolinGaurhothTarMairon -TolinGaurhothTarMairon_WOR -AvatharUngoliant -AvatharUngoliant_WOR -ValinorManwe -ValinorManwe_WOR -DoriathMelian -DoriathMelian_WOR -ValinorEonwe -ValinorEonwe_WOR -ValinorTulkas -ValinorTulkas_WOR -ValinorAule -ValinorAule_WOR ALLIES


    End
    Behavior = PlayerHealSpecialPower ModuleTag_RestorationHeal
        SpecialPowerTemplate        = SpecialAbilityElrondRestorationHeal
        HealAffects                    = HERO
        HealAmount                    = 0.5
        HealRadius                    = 150
        HealFX                        = FX_ElrondHealSpecialPower
    End

    Behavior = AutoHealBehavior ModuleTag_ElrondHealing
        StartsActive = Yes
        HealingAmount = HERO_HEAL_AMOUNT
        HealingDelay = 1000
        StartHealingDelay = HERO_HEAL_DELAY
        HealOnlyIfNotInCombat = Yes
    End

    #include "..\..\..\includes\CaptureBuilding.inc"






    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_ElrondTornadoEnabler
        SpecialPowerTemplate        = SpecialAbilityElrondYilyaTornado
        TriggeredBy                 = Upgrade_Level_5
    End

    Behavior = OCLSpecialPower ModuleTag_OCLSpawnTornado
        StartsPaused                = Yes
        SpecialPowerTemplate        = SpecialAbilityElrondYilyaTornado
        OCL                         = OCL_ElrondVilyaSturmObject
        CreateLocation              = CREATE_AT_LOCATION
        SetModelCondition        = ModelConditionState:USER_1
        SetModelConditionTime    = 2.333
    End


    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_RingLeadership
        SpecialPowerTemplate     = SpecialAbilityFakeLeadership2
        TriggeredBy              = Upgrade_Level_1
    End

    Behavior = SpecialPowerModule ModuleTag_RingLeadershipUpdate
        SpecialPowerTemplate     = SpecialAbilityFakeLeadership2
        UpdateModuleStartsAttack = No
        StartsPaused             = Yes
    End



    Behavior = AIUpdateInterface ModuleTag_03
        AutoAcquireEnemiesWhenIdle = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate        = 500
        CanAttackWhileContained    = Yes
        AILuaEventsList            = ElrondImladrisFunctions
    End


    Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    250
         TauntAndPointUpdateDelay    =    1000

        AddEmotion            =    Doom_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
        AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    Alert_Base
        AddEmotion            =    CheerForAboutToCrush_Base
     End

    LocomotorSet
        Locomotor = IsildurHumanLocomotor
        Condition = SET_NORMAL
        Speed     = NORMAL_ELVEN_FAST_MEMBER_SPEED
    End

    Behavior = PhysicsBehavior ModuleTag_04
        GravityMult            = 1.0
        ShockStandingTime    = 3000
        ShockStunnedTimeLow    = 1000
        ShockStunnedTimeHigh = 1200
    End

    Behavior = SlowDeathBehavior ModuleTag_05
        DeathTypes = ALL -FADED
        SinkDelay = 4300
        SinkRate = 3.0
        DestructionDelay = 8000
        Sound = INITIAL    ElrondVoiceDie
        DeathFlags = DEATH_1
    End

    Behavior = SquishCollide ModuleTag_06

    End


    Behavior = HitReactionBehavior HitReactionBehaviorModuleTag
        HitReactionLifeTimer1 = 7
        HitReactionLifeTimer2 = 15
        HitReactionLifeTimer3 = 10

        HitReactionThreshold1 = 0.0
        HitReactionThreshold2 = 25.0
        HitReactionThreshold3 = 50.0
    End

    Behavior = AutoHealBehavior ModuleTag_ElvenGiftHealing
        StartsActive                = No
        TriggeredBy                 = Upgrade_Level_1
        HealingAmount               = ELVEN_GIFT_REGEN_AMOUNT
        HealingDelay                = ELVEN_GIFT_REGEN_DELAY
        StartHealingDelay           = HERO_HEAL_DELAY
        HealOnlyIfNotInCombat       = Yes
    End

    Behavior = AttributeModifierUpgrade ModuleTag_ElvenGiftBonus
        TriggeredBy = Upgrade_ElvenGift
        AttributeModifier = SpellBookElvenGifts
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    Behavior = AttributeModifierUpgrade ModuleTag_SwordBonus
        TriggeredBy = Upgrade_ZwillingeWaffeSchmieden
        AttributeModifier = GeschmiedeteKlingeElrondModifier
    End





    Behavior = AISpecialPowerUpdate ElrondStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate ElrondStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate ElrondHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Behavior = AISpecialPowerUpdate ElrondCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate ElrondFloodPowerAI
        CommandButtonName = Command_SpecialAbilityZornderLautwasser
        SpecialPowerAIType = AI_SPECIAL_POWER_RANGED_AOE_ATTACK
        SpecialPowerRadius = 100
    End

    Behavior = AISpecialPowerUpdate SpecialPowerElrondGiveXPAoE
        CommandButtonName = Command_SpecialAbilityElrondsRatschlag
        SpecialPowerAIType = AI_SPECIAL_POWER_GIVEXP_AOE
        SpecialPowerRadius = 30.0
    End

    Behavior = AISpecialPowerUpdate ElrondRestorationAI
        CommandButtonName = Command_SpecialAbilityElrondRestoration
        SpecialPowerAIType = AI_SPECIAL_POWER_SELFAOEHEALHEROS
    End

    Behavior = AISpecialPowerUpdate ElrondYilyaTornadoAI
        CommandButtonName = Command_SpecialAbilityElrondYilyaTornado
        SpecialPowerAIType = AI_SPECIAL_POWER_BASIC_SELF_BUFF
        SpecialPowerRadius = 150
    End


    Geometry = CYLINDER
    GeometryMajorRadius = 8.0
    GeometryMinorRadius = 8.0
    GeometryHeight = 19.2
    GeometryIsSmall = Yes
    Shadow = SHADOW_DECAL
    ShadowSizeX = 20
    ShadowSizeY = 20
    ShadowTexture = ShadowI
End

