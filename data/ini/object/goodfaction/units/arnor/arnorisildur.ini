Object GondorIsildur_Mod

    SelectPortrait = HPIsildur
    ButtonImage = HIIsildur

    DescriptionStrategic = CONTROLBAR:LW_ToolTip_Aragorn

    Draw = W3DScriptedModelDraw ModuleTag_DRAW



        OkToChangeModelColor = No
        StaticModelLODMode = yes ; Will append M or L to the skin name depending on GameLOD
        ExtraPublicBone = Arrow 
    
        DefaultModelConditionState
            Model = nuisil
            ParticleSysBone = B_SWORDBONE IsildurNarsilLight FollowBone:yes
        End

        ModelConditionState = WEAPONSET_HERO_MODE USER_3
            ParticleSysBone = BAT_RIBS IsildurNarsil FollowBone:Yes
            ParticleSysBone = BAT_HEAD AragornElendill FollowBone:Yes
        End

        ModelConditionState = WEAPONSET_HERO_MODE
			ParticleSysBone = B_SWORDBONE IsildurNarsilLight FollowBone:yes
			ParticleSysBone = B_SWORDBONE IsildurNarsilLightMode FollowBone:yes
            ParticleSysBone = BAT_RIBS IsildurNarsil FollowBone:Yes
			ParticleSysBone = BAT_RIBS AraforBladeMaster FollowBone:Yes
        End

        ModelConditionState = INVISIBLE_STEALTH
            ParticleSysBone = NONE Predator FollowBone:Yes Persist:SPAWN PersistID:100
            ParticleSysBone = NONE Predator02 FollowBone:Yes Persist:SPAWN PersistID:100
        End

        ModelConditionState = USER_3
            ParticleSysBone = BAT_HEAD AragornElendill FollowBone:Yes
        End

        ModelConditionState = ONE_RING

        End

        ModelConditionState = INVISIBLE_STEALTH ONE_RING
            ParticleSysBone = NONE Predator FollowBone:Yes Persist:SPAWN PersistID:100
            ParticleSysBone = NONE Predator02 FollowBone:Yes Persist:SPAWN PersistID:100

        End

        ModelConditionState = WEAPONSET_HERO_MODE ONE_RING
            ParticleSysBone = BAT_RIBS IsildurNarsil FollowBone:Yes

        End

        ModelConditionState = WEAPONSET_HERO_MODE ONE_RING USER_3
            ParticleSysBone = BAT_RIBS IsildurNarsil FollowBone:Yes
            ParticleSysBone = BAT_HEAD AragornElendill FollowBone:Yes

        End



        TransitionState                = TRANS_boredToAttention_Elendil
            Animation                = GUAragorn_ATND
                AnimationName        = GUAragorn_SKL.GUAragorn_ATND
                AnimationMode        = ONCE
            End
            FXEvent    = Name: FX_ElendilGlowEvent
        End

        TransitionState                = TRANS_attentionToBored_Elendil
            Animation                = GUAragorn_ATND
                AnimationName        = GUAragorn_SKL.GUAragorn_ATND
                AnimationMode        = ONCE_BACKWARDS
            End
            FXEvent                    = Name: FX_ElendilGlowEvent
            Flags                    = START_FRAME_LAST
        End

        TransitionState                = TRANS_boredToAttention
            Animation                = GUAragorn_ATND
                AnimationName        = GUAragorn_SKL.GUAragorn_ATND
                AnimationMode        = ONCE
            End
        End

        TransitionState                = TRANS_attentionToBored
            Animation                = GUAragorn_ATND
                AnimationName        = GUAragorn_SKL.GUAragorn_ATND
                AnimationMode        = ONCE_BACKWARDS
            End
            Flags                    = START_FRAME_LAST
        End


        IdleAnimationState
            StateName                = STATE_bored

            Animation                = GUAragorn_IDLE
                AnimationName        = GUAragorn_SKL.GUAragorn_IDLE
                AnimationMode        = ONCE
                AnimationPriority    = 12
            End

            Animation                = GUAragorn_IDLF
                AnimationName        = GUAragorn_SKL.GUAragorn_IDLF
                AnimationMode        = ONCE
                AnimationPriority    = 1
            End

            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if    Prev == "STATE_attention" or
                    Prev == "STATE_running" or
                    Prev == "OATH_BREAKERS" then CurDrawableSetTransitionAnimState("TRANS_attentionToBored") end
            EndScript
        End

        AnimationState            = THROWN_PROJECTILE
            Animation            = FLYA
                AnimationName    = GUAragorn_SKL.GUAragorn_FLYA
                AnimationMode    = LOOP
            End
        End

        AnimationState            = STUNNED_FLAILING
            Animation            = FLYA
                AnimationName    = GUAragorn_SKL.GUAragorn_FLYA
                AnimationMode    = LOOP
                AnimationSpeedFactorRange    = 0.4 0.6
            End
        End

        AnimationState             = DYING SPLATTED
            Animation         = Splatted_On_Ground
                AnimationName    = GUAragorn_SKL.GUAragorn_LNDA
                AnimationMode    = ONCE
            End
            EnteringStateFX        = FX_SoldierHitGround
        End


        AnimationState                = DYING DEATH_1
            Animation                = GUAragorn_DIEA
                AnimationName        = GUAragorn_SKL.GUAragorn_DIEA
                AnimationMode        = ONCE
            End
            Animation                = GUAragorn_DIEB
                AnimationName        = GUAragorn_SKL.GUAragorn_DIEB
                AnimationMode        = ONCE
            End
        End

        AnimationState                = DYING DEATH_2
            Animation                = GUAragorn_IDLA
                AnimationName        = GUAragorn_SKL.GUAragorn_IDLA
                AnimationMode        = LOOP
            End
        End

        AnimationState                        = PARALYZED
            Animation
                AnimationName                = GUAragorn_IDLE
                AnimationMode                = LOOP
            End
        End

        AnimationState                = STUNNED_STANDING_UP
            Animation                = GUAragorn_GTPB
                AnimationName        = GUAragorn_SKL.GUAragorn_GTPB
                AnimationMode        = ONCE
                AnimationSpeedFactorRange = 1.5 1.5
            End
        End

        AnimationState            = STUNNED
            Animation            = LNDA
                AnimationName    = GUAragorn_SKL.GUAragorn_LNDA
                AnimationMode    = ONCE
            End
            EnteringStateFX        = FX_SoldierHitGround
        End








        AnimationState        = MOVING FIRING_OR_PREATTACK_A
            ShareAnimation        = Yes
            Animation           = RunAndFire
                AnimationName       = GUAragorn_SKL.GUAragorn_ATRA
                AnimationMode       = LOOP
            End
            Flags               = RANDOMSTART
        End











        AnimationState                = FIRING_OR_PREATTACK_A WEAPONSET_HERO_MODE
            StateName                = STATE_ready
            Animation                = ATKF
                AnimationName        = GUAragorn_SKL.GUAragorn_ATKF
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
            End
            Flags                    = RESTART_ANIM_WHEN_COMPLETE
            FXEvent    = Frame:25 Name: FX_IsildurSword
            FXEvent    = Frame:45 Name: FX_IsildurSword
        End

        AnimationState                = FIRING_OR_PREATTACK_A HERO
            StateName                = STATE_Ready
            Animation                = GUAragorn_SPCA
                AnimationName        = GUAragorn_SKL.GUIsildur_SPCA
                AnimationMode        = ONCE
            End

            FXEvent    = Frame:22 Name: FX_IsildurSword
            FXEvent    = Frame:42 Name: FX_IsildurSword
            FXEvent = Frame:67 Name: FX_IsildurSword
        End


        AnimationState                = FIRING_OR_PREATTACK_A
            StateName                = STATE_ready
            Animation                = ATKD
                AnimationName        = GUAragorn_SKL.GUAragorn_ATKD
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 3
            End
            Animation                = ATKE
                AnimationName        = GUAragorn_SKL.GUAragorn_ATKE
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 2
            End
            Flags                    =    RESTART_ANIM_WHEN_COMPLETE
        End







        AnimationState                = MOVING
            StateName                = STATE_running

            Animation                = GUAragorn_RUNB
                AnimationName        = GUAragorn_SKL.GUAragorn_RUNB
                AnimationMode        = LOOP
            End
        End

        AnimationState                = LEVELED
            Animation                = LevelUp
                AnimationName        = GUAragorn_SKL.GUAragorn_ATKO
                AnimationMode        = ONCE
            End
        End

        AnimationState                = SPECIAL_POWER_1
            StateName                = STATE_ready
            Animation                = GUAragorn_ATKL
                AnimationName        = GUAragorn_SKL.GUAragorn_ATKL
                AnimationMode        = ONCE
            End
            ParticleSysBone            = B_SWORDBONE ElendilFlare FollowBone:Yes
            ParticleSysBone            = B_SWORDBONE ElendilSwordFlare FollowBone:Yes

        End



        AnimationState                = USER_1
            StateName                = OATH_BREAKERS
            Animation                = ATKN
                AnimationName        = GUAragorn_SKL.GUAragorn_CHRB
                AnimationMode        = ONCE
            End
        End



        AnimationState        = SPECIAL_WEAPON_ONE
            Animation                = ATKE
                AnimationName        = GUAragorn_SKL.GUAragorn_ATKE
                AnimationMode        = ONCE
                AnimationSpeedFactorRange    =    0.7 0.7
             End
             ParticleSysBone     = B_SWORDBONE IsildurNarsilGlowFX FollowBone:Yes
             ParticleSysBone     = B_SWORDBONE IsildurNarsilSparksFX FollowBone:Yes
         End



        AnimationState        = SPECIAL_WEAPON_TWO
            Animation                = ATKN
                AnimationName        = GUAragorn_SKL.GUAragorn_CHRB
                AnimationMode        = ONCE
            End
        End

          AnimationState        = SPECIAL_WEAPON_THREE
            Animation                = ATKE
                AnimationName        = GUAragorn_SKL.GUAragorn_ATKE
                AnimationMode        = ONCE
            End
        End




        AnimationState                = HIT_REACTION HIT_LEVEL_3
            StateName                = STATE_bored
            Animation                = Hit_Level_1_b
                AnimationName        = GUAragorn_SKL.GUAragorn_HITB
                AnimationMode        = ONCE
            End
        End



        AnimationState                = EMOTION_CELEBRATING
            StateName                = STATE_ready
            Animation                = CHRB
                AnimationName        = GUAragorn_SKL.GUAragorn_CHRB
                AnimationMode        = ONCE
                AnimationPriority    = 1
            End
            Flags                    = RESTART_ANIM_WHEN_COMPLETE
        End

        AnimationState                = EMOTION_TAUNTING
            StateName                = STATE_ready
            Animation                = CHRB
                AnimationName        = GUAragorn_SKL.GUAragorn_CHRB
                AnimationMode        = ONCE
                AnimationPriority    = 1
            End
            Flags                    = RESTART_ANIM_WHEN_COMPLETE
        End

        AnimationState                = EMOTION_ALERT
            StateName                = STATE_ready
            Animation                = IDLA
                AnimationName        = GUAragorn_SKL.GUAragorn_IDLA
                AnimationMode        = ONCE
                AnimationPriority    = 1
            End
        End

        AnimationState                = EMOTION_MORALE_HIGH
            StateName                = STATE_ready
            Animation                = ATKN
                AnimationName        = GUAragorn_SKL.GUAragorn_ATKN
                AnimationMode        = ONCE
                AnimationPriority    = 1
            End
            Animation                = ATKP
                AnimationName        = GUAragorn_SKL.GUAragorn_ATKP
                AnimationMode        = ONCE
                AnimationPriority    = 15
            End
            Animation                = TNTC
                AnimationName        = GUAragorn_SKL.GUAragorn_TNTD
                AnimationMode        = ONCE
                AnimationPriority    = 30
            End
            Animation                = TNTD
                AnimationName        = GUAragorn_SKL.GUAragorn_TNTD
                AnimationMode        = ONCE
                AnimationPriority    = 30
            End
            Flags                    = RESTART_ANIM_WHEN_COMPLETE
        End

        AnimationState                = ENGAGED
            StateName                = STATE_ready
            Animation                = IDLA
                AnimationName        = GUAragorn_SKL.GUAragorn_IDLA
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 1
            End
            Flags                    =    RESTART_ANIM_WHEN_COMPLETE
        End

        AnimationState                = RAISING_FLAG
            StateName                = STATE_ready
            Animation                = CHRB
                AnimationName        = GUAragorn_SKL.GUAragorn_CHRB
                AnimationMode        = LOOP
            End
        End

        AnimationState                = SELECTED
            StateName                = STATE_attention
            Animation                = ATNE
                AnimationName        = GUAragorn_SKL.GUAragorn_ATNE
                AnimationMode        = LOOP
                AnimationBlendTime    = 5
                AnimationMustCompleteBlend = Yes
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_bored" then CurDrawableSetTransitionAnimState("TRANS_boredToAttention") end
            EndScript
        End

    End

    Draw = W3DScriptedModelDraw Icon
        ModelConditionState = NONE
            Model           = bbox
        End
    End


    #include "..\..\..\includes\StunDrawModuleSmall.inc"


    Side = Gondor
    EditorSorting = UNIT
    ThreatLevel = ARAGORN_THREAT_LEVEL
    ThingClass = CHARACTER_UNIT
    TransportSlotCount = TRANSPORTSLOTCOUNT_HERO
    DisplayMeleeDamage = ISILDURDAG_DAMAGE
    HeroSortOrder = 20
    BuildCost = ISILDURDAG_COST
    BuildTime = MEDIUM_HERO_BUILDTIME
    MaxSimultaneousOfType = 1


    WeaponSet
        Conditions        		 = None
        Weapon            		 = PRIMARY     GondorIsildurSword
        Weapon                   = TERTIARY    RohanGimliAxeThrown
        AutoChooseSources        = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
        AutoChooseSources        = TERTIARY NONE
        ShareWeaponReloadTime    = Yes
    End

    WeaponSet
        Conditions        		 = WEAPONSET_HERO_MODE
        Weapon            		 = PRIMARY     IsildurkritischerAnsturmWeapon
        Weapon                   = TERTIARY    RohanGimliAxeThrown
        AutoChooseSources        = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
        AutoChooseSources        = TERTIARY NONE
        ShareWeaponReloadTime    = Yes
    End


    ArmorSet
        Conditions      = None
        Armor           = StrongHeroArmor
        DamageFX        = NormalDamageFX
    End

    VisionRange = VISION_HERO_STANDARD
    ShroudClearingRange = SHROUD_CLEAR_HERO
    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = 200
    VisionBonusPercentPerFoot = 1.0%

    BountyValue = GONDOR_ARAGORN_BOUNTY_VALUE
    DisplayName = OBJECT:GondorIsildur
    RecruitText = CONTROLBAR:GondorIsildurRecruit
    ReviveText    = CONTROLBAR:GondorIsildurRevive
    Hotkey        = CONTROLBAR:GondorIsildurHotkey
    CrushableLevel = 2



    CommandSet = GondorIsildurCommandSet
    CommandPoints = 0

    Behavior = CommandSetUpgrade ModuleTag_BerenHerbs
        TriggeredBy        =  Upgrade_Mornamarth_Arrive Upgrade_Level_5
            RequiresAllTriggers = Yes
        CommandSet        = GondorIsildurHerbsCommandSet
    End



    AutoResolveUnitType = AutoResolveUnit_Hero
    AutoResolveCombatChain = AutoResolve_HeroCombatChain

    AutoResolveBody = AutoResolve_AragornBody

    AutoResolveArmor
        Armor = AutoResolve_AragornArmor
    End

    AutoResolveWeapon
        Weapon = AutoResolve_AragornWeapon
    End

    AutoResolveLeadership = AutoResolve_AragornBonus




    VoiceAttack                = IsildurModVoiceAttack
    VoiceAttackCharge            = IsildurModVoiceAttack
    VoiceAttackMachine        = IsildurModVoiceAttack
    VoiceAttackStructure        = IsildurModVoiceAttack
    VoiceCreated                = IsildurModVoiceCreated
    VoiceFullyCreated         = IsildurModVoiceCreated
    VoiceFear                 = IsildurModVoiceHelpMe
    VoiceMove                = IsildurModVoiceMove
    VoiceMoveToCamp            = IsildurModVoiceMove
    VoiceMoveWhileAttacking        = IsildurModVoiceSelect
    VoicePriority            = 90
    VoiceRetreatToCastle        = IsildurModVoiceMove
    VoiceSelect                = IsildurModVoiceSelect
    VoiceSelectBattle         = IsildurModVoiceSelect
    VoiceGuard                = IsildurModVoiceSelect

    SoundImpact                = ImpactHorse


    UnitSpecificSounds
        VoiceGarrison                        = IsildurModVoiceSelect
        VoiceEnterUnitElvenTransportShip    = IsildurModVoiceMove
        VoiceInitiateCaptureBuilding        = IsildurModVoiceMove
    End

    CrowdResponseKey = GoodMen

    #include "..\..\..\includes\StandardUnitEvaEvents.inc"


    Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
        Key = Humanoid_Male Man Man_Male Unit Infantry Hero

    End

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound:AragornVoiceElendil                 Animation:GUAragorn_SKL.GUAragorn_ATKL    Frames:21
        AnimationSound = Sound:AragornVoiceEnterStateElendil             Animation:GUAragorn_SKL.GUAragorn_ATKL    Frames:21
        AnimationSound = Sound:FootstepDirtA                    Animation:GUAragorn_SKL.GUAragorn_RUNB    Frames:8 17 26 36

        AnimationSound = Sound:BodyFallGenericNoArmor                Animation:GUAragorn_SKL.GUAragorn_DIEA    Frames:55
        AnimationSound = Sound:BodyFallGenericNoArmor                Animation:GUAragorn_SKL.GUAragorn_DIEB    Frames:70
        AnimationSound = Sound:BodyFallSoldier                    Animation:GUAragorn_SKL.GUAragorn_LNDA    Frames:1
    End



    RadarPriority = UNIT
    KindOf = PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE HERO ARMY_SUMMARY HEAVY_MELEE_HITTER
    PathfindDiameter = 40.0

    Body = ActiveBody ModuleTag_02
        CheerRadius             = EMOTION_CHEER_RADIUS
        MaxHealth               = ISILDURDAG_HEALTH
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = Hero
    End

    #include "..\..\..\includes\CaptureBuilding.inc"


    Behavior = AIUpdateInterface ModuleTag_03
        AutoAcquireEnemiesWhenIdle = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate        = 500
        AILuaEventsList            = AragornFunctions
    End

    Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance                = 300
        TauntAndPointUpdateDelay            = 10000
        AddEmotion            =    Doom_Base



        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
         AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base


        AddEmotion            =    Alert_Base
        AddEmotion            =    CheerForAboutToCrush_Base
    End

    LocomotorSet
        Locomotor = HeroHumanLocomotor
        Condition = SET_NORMAL
        Speed     = NORMAL_GOOD_HERO_SPEED
    End

    Behavior = PhysicsBehavior ModuleTag_04
        GravityMult = 1.0
        ShockStandingTime = 2133
    End

    Behavior = SlowDeathBehavior ModuleTag_05
        DeathTypes = ALL -FADED
        SinkDelay = 3000
        SinkRate = 0.40
        DestructionDelay = 8000
        Sound = INITIAL AragornVoiceDie
        DeathFlags = DEATH_1
    End

    Behavior = SquishCollide ModuleTag_06

    End







    

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_TheodenLeadership
        SpecialPowerTemplate = SpecialAbilityFakeLeadership
        TriggeredBy = Upgrade_Level_1
    End

    Behavior = SpecialPowerModule ModuleTag_TheodenLeadershipUpdate
        SpecialPowerTemplate      = SpecialAbilityFakeLeadership
        UpdateModuleStartsAttack  = No
        StartsPaused = No
    End
	
	Behavior = AttributeModifierAuraUpdate ModuleTag_Leadership
        StartsActive    = Yes
        BonusName       = KonigNumenoren2
        RefreshDelay    = 2000
        Range           = 200

        ObjectFilter    = NONE +ValinorThorondor +GondorImrahil +GondorBoromir +GondorFaramir +EdainBeren +DoriathLuthien +GondorBeregond +GondorAragornEntwicklung1 +GondorAragornEntwicklung2 +GondorAragornEntwicklung3 +GondorAragornEntwicklung4 +NargothrondFinrod +GondorIsildur_Mod +GondorGandalf ALLIES
    End

    Behavior = SpecialPowerModule ModuleTag_ErobererUpdate
        SpecialPowerTemplate     = SpecialAbilityPrinceOfArnor
        UpdateModuleStartsAttack = Yes
        StartsPaused             = No
        AttributeModifier        = IsildurErobererModifier
        AttributeModifierRange   = 280
        AttributeModifierAffectsSelf = Yes
        AttributeModifierAffects = ANY +INFANTRY +CAVALRY -STRUCTURE -BASE_FOUNDATION +HERO +MACHINE -HORDE ALLIES
        AttributeModifierFX      = FX_ElendilErobererFX
    End

    Behavior = SpecialAbilityUpdate ModuleTag_ErobererAnimation
        UnpackTime               = 1000
        UnpackingVariation       = 1
        SpecialPowerTemplate     = SpecialAbilityPrinceOfArnor
        PreparationTime          = 0
        PersistentPrepTime       = 0
        PackTime                 = 1330
    End



    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_SpecialAbilityHeroModeNarsilEnabler
        SpecialPowerTemplate         = SpecialAbilityHeroModeNarsilEdain
        TriggeredBy                  = Upgrade_Level_3
        ObeyRechageOnTrigger         = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_IsildurNarsilAttack
        SpecialPowerTemplate         = SpecialAbilityHeroModeNarsilEdain
        AttributeModifier            = IsildurNarsilAttackEdainNew
        AttributeModifierFX          = FX_AndurilEdainNew
        AttributeModifierRange       = 1
        AttributeModifierAffectsSelf = Yes
        StartsPaused                 = Yes
    End

    Behavior = HeroModeSpecialAbilityUpdate ModuleTag_IsildurNarsilAttackUpdate
        SpecialPowerTemplate         = SpecialAbilityHeroModeNarsilEdain
        HeroAttributeModifier        = IsildurNarsilAttackEdainNew
        HeroEffectDuration           = 30000
        UnpackTime                   = 1666
    End





    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_AragornAthelas2
        SpecialPowerTemplate = SpecialAbilityAragornAthelas
        TriggeredBy = Upgrade_Level_5 Upgrade_Mornamarth_Arrive
        ObeyRechageOnTrigger    = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_AragornAthelas
        SpecialPowerTemplate     = SpecialAbilityAragornAthelas
        UpdateModuleStartsAttack = Yes
        TriggerFX                = FX_AragornAthelas
        SetModelCondition        = ModelConditionState:USER_5
        SetModelConditionTime    = 2.1
        StartsPaused             = Yes
    End

    Behavior = SpecialAbilityUpdate ModuleTag_AragornAthelasUpdate
        SpecialPowerTemplate    = SpecialAbilityAragornAthelas
        StartAbilityRange       = 1.6
        UnpackTime              = 1
        PreparationTime         = 3
        PackTime                = 2096
        AwardXPForTriggering    = 0
    End

    Behavior = AutoAbilityBehavior ModuleTag_AthelasAutoAbility
        SpecialAbility    = SpecialAbilityAragornAthelas
        MaxScanRange    = 200
        Query            = 1 NONE +HERO ALLIES
    End


    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_AragornSuperAthelas2
        SpecialPowerTemplate = SpecialAbilityAragornSuperAthelas
        TriggeredBy = Upgrade_Level_5
        ObeyRechageOnTrigger    = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_AragornSuperAthelas
        SpecialPowerTemplate     = SpecialAbilityAragornSuperAthelas
        UpdateModuleStartsAttack = Yes
        TriggerFX                = FX_AragornAthelas
        SetModelCondition        = ModelConditionState:USER_5
        SetModelConditionTime    = 2.1
        StartsPaused             = Yes
    End

    Behavior = SpecialAbilityUpdate ModuleTag_AragornSuperAthelasUpdate
        SpecialPowerTemplate    = SpecialAbilityAragornSuperAthelas
        StartAbilityRange       = 1.6
        UnpackTime              = 1
        PreparationTime         = 3
        PackTime                = 2096
        AwardXPForTriggering    = 0
    End

    Behavior = AutoAbilityBehavior ModuleTag_SuperAthelasAutoAbility
        SpecialAbility    = SpecialAbilityAragornSuperAthelas
        MaxScanRange    = 200
        Query            = 1 NONE +HERO ALLIES
    End


    Behavior = AutoHealBehavior ModuleTag_SuperAthelasHealing
        StartsActive                = Yes
        ButtonTriggered             = Yes
        HealingAmount               = 3000
        Radius                      = 200
        HealOnlyOthers              = No
        SingleBurst                 = Yes
        UnitHealPulseFX             = FX_AragornAthelas
        KindOf                      = HERO
    End





    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_WhiteTreeSummonEnabler
        SpecialPowerTemplate = SpecialAbilitySpawnWhiteTree
        TriggeredBy = Upgrade_Level_7
        ObeyRechageOnTrigger      = Yes
    End

    Behavior = OCLSpecialPower ModuleTag_WhiteTreeSummonStarter
        SpecialPowerTemplate    = SpecialAbilitySpawnWhiteTree
        OCL                = OCL_SpawnWhiteTree
        CreateLocation        = CREATE_AT_LOCATION
        StartsPaused        = Yes
        SetModelCondition    = ModelConditionState:USER_2
        SetModelConditionTime    = 8.1
    End


 Body = RespawnBody ModuleTag_RespawnBody
            CheerRadius               = EMOTION_CHEER_RADIUS
            MaxHealth                 = ISILDURDAG_HEALTH
            PermanentlyKilledByFilter = NONE
            DodgePercent              = HERO_DODGE_PERCENT
    End


 Behavior = RespawnUpdate ModuleTag_RespawnUpdate
            DeathAnim                  = DYING
            DeathAnimationTime         = 3933
            RespawnAnim                = LEVELED
            RespawnAnimationTime       = 2000
            AutoRespawnAtObjectFilter  = NONE +CASTLE_KEEP
            ButtonImage                = HIIsildur

        RespawnRules =    AutoSpawn:No           Cost:ISILDURDAG_COST            Time:SILMARIL_HERO_RESPAWNTIME        Health:100%
    End


    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_IsildurNarsilEnabler
        SpecialPowerTemplate      = SpecialAbilityArnorIsildurNarsil
        TriggeredBy               = Upgrade_Level_10
        ObeyRechageOnTrigger      = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_IsildurNarsilStarter
        SpecialPowerTemplate      = SpecialAbilityArnorIsildurNarsil
        UpdateModuleStartsAttack  = Yes
        StartsPaused              = Yes
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_IsildurNarsilUpdate
        SpecialPowerTemplate      = SpecialAbilityArnorIsildurNarsil
        SkipContinue              = Yes
        UnpackTime                = 1100
        PreparationTime           = 1
        PersistentPrepTime        = 500
        PackTime                  = 500
        MustFinishAbility         = Yes
        AwardXPForTriggering      = 0
        StartAbilityRange         = 20.0
        SpecialWeapon             = ArnorIsildurNarsil
        WhichSpecialWeapon        = 1
    End

    Behavior = AutoHealBehavior ModuleTag_AragornHealing
        StartsActive = Yes
        HealingAmount = HERO_HEAL_AMOUNT
        HealingDelay = 1000
        StartHealingDelay = HERO_HEAL_DELAY
        HealOnlyIfNotInCombat = Yes
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End




    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Behavior = AISpecialPowerUpdate AragornBladeMasterAI
        CommandButtonName = Command_IsildurKritischerAnstrum
        SpecialPowerAIType = AI_SPECIAL_POWER_BASIC_SELF_BUFF
    End

    Behavior = AISpecialPowerUpdate SpecialPowerAragornAthelas
        CommandButtonName = Command_SpecialAbilityIsildurAthelasMod
        SpecialPowerAIType = AI_SPECIAL_POWER_SELFAOEHEALHEROS
        SpecialPowerRadius = 30.0
    End

    Behavior = AISpecialPowerUpdate EhrwurdigeAuraAI
        CommandButtonName = Command_SpecialAbilityIsildurEhrwurdigeAura
        SpecialPowerAIType = AI_SPECIAL_POWER_BASIC_SELF_BUFF
    End

    Behavior = AISpecialPowerUpdate AragornElendilAI
        CommandButtonName = Command_IsildurNarsil
        SpecialPowerAIType = AI_SPECIAL_POWER_ELENDIL
        SpecialPowerRadius = 200
    End

    Geometry = CYLINDER
    GeometryMajorRadius = 8.0
    GeometryMinorRadius = 8.0
    GeometryHeight = 19.2
    GeometryIsSmall = Yes
    Shadow = SHADOW_DECAL
    ShadowSizeX = 20
    ShadowSizeY = 20
    ShadowTexture = ShadowI
End



Object GondorIsildur_OneRing



    SelectPortrait = HPIsildur


    ButtonImage = HIIsildur

    DescriptionStrategic = CONTROLBAR:LW_ToolTip_Aragorn

     EquivalentTo = GondorIsildur_Mod

    Draw = W3DScriptedModelDraw ModuleTag_DRAW



        DefaultModelConditionState
            Model           = GUIsildur_SKN

        End

        ModelConditionState = WEAPONSET_HERO_MODE USER_3
            ParticleSysBone = BAT_RIBS IsildurNarsil FollowBone:Yes

            ParticleSysBone = BAT_HEAD AragornElendill FollowBone:Yes
        End

        ModelConditionState = WEAPONSET_HERO_MODE
			ParticleSysBone = BAT_RIBS AraforBladeMaster FollowBone:Yes
            ParticleSysBone = BAT_RIBS IsildurNarsil FollowBone:Yes
        End

        ModelConditionState = INVISIBLE_STEALTH

            ParticleSysBone = NONE Predator FollowBone:Yes Persist:SPAWN PersistID:100
            ParticleSysBone = NONE Predator02 FollowBone:Yes Persist:SPAWN PersistID:100
        End

        ModelConditionState = USER_3

            ParticleSysBone = BAT_HEAD AragornElendill FollowBone:Yes
        End



        TransitionState                = TRANS_boredToAttention_Elendil
            Animation                = GUAragorn_ATND
                AnimationName        = GUAragorn_SKL.GUAragorn_ATND
                AnimationMode        = ONCE
            End
            FXEvent    = Name: FX_ElendilGlowEvent
        End

        TransitionState                = TRANS_attentionToBored_Elendil
            Animation                = GUAragorn_ATND
                AnimationName        = GUAragorn_SKL.GUAragorn_ATND
                AnimationMode        = ONCE_BACKWARDS
            End
            FXEvent                    = Name: FX_ElendilGlowEvent
            Flags                    = START_FRAME_LAST
        End

        TransitionState                = TRANS_boredToAttention
            Animation                = GUAragorn_ATND
                AnimationName        = GUAragorn_SKL.GUAragorn_ATND
                AnimationMode        = ONCE
            End
        End

        TransitionState                = TRANS_attentionToBored
            Animation                = GUAragorn_ATND
                AnimationName        = GUAragorn_SKL.GUAragorn_ATND
                AnimationMode        = ONCE_BACKWARDS
            End
            Flags                    = START_FRAME_LAST
        End


        IdleAnimationState
            StateName                = STATE_bored

            Animation                = GUAragorn_IDLE
                AnimationName        = GUAragorn_SKL.GUAragorn_IDLE
                AnimationMode        = ONCE
                AnimationPriority    = 12
            End

            Animation                = GUAragorn_IDLF
                AnimationName        = GUAragorn_SKL.GUAragorn_IDLF
                AnimationMode        = ONCE
                AnimationPriority    = 1
            End

            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if    Prev == "STATE_attention" or
                    Prev == "STATE_running" or
                    Prev == "OATH_BREAKERS" then CurDrawableSetTransitionAnimState("TRANS_attentionToBored") end
            EndScript
        End

        AnimationState            = THROWN_PROJECTILE
            Animation            = FLYA
                AnimationName    = GUAragorn_SKL.GUAragorn_FLYA
                AnimationMode    = LOOP
            End
        End

        AnimationState            = STUNNED_FLAILING
            Animation            = FLYA
                AnimationName    = GUAragorn_SKL.GUAragorn_FLYA
                AnimationMode    = LOOP
                AnimationSpeedFactorRange    = 0.4 0.6
            End
        End

        AnimationState             = DYING SPLATTED
            Animation         = Splatted_On_Ground
                AnimationName    = GUAragorn_SKL.GUAragorn_LNDA
                AnimationMode    = ONCE
            End
            EnteringStateFX        = FX_SoldierHitGround
        End


        AnimationState                = DYING DEATH_1
            Animation                = GUAragorn_DIEA
                AnimationName        = GUAragorn_SKL.GUAragorn_DIEA
                AnimationMode        = ONCE
            End
            Animation                = GUAragorn_DIEB
                AnimationName        = GUAragorn_SKL.GUAragorn_DIEB
                AnimationMode        = ONCE
            End
        End

        AnimationState                = DYING DEATH_2
            Animation                = GUAragorn_IDLA
                AnimationName        = GUAragorn_SKL.GUAragorn_IDLA
                AnimationMode        = LOOP
            End
        End

        AnimationState                        = PARALYZED
            Animation
                AnimationName                = GUAragorn_IDLE
                AnimationMode                = LOOP
            End
        End

        AnimationState                = STUNNED_STANDING_UP
            Animation                = GUAragorn_GTPB
                AnimationName        = GUAragorn_SKL.GUAragorn_GTPB
                AnimationMode        = ONCE
                AnimationSpeedFactorRange = 1.5 1.5
            End
        End

        AnimationState            = STUNNED
            Animation            = LNDA
                AnimationName    = GUAragorn_SKL.GUAragorn_LNDA
                AnimationMode    = ONCE
            End
            EnteringStateFX        = FX_SoldierHitGround
        End








        AnimationState        = MOVING FIRING_OR_PREATTACK_A
            ShareAnimation        = Yes
            Animation           = RunAndFire
                AnimationName       = GUAragorn_SKL.GUAragorn_ATRA
                AnimationMode       = LOOP
            End
            Flags               = RANDOMSTART
        End











        AnimationState                = FIRING_OR_PREATTACK_A WEAPONSET_HERO_MODE
            StateName                = STATE_Ready
            Animation                = GUAragorn_SPCA
                AnimationName        = GUAragorn_SKL.GUIsildur_SPCA
                AnimationMode        = ONCE
            End

            FXEvent    = Frame:22 Name: FX_IsildurSword
            FXEvent    = Frame:42 Name: FX_IsildurSword
            FXEvent = Frame:67 Name: FX_IsildurSword
        End

        AnimationState                = FIRING_OR_PREATTACK_A HERO
            StateName                = STATE_Ready
            Animation                = GUAragorn_SPCA
                AnimationName        = GUAragorn_SKL.GUIsildur_SPCA
                AnimationMode        = ONCE
            End

            FXEvent    = Frame:22 Name: FX_IsildurSword
            FXEvent    = Frame:42 Name: FX_IsildurSword
            FXEvent = Frame:67 Name: FX_IsildurSword
        End


        AnimationState                = FIRING_OR_PREATTACK_A
            StateName                = STATE_ready
            Animation                = ATKD
                AnimationName        = GUAragorn_SKL.GUAragorn_ATKD
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 3
            End
            Animation                = ATKE
                AnimationName        = GUAragorn_SKL.GUAragorn_ATKE
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 2
            End
            Flags                    =    RESTART_ANIM_WHEN_COMPLETE
        End







        AnimationState                = MOVING
            StateName                = STATE_running

            Animation                = GUAragorn_RUNB
                AnimationName        = GUAragorn_SKL.GUAragorn_RUNB
                AnimationMode        = LOOP
            End
        End

        AnimationState                = LEVELED
            Animation                = LevelUp
                AnimationName        = GUAragorn_SKL.GUAragorn_ATKO
                AnimationMode        = ONCE
            End
        End

        AnimationState                = SPECIAL_POWER_1
            StateName                = STATE_ready
            Animation                = GUAragorn_ATKL
                AnimationName        = GUAragorn_SKL.GUAragorn_ATKL
                AnimationMode        = ONCE
            End
            ParticleSysBone            = B_SWORDBONE ElendilFlare FollowBone:Yes
            ParticleSysBone            = B_SWORDBONE ElendilSwordFlare FollowBone:Yes

        End



        AnimationState                = USER_1
            StateName                = OATH_BREAKERS
            Animation                = ATKN
                AnimationName        = GUAragorn_SKL.GUAragorn_CHRB
                AnimationMode        = ONCE
            End
        End



        AnimationState        = SPECIAL_WEAPON_ONE
            Animation                = ATKE
                AnimationName        = GUAragorn_SKL.GUAragorn_ATKE
                AnimationMode        = ONCE
                AnimationSpeedFactorRange    =    0.5 0.5
             End
             ParticleSysBone     = B_SWORDBONE IsildurNarsilGlowFX FollowBone:Yes
             ParticleSysBone     = B_SWORDBONE IsildurNarsilSparksFX FollowBone:Yes
         End


        AnimationState        = SPECIAL_WEAPON_TWO
            Animation                = ATKN
                AnimationName        = GUAragorn_SKL.GUAragorn_CHRB
                AnimationMode        = ONCE
            End
        End

          AnimationState        = SPECIAL_WEAPON_THREE
            Animation                = ATKE
                AnimationName        = GUAragorn_SKL.GUAragorn_ATKE
                AnimationMode        = ONCE
            End
        End





        AnimationState                = HIT_REACTION HIT_LEVEL_3
            StateName                = STATE_bored
            Animation                = Hit_Level_1_b
                AnimationName        = GUAragorn_SKL.GUAragorn_HITB
                AnimationMode        = ONCE
            End
        End



        AnimationState                = EMOTION_CELEBRATING
            StateName                = STATE_ready
            Animation                = CHRB
                AnimationName        = GUAragorn_SKL.GUAragorn_CHRB
                AnimationMode        = ONCE
                AnimationPriority    = 1
            End
            Flags                    = RESTART_ANIM_WHEN_COMPLETE
        End

        AnimationState                = EMOTION_TAUNTING
            StateName                = STATE_ready
            Animation                = CHRB
                AnimationName        = GUAragorn_SKL.GUAragorn_CHRB
                AnimationMode        = ONCE
                AnimationPriority    = 1
            End
            Flags                    = RESTART_ANIM_WHEN_COMPLETE
        End

        AnimationState                = EMOTION_ALERT
            StateName                = STATE_ready
            Animation                = IDLA
                AnimationName        = GUAragorn_SKL.GUAragorn_IDLA
                AnimationMode        = ONCE
                AnimationPriority    = 1
            End
        End

        AnimationState                = EMOTION_MORALE_HIGH
            StateName                = STATE_ready
            Animation                = ATKN
                AnimationName        = GUAragorn_SKL.GUAragorn_ATKN
                AnimationMode        = ONCE
                AnimationPriority    = 1
            End
            Animation                = ATKP
                AnimationName        = GUAragorn_SKL.GUAragorn_ATKP
                AnimationMode        = ONCE
                AnimationPriority    = 15
            End
            Animation                = TNTC
                AnimationName        = GUAragorn_SKL.GUAragorn_TNTD
                AnimationMode        = ONCE
                AnimationPriority    = 30
            End
            Animation                = TNTD
                AnimationName        = GUAragorn_SKL.GUAragorn_TNTD
                AnimationMode        = ONCE
                AnimationPriority    = 30
            End
            Flags                    = RESTART_ANIM_WHEN_COMPLETE
        End

        AnimationState                = ENGAGED
            StateName                = STATE_ready
            Animation                = IDLA
                AnimationName        = GUAragorn_SKL.GUAragorn_IDLA
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 1
            End
            Flags                    =    RESTART_ANIM_WHEN_COMPLETE
        End

        AnimationState                = RAISING_FLAG
            StateName                = STATE_ready
            Animation                = CHRB
                AnimationName        = GUAragorn_SKL.GUAragorn_CHRB
                AnimationMode        = LOOP
            End
        End

        AnimationState                = SELECTED
            StateName                = STATE_attention
            Animation                = ATNE
                AnimationName        = GUAragorn_SKL.GUAragorn_ATNE
                AnimationMode        = LOOP
                AnimationBlendTime    = 5
                AnimationMustCompleteBlend = Yes
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_bored" then CurDrawableSetTransitionAnimState("TRANS_boredToAttention") end
            EndScript
        End

    End

    Draw = W3DScriptedModelDraw Icon
        ModelConditionState = NONE
            Model           = bbox
        End
    End


    #include "..\..\..\includes\StunDrawModuleSmall.inc"


    Side = Gondor
    EditorSorting = UNIT
    ThreatLevel = ARAGORN_THREAT_LEVEL
    ThingClass = CHARACTER_UNIT
    TransportSlotCount = TRANSPORTSLOTCOUNT_HERO
    DisplayMeleeDamage = MEDIUM_HERO_DAMAGE
    HeroSortOrder = 20
    BuildCost = ISILDURDAG_COST
    BuildTime = MEDIUM_HERO_BUILDTIME
    MaxSimultaneousOfType = 1


    WeaponSet
        Conditions        		 = None
        Weapon            		 = PRIMARY    GondorIsildurSwordMod
        Weapon                   = TERTIARY    RohanGimliAxeThrown
        AutoChooseSources        = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
        AutoChooseSources        = TERTIARY NONE
        ShareWeaponReloadTime    = Yes
    End

    WeaponSet
        Conditions        		 = WEAPONSET_HERO_MODE
        Weapon            		 = PRIMARY    IsildurkritischerAnsturmWeapon
        Weapon                   = TERTIARY    RohanGimliAxeThrown
        AutoChooseSources        = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
        AutoChooseSources        = TERTIARY NONE
        ShareWeaponReloadTime    = Yes
    End


    ArmorSet
        Conditions      = None
        Armor           = StrongHeroArmor
        DamageFX        = NormalDamageFX
    End

    VisionRange = VISION_HERO_STANDARD
    ShroudClearingRange = SHROUD_CLEAR_HERO
    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = 200
    VisionBonusPercentPerFoot = 1.0%

    BountyValue = GONDOR_ARAGORN_BOUNTY_VALUE
    DisplayName = OBJECT:GondorIsildur
    RecruitText = CONTROLBAR:GondorIsildurRecruit
    ReviveText    = CONTROLBAR:GondorIsildurRevive
    Hotkey        = CONTROLBAR:GondorIsildurHotkey
    CrushableLevel = 2



    CommandSet = GondorIsildurCommandSet_OneRing
    CommandPoints = 0



    AutoResolveUnitType = AutoResolveUnit_Hero
    AutoResolveCombatChain = AutoResolve_HeroCombatChain

    AutoResolveBody = AutoResolve_AragornBody

    AutoResolveArmor
        Armor = AutoResolve_AragornArmor
    End

    AutoResolveWeapon
        Weapon = AutoResolve_AragornWeapon
    End

    AutoResolveLeadership = AutoResolve_AragornBonus




    VoiceAttack                = IsildurModVoiceAttack
    VoiceAttackCharge            = IsildurModVoiceAttack
    VoiceAttackMachine        = IsildurModVoiceAttack
    VoiceAttackStructure        = IsildurModVoiceAttack
    VoiceCreated                = IsildurModVoiceCreated
    VoiceFullyCreated         = IsildurModVoiceCreated
    VoiceFear                 = IsildurModVoiceHelpMe
    VoiceMove                = IsildurModVoiceMove
    VoiceMoveToCamp            = IsildurModVoiceMove
    VoiceMoveWhileAttacking        = IsildurModVoiceSelect
    VoicePriority            = 90
    VoiceRetreatToCastle        = IsildurModVoiceMove
    VoiceSelect                = IsildurModVoiceSelect
    VoiceSelectBattle         = IsildurModVoiceSelect
    VoiceGuard                = IsildurModVoiceSelect

    SoundImpact                = ImpactHorse


    UnitSpecificSounds
        VoiceGarrison                        = IsildurModVoiceSelect
        VoiceEnterUnitElvenTransportShip    = IsildurModVoiceMove
        VoiceInitiateCaptureBuilding        = IsildurModVoiceMove
    End

    CrowdResponseKey = GoodMen

    #include "..\..\..\includes\StandardUnitEvaEvents.inc"


    Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
        Key = Humanoid_Male Man Man_Male Unit Infantry Hero

    End

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound:AragornVoiceElendil                 Animation:GUAragorn_SKL.GUAragorn_ATKL    Frames:21
        AnimationSound = Sound:AragornVoiceEnterStateElendil             Animation:GUAragorn_SKL.GUAragorn_ATKL    Frames:21
        AnimationSound = Sound:FootstepDirtA                    Animation:GUAragorn_SKL.GUAragorn_RUNB    Frames:8 17 26 36

        AnimationSound = Sound:BodyFallGenericNoArmor                Animation:GUAragorn_SKL.GUAragorn_DIEA    Frames:55
        AnimationSound = Sound:BodyFallGenericNoArmor                Animation:GUAragorn_SKL.GUAragorn_DIEB    Frames:70
        AnimationSound = Sound:BodyFallSoldier                    Animation:GUAragorn_SKL.GUAragorn_LNDA    Frames:1
    End



    RadarPriority = UNIT
    KindOf = PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE HERO ARMY_SUMMARY HEAVY_MELEE_HITTER
    PathfindDiameter = 40.0

    Body = ActiveBody ModuleTag_02
        CheerRadius             = EMOTION_CHEER_RADIUS
        MaxHealth                 = ISILDURDAG_HEALTH 
    End


    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = Hero
    End

    #include "..\..\..\includes\CaptureBuilding.inc"


    Behavior = AIUpdateInterface ModuleTag_03
        AutoAcquireEnemiesWhenIdle = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate        = 500
        AILuaEventsList            = AragornFunctions
    End

    Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance                = 300
        TauntAndPointUpdateDelay            = 10000
        AddEmotion            =    Doom_Base



        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
         AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base


        AddEmotion            =    Alert_Base
        AddEmotion            =    CheerForAboutToCrush_Base
    End

    LocomotorSet
        Locomotor = HeroHumanLocomotor
        Condition = SET_NORMAL
        Speed     = NORMAL_GOOD_HERO_SPEED
    End

    Behavior = PhysicsBehavior ModuleTag_04
        GravityMult = 1.0
        ShockStandingTime = 2133
    End

    Behavior = SlowDeathBehavior ModuleTag_05
        DeathTypes = ALL -FADED
        SinkDelay = 3000
        SinkRate = 0.40
        DestructionDelay = 8000
        Sound = INITIAL AragornVoiceDie
        DeathFlags = DEATH_1
    End

    Behavior = SquishCollide ModuleTag_06

    End







    Behavior = AttributeModifierAuraUpdate ModuleTag_Leadership
        StartsActive    = Yes
        BonusName       = IsildurOneRingLeadership
        RefreshDelay    = 2000
        Range           = 200

        ObjectFilter    = ANY +INFANTRY +CAVALRY -STRUCTURE -BASE_FOUNDATION +HERO -HORDE ALLIES
    End

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_TheodenLeadership
        SpecialPowerTemplate = SpecialAbilityFakeLeadership
        TriggeredBy = Upgrade_Level_1
    End

    Behavior = SpecialPowerModule ModuleTag_TheodenLeadershipUpdate
        SpecialPowerTemplate      = SpecialAbilityFakeLeadership
        UpdateModuleStartsAttack  = No
        StartsPaused = No
    End







    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_SpecialAbilityHeroModeNarsilEnabler
        SpecialPowerTemplate         = SpecialAbilityHeroModeNarsilEdain
        TriggeredBy                  = Upgrade_Level_3
    End

    Behavior = SpecialPowerModule ModuleTag_IsildurNarsilAttack
        SpecialPowerTemplate         = SpecialAbilityHeroModeNarsilEdain
        AttributeModifier            = IsildurNarsilAttackEdainNew
        AttributeModifierFX          = FX_AndurilEdainNew
        AttributeModifierRange       = 1
        AttributeModifierAffectsSelf = Yes
        StartsPaused                 = Yes
    End

    Behavior = HeroModeSpecialAbilityUpdate ModuleTag_IsildurNarsilAttackUpdate
        SpecialPowerTemplate         = SpecialAbilityHeroModeNarsilEdain
        HeroAttributeModifier        = IsildurNarsilAttackEdainNew
        HeroEffectDuration           = 30000
        UnpackTime                   = 1666
     End







    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_AragornKnifeAttackEnabler
        SpecialPowerTemplate = SpecialAbilityAragornKnifeAttack
        TriggeredBy = Upgrade_Level_5
    End

    Behavior = SpecialPowerModule ModuleTag_KnifeAttack
        SpecialPowerTemplate      = SpecialAbilityAragornKnifeAttack
        UpdateModuleStartsAttack  = Yes
        StartsPaused              = Yes
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_KnifeAttackUpdate
        SpecialPowerTemplate    = SpecialAbilityAragornKnifeAttack
        SkipContinue            = Yes
        UnpackTime              = 448
        PreparationTime         = 1
        PersistentPrepTime      = 400
        PackTime                = 1000
        AwardXPForTriggering    = 0
        StartAbilityRange = 300.0
        SpecialWeapon = GondorAragornKnifeThrow
        WhichSpecialWeapon = 3
    End







    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_WhiteTreeSummonEnabler
        SpecialPowerTemplate = SpecialAbilitySpawnWhiteTree
        TriggeredBy = Upgrade_Level_7
        ObeyRechageOnTrigger      = Yes
    End

    Behavior = OCLSpecialPower ModuleTag_WhiteTreeSummonStarter
        SpecialPowerTemplate    = SpecialAbilitySpawnWhiteTree
        OCL                = OCL_SpawnWhiteTree
        CreateLocation        = CREATE_AT_LOCATION
        StartsPaused        = Yes
        SetModelCondition    = ModelConditionState:USER_2
        SetModelConditionTime    = 8.1
    End







    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_IsildurNarsilEnabler
        SpecialPowerTemplate      = SpecialAbilityArnorIsildurNarsil
        TriggeredBy               = Upgrade_Level_10
    End

    Behavior = SpecialPowerModule ModuleTag_IsildurNarsilStarter
        SpecialPowerTemplate      = SpecialAbilityArnorIsildurNarsil
        UpdateModuleStartsAttack  = Yes
        StartsPaused              = Yes
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_IsildurNarsilUpdate
        SpecialPowerTemplate      = SpecialAbilityArnorIsildurNarsil
        SkipContinue              = Yes
        UnpackTime                = 1100
        PreparationTime           = 1
        PersistentPrepTime        = 500
        PackTime                  = 500
        MustFinishAbility         = Yes
        AwardXPForTriggering      = 0
        StartAbilityRange         = 20.0
        SpecialWeapon             = ArnorIsildurNarsil
        WhichSpecialWeapon        = 1
    End





    Behavior = AutoHealBehavior ModuleTag_ElvenGiftHealing
        StartsActive                = No
        TriggeredBy                    = Upgrade_ElvenGift
        HealingAmount                = ELVEN_GIFT_REGEN_AMOUNT
        HealingDelay                = ELVEN_GIFT_REGEN_DELAY
        StartHealingDelay = HERO_HEAL_DELAY
        HealOnlyIfNotInCombat = Yes
    End



    Behavior = AutoHealBehavior ModuleTag_AragornHealing
        StartsActive = Yes
        HealingAmount = HERO_HEAL_AMOUNT
        HealingDelay = 1000
        StartHealingDelay = HERO_HEAL_DELAY
        HealOnlyIfNotInCombat = Yes
    End

    Behavior = FireWeaponUpdate ModuleTag_WeaponFiring
        FireWeaponNugget
            WeaponName = IsildurRingauswirkungWeapon
            Offset = X:0 Y:0 Z:0
            FireDelay = 0
            OneShot = No
        End
    End




    Behavior = FXListDie ModuleTag_AnnounceWeLostTheRing
        DeathFX = GandalfAnnounceFortressDeathLostRingFX
    End

    Behavior = CreateObjectDie ModuleTag_DropTheRing
        CreationList    = OCL_TheOneRing
    End

    Behavior = RemoveUpgradeUpgrade ModuleTag_RemoveRing
        TriggeredBy            = Upgrade_AllFactionUpgrade
        UpgradeToRemove            = Upgrade_FortressRingHero Upgrade_RingHero
        RemoveFromAllPlayerObjects    = Yes
        SuppressEvaEventForRemoval    = Yes
    End

    Behavior = LifetimeUpdate ModuleTag_LifetimeUpdate
        MinLifetime               = 500000
        MaxLifetime               = 500000
        DeathType                 = NORMAL
    End


    Behavior = AttributeModifierUpgrade ModuleTag_GandalfWhiteBonus
        TriggeredBy = Upgrade_Konigsfamilie
        AttributeModifier = SpellBookKonigsfamilie
    End


    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End






    Behavior = AISpecialPowerUpdate AragornBladeMasterAI
        CommandButtonName = Command_IsildurNarsil
        SpecialPowerAIType = AI_SPECIAL_POWER_BASIC_SELF_BUFF
    End



    Geometry = CYLINDER
    GeometryMajorRadius = 8.0
    GeometryMinorRadius = 8.0
    GeometryHeight = 19.2
    GeometryIsSmall = Yes
    Shadow = SHADOW_DECAL
    ShadowSizeX = 20
    ShadowSizeY = 20
    ShadowTexture = ShadowI
End




Object GondorIsildur_Mod_Summoned



    SelectPortrait = HPIsildur


    ButtonImage = HIIsildur

    DescriptionStrategic = CONTROLBAR:LW_ToolTip_Aragorn

    Draw = W3DScriptedModelDraw ModuleTag_DRAW



        DefaultModelConditionState
            Model           = GUIsildur_SKN
        End

        ModelConditionState = WEAPONSET_HERO_MODE USER_3
            ParticleSysBone = BAT_RIBS IsildurNarsil FollowBone:Yes
            ParticleSysBone = BAT_HEAD AragornElendill FollowBone:Yes
        End

        ModelConditionState = WEAPONSET_HERO_MODE
			ParticleSysBone = B_SWORDBONE IsildurNarsilLight FollowBone:yes
			ParticleSysBone = B_SWORDBONE IsildurNarsilLightMode FollowBone:yes
			ParticleSysBone = BAT_RIBS AraforBladeMaster FollowBone:Yes
            ParticleSysBone = BAT_RIBS IsildurNarsil FollowBone:Yes
        End

        ModelConditionState = INVISIBLE_STEALTH
            ParticleSysBone = NONE Predator FollowBone:Yes Persist:SPAWN PersistID:100
            ParticleSysBone = NONE Predator02 FollowBone:Yes Persist:SPAWN PersistID:100
        End

        ModelConditionState = USER_3
            ParticleSysBone = BAT_HEAD AragornElendill FollowBone:Yes
        End

        ModelConditionState = ONE_RING

        End

        ModelConditionState = INVISIBLE_STEALTH ONE_RING
            ParticleSysBone = NONE Predator FollowBone:Yes Persist:SPAWN PersistID:100
            ParticleSysBone = NONE Predator02 FollowBone:Yes Persist:SPAWN PersistID:100

        End

        ModelConditionState = WEAPONSET_HERO_MODE ONE_RING
            ParticleSysBone = BAT_RIBS IsildurNarsil FollowBone:Yes

        End

        ModelConditionState = WEAPONSET_HERO_MODE ONE_RING USER_3
            ParticleSysBone = BAT_RIBS IsildurNarsil FollowBone:Yes
            ParticleSysBone = BAT_HEAD AragornElendill FollowBone:Yes

        End



        TransitionState                = TRANS_boredToAttention_Elendil
            Animation                = GUAragorn_ATND
                AnimationName        = GUAragorn_SKL.GUAragorn_ATND
                AnimationMode        = ONCE
            End
            FXEvent    = Name: FX_ElendilGlowEvent
        End

        TransitionState                = TRANS_attentionToBored_Elendil
            Animation                = GUAragorn_ATND
                AnimationName        = GUAragorn_SKL.GUAragorn_ATND
                AnimationMode        = ONCE_BACKWARDS
            End
            FXEvent                    = Name: FX_ElendilGlowEvent
            Flags                    = START_FRAME_LAST
        End

        TransitionState                = TRANS_boredToAttention
            Animation                = GUAragorn_ATND
                AnimationName        = GUAragorn_SKL.GUAragorn_ATND
                AnimationMode        = ONCE
            End
        End

        TransitionState                = TRANS_attentionToBored
            Animation                = GUAragorn_ATND
                AnimationName        = GUAragorn_SKL.GUAragorn_ATND
                AnimationMode        = ONCE_BACKWARDS
            End
            Flags                    = START_FRAME_LAST
        End


        IdleAnimationState
            StateName                = STATE_bored

            Animation                = GUAragorn_IDLE
                AnimationName        = GUAragorn_SKL.GUAragorn_IDLE
                AnimationMode        = ONCE
                AnimationPriority    = 12
            End

            Animation                = GUAragorn_IDLF
                AnimationName        = GUAragorn_SKL.GUAragorn_IDLF
                AnimationMode        = ONCE
                AnimationPriority    = 1
            End

            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if    Prev == "STATE_attention" or
                    Prev == "STATE_running" or
                    Prev == "OATH_BREAKERS" then CurDrawableSetTransitionAnimState("TRANS_attentionToBored") end
            EndScript
        End

        AnimationState            = THROWN_PROJECTILE
            Animation            = FLYA
                AnimationName    = GUAragorn_SKL.GUAragorn_FLYA
                AnimationMode    = LOOP
            End
        End

        AnimationState            = STUNNED_FLAILING
            Animation            = FLYA
                AnimationName    = GUAragorn_SKL.GUAragorn_FLYA
                AnimationMode    = LOOP
                AnimationSpeedFactorRange    = 0.4 0.6
            End
        End

        AnimationState             = DYING SPLATTED
            Animation         = Splatted_On_Ground
                AnimationName    = GUAragorn_SKL.GUAragorn_LNDA
                AnimationMode    = ONCE
            End
            EnteringStateFX        = FX_SoldierHitGround
        End


        AnimationState                = DYING DEATH_1
            Animation                = GUAragorn_DIEA
                AnimationName        = GUAragorn_SKL.GUAragorn_DIEA
                AnimationMode        = ONCE
            End
            Animation                = GUAragorn_DIEB
                AnimationName        = GUAragorn_SKL.GUAragorn_DIEB
                AnimationMode        = ONCE
            End
        End

        AnimationState                = DYING DEATH_2
            Animation                = GUAragorn_IDLA
                AnimationName        = GUAragorn_SKL.GUAragorn_IDLA
                AnimationMode        = LOOP
            End
        End

        AnimationState                        = PARALYZED
            Animation
                AnimationName                = GUAragorn_IDLE
                AnimationMode                = LOOP
            End
        End

        AnimationState                = STUNNED_STANDING_UP
            Animation                = GUAragorn_GTPB
                AnimationName        = GUAragorn_SKL.GUAragorn_GTPB
                AnimationMode        = ONCE
                AnimationSpeedFactorRange = 1.5 1.5
            End
        End

        AnimationState            = STUNNED
            Animation            = LNDA
                AnimationName    = GUAragorn_SKL.GUAragorn_LNDA
                AnimationMode    = ONCE
            End
            EnteringStateFX        = FX_SoldierHitGround
        End








        AnimationState        = MOVING FIRING_OR_PREATTACK_A
            ShareAnimation        = Yes
            Animation           = RunAndFire
                AnimationName       = GUAragorn_SKL.GUAragorn_ATRA
                AnimationMode       = LOOP
            End
            Flags               = RANDOMSTART
        End

        AnimationState                = FIRING_OR_PREATTACK_A WEAPONSET_HERO_MODE
            StateName                = STATE_ready
            Animation                = ATKF
                AnimationName        = GUAragorn_SKL.GUAragorn_ATKF
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
            End
            Flags                    = RESTART_ANIM_WHEN_COMPLETE
        End

        AnimationState                = FIRING_OR_PREATTACK_A
            StateName                = STATE_ready
            Animation                = ATKD
                AnimationName        = GUAragorn_SKL.GUAragorn_ATKD
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 3
            End
            Animation                = ATKE
                AnimationName        = GUAragorn_SKL.GUAragorn_ATKE
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 2
            End
            Flags                    =    RESTART_ANIM_WHEN_COMPLETE
        End







        AnimationState                = MOVING
            StateName                = STATE_running

            Animation                = GUAragorn_RUNB
                AnimationName        = GUAragorn_SKL.GUAragorn_RUNB
                AnimationMode        = LOOP
            End
        End

        AnimationState                = LEVELED
            Animation                = LevelUp
                AnimationName        = GUAragorn_SKL.GUAragorn_ATKO
                AnimationMode        = ONCE
            End
        End

        AnimationState                = SPECIAL_POWER_1
            StateName                = STATE_ready
            Animation                = GUAragorn_ATKL
                AnimationName        = GUAragorn_SKL.GUAragorn_ATKL
                AnimationMode        = ONCE
            End
            ParticleSysBone            = B_SWORDBONE ElendilFlare FollowBone:Yes
            ParticleSysBone            = B_SWORDBONE ElendilSwordFlare FollowBone:Yes

        End









        AnimationState                = USER_1
            StateName                = OATH_BREAKERS
            Animation                = ATKN
                AnimationName        = GUAragorn_SKL.GUAragorn_CHRB
                AnimationMode        = ONCE
            End
        End





            AnimationState        = SPECIAL_WEAPON_ONE
            Animation                = ATKE
                AnimationName        = GUAragorn_SKL.GUAragorn_ATKE
                AnimationMode        = ONCE
                End
                FrameForPristineBonePositions = 35

            End


        AnimationState        = SPECIAL_WEAPON_TWO
            Animation                = ATKN
                AnimationName        = GUAragorn_SKL.GUAragorn_CHRB
                AnimationMode        = ONCE
            End
        End






        AnimationState                = HIT_REACTION HIT_LEVEL_3
            StateName                = STATE_bored
            Animation                = Hit_Level_1_b
                AnimationName        = GUAragorn_SKL.GUAragorn_HITB
                AnimationMode        = ONCE
            End
        End



        AnimationState                = EMOTION_CELEBRATING
            StateName                = STATE_ready
            Animation                = CHRB
                AnimationName        = GUAragorn_SKL.GUAragorn_CHRB
                AnimationMode        = ONCE
                AnimationPriority    = 1
            End
            Flags                    = RESTART_ANIM_WHEN_COMPLETE
        End

        AnimationState                = EMOTION_TAUNTING
            StateName                = STATE_ready
            Animation                = CHRB
                AnimationName        = GUAragorn_SKL.GUAragorn_CHRB
                AnimationMode        = ONCE
                AnimationPriority    = 1
            End
            Flags                    = RESTART_ANIM_WHEN_COMPLETE
        End

        AnimationState                = EMOTION_ALERT
            StateName                = STATE_ready
            Animation                = IDLA
                AnimationName        = GUAragorn_SKL.GUAragorn_IDLA
                AnimationMode        = ONCE
                AnimationPriority    = 1
            End
        End

        AnimationState                = EMOTION_MORALE_HIGH
            StateName                = STATE_ready
            Animation                = ATKN
                AnimationName        = GUAragorn_SKL.GUAragorn_ATKN
                AnimationMode        = ONCE
                AnimationPriority    = 1
            End
            Animation                = ATKP
                AnimationName        = GUAragorn_SKL.GUAragorn_ATKP
                AnimationMode        = ONCE
                AnimationPriority    = 15
            End
            Animation                = TNTC
                AnimationName        = GUAragorn_SKL.GUAragorn_TNTD
                AnimationMode        = ONCE
                AnimationPriority    = 30
            End
            Animation                = TNTD
                AnimationName        = GUAragorn_SKL.GUAragorn_TNTD
                AnimationMode        = ONCE
                AnimationPriority    = 30
            End
            Flags                    = RESTART_ANIM_WHEN_COMPLETE
        End

        AnimationState                = ENGAGED
            StateName                = STATE_ready
            Animation                = IDLA
                AnimationName        = GUAragorn_SKL.GUAragorn_IDLA
                AnimationMode        = ONCE
                UseWeaponTiming        = Yes
                AnimationPriority    = 1
            End
            Flags                    =    RESTART_ANIM_WHEN_COMPLETE
        End

        AnimationState                = RAISING_FLAG
            StateName                = STATE_ready
            Animation                = CHRB
                AnimationName        = GUAragorn_SKL.GUAragorn_CHRB
                AnimationMode        = LOOP
            End
        End

        AnimationState                = SELECTED
            StateName                = STATE_attention
            Animation                = ATNE
                AnimationName        = GUAragorn_SKL.GUAragorn_ATNE
                AnimationMode        = LOOP
                AnimationBlendTime    = 5
                AnimationMustCompleteBlend = Yes
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_bored" then CurDrawableSetTransitionAnimState("TRANS_boredToAttention") end
            EndScript
        End

    End

    Draw = W3DScriptedModelDraw Icon
        ModelConditionState = NONE
            Model           = bbox
        End
    End


    #include "..\..\..\includes\StunDrawModuleSmall.inc"


    Side = Gondor
    EditorSorting = UNIT
    ThreatLevel = ARAGORN_THREAT_LEVEL
    ThingClass = CHARACTER_UNIT
    TransportSlotCount = TRANSPORTSLOTCOUNT_HERO

    DisplayMeleeDamage = ISILDURDAG_DAMAGE

    HeroSortOrder = 20

    BuildCost = ISILDURDAG_COST
    BuildTime = MEDIUM_HERO_BUILDTIME
    MaxSimultaneousOfType = 1


    WeaponSet
        Conditions        = None
        Weapon            = PRIMARY    GondorIsildurSwordMod
        Weapon                   = TERTIARY    RohanGimliAxeThrown
        AutoChooseSources        = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
        AutoChooseSources        = TERTIARY NONE
        ShareWeaponReloadTime    = Yes
    End


    ArmorSet
        Conditions      = None
        Armor           = StrongHeroArmor
        DamageFX        = NormalDamageFX
    End

    VisionRange = VISION_HERO_STANDARD
    ShroudClearingRange = SHROUD_CLEAR_HERO
    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = 200
    VisionBonusPercentPerFoot = 1.0%

    BountyValue = GONDOR_ARAGORN_BOUNTY_VALUE
    DisplayName = OBJECT:GondorIsildur
    RecruitText = CONTROLBAR:GondorIsildurRecruit
    ReviveText    = CONTROLBAR:GondorIsildurRevive
    Hotkey        = CONTROLBAR:GondorIsildurHotkey
    CrushableLevel = 2



    IsTrainable = No
    CommandPoints = 0
    CommandSet = GondorIsildurCommandSet_Summoned



    AutoResolveUnitType = AutoResolveUnit_Hero
    AutoResolveCombatChain = AutoResolve_HeroCombatChain

    AutoResolveBody = AutoResolve_AragornBody

    AutoResolveArmor
        Armor = AutoResolve_AragornArmor
    End

    AutoResolveWeapon
        Weapon = AutoResolve_AragornWeapon
    End

    AutoResolveLeadership = AutoResolve_AragornBonus




    VoiceAttack                = IsildurModVoiceAttack
    VoiceAttackCharge            = IsildurModVoiceAttack
    VoiceAttackMachine        = IsildurModVoiceAttack
    VoiceAttackStructure        = IsildurModVoiceAttack
    VoiceCreated                = IsildurModVoiceCreated
    VoiceFullyCreated         = IsildurModVoiceCreated
    VoiceFear                 = IsildurModVoiceHelpMe
    VoiceMove                = IsildurModVoiceMove
    VoiceMoveToCamp            = IsildurModVoiceMove
    VoiceMoveWhileAttacking        = IsildurModVoiceSelect
    VoicePriority            = 90
    VoiceRetreatToCastle        = IsildurModVoiceMove
    VoiceSelect                = IsildurModVoiceSelect
    VoiceSelectBattle         = IsildurModVoiceSelect
    VoiceGuard                = IsildurModVoiceSelect

    SoundImpact                = ImpactHorse


    UnitSpecificSounds
        VoiceGarrison                        = IsildurModVoiceSelect
        VoiceEnterUnitElvenTransportShip    = IsildurModVoiceMove
        VoiceInitiateCaptureBuilding        = IsildurModVoiceMove
    End

    CrowdResponseKey = GoodMen

    #include "..\..\..\includes\StandardUnitEvaEvents.inc"


    Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
        Key = Humanoid_Male Man Man_Male Unit Infantry Hero

    End

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound:AragornVoiceElendil                 Animation:GUAragorn_SKL.GUAragorn_ATKL    Frames:21
        AnimationSound = Sound:AragornVoiceEnterStateElendil             Animation:GUAragorn_SKL.GUAragorn_ATKL    Frames:21
        AnimationSound = Sound:FootstepDirtA                    Animation:GUAragorn_SKL.GUAragorn_RUNB    Frames:8 17 26 36

        AnimationSound = Sound:BodyFallGenericNoArmor                Animation:GUAragorn_SKL.GUAragorn_DIEA    Frames:55
        AnimationSound = Sound:BodyFallGenericNoArmor                Animation:GUAragorn_SKL.GUAragorn_DIEB    Frames:70
        AnimationSound = Sound:BodyFallSoldier                    Animation:GUAragorn_SKL.GUAragorn_LNDA    Frames:1
    End



    RadarPriority = UNIT
    KindOf = PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE HERO ARMY_SUMMARY HEAVY_MELEE_HITTER SUMMONED
    PathfindDiameter = 40.0

    Body = RespawnBody ModuleTag_RespawnBody
        CheerRadius               = EMOTION_CHEER_RADIUS
        MaxHealth                 = ISILDURDAG_HEALTH
        PermanentlyKilledByFilter = NONE
        DodgePercent              = HERO_DODGE_PERCENT
    End
	
	


    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = Hero
    End

    #include "..\..\..\includes\CaptureBuilding.inc"


    Behavior = AIUpdateInterface ModuleTag_03
        AutoAcquireEnemiesWhenIdle = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate        = 500
        AILuaEventsList            = RingHeroEdainFunctions
    End

    Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance                = 300
        TauntAndPointUpdateDelay            = 10000
        AddEmotion            =    Doom_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
        AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    Alert_Base
        AddEmotion            =    CheerForAboutToCrush_Base
    End

    LocomotorSet
        Locomotor = HeroHumanLocomotor
        Condition = SET_NORMAL
        Speed     = NORMAL_GOOD_HERO_SPEED
    End

    Behavior = PhysicsBehavior ModuleTag_04
        GravityMult = 1.0
        ShockStandingTime = 2133
    End

    Behavior = SlowDeathBehavior ModuleTag_05
        DeathTypes = ALL -FADED
        SinkDelay = 3000
        SinkRate = 0.40
        DestructionDelay = 8000
        Sound = INITIAL AragornVoiceDie
        DeathFlags = DEATH_1
    End

    Behavior = LifetimeUpdate ModuleTag_LifetimeUpdate
        MinLifetime        = 180000
        MaxLifetime        = 180000
        DeathType        = FADED
    End

    Behavior = SlowDeathBehavior ModuleTag_FadeDeath
        DeathTypes = NONE +FADED
        FadeDelay = 0
        FadeTime = 2500
        DestructionDelay = 2500
        Sound = INITIAL SpellGenericUnsummonFasterMS
        DeathFlags = DEATH_2
    End


    Behavior = SquishCollide ModuleTag_06

    End







    Behavior = AttributeModifierAuraUpdate ModuleTag_Leadership
        StartsActive       = No
        BonusName          = LurtzPassiveOutlawLeadership
        TriggeredBy        = Upgrade_Level_1
        RefreshDelay       = 2000
        Range              = 200
        AllowSelf          = Yes
        ObjectFilter       = ANY +ArnorFighter_Summoned +ArnorArcher_Summoned +ArnorTowerShieldGuard_Summoned +ImladrisSwordMan_Summoned +BruchtalBogenschuetzen_Summoned +BruchtalLanzer_Summoned ALLIES
    End

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_TheodenLeadership
        SpecialPowerTemplate = SpecialAbilityFakeLeadership
        TriggeredBy = Upgrade_Level_1
    End

    Behavior = SpecialPowerModule ModuleTag_TheodenLeadershipUpdate
        SpecialPowerTemplate      = SpecialAbilityFakeLeadership
        UpdateModuleStartsAttack  = No
        StartsPaused = No
    End








    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_AragornKnifeAttackEnabler
        SpecialPowerTemplate = SpecialAbilityAragornKnifeAttack
        TriggeredBy = Upgrade_Level_5
    End
    Behavior = SpecialPowerModule ModuleTag_KnifeAttack
        SpecialPowerTemplate      = SpecialAbilityAragornKnifeAttack
        UpdateModuleStartsAttack  = Yes
        StartsPaused              = Yes
    End
    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_KnifeAttackUpdate
        SpecialPowerTemplate    = SpecialAbilityAragornKnifeAttack
        SkipContinue            = Yes
        UnpackTime              = 448
        PreparationTime         = 1
        PersistentPrepTime      = 400
        PackTime                = 1000
        AwardXPForTriggering    = 0
        StartAbilityRange = 300.0
        SpecialWeapon = GondorAragornKnifeThrow
        WhichSpecialWeapon = 1
    End








    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_SpecialAbilityHeroModeNarsilEnabler
        SpecialPowerTemplate         = SpecialAbilityHeroModeNarsilEdain
        TriggeredBy                  = Upgrade_Level_3
    End

    Behavior = SpecialPowerModule ModuleTag_IsildurNarsilAttack
        SpecialPowerTemplate         = SpecialAbilityHeroModeNarsilEdain
        AttributeModifier            = IsildurNarsilAttackEdainNew
        AttributeModifierFX          = FX_AndurilEdainNew
        AttributeModifierRange       = 1
        AttributeModifierAffectsSelf = Yes
        StartsPaused                 = Yes
    End

    Behavior = HeroModeSpecialAbilityUpdate ModuleTag_IsildurNarsilAttackUpdate
        SpecialPowerTemplate         = SpecialAbilityHeroModeNarsilEdain
        HeroAttributeModifier        = IsildurNarsilAttackEdainNew
        HeroEffectDuration           = 30000
        UnpackTime                   = 1666
     End








    Behavior = InvisibilityUpdate ModuleTag_StealthForEscape
        InvisibilityNugget
            InvisibilityType        = STEALTH
            ForbiddenConditions     = TAKING_DAMAGE FIRING_ANY USING_ABILITY
            BecomeStealthedFX       = FX_ElvenCloakOn
            ExitStealthFX           = FX_ElvenCloakOff
            Options                 = UNTOGGLE_HIDDEN_WHEN_LEAVING_STEALTH
        End
        StartsActive                = No
        UpdatePeriod                = 2000
    End
    Behavior = SpecialPowerModule ModuleTag_ElfCloakStarter
        SpecialPowerTemplate      = SpecialAbilityNewIsildurOneRingPower
        UpdateModuleStartsAttack  = Yes

    End
    Behavior = ToggleHiddenSpecialAbilityUpdate ModuleTag_ElfCloakUpdate
        SpecialPowerTemplate      = SpecialAbilityNewIsildurOneRingPower
        AwardXPForTriggering      = 0
    End




    Behavior = AutoHealBehavior ModuleTag_ElvenGiftHealing
        StartsActive                = No
        TriggeredBy                    = Upgrade_ElvenGift
        HealingAmount                = ELVEN_GIFT_REGEN_AMOUNT
        HealingDelay                = ELVEN_GIFT_REGEN_DELAY
        StartHealingDelay = HERO_HEAL_DELAY
        HealOnlyIfNotInCombat = Yes
    End



    Behavior = AutoHealBehavior ModuleTag_AragornHealing
        StartsActive = Yes
        HealingAmount = HERO_HEAL_AMOUNT
        HealingDelay = 1000
        StartHealingDelay = HERO_HEAL_DELAY
        HealOnlyIfNotInCombat = Yes
    End

    Behavior = ExperienceLevelCreate ModuleTag_MPLevelBonus
        LevelToGrant = 7
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End


    Behavior = AISpecialPowerUpdate AragornBladeMasterAI
        CommandButtonName = Command_IsildurNarsil
        SpecialPowerAIType = AI_SPECIAL_POWER_BASIC_SELF_BUFF
    End



    Geometry = CYLINDER
    GeometryMajorRadius = 8.0
    GeometryMinorRadius = 8.0
    GeometryHeight = 19.2
    GeometryIsSmall = Yes
    Shadow = SHADOW_DECAL
    ShadowSizeX = 20
    ShadowSizeY = 20
    ShadowTexture = ShadowI
End

