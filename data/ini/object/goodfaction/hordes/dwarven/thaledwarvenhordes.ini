Object DwarvenThalBowmanHorde

    SelectPortrait         = UPThalBowmen
    ButtonImage            = HIThalBowmen_Wotr

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR
        DefaultModelConditionState
            Model = None
        End
        ModelConditionState = HORDE_EMPTY
            Model = None
        End

        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkRUYeo
        End
    End

    Side = Dwarves
    EditorSorting = UNIT
    EmotionRange = 240
    DisplayName = OBJECT:DwarvenThalBowmenHorde
    DisplayNameStrategic = CONTROLBAR:LW_Unit_ThalBowmenHorde
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_ThalBowmenHorde

    WeaponSet
        Conditions = None
        Weapon = PRIMARY    NormalMissileHordeRangefinder
        Weapon = TERTIARY   NormalMissileHordeRangefinderBombard
        AutoChooseSources = TERTIARY FROM_PLAYER FROM_SCRIPT
    End

    CommandSet =  DwarvenThalBowmenHordeCommandSet




    #include "..\..\..\includes\StandardHordeEvaEvents.inc"

    CrushableLevel = 0
    CrusherLevel = 0
    UseCrushAttack = No

    BuildCost = 700
    BuildTime = WEAK_BUILDTIME

    VisionRange               = 375
    ShroudClearingRange       = 475
    VisionSide                = 50%
    VisionRear                = 25%
    MaxVisionBonusPercent     = 300%
    VisionBonusTestRadius     = 200
    VisionBonusPercentPerFoot = 1.0%

    CommandPoints = 50

    FormationWidth = 2
    FormationDepth = 1

    TransportSlotCount = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE ARCHER ARMY_SUMMARY LARGE_RECTANGLE_PATHFIND

    ThreatLevel = 120
    ThreatBreakdown DwarvenMenOfDaleHorde_DetailedThreat
        AIKindOf = ARCHER
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End




	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_BlackArrowsEnabler
		SpecialPowerTemplate 		= SpecialAbilityBlackArrows
	End

	Behavior = SpecialPowerModule ModuleTag_BlackArrowsStarter
		SpecialPowerTemplate		= SpecialAbilityBlackArrows
		UpdateModuleStartsAttack	= Yes
		StartsPaused			= No
	End

	Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_BlackArrowsWeaponFireUpdate
		SpecialPowerTemplate		= SpecialAbilityBlackArrows
		PackTime			= 2000
		StartAbilityRange		= #ADD( DWARVEN_MENOFDALE_RANGE 50 )
		SpecialWeapon			= DwarvenMenOfDaleBlackArrowsRangeFinder
		ApproachUntilMembersInRange	= Yes
		TriggerSound			= YeomanArcherVoiceAttackCharge
	End

	Behavior = AutoAbilityBehavior ModuleTag_BlackArrowsAutoAbility
		SpecialAbility		= SpecialAbilityBlackArrows
		ForbiddenStatus 	= INSIDE_GARRISON
		MaxScanRange		= DWARVEN_MENOFDALE_RANGE
		Query			= 1 ANY ENEMIES +HERO +MONSTER -STRUCTURE -WALL_UPGRADE -WALL_HUB -WALL_SEGMENT -DEFENSIVE_WALL -FS_BASE_DEFENSE
		Query			= 1 ANY ENEMIES +INFANTRY +CAVALRY -STRUCTURE -WALL_UPGRADE -WALL_HUB -WALL_SEGMENT -DEFENSIVE_WALL -FS_BASE_DEFENSE
	End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = ArcherHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle    = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate           = 500
        MaxCowerTime                  = 5000
        MinCowerTime                  = 3000
        CanAttackWhileContained       = Yes
        AILuaEventsList               = InfantryFunctions
        AttackPriority                = AttackPriority_Archer
    End

    Behavior = HordeContain ModuleTag_HordeContain
        ObjectStatusOfContained =
        InitialPayload     = DwarvenThalBowman 10
        Slots         = 10
        PassengerFilter = NONE +INFANTRY
        ShowPips     = No
        ThisFormationIsTheMainFormation = Yes
        MeleeBehavior     = Amoeba
        End


        BannerCarriersAllowed    = DwarvenThalBanner
        BannerCarrierPosition    = UnitType:DwarvenThalBowman Pos:X:40.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:DwarvenThalBowman Position:X:0 Y:0    Position:X:0 Y:20    Position:X:0 Y:-20    Position:X:0 Y:40    Position:X:0 Y:-40
        RankInfo = RankNumber:2 UnitType:DwarvenThalBowman Position:X:20 Y:0    Position:X:15 Y:20    Position:X:20 Y:-20    Position:X:20 Y:40    Position:X:20 Y:-40
       

        RanksToReleaseWhenAttacking = 1 2 

        MeleeAttackLeashDistance = 1
        BackUpMinDelayTime         = 1
        BackUpMaxDelayTime         = 3000
        BackUpMinDistance         = 1
        BackUpMaxDistance         = 3
        BackupPercentage         = 80%
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

     Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded        =    NONE
        AfraidOf            =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf            =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
         PointAt                =    EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance        =    150
        FearScanDistance        =    CAVALRY_FEAR_SCAN_RADIUS

        AddEmotion            =    Terror_Base
        AddEmotion            =    Doom_Base
        AddEmotion            =       BraceForBeingCrushed_Base
        AddEmotion            =    UncontrollableFear_Base
        AddEmotion            =    FearIdle_Base
        AddEmotion            =    FearBusy_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
         AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    HeroCheerIdle_Base
        AddEmotion            =    HeroCheerBusy_Base
        AddEmotion            =    Alert_Base
    End

    LocomotorSet
        Locomotor     = NormalRangedHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = 50
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTraining
        LevelsToGain = 1
        LevelCap = 2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality
        TriggeredBy = Upgrade_FireArrows
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_HeavyArmor
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End






    Behavior = AISpecialPowerUpdate DwarvenMenOfDaleHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End


    Behavior = AISpecialPowerUpdate DwarvenMenOfDaleHordeBlackArrowAI
        CommandButtonName = Command_SpecialAbilityThalSchwarzePfeile
        SpecialPowerAIType = AI_SPECIAL_POWER_ENEMY_TYPE_KILLER_RANGED
    End

    Geometry = BOX
    GeometryMajorRadius = 20.0
    GeometryMinorRadius = 60.0
    GeometryHeight = 10.0
    GeometryIsSmall = No



    AutoResolveUnitType = AutoResolveUnit_Archer
    AutoResolveCombatChain = AutoResolve_ArcherCombatChain

    AutoResolveBody = AutoResolve_GondorArcherHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_GondorArcherHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_GondorArcherArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_FireArrows
        Weapon = AutoResolve_GondorArcherUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_FireArrows
        Weapon = AutoResolve_GondorArcherWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTraining Upgrade_FireArrows Upgrade_HeavyArmor
End

Object DwarvenLaketownBowmanHorde

    SelectPortrait         = UPLaketownBowmen
    ButtonImage            = HSLaketownBowmen

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR
        DefaultModelConditionState
            Model = None
        End
        ModelConditionState = HORDE_EMPTY
            Model = None
        End

        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkRUYeo
        End
    End

    Side = Dwarves
    EditorSorting = UNIT
    EmotionRange = 240
    DisplayName = OBJECT:DwarvenLaketownBowmenHorde
    DisplayNameStrategic = CONTROLBAR:LW_Unit_LaketownBowmenHorde
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_LaketownBowmenHorde

    WeaponSet
        Conditions = None
        Weapon = PRIMARY    NormalMissileHordeRangefinder
        Weapon = TERTIARY   NormalMissileHordeRangefinderBombard
        AutoChooseSources = TERTIARY FROM_PLAYER FROM_SCRIPT
    End

    CommandSet =  DwarvenLaketownBowmenHordeCommandSet



    #include "..\..\..\includes\StandardHordeEvaEvents.inc"

    CrushableLevel = 0
    CrusherLevel = 0
    UseCrushAttack = No

    BuildCost = 700
    BuildTime = MEDIUM_BUILDTIME

    VisionRange               = 375
    ShroudClearingRange       = 475
    VisionSide                = 50%
    VisionRear                = 25%
    MaxVisionBonusPercent     = 300%
    VisionBonusTestRadius     = 200
    VisionBonusPercentPerFoot = 1.0%

    CommandPoints = 50

    FormationWidth = 2
    FormationDepth = 1

    TransportSlotCount = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE ARCHER ARMY_SUMMARY LARGE_RECTANGLE_PATHFIND

    ThreatLevel = 120
    ThreatBreakdown DwarvenMenOfDaleHorde_DetailedThreat
        AIKindOf = ARCHER
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    Behavior = SpecialPowerModule ModuleTag_BlackArrowsStarter
        SpecialPowerTemplate        = SpecialAbilityBlackArrows
        UpdateModuleStartsAttack    = Yes
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_BlackArrowsWeaponFireUpdate
        SpecialPowerTemplate        = SpecialAbilityBlackArrows
        PackTime            	    = 2000
        StartAbilityRange           = #SUBTRACT( DWARVEN_MENOFDALE_RANGE 100 )
        SpecialWeapon               = DwarvenMenOfDaleBlackArrowsRangeFinder
        ApproachUntilMembersInRange = Yes
        TriggerSound                = YeomanArcherVoiceAttackCharge
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = ArcherHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle   = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate          = 500
        MaxCowerTime                 = 5000
        MinCowerTime                 = 3000
        CanAttackWhileContained      = Yes
        AILuaEventsList              = InfantryFunctions
        AttackPriority               = AttackPriority_Archer
    End

    Behavior = HordeContain ModuleTag_HordeContain
        ObjectStatusOfContained =
        InitialPayload     = DwarvenLaketownBowman 10
        Slots         = 10
        PassengerFilter = NONE +INFANTRY
        ShowPips     = No
        ThisFormationIsTheMainFormation = Yes
        MeleeBehavior     = Amoeba
        End


        BannerCarriersAllowed    = DwarvenLaketownBanner
        BannerCarrierPosition    = UnitType:DwarvenLaketownBowman Pos:X:40.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:DwarvenLaketownBowman Position:X:0 Y:0    Position:X:0 Y:20    Position:X:0 Y:-20    Position:X:0 Y:40    Position:X:0 Y:-40
        RankInfo = RankNumber:2 UnitType:DwarvenLaketownBowman Position:X:20 Y:0    Position:X:15 Y:20    Position:X:20 Y:-20    Position:X:20 Y:40    Position:X:20 Y:-40
        

        RanksToReleaseWhenAttacking = 1 2 
        AlternateFormation          = DwarvenLaketownBowmanHordeBlock
        MeleeAttackLeashDistance    = 1
        BackUpMinDelayTime          = 1
        BackUpMaxDelayTime          = 3000
        BackUpMinDistance           = 1
        BackUpMaxDistance           = 3
        BackupPercentage            = 80%
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

     Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay     =    1000
        TauntAndPointExcluded        =    NONE
        AfraidOf                     =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf               =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
        PointAt                      =    EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance             =    150
        FearScanDistance             =    CAVALRY_FEAR_SCAN_RADIUS

        AddEmotion            =    Terror_Base
        AddEmotion            =    Doom_Base
        AddEmotion            =    BraceForBeingCrushed_Base
        AddEmotion            =    UncontrollableFear_Base
        AddEmotion            =    FearIdle_Base
        AddEmotion            =    FearBusy_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
        AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    HeroCheerIdle_Base
        AddEmotion            =    HeroCheerBusy_Base
        AddEmotion            =    Alert_Base
    End

    LocomotorSet
        Locomotor     = NormalRangedHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = 50
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTraining
        LevelsToGain = 1
        LevelCap = 2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality
        TriggeredBy = Upgrade_FireArrows
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_HeavyArmor
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End






    Behavior = AISpecialPowerUpdate DwarvenMenOfDaleHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End


    Geometry = BOX
    GeometryMajorRadius = 20.0
    GeometryMinorRadius = 60.0
    GeometryHeight = 10.0
    GeometryIsSmall = No



    AutoResolveUnitType = AutoResolveUnit_Archer
    AutoResolveCombatChain = AutoResolve_ArcherCombatChain

    AutoResolveBody = AutoResolve_GondorArcherHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_GondorArcherHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_GondorArcherArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_FireArrows
        Weapon = AutoResolve_GondorArcherUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_FireArrows
        Weapon = AutoResolve_GondorArcherWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTraining Upgrade_FireArrows Upgrade_HeavyArmor
End


ChildObject DwarvenLaketownBowmanHordeBlock DwarvenLaketownBowmanHorde

    Behavior = HordeContain ModuleTag_HordeContain
        ObjectStatusOfContained =
        InitialPayload                  = DwarvenLaketownBowman 15
        Slots                           = 15
        PassengerFilter                 = NONE +INFANTRY
        ShowPips                        = No
        ThisFormationIsTheMainFormation = No
        AttributeModifiers              = LaketownMonstertoterFormation
        RandomOffset                    = X:0 Y:0
        MeleeBehavior = Amoeba
        End


        BannerCarriersAllowed    = DwarvenLaketownBanner
        BannerCarrierPosition    = UnitType:DwarvenLaketownBowman Pos:X:46.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:DwarvenLaketownBowman Position:X:34 Y:0            Position:X:34 Y:10                Position:X:34 Y:-10                Position:X:34 Y:20                Position:X:34 Y:-20
        RankInfo = RankNumber:2 UnitType:DwarvenLaketownBowman Position:X:22 Y:0 Leader 1 0    Position:X:22 Y:10 Leader 1 1    Position:X:22 Y:-10 Leader 1 2    Position:X:22 Y:20 Leader 1 3    Position:X:22 Y:-20 Leader 1 4
        RankInfo = RankNumber:3 UnitType:DwarvenLaketownBowman Position:X:10 Y:0 Leader 2 0    Position:X:10 Y:10 Leader 2 1    Position:X:10 Y:-10 Leader 2 2    Position:X:10 Y:20 Leader 2 3    Position:X:10 Y:-20 Leader 2 4

        RanksToReleaseWhenAttacking = 1 2

        AlternateFormation = DwarvenLaketownBowmanHorde
        MeleeAttackLeashDistance = 1
        BackUpMinDelayTime       = 1
        BackUpMaxDelayTime       = 3000
        BackUpMinDistance        = 1
        BackUpMaxDistance        = 3
        BackupPercentage         = 80%
    End
End

Object DwarvenThalPikemanHorde

    SelectPortrait         = UPThalSpearmen
    ButtonImage            = HIThalSpearmen_Wotr

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR EMOTION_LOOK_TO_SKY
        DefaultModelConditionState
            Model = None
        End
        ModelConditionState = HORDE_EMPTY
            Model = None
        End

        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkGUTow
        End
    End

    Side = Dwarves
    EditorSorting = UNIT
    EmotionRange = 240
    DisplayName = OBJECT:DwarvenThalSpearmenHorde
    DisplayNameStrategic = CONTROLBAR:LW_Unit_ThalSpearmenHorde
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_ThalSpearmenHorde

    WeaponSet
        Conditions = None
        Weapon = PRIMARY    TowerGuardHordeRangefinder
    End



    BuildCost                 = 250
    BuildTime                 = MEDIUM_BUILDTIME

    VisionRange               = 200
    ShroudClearingRange       = 475
    VisionSide                = 35%
    VisionRear                = 25%
    MaxVisionBonusPercent     = 300%
    VisionBonusTestRadius     = 200
    VisionBonusPercentPerFoot = 1.0%

    CommandPoints             = 50

    CommandSet = DwarvenThalSpearmenHordeCommandSet

    FormationWidth = 2
    FormationDepth = 1

    CrushableLevel = 0
    CrusherLevel = 0

    TransportSlotCount = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE ARMY_SUMMARY MELEE_HORDE PIKE LARGE_RECTANGLE_PATHFIND
    #include "..\..\..\includes\StandardHordeEvaEvents.inc"

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    ThreatLevel = 120
    ThreatBreakdown GondorTowerShieldGuardHorde_DetailedThreat
        AIKindOf = PIKEMAN
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = PikeHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle    = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate           = 500
        MaxCowerTime                  = 5000
        MinCowerTime                  = 3000
        AILuaEventsList               = InfantryFunctions
        AttackPriority                = AttackPriority_Spearman
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle            = STANDARD_PIKEMAN_FRONTANGLE
        FlankedDelay          = STANDARD_PIKEMAN_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload         = DwarvenThalPikeman 15
        Slots             = 15
        PassengerFilter        = NONE +INFANTRY
        ShowPips         = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset        = X:0 Y:0
        MeleeBehavior = Amoeba
            FacingBonus    = 30.0
            AngleLimitCos    = -0.17
            InnerRange    = 30
            OuterRange    = 80
            OuterRangeBuildings    = 140
        End


        BannerCarriersAllowed    = DwarvenThalBanner
        BannerCarrierPosition    = UnitType:DwarvenThalPikeman  Pos:X:70.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:DwarvenThalPikeman Position:X:50 Y:0        Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:50 Y:40        Position:X:50 Y:-40
        RankInfo = RankNumber:2 UnitType:DwarvenThalPikeman Position:X:30 Y:0 Leader 1 0    Position:X:30 Y:20 Leader 1 1    Position:X:30 Y:-20 Leader 1 2    Position:X:30 Y:40 Leader 1 3    Position:X:30 Y:-40 Leader 1 4
        RankInfo = RankNumber:3 UnitType:DwarvenThalPikeman Position:X:10 Y:0 Leader 2 0    Position:X:10 Y:20 Leader 2 1    Position:X:10 Y:-20 Leader 2 2    Position:X:10 Y:40 Leader 2 3    Position:X:10 Y:-40 Leader 2 4

        RanksToReleaseWhenAttacking = 1

        AlternateFormation = DwarvenThalPikemanHordePorcupine
        MeleeAttackLeashDistance = 1
        BackUpMinDelayTime         = 1
        BackUpMaxDelayTime         = 3000
        BackUpMinDistance         = 1
        BackUpMaxDistance         = 3
        BackupPercentage         = 80%
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

       Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded        =    NONE
         AfraidOf                    =    EMOTION_AFRAIDOF_OBJECTFILTER_LANCERS
        AlwaysAfraidOf                =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER_LANCERS
         PointAt                        =    EMOTION_POINTAT_OBJECTFILTER_LANCERS
        HeroScanDistance            =    150
        FearScanDistance            =    INFANTRY_FEAR_SCAN_RADIUS

        AddEmotion            =    Terror_Base
        AddEmotion            =    Doom_Base
        AddEmotion            =    UncontrollableFear_Base
        AddEmotion            =    FearIdle_Base
        AddEmotion            =    FearBusy_Base
        AddEmotion            =    Point_Base

        AddEmotion            =    OVERRIDE Taunt_Base
         End

        AddEmotion    =    CheerIdle_Base
        AddEmotion    =    CheerBusy_Base
        AddEmotion    =    HeroCheerIdle_Base
        AddEmotion    =    HeroCheerBusy_Base
        AddEmotion    =    Alert_Base
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End

    LocomotorSet
        Locomotor     = NormalMeleeHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = 50
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTraining
        LevelsToGain = 1
        LevelCap = 2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality
        TriggeredBy = Upgrade_ForgedBlades
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_HeavyArmor
    End





    Behavior = AISpecialPowerUpdate GondorTowerShieldGuardHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End


    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 45.0
    GeometryHeight = 20.0
    GeometryIsSmall = No



    AutoResolveUnitType = AutoResolveUnit_Pikemen
    AutoResolveCombatChain = AutoResolve_PikemenCombatChain

    AutoResolveBody = AutoResolve_GondorTowerGuardHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_GondorTowerGuardHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_GondorTowerGuardArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_GondorTowerGuardUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_GondorTowerGuardWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTraining Upgrade_ForgedBlades Upgrade_HeavyArmor
End

ChildObject DwarvenThalPikemanHordePorcupine DwarvenThalPikemanHorde

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle            = STANDARD_PIKEMAN_FRONTANGLE_FORMATION
        FlankedDelay          = STANDARD_PIKEMAN_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload                    = DwarvenThalPikeman  GOOD_MEN_HORDE_SIZE
        Slots                            = 15
        PassengerFilter                    = NONE +INFANTRY
        ShowPips                        = No
        ThisFormationIsTheMainFormation = No
        RandomOffset                    = X:2 Y:1
        RanksToReleaseWhenAttacking        = 0
        RanksToJustFreeWhenAttacking   = 0
        AttributeModifiers                = EdainHordePorcupine
        IsPorcupineFormation            = Yes
        MinimumHordeSize                = 5

        AlternateFormation                = DwarvenThalPikemanHorde
        VisionRearOverride                = 100%
        VisionSideOverride                = 100%
        NotComboFormation                = Yes


        BannerCarriersAllowed            = DwarvenThalBanner
        BannerCarrierPosition            = UnitType:DwarvenThalPikeman  Pos:X:0.0 Y:0.0

        RankInfo    = RankNumber:1 UnitType:DwarvenThalPikeman Position:X:20 Y:0    Position:X:-16.18 Y:11.76        Position:X:6.18 Y:-19.02    Position:X:6.18 Y:19.02    Position:X:-16.18 Y:-11.76    Position:X:36.54 Y:16.27    Position:X:-39.13 Y:8.32    Position:X:26.77 Y:-29.73    Position:X:-4.18 Y:39.78    Position:X:-20 Y:-34.64    Position:X:26.77 Y:29.73    Position:X:-39.13 Y:-8.32    Position:X:36.54 Y:-16.27    Position:X:-20 Y:34.64    Position:X:-4.18 Y:-39.78
    End
End

Object DwarvenLaketownPikemanHorde

    SelectPortrait         = UPLaketownSpearmen
    ButtonImage            = HSLaketownSpearmen

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR EMOTION_LOOK_TO_SKY
        DefaultModelConditionState
            Model = None
        End
        ModelConditionState = HORDE_EMPTY
            Model = None
        End

        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkGUTow
        End
    End

    Side = Dwarves
    EditorSorting = UNIT
    EmotionRange = 240
    DisplayName = OBJECT:DwarvenLaketownSpearmenHorde
    DisplayNameStrategic = CONTROLBAR:LW_Unit_LaketownSpearmenHorde
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_LaketownSpearmenHorde

    WeaponSet
        Conditions = None
        Weapon = PRIMARY    TowerGuardHordeRangefinder
    End



    BuildCost                 = 250
    BuildTime                 = MEDIUM_BUILDTIME

    VisionRange               = 200
    ShroudClearingRange       = 475
    VisionSide                = 35%
    VisionRear                = 25%
    MaxVisionBonusPercent     = 300%
    VisionBonusTestRadius     = 200
    VisionBonusPercentPerFoot = 1.0%

    CommandPoints             = 50

    CommandSet = DwarvenLaketownSpearmenHordeCommandSet

    FormationWidth = 2
    FormationDepth = 1

     CrushableLevel = 0
    CrusherLevel = 0

    TransportSlotCount = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE ARMY_SUMMARY MELEE_HORDE PIKE LARGE_RECTANGLE_PATHFIND
    #include "..\..\..\includes\StandardHordeEvaEvents.inc"

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    ThreatLevel = 120
    ThreatBreakdown GondorTowerShieldGuardHorde_DetailedThreat
        AIKindOf = PIKEMAN
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = PikeHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle    = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate           = 500
        MaxCowerTime                  = 5000
        MinCowerTime                  = 3000
        AILuaEventsList               = InfantryFunctions
        AttackPriority                = AttackPriority_Spearman
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle            = STANDARD_PIKEMAN_FRONTANGLE
        FlankedDelay          = STANDARD_PIKEMAN_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload         = DwarvenLaketownPikeman 15
        Slots             = 15
        PassengerFilter        = NONE +INFANTRY
        ShowPips         = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset        = X:0 Y:0
        MeleeBehavior = Amoeba
            FacingBonus    = 30.0
            AngleLimitCos    = -0.17
            InnerRange    = 30
            OuterRange    = 80
            OuterRangeBuildings    = 140
        End


        BannerCarriersAllowed    = DwarvenLaketownBanner
        BannerCarrierPosition    = UnitType:DwarvenLaketownPikeman  Pos:X:70.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:DwarvenLaketownPikeman Position:X:50 Y:0        Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:50 Y:40        Position:X:50 Y:-40
        RankInfo = RankNumber:2 UnitType:DwarvenLaketownPikeman Position:X:30 Y:0 Leader 1 0    Position:X:30 Y:20 Leader 1 1    Position:X:30 Y:-20 Leader 1 2    Position:X:30 Y:40 Leader 1 3    Position:X:30 Y:-40 Leader 1 4
        RankInfo = RankNumber:3 UnitType:DwarvenLaketownPikeman Position:X:10 Y:0 Leader 2 0    Position:X:10 Y:20 Leader 2 1    Position:X:10 Y:-20 Leader 2 2    Position:X:10 Y:40 Leader 2 3    Position:X:10 Y:-40 Leader 2 4

        RanksToReleaseWhenAttacking = 1

        AlternateFormation       = DwarvenLaketownPikemanHordePorcupine
        MeleeAttackLeashDistance = 1
        BackUpMinDelayTime       = 1
        BackUpMaxDelayTime       = 3000
        BackUpMinDistance        = 1
        BackUpMaxDistance        = 3
        BackupPercentage         = 80%
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

       Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded        =    NONE
        AfraidOf                    =    EMOTION_AFRAIDOF_OBJECTFILTER_LANCERS
        AlwaysAfraidOf                =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER_LANCERS
        PointAt                        =    EMOTION_POINTAT_OBJECTFILTER_LANCERS
        HeroScanDistance            =    150
        FearScanDistance            =    INFANTRY_FEAR_SCAN_RADIUS

        AddEmotion            =    Terror_Base
        AddEmotion            =    Doom_Base
        AddEmotion            =    UncontrollableFear_Base
        AddEmotion            =    FearIdle_Base
        AddEmotion            =    FearBusy_Base
        AddEmotion            =    Point_Base

        AddEmotion            =    OVERRIDE Taunt_Base

         End

        AddEmotion    =    CheerIdle_Base
        AddEmotion    =    CheerBusy_Base
        AddEmotion    =    HeroCheerIdle_Base
        AddEmotion    =    HeroCheerBusy_Base
        AddEmotion    =    Alert_Base
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End

    LocomotorSet
        Locomotor     = NormalMeleeHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = 50
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTraining
        LevelsToGain = 1
        LevelCap = 2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality
        TriggeredBy = Upgrade_ForgedBlades
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_HeavyArmor
    End





    Behavior = AISpecialPowerUpdate GondorTowerShieldGuardHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End


    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 45.0
    GeometryHeight = 20.0
    GeometryIsSmall = No



    AutoResolveUnitType = AutoResolveUnit_Pikemen
    AutoResolveCombatChain = AutoResolve_PikemenCombatChain

    AutoResolveBody = AutoResolve_GondorTowerGuardHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_GondorTowerGuardHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_GondorTowerGuardArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_GondorTowerGuardUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_GondorTowerGuardWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTraining Upgrade_ForgedBlades Upgrade_HeavyArmor
End


ChildObject DwarvenLaketownPikemanHordePorcupine DwarvenLaketownPikemanHorde

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle            = STANDARD_PIKEMAN_FRONTANGLE_FORMATION
        FlankedDelay          = STANDARD_PIKEMAN_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload                  = DwarvenLaketownPikeman 15
        Slots                           = 15
        PassengerFilter                 = NONE +INFANTRY
        ShowPips                        = No
        ThisFormationIsTheMainFormation = No
        AttributeModifiers              = LaketownMonstertoterFormation
        RandomOffset                    = X:0 Y:0
        MeleeBehavior = Amoeba
        End


        BannerCarriersAllowed    = DwarvenLaketownBanner
        BannerCarrierPosition    = UnitType:DwarvenLaketownPikeman Pos:X:46.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:DwarvenLaketownPikeman Position:X:34 Y:0            Position:X:34 Y:10                Position:X:34 Y:-10                Position:X:34 Y:20                Position:X:34 Y:-20
        RankInfo = RankNumber:2 UnitType:DwarvenLaketownPikeman Position:X:22 Y:0 Leader 1 0    Position:X:22 Y:10 Leader 1 1    Position:X:22 Y:-10 Leader 1 2    Position:X:22 Y:20 Leader 1 3    Position:X:22 Y:-20 Leader 1 4
        RankInfo = RankNumber:3 UnitType:DwarvenLaketownPikeman Position:X:10 Y:0 Leader 2 0    Position:X:10 Y:10 Leader 2 1    Position:X:10 Y:-10 Leader 2 2    Position:X:10 Y:20 Leader 2 3    Position:X:10 Y:-20 Leader 2 4

        RanksToReleaseWhenAttacking = 1 2

        AlternateFormation = DwarvenLaketownPikemanHorde
        MeleeAttackLeashDistance = 1
        BackUpMinDelayTime       = 1
        BackUpMaxDelayTime       = 3000
        BackUpMinDistance        = 1
        BackUpMaxDistance        = 3
        BackupPercentage         = 80%
    End
End

Object DwarvenThalSwordmanHorde

    SelectPortrait    = UPThalSwordmen
    ButtonImage       = HIThalSwordmen_Wotr

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER EMOTION_TERROR EMOTION_LOOK_TO_SKY EMOTION_TAUNTING EMOTION_POINTING SELECTED
        DefaultModelConditionState
            Model = None
        End

        ModelConditionState = HORDE_EMPTY
            Model = None
        End

        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkGUSol
        End
    End

    Side = Dwarves
    EditorSorting = UNIT
    EmotionRange = 240
    DisplayName = OBJECT:DwarvenThalSwordmenHorde
    DisplayNameStrategic = CONTROLBAR:LW_Unit_ThalSwordmenHorde
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_ThalSwordmenHorde

    WeaponSet
        Conditions = None
        Weapon = PRIMARY    NormalMeleeHordeRangefinder
    End



    #include "..\..\..\includes\StandardHordeEvaEvents.inc"

    BuildCost = 200
    BuildTime = WEAK_BUILDTIME

    ShroudClearingRange = 475
    VisionRange = 200
    VisionSide = 35%
    VisionRear = 25%
    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = 200
    VisionBonusPercentPerFoot = 1.0%

    CommandPoints = 50
    CommandSet    = DwarvenThalSwordmenHordeCommandSet

    FormationWidth = 2
    FormationDepth = 1

    CrushableLevel = 0
    CrusherLevel = 0

    TransportSlotCount = TRANSPORTSLOTCOUNT_UNIT
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE MELEE_HORDE NOTIFY_OF_PREATTACK ARMY_SUMMARY LARGE_RECTANGLE_PATHFIND

    ThreatLevel = 120
    ThreatBreakdown GondorFighterHorde_DetailedThreat
        AIKindOf = INFANTRY
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = FighterHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle    = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate           = 500
        MaxCowerTime                  = 5000
        MinCowerTime                  = 3000
        AILuaEventsList               = InfantryFunctions
        AttackPriority                = AttackPriority_Infantry
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload = DwarvenThalSwordman 15
        Slots = 15
        PassengerFilter    = NONE +INFANTRY
        ShowPips = No
        ThisFormationIsTheMainFormation = Yes
        MeleeBehavior = Amoeba
        End


        BannerCarriersAllowed    = DwarvenThalBanner
        BannerCarrierPosition    = UnitType:DwarvenThalSwordman Pos:X:70.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:DwarvenThalSwordman Position:X:50 Y:0            Position:X:50 Y:20                Position:X:50 Y:-20                Position:X:50 Y:40                Position:X:50 Y:-40
        RankInfo = RankNumber:2 UnitType:DwarvenThalSwordman Position:X:30 Y:0            Position:X:30 Y:20                Position:X:30 Y:-20                Position:X:30 Y:40                Position:X:30 Y:-40
        RankInfo = RankNumber:3 UnitType:DwarvenThalSwordman Position:X:10 Y:0            Position:X:10 Y:20                Position:X:10 Y:-20                Position:X:10 Y:40                Position:X:10 Y:-40

        RanksToReleaseWhenAttacking = 1 2 3
        AlternateFormation          = DwarvenThalSwordmanHordeBlock
        MeleeAttackLeashDistance    = 1
        BackUpMinDelayTime          = 1
        BackUpMaxDelayTime          = 3000
        BackUpMinDistance           = 1
        BackUpMaxDistance           = 3
        BackupPercentage            = 80%
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

    Behavior = CommandButtonHuntUpdate ModuleTag_CommandButtonHuntUpdate
    End

    Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay     =    1000
        TauntAndPointExcluded        =    NONE
        AfraidOf                     =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf               =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
        PointAt                      =    EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance             =    150
        FearScanDistance             =    CAVALRY_FEAR_SCAN_RADIUS

        AddEmotion            =    Terror_Base
        AddEmotion            =    Doom_Base

        AddEmotion            =    BraceForBeingCrushed_Base

        AddEmotion            =    UncontrollableFear_Base

        AddEmotion            =    FearIdle_Base

        AddEmotion            =    FearBusy_Base

        AddEmotion            =    Point_Base

        AddEmotion            =    Taunt_Base

        AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    HeroCheerIdle_Base
        AddEmotion            =    HeroCheerBusy_Base
        AddEmotion            =    Alert_Base
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End

    LocomotorSet
        Locomotor     = NormalRangedHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = 50
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy  = Upgrade_BasicTraining
        LevelsToGain = 1
        LevelCap     = 2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality
        TriggeredBy = Upgrade_HeavyArmor
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_ForgedBlades
    End





    Behavior = AISpecialPowerUpdate GondorFighterHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 45.0
    GeometryHeight = 20.0
    GeometryIsSmall = No


    AutoResolveUnitType = AutoResolveUnit_Archer
    AutoResolveCombatChain = AutoResolve_ArcherCombatChain

    AutoResolveBody = AutoResolve_DwarvenMenOfDaleHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_DwarvenMenOfDaleHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_DwarvenMenOfDaleArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_GondorSoldierUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_GondorSoldierWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTraining Upgrade_ForgedBlades Upgrade_HeavyArmor
End


ChildObject DwarvenThalSwordmanHordeBlock DwarvenThalSwordmanHorde

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload                  = DwarvenThalSwordman 15
        Slots                           = 15
        PassengerFilter                 = NONE +INFANTRY
        ShowPips                        = No
        ThisFormationIsTheMainFormation = No
        AttributeModifiers              = ThalMarschformation
        RandomOffset                    = X:0 Y:0
        MeleeBehavior = Amoeba
        End


        BannerCarriersAllowed    = DwarvenThalBanner
        BannerCarrierPosition    = UnitType:DwarvenThalSwordman Pos:X:46.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:DwarvenThalSwordman Position:X:35 Y:0              Position:X:30 Y:25              Position:X:30 Y:-25              Position:X:40 Y:40              Position:X:41 Y:-40
        RankInfo = RankNumber:2 UnitType:DwarvenThalSwordman Position:X:15 Y:0 Leader 1 0   Position:X:10 Y:20 Leader 1 1   Position:X:10 Y:-20 Leader 1 2   Position:X:15 Y:40 Leader 1 3   Position:X:17 Y:-42 Leader 1 4
        RankInfo = RankNumber:3 UnitType:DwarvenThalSwordman Position:X:-5 Y:0 Leader 2 0   Position:X:-12 Y:20 Leader 2 1  Position:X:-15 Y:-20 Leader 2 2  Position:X:-5 Y:40 Leader 2 3    Position:X:-8 Y:-38 Leader 2 4

        RanksToReleaseWhenAttacking = 1 2

        AlternateFormation = DwarvenThalSwordmanHorde
        MeleeAttackLeashDistance = 1
        BackUpMinDelayTime       = 1
        BackUpMaxDelayTime       = 3000
        BackUpMinDistance        = 1
        BackUpMaxDistance        = 3
        BackupPercentage         = 80%
    End
End

Object DwarvenLaketownSwordmanHorde

    SelectPortrait         =    UPLaketownSwordmen
    ButtonImage            =    HSLaketownSwordmen

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER EMOTION_TERROR EMOTION_LOOK_TO_SKY EMOTION_TAUNTING EMOTION_POINTING SELECTED
        DefaultModelConditionState
            Model = None
        End

        ModelConditionState = HORDE_EMPTY
            Model = None
        End

        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkGUSol
        End
    End

    Side = Dwarves
    EditorSorting = UNIT
    EmotionRange = 240
    DisplayName = OBJECT:DwarvenLaketownSwordmenHorde
    DisplayNameStrategic = CONTROLBAR:LW_Unit_LaketownSwordmenHorde
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_LaketownSwordmenHorde

    WeaponSet
        Conditions = None
        Weapon = PRIMARY    NormalMeleeHordeRangefinder
    End



    #include "..\..\..\includes\StandardHordeEvaEvents.inc"

    BuildCost = 225
    BuildTime = MEDIUM_BUILDTIME

    ShroudClearingRange = 475
    VisionRange = 200
    VisionSide = 35%
    VisionRear = 25%
    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = 200
    VisionBonusPercentPerFoot = 1.0%

    CommandPoints = 50
    CommandSet    = DwarvenLaketownSwordmenHordeCommandSet

    FormationWidth = 2
    FormationDepth = 1

    CrushableLevel = 0
    CrusherLevel = 0

    TransportSlotCount = TRANSPORTSLOTCOUNT_UNIT
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE MELEE_HORDE NOTIFY_OF_PREATTACK ARMY_SUMMARY LARGE_RECTANGLE_PATHFIND

    ThreatLevel = 120
    ThreatBreakdown GondorFighterHorde_DetailedThreat
        AIKindOf = INFANTRY
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = FighterHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle  = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate         = 500
        MaxCowerTime                = 5000
        MinCowerTime                = 3000
        AILuaEventsList             = InfantryFunctions
        AttackPriority              = AttackPriority_Infantry
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload = DwarvenLaketownSwordman 15
        Slots = 15
        PassengerFilter    = NONE +INFANTRY
        ShowPips = No
        ThisFormationIsTheMainFormation = Yes
        MeleeBehavior = Amoeba
        End


        BannerCarriersAllowed    = DwarvenLaketownBanner
        BannerCarrierPosition    = UnitType:DwarvenLaketownSwordman Pos:X:70.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:DwarvenLaketownSwordman Position:X:50 Y:0            Position:X:50 Y:20                Position:X:50 Y:-20                Position:X:50 Y:40                Position:X:50 Y:-40
        RankInfo = RankNumber:2 UnitType:DwarvenLaketownSwordman Position:X:30 Y:0            Position:X:30 Y:20                Position:X:30 Y:-20                Position:X:30 Y:40                Position:X:30 Y:-40
        RankInfo = RankNumber:3 UnitType:DwarvenLaketownSwordman Position:X:10 Y:0            Position:X:10 Y:20                Position:X:10 Y:-20                Position:X:10 Y:40                Position:X:10 Y:-40

        RanksToReleaseWhenAttacking = 1 2 3
        AlternateFormation = DwarvenLaketownSwordmanHordeBlock
        MeleeAttackLeashDistance = 1
        BackUpMinDelayTime         = 1
        BackUpMaxDelayTime         = 3000
        BackUpMinDistance         = 1
        BackUpMaxDistance         = 3
        BackupPercentage         = 80%
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

    Behavior = CommandButtonHuntUpdate ModuleTag_CommandButtonHuntUpdate
    End

     Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay     =    1000
        TauntAndPointExcluded        =    NONE
        AfraidOf                     =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf               =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
        PointAt                      =    EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance             =    150
        FearScanDistance             =    CAVALRY_FEAR_SCAN_RADIUS

        AddEmotion            =    Terror_Base
        AddEmotion            =    Doom_Base

        AddEmotion            =    BraceForBeingCrushed_Base

        AddEmotion            =    UncontrollableFear_Base

        AddEmotion            =    FearIdle_Base

        AddEmotion            =    FearBusy_Base

        AddEmotion            =    Point_Base

        AddEmotion            =    Taunt_Base

        AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    HeroCheerIdle_Base
        AddEmotion            =    HeroCheerBusy_Base
        AddEmotion            =    Alert_Base
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End

    LocomotorSet
        Locomotor     = NormalRangedHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = 50
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTraining
        LevelsToGain = 1
        LevelCap = 2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality
        TriggeredBy = Upgrade_HeavyArmor
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_ForgedBlades
    End





    Behavior = AISpecialPowerUpdate GondorFighterHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 45.0
    GeometryHeight = 20.0
    GeometryIsSmall = No

    AutoResolveUnitType = AutoResolveUnit_Archer
    AutoResolveCombatChain = AutoResolve_ArcherCombatChain

    AutoResolveBody = AutoResolve_DwarvenMenOfDaleHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_DwarvenMenOfDaleHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_DwarvenMenOfDaleArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_GondorSoldierUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_GondorSoldierWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTraining Upgrade_ForgedBlades Upgrade_HeavyArmor
End


ChildObject DwarvenLaketownSwordmanHordeBlock DwarvenLaketownSwordmanHorde

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload                  = DwarvenLaketownSwordman 15
        Slots                           = 15
        PassengerFilter                 = NONE +INFANTRY
        ShowPips                        = No
        ThisFormationIsTheMainFormation = No
        AttributeModifiers              = LaketownMonstertoterFormation
        RandomOffset                    = X:0 Y:0
        MeleeBehavior = Amoeba
        End


        BannerCarriersAllowed    = DwarvenLaketownBanner
        BannerCarrierPosition    = UnitType:DwarvenLaketownSwordman Pos:X:46.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:DwarvenLaketownSwordman Position:X:34 Y:0            Position:X:34 Y:10                Position:X:34 Y:-10                Position:X:34 Y:20                Position:X:34 Y:-20
        RankInfo = RankNumber:2 UnitType:DwarvenLaketownSwordman Position:X:22 Y:0 Leader 1 0    Position:X:22 Y:10 Leader 1 1    Position:X:22 Y:-10 Leader 1 2    Position:X:22 Y:20 Leader 1 3    Position:X:22 Y:-20 Leader 1 4
        RankInfo = RankNumber:3 UnitType:DwarvenLaketownSwordman Position:X:10 Y:0 Leader 2 0    Position:X:10 Y:10 Leader 2 1    Position:X:10 Y:-10 Leader 2 2    Position:X:10 Y:20 Leader 2 3    Position:X:10 Y:-20 Leader 2 4

        RanksToReleaseWhenAttacking = 1 2

        AlternateFormation = DwarvenLaketownSwordmanHorde
        MeleeAttackLeashDistance = 1
        BackUpMinDelayTime       = 1
        BackUpMaxDelayTime       = 3000
        BackUpMinDistance        = 1
        BackUpMaxDistance        = 3
        BackupPercentage         = 80%
    End
End

