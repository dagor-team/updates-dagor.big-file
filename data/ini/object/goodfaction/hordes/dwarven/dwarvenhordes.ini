Object DwarvenGuardianHorde

    ButtonImage       = WOR_Guardian
    SelectPortrait    = UPDwarvenGuardian

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER EMOTION_TERROR EMOTION_LOOK_TO_SKY SELECTED
        DefaultModelConditionState
            Model = None
        End

        ModelConditionState = HORDE_EMPTY
            Model = None
        End

        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkEUDFG
        End
    End

    Side 		 = Dwarves
    EditorSorting 	 = UNIT
    EmotionRange 	 = 240
    DisplayName 	 = OBJECT:HordeDwarvenGuardian
    DisplayNameStrategic = CONTROLBAR:LW_Unit_DwarvenGuardianHorde
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_DwarvenGuardianHorde

    WeaponSet
        Conditions = None
        Weapon     = PRIMARY    NormalMeleeHordeRangefinder
    End



    #include "..\..\..\includes\StandardHordeEvaEvents.inc"
    #include "..\..\..\includes\DwarvenRunesUnits.inc"
    
    UnitSpecificSounds
        VoiceDesperateAttack  = GondorSoldierVoiceDesperateCharge
    End

    BuildCost 		= DWARVEN_GAURDIANDAG_BUILDCOST
    BuildTime 		= WEAK_BUILDTIME
    VisionRange 	= DWARVEN_GUARDIAN_HORDE_VISION_RANGE
    ShroudClearingRange = DWARVEN_GUARDIAN_SHROUD_RANGE
    VisionSide 		= 50%
    VisionRear 		= 25%

    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = 200
    VisionBonusPercentPerFoot = 1.0%
    CommandPoints 	  = 40

    FormationWidth = 2
    FormationDepth = 1

    CrushableLevel = 0
    CrusherLevel   = 1

    CrushOnlyWhileCharging = Yes

    MinCrushVelocityPercent = MINCRUSHVELOCITYPERCENT_STANDARD
    CrushDecelerationPercent = CRUSHDECELERATIONPERCENT_STANDARD

    CrushKnockback = 40
    CrushZFactor   = 1.0

    TransportSlotCount = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE MELEE_HORDE NOTIFY_OF_PREATTACK ARMY_SUMMARY LARGE_RECTANGLE_PATHFIND

    ThreatLevel = DWARVEN_GUARDIAN_HORDE_THREAT
    ThreatBreakdown DwarvenGuardianHorde_DetailedThreat
        AIKindOf = INFANTRY
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = FighterHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle        = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate            = 500
        MaxCowerTime                = 5000
        MinCowerTime                = 3000

        CanAttackWhileContained            = Yes
        AILuaEventsList                = InfantryFunctions
        AttackPriority                = AttackPriority_Infantry
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained            =
        InitialPayload                = DwarvenGuardian 10
        Slots                    = 10
        PassengerFilter                = NONE +INFANTRY
        ShowPips                = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset = X:0 Y:0

        MeleeBehavior = Amoeba
        End

        BannerCarriersAllowed    = DwarvenBanner
        BannerCarrierPosition    = UnitType:DwarvenGuardian    Pos:X:70.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:DwarvenGuardian Position:X:50 Y:0        Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:50 Y:40        Position:X:50 Y:-40
        RankInfo = RankNumber:2 UnitType:DwarvenGuardian Position:X:30 Y:0 Leader 1 0    Position:X:30 Y:20 Leader 1 1    Position:X:30 Y:-20 Leader 1 2    Position:X:30 Y:40 Leader 1 3    Position:X:30 Y:-40 Leader 1 4

        RanksToReleaseWhenAttacking        = 1

        MeleeAttackLeashDistance        = 25
        BackUpMinDelayTime              = 1
        BackUpMaxDelayTime              = 3000
        BackUpMinDistance               = 1
        BackUpMaxDistance               = 3
        BackupPercentage                = 80%
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

    Behavior = CommandButtonHuntUpdate ModuleTag_CommandButtonHuntUpdate
    End

    Behavior = HordeNotifyTargetsOfImminentProbableCrushingUpdate ModuleTag_NotifyCrushScan
        ScanWidth = 60.0
    End

       Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance       =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded       =    NONE
        AfraidOf                    =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf              =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
        PointAt                     =    EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance            =    150
        FearScanDistance            =    INFANTRY_FEAR_SCAN_RADIUS

        AddEmotion            =    Terror_Base
        AddEmotion            =    Doom_Base
        AddEmotion            =    BraceForBeingCrushed_Base
        AddEmotion            =    UncontrollableFear_Base
        AddEmotion            =    FearIdle_Base
        AddEmotion            =    FearBusy_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
        AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    HeroCheerIdle_Base
        AddEmotion            =    HeroCheerBusy_Base
        AddEmotion            =    Alert_Base
        AddEmotion            =    CheerForAboutToCrush_Base
    End

    LocomotorSet
        Locomotor     = NormalChargeMeleeHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_FOOT_SLOW_HORDE_SPEED
    End

    LocomotorSet
        Locomotor     = ScaredMeleeHordeLocomotor
        Condition     = SET_SCARED
        Speed         = NORMAL_FOOT_SLOW_HORDE_SPEED
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTraining
        LevelsToGain = 1
        LevelCap = 2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality1
        TriggeredBy = Upgrade_DwarvenSiegeHammer
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_ForgedBlades
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality3
        TriggeredBy = Upgrade_DwarvenMithrilMail
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End




    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_ChargeUnpause
        SpecialPowerTemplate          = SpecialAbilityDwarvenCharge
        TriggeredBy                   = Upgrade_ObjectLevel2
    End

      Behavior = SpecialPowerModule ModuleTag_ChargeStarter
        SpecialPowerTemplate          = SpecialAbilityDwarvenCharge
        UpdateModuleStartsAttack      = Yes
        StartsPaused                  = Yes
    End

    #include "..\..\..\includes\DwarvenChargeUpdate.inc"

    CommandSet = DwarvenGuardianHordeCommandSet

    Behavior = ObjectCreationUpgrade ModuleTag_MithrilMailPalantirFix
        TriggeredBy  = Upgrade_TechnologyDwarvenMithrilMail
        GrantUpgrade = Upgrade_HeavyArmor
    End

    Behavior = CommandSetUpgrade ModuleTag_MithrilCommandSet
        TriggeredBy       = Upgrade_TechnologyDwarvenMithrilMail
        CommandSet        = DwarvenGuardianHordeCommandSet_Mithril
    End





    Behavior = AISpecialPowerUpdate DwarvenGuardianHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Behavior = AISpecialPowerUpdate DwarfGuardianCharge
        CommandButtonName = Command_DwarvenGuardianChargeAttack
        SpecialPowerAIType = AI_SPECIAL_POWER_CHARGE
    End

    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 50.0
    GeometryHeight = 20.0
    GeometryIsSmall = No


    AutoResolveUnitType = AutoResolveUnit_Soldier
    AutoResolveCombatChain = AutoResolve_SoldierCombatChain

    AutoResolveBody = AutoResolve_DwarvenGuardianHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_DwarvenGuardianHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_DwarvenGuardianArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_DwarvenGuardianUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_DwarvenGuardianWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTraining Upgrade_ForgedBlades Upgrade_HeavyArmor
End



Object DwarvenAxeThrowerHorde

    SelectPortrait         = UPEreborAxeThrower
    ButtonImage            = UPEreborAxeThrower

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER EMOTION_TERROR EMOTION_LOOK_TO_SKY SELECTED
        DefaultModelConditionState
            Model = None
        End

        ModelConditionState = HORDE_EMPTY
            Model = None
        End

        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkEUDfA
        End
    End

    Side                    = Dwarves
    EditorSorting           = UNIT
    EmotionRange            = 240
    DisplayName             = OBJECT:HordeDwarvenAxeThrower
    DisplayNameStrategic    = CONTROLBAR:LW_Unit_DwarvenAxeThrowerHorde
    DescriptionStrategic    = CONTROLBAR:LW_ToolTip_DwarvenAxeThrowerHorde

    WeaponSet
        Conditions    = None
        Weapon        = PRIMARY    DwarvenAxeThrowHordeRangefinder
        Weapon        = TERTIARY   DwarvenAxeThrowHordeRangefinderBombard
        AutoChooseSources = TERTIARY FROM_PLAYER FROM_SCRIPT
    End



    #include "..\..\..\includes\StandardHordeEvaEvents.inc"
    #include "..\..\..\includes\DwarvenRunesUnits.inc"

    UnitSpecificSounds
        VoiceDesperateAttack  = GondorSoldierVoiceDesperateCharge
    End

    BuildCost        = 400
    BuildTime        = MEDIUM_BUILDTIME

    ShroudClearingRange = 350
    VisionRange         = 350
    VisionSide          = 50%
    VisionRear          = 25%

    MaxVisionBonusPercent     = 300%
    VisionBonusTestRadius     = 200
    VisionBonusPercentPerFoot = 1.0

    CommandPoints         = 50

    FormationWidth        = 2
    FormationDepth        = 1

    CrushableLevel        = 0
    CrusherLevel          = 0
    CrushZFactor          = 1.0
    UseCrushAttack        = No

    TransportSlotCount = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY ARCHER HORDE MELEE_HORDE NOTIFY_OF_PREATTACK ARMY_SUMMARY LARGE_RECTANGLE_PATHFIND ARCHER

    ThreatLevel = DWARVEN_AXETHROWER_HORDE_THREAT
    ThreatBreakdown DwarvenAxeThrowerHorde_DetailedThreat
        AIKindOf = ARCHER
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = ArcherHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle   = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate          = 500
        MaxCowerTime                 = 5000
        MinCowerTime                 = 3000
        CanAttackWhileContained      = Yes
        AILuaEventsList              = InfantryFunctions
        AttackPriority               = AttackPriority_Infantry
    End

    Behavior                 = HordeContain ModuleTag_HordeContain
        FrontAngle = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained     =
        InitialPayload             = DwarvenAxeThrower 10
        Slots                 = 10
        PassengerFilter         = NONE +INFANTRY
        ShowPips             = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset            = X:0 Y:0
        MeleeBehavior             = Amoeba
        End


        BannerCarriersAllowed    = DwarvenEreborBanner
        BannerCarrierPosition    = UnitType:DwarvenAxeThrower    Pos:X:70.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:DwarvenAxeThrower Position:X:50 Y:0        Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:50 Y:40        Position:X:50 Y:-40
        RankInfo = RankNumber:2 UnitType:DwarvenAxeThrower Position:X:30 Y:0 Leader 1 0    Position:X:30 Y:20 Leader 1 1    Position:X:30 Y:-20 Leader 1 2    Position:X:30 Y:40 Leader 1 3    Position:X:30 Y:-40 Leader 1 4

        RanksToReleaseWhenAttacking = 1 2

        MeleeAttackLeashDistance     = 1
        BackUpMinDelayTime           = 1
        BackUpMaxDelayTime           = 3000
        BackUpMinDistance            = 1
        BackUpMaxDistance            = 3
        BackupPercentage             = 80%
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

    Behavior = CommandButtonHuntUpdate ModuleTag_CommandButtonHuntUpdate
    End

       Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance       =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded       =    NONE
        AfraidOf                    =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf              =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
        PointAt                     =    EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance        =    150
        FearScanDistance        =    INFANTRY_FEAR_SCAN_RADIUS

        AddEmotion            =    Terror_Base
        AddEmotion            =    Doom_Base
        AddEmotion            =    BraceForBeingCrushed_Base
        AddEmotion            =    UncontrollableFear_Base
        AddEmotion            =    FearIdle_Base
        AddEmotion            =    FearBusy_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
        AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    HeroCheerIdle_Base
        AddEmotion            =    HeroCheerBusy_Base
        AddEmotion            =    Alert_Base
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End


    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_DainLeadership
        SpecialPowerTemplate        = SpecialAbilityFakeLeadership
        TriggeredBy                 = Upgrade_Level_1
    End

    Behavior = SpecialPowerModule ModuleTag_DainLeadershipUpdate
        SpecialPowerTemplate        = SpecialAbilityFakeLeadership
        UpdateModuleStartsAttack    = No
        StartsPaused                = No
    End

    Behavior = AttributeModifierAuraUpdate ModuleTag_Leadership1
        StartsActive     = Yes
        BonusName        = DwarvenAxeThrowPassive
        RefreshDelay     = 2000
        Range            = 150
        ObjectFilter     = NONE +DwarvenAxeThrowerHorde ALLIES
    End


    LocomotorSet
        Locomotor     = NormalChargeMeleeHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_FOOT_SLOW_HORDE_SPEED
    End

    LocomotorSet
        Locomotor     = ScaredMeleeHordeLocomotor
        Condition     = SET_SCARED
        Speed         = NORMAL_FOOT_SLOW_HORDE_SPEED
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality
        TriggeredBy        = Upgrade_ForgedBlades
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy        = Upgrade_DwarvenMithrilMail
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality17
        TriggeredBy        = Upgrade_HeavyArmor
    End

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy        = Upgrade_BasicTraining
        LevelsToGain        = 1
        LevelCap        = 2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality16
        TriggeredBy = Upgrade_LastStandZwerge
    End

    CommandSet = DwarvenAxeThrowerHordeCommandSet_Edain

    Behavior = ObjectCreationUpgrade ModuleTag_MithrilMailPalantirFix
        TriggeredBy  = Upgrade_TechnologyDwarvenMithrilMail
        GrantUpgrade = Upgrade_HeavyArmor
    End

    Behavior = CommandSetUpgrade ModuleTag_MithrilCommandSet
        TriggeredBy       = Upgrade_TechnologyDwarvenMithrilMail
        CommandSet        = DwarvenAxeThrowerHordeCommandSet_Mithril
    End






    Behavior = AISpecialPowerUpdate DwarvenAxeThrowerHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Geometry 		= BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 50.0
    GeometryHeight 	= 20.0
    GeometryIsSmall 	= No



    AutoResolveUnitType = AutoResolveUnit_Archer
    AutoResolveCombatChain = AutoResolve_ArcherCombatChain

    AutoResolveBody = AutoResolve_DwarvenAxeThrowerHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_DwarvenAxeThrowerHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_DwarvenAxeThrowerArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_DwarvenAxeThrowerUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_DwarvenAxeThrowerWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTraining Upgrade_ForgedBlades Upgrade_HeavyArmor
End


Object DwarvenPhalanxHorde

    ButtonImage       = WOR_Phalanx
    SelectPortrait    = UPDwarven_Phalanx

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER EMOTION_TERROR EMOTION_LOOK_TO_SKY SELECTED
        DefaultModelConditionState
            Model = None
        End

        ModelConditionState = HORDE_EMPTY
            Model = None
        End

        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkEUDFG
        End
    End

    Side            = Dwarves
    EditorSorting        = UNIT
    EmotionRange        = 240
    DisplayName        = OBJECT:HordeDwarvenPhalanx
    DisplayNameStrategic     = CONTROLBAR:LW_Unit_DwarvenPhalanxHorde
    DescriptionStrategic     = CONTROLBAR:LW_ToolTip_DwarvenPhalanxHorde

    WeaponSet
        Conditions = None
        Weapon = PRIMARY    TowerGuardHordeRangefinder
    End



    #include "..\..\..\includes\StandardHordeEvaEvents.inc"
    #include "..\..\..\includes\DwarvenRunesUnits.inc"
        UnitSpecificSounds
        VoiceDesperateAttack  = GondorSoldierVoiceDesperateCharge
    End

    BuildCost            = DWARVEN_PHALANX_BUILDCOST
    BuildTime            = MEDIUM_BUILDTIME
    VisionRange            = DWARVEN_PHALANX_HORDE_VISION_RANGE
    ShroudClearingRange         = DWARVEN_PHALANX_SHROUD_RANGE

    VisionSide             = 50%
    VisionRear             = 25%

    MaxVisionBonusPercent         = 300%
    VisionBonusTestRadius         = 200
    VisionBonusPercentPerFoot     = 1.0%
    CommandPoints            = 40

    FormationWidth             = 2
    FormationDepth             = 1

    CrushableLevel            = 0
    CrusherLevel            = 0

    TransportSlotCount = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE MELEE_HORDE NOTIFY_OF_PREATTACK ARMY_SUMMARY PIKE LARGE_RECTANGLE_PATHFIND

    ThreatLevel = DWARVEN_PHALANX_HORDE_THREAT
    ThreatBreakdown DwarvenPhalanxHorde_DetailedThreat
        AIKindOf = PIKEMAN
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = PikeHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle    = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate        = 500
        MaxCowerTime            = 5000
        MinCowerTime            = 3000
        CanAttackWhileContained        = Yes
        AILuaEventsList            = InfantryFunctions
        AttackPriority            = AttackPriority_Infantry
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle             = STANDARD_PIKEMAN_FRONTANGLE
        FlankedDelay             = STANDARD_PIKEMAN_FLANKEDDELAY
        ObjectStatusOfContained        =
        InitialPayload            = DwarvenPhalanx 15
        Slots                = 15
        PassengerFilter            = NONE +INFANTRY
        ShowPips            = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset             = X:0 Y:0

        MeleeBehavior             = Amoeba
        End


        BannerCarriersAllowed    = DwarvenBanner
        BannerCarrierPosition    = UnitType:DwarvenPhalanx    Pos:X:70.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:DwarvenPhalanx Position:X:50 Y:0        Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:50 Y:40        Position:X:50 Y:-40
        RankInfo = RankNumber:2 UnitType:DwarvenPhalanx Position:X:30 Y:0 Leader 1 0    Position:X:30 Y:20 Leader 1 1    Position:X:30 Y:-20 Leader 1 2    Position:X:30 Y:40 Leader 1 3    Position:X:30 Y:-40 Leader 1 4
        RankInfo = RankNumber:3 UnitType:DwarvenPhalanx Position:X:10 Y:0 Leader 2 0    Position:X:10 Y:20 Leader 2 1    Position:X:10 Y:-20 Leader 2 2    Position:X:10 Y:40 Leader 2 3    Position:X:10 Y:-40 Leader 2 4



        RanksToReleaseWhenAttacking        = 1

        MeleeAttackLeashDistance        = 25
        BackUpMinDelayTime            = 1
        BackUpMaxDelayTime            = 3000
        BackUpMinDistance            = 1
        BackUpMaxDistance            = 3
        BackupPercentage            = 80%

        AlternateFormation            = DwarvenPhalanxHordePorcupine
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

    Behavior = CommandButtonHuntUpdate ModuleTag_CommandButtonHuntUpdate
    End

       Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded        =    NONE
        AfraidOf            =    EMOTION_AFRAIDOF_OBJECTFILTER_LANCERS
        AlwaysAfraidOf            =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER_LANCERS
        PointAt                =    EMOTION_POINTAT_OBJECTFILTER_LANCERS
        HeroScanDistance        =    150
        FearScanDistance        =    INFANTRY_FEAR_SCAN_RADIUS

        AddEmotion            =    Terror_Base
        AddEmotion            =    Doom_Base
        AddEmotion            =    UncontrollableFear_Base
        AddEmotion            =    FearIdle_Base
        AddEmotion            =    FearBusy_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
        AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    HeroCheerIdle_Base
        AddEmotion            =    HeroCheerBusy_Base
        AddEmotion            =    Alert_Base
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End

    LocomotorSet
        Locomotor     = NormalChargeMeleeHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_FOOT_SLOW_HORDE_SPEED
    End

    LocomotorSet
        Locomotor     = ScaredMeleeHordeLocomotor
        Condition     = SET_SCARED
        Speed         = NORMAL_FOOT_SLOW_HORDE_SPEED
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy        = Upgrade_BasicTraining
        LevelsToGain        = 1
        LevelCap        = 2
    End

    CommandSet = DwarvenPhalanxHordeCommandSet

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegalityPhalanx
        TriggeredBy = Upgrade_ForgedBlades
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegalityPhalanx2
        TriggeredBy = Upgrade_DwarvenMithrilMail
    End






    Behavior = AISpecialPowerUpdate DwarvenPhalanxHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End


    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 50.0
    GeometryHeight = 20.0
    GeometryIsSmall = No



    AutoResolveUnitType = AutoResolveUnit_Pikemen
    AutoResolveCombatChain = AutoResolve_PikemenCombatChain

    AutoResolveBody = AutoResolve_DwarvenPhalanxHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_DwarvenPhalanxHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_DwarvenPhalanxArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_DwarvenPhalanxUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_DwarvenPhalanxWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTraining Upgrade_ForgedBlades Upgrade_HeavyArmor
End

ChildObject DwarvenPhalanxHordePorcupine DwarvenPhalanxHorde

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle             = STANDARD_PIKEMAN_FRONTANGLE_FORMATION
        FlankedDelay             = STANDARD_PIKEMAN_FLANKEDDELAY
        ObjectStatusOfContained         =
        InitialPayload                = DwarvenPhalanx 12
        Slots                    = 12
        PassengerFilter                = NONE +INFANTRY
        ShowPips                = No
        ThisFormationIsTheMainFormation     = No
        RandomOffset                = X:2 Y:1
        RanksToReleaseWhenAttacking        = 0
        RanksToJustFreeWhenAttacking           = 0
        AttributeModifiers            = DwarvenPhalanxHordePorcupine
        IsPorcupineFormation        = Yes
        MinimumHordeSize            = 5

        AlternateFormation          = DwarvenPhalanxHorde
        VisionRearOverride          = 100%
        VisionSideOverride          = 100%
        NotComboFormation           = Yes

        BannerCarriersAllowed       = DwarvenBanner
        BannerCarrierPosition       = UnitType:DwarvenPhalanx    Pos:X:0.0 Y:0.0

        RankInfo    = RankNumber:1 UnitType:DwarvenPhalanx Position:X:20 Y:0    Position:X:-16.18 Y:11.76        Position:X:6.18 Y:-19.02    Position:X:6.18 Y:19.02    Position:X:-16.18 Y:-11.76    Position:X:36.54 Y:16.27    Position:X:-39.13 Y:8.32    Position:X:26.77 Y:-29.73    Position:X:-4.18 Y:39.78    Position:X:-20 Y:-34.64    Position:X:26.77 Y:29.73    Position:X:-39.13 Y:-8.32    Position:X:36.54 Y:-16.27    Position:X:-20 Y:34.64    Position:X:-4.18 Y:-39.78
    End
End


Object DwarvenMenOfDaleHorde

    SelectPortrait         = UPDaleBow
    ButtonImage            = HSDaleBow

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR
        DefaultModelConditionState
            Model = None
        End
        ModelConditionState = HORDE_EMPTY
            Model = None
        End

        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkRUYeo
        End
    End

    Side = Dwarves
    EditorSorting = UNIT
    EmotionRange = 240
    DisplayName = OBJECT:HordeRohanArcher
    DisplayNameStrategic = CONTROLBAR:LW_Unit_DwarvenMenOfDaleHorde
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_DwarvenMenOfDaleHorde

    WeaponSet
        Conditions = None
        Weapon = PRIMARY    NormalMissileHordeRangefinder
        Weapon = TERTIARY   NormalMissileHordeRangefinderBombard
        AutoChooseSources = TERTIARY FROM_PLAYER FROM_SCRIPT
    End

    CommandSet =  DwarvenMenOfDaleHordeCommandSet




    #include "..\..\..\includes\StandardHordeEvaEvents.inc"
    #include "..\..\..\includes\DwarvenRunesUnits.inc"


     CrushableLevel = 0
    CrusherLevel = 0
    UseCrushAttack = No

    BuildCost = DWARVEN_MENOFDALE_BUILDCOST
    BuildTime = WEAK_BUILDTIME

    VisionRange = 350
    ShroudClearingRange = 400

    VisionSide = 50%
    VisionRear = 25%

    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = 200
    VisionBonusPercentPerFoot = 1.0%

    CommandPoints = 60

    FormationWidth = 2
    FormationDepth = 1

    TransportSlotCount = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE ARCHER ARMY_SUMMARY LARGE_RECTANGLE_PATHFIND

    ThreatLevel = DWARVEN_MENOFDALE_HORDE_THREAT
    ThreatBreakdown DwarvenMenOfDaleHorde_DetailedThreat
        AIKindOf = ARCHER
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    Behavior = SpecialPowerModule ModuleTag_BlackArrowsStarter
        SpecialPowerTemplate        = SpecialAbilityBlackArrows
        UpdateModuleStartsAttack    = Yes
    End
    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_BlackArrowsWeaponFireUpdate
        SpecialPowerTemplate        = SpecialAbilityBlackArrows




        PackTime            = 2000
        StartAbilityRange        = #SUBTRACT( DWARVEN_MENOFDALE_RANGE 100 )
        SpecialWeapon            = DwarvenMenOfDaleBlackArrowsRangeFinder
        ApproachUntilMembersInRange    = Yes
        TriggerSound            = YeomanArcherVoiceAttackCharge
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = ArcherHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle    = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate        = 500
        MaxCowerTime            = 5000
        MinCowerTime            = 3000
        CanAttackWhileContained        = Yes
        AILuaEventsList                = InfantryFunctions
        AttackPriority                = AttackPriority_Archer
    End

    Behavior = HordeContain ModuleTag_HordeContain
        ObjectStatusOfContained =
        InitialPayload     = DwarvenMenOfDale 10
        Slots         = 10
        PassengerFilter = NONE +INFANTRY
        ShowPips     = No
        ThisFormationIsTheMainFormation = Yes
        MeleeBehavior     = Amoeba
        End

        BannerCarriersAllowed    = DwarvenBanner
        BannerCarrierPosition    = UnitType:DwarvenMenOfDale        Pos:X:40.0 Y:0.0


        RandomOffset = X:0 Y:-12

        RankInfo = RankNumber:1 UnitType:DwarvenMenOfDale Position:X:0 Y:12    Position:X:0 Y:-12    Position:X:0 Y:-36    Position:X:0 Y:36    Position:X:0 Y:-60
        RankInfo = RankNumber:2 UnitType:DwarvenMenOfDale Position:X:20 Y:12    Position:X:15 Y:-12    Position:X:20 Y:-36    Position:X:20 Y:36    Position:X:20 Y:-60

        RanksToReleaseWhenAttacking = 1 2

        MeleeAttackLeashDistance = 1
        BackUpMinDelayTime         = 1
        BackUpMaxDelayTime         = 3000
        BackUpMinDistance         = 1
        BackUpMaxDistance         = 3
        BackupPercentage         = 80%
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

     Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded        =    NONE
        AfraidOf            =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf            =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
         PointAt                =    EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance        =    150
        FearScanDistance        =    CAVALRY_FEAR_SCAN_RADIUS

        AddEmotion            =    Terror_Base
        AddEmotion            =    Doom_Base
        AddEmotion            =       BraceForBeingCrushed_Base
        AddEmotion            =    UncontrollableFear_Base
        AddEmotion            =    FearIdle_Base
        AddEmotion            =    FearBusy_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
         AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    HeroCheerIdle_Base
        AddEmotion            =    HeroCheerBusy_Base
        AddEmotion            =    Alert_Base
    End

    LocomotorSet
        Locomotor     = NormalRangedHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_FOOT_FAST_HORDE_SPEED
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTraining
        LevelsToGain = 1
        LevelCap = 2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality
        TriggeredBy = Upgrade_FireArrows
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_DwarvenMithrilMail
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End





    Behavior = AISpecialPowerUpdate DwarvenMenOfDaleHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End


    Behavior = AISpecialPowerUpdate DwarvenMenOfDaleHordeBlackArrowAI
        CommandButtonName = Command_BlackArrows
        SpecialPowerAIType = AI_SPECIAL_POWER_ENEMY_TYPE_KILLER_RANGED
    End

    Geometry = BOX
    GeometryMajorRadius = 20.0
    GeometryMinorRadius = 60.0
    GeometryHeight = 10.0
    GeometryIsSmall = No



    AutoResolveUnitType = AutoResolveUnit_Archer
    AutoResolveCombatChain = AutoResolve_ArcherCombatChain

    AutoResolveBody = AutoResolve_DwarvenMenOfDaleHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_DwarvenMenOfDaleHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_DwarvenMenOfDaleArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_FireArrows
        Weapon = AutoResolve_DwarvenMenOfDaleUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_FireArrows
        Weapon = AutoResolve_DwarvenMenOfDaleWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTraining Upgrade_FireArrows Upgrade_HeavyArmor
End


ChildObject DwarvenMenOfDaleHordeInn DwarvenMenOfDaleHorde
    BuildCost = INN_UNIT_BUILDCOST_DWARVEN
End


ChildObject DwarvenMenOfDaleHordeFree DwarvenMenOfDaleHorde
    BuildCost = 0
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE ARCHER LARGE_RECTANGLE_PATHFIND
End


ChildObject DwarvenMenOfDaleHorde_Summoned DwarvenMenOfDaleHorde
    IsTrainable = No
    CommandPoints = 0
    CommandSet = DwarvenMenOfDaleCommandSet_Summoned
    EquivalentTo = DwarvenMenOfDaleHorde

    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE ARCHER SUMMONED

    Behavior = LifetimeUpdate ModuleTag_LifetimeUpdate

        MinLifetime        = 180000
        MaxLifetime        = 180000
        DeathType        = FADED
    End
    Behavior = HordeContain ModuleTag_HordeContain
        ObjectStatusOfContained =
        InitialPayload = DwarvenMenOfDale_Summoned 10
        Slots = 10
        PassengerFilter = NONE +INFANTRY
        ShowPips = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset = X:1 Y:1


        RankInfo = RankNumber:1 UnitType:DwarvenMenOfDale Position:X:0 Y:0    Position:X:0 Y:25    Position:X:0 Y:-25    Position:X:0 Y:50    Position:X:0 Y:-50
        RankInfo = RankNumber:2 UnitType:DwarvenMenOfDale Position:X:20 Y:0    Position:X:15 Y:25    Position:X:20 Y:-25    Position:X:20 Y:50    Position:X:20 Y:-50

        RanksToReleaseWhenAttacking = 1 2
        MeleeAttackLeashDistance = 25
    End

    GeometryMinorRadius = 40.0
End





ChildObject DwarvenGuardianHorde_Summoned DwarvenGuardianHorde
    IsTrainable    = No
    CommandPoints    = 0

    EquivalentTo    = DwarvenGuardianHorde

    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE MELEE_HORDE SUMMONED

    Behavior = LifetimeUpdate ModuleTag_LifetimeUpdate

        MinLifetime        = DAIN_SUMMON_TIMEOUT
        MaxLifetime        = DAIN_SUMMON_TIMEOUT
        DeathType        = FADED
    End

    Behavior = ExperienceLevelCreate ModuleTag_MPLevelBonus
        LevelToGrant = 5
        MPOnly = No
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained        =
        InitialPayload            = DwarvenGuardian_Summoned 15
        Slots                = 15
        PassengerFilter            = NONE +INFANTRY
        ShowPips            = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset             = X:0 Y:0

        MeleeBehavior = Amoeba
        End

        BannerCarriersAllowed    = DwarvenBanner_Summoned
        BannerCarrierPosition    = UnitType:DwarvenGuardian_Summoned    Pos:X:46.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:DwarvenGuardian_Summoned Position:X:34 Y:0        Position:X:34 Y:15        Position:X:34 Y:-15        Position:X:34 Y:30        Position:X:34 Y:-30
        RankInfo = RankNumber:2 UnitType:DwarvenGuardian_Summoned Position:X:22 Y:0 Leader 1 0    Position:X:22 Y:15 Leader 1 1    Position:X:22 Y:-15 Leader 1 2    Position:X:22 Y:30 Leader 1 3    Position:X:22 Y:-30 Leader 1 4
        RankInfo = RankNumber:3 UnitType:DwarvenGuardian_Summoned Position:X:10 Y:0 Leader 2 0    Position:X:10 Y:15 Leader 2 1    Position:X:10 Y:-15 Leader 2 2    Position:X:10 Y:30 Leader 2 3    Position:X:10 Y:-30 Leader 2 4



        RanksToReleaseWhenAttacking    = 1

        MeleeAttackLeashDistance    = 25
        BackUpMinDelayTime        = 1
        BackUpMaxDelayTime        = 3000
        BackUpMinDistance        = 1
        BackUpMaxDistance        = 3
        BackupPercentage        = 80%
    End
End



ChildObject DwarvenAxeThrowerHorde_Summoned DwarvenAxeThrowerHorde
    IsTrainable    = No
    CommandPoints    = 0
    EquivalentTo    = DwarvenAxeThrowerHorde

    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE ARCHER SUMMONED

    Behavior = LifetimeUpdate ModuleTag_LifetimeUpdate

        MinLifetime        = DAIN_SUMMON_TIMEOUT
        MaxLifetime        = DAIN_SUMMON_TIMEOUT
        DeathType        = FADED
    End

    Behavior = ExperienceLevelCreate ModuleTag_MPLevelBonus
        LevelToGrant = 5
        MPOnly = No
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload = DwarvenAxeThrower_Summoned 15
        Slots = 15
        PassengerFilter = NONE +INFANTRY
        ShowPips = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset=X:0 Y:0


        BannerCarriersAllowed    = DwarvenBanner_Summoned
        BannerCarrierPosition    = UnitType:DwarvenAxeThrower_Summoned        Pos:X:46.0 Y:0.0


        RankInfo = RankNumber:1 UnitType:DwarvenAxeThrower_Summoned  Position:X:34 Y:0        Position:X:34 Y:15        Position:X:34 Y:-15        Position:X:34 Y:30        Position:X:34 Y:-30
        RankInfo = RankNumber:2 UnitType:DwarvenAxeThrower_Summoned  Position:X:22 Y:0 Leader 1 0    Position:X:22 Y:15 Leader 1 1    Position:X:22 Y:-15 Leader 1 2    Position:X:22 Y:30 Leader 1 3    Position:X:22 Y:-30 Leader 1 4
        RankInfo = RankNumber:3 UnitType:DwarvenAxeThrower_Summoned  Position:X:10 Y:0 Leader 2 0    Position:X:10 Y:15 Leader 2 1    Position:X:10 Y:-15 Leader 2 2    Position:X:10 Y:30 Leader 2 3    Position:X:10 Y:-30 Leader 2 4

        RanksToReleaseWhenAttacking = 1 2 3

        MeleeAttackLeashDistance = 25


    End
End

ChildObject DwarvenPhalanxHorde_Summoned DwarvenPhalanxHorde
    IsTrainable    = No
    CommandPoints    = 0

    EquivalentTo    = DwarvenPhalanxHorde

    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE MELEE_HORDE SUMMONED

    Behavior = LifetimeUpdate ModuleTag_LifetimeUpdate

        MinLifetime        = DAIN_SUMMON_TIMEOUT
        MaxLifetime        = DAIN_SUMMON_TIMEOUT
        DeathType        = FADED
    End

    Behavior = ExperienceLevelCreate ModuleTag_MPLevelBonus
        LevelToGrant = 5
        MPOnly = No
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle             = STANDARD_PIKEMAN_FRONTANGLE
        FlankedDelay             = STANDARD_PIKEMAN_FLANKEDDELAY
        ObjectStatusOfContained        =
        InitialPayload            = DwarvenPhalanx_Summoned 15
        Slots                = 15
        PassengerFilter            = NONE +INFANTRY
        ShowPips            = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset             = X:0 Y:0

        MeleeBehavior = Amoeba
        End


        BannerCarriersAllowed    = DwarvenBanner_Summoned
        BannerCarrierPosition    = UnitType:DwarvenPhalanx_Summoned    Pos:X:46.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:DwarvenPhalanx_Summoned Position:X:34 Y:0        Position:X:34 Y:15        Position:X:34 Y:-15        Position:X:34 Y:30        Position:X:34 Y:-30
        RankInfo = RankNumber:2 UnitType:DwarvenPhalanx_Summoned Position:X:22 Y:0 Leader 1 0    Position:X:22 Y:15 Leader 1 1    Position:X:22 Y:-15 Leader 1 2    Position:X:22 Y:30 Leader 1 3    Position:X:22 Y:-30 Leader 1 4
        RankInfo = RankNumber:3 UnitType:DwarvenPhalanx_Summoned Position:X:10 Y:0 Leader 2 0    Position:X:10 Y:15 Leader 2 1    Position:X:10 Y:-15 Leader 2 2    Position:X:10 Y:30 Leader 2 3    Position:X:10 Y:-30 Leader 2 4




        RanksToReleaseWhenAttacking    = 1

        MeleeAttackLeashDistance    = 25
        BackUpMinDelayTime        = 1
        BackUpMaxDelayTime        = 3000
        BackUpMinDistance        = 1
        BackUpMaxDistance        = 3
        BackupPercentage        = 80%

        AlternateFormation        = DwarvenPhalanxHordePorcupine_Summoned
    End
End

ChildObject DwarvenPhalanxHordePorcupine_Summoned DwarvenPhalanxHorde_Summoned
    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle             = STANDARD_PIKEMAN_FRONTANGLE_FORMATION
        FlankedDelay             = STANDARD_PIKEMAN_FLANKEDDELAY
        ObjectStatusOfContained        =
        InitialPayload            = DwarvenPhalanx_Summoned 15
        Slots                = 15
        PassengerFilter            = NONE +INFANTRY
        ShowPips            = No
        ThisFormationIsTheMainFormation = No
        RandomOffset             = X:0 Y:0

        MeleeBehavior = Amoeba
        End


        BannerCarriersAllowed    = DwarvenBanner_Summoned
        BannerCarrierPosition    = UnitType:DwarvenPhalanx_Summoned    Pos:X:0.0 Y:0.0

        RankInfo    = RankNumber:1 UnitType:DwarvenPhalanx_Summoned Position:X:20 Y:0    Position:X:-16.18 Y:11.76        Position:X:6.18 Y:-19.02    Position:X:6.18 Y:19.02    Position:X:-16.18 Y:-11.76    Position:X:36.54 Y:16.27    Position:X:-39.13 Y:8.32    Position:X:26.77 Y:-29.73    Position:X:-4.18 Y:39.78    Position:X:-20 Y:-34.64    Position:X:26.77 Y:29.73    Position:X:-39.13 Y:-8.32    Position:X:36.54 Y:-16.27    Position:X:-20 Y:34.64    Position:X:-4.18 Y:-39.78


        RanksToReleaseWhenAttacking        = 1

        MeleeAttackLeashDistance        = 25
        BackUpMinDelayTime            = 1
        BackUpMaxDelayTime            = 3000
        BackUpMinDistance            = 1
        BackUpMaxDistance            = 3
        BackupPercentage            = 80%

        IsPorcupineFormation            = Yes
        AlternateFormation            = DwarvenPhalanxHorde_Summoned
        AttributeModifiers            = DwarvenPhalanxHordePorcupine
        VisionRearOverride            = 100%
        VisionSideOverride            = 100%
        MinimumHordeSize            = 5
        NotComboFormation            = Yes
    End
End


Object DwarvenZerkerHorde


    ButtonImage        = WOR_DwarvenZerker
    SelectPortrait    = UPDwarvenZerkerPortrait

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER EMOTION_TERROR EMOTION_LOOK_TO_SKY SELECTED
        DefaultModelConditionState
            Model = None
        End

        ModelConditionState = HORDE_EMPTY
            Model = None
        End

        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkEUDFG
        End
    End

    Side = Dwarves
    EditorSorting = UNIT
    EmotionRange = 240
    DisplayName = OBJECT:HordeDwarvenZerker
    DisplayNameStrategic = CONTROLBAR:LW_Unit_DwarvenZerkerHorde
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_DwarvenZerkerHorde

    WeaponSet
        Conditions = None
        Weapon = PRIMARY    NormalMeleeHordeRangefinder
        Weapon            = TERTIARY    DwarvenZealotBoomAxeRangeFinder
        AutoChooseSources    = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
        AutoChooseSources    = TERTIARY FROM_PLAYER FROM_SCRIPT
        ShareWeaponReloadTime    = Yes
    End




    #include "..\..\..\includes\StandardHordeEvaEvents.inc"
    #include "..\..\..\includes\DwarvenRunesUnits.inc"

    UnitSpecificSounds
        VoiceDesperateAttack  = GondorSoldierVoiceDesperateCharge
    End

    BuildCost = DWARVEN_ZERKER_BUILDCOST
    BuildTime = STRONG_BUILDTIME
    VisionRange = DWARVEN_ZERKER_HORDE_VISION_RANGE
    ShroudClearingRange = DWARVEN_ZERKER_SHROUD_RANGE
    VisionSide = 50%
    VisionRear = 25%

    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = 200
    VisionBonusPercentPerFoot = 1.0%
    MaxSimultaneousOfType        = 1
    CommandPoints = 50

    FormationWidth = 1
    FormationDepth = 1

    CrushableLevel = 1

    TransportSlotCount = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE MELEE_HORDE NOTIFY_OF_PREATTACK LARGE_RECTANGLE_PATHFIND ARMY_SUMMARY

    ThreatLevel = DWARVEN_GUARDIAN_HORDE_THREAT
    ThreatBreakdown DwarvenGuardianHorde_DetailedThreat
        AIKindOf = INFANTRY
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = FighterHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle        = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate            = 500
        MaxCowerTime                = 5000
        MinCowerTime                = 3000

        CanAttackWhileContained            = Yes
        AILuaEventsList                = InfantryFunctions
        AttackPriority                = AttackPriority_Infantry
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained            =
        InitialPayload                = DwarvenZerker 4
        Slots                    = 4
        PassengerFilter                = NONE +INFANTRY
        ShowPips                = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset = X:0 Y:0

        MeleeBehavior = Amoeba
        End


        RankInfo = RankNumber:1 UnitType:DwarvenZerker Position:X:0 Y:10        Position:X:0 Y:-10        Position:X:0 Y:-30        Position:X:0 Y:30

        RanksToReleaseWhenAttacking        = 1

        MeleeAttackLeashDistance        = 50
        BackUpMinDelayTime            = 1
        BackUpMaxDelayTime            = 3000
        BackUpMinDistance            = 1
        BackUpMaxDistance            = 3
        BackupPercentage            = 80%
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

    Behavior = CommandButtonHuntUpdate ModuleTag_CommandButtonHuntUpdate
    End

    Behavior = HordeNotifyTargetsOfImminentProbableCrushingUpdate ModuleTag_NotifyCrushScan
        ScanWidth = 60.0
    End

       Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded        =    NONE
         AfraidOf            =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf            =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
         PointAt                =    EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance        =    150
        FearScanDistance        =    INFANTRY_FEAR_SCAN_RADIUS

        AddEmotion            =    Terror_Base
        AddEmotion            =    Doom_Base
        AddEmotion            =       BraceForBeingCrushed_Base
        AddEmotion            =    UncontrollableFear_Base
        AddEmotion            =    FearIdle_Base
        AddEmotion            =    FearBusy_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
         AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    HeroCheerIdle_Base
        AddEmotion            =    HeroCheerBusy_Base
        AddEmotion            =    Alert_Base
        AddEmotion            =       CheerForAboutToCrush_Base
    End

    LocomotorSet
        Locomotor     = NormalChargeMeleeHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_FOOT_FAST_HORDE_SPEED
    End

    LocomotorSet
        Locomotor     = ScaredMeleeHordeLocomotor
        Condition     = SET_SCARED
        Speed         = NORMAL_FOOT_FAST_HORDE_SPEED
    End


    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End


    CommandSet = DwarvenZerkerHordeCommandSet



    Behavior = AutoHealBehavior ModuleTag_HearthHeal
        StartsActive            = No
        HealOnlyIfNotInCombat         = Yes
        HealOnlyIfNotUnderAttack    = Yes
        TriggeredBy            = Upgrade_MiniHordeLvl2
        HealingAmount            = 30
        Radius                = 100
        StartHealingDelay         = 7500
        HealingDelay            = 5000
        UnitHealPulseFX            = FX_SpellHealUnitHealBuff
        NonStackable            = Yes
        RespawnNearbyHordeMembers     = Yes
        RespawnFXList            = FX_BannerCarrierSpawnUnit
        RespawnMinimumDelay        = 200
    End


	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_DefenderEnabler
        SpecialPowerTemplate       = SpecialAbilityStaunchDefender
        TriggeredBy                = Upgrade_MiniHordeLvl10
    End

    Behavior = SpecialPowerModule ModuleTag_DefenderStarter
        SpecialPowerTemplate       = SpecialAbilityStaunchDefender
        UpdateModuleStartsAttack   = Yes
        StartsPaused               = Yes
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_DefenderWeaponFireUpdate
        SpecialPowerTemplate       = SpecialAbilityStaunchDefender
        WhichSpecialWeapon         = 1
        SkipContinue               = Yes
        UnpackTime                 = 0
        PackTime                   = 1
        FreezeAfterTriggerDuration = 0
        AwardXPForTriggering       = 0
        StartAbilityRange          = 100.0
        SpecialWeapon              = ZerkerBlessingWeapon
    End


    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_KnifeEnabler
        SpecialPowerTemplate = SpecialAbilityGimliHeroMode
        TriggeredBy = Upgrade_MiniHordeLvl7
    End

    Behavior = WeaponModeSpecialPowerUpdate ModuleTag_KnifeFighterPowerUpdate
        SpecialPowerTemplate    = SpecialAbilityGimliHeroMode
        Duration                = 30000
        AttributeModifier        = ZerkerSlayer

        WeaponSetFlags            = WEAPONSET_TOGGLE_1
        StartsPaused            = Yes

    End


    Behavior = SpecialPowerModule ModuleTag_ZealotBoomAxeStarter
        SpecialPowerTemplate        = SpecialAbilityZealotBoomAxe
        UpdateModuleStartsAttack    = Yes
    End
    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_ZealotBoomAxeWeaponFireUpdate
        SpecialPowerTemplate        = SpecialAbilityZealotBoomAxe
        WhichSpecialWeapon        = 1
        PackTime            = 2500
        StartAbilityRange        = 200
        SpecialWeapon            = DwarvenZealotBoomAxeRangeFinder
        ApproachUntilMembersInRange    = Yes
        TriggerSound            = DwarfZerkVoiceLeap
    End
	Behavior = AutoAbilityBehavior ModuleTag_AutoAbilityZealotBoomAxe
        SpecialAbility          = SpecialAbilityZealotBoomAxe
        MaxScanRange            = 150
        Query                   = 15 ANY ENEMIES +INFANTRY
		Query					= 1 ANY ENEMIES +HERO
    End




    Behavior = AISpecialPowerUpdate DwarvenGuardianHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End
    Behavior = AISpecialPowerUpdate GimliLeapAttackAI
        CommandButtonName = Command_RohanGimliLeap
        SpecialPowerAIType = AI_SPECIAL_POWER_RANGED_AOE_ATTACK
        SpecialPowerRadius = 100
    End


    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 20.0
    GeometryHeight = 20.0
    GeometryIsSmall = No



    AutoResolveUnitType = AutoResolveUnit_Soldier
    AutoResolveCombatChain = AutoResolve_SoldierCombatChain

    AutoResolveBody = AutoResolve_DwarvenGuardianHordeBody

End


Object DwarvenRunenmeisterHorde



    SelectPortrait     = UPRunenmeister
    ButtonImage        = HSRunenmeister

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER EMOTION_TERROR EMOTION_LOOK_TO_SKY SELECTED
        DefaultModelConditionState
            Model = None
        End

        ModelConditionState = HORDE_EMPTY
            Model = None
        End

        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkEUDFG
        End
    End

    Side = Dwarves
    EditorSorting = UNIT
    EmotionRange = 240
    DisplayName = OBJECT:DwarvenRunenmeisterHorde
    DisplayNameStrategic = CONTROLBAR:LW_Unit_DwarvenRunenmeisterHorde
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_DwarvenRunenmeisterHorde

    WeaponSet
        Conditions = None
        Weapon = PRIMARY    NormalMeleeHordeRangefinder
    End




    #include "..\..\..\includes\StandardHordeEvaEvents.inc"
    #include "..\..\..\includes\DwarvenRunesUnits.inc"

    UnitSpecificSounds
        VoiceDesperateAttack  = GondorSoldierVoiceDesperateCharge
    End

    BuildCost = 600
    BuildTime = MEDIUM_BUILDTIME
    VisionRange = DWARVEN_GUARDIAN_HORDE_VISION_RANGE
    ShroudClearingRange = DWARVEN_GUARDIAN_SHROUD_RANGE
    VisionSide = 50%
    VisionRear = 25%

    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = 200
    VisionBonusPercentPerFoot = 1.0%
    CommandPoints = 30

    FormationWidth = 2
    FormationDepth = 1

    CrushableLevel = 0
    CrusherLevel = 0

    TransportSlotCount = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE MELEE_HORDE NOTIFY_OF_PREATTACK ARMY_SUMMARY LARGE_RECTANGLE_PATHFIND

    ThreatLevel = DWARVEN_GUARDIAN_HORDE_THREAT
    ThreatBreakdown DwarvenGuardianHorde_DetailedThreat
        AIKindOf = INFANTRY
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = FighterHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle        = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate            = 500
        MaxCowerTime                = 5000
        MinCowerTime                = 3000

        CanAttackWhileContained            = Yes
        AILuaEventsList                = InfantryFunctions
        AttackPriority                = AttackPriority_Infantry
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained            =
        InitialPayload                = DwarvenRunenmeister 5
        Slots                    = 5
        PassengerFilter                = NONE +INFANTRY
        ShowPips                = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset = X:0 Y:0

        MeleeBehavior = Amoeba
        End


        BannerCarriersAllowed    = DwarvenBanner
        BannerCarrierPosition    = UnitType:DwarvenRunenmeister    Pos:X:70.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:DwarvenRunenmeister Position:X:50 Y:0        Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:50 Y:40        Position:X:50 Y:-40



        RanksToReleaseWhenAttacking        = 1

        MeleeAttackLeashDistance        = 25
        BackUpMinDelayTime            = 1
        BackUpMaxDelayTime            = 3000
        BackUpMinDistance            = 1
        BackUpMaxDistance            = 3
        BackupPercentage            = 80%
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

    Behavior = CommandButtonHuntUpdate ModuleTag_CommandButtonHuntUpdate
    End

    Behavior = HordeNotifyTargetsOfImminentProbableCrushingUpdate ModuleTag_NotifyCrushScan
        ScanWidth = 60.0
    End

       Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded        =    NONE
         AfraidOf            =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf            =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
         PointAt                =    EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance        =    150
        FearScanDistance        =    INFANTRY_FEAR_SCAN_RADIUS

        AddEmotion            =    Terror_Base
        AddEmotion            =    Doom_Base
        AddEmotion            =       BraceForBeingCrushed_Base
        AddEmotion            =    UncontrollableFear_Base
        AddEmotion            =    FearIdle_Base
        AddEmotion            =    FearBusy_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
         AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    HeroCheerIdle_Base
        AddEmotion            =    HeroCheerBusy_Base
        AddEmotion            =    Alert_Base
        AddEmotion            =       CheerForAboutToCrush_Base
    End

    LocomotorSet
        Locomotor     = NormalChargeMeleeHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = 35
    End

    LocomotorSet
        Locomotor     = ScaredMeleeHordeLocomotor
        Condition     = SET_SCARED
        Speed         = 35
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTraining
        LevelsToGain = 1
        LevelCap = 2
    End


    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End







    Behavior = SpecialPowerModule ModuleTag_UnantastbarkeitStarter
        SpecialPowerTemplate       = SpecialAbilityZwergenRuneUnantastbarkeit
        StartsPaused               = No
        UpdateModuleStartsAttack   = Yes
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_UnantastbarkeitBlastWeaponFireUpdate
        SpecialPowerTemplate       = SpecialAbilityZwergenRuneUnantastbarkeit
        WhichSpecialWeapon         = 1
        SkipContinue               = Yes
        FreezeAfterTriggerDuration = 100
        UnpackTime                 = 700
        PreparationTime            = 1

        PackTime                   = 100
        AwardXPForTriggering       = 0
        StartAbilityRange          = 80
        SpecialWeapon              = ZwergenruneUnantastbarkeit

    End





    Behavior = SpecialPowerModule ModuleTag_InspirationStarter
        SpecialPowerTemplate       = SpecialAbilityZwergenRuneInspiration
        StartsPaused               = No
        UpdateModuleStartsAttack   = Yes
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_InspirationBlastWeaponFireUpdate
        SpecialPowerTemplate       = SpecialAbilityZwergenRuneInspiration
        WhichSpecialWeapon         = 1
        SkipContinue               = Yes
        FreezeAfterTriggerDuration = 100
        UnpackTime                 = 700
        PreparationTime            = 1

        PackTime                   = 100
        AwardXPForTriggering       = 0
        StartAbilityRange          = 80
        SpecialWeapon              = ZwergenruneInspiration

    End





    Behavior = SpecialPowerModule ModuleTag_KraftStarter
        SpecialPowerTemplate       = SpecialAbilityZwergenRuneKraft
        StartsPaused               = No
        UpdateModuleStartsAttack   = Yes
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_KraftBlastWeaponFireUpdate
        SpecialPowerTemplate       = SpecialAbilityZwergenRuneKraft
        WhichSpecialWeapon         = 1
        SkipContinue               = Yes
        FreezeAfterTriggerDuration = 100
        UnpackTime                 = 700
        PreparationTime            = 1

        PackTime                   = 100
        AwardXPForTriggering       = 0
        StartAbilityRange          = 80
        SpecialWeapon              = ZwergenruneKraft

    End





    Behavior = SpecialPowerModule ModuleTag_ProduktivitatStarter
        SpecialPowerTemplate       = SpecialAbilityZwergenRuneProduktivitat
        StartsPaused               = No
        UpdateModuleStartsAttack   = Yes
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_ProduktivitatBlastWeaponFireUpdate
        SpecialPowerTemplate       = SpecialAbilityZwergenRuneProduktivitat
        WhichSpecialWeapon         = 1
        SkipContinue               = Yes
        FreezeAfterTriggerDuration = 100
        UnpackTime                 = 700
        PreparationTime            = 1

        PackTime                   = 100
        AwardXPForTriggering       = 0
        StartAbilityRange          = 80
        SpecialWeapon              = ZwergenruneProduktivitat

    End





    Behavior = SpecialPowerModule ModuleTag_SchreckenStarter
        SpecialPowerTemplate       = SpecialAbilityZwergenRuneSchrecken
        StartsPaused               = No
        UpdateModuleStartsAttack   = Yes
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_SchreckenBlastWeaponFireUpdate
        SpecialPowerTemplate       = SpecialAbilityZwergenRuneSchrecken
        WhichSpecialWeapon         = 1
        SkipContinue               = Yes
        FreezeAfterTriggerDuration = 100
        UnpackTime                 = 700
        PreparationTime            = 1

        PackTime                   = 100
        AwardXPForTriggering       = 0
        StartAbilityRange          = 80
        SpecialWeapon              = ZwergenruneSchrecken

    End



    CommandSet = RunenmeisterHordeCommandSet





    Behavior = AISpecialPowerUpdate DwarvenGuardianHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Behavior = AISpecialPowerUpdate DwarfGuardianCharge
        CommandButtonName = Command_DwarvenGuardianChargeAttack
        SpecialPowerAIType = AI_SPECIAL_POWER_CHARGE
    End


    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 50.0
    GeometryHeight = 20.0
    GeometryIsSmall = No



    AutoResolveUnitType = AutoResolveUnit_Soldier
    AutoResolveCombatChain = AutoResolve_SoldierCombatChain

    AutoResolveBody = AutoResolve_DwarvenGuardianHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_DwarvenGuardianHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_DwarvenGuardianArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_DwarvenGuardianUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_DwarvenGuardianWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTraining Upgrade_ForgedBlades Upgrade_HeavyArmor
End


Object DwarvenBowHorde

    ButtonImage       = UPEredLuinBow
    SelectPortrait    = UPEredLuinBow

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER EMOTION_TERROR EMOTION_LOOK_TO_SKY SELECTED
        DefaultModelConditionState
            Model = None
        End

        ModelConditionState = HORDE_EMPTY
            Model = None
        End

        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkEUDfA
        End
    End

    Side            = Dwarves
    EditorSorting        = UNIT
    EmotionRange        = 240
    DisplayName        = OBJECT:HordeDwarvenBow
    DisplayNameStrategic     = CONTROLBAR:LW_Unit_DwarvenBowHorde
    DescriptionStrategic     = CONTROLBAR:LW_ToolTip_DwarvenAxeThrowerHorde

    WeaponSet
        Conditions    = None
        Weapon = PRIMARY    NormalMissileHordeRangefinder
        Weapon = TERTIARY   NormalMissileHordeRangefinderBombard
        AutoChooseSources = TERTIARY FROM_PLAYER FROM_SCRIPT
    End



    #include "..\..\..\includes\StandardHordeEvaEvents.inc"
    #include "..\..\..\includes\DwarvenRunesUnits.inc"

    UnitSpecificSounds
        VoiceDesperateAttack  = GondorSoldierVoiceDesperateCharge
    End

    BuildCost        = 300
    BuildTime        = MEDIUM_BUILDTIME


    ShroudClearingRange  = 350
    VisionRange          = 300
    VisionSide           = 50%
    VisionRear           = 25%

    MaxVisionBonusPercent     = 300%
    VisionBonusTestRadius     = 200
    VisionBonusPercentPerFoot = 1.0%

    CommandPoints        = 50

    FormationWidth       = 2
    FormationDepth       = 1

    CrushableLevel       = 0
    CrusherLevel         = 0
    CrushZFactor         = 1.0
    UseCrushAttack       = No

    TransportSlotCount = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE MELEE_HORDE NOTIFY_OF_PREATTACK ARMY_SUMMARY LARGE_RECTANGLE_PATHFIND ARCHER

    ThreatLevel = DWARVEN_AXETHROWER_HORDE_THREAT
    ThreatBreakdown DwarvenAxeThrowerHorde_DetailedThreat
        AIKindOf = ARCHER
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = ArcherHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle    = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate        = 500
        MaxCowerTime            = 5000
        MinCowerTime            = 3000
        CanAttackWhileContained        = Yes
        AILuaEventsList            = InfantryFunctions
        AttackPriority            = AttackPriority_Infantry
    End

    Behavior                 = HordeContain ModuleTag_HordeContain
        FrontAngle = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained     =
        InitialPayload             = DwarvenBow 10
        Slots                 = 10
        PassengerFilter         = NONE +INFANTRY
        ShowPips             = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset            = X:0 Y:0
        MeleeBehavior             = Amoeba
        End

        BannerCarriersAllowed    = DwarvenBreitschulternBanner

        BannerCarrierPosition    = UnitType:DwarvenBow   Pos:X:70.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:DwarvenBow Position:x:50 Y:0            Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:50 Y:40        Position:X:50 Y:-40
        RankInfo = RankNumber:2 UnitType:DwarvenBow Position:X:30 Y:0 Leader 1 0    Position:X:30 Y:20 Leader 1 1    Position:X:30 Y:-20 Leader 1 2    Position:X:30 Y:40 Leader 1 3    Position:X:30 Y:-40 Leader 1 4

        RanksToReleaseWhenAttacking = 1 2

        MeleeAttackLeashDistance     = 1
        BackUpMinDelayTime        = 1
        BackUpMaxDelayTime        = 3000
        BackUpMinDistance        = 1
        BackUpMaxDistance        = 3
        BackupPercentage        = 80%
    End



    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

    Behavior = CommandButtonHuntUpdate ModuleTag_CommandButtonHuntUpdate
    End

       Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded        =    NONE
        AfraidOf            =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf            =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
        PointAt                =    EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance        =    150
        FearScanDistance        =    INFANTRY_FEAR_SCAN_RADIUS

        AddEmotion            =    Terror_Base
        AddEmotion            =    Doom_Base
        AddEmotion            =       BraceForBeingCrushed_Base
        AddEmotion            =    UncontrollableFear_Base
        AddEmotion            =    FearIdle_Base
        AddEmotion            =    FearBusy_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
         AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    HeroCheerIdle_Base
        AddEmotion            =    HeroCheerBusy_Base
        AddEmotion            =    Alert_Base
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End

    LocomotorSet
        Locomotor     = NormalChargeMeleeHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_FOOT_SLOW_HORDE_SPEED_EREDLUIN
    End

    LocomotorSet
        Locomotor     = ScaredMeleeHordeLocomotor
        Condition     = SET_SCARED
        Speed         = NORMAL_FOOT_SLOW_HORDE_SPEED_EREDLUIN
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP      = Yes
    End










 

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality
        TriggeredBy   = Upgrade_FireArrows
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy   = Upgrade_DwarvenMithrilMail
    End

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy   = Upgrade_BasicTraining
        LevelsToGain  = 1
        LevelCap      = 2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality16
        TriggeredBy = Upgrade_LastStandZwerge
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality17
        TriggeredBy        = Upgrade_HeavyArmor
    End

    CommandSet = DwarvenBowFeuerbarteCommandSet

    Behavior = ObjectCreationUpgrade ModuleTag_MithrilMailPalantirFix
        TriggeredBy  = Upgrade_TechnologyDwarvenMithrilMail
        GrantUpgrade = Upgrade_HeavyArmor
    End

    Behavior = CommandSetUpgrade ModuleTag_MithrilCommandSet
        TriggeredBy       = Upgrade_TechnologyDwarvenMithrilMail
        CommandSet        = DwarvenBowFeuerbarteCommandSet_Mithril
    End






    Behavior = AISpecialPowerUpdate DwarvenAxeThrowerHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End


    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 50.0
    GeometryHeight = 20.0
    GeometryIsSmall = No



    AutoResolveUnitType = AutoResolveUnit_Archer
    AutoResolveCombatChain = AutoResolve_ArcherCombatChain

    AutoResolveBody = AutoResolve_DwarvenAxeThrowerHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_DwarvenMithrilMail
        Armor = AutoResolve_DwarvenAxeThrowerHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_DwarvenMithrilMail
        Armor = AutoResolve_DwarvenAxeThrowerArmor
    End


    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTraining Upgrade_HeavyArmor
End


Object DwarvenCrossbowIronHillsHorde

    ButtonImage            = UIIronHillsCrossbow
    SelectPortrait         = UPIronHillsCrossbow

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR EMOTION_LOOK_TO_SKY
        DefaultModelConditionState
            Model = None
        End
        ModelConditionState = HORDE_EMPTY
            Model = None
        End
        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkIUArc
        End
    End

    Side = Dwarves
    EditorSorting = UNIT
    EmotionRange = 240
    DisplayName = OBJECT:DwarvenCrossbowHorde
    DisplayNameStrategic = CONTROLBAR:LW_Unit_DwarvenCrossbowHorde
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_DwarvenAxeThrowerHorde

    WeaponSet
        Conditions = None
        Weapon     = PRIMARY    DwarvenCrossbowMissileHordeRangefinder
    End

    BuildCost        = 320
    BuildTime        = MEDIUM_BUILDTIME

    VisionRange = 375
    ShroudClearingRange     = 375

    VisionSide = 50%
    VisionRear = 25%

    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = 200
    VisionBonusPercentPerFoot = 1.0%
    CommandPoints    = 50

    CommandSet = DwarvenCrossbowHordeCommandSet

    FormationWidth = 2
    FormationDepth = 2

    TransportSlotCount = TRANSPORTSLOTCOUNT_LARGE_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY ARCHER HORDE CAN_USE_SIEGE_TOWER ARMY_SUMMARY LARGE_RECTANGLE_PATHFIND ARCHER

    ThreatLevel = DWARVEN_AXETHROWER_HORDE_THREAT
    ThreatBreakdown DwarvenAxeThrowerHorde_DetailedThreat
        AIKindOf = ARCHER
    End

    #include "..\..\..\includes\StandardHordeEvaEvents.inc"
    #include "..\..\..\includes\DwarvenRunesUnits.inc"

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = ArcherHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate        = 500
        MaxCowerTime               = 5000
        MinCowerTime               = 3000
        CanAttackWhileContained    = Yes
        AILuaEventsList            = ArcherFunctions
        AttackPriority             = AttackPriority_Infantry
    End


    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload = DwarvenCrossbowIronHills 10
        Slots = 10
        PassengerFilter = NONE +INFANTRY
        ShowPips = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset = X:0 Y:0

        MeleeBehavior = Amoeba
        End


        BannerCarriersAllowed    = DwarvenIronHillsBanner
        BannerCarrierPosition    = UnitType:DwarvenCrossbowIronHills        Pos:X:70.0 Y:0.0


        RankInfo = RankNumber:1 UnitType:DwarvenCrossbowIronHills  Position:X:50 Y:0        Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:50 Y:40        Position:X:50 Y:-40
        RankInfo = RankNumber:2 UnitType:DwarvenCrossbowIronHills  Position:X:30 Y:0 Leader 1 0    Position:X:30 Y:20 Leader 1 1    Position:X:30 Y:-20 Leader 1 2    Position:X:30 Y:40 Leader 1 3    Position:X:30 Y:-40 Leader 1 4

        RanksToReleaseWhenAttacking = 1 2

        MeleeAttackLeashDistance = 25
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

       Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded        =    NONE
        AfraidOf            =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf            =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
        PointAt                =    EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance        =    150
        FearScanDistance        =    INFANTRY_FEAR_SCAN_RADIUS

        AddEmotion    =    Terror_Base
        AddEmotion    =    Doom_Base
        AddEmotion    =   BraceForBeingCrushed_Base
        AddEmotion    =    UncontrollableFear_Base_Evil
        AddEmotion    =    FearIdle_Base
        AddEmotion    =    FearBusy_Base
        AddEmotion    =    Point_Base
        AddEmotion    =    Taunt_Base
        AddEmotion    =    CheerIdle_Base
        AddEmotion    =    CheerBusy_Base
        AddEmotion    =    HeroCheerIdle_Base
        AddEmotion    =    HeroCheerBusy_Base
        AddEmotion    =    Alert_Base
    End

    LocomotorSet
        Locomotor     = NormalChargeMeleeHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_FOOT_SLOW_HORDE_SPEED_IRONHILLS
    End

    LocomotorSet
        Locomotor     = ScaredMeleeHordeLocomotor
        Condition     = SET_SCARED
        Speed         = NORMAL_FOOT_SLOW_HORDE_SPEED_IRONHILLS
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTraining
        LevelsToGain = 1
        LevelCap = 2
    End

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_VerraterEnabler
        SpecialPowerTemplate         = SpecialAbilityGandalfGeprufte
        TriggeredBy                  = Upgrade_TestBuilding
    End

    Behavior = SpecialPowerModule ModuleTag_VerraterStarter
         SpecialPowerTemplate        = SpecialAbilityGandalfGeprufte
         UpdateModuleStartsAttack    = Yes
         StartsPaused                = Yes
    End

    Behavior = ToggleMountedSpecialAbilityUpdate ModuleTag_VerraterToggle
         SpecialPowerTemplate       = SpecialAbilityGandalfGeprufte
         MountedTemplate            = DwarvenCrossbowHorde
         UnpackTime                 = 1000
         PreparationTime            = 0
         PackTime                   = 0
         OpacityTarget              = .0
         AwardXPForTriggering       = 0
         IgnoreFacingCheck          = Yes
    End

    Behavior = DoCommandUpgrade Module_DoCommandUpgrade
        TriggeredBy                 = Upgrade_TestBuilding
        GetUpgradeCommandButtonName = Command_SpecialAbilityGandalfGeprufte
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality
        TriggeredBy = Upgrade_FireArrows
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_DwarvenMithrilMail
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality17
        TriggeredBy        = Upgrade_HeavyArmor
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality16
        TriggeredBy = Upgrade_LastStandZwerge
    End

    Behavior = ObjectCreationUpgrade ModuleTag_MithrilMailPalantirFix
        TriggeredBy  = Upgrade_TechnologyDwarvenMithrilMail
        GrantUpgrade = Upgrade_HeavyArmor
    End

    Behavior = CommandSetUpgrade ModuleTag_MithrilCommandSet
        TriggeredBy       = Upgrade_TechnologyDwarvenMithrilMail
        CommandSet        = DwarvenCrossbowHordeCommandSet_Mithril
    End

    #include "..\..\..\includes\CaptureBuilding.inc"





    Behavior = AISpecialPowerUpdate IsengardUrukCrossbowHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 45.0
    GeometryHeight = 20.0
    GeometryIsSmall = No



    AutoResolveUnitType = AutoResolveUnit_Archer
    AutoResolveCombatChain = AutoResolve_ArcherCombatChain

    AutoResolveBody = AutoResolve_IsengardUrukCrossbowHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_IsengardUrukCrossbowHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_IsengardUrukCrossbowArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_FireArrows
        Weapon = AutoResolve_IsengardUrukCrossbowUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_FireArrows
        Weapon = AutoResolve_IsengardUrukCrossbowWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTraining Upgrade_FireArrows Upgrade_HeavyArmor
End


Object DwarvenCrossbowHorde

    ButtonImage            = HSDwarvCrossbow
    SelectPortrait         = UPDwarvCrossbow

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR EMOTION_LOOK_TO_SKY
        DefaultModelConditionState
            Model = None
        End
        ModelConditionState = HORDE_EMPTY
            Model = None
        End
        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkIUArc
        End
    End

    Side = Dwarves
    EditorSorting = UNIT
    EmotionRange = 240
    DisplayName = OBJECT:DwarvenCrossbowHorde
    DisplayNameStrategic = CONTROLBAR:LW_Unit_DwarvenCrossbowHorde
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_DwarvenCrossbowHorde

    WeaponSet
        Conditions = None
        Weapon = PRIMARY    DwarvenMissileHordeRangefinder
        Weapon = TERTIARY   DwarvenMissileHordeRangefinderBombard
        AutoChooseSources = TERTIARY FROM_PLAYER FROM_SCRIPT
    End

    BuildCost        = 300
    BuildTime        = MEDIUM_BUILDTIME

    VisionRange = 250
    ShroudClearingRange     = 300

    VisionSide = 50%
    VisionRear = 25%

    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = 200
    VisionBonusPercentPerFoot = 1.0%
    CommandPoints    = 40


    CommandSet = DwarvenKhazadCrossbowHordeCommandSet_Mithril

    FormationWidth = 2
    FormationDepth = 2

    TransportSlotCount = TRANSPORTSLOTCOUNT_LARGE_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY ARCHER HORDE CAN_USE_SIEGE_TOWER ARMY_SUMMARY LARGE_RECTANGLE_PATHFIND ARCHER

    ThreatLevel = DWARVEN_AXETHROWER_HORDE_THREAT
    ThreatBreakdown DwarvenAxeThrowerHorde_DetailedThreat
        AIKindOf = ARCHER
    End

    #include "..\..\..\includes\StandardHordeEvaEvents.inc"
    #include "..\..\..\includes\DwarvenRunesUnits.inc"

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = ArcherHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate        = 500
        MaxCowerTime               = 5000
        MinCowerTime               = 3000
        CanAttackWhileContained    = Yes
        AILuaEventsList            = ArcherFunctions
        AttackPriority             = AttackPriority_Infantry
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload = DwarvenCrossbow 10
        Slots = 10
        PassengerFilter = NONE +INFANTRY
        ShowPips = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset = X:0 Y:0

        MeleeBehavior = Amoeba
        End

        BannerCarriersAllowed    = DwarvenIronHillsBanner
        BannerCarrierPosition    = UnitType:DwarvenCrossbow        Pos:X:70.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:DwarvenCrossbow  Position:X:50 Y:0        Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:50 Y:40        Position:X:50 Y:-40
        RankInfo = RankNumber:2 UnitType:DwarvenCrossbow  Position:X:30 Y:0 Leader 1 0    Position:X:30 Y:20 Leader 1 1    Position:X:30 Y:-20 Leader 1 2    Position:X:30 Y:40 Leader 1 3    Position:X:30 Y:-40 Leader 1 4

        RanksToReleaseWhenAttacking = 1 2

        MeleeAttackLeashDistance = 25
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

       Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay     =    1000
        TauntAndPointExcluded        =    NONE
        AfraidOf                     =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf               =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
        PointAt                      =    EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance             =    150
        FearScanDistance             =    INFANTRY_FEAR_SCAN_RADIUS

        AddEmotion    =    Terror_Base
        AddEmotion    =    Doom_Base
        AddEmotion    =    BraceForBeingCrushed_Base
        AddEmotion    =    UncontrollableFear_Base_Evil
        AddEmotion    =    FearIdle_Base
        AddEmotion    =    FearBusy_Base
        AddEmotion    =    Point_Base
        AddEmotion    =    Taunt_Base
        AddEmotion    =    CheerIdle_Base
        AddEmotion    =    CheerBusy_Base
        AddEmotion    =    HeroCheerIdle_Base
        AddEmotion    =    HeroCheerBusy_Base
        AddEmotion    =    Alert_Base
    End

    LocomotorSet
        Locomotor     = NormalChargeMeleeHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_FOOT_SLOW_HORDE_SPEED_IRONHILLS
    End

    LocomotorSet
        Locomotor     = ScaredMeleeHordeLocomotor
        Condition     = SET_SCARED
        Speed         = NORMAL_FOOT_SLOW_HORDE_SPEED_IRONHILLS
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTraining
        LevelsToGain = 1
        LevelCap = 2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality
        TriggeredBy = Upgrade_FireArrows
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_DwarvenMithrilMail
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality17
        TriggeredBy        = Upgrade_HeavyArmor
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality16
        TriggeredBy = Upgrade_LastStandZwerge
    End

    Behavior = ObjectCreationUpgrade ModuleTag_MithrilMailPalantirFix
        TriggeredBy  = Upgrade_TechnologyDwarvenMithrilMail
        GrantUpgrade = Upgrade_HeavyArmor
    End

    #include "..\..\..\includes\CaptureBuilding.inc"




    Behavior = AISpecialPowerUpdate IsengardUrukCrossbowHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 45.0
    GeometryHeight = 20.0
    GeometryIsSmall = No



    AutoResolveUnitType = AutoResolveUnit_Archer
    AutoResolveCombatChain = AutoResolve_ArcherCombatChain

    AutoResolveBody = AutoResolve_IsengardUrukCrossbowHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_IsengardUrukCrossbowHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_IsengardUrukCrossbowArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_FireArrows
        Weapon = AutoResolve_IsengardUrukCrossbowUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_FireArrows
        Weapon = AutoResolve_IsengardUrukCrossbowWeapon
    End


    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTraining Upgrade_FireArrows Upgrade_HeavyArmor
End


Object DwarvenEreborDefendersHorde

    SelectPortrait     = UPEreborGuard
    ButtonImage        = HSEredVerteidiger

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER EMOTION_TERROR EMOTION_LOOK_TO_SKY SELECTED
        DefaultModelConditionState
            Model = None
        End

        ModelConditionState = HORDE_EMPTY
            Model = None
        End

        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkEUDFG
        End
    End

    Side = Dwarves
    EditorSorting = UNIT
    EmotionRange = 240
    DisplayName = OBJECT:HordeDwarvenDefenders
    DisplayNameStrategic = CONTROLBAR:LW_Unit_DwarvenDefendersHordeErebor
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_DwarvenDefendersHorde

    WeaponSet
        Conditions = None
        Weapon = PRIMARY    NormalMeleeHordeRangefinder
    End




    #include "..\..\..\includes\StandardHordeEvaEvents.inc"
    #include "..\..\..\includes\DwarvenRunesUnits.inc"

    UnitSpecificSounds
        VoiceDesperateAttack  = GondorSoldierVoiceDesperateCharge
    End

    BuildCost = 800
    BuildTime = STRONG_BUILDTIME
    VisionRange = 200
    ShroudClearingRange = 250
    VisionSide = 50%
    VisionRear = 25%

    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = 200
    VisionBonusPercentPerFoot = 1.0%
    CommandPoints = 60

    FormationWidth = 2
    FormationDepth = 1

    CrushableLevel = 0
    CrusherLevel = 1

    CrushOnlyWhileCharging = Yes

    MinCrushVelocityPercent = MINCRUSHVELOCITYPERCENT_STANDARD
    CrushDecelerationPercent = CRUSHDECELERATIONPERCENT_STANDARD

    CrushKnockback = 40
    CrushZFactor = 1.0

    TransportSlotCount = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE MELEE_HORDE NOTIFY_OF_PREATTACK ARMY_SUMMARY LARGE_RECTANGLE_PATHFIND

    ThreatLevel = DWARVEN_GUARDIAN_HORDE_THREAT
    ThreatBreakdown DwarvenGuardianHorde_DetailedThreat
        AIKindOf = INFANTRY
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = FighterHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle  = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate         = 500
        MaxCowerTime                = 5000
        MinCowerTime                = 3000

        CanAttackWhileContained            = Yes
        AILuaEventsList                = InfantryFunctions
        AttackPriority                = AttackPriority_Infantry
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained            =
        InitialPayload                = DwarvenEreborDefender 10
        Slots                    = 10
        PassengerFilter                = NONE +INFANTRY
        ShowPips                = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset = X:0 Y:0

        MeleeBehavior = Amoeba
        End


        BannerCarriersAllowed    = DwarvenEreborGuardianBanner
        BannerCarrierPosition    = UnitType:DwarvenEreborDefender    Pos:X:70.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:DwarvenEreborDefender Position:X:50 Y:0        Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:50 Y:40        Position:X:50 Y:-40
        RankInfo = RankNumber:2 UnitType:DwarvenEreborDefender Position:X:30 Y:0 Leader 1 0    Position:X:30 Y:20 Leader 1 1    Position:X:30 Y:-20 Leader 1 2    Position:X:30 Y:40 Leader 1 3    Position:X:30 Y:-40 Leader 1 4


        RanksToReleaseWhenAttacking        = 1 2
        AlternateFormation         = DwarvenEreborDefendersHordeBlock

        MeleeAttackLeashDistance        = 25
        BackUpMinDelayTime            = 1
        BackUpMaxDelayTime            = 3000
        BackUpMinDistance            = 1
        BackUpMaxDistance            = 3
        BackupPercentage            = 80%
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

    Behavior = CommandButtonHuntUpdate ModuleTag_CommandButtonHuntUpdate
    End

    Behavior = HordeNotifyTargetsOfImminentProbableCrushingUpdate ModuleTag_NotifyCrushScan
        ScanWidth = 60.0
    End

       Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded        =    NONE
         AfraidOf            =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf            =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
         PointAt                =    EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance        =    150
        FearScanDistance        =    INFANTRY_FEAR_SCAN_RADIUS

        AddEmotion            =    Terror_Base
        AddEmotion            =    Doom_Base
        AddEmotion            =       BraceForBeingCrushed_Base
        AddEmotion            =    UncontrollableFear_Base
        AddEmotion            =    FearIdle_Base
        AddEmotion            =    FearBusy_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
         AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    HeroCheerIdle_Base
        AddEmotion            =    HeroCheerBusy_Base
        AddEmotion            =    Alert_Base
        AddEmotion            =       CheerForAboutToCrush_Base
    End

    LocomotorSet
        Locomotor     = NormalChargeMeleeHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_FOOT_SLOW_HORDE_SPEED
    End

    LocomotorSet
        Locomotor     = ScaredMeleeHordeLocomotor
        Condition     = SET_SCARED
        Speed         = NORMAL_FOOT_SLOW_HORDE_SPEED
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTraining
        LevelsToGain = 1
        LevelCap = 2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality1
        TriggeredBy = Upgrade_DwarvenSiegeHammer
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_ForgedBlades
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality3
        TriggeredBy = Upgrade_DwarvenMithrilMail
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality17
        TriggeredBy        = Upgrade_HeavyArmor
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_KriegsschreiEnabler
        SpecialPowerTemplate      = SpecialAbilityVerteidigerKriegsschrei
        TriggeredBy               = Upgrade_ObjectLevel2
    End

    Behavior = SpecialPowerModule ModuleTag_KriegsschreiStarter
        SpecialPowerTemplate      = SpecialAbilityVerteidigerKriegsschrei
        UpdateModuleStartsAttack  = Yes
        StartsPaused              = Yes
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_KriegsschreiWeaponFireUpdate
        SpecialPowerTemplate      = SpecialAbilityVerteidigerKriegsschrei
        WhichSpecialWeapon        = 1
        SkipContinue              = Yes
        UnpackTime                = 1700
        PackTime                  = 1
        FreezeAfterTriggerDuration = 2500
        AwardXPForTriggering      = 0
        StartAbilityRange         = 80.0
        SpecialWeapon             = VerteidigerKriegsschreiWeapon
    End

    CommandSet = DwarvenGuardianEreborHordeCommandSet

    Behavior = ObjectCreationUpgrade ModuleTag_MithrilMailPalantirFix
        TriggeredBy  = Upgrade_TechnologyDwarvenMithrilMail
        GrantUpgrade = Upgrade_HeavyArmor
    End

    Behavior = CommandSetUpgrade ModuleTag_MithrilCommandSet
        TriggeredBy       = Upgrade_TechnologyDwarvenMithrilMail
        CommandSet        = DwarvenGuardianEreborHordeCommandSet_Mithril
    End





    Behavior = AISpecialPowerUpdate DwarvenGuardianHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Behavior = AISpecialPowerUpdate DwarfGuardianCharge
        CommandButtonName = Command_SpecialAbilityVerteidigerKriegsschrei
        SpecialPowerAIType = AI_SPECIAL_POWER_CHARGE
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality16
        TriggeredBy = Upgrade_LastStandZwerge
    End


    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 50.0
    GeometryHeight = 20.0
    GeometryIsSmall = No



    AutoResolveUnitType = AutoResolveUnit_Soldier
    AutoResolveCombatChain = AutoResolve_SoldierCombatChain

    AutoResolveBody = AutoResolve_DwarvenGuardianHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_DwarvenGuardianHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_DwarvenGuardianArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_DwarvenGuardianUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_DwarvenGuardianWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTraining Upgrade_ForgedBlades Upgrade_HeavyArmor Upgrade_DwarvenSiegeHammer
End


ChildObject DwarvenEreborDefendersHordeBlock DwarvenEreborDefendersHorde

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained        =
        InitialPayload            = DwarvenEreborDefender 10
        Slots                = 10
        PassengerFilter            = NONE +INFANTRY
        ShowPips            = No
        ThisFormationIsTheMainFormation = No
        AttributeModifiers        = DwarvenGuardianEreborBlock
        RandomOffset            = X:0 Y:0
        MeleeBehavior             = Amoeba
        End


        BannerCarriersAllowed    = DwarvenEreborGuardianBanner
        BannerCarrierPosition    = UnitType:DwarvenEreborDefender    Pos:X:46.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:DwarvenEreborDefender Position:X:34 Y:5            Position:X:34 Y:-5                Position:X:34 Y:-15                Position:X:34 Y:15
        RankInfo = RankNumber:2 UnitType:DwarvenEreborDefender Position:X:22 Y:0 Leader 1 0    Position:X:22 Y:10 Leader 1 1    Position:X:22 Y:-10 Leader 1 2
        RankInfo = RankNumber:3 UnitType:DwarvenEreborDefender Position:X:10 Y:0 Leader 2 0    Position:X:10 Y:10 Leader 2 1    Position:X:10 Y:-10 Leader 2 2

        RanksToReleaseWhenAttacking = 1

        AlternateFormation = DwarvenEreborDefendersHorde

        MeleeAttackLeashDistance     = 1
        BackUpMinDelayTime        = 1
        BackUpMaxDelayTime        = 3000
        BackUpMinDistance        = 1
        BackUpMaxDistance        = 3
        BackupPercentage        = 80%
    End
End



Object DwarvenHammertragerHorde


    ButtonImage       = HSHammertrager
    SelectPortrait    = UPHammertrager

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER EMOTION_TERROR EMOTION_LOOK_TO_SKY SELECTED
        DefaultModelConditionState
            Model = None
        End

        ModelConditionState = HORDE_EMPTY
            Model = None
        End

        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkEUDFG
        End
    End

    Side = Dwarves
    EditorSorting = UNIT
    EmotionRange = 240
    DisplayName = OBJECT:HordeDwarvenHammertrager
    DisplayNameStrategic = CONTROLBAR:LW_Unit_DwarvenHammertragerHorde
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_DwarvenHammertragerHorde

    WeaponSet
        Conditions = None
        Weapon = PRIMARY    NormalMeleeHordeRangefinder
        Weapon = SECONDARY   NormalMeleeHordeRangefinder
        AutoChooseSources     = SECONDARY NONE
        ShareWeaponReloadTime = Yes
    End





    #include "..\..\..\includes\StandardHordeEvaEvents.inc"
    #include "..\..\..\includes\DwarvenRunesUnits.inc"

    UnitSpecificSounds
        VoiceDesperateAttack  = GondorSoldierVoiceDesperateCharge
    End

    BuildCost = 750
    BuildTime = STRONG_BUILDTIME
    VisionRange = 200
    ShroudClearingRange = 250
    VisionSide = 50%
    VisionRear = 25%

    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = 200
    VisionBonusPercentPerFoot = 1.0%
    CommandPoints = 60

    FormationWidth = 2
    FormationDepth = 1

    CrushableLevel = 0
    CrusherLevel = 0

    TransportSlotCount = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE MELEE_HORDE NOTIFY_OF_PREATTACK ARMY_SUMMARY LARGE_RECTANGLE_PATHFIND

    ThreatLevel = DWARVEN_GUARDIAN_HORDE_THREAT
    ThreatBreakdown DwarvenGuardianHorde_DetailedThreat
        AIKindOf = INFANTRY
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = FighterHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle        = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate            = 500
        MaxCowerTime                = 5000
        MinCowerTime                = 3000

        CanAttackWhileContained            = Yes
        AILuaEventsList                = InfantryFunctions
        AttackPriority                = AttackPriority_Infantry
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained            =
        InitialPayload                = DwarvenHammertrager 10
        Slots                    = 10
        PassengerFilter                = NONE +INFANTRY
        ShowPips                = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset = X:0 Y:0

        MeleeBehavior = Amoeba
        End


        BannerCarriersAllowed    = DwarvenHammertragerBanner
        BannerCarrierPosition    = UnitType:DwarvenHammertrager    Pos:X:70.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:DwarvenHammertrager Position:X:50 Y:0        Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:50 Y:40        Position:X:50 Y:-40
        RankInfo = RankNumber:2 UnitType:DwarvenHammertrager Position:X:30 Y:0 Leader 1 0    Position:X:30 Y:20 Leader 1 1    Position:X:30 Y:-20 Leader 1 2    Position:X:30 Y:40 Leader 1 3    Position:X:30 Y:-40 Leader 1 4

        RanksToReleaseWhenAttacking        = 1 2

        MeleeAttackLeashDistance        = 25
        BackUpMinDelayTime            = 1
        BackUpMaxDelayTime            = 3000
        BackUpMinDistance            = 1
        BackUpMaxDistance            = 3
        BackupPercentage            = 80%
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

    Behavior = CommandButtonHuntUpdate ModuleTag_CommandButtonHuntUpdate
    End

    Behavior = HordeNotifyTargetsOfImminentProbableCrushingUpdate ModuleTag_NotifyCrushScan
        ScanWidth = 60.0
    End

       Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded        =    NONE
         AfraidOf            =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf            =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
         PointAt                =    EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance        =    150
        FearScanDistance        =    INFANTRY_FEAR_SCAN_RADIUS

        AddEmotion            =    Terror_Base
        AddEmotion            =    Doom_Base
        AddEmotion            =       BraceForBeingCrushed_Base
        AddEmotion            =    UncontrollableFear_Base
        AddEmotion            =    FearIdle_Base
        AddEmotion            =    FearBusy_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
         AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    HeroCheerIdle_Base
        AddEmotion            =    HeroCheerBusy_Base
        AddEmotion            =    Alert_Base
        AddEmotion            =       CheerForAboutToCrush_Base
    End

    LocomotorSet
        Locomotor     = NormalChargeMeleeHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_FOOT_SLOW_HORDE_SPEED
    End

    LocomotorSet
        Locomotor     = ScaredMeleeHordeLocomotor
        Condition     = SET_SCARED
        Speed         = NORMAL_FOOT_SLOW_HORDE_SPEED
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTraining
        LevelsToGain = 1
        LevelCap = 2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality1
        TriggeredBy = Upgrade_DwarvenSiegeHammer
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_ForgedBlades
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality3
        TriggeredBy = Upgrade_DwarvenMithrilMail
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality17
        TriggeredBy        = Upgrade_HeavyArmor
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality16
        TriggeredBy = Upgrade_LastStandZwerge
    End

    CommandSet = DwarvenHammertragerCommandSet

    Behavior = ObjectCreationUpgrade ModuleTag_MithrilMailPalantirFix
        TriggeredBy  = Upgrade_TechnologyDwarvenMithrilMail
        GrantUpgrade = Upgrade_HeavyArmor
    End

    Behavior = CommandSetUpgrade ModuleTag_MithrilCommandSet
        TriggeredBy       = Upgrade_TechnologyDwarvenMithrilMail
        CommandSet        = DwarvenHammertragerCommandSet_Mithril
    End





    Behavior = AISpecialPowerUpdate DwarvenGuardianHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Behavior = AISpecialPowerUpdate DwarfGuardianCharge
        CommandButtonName = Command_SpecialAbilityHammerschlage
        SpecialPowerAIType = AI_SPECIAL_POWER_CHARGE
    End


    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_Enabler
        SpecialPowerTemplate = SpecialAbilityHammerschlage
        TriggeredBy          = Upgrade_ObjectLevel2
    End

    Behavior = WeaponModeSpecialPowerUpdate ModuleTag_PowerUpdate
        SpecialPowerTemplate = SpecialAbilityHammerschlage
        Duration             = 20000
        AttributeModifier    = DwarvenHammerschlageBonus
        LockWeaponSlot       = SECONDARY
        StartsPaused         = No
    End


    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 50.0
    GeometryHeight = 20.0
    GeometryIsSmall = No



    AutoResolveUnitType = AutoResolveUnit_Soldier
    AutoResolveCombatChain = AutoResolve_SoldierCombatChain

    AutoResolveBody = AutoResolve_DwarvenGuardianHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_DwarvenGuardianHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_DwarvenGuardianArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_DwarvenGuardianUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_DwarvenGuardianWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTraining Upgrade_ForgedBlades Upgrade_HeavyArmor
End

Object DwarvenGuardianBreitschulternHorde


    ButtonImage       = UPEredLuinSoldier
    SelectPortrait    = UPEredLuinSoldier

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER EMOTION_TERROR EMOTION_LOOK_TO_SKY SELECTED
        DefaultModelConditionState
            Model = None
        End

        ModelConditionState = HORDE_EMPTY
            Model = None
        End

        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkEUDFG
        End
    End

    Side = Dwarves
    EditorSorting = UNIT
    EmotionRange = 240
    DisplayName = OBJECT:HordeDwarvenGuardianBreitschultern
    DisplayNameStrategic = CONTROLBAR:LW_Unit_DwarvenGuardianBreitschultern
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_DwarvenGuardianErebor

    WeaponSet
        Conditions = None
        Weapon = PRIMARY    NormalMeleeHordeRangefinder
    End




    #include "..\..\..\includes\StandardHordeEvaEvents.inc"
    #include "..\..\..\includes\DwarvenRunesUnits.inc"

    UnitSpecificSounds
        VoiceDesperateAttack  = GondorSoldierVoiceDesperateCharge
    End

    BuildCost = 320
    BuildTime = MEDIUM_BUILDTIME
    VisionRange = 200
    ShroudClearingRange = 250
    VisionSide = 50%
    VisionRear = 25%

    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = 200
    VisionBonusPercentPerFoot = 1.0%
    CommandPoints = 40

    FormationWidth = 2
    FormationDepth = 1

    CrushableLevel = 0
    CrusherLevel = 1

    CrushOnlyWhileCharging = Yes

    MinCrushVelocityPercent = MINCRUSHVELOCITYPERCENT_STANDARD
    CrushDecelerationPercent = CRUSHDECELERATIONPERCENT_STANDARD

    CrushKnockback = 40
    CrushZFactor = 1.0

    TransportSlotCount = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE MELEE_HORDE NOTIFY_OF_PREATTACK ARMY_SUMMARY LARGE_RECTANGLE_PATHFIND

    ThreatLevel = DWARVEN_GUARDIAN_HORDE_THREAT
    ThreatBreakdown DwarvenGuardianHorde_DetailedThreat
        AIKindOf = INFANTRY
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = FighterHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle        = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate            = 500
        MaxCowerTime                = 5000
        MinCowerTime                = 3000

        CanAttackWhileContained            = Yes
        AILuaEventsList                = InfantryFunctions
        AttackPriority                = AttackPriority_Infantry
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained            =
        InitialPayload                = DwarvenGuardianBreitschultern 10
        Slots                    = 10
        PassengerFilter                = NONE +INFANTRY
        ShowPips                = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset = X:0 Y:0

        MeleeBehavior = Amoeba
        End


        BannerCarriersAllowed    = DwarvenBreitschulternBanner
        BannerCarrierPosition    = UnitType:DwarvenGuardianBreitschultern    Pos:X:70.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:DwarvenGuardianBreitschultern Position:X:50 Y:0        Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:50 Y:40        Position:X:50 Y:-40
        RankInfo = RankNumber:2 UnitType:DwarvenGuardianBreitschultern Position:X:30 Y:0 Leader 1 0    Position:X:30 Y:20 Leader 1 1    Position:X:30 Y:-20 Leader 1 2    Position:X:30 Y:40 Leader 1 3    Position:X:30 Y:-40 Leader 1 4

        RanksToReleaseWhenAttacking        = 1

        MeleeAttackLeashDistance        = 25
        BackUpMinDelayTime            = 1
        BackUpMaxDelayTime            = 3000
        BackUpMinDistance            = 1
        BackUpMaxDistance            = 3
        BackupPercentage            = 80%
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

    Behavior = CommandButtonHuntUpdate ModuleTag_CommandButtonHuntUpdate
    End

    Behavior = HordeNotifyTargetsOfImminentProbableCrushingUpdate ModuleTag_NotifyCrushScan
        ScanWidth = 60.0
    End

       Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded        =    NONE
        AfraidOf            =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf            =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
        PointAt                =    EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance        =    150
        FearScanDistance        =    INFANTRY_FEAR_SCAN_RADIUS

        AddEmotion            =    Terror_Base
        AddEmotion            =    Doom_Base
        AddEmotion            =    BraceForBeingCrushed_Base
        AddEmotion            =    UncontrollableFear_Base
        AddEmotion            =    FearIdle_Base
        AddEmotion            =    FearBusy_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
        AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    HeroCheerIdle_Base
        AddEmotion            =    HeroCheerBusy_Base
        AddEmotion            =    Alert_Base
        AddEmotion            =    CheerForAboutToCrush_Base
    End

    LocomotorSet
        Locomotor     = NormalChargeMeleeHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_FOOT_SLOW_HORDE_SPEED_EREDLUIN
    End

    LocomotorSet
        Locomotor     = ScaredMeleeHordeLocomotor
        Condition     = SET_SCARED
        Speed         = NORMAL_FOOT_SLOW_HORDE_SPEED_EREDLUIN
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTraining
        LevelsToGain = 1
        LevelCap = 2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality1
        TriggeredBy = Upgrade_ForgedBlades
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_DwarvenMithrilMail
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality17
        TriggeredBy        = Upgrade_HeavyArmor
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality3
        TriggeredBy = Upgrade_DwarvenSiegeHammer
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality16
        TriggeredBy = Upgrade_LastStandZwerge
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End


    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_ChargeUnpause
        SpecialPowerTemplate          = SpecialAbilityDwarvenCharge
        TriggeredBy            = Upgrade_ObjectLevel2
    End

      Behavior = SpecialPowerModule ModuleTag_ChargeStarter
        SpecialPowerTemplate          = SpecialAbilityDwarvenCharge
        UpdateModuleStartsAttack      = Yes
        StartsPaused            = Yes
    End

    #include "..\..\..\includes\DwarvenChargeUpdate.inc"

    CommandSet = DwarvenGuardianBreitschulternCommandSet

    Behavior = ObjectCreationUpgrade ModuleTag_MithrilMailPalantirFix
        TriggeredBy  = Upgrade_TechnologyDwarvenMithrilMail
        GrantUpgrade = Upgrade_HeavyArmor
    End

    Behavior = CommandSetUpgrade ModuleTag_MithrilCommandSet
        TriggeredBy       = Upgrade_TechnologyDwarvenMithrilMail
        CommandSet        = DwarvenGuardianBreitschulternCommandSet_Mithril
    End





    Behavior = AISpecialPowerUpdate DwarvenGuardianHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Behavior = AISpecialPowerUpdate DwarfGuardianCharge
        CommandButtonName = Command_DwarvenGuardianChargeAttack
        SpecialPowerAIType = AI_SPECIAL_POWER_CHARGE
    End


    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 50.0
    GeometryHeight = 20.0
    GeometryIsSmall = No



    AutoResolveUnitType = AutoResolveUnit_Soldier
    AutoResolveCombatChain = AutoResolve_SoldierCombatChain

    AutoResolveBody = AutoResolve_DwarvenGuardianHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_DwarvenGuardianHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_DwarvenGuardianArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_DwarvenGuardianUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_DwarvenGuardianWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTraining Upgrade_ForgedBlades Upgrade_HeavyArmor
End


Object DwarvenGuardianIronHillsHorde

    SelectPortrait     = UPIronHillsWarrior
    ButtonImage        = UIIronHillsWarrior

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER EMOTION_TERROR EMOTION_LOOK_TO_SKY SELECTED
        DefaultModelConditionState
            Model = None
        End

        ModelConditionState = HORDE_EMPTY
            Model = None
        End

        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkEUDFG
        End
    End

    Side = Dwarves
    EditorSorting = UNIT
    EmotionRange = 240
    DisplayName = OBJECT:HordeDwarvenGuardianIronHills
    DisplayNameStrategic = CONTROLBAR:LW_Unit_DwarvenGuardianIronHills
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_DwarvenGuardianErebor

    WeaponSet
        Conditions = None
        Weapon = PRIMARY    NormalMeleeHordeRangefinder
    End




    #include "..\..\..\includes\StandardHordeEvaEvents.inc"
    #include "..\..\..\includes\DwarvenRunesUnits.inc"

    UnitSpecificSounds
        VoiceDesperateAttack  = GondorSoldierVoiceDesperateCharge
    End

    BuildCost = DWARVEN_GAURDIANDAG_BUILDCOST
    BuildTime = MEDIUM_BUILDTIME
    VisionRange = 200
    ShroudClearingRange = 250
    VisionSide = 50%
    VisionRear = 25%

    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = 200
    VisionBonusPercentPerFoot = 1.0%
    CommandPoints = 50

    FormationWidth = 2
    FormationDepth = 1

    CrushableLevel = 0
    CrusherLevel = 1

    CrushOnlyWhileCharging = Yes

    MinCrushVelocityPercent = MINCRUSHVELOCITYPERCENT_STANDARD
    CrushDecelerationPercent = CRUSHDECELERATIONPERCENT_STANDARD

    CrushKnockback = 40
    CrushZFactor = 1.0

    TransportSlotCount = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE MELEE_HORDE NOTIFY_OF_PREATTACK ARMY_SUMMARY LARGE_RECTANGLE_PATHFIND

    ThreatLevel = DWARVEN_GUARDIAN_HORDE_THREAT
    ThreatBreakdown DwarvenGuardianHorde_DetailedThreat
        AIKindOf = INFANTRY
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = FighterHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle        = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate            = 500
        MaxCowerTime                = 5000
        MinCowerTime                = 3000

        CanAttackWhileContained            = Yes
        AILuaEventsList                = InfantryFunctions
        AttackPriority                = AttackPriority_Infantry
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained            =
        InitialPayload                = DwarvenGuardianIronHills 10
        Slots                    = 10
        PassengerFilter                = NONE +INFANTRY
        ShowPips                = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset = X:0 Y:0

        MeleeBehavior = Amoeba
        End

        BannerCarriersAllowed    = DwarvenIronHillsBanner
        BannerCarrierPosition    = UnitType:DwarvenGuardianIronHills    Pos:X:70.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:DwarvenGuardianIronHills Position:X:50 Y:0        Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:50 Y:40        Position:X:50 Y:-40
        RankInfo = RankNumber:2 UnitType:DwarvenGuardianIronHills Position:X:30 Y:0 Leader 1 0    Position:X:30 Y:20 Leader 1 1    Position:X:30 Y:-20 Leader 1 2    Position:X:30 Y:40 Leader 1 3    Position:X:30 Y:-40 Leader 1 4

        RanksToReleaseWhenAttacking        = 1 2

        MeleeAttackLeashDistance        = 25
        BackUpMinDelayTime            = 1
        BackUpMaxDelayTime            = 3000
        BackUpMinDistance            = 1
        BackUpMaxDistance            = 3
        BackupPercentage            = 80%
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

    Behavior = CommandButtonHuntUpdate ModuleTag_CommandButtonHuntUpdate
    End

    Behavior = HordeNotifyTargetsOfImminentProbableCrushingUpdate ModuleTag_NotifyCrushScan
        ScanWidth = 60.0
    End

       Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded        =    NONE
        AfraidOf            =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf            =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
        PointAt                =    EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance        =    150
        FearScanDistance        =    INFANTRY_FEAR_SCAN_RADIUS

        AddEmotion            =    Terror_Base
        AddEmotion            =    Doom_Base
        AddEmotion            =       BraceForBeingCrushed_Base
        AddEmotion            =    UncontrollableFear_Base
        AddEmotion            =    FearIdle_Base
        AddEmotion            =    FearBusy_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
         AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    HeroCheerIdle_Base
        AddEmotion            =    HeroCheerBusy_Base
        AddEmotion            =    Alert_Base
        AddEmotion            =       CheerForAboutToCrush_Base
    End

    LocomotorSet
        Locomotor     = NormalChargeMeleeHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_FOOT_SLOW_HORDE_SPEED_IRONHILLS
    End

    LocomotorSet
        Locomotor     = ScaredMeleeHordeLocomotor
        Condition     = SET_SCARED
        Speed         = NORMAL_FOOT_SLOW_HORDE_SPEED_IRONHILLS
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End










    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTraining
        LevelsToGain = 1
        LevelCap = 2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality1
        TriggeredBy = Upgrade_DwarvenMasterAxes
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_ForgedBlades
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality3
        TriggeredBy = Upgrade_DwarvenMithrilMail
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality4
        TriggeredBy = Upgrade_MountAI
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality16
        TriggeredBy = Upgrade_LastStandZwerge
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality17
        TriggeredBy        = Upgrade_HeavyArmor
    End

   Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End


    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_ChargeUnpause
        SpecialPowerTemplate          = SpecialAbilityDwarvenCharge
        TriggeredBy            = Upgrade_ObjectLevel2
    End

      Behavior = SpecialPowerModule ModuleTag_ChargeStarter
        SpecialPowerTemplate          = SpecialAbilityDwarvenCharge
        UpdateModuleStartsAttack      = Yes
        StartsPaused            = Yes
    End

    #include "..\..\..\includes\DwarvenChargeUpdate.inc"

    CommandSet = DwarvenGuardianIronHillsCommandSet

    Behavior = ObjectCreationUpgrade ModuleTag_MithrilMailPalantirFix
        TriggeredBy  = Upgrade_TechnologyDwarvenMithrilMail
        GrantUpgrade = Upgrade_HeavyArmor
    End

    Behavior = CommandSetUpgrade ModuleTag_MithrilCommandSet
        TriggeredBy       = Upgrade_TechnologyDwarvenMithrilMail
        CommandSet        = DwarvenGuardianIronHillsCommandSet_Mithril
    End





    Behavior = AISpecialPowerUpdate DwarvenGuardianHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Behavior = AISpecialPowerUpdate DwarfGuardianCharge
        CommandButtonName = Command_DwarvenGuardianChargeAttack
        SpecialPowerAIType = AI_SPECIAL_POWER_CHARGE
    End


    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 50.0
    GeometryHeight = 20.0
    GeometryIsSmall = No



    AutoResolveUnitType = AutoResolveUnit_Soldier
    AutoResolveCombatChain = AutoResolve_SoldierCombatChain

    AutoResolveBody = AutoResolve_DwarvenGuardianHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_DwarvenGuardianHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_DwarvenGuardianArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_DwarvenGuardianUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_DwarvenGuardianWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTraining Upgrade_ForgedBlades Upgrade_HeavyArmor Upgrade_DwarvenMasterAxes
End



Object DwarvenGuardianEreborHorde

    ButtonImage       = UPEreborGuardian
    SelectPortrait    = UPEreborGuardian ;UPEreborSoldier

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER EMOTION_TERROR EMOTION_LOOK_TO_SKY SELECTED
        DefaultModelConditionState
            Model = None
        End

        ModelConditionState = HORDE_EMPTY
            Model = None
        End

        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkEUDFG
        End
    End

    Side = Dwarves
    EditorSorting = UNIT
    EmotionRange = 240
    DisplayName = OBJECT:HordeDwarvenGuardianErebor
    DisplayNameStrategic = CONTROLBAR:LW_Unit_DwarvenGuardianErebor
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_DwarvenGuardianErebor

    WeaponSet
        Conditions = None
        Weapon = PRIMARY    NormalMeleeHordeRangefinder
    End



    #include "..\..\..\includes\StandardHordeEvaEvents.inc"
    #include "..\..\..\includes\DwarvenRunesUnits.inc"

    UnitSpecificSounds
        VoiceDesperateAttack  = GondorSoldierVoiceDesperateCharge
    End

    BuildCost = DWARVEN_GAURDIANDAG_BUILDCOST
    BuildTime = MEDIUM_BUILDTIME
    VisionRange = 200
    ShroudClearingRange = 250
    VisionSide = 50%
    VisionRear = 25%

    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = 200
    VisionBonusPercentPerFoot = 1.0%
    CommandPoints = 40

    FormationWidth = 2
    FormationDepth = 1

    CrushableLevel = 0
    CrusherLevel = 1

    CrushOnlyWhileCharging = Yes

    MinCrushVelocityPercent = MINCRUSHVELOCITYPERCENT_STANDARD
    CrushDecelerationPercent = CRUSHDECELERATIONPERCENT_STANDARD

    CrushKnockback = 40
    CrushZFactor = 1.0

    TransportSlotCount = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE MELEE_HORDE NOTIFY_OF_PREATTACK ARMY_SUMMARY LARGE_RECTANGLE_PATHFIND

    ThreatLevel = DWARVEN_GUARDIAN_HORDE_THREAT
    ThreatBreakdown DwarvenGuardianHorde_DetailedThreat
        AIKindOf = INFANTRY
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = FighterHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle        = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate            = 500
        MaxCowerTime                = 5000
        MinCowerTime                = 3000

        CanAttackWhileContained            = Yes
        AILuaEventsList                = InfantryFunctions
        AttackPriority                = AttackPriority_Infantry
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained            =
        InitialPayload                = DwarvenGuardianErebor 10
        Slots                    = 10
        PassengerFilter                = NONE +INFANTRY
        ShowPips                = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset = X:0 Y:0

        MeleeBehavior = Amoeba
        End

        BannerCarriersAllowed    = DwarvenEreborBanner
        BannerCarrierPosition    = UnitType:DwarvenGuardianErebor    Pos:X:70.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:DwarvenGuardianErebor Position:X:50 Y:0        Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:50 Y:40        Position:X:50 Y:-40
        RankInfo = RankNumber:2 UnitType:DwarvenGuardianErebor Position:X:30 Y:0 Leader 1 0    Position:X:30 Y:20 Leader 1 1    Position:X:30 Y:-20 Leader 1 2    Position:X:30 Y:40 Leader 1 3    Position:X:30 Y:-40 Leader 1 4

        RanksToReleaseWhenAttacking        = 1 2

        MeleeAttackLeashDistance        = 25
        BackUpMinDelayTime            = 1
        BackUpMaxDelayTime            = 3000
        BackUpMinDistance            = 1
        BackUpMaxDistance            = 3
        BackupPercentage            = 80%
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

    Behavior = CommandButtonHuntUpdate ModuleTag_CommandButtonHuntUpdate
    End

    Behavior = HordeNotifyTargetsOfImminentProbableCrushingUpdate ModuleTag_NotifyCrushScan
        ScanWidth = 60.0
    End

       Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded        =    NONE
         AfraidOf            =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf            =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
         PointAt                =    EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance        =    150
        FearScanDistance        =    INFANTRY_FEAR_SCAN_RADIUS

        AddEmotion            =    Terror_Base
        AddEmotion            =    Doom_Base
        AddEmotion            =       BraceForBeingCrushed_Base
        AddEmotion            =    UncontrollableFear_Base
        AddEmotion            =    FearIdle_Base
        AddEmotion            =    FearBusy_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
         AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    HeroCheerIdle_Base
        AddEmotion            =    HeroCheerBusy_Base
        AddEmotion            =    Alert_Base
        AddEmotion            =       CheerForAboutToCrush_Base
    End

    LocomotorSet
        Locomotor     = NormalChargeMeleeHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_FOOT_SLOW_HORDE_SPEED
    End

    LocomotorSet
        Locomotor     = ScaredMeleeHordeLocomotor
        Condition     = SET_SCARED
        Speed         = NORMAL_FOOT_SLOW_HORDE_SPEED
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTraining
        LevelsToGain = 1
        LevelCap = 2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality1
        TriggeredBy = Upgrade_DwarvenSiegeHammer
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_ForgedBlades
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality3
        TriggeredBy = Upgrade_DwarvenMithrilMail
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality16
        TriggeredBy = Upgrade_LastStandZwerge
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality17
        TriggeredBy        = Upgrade_HeavyArmor
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End


    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_ChargeUnpause
        SpecialPowerTemplate          = SpecialAbilityDwarvenCharge
        TriggeredBy            = Upgrade_ObjectLevel2
    End

      Behavior = SpecialPowerModule ModuleTag_ChargeStarter
        SpecialPowerTemplate          = SpecialAbilityDwarvenCharge
        UpdateModuleStartsAttack      = Yes
        StartsPaused            = Yes
    End

    #include "..\..\..\includes\DwarvenChargeUpdate.inc"

    CommandSet = DwarvenGuardianEreborCommandSet

    Behavior = ObjectCreationUpgrade ModuleTag_MithrilMailPalantirFix
        TriggeredBy  = Upgrade_TechnologyDwarvenMithrilMail
        GrantUpgrade = Upgrade_HeavyArmor
    End

    Behavior = CommandSetUpgrade ModuleTag_MithrilCommandSet
        TriggeredBy          = Upgrade_TechnologyDwarvenMithrilMail
        CommandSet           = DwarvenGuardianEreborCommandSet_Mithril
    End

    Behavior = CommandSetUpgrade ModuleTag_HammerCommandSet
        TriggeredBy          = Upgrade_DwarvenSiegeHammer
        CommandSet           = DwarvenGuardianEreborCommandSet_Belagerungshammer
    End

    Behavior = CommandSetUpgrade ModuleTag_HammerMithrilCommandSet
        TriggeredBy          = Upgrade_DwarvenSiegeHammer Upgrade_HeavyArmor
        RequiresAllTriggers  = Yes
        CommandSet           = DwarvenGuardianEreborCommandSet_Mithril_Belagerungshammer
    End


    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_Enabler
        SpecialPowerTemplate = SpecialAbilityHammerschlage
        TriggeredBy          = Upgrade_AllFactionUpgrade
    End

    Behavior = WeaponModeSpecialPowerUpdate ModuleTag_PowerUpdate
        SpecialPowerTemplate = SpecialAbilityHammerschlage
        Duration             = 20000
        AttributeModifier    = DwarvenHammerschlageBonus
        LockWeaponSlot       = SECONDARY
        StartsPaused         = No
    End

    Behavior = AutoAbilityBehavior ModuleTag_AutoAbilityPower
        SpecialAbility       = SpecialAbilityHammerschlage
        MaxScanRange         = 70
        Query                = 10 ANY ENEMIES +INFANTRY
    End







    Behavior = AISpecialPowerUpdate DwarvenGuardianHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Behavior = AISpecialPowerUpdate DwarfGuardianCharge
        CommandButtonName = Command_DwarvenGuardianChargeAttack
        SpecialPowerAIType = AI_SPECIAL_POWER_CHARGE
    End


    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 50.0
    GeometryHeight = 20.0
    GeometryIsSmall = No



    AutoResolveUnitType = AutoResolveUnit_Soldier
    AutoResolveCombatChain = AutoResolve_SoldierCombatChain

    AutoResolveBody = AutoResolve_DwarvenGuardianHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_DwarvenGuardianHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_DwarvenGuardianArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_DwarvenGuardianUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_DwarvenGuardianWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTraining Upgrade_ForgedBlades Upgrade_HeavyArmor
End



Object DwarvenPhalanxBreitschulternHorde

    ButtonImage         = UPEredLuinPikeman
    SelectPortrait      = UPEredLuinPikeman

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER EMOTION_TERROR EMOTION_LOOK_TO_SKY SELECTED
        DefaultModelConditionState
            Model = None
        End

        ModelConditionState = HORDE_EMPTY
            Model = None
        End

        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkEUDFG
        End
    End

    Side            = Dwarves
    EditorSorting        = UNIT
    EmotionRange        = 240
    DisplayName        = OBJECT:HordeDwarvenPhalanxBreitschultern
    DisplayNameStrategic     = CONTROLBAR:LW_Unit_DwarvenPhalanxBreitschulternHorde
    DescriptionStrategic     = CONTROLBAR:LW_ToolTip_DwarvenPhalanxLangbarteHorde

    WeaponSet
        Conditions = None
        Weapon = PRIMARY    TowerGuardHordeRangefinder
    End



    #include "..\..\..\includes\StandardHordeEvaEvents.inc"
    #include "..\..\..\includes\DwarvenRunesUnits.inc"
        UnitSpecificSounds
        VoiceDesperateAttack  = GondorSoldierVoiceDesperateCharge
    End

    BuildCost            = 300
    BuildTime            = MEDIUM_BUILDTIME
    VisionRange            = 200
    ShroudClearingRange         = 250

    VisionSide             = 50%
    VisionRear             = 25%

    MaxVisionBonusPercent         = 300%
    VisionBonusTestRadius         = 200
    VisionBonusPercentPerFoot     = 1.0%
    CommandPoints            = 40

    FormationWidth             = 2
    FormationDepth             = 1

    CrushableLevel            = 0
    CrusherLevel            = 0

    TransportSlotCount = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE MELEE_HORDE NOTIFY_OF_PREATTACK ARMY_SUMMARY PIKE LARGE_RECTANGLE_PATHFIND

    ThreatLevel = DWARVEN_PHALANX_HORDE_THREAT
    ThreatBreakdown DwarvenPhalanxHorde_DetailedThreat
        AIKindOf = PIKEMAN
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = PikeHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle    = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate        = 500
        MaxCowerTime            = 5000
        MinCowerTime            = 3000
        CanAttackWhileContained        = Yes
        AILuaEventsList            = InfantryFunctions
        AttackPriority            = AttackPriority_Infantry
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle             = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay             = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained        =
        InitialPayload            = DwarvenPhalanxBreitschultern 10
        Slots                = 10
        PassengerFilter            = NONE +INFANTRY
        ShowPips            = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset             = X:0 Y:0

        MeleeBehavior             = Amoeba
        End


        BannerCarriersAllowed    = DwarvenBreitschulternBanner
        BannerCarrierPosition    = UnitType:DwarvenPhalanxBreitschultern    Pos:X:70.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:DwarvenPhalanxBreitschultern Position:X:50 Y:0        Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:50 Y:40        Position:X:50 Y:-40
        RankInfo = RankNumber:2 UnitType:DwarvenPhalanxBreitschultern Position:X:30 Y:0 Leader 1 0    Position:X:30 Y:20 Leader 1 1    Position:X:30 Y:-20 Leader 1 2    Position:X:30 Y:40 Leader 1 3    Position:X:30 Y:-40 Leader 1 4

        RanksToReleaseWhenAttacking        = 1 2

        MeleeAttackLeashDistance        = 25
        BackUpMinDelayTime            = 1
        BackUpMaxDelayTime            = 3000
        BackUpMinDistance            = 1
        BackUpMaxDistance            = 3
        BackupPercentage            = 80%

        AlternateFormation            = DwarvenPhalanxBreitschulternHordePorcupine
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

    Behavior = CommandButtonHuntUpdate ModuleTag_CommandButtonHuntUpdate
    End

       Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded        =    NONE
        AfraidOf            =    EMOTION_AFRAIDOF_OBJECTFILTER_LANCERS
        AlwaysAfraidOf            =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER_LANCERS
        PointAt                =    EMOTION_POINTAT_OBJECTFILTER_LANCERS
        HeroScanDistance        =    150
        FearScanDistance        =    INFANTRY_FEAR_SCAN_RADIUS

        AddEmotion            =    Terror_Base
        AddEmotion            =    Doom_Base
        AddEmotion            =    UncontrollableFear_Base
        AddEmotion            =    FearIdle_Base
        AddEmotion            =    FearBusy_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
         AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    HeroCheerIdle_Base
        AddEmotion            =    HeroCheerBusy_Base
        AddEmotion            =    Alert_Base
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End

    LocomotorSet
        Locomotor     = NormalChargeMeleeHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_FOOT_SLOW_HORDE_SPEED_EREDLUIN
    End

    LocomotorSet
        Locomotor     = ScaredMeleeHordeLocomotor
        Condition     = SET_SCARED
        Speed         = NORMAL_FOOT_SLOW_HORDE_SPEED_EREDLUIN
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy        = Upgrade_BasicTraining
        LevelsToGain        = 1
        LevelCap        = 2
    End

    CommandSet = DwarvenPhalanxHordeCommandSet_Breitschultern

    Behavior = ObjectCreationUpgrade ModuleTag_MithrilMailPalantirFix
        TriggeredBy  = Upgrade_TechnologyDwarvenMithrilMail
        GrantUpgrade = Upgrade_HeavyArmor
    End

    Behavior = CommandSetUpgrade ModuleTag_MithrilCommandSet
        TriggeredBy       = Upgrade_TechnologyDwarvenMithrilMail
        CommandSet        = DwarvenPhalanxHordeCommandSet_Breitschultern_Mithril
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegalityPhalanx
        TriggeredBy = Upgrade_ForgedBlades
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegalityPhalanx2
        TriggeredBy = Upgrade_DwarvenMithrilMail
    End
	
	Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality3
        TriggeredBy = Upgrade_DwarvenSiegeHammer
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality16
        TriggeredBy = Upgrade_LastStandZwerge
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality17
        TriggeredBy        = Upgrade_HeavyArmor
    End






    Behavior = AISpecialPowerUpdate DwarvenPhalanxHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End


    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 50.0
    GeometryHeight = 20.0
    GeometryIsSmall = No



    AutoResolveUnitType = AutoResolveUnit_Pikemen
    AutoResolveCombatChain = AutoResolve_PikemenCombatChain

    AutoResolveBody = AutoResolve_DwarvenPhalanxHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_DwarvenPhalanxHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_DwarvenPhalanxArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_DwarvenPhalanxUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_DwarvenPhalanxWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTraining Upgrade_ForgedBlades Upgrade_HeavyArmor
End

ChildObject DwarvenPhalanxBreitschulternHordePorcupine DwarvenPhalanxBreitschulternHorde

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle             = STANDARD_PIKEMAN_FRONTANGLE_FORMATION
        FlankedDelay             = STANDARD_PIKEMAN_FLANKEDDELAY
        ObjectStatusOfContained         =
        InitialPayload                = DwarvenPhalanxBreitschultern 10
        Slots                    = 10
        PassengerFilter                = NONE +INFANTRY
        ShowPips                = No
        ThisFormationIsTheMainFormation     = No
        RandomOffset                = X:2 Y:1
        RanksToReleaseWhenAttacking        = 0
        RanksToJustFreeWhenAttacking           = 0
        AttributeModifiers            = DwarvenPhalanxHordePorcupine
        IsPorcupineFormation            = Yes
        MinimumHordeSize            = 5

        AlternateFormation            = DwarvenPhalanxBreitschulternHorde
        VisionRearOverride            = 100%
        VisionSideOverride            = 100%
        NotComboFormation            = Yes


        BannerCarriersAllowed            = DwarvenBreitschulternBanner
        BannerCarrierPosition            = UnitType:DwarvenPhalanxBreitschultern    Pos:X:0.0 Y:0.0

        RankInfo    = RankNumber:1 UnitType:DwarvenPhalanxBreitschultern    Position:X:-16.18 Y:11.76        Position:X:6.18 Y:-19.02    Position:X:6.18 Y:19.02    Position:X:-16.18 Y:-11.76    Position:X:26.77 Y:-29.73    Position:X:-4.18 Y:39.78    Position:X:-20 Y:-34.64    Position:X:26.77 Y:29.73    Position:X:-20 Y:34.64    Position:X:-4.18 Y:-39.78
     End
End


Object DwarvenIronBreakerHorde

    SelectPortrait     = UPEisenbergElite
    ButtonImage        = HIEisenbergElite_Wotr

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER EMOTION_TERROR EMOTION_LOOK_TO_SKY SELECTED
        DefaultModelConditionState
            Model = None
        End

        ModelConditionState = HORDE_EMPTY
            Model = None
        End

        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkEUDFG
        End
    End

    Side = Dwarves
    EditorSorting = UNIT
    EmotionRange = 240
    DisplayName = OBJECT:DwarvenIronBreakerHorde
    DisplayNameStrategic = CONTROLBAR:LW_Unit_DwarvenIronBreakerHorde
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_DwarvenArkenguardHorde

    WeaponSet
        Conditions            = None
        Weapon                = PRIMARY     NormalMeleeHordeRangefinder
        AutoChooseSources     = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End

    WeaponSet
        Conditions            = WEAPONSET_TOGGLE_1
        Weapon                = PRIMARY     NormalMeleeHordeRangefinder
        AutoChooseSources     = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End



    #include "..\..\..\includes\StandardHordeEvaEvents.inc"
    #include "..\..\..\includes\DwarvenRunesUnits.inc"

    BuildCost = DWARVENELITES_BUILDCOST
    BuildTime = STRONG_BUILDTIME
    VisionRange = 250
    ShroudClearingRange = 300
    VisionSide = 50%
    VisionRear = 25%

    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = 200
    VisionBonusPercentPerFoot = 1.0%
    CommandPoints = 60

    FormationWidth = 1
    FormationDepth = 1

    CrushableLevel = 0

    TransportSlotCount = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE MELEE_HORDE NOTIFY_OF_PREATTACK LARGE_RECTANGLE_PATHFIND ARMY_SUMMARY

    ThreatLevel = 150
    ThreatBreakdown DwarvenGuardianHorde_DetailedThreat
        AIKindOf = INFANTRY
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = FighterHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle        = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate            = 500
        MaxCowerTime                = 5000
        MinCowerTime                = 3000

        CanAttackWhileContained            = Yes
        AILuaEventsList                = InfantryFunctions
        AttackPriority                = AttackPriority_Infantry
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained            =
        InitialPayload                = DwarvenIronBreaker 10
        Slots                    = 10
        PassengerFilter                = NONE +INFANTRY
        ShowPips                = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset = X:0 Y:0

        MeleeBehavior = Amoeba
        End



        BannerCarriersAllowed    = DwarvenIronBreakerBanner
        BannerCarrierPosition    = UnitType:DwarvenIronBreaker    Pos:X:40.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:DwarvenIronBreaker Position:X:20 Y:0              Position:X:20 Y:20              Position:X:20 Y:-20              Position:X:20 Y:40              Position:X:20 Y:-40
        RankInfo = RankNumber:2 UnitType:DwarvenIronBreaker Position:X:0 Y:0 Leader 1 0    Position:X:0 Y:20 Leader 1 1    Position:X:0 Y:-20 Leader 1 2    Position:X:0 Y:40 Leader 1 3    Position:X:0 Y:-40 Leader 1 4

        RanksToReleaseWhenAttacking        = 1 2

        MeleeAttackLeashDistance        = 50
        BackUpMinDelayTime            = 1
        BackUpMaxDelayTime            = 3000
        BackUpMinDistance            = 1
        BackUpMaxDistance            = 3
        BackupPercentage            = 80%
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

    Behavior = CommandButtonHuntUpdate ModuleTag_CommandButtonHuntUpdate
    End

    Behavior = HordeNotifyTargetsOfImminentProbableCrushingUpdate ModuleTag_NotifyCrushScan
        ScanWidth = 60.0
    End

       Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded        =    NONE
        AfraidOf            =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf            =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
        PointAt                =    EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance        =    150
        FearScanDistance        =    INFANTRY_FEAR_SCAN_RADIUS

        AddEmotion            =    Terror_Base
        AddEmotion            =    Doom_Base
        AddEmotion            =       BraceForBeingCrushed_Base
        AddEmotion            =    UncontrollableFear_Base
        AddEmotion            =    FearIdle_Base
        AddEmotion            =    FearBusy_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
        AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    HeroCheerIdle_Base
        AddEmotion            =    HeroCheerBusy_Base
        AddEmotion            =    Alert_Base
        AddEmotion            =       CheerForAboutToCrush_Base
    End

    LocomotorSet
        Locomotor     = NormalChargeMeleeHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_FOOT_SLOW_HORDE_SPEED_IRONHILLS
    End

    LocomotorSet
        Locomotor     = ScaredMeleeHordeLocomotor
        Condition     = SET_SCARED
        Speed         = NORMAL_FOOT_SLOW_HORDE_SPEED_IRONHILLS
    End


    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End







    Behavior = WeaponChangeSpecialPowerModule THING
        SpecialPowerTemplate      = SpecialAbilityBerserkerLightTorch
        FlagsUsedForToggle        = WEAPONSET_TOGGLE_1
        ToggleOnAttributeModifier = ZwergenSchlachterModifier
    End

    CommandSet = DwarvenIronBreakerCommandSet

    Behavior = ObjectCreationUpgrade ModuleTag_MithrilMailPalantirFix
        TriggeredBy  = Upgrade_TechnologyDwarvenMithrilMail
        GrantUpgrade = Upgrade_HeavyArmor
    End

    Behavior = CommandSetUpgrade ModuleTag_MithrilCommandSet
        TriggeredBy       = Upgrade_TechnologyDwarvenMithrilMail
        CommandSet        = DwarvenIronBreakerCommandSet_Mithril
    End


    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_KnifeEnabler
        SpecialPowerTemplate    = SpecialAbilityGimliHeroMode
        TriggeredBy             = Upgrade_ObjectLevel2
    End

    Behavior = WeaponModeSpecialPowerUpdate ModuleTag_KnifeFighterPowerUpdate
        SpecialPowerTemplate    = SpecialAbilityGimliHeroMode
        Duration                = 20000
        AttributeModifier       = SchlachterSlayer
        LockWeaponSlot          = SECONDARY
        StartsPaused            = Yes
    End


    Behavior = SpecialPowerModule ModuleTag_ZealotBoomAxeStarter
        SpecialPowerTemplate        = SpecialAbilityZealotBoomAxe
        UpdateModuleStartsAttack    = Yes
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_ZealotBoomAxeWeaponFireUpdate
        SpecialPowerTemplate        = SpecialAbilityZealotBoomAxe



        WhichSpecialWeapon        = 1

        PackTime            = 2500
        StartAbilityRange        = 200

        SpecialWeapon            = DwarvenZealotBoomAxeRangeFinder
        ApproachUntilMembersInRange    = Yes
        TriggerSound            = DwarfZerkVoiceLeap
    End

	Behavior = AttributeModifierUpgrade ModuleTag_TurmschildBonus
        TriggeredBy       = Upgrade_DwarvenMasterAxes
        AttributeModifier = IronHillsTurmschildBonus
    End








	Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality5
        TriggeredBy   = Upgrade_DwarvenMasterAxes
    End
	
 

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality16
        TriggeredBy = Upgrade_LastStandZwerge
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality17
        TriggeredBy        = Upgrade_HeavyArmor
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality18
        TriggeredBy        = Upgrade_ForgedBlades
    End





    Behavior = AISpecialPowerUpdate DwarvenGuardianHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Behavior = AISpecialPowerUpdate KnifeFighterAI
        CommandButtonName = Command_SpecialAbilitySchlachtergang
        SpecialPowerAIType = AI_SPECIAL_POWER_BASIC_SELF_BUFF
    End


    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTraining
        LevelsToGain = 1
        LevelCap = 2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality1
        TriggeredBy = Upgrade_DwarvenSiegeHammer
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_ForgedBlades
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality3
        TriggeredBy = Upgrade_DwarvenMithrilMail
    End


    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 20.0
    GeometryHeight = 20.0
    GeometryIsSmall = No



    AutoResolveUnitType = AutoResolveUnit_Soldier
    AutoResolveCombatChain = AutoResolve_SoldierCombatChain

    AutoResolveBody = AutoResolve_DwarvenGuardianHordeBody


End



Object DwarvenGardeHorde


    ButtonImage       = HSDwarvenGarde
    SelectPortrait    = UPDwarvenGarde

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER EMOTION_TERROR EMOTION_LOOK_TO_SKY SELECTED
        DefaultModelConditionState
            Model = None
        End

        ModelConditionState = HORDE_EMPTY
            Model = None
        End

        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkEUDFG
        End
    End

    Side = Dwarves
    EditorSorting = UNIT
    EmotionRange = 240
    DisplayName = OBJECT:HordeDwarvenGarde
    DisplayNameStrategic = CONTROLBAR:LW_Unit_DwarvenGardeHorde
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_HordeDwarvenGarde

    WeaponSet
        Conditions            = None
        Weapon                = PRIMARY    NormalMeleeHordeRangefinder
        Weapon                = TERTIARY   NormalMeleeHordeRangefinder
        AutoChooseSources     = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
        AutoChooseSources     = TERTIARY FROM_PLAYER FROM_SCRIPT
        ShareWeaponReloadTime = Yes
    End




    #include "..\..\..\includes\StandardHordeEvaEvents.inc"
    #include "..\..\..\includes\DwarvenRunesUnits.inc"

    UnitSpecificSounds
        VoiceDesperateAttack  = GondorSoldierVoiceDesperateCharge
    End

    BuildCost = 1600
    BuildTime = ELITE_BUILDTIME
    VisionRange = 200
    ShroudClearingRange = 250
    VisionSide = 50%
    VisionRear = 25%

    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = 200
    VisionBonusPercentPerFoot = 1.0%
    MaxSimultaneousOfType        = 3


    FormationWidth = 1
    FormationDepth = 1

    CrushableLevel = 1

    TransportSlotCount = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE MELEE_HORDE NOTIFY_OF_PREATTACK LARGE_RECTANGLE_PATHFIND ARMY_SUMMARY

    ThreatLevel = DWARVEN_GUARDIAN_HORDE_THREAT
    ThreatBreakdown DwarvenGuardianHorde_DetailedThreat
        AIKindOf = INFANTRY
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = FighterHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle        = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate            = 500
        MaxCowerTime                = 5000
        MinCowerTime                = 3000

        CanAttackWhileContained            = Yes
        AILuaEventsList                = InfantryFunctions
        AttackPriority                = AttackPriority_Infantry
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained            =
        InitialPayload                = DwarvenGarde 4
        Slots                    = 4
        PassengerFilter                = NONE +INFANTRY
        ShowPips                = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset = X:0 Y:0

        MeleeBehavior = Amoeba
        End

        RankInfo = RankNumber:1 UnitType:DwarvenGarde Position:X:0 Y:10        Position:X:0 Y:-10        Position:X:0 Y:-30        Position:X:0 Y:30

        RanksToReleaseWhenAttacking        = 1
        AlternateFormation = DwarvenGardeHordeAlternativ
        MeleeAttackLeashDistance     = 50
        BackUpMinDelayTime           = 1
        BackUpMaxDelayTime           = 3000
        BackUpMinDistance            = 1
        BackUpMaxDistance            = 3
        BackupPercentage             = 80%
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

    Behavior = CommandButtonHuntUpdate ModuleTag_CommandButtonHuntUpdate
    End

    Behavior = HordeNotifyTargetsOfImminentProbableCrushingUpdate ModuleTag_NotifyCrushScan
        ScanWidth = 60.0
    End

       Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded        =    NONE
         AfraidOf            =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf            =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
         PointAt                =    EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance        =    150
        FearScanDistance        =    INFANTRY_FEAR_SCAN_RADIUS

        AddEmotion            =    Terror_Base
        AddEmotion            =    Doom_Base
        AddEmotion            =       BraceForBeingCrushed_Base
        AddEmotion            =    UncontrollableFear_Base
        AddEmotion            =    FearIdle_Base
        AddEmotion            =    FearBusy_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
         AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    HeroCheerIdle_Base
        AddEmotion            =    HeroCheerBusy_Base
        AddEmotion            =    Alert_Base
        AddEmotion            =       CheerForAboutToCrush_Base
    End

    LocomotorSet
        Locomotor     = NormalChargeMeleeHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_FOOT_SLOW_HORDE_SPEED
    End

    LocomotorSet
        Locomotor     = ScaredMeleeHordeLocomotor
        Condition     = SET_SCARED
        Speed         = NORMAL_FOOT_SLOW_HORDE_SPEED
    End


    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End


    CommandSet = DwarvenGardeHordeCommandSet




    Behavior = AutoHealBehavior ModuleTag_HearthHeal
        StartsActive              = No
        HealOnlyIfNotInCombat     = Yes
        HealOnlyIfNotUnderAttack  = Yes
        TriggeredBy               = Upgrade_MiniHordeLvl2
        HealingAmount             = 30
        Radius                    = 100
        StartHealingDelay         = 7500
        HealingDelay              = 5000
        UnitHealPulseFX           = FX_SpellHealUnitHealBuff
        NonStackable              = Yes
        RespawnNearbyHordeMembers = Yes
        RespawnFXList             = FX_BannerCarrierSpawnUnit
        RespawnMinimumDelay       = 200
    End


    Behavior = SpecialPowerModule ModuleTag_LeadershipUpdate
        SpecialPowerTemplate     = SpecialAbilityFakeLeadership
        UpdateModuleStartsAttack = Yes
        StartsPaused             = No
    End

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_Leadership
        SpecialPowerTemplate     = SpecialAbilityFakeLeadership
        TriggeredBy              = Upgrade_Level_1
    End




    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_KnifeEnabler
        SpecialPowerTemplate    = SpecialAbilityGimliHeroMode
        TriggeredBy             = Upgrade_MiniHordeLvl2
    End

    Behavior = WeaponModeSpecialPowerUpdate ModuleTag_KnifeFighterPowerUpdate
        SpecialPowerTemplate    = SpecialAbilityGimliHeroMode
        Duration                = 30000
        AttributeModifier       = DwarvenGardeInvulnerable


        StartsPaused            = Yes

    End


    Behavior = CommandSetUpgrade ModuleTag_CommandSet1
        TriggeredBy       = Upgrade_SubFactionErebor
        CommandSet        = DwarvenGardeHordeCommandSet_Erebor
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSet2
        TriggeredBy       = Upgrade_SubFactionIronHills
        CommandSet        = DwarvenGardeHordeCommandSet_Eisenberge
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSet3
        TriggeredBy       = Upgrade_SubFactionEredLuin
        CommandSet        = DwarvenGardeHordeCommandSet_EredLuin
    End







    Behavior = AISpecialPowerUpdate DwarvenGuardianHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Behavior = AISpecialPowerUpdate GimliLeapAttackAI
        CommandButtonName = Command_RohanGimliLeap
        SpecialPowerAIType = AI_SPECIAL_POWER_RANGED_AOE_ATTACK
        SpecialPowerRadius = 100
    End


    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 20.0
    GeometryHeight = 20.0
    GeometryIsSmall = No



    AutoResolveUnitType = AutoResolveUnit_Soldier
    AutoResolveCombatChain = AutoResolve_SoldierCombatChain

    AutoResolveBody = AutoResolve_DwarvenGuardianHordeBody


End



ChildObject DwarvenGardeHordeAlternativ DwarvenGardeHorde

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained          =
        InitialPayload                   = DwarvenGarde 4
        Slots                            = 4
        PassengerFilter                  = NONE +INFANTRY
        ShowPips                         = No
        ThisFormationIsTheMainFormation  = No
        AttributeModifiers               = DwarvenGardeFormation
        RandomOffset                     = X:0 Y:0
        MeleeBehavior = Amoeba
        End

        RankInfo = RankNumber:1 UnitType:DwarvenGarde Position:X:0 Y:15        Position:X:10 Y:-15        Position:X:0 Y:-45        Position:X:10 Y:45

        RanksToReleaseWhenAttacking = 1

        AlternateFormation = DwarvenGardeHorde
        MeleeAttackLeashDistance = 1
        BackUpMinDelayTime         = 1
        BackUpMaxDelayTime         = 3000
        BackUpMinDistance         = 1
        BackUpMaxDistance         = 3
        BackupPercentage         = 80%
    End
End

Object DwarvenDaleFighterHorde


    SelectPortrait                        =    UPThalSword
    ButtonImage            =    HSThalSword

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER EMOTION_TERROR EMOTION_LOOK_TO_SKY EMOTION_TAUNTING EMOTION_POINTING SELECTED
        DefaultModelConditionState
            Model = None
        End

        ModelConditionState = HORDE_EMPTY
            Model = None
        End

        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkGUSol
        End
    End

    Side = Dwarves
    EditorSorting = UNIT
    EmotionRange = 240
    DisplayName = OBJECT:DwarvenDaleFighterHorde
    DisplayNameStrategic = CONTROLBAR:LW_Unit_DwarvenDaleFighterHorde
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_DwarvenDaleFighterHorde

    WeaponSet
        Conditions = None
        Weapon = PRIMARY    NormalMeleeHordeRangefinder
    End




    #include "..\..\..\includes\StandardHordeEvaEvents.inc"
    #include "..\..\..\includes\DwarvenRunesUnits.inc"

    BuildCost = 200
    BuildTime = WEAK_BUILDTIME
    VisionRange = 200
    ShroudClearingRange = 300
    VisionSide = 50%
    VisionRear = 25%
    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = 200
    VisionBonusPercentPerFoot = 1.0%
    CommandPoints = 30

    FormationWidth = 2
    FormationDepth = 1

     CrushableLevel = 0
    CrusherLevel = 0

    TransportSlotCount = TRANSPORTSLOTCOUNT_UNIT
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE MELEE_HORDE NOTIFY_OF_PREATTACK ARMY_SUMMARY LARGE_RECTANGLE_PATHFIND

    ThreatLevel = DWARVEN_MENOFDALE_HORDE_THREAT
    ThreatBreakdown GondorFighterHorde_DetailedThreat
        AIKindOf = INFANTRY
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = FighterHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle    = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate            = 500
        MaxCowerTime                = 5000
        MinCowerTime                = 3000
        AILuaEventsList                = InfantryFunctions
        AttackPriority                = AttackPriority_Infantry
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload = DwarvenDaleFighter 15
        Slots = 15
        PassengerFilter    = NONE +INFANTRY
        ShowPips = No
        ThisFormationIsTheMainFormation = Yes
        MeleeBehavior = Amoeba
        End


        BannerCarriersAllowed    = ThalBanner
        BannerCarrierPosition    = UnitType:DwarvenDaleFighter    Pos:X:70.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:DwarvenDaleFighter Position:X:50 Y:0            Position:X:50 Y:20                Position:X:50 Y:-20                Position:X:50 Y:40                Position:X:50 Y:-40
        RankInfo = RankNumber:2 UnitType:DwarvenDaleFighter Position:X:30 Y:0            Position:X:30 Y:20                Position:X:30 Y:-20                Position:X:30 Y:40                Position:X:30 Y:-40
        RankInfo = RankNumber:3 UnitType:DwarvenDaleFighter Position:X:10 Y:0            Position:X:10 Y:20                Position:X:10 Y:-20                Position:X:10 Y:40                Position:X:10 Y:-40

        RanksToReleaseWhenAttacking = 1 2 3

        MeleeAttackLeashDistance = 1
        BackUpMinDelayTime         = 1
        BackUpMaxDelayTime         = 3000
        BackUpMinDistance         = 1
        BackUpMaxDistance         = 3
        BackupPercentage         = 80%
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

    Behavior = CommandButtonHuntUpdate ModuleTag_CommandButtonHuntUpdate
    End

     Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded        =    NONE
        AfraidOf            =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf            =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
         PointAt                =    EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance        =    150
        FearScanDistance        =    CAVALRY_FEAR_SCAN_RADIUS


        AddEmotion            =    Terror_Base
        AddEmotion            =    Doom_Base



        AddEmotion            =   BraceForBeingCrushed_Base

        AddEmotion            =    UncontrollableFear_Base



        AddEmotion            =    FearIdle_Base



        AddEmotion            =    FearBusy_Base



        AddEmotion            =    Point_Base




        AddEmotion            =    Taunt_Base



         AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    HeroCheerIdle_Base
        AddEmotion            =    HeroCheerBusy_Base
        AddEmotion            =    Alert_Base
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End

    LocomotorSet
        Locomotor     = NormalRangedHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_FOOT_FAST_HORDE_SPEED
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTraining
        LevelsToGain = 1
        LevelCap = 2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality
        TriggeredBy = Upgrade_HeavyArmor
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_ForgedBlades
    End







    Behavior = AISpecialPowerUpdate GondorFighterHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    CommandSet = DwarvenDaleFighterHordeCommandSet

    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 45.0
    GeometryHeight = 20.0
    GeometryIsSmall = No

    AutoResolveUnitType = AutoResolveUnit_Archer
    AutoResolveCombatChain = AutoResolve_ArcherCombatChain

    AutoResolveBody = AutoResolve_DwarvenMenOfDaleHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_DwarvenMenOfDaleHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_DwarvenMenOfDaleArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_GondorSoldierUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_GondorSoldierWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTraining Upgrade_ForgedBlades Upgrade_HeavyArmor
End



Object ThalEliteHorde


    SelectPortrait         = UPThalElite
    ButtonImage            = HSThalElite

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR EMOTION_LOOK_TO_SKY EMOTION_TAUNTING
        DefaultModelConditionState
            Model = None
        End
        ModelConditionState = HORDE_EMPTY
            Model = None
        End

        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkGURan
        End
    End

    Side = Dwarves
    EditorSorting = UNIT
    EmotionRange = 240
    DisplayName = OBJECT:HordeThalElite
    DisplayNameStrategic = CONTROLBAR:LW_Unit_ThalEliteHorde
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_GondorRangerHorde

    WeaponSet
        Conditions = None
        Weapon = PRIMARY    GondorRangerMissileHordeRangefinder
        Weapon = TERTIARY   GondorRangerMissileHordeRangefinderBombard
        AutoChooseSources = TERTIARY FROM_PLAYER FROM_SCRIPT
    End




    #include "..\..\..\includes\StandardHordeEvaEvents.inc"
    #include "..\..\..\includes\DwarvenRunesUnits.inc"


    BuildCost         = 900
    BuildTime         = STRONG_BUILDTIME
    VisionRange         = 380
    ShroudClearingRange     = 420
    VisionSide         = 50%
    VisionRear         = 25%
    MaxVisionBonusPercent     = 300%
    VisionBonusTestRadius     = 200
    VisionBonusPercentPerFoot = 1.0%
    CommandPoints         = THAL_ELITE_COMMANDPOINTS_HORDE

     CrushableLevel = 0
    CrusherLevel = 0
    UseCrushAttack = No

    FormationWidth = 2
    FormationDepth = 1

    TransportSlotCount = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE ARCHER ARMY_SUMMARY LARGE_RECTANGLE_PATHFIND

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    ThreatLevel = GONDOR_RANGER_HORDE_THREAT
    ThreatBreakdown GondorRangerHorde_DetailedThreat
        AIKindOf = ARCHER
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = ArcherHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle = Yes ATTACK_BUILDINGS STEALTHED
        MoodAttackCheckRate        = 500
        MaxCowerTime                =    5000
        MinCowerTime                =    3000
        CanAttackWhileContained    = Yes
        AILuaEventsList                = InfantryFunctions
        AttackPriority                =     AttackPriority_Archer
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload = ThalElite 10
        Slots = 10
        PassengerFilter = NONE +INFANTRY
        ShowPips = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset=X:4 Y:4
        MeleeBehavior = Amoeba
        End


        BannerCarriersAllowed    = ThalBanner
        BannerCarrierPosition    = UnitType:ThalElite        Pos:X:70.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:ThalElite Position:X:50 Y:0        Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:50 Y:40        Position:X:50 Y:-40
        RankInfo = RankNumber:2 UnitType:ThalElite Position:X:30 Y:0 Leader 1 0    Position:X:30 Y:20 Leader 1 1    Position:X:30 Y:-20 Leader 1 2    Position:X:30 Y:40 Leader 1 3    Position:X:30 Y:-40 Leader 1 4

        RanksToReleaseWhenAttacking = 1 2

        MeleeAttackLeashDistance = 1
        BackUpMinDelayTime         = 1
        BackUpMaxDelayTime         = 3000
        BackUpMinDistance         = 1
        BackUpMaxDistance         = 3
        BackupPercentage         = 80%
    End

    #include "..\..\..\includes\DefaultInvisibilityUpdate.inc"

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

       Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded        =    NONE
         AfraidOf                    =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf                =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
         PointAt                        =    EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance        =    150
        FearScanDistance        =    ARCHER_FEAR_SCAN_RADIUS

        AddEmotion    =    Terror_Base
        AddEmotion    =    Doom_Base
        AddEmotion    =   BraceForBeingCrushed_Base
        AddEmotion    =    UncontrollableFear_Base
        AddEmotion    =    FearIdle_Base
        AddEmotion    =    FearBusy_Base
        AddEmotion    =    Point_Base






         AddEmotion    =    CheerIdle_Base
        AddEmotion    =    CheerBusy_Base
        AddEmotion    =    HeroCheerIdle_Base
        AddEmotion    =    HeroCheerBusy_Base
        AddEmotion    =    Alert_Base
    End

    LocomotorSet
        Locomotor     = NormalRangedHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_FOOT_FAST_HORDE_SPEED
    End

    CommandSet = ThalEliteHordeCommandSet

    Behavior = OCLSpecialPower ModuleTag_ArrowVolleyEvil
        SpecialPowerTemplate        = SpecialAbilityMenLongShot
        OCL                            = OCL_LongShotAbility
        CreateLocation                = CREATE_AT_LOCATION
        UpdateModuleStartsAttack    = No



        SetModelCondition            = ModelConditionState:USER_1
        SetModelConditionTime        = 5.0
        DisableDuringAnimDuration    = Yes
    End
    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_FireballUpdate
        SpecialPowerTemplate    = SpecialAbilityMenLongShot
        PackTime                = 5000
        MustFinishAbility        = Yes
        SpecialWeapon            = MenLongShotWeapon
        NeedLivingTargets        = No



        TriggerSound            = RangerVoiceLongShot
        ApproachRequiresLOS        = No
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTraining
        LevelsToGain = 1
        LevelCap = 2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality
        TriggeredBy = Upgrade_FireArrows
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_HeavyArmor
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End





    Behavior = AISpecialPowerUpdate GondorRangerHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End


    Geometry = BOX
    GeometryMajorRadius = 20.0
    GeometryMinorRadius = 60.0
    GeometryHeight = 10.0
    GeometryIsSmall = No



    AutoResolveUnitType = AutoResolveUnit_Archer
    AutoResolveCombatChain = AutoResolve_ArcherCombatChain

    AutoResolveBody = AutoResolve_GondorRangerHordeBody

    AutoResolveArmor
        Armor = AutoResolve_GondorRangerArmor
    End


    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTraining Upgrade_HeavyArmor
End



ChildObject ThalEliteHorde_Summoned ThalEliteHorde
    IsTrainable = No
    CommandPoints = 0
    CommandSet = ThalEliteHorde_SummonedCommandSet
    EquivalentTo = ThalEliteHorde

    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE ARCHER SUMMONED

    Behavior = LifetimeUpdate ModuleTag_LifetimeUpdate

        MinLifetime        = 100000
        MaxLifetime        = 100000
        DeathType        = FADED
    End
    Behavior = HordeContain ModuleTag_HordeContain
        ObjectStatusOfContained =
        InitialPayload = ThalElite_Summoned 10
        Slots = 10
        PassengerFilter = NONE +INFANTRY
        ShowPips = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset = X:1 Y:1


        RankInfo = RankNumber:1 UnitType:ThalElite_Summoned Position:X:0 Y:0    Position:X:0 Y:25    Position:X:0 Y:-25    Position:X:0 Y:50    Position:X:0 Y:-50
        RankInfo = RankNumber:2 UnitType:ThalElite_Summoned Position:X:20 Y:0    Position:X:15 Y:25    Position:X:20 Y:-25    Position:X:20 Y:50    Position:X:20 Y:-50

        RanksToReleaseWhenAttacking = 1 2
        MeleeAttackLeashDistance = 25
    End

    GeometryMinorRadius = 40.0
End


Object DwarvenMenOfDaleHordeMod

    SelectPortrait         = UPDaleBow
    ButtonImage            = HSDaleBow

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR
        DefaultModelConditionState
            Model = None
        End
        ModelConditionState = HORDE_EMPTY
            Model = None
        End

        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkRUYeo
        End
    End

    Side = Dwarves
    EditorSorting = UNIT
    EmotionRange = 240
    DisplayName = OBJECT:HordeDaleDrachentoter
    DisplayNameStrategic = CONTROLBAR:LW_Unit_HordeDaleDrachentoter
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_HordeDaleDrachentoter

    WeaponSet
        Conditions = None
        Weapon = PRIMARY    NormalMissileHordeRangefinder
        Weapon = TERTIARY   NormalMissileHordeRangefinderBombard
        AutoChooseSources = TERTIARY FROM_PLAYER FROM_SCRIPT
    End

    CommandSet =  DwarvenMenOfDaleHordeCommandSetMod




    #include "..\..\..\includes\StandardHordeEvaEvents.inc"
    #include "..\..\..\includes\DwarvenRunesUnits.inc"


     CrushableLevel = 0
    CrusherLevel = 0
    UseCrushAttack = No

    BuildCost = 900
    BuildTime = MEDIUM_BUILDTIME

    VisionRange = 350
    ShroudClearingRange = 400

    VisionSide = 50%
    VisionRear = 25%

    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = 200
    VisionBonusPercentPerFoot = 1.0%

    CommandPoints = 50

    FormationWidth = 2
    FormationDepth = 1

    TransportSlotCount = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE ARCHER ARMY_SUMMARY LARGE_RECTANGLE_PATHFIND

    ThreatLevel = DWARVEN_MENOFDALE_HORDE_THREAT
    ThreatBreakdown DwarvenMenOfDaleHorde_DetailedThreat
        AIKindOf = ARCHER
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    Behavior = SpecialPowerModule ModuleTag_BlackArrowsStarter
        SpecialPowerTemplate        = SpecialAbilityBlackArrows
        UpdateModuleStartsAttack    = Yes
    End
    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_BlackArrowsWeaponFireUpdate
        SpecialPowerTemplate        = SpecialAbilityBlackArrows




        PackTime            = 2000
        StartAbilityRange        = #SUBTRACT( DWARVEN_MENOFDALE_RANGE 100 )
        SpecialWeapon            = DwarvenMenOfDaleBlackArrowsRangeFinder
        ApproachUntilMembersInRange    = Yes
        TriggerSound            = YeomanArcherVoiceAttackCharge
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = ArcherHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle    = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate        = 500
        MaxCowerTime            = 5000
        MinCowerTime            = 3000
        CanAttackWhileContained        = Yes
        AILuaEventsList                = InfantryFunctions
        AttackPriority                = AttackPriority_Archer
    End

    Behavior = HordeContain ModuleTag_HordeContain
        ObjectStatusOfContained =
        InitialPayload     = DwarvenMenOfDale 10
        Slots         = 10
        PassengerFilter = NONE +INFANTRY
        ShowPips     = No
        ThisFormationIsTheMainFormation = Yes
        MeleeBehavior     = Amoeba
        End

        BannerCarriersAllowed    = ThalBanner
        BannerCarrierPosition    = UnitType:DwarvenMenOfDale        Pos:X:40.0 Y:0.0

        RandomOffset = X:0 Y:-10

        RankInfo = RankNumber:1 UnitType:DwarvenMenOfDale Position:X:0 Y:0    Position:X:0 Y:20    Position:X:0 Y:-20    Position:X:0 Y:40    Position:X:0 Y:-40
        RankInfo = RankNumber:2 UnitType:DwarvenMenOfDale Position:X:20 Y:0    Position:X:15 Y:20    Position:X:20 Y:-20    Position:X:20 Y:40    Position:X:20 Y:-40

        RanksToReleaseWhenAttacking = 1 2

        MeleeAttackLeashDistance  = 1
        BackUpMinDelayTime        = 1
        BackUpMaxDelayTime        = 3000
        BackUpMinDistance         = 1
        BackUpMaxDistance         = 3
        BackupPercentage          = 80%
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

     Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay     =    1000
        TauntAndPointExcluded        =    NONE
        AfraidOf                     =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf               =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
        PointAt                      =    EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance             =    150
        FearScanDistance             =    CAVALRY_FEAR_SCAN_RADIUS

        AddEmotion            =    Terror_Base
        AddEmotion            =    Doom_Base
        AddEmotion            =    BraceForBeingCrushed_Base
        AddEmotion            =    UncontrollableFear_Base
        AddEmotion            =    FearIdle_Base
        AddEmotion            =    FearBusy_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
        AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    HeroCheerIdle_Base
        AddEmotion            =    HeroCheerBusy_Base
        AddEmotion            =    Alert_Base
    End

    LocomotorSet
        Locomotor     = NormalRangedHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_FOOT_FAST_HORDE_SPEED
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTraining
        LevelsToGain = 1
        LevelCap = 2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality
        TriggeredBy = Upgrade_FireArrows
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_HeavyArmor
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End





    Behavior = AISpecialPowerUpdate DwarvenMenOfDaleHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End


    Behavior = AISpecialPowerUpdate DwarvenMenOfDaleHordeBlackArrowAI
        CommandButtonName = Command_BlackArrows
        SpecialPowerAIType = AI_SPECIAL_POWER_ENEMY_TYPE_KILLER_RANGED
    End

    Geometry = BOX
    GeometryMajorRadius = 20.0
    GeometryMinorRadius = 60.0
    GeometryHeight = 10.0
    GeometryIsSmall = No



    AutoResolveUnitType = AutoResolveUnit_Archer
    AutoResolveCombatChain = AutoResolve_ArcherCombatChain

    AutoResolveBody = AutoResolve_DwarvenMenOfDaleHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_DwarvenMenOfDaleHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_DwarvenMenOfDaleArmor
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTraining Upgrade_HeavyArmor
End



Object ThalPikeHorde


    SelectPortrait         = UPThalPike
    ButtonImage            = HSThalPike

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR EMOTION_LOOK_TO_SKY
        DefaultModelConditionState
            Model = None
        End
        ModelConditionState = HORDE_EMPTY
            Model = None
        End

        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkGUTow
        End
    End

    Side = Dwarves
    EditorSorting = UNIT
    EmotionRange = 240
    DisplayName = OBJECT:Hordethalpike
    DisplayNameStrategic = CONTROLBAR:LW_Unit_thalpikeHorde
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_ThalPikeEdainHorde

    WeaponSet
        Conditions = None
        Weapon = PRIMARY    TowerGuardHordeRangefinder
    End






    BuildCost             = 300
    BuildTime             = MEDIUM_BUILDTIME
    VisionRange             = 200
    ShroudClearingRange         = 300
    VisionSide             = 50%
    VisionRear             = 25%
    MaxVisionBonusPercent         = 300%
    VisionBonusTestRadius         = 200
    VisionBonusPercentPerFoot     = 1.0%
    CommandPoints             = 30

    CommandSet = DwarvenThalSpeertragerHordeCommandSet

    FormationWidth = 2
    FormationDepth = 1

     CrushableLevel = 0
    CrusherLevel = 0

    TransportSlotCount = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE ARMY_SUMMARY MELEE_HORDE PIKE LARGE_RECTANGLE_PATHFIND
    #include "..\..\..\includes\StandardHordeEvaEvents.inc"
    #include "..\..\..\includes\DwarvenRunesUnits.inc"

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    ThreatLevel = GONDOR_TOWERSHIELDGUARD_HORDE_THREAT
    ThreatBreakdown GondorTowerShieldGuardHorde_DetailedThreat
        AIKindOf = PIKEMAN
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = PikeHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle    =    Yes ATTACK_BUILDINGS
        MoodAttackCheckRate        =    500
        MaxCowerTime            =    5000
        MinCowerTime            =    3000
        AILuaEventsList            =    InfantryFunctions
        AttackPriority            =     AttackPriority_Spearman
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload         = ThalPike GOOD_MEN_GIANT_HORDE_SIZE
        Slots             = 15
        PassengerFilter        = NONE +INFANTRY
        ShowPips         = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset        = X:0 Y:0
        MeleeBehavior = Amoeba
            FacingBonus    = 30.0
            AngleLimitCos    = -0.17
            InnerRange    = 30
            OuterRange    = 80
            OuterRangeBuildings    = 140
        End


        BannerCarriersAllowed    = ThalBanner
        BannerCarrierPosition    = UnitType:ThalPike    Pos:X:70.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:ThalPike Position:X:50 Y:0        Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:50 Y:40        Position:X:50 Y:-40
        RankInfo = RankNumber:2 UnitType:ThalPike Position:X:30 Y:0 Leader 1 0    Position:X:30 Y:20 Leader 1 1    Position:X:30 Y:-20 Leader 1 2    Position:X:30 Y:40 Leader 1 3    Position:X:30 Y:-40 Leader 1 4
        RankInfo = RankNumber:3 UnitType:ThalPike Position:X:10 Y:0 Leader 2 0    Position:X:10 Y:20 Leader 2 1    Position:X:10 Y:-20 Leader 2 2    Position:X:10 Y:40 Leader 2 3    Position:X:10 Y:-40 Leader 2 4

        RanksToReleaseWhenAttacking = 1

        AlternateFormation = ThalPikeHordePorcupine
        MeleeAttackLeashDistance = 1
        BackUpMinDelayTime         = 1
        BackUpMaxDelayTime         = 3000
        BackUpMinDistance         = 1
        BackUpMaxDistance         = 3
        BackupPercentage         = 80%
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

       Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded        =    NONE
         AfraidOf                    =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf                =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
         PointAt                        =    EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance            =    150
        FearScanDistance            =    INFANTRY_FEAR_SCAN_RADIUS

        AddEmotion            =    Terror_Base
        AddEmotion            =    Doom_Base

        AddEmotion            =    UncontrollableFear_Base
        AddEmotion            =    FearIdle_Base
        AddEmotion            =    FearBusy_Base
        AddEmotion            =    Point_Base

        AddEmotion            =    OVERRIDE Taunt_Base

         End

        AddEmotion    =    CheerIdle_Base
        AddEmotion    =    CheerBusy_Base
        AddEmotion    =    HeroCheerIdle_Base
        AddEmotion    =    HeroCheerBusy_Base
        AddEmotion    =    Alert_Base
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End

    LocomotorSet
        Locomotor     = NormalMeleeHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_FOOT_FAST_HORDE_SPEED
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTraining
        LevelsToGain = 1
        LevelCap = 2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality
        TriggeredBy = Upgrade_ForgedBlades
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_HeavyArmor
    End





    Behavior = AISpecialPowerUpdate GondorTowerShieldGuardHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End


    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 45.0
    GeometryHeight = 20.0
    GeometryIsSmall = No



    AutoResolveUnitType = AutoResolveUnit_Pikemen
    AutoResolveCombatChain = AutoResolve_PikemenCombatChain

    AutoResolveBody = AutoResolve_GondorTowerGuardHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_GondorTowerGuardHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_GondorTowerGuardArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_GondorTowerGuardUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_GondorTowerGuardWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTraining Upgrade_ForgedBlades Upgrade_HeavyArmor
End


ChildObject ThalPikeHordePorcupine ThalPikeHorde

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle             = STANDARD_PIKEMAN_FRONTANGLE_FORMATION
        FlankedDelay             = STANDARD_PIKEMAN_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload                    = ThalPike GOOD_MEN_HORDE_SIZE
        Slots                            = 15
        PassengerFilter                    = NONE +INFANTRY
        ShowPips                        = No
        ThisFormationIsTheMainFormation = No
        RandomOffset                    = X:2 Y:1
        RanksToReleaseWhenAttacking        = 0
        RanksToJustFreeWhenAttacking   = 0
        AttributeModifiers                = GondorTowerShieldGuardHordePorcupine
        IsPorcupineFormation            = Yes
        MinimumHordeSize                = 5

        AlternateFormation                = ThalPikeHorde
        VisionRearOverride                = 100%
        VisionSideOverride                = 100%
        NotComboFormation                = Yes

        BannerCarriersAllowed            = ThalBanner
        BannerCarrierPosition            = UnitType:ThalPike    Pos:X:0.0 Y:0.0

        RankInfo    = RankNumber:1 UnitType:ThalPike Position:X:20 Y:0    Position:X:-16.18 Y:11.76        Position:X:6.18 Y:-19.02    Position:X:6.18 Y:19.02    Position:X:-16.18 Y:-11.76    Position:X:36.54 Y:16.27    Position:X:-39.13 Y:8.32    Position:X:26.77 Y:-29.73    Position:X:-4.18 Y:39.78    Position:X:-20 Y:-34.64    Position:X:26.77 Y:29.73    Position:X:-39.13 Y:-8.32    Position:X:36.54 Y:-16.27    Position:X:-20 Y:34.64    Position:X:-4.18 Y:-39.78
    End
End

Object DwarvenKhazadVeteranenHorde

    SelectPortrait     = UPKhazadVeteran
    ButtonImage        = HIKhazadVeteran_Wotr

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER EMOTION_TERROR EMOTION_LOOK_TO_SKY SELECTED
        DefaultModelConditionState
            Model = None
        End

        ModelConditionState = HORDE_EMPTY
            Model = None
        End

        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkEUDFG
        End
    End

    Side = Dwarves
    EditorSorting = UNIT
    EmotionRange = 240
    DisplayName = OBJECT:DwarvenKhazadVeteranenHorde
    DisplayNameStrategic = CONTROLBAR:LW_Unit_DwarvenKhazadVeteranenHorde
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_DwarvenKhazadVeteranenHorde

    WeaponSet
        Conditions            = None
        Weapon                = PRIMARY     NormalMeleeHordeRangefinder
        AutoChooseSources     = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End





    #include "..\..\..\includes\StandardHordeEvaEvents.inc"
    #include "..\..\..\includes\DwarvenRunesUnits.inc"

    UnitSpecificSounds
        VoiceDesperateAttack  = GondorSoldierVoiceDesperateCharge
    End

    MaxSimultaneousOfType        = 3
    BuildCost = VETERANOFKHAZADDUMHORDE_BUILDCOST
    BuildTime = ELITE_BUILDTIME
    VisionRange = 250
    ShroudClearingRange = 300
    VisionSide = 150%
    VisionRear = 25%

    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = 200
    VisionBonusPercentPerFoot = 1.0%
    CommandPoints = 70

    FormationWidth = 1
    FormationDepth = 1

    CrushableLevel = 0

    TransportSlotCount = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE MELEE_HORDE NOTIFY_OF_PREATTACK LARGE_RECTANGLE_PATHFIND ARMY_SUMMARY

    ThreatLevel = 175
    ThreatBreakdown DwarvenGuardianHorde_DetailedThreat
        AIKindOf = INFANTRY
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = FighterHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle  = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate         = 500
        MaxCowerTime                = 5000
        MinCowerTime                = 3000

        CanAttackWhileContained       = Yes
        AILuaEventsList               = InfantryFunctions
        AttackPriority                = AttackPriority_Infantry
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained            =
        InitialPayload                = DwarvenKhazadVeteranen 5
        Slots                    = 5
        PassengerFilter                = NONE +INFANTRY
        ShowPips                = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset = X:0 Y:0

        MeleeBehavior = Amoeba
        End

        RankInfo = RankNumber:1 UnitType:DwarvenKhazadVeteranen Position:X:30 Y:0              Position:X:20 Y:20              Position:X:25 Y:-20              Position:X:34 Y:38              Position:X:31 Y:-41



        RanksToReleaseWhenAttacking        = 1

        MeleeAttackLeashDistance        = 50
        BackUpMinDelayTime            = 1
        BackUpMaxDelayTime            = 3000
        BackUpMinDistance            = 1
        BackUpMaxDistance            = 3
        BackupPercentage            = 80%
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

    Behavior = CommandButtonHuntUpdate ModuleTag_CommandButtonHuntUpdate
    End

    Behavior = HordeNotifyTargetsOfImminentProbableCrushingUpdate ModuleTag_NotifyCrushScan
        ScanWidth = 60.0
    End

       Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded        =    NONE
         AfraidOf            =    EMOTION_AFRAIDOF_OBJECTFILTER_LANCERS
        AlwaysAfraidOf            =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER_LANCERS
         PointAt                =    EMOTION_POINTAT_OBJECTFILTER_LANCERS
        HeroScanDistance        =    150
        FearScanDistance        =    INFANTRY_FEAR_SCAN_RADIUS

        AddEmotion            =    Terror_Base
        AddEmotion            =    Doom_Base
        AddEmotion            =       BraceForBeingCrushed_Base
        AddEmotion            =    UncontrollableFear_Base
        AddEmotion            =    FearIdle_Base
        AddEmotion            =    FearBusy_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
        AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    HeroCheerIdle_Base
        AddEmotion            =    HeroCheerBusy_Base
        AddEmotion            =    Alert_Base
        AddEmotion            =       CheerForAboutToCrush_Base
    End

    LocomotorSet
        Locomotor     = NormalChargeMeleeHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_FOOT_FAST_HORDE_SPEED
    End

    LocomotorSet
        Locomotor     = ScaredMeleeHordeLocomotor
        Condition     = SET_SCARED
        Speed         = NORMAL_FOOT_FAST_HORDE_SPEED
    End


    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End


    CommandSet = DwarvenKhazadVeteranHordeCommandSet




    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_KnifeEnabler
        SpecialPowerTemplate = SpecialAbilityFanaticHeroMode
        TriggeredBy = Upgrade_MiniHordeLvl7
    End

    Behavior = WeaponModeSpecialPowerUpdate ModuleTag_KnifeFighterPowerUpdate
        SpecialPowerTemplate  = SpecialAbilityFanaticHeroMode
        Duration              = 30000
        AttributeModifier     = FanaticDeathWish
        StartsPaused          = Yes
    End



    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_StoneWallEnabler
        SpecialPowerTemplate = SpecialAbilityStoneWall
        TriggeredBy          = Upgrade_MiniHordeLvl2
    End

    Behavior = WeaponModeSpecialPowerUpdate ModuleTag_StoneWallPowerUpdate
        SpecialPowerTemplate = SpecialAbilityStoneWall
        Duration             = 20000
        AttributeModifier    = FanaticStoneWall
        StartsPaused         = Yes
    End












    Behavior = CommandSetUpgrade ModueTag_Waffen
        TriggeredBy       = Upgrade_VeteranAxt Upgrade_VeteranMorgenstern Upgrade_VeteranHammer
        CommandSet        = DwarvenKhazadVeteranHordeSecondCommandSet
    End

    Behavior = CommandSetUpgrade ModueTag_WaffenSecond
        TriggeredBy       = Upgrade_VeteranDoppelaxt Upgrade_VeteranSchild
        CommandSet        = DwarvenKhazadVeteranHordeEndCommandSet
    End



 

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality10
        TriggeredBy   = Upgrade_VeteranAxt
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality11
        TriggeredBy   = Upgrade_VeteranDoppelaxt
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality12
        TriggeredBy   = Upgrade_VeteranSchild
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality13
        TriggeredBy   = Upgrade_VeteranMorgenstern
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality14
        TriggeredBy   =  Upgrade_VeteranHammer
    End


    Behavior = AutoHealBehavior ModuleTag_HearthHeal
        StartsActive               = No
        HealOnlyIfNotInCombat      = Yes
        HealOnlyIfNotUnderAttack   = Yes
        TriggeredBy                = Upgrade_MiniHordeLvl2
        HealingAmount              = 30
        Radius                     = 100
        StartHealingDelay          = 7500
        HealingDelay               = 5000
        UnitHealPulseFX            = FX_SpellHealUnitHealBuff
        NonStackable               = Yes
        RespawnNearbyHordeMembers  = Yes
        RespawnFXList              = FX_BannerCarrierSpawnUnit
        RespawnMinimumDelay        = 200
    End





    Behavior = DoCommandUpgrade Module_DoCommandUpgradeFixDwarvesKhazad
        TriggeredBy                      = Upgrade_ObjectUnderAIControl
        GetUpgradeCommandButtonName      = Command_PurchaseUpgradeDwarvesFixAI
    End

    Behavior = DoCommandUpgrade Module_DoCommandUpgradeFixDwarvesKhazad2
        TriggeredBy                      = Upgrade_ObjectUnderAIControl
        GetUpgradeCommandButtonName      = Command_PurchaseUpgradeDwarvesFixAI2
    End





    Behavior = AISpecialPowerUpdate DwarvenGuardianHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Behavior = AISpecialPowerUpdate KnifeFighterAI
        CommandButtonName = Command_SpecialAbilitySchlachtergang
        SpecialPowerAIType = AI_SPECIAL_POWER_BASIC_SELF_BUFF
    End


    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTraining
        LevelsToGain = 1
        LevelCap = 2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality1
        TriggeredBy = Upgrade_DwarvenSiegeHammer
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_ForgedBlades
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality3
        TriggeredBy = Upgrade_DwarvenMithrilMail
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality16
        TriggeredBy = Upgrade_LastStandZwerge
    End

    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 20.0
    GeometryHeight = 20.0
    GeometryIsSmall = No



    AutoResolveUnitType = AutoResolveUnit_Soldier
    AutoResolveCombatChain = AutoResolve_SoldierCombatChain

    AutoResolveBody                = AutoResolve_EliteLegndaryHordeBody

    AutoResolveWeapon
       Weapon                    = AutoResolve_EliteLegndaryInfantryWeapon
    End

    AutoResolveArmor
        Armor                        = AutoResolve_EliteLegndaryInfantryArmor
    End
End

Object DwarvenAxtschwingerHorde


    ButtonImage        = WOR_DwarvenZerker
    SelectPortrait    = UPDwarvenZerkerPortrait

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER EMOTION_TERROR EMOTION_LOOK_TO_SKY SELECTED
        DefaultModelConditionState
            Model = None
        End

        ModelConditionState = HORDE_EMPTY
            Model = None
        End

        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkEUDFG
        End
    End

    Side = Dwarves
    EditorSorting = UNIT
    EmotionRange = 240
    DisplayName = OBJECT:DwarvenAxtschwingerHorde
    DisplayNameStrategic = CONTROLBAR:LW_Unit_DwarvenAxtschwingerHorde
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_DwarvenAxtschwingerHorde

    WeaponSet
        Conditions            = None
        Weapon                = PRIMARY     NormalMeleeHordeRangefinder
        Weapon                = TERTIARY    DwarvenZealotBoomAxeRangeFinder
        AutoChooseSources     = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
        AutoChooseSources     = TERTIARY FROM_PLAYER FROM_SCRIPT
        ShareWeaponReloadTime = Yes
    End





    #include "..\..\..\includes\StandardHordeEvaEvents.inc"
    #include "..\..\..\includes\DwarvenRunesUnits.inc"

    UnitSpecificSounds
        VoiceDesperateAttack  = GondorSoldierVoiceDesperateCharge
    End

    BuildCost = 650
    BuildTime = MEDIUM_BUILDTIME
    VisionRange = 250
    ShroudClearingRange = 300
    VisionSide = 50%
    VisionRear = 25%

    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = 200
    VisionBonusPercentPerFoot = 1.0%
	MaxSimultaneousOfType        = 3
    CommandPoints = 35

    FormationWidth = 7
    FormationDepth = 4

    CrushableLevel = 1
	CrusherLevel = 2

    CrushOnlyWhileCharging = Yes

    MinCrushVelocityPercent = MINCRUSHVELOCITYPERCENT_STANDARD
    CrushDecelerationPercent = CRUSHDECELERATIONPERCENT_STANDARD

    CrushKnockback = 40
    CrushZFactor = 1.0

    TransportSlotCount = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE MELEE_HORDE NOTIFY_OF_PREATTACK LARGE_RECTANGLE_PATHFIND

    ThreatLevel = DWARVEN_GUARDIAN_HORDE_THREAT
    ThreatBreakdown DwarvenGuardianHorde_DetailedThreat
        AIKindOf = INFANTRY
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = FighterHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle        = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate            = 500
        MaxCowerTime                = 5000
        MinCowerTime                = 3000

        CanAttackWhileContained            = Yes
        AILuaEventsList                = InfantryFunctions
        AttackPriority                = AttackPriority_Infantry
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained            =
        InitialPayload                = DwarvenAxtschwinger 7
        Slots                    = 7
        PassengerFilter                = NONE +INFANTRY
        ShowPips                = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset = X:0 Y:0

        MeleeBehavior = Amoeba
        End



        BannerCarriersAllowed    = DwarvenAxtschwingerBanner
        BannerCarrierPosition    = UnitType:DwarvenAxtschwinger    Pos:X:-20.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:DwarvenAxtschwinger Position:X:30 Y:30 			Position:X:30 Y:-30              
        RankInfo = RankNumber:2 UnitType:DwarvenAxtschwinger Position:X:20 Y:20    			Position:X:20 Y:-20    
		RankInfo = RankNumber:3 UnitType:DwarvenAxtschwinger Position:X:10 Y:10				Position:X:10 Y:-10				
		RankInfo = RankNumber:4 UnitType:DwarvenAxtschwinger Position:X:0 Y:0
		
        RanksToReleaseWhenAttacking        = 1 2 3 4

        MeleeAttackLeashDistance        = 50
        BackUpMinDelayTime            = 1
        BackUpMaxDelayTime            = 3000
        BackUpMinDistance            = 1
        BackUpMaxDistance            = 3
        BackupPercentage            = 80%
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

    Behavior = CommandButtonHuntUpdate ModuleTag_CommandButtonHuntUpdate
    End


    Behavior = HordeNotifyTargetsOfImminentProbableCrushingUpdate ModuleTag_NotifyCrushScan
        ScanWidth = 60.0
    End

       Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded        =    NONE
         AfraidOf            =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf            =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
         PointAt                =    EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance        =    150
        FearScanDistance        =    INFANTRY_FEAR_SCAN_RADIUS

        AddEmotion            =    Terror_Base
        AddEmotion            =    Doom_Base
        AddEmotion            =       BraceForBeingCrushed_Base
        AddEmotion            =    UncontrollableFear_Base
        AddEmotion            =    FearIdle_Base
        AddEmotion            =    FearBusy_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
         AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    HeroCheerIdle_Base
        AddEmotion            =    HeroCheerBusy_Base
        AddEmotion            =    Alert_Base
        AddEmotion            =       CheerForAboutToCrush_Base
    End

    LocomotorSet
        Locomotor     = NormalChargeMeleeHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_FOOT_FAST_HORDE_SPEED
    End

    LocomotorSet
        Locomotor     = ScaredMeleeHordeLocomotor
        Condition     = SET_SCARED
        Speed         = NORMAL_FOOT_FAST_HORDE_SPEED
    End


    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End

    CommandSet = DwarvenAxtschwingerHordeCommandSet

    Behavior = CommandSetUpgrade ModuleTag_MithrilCommandSet
        TriggeredBy       = Upgrade_DwarvenMithrilMail
        CommandSet        = DwarvenAxtschwingerHordeCommandSet_Mithril
    End


	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_DefenderEnabler
        SpecialPowerTemplate       = SpecialAbilityStaunchDefender
        TriggeredBy                = Upgrade_ObjectLevel10
    End

    Behavior = OCLSpecialPower ModuleTag_OCLSpawnTornado
        StartsPaused             = Yes
        SpecialPowerTemplate     = SpecialAbilityStaunchDefender
        OCL                      = OCL_ZerkerTornadoObject
        CreateLocation           = CREATE_AT_LOCATION
    End
	
	
	
    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_KnifeEnabler
        SpecialPowerTemplate = SpecialAbilityGimliHeroMode
        TriggeredBy = Upgrade_ObjectLevel7
    End

    Behavior = WeaponModeSpecialPowerUpdate ModuleTag_KnifeFighterPowerUpdate
        SpecialPowerTemplate    = SpecialAbilityGimliHeroMode
        Duration                = 30000
        AttributeModifier        = ZerkerSlayer
        WeaponSetFlags            = WEAPONSET_TOGGLE_1
        StartsPaused            = Yes
    End



    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_SteinschlagEnabler
        SpecialPowerTemplate = SpecialAbilityZerkerRage
        TriggeredBy = Upgrade_ObjectLevel3
	End
    Behavior = SpecialPowerModule ModuleTag_SteinschlagStarters
        SpecialPowerTemplate        = SpecialAbilityZerkerRage
        UpdateModuleStartsAttack    = Yes
        StartsPaused                = Yes
	End
    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_SteinschlagWeaponFireUpdates
        SpecialPowerTemplate          = SpecialAbilityZerkerRage
        SkipContinue            = Yes 
        UnpackTime            = 1000
        PreparationTime            = 0
        PackTime            = 1000
        AwardXPForTriggering      = 0
        StartAbilityRange         = 40.0
        ApproachRequiresLOS       = Yes
        SpecialWeapon             = WulfAxeSwing
	End



    Behavior = SpecialPowerModule ModuleTag_ZealotBoomAxeStarter
        SpecialPowerTemplate        = SpecialAbilityZealotBoomAxe
        UpdateModuleStartsAttack    = Yes
    End
    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_ZealotBoomAxeWeaponFireUpdate
        SpecialPowerTemplate        = SpecialAbilityZealotBoomAxe
        WhichSpecialWeapon        = 1
        PackTime            = 2500
        StartAbilityRange        = 200
        SpecialWeapon            = DwarvenZealotBoomAxeRangeFinder
        ApproachUntilMembersInRange    = Yes
        TriggerSound            = DwarfZerkVoiceLeap
    End
	Behavior = AutoAbilityBehavior ModuleTag_AutoAbilityZealotBoomAxe
        SpecialAbility          = SpecialAbilityZealotBoomAxe
        MaxScanRange            = 150
        Query                   = 15 ANY ENEMIES +INFANTRY
		Query					= 1 ANY ENEMIES +HERO
    End







    Behavior = AISpecialPowerUpdate DwarvenGuardianHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Behavior = AISpecialPowerUpdate KnifeFighterAI
        CommandButtonName = Command_SpecialAbilitySchlachtergang
        SpecialPowerAIType = AI_SPECIAL_POWER_BASIC_SELF_BUFF
    End


    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTraining
        LevelsToGain = 1
        LevelCap = 2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality1
        TriggeredBy = Upgrade_DwarvenSiegeHammer
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_ForgedBlades
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality3
        TriggeredBy = Upgrade_DwarvenMithrilMail
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality16
        TriggeredBy = Upgrade_LastStandZwerge
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality17
        TriggeredBy = Upgrade_HeavyArmor
    End


    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 20.0
    GeometryHeight = 20.0
    GeometryIsSmall = No



    AutoResolveUnitType = AutoResolveUnit_Soldier
    AutoResolveCombatChain = AutoResolve_SoldierCombatChain

    AutoResolveBody = AutoResolve_DwarvenGuardianHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_DwarvenGuardianHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_DwarvenGuardianArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_DwarvenGuardianUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_DwarvenGuardianWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTraining Upgrade_ForgedBlades Upgrade_HeavyArmor
End


Object DwarvenGuardianEredMithrinHorde

    ButtonImage       = HSMithrinGuardian
    SelectPortrait    = UPMithrinGuardian

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER EMOTION_TERROR EMOTION_LOOK_TO_SKY SELECTED
        DefaultModelConditionState
            Model = None
        End

        ModelConditionState = HORDE_EMPTY
            Model = None
        End

        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkEUDFG
        End
    End

    Side = Dwarves
    EditorSorting = UNIT
    EmotionRange = 240
    DisplayName = OBJECT:HordeDwarvenGuardianEredMithrin
    DisplayNameStrategic = CONTROLBAR:LW_Unit_DwarvenGuardianEredMithrin
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_DwarvenGuardianEredMithrin

    WeaponSet
        Conditions = None
        Weapon = PRIMARY    NormalMeleeHordeRangefinder
    End



    #include "..\..\..\includes\StandardHordeEvaEvents.inc"
    #include "..\..\..\includes\DwarvenRunesUnits.inc"

    UnitSpecificSounds
        VoiceDesperateAttack  = GondorSoldierVoiceDesperateCharge
    End

    BuildCost = 500
    BuildTime = MEDIUM_BUILDTIME

    ShroudClearingRange = 450
    VisionRange = 200
    VisionSide = 50%
    VisionRear = 25%
    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = 200
    VisionBonusPercentPerFoot = 2.0%

    CommandSet     = DwarvenGuardianEredMithrinHordeCommandSet
    CommandPoints  = 40

    FormationWidth = 2
    FormationDepth = 1

    CrushableLevel = 0
    CrusherLevel   = 1

    CrushOnlyWhileCharging = Yes

    MinCrushVelocityPercent = MINCRUSHVELOCITYPERCENT_STANDARD
    CrushDecelerationPercent = CRUSHDECELERATIONPERCENT_STANDARD

    CrushKnockback = 40
    CrushZFactor   = 1.0

    TransportSlotCount = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE MELEE_HORDE NOTIFY_OF_PREATTACK ARMY_SUMMARY LARGE_RECTANGLE_PATHFIND

    ThreatLevel = DWARVEN_GUARDIAN_HORDE_THREAT
    ThreatBreakdown DwarvenGuardianHorde_DetailedThreat
        AIKindOf = INFANTRY
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = FighterHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle     = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate            = 500
        MaxCowerTime                   = 5000
        MinCowerTime                   = 3000
        CanAttackWhileContained        = Yes
        AILuaEventsList                = InfantryFunctions
        AttackPriority                 = AttackPriority_Infantry
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained            =
        InitialPayload                = DwarvenGuardianEredMithrin 10
        Slots                    = 10
        PassengerFilter                = NONE +INFANTRY
        ShowPips                = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset = X:0 Y:0

        MeleeBehavior = Amoeba
        End


        BannerCarriersAllowed    = DwarvenEredMithrinBanner
        BannerCarrierPosition    = UnitType:DwarvenGuardianEredMithrin Pos:X:70.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:DwarvenGuardianEredMithrin Position:X:50 Y:0        Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:50 Y:40        Position:X:50 Y:-40
        RankInfo = RankNumber:2 UnitType:DwarvenGuardianEredMithrin Position:X:30 Y:0 Leader 1 0    Position:X:30 Y:20 Leader 1 1    Position:X:30 Y:-20 Leader 1 2    Position:X:30 Y:40 Leader 1 3    Position:X:30 Y:-40 Leader 1 4

        RanksToReleaseWhenAttacking        = 1 2

        MeleeAttackLeashDistance        = 25
        BackUpMinDelayTime              = 1
        BackUpMaxDelayTime              = 3000
        BackUpMinDistance               = 1
        BackUpMaxDistance               = 3
        BackupPercentage                = 80%
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

    Behavior = CommandButtonHuntUpdate ModuleTag_CommandButtonHuntUpdate
    End

    Behavior = HordeNotifyTargetsOfImminentProbableCrushingUpdate ModuleTag_NotifyCrushScan
        ScanWidth = 60.0
    End

       Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded        =    NONE
         AfraidOf            =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf            =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
         PointAt                =    EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance        =    150
        FearScanDistance        =    INFANTRY_FEAR_SCAN_RADIUS

        AddEmotion            =    Terror_Base
        AddEmotion            =    Doom_Base
        AddEmotion            =       BraceForBeingCrushed_Base
        AddEmotion            =    UncontrollableFear_Base
        AddEmotion            =    FearIdle_Base
        AddEmotion            =    FearBusy_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
         AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    HeroCheerIdle_Base
        AddEmotion            =    HeroCheerBusy_Base
        AddEmotion            =    Alert_Base
        AddEmotion            =       CheerForAboutToCrush_Base
    End


    LocomotorSet
        Locomotor     = NormalChargeMeleeHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = 42
    End

    LocomotorSet
        Locomotor     = ScaredMeleeHordeLocomotor
        Condition     = SET_SCARED
        Speed         = 42
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End
	
    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_KnifeEnabler
        SpecialPowerTemplate       = SpecialAbilityGimliHeroMode
        TriggeredBy                = Upgrade_ObjectLevel2
    End

    Behavior = WeaponModeSpecialPowerUpdate ModuleTag_KnifeFighterPowerUpdate
        SpecialPowerTemplate       = SpecialAbilityGimliHeroMode
        Duration                   = 30000
        AttributeModifier          = EredMithrinSwordBonus
        LockWeaponSlot             = SECONDARY
        StartsPaused               = Yes
    End

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTraining
        LevelsToGain = 1
        LevelCap = 2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality1
        TriggeredBy = Upgrade_ForgedBlades
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality3
        TriggeredBy = Upgrade_HeavyArmor
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy        = Upgrade_DwarvenMithrilMail
    End

    Behavior = ObjectCreationUpgrade ModuleTag_MithrilMailPalantirFix
        TriggeredBy  = Upgrade_TechnologyDwarvenMithrilMail
        GrantUpgrade = Upgrade_HeavyArmor
    End

    Behavior = CommandSetUpgrade ModuleTag_MithrilCommandSet
        TriggeredBy       = Upgrade_TechnologyDwarvenMithrilMail
        CommandSet        = DwarvenGuardianEredMithrinHordeCommandSet_Mithril
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End





    Behavior = AISpecialPowerUpdate DwarvenGuardianHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End



    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 50.0
    GeometryHeight = 20.0
    GeometryIsSmall = No



    AutoResolveUnitType = AutoResolveUnit_Soldier
    AutoResolveCombatChain = AutoResolve_SoldierCombatChain

    AutoResolveBody = AutoResolve_DwarvenGuardianHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_DwarvenGuardianHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_DwarvenGuardianArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_DwarvenGuardianUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_DwarvenGuardianWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTraining Upgrade_ForgedBlades Upgrade_HeavyArmor
End

Object DwarvenEredMithrinHunterHorde

    SelectPortrait     = UPMithrinHunter
    ButtonImage        = HSMithrinHunter

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR EMOTION_LOOK_TO_SKY
        DefaultModelConditionState
            Model = None
        End
        ModelConditionState = HORDE_EMPTY
            Model = None
        End

        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkGUTow
        End
    End

    Side = Dwarves
    EditorSorting = UNIT
    EmotionRange = 240
    DisplayName = OBJECT:DwarvenEredMithrinHunterHorde
    DisplayNameStrategic = CONTROLBAR:LW_Unit_DwarvenEredMithrinHunterHorde
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_DwarvenEredMithrinHunterHorde

    WeaponSet
        Conditions            = None
        Weapon                = PRIMARY   ShortRangedMissileHordeRangefinder
        AutoChooseSources     = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
        AutoChooseSources     = TERTIARY FROM_PLAYER FROM_SCRIPT
        ShareWeaponReloadTime = Yes
    End



    BuildCost = 500
    BuildTime = MEDIUM_BUILDTIME
    VisionRange = 300
    ShroudClearingRange = 475
    VisionSide = 50%
    VisionRear = 25%
    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = 200
    VisionBonusPercentPerFoot = 1.0%
    CommandPoints = 50
	MaxSimultaneousOfType = 6

    CommandSet = DwarvenEredMithrinHunterHordeCommandSet

    FormationWidth = 2
    FormationDepth = 1

    CrushableLevel = 0
    CrusherLevel = 0

    TransportSlotCount = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY ARCHER HORDE ARMY_SUMMARY MELEE_HORDE LARGE_RECTANGLE_PATHFIND
    #include "..\..\..\includes\StandardHordeEvaEvents.inc"
    #include "..\..\..\includes\DwarvenRunesUnits.inc"

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    ThreatLevel = GONDOR_TOWERSHIELDGUARD_HORDE_THREAT
    ThreatBreakdown GondorTowerShieldGuardHorde_DetailedThreat
        AIKindOf = ARCHER
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = ArcherHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle    = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate           = 500
        MaxCowerTime                  = 5000
        MinCowerTime                  = 3000
        CanAttackWhileContained       = Yes
        AILuaEventsList               = InfantryFunctions
        AttackPriority                = AttackPriority_Archer
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload = DwarvenEredMithrinHunter 10
        Slots = 10
        PassengerFilter    = NONE +INFANTRY
        ShowPips = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset=X:0 Y:0
        MeleeBehavior = Amoeba
        End


        BannerCarriersAllowed    = DwarvenEredMithrinBanner
        BannerCarrierPosition    = UnitType:DwarvenEredMithrinHunter Pos:X:70.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:DwarvenEredMithrinHunter Position:X:50 Y:0        Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:50 Y:40        Position:X:50 Y:-40
        RankInfo = RankNumber:2 UnitType:DwarvenEredMithrinHunter Position:X:30 Y:0 Leader 1 0    Position:X:30 Y:20 Leader 1 1    Position:X:30 Y:-20 Leader 1 2    Position:X:30 Y:40 Leader 1 3    Position:X:30 Y:-40 Leader 1 4

        RanksToReleaseWhenAttacking = 1 2

        MeleeAttackLeashDistance = 1
        BackUpMinDelayTime         = 1
        BackUpMaxDelayTime         = 3000
        BackUpMinDistance         = 1
        BackUpMaxDistance         = 3
        BackupPercentage         = 80%
    End



    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

       Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded        =    NONE
        AfraidOf                    =    EMOTION_AFRAIDOF_OBJECTFILTER_LANCERS
        AlwaysAfraidOf                =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER_LANCERS
        PointAt                        =    EMOTION_POINTAT_OBJECTFILTER_LANCERS
        HeroScanDistance            =    150
        FearScanDistance            =    INFANTRY_FEAR_SCAN_RADIUS

        AddEmotion            =    Terror_Base
        AddEmotion            =    Doom_Base
        AddEmotion            =    UncontrollableFear_Base
        AddEmotion            =    FearIdle_Base
        AddEmotion            =    FearBusy_Base
        AddEmotion            =    Point_Base

        AddEmotion            =    OVERRIDE Taunt_Base
         End

        AddEmotion    =    CheerIdle_Base
        AddEmotion    =    CheerBusy_Base
        AddEmotion    =    HeroCheerIdle_Base
        AddEmotion    =    HeroCheerBusy_Base
        AddEmotion    =    Alert_Base
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End

    LocomotorSet
        Locomotor     = NormalMeleeHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = 45
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End
	
    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_KnifeEnabler
        SpecialPowerTemplate       = SpecialAbilityGimliHeroMode
        TriggeredBy                = Upgrade_ObjectLevel2
    End

    Behavior = WeaponModeSpecialPowerUpdate ModuleTag_KnifeFighterPowerUpdate
        SpecialPowerTemplate       = SpecialAbilityGimliHeroMode
        Duration                   = 30000
        AttributeModifier          = EredMithrinHunterBonus
        LockWeaponSlot             = TERTIARY
        StartsPaused               = Yes
    End

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTraining
        LevelsToGain = 1
        LevelCap = 2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality
        TriggeredBy = Upgrade_ForgedBlades
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_HeavyArmor
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality3
        TriggeredBy        = Upgrade_DwarvenMithrilMail
    End

    Behavior = ObjectCreationUpgrade ModuleTag_MithrilMailPalantirFix
        TriggeredBy  = Upgrade_TechnologyDwarvenMithrilMail
        GrantUpgrade = Upgrade_HeavyArmor
    End

    Behavior = CommandSetUpgrade ModuleTag_MithrilCommandSet
        TriggeredBy       = Upgrade_TechnologyDwarvenMithrilMail
        CommandSet        = DwarvenEredMithrinHunterHordeCommandSet_Mithril
    End





    Behavior = AISpecialPowerUpdate DwarvenGuardianHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 45.0
    GeometryHeight = 20.0
    GeometryIsSmall = No



    AutoResolveUnitType = AutoResolveUnit_Soldier
    AutoResolveCombatChain = AutoResolve_SoldierCombatChain

    AutoResolveBody = AutoResolve_GondorFighterHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_GondorSoldierHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_GondorSoldierArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_GondorSoldierUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_GondorSoldierWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTraining Upgrade_ForgedBlades Upgrade_HeavyArmor
End




Object DwarvenArkenguardHorde

    SelectPortrait     = UPEreborPunisher
    ButtonImage        = UIEreborPunisher

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER EMOTION_TERROR EMOTION_LOOK_TO_SKY SELECTED
        DefaultModelConditionState
            Model = None
        End

        ModelConditionState = HORDE_EMPTY
            Model = None
        End

        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkEUDFG
        End
    End

    Side = Dwarves
    EditorSorting = UNIT
    EmotionRange = 240
    DisplayName = OBJECT:HordeDwarvenArkenguard
    DisplayNameStrategic = CONTROLBAR:LW_Unit_DwarvenArkenguard
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_DwarvenArkenguardHorde

    WeaponSet
        Conditions            = None
        Weapon                = PRIMARY   NormalMeleeHordeRangefinder
        Weapon                = SECONDARY NormalMeleeHordeRangefinder
        AutoChooseSources     = SECONDARY NONE
        ShareWeaponReloadTime = Yes
    End



    #include "..\..\..\includes\StandardHordeEvaEvents.inc"
    #include "..\..\..\includes\DwarvenRunesUnits.inc"

    UnitSpecificSounds
        VoiceDesperateAttack  = GondorSoldierVoiceDesperateCharge
    End

    BuildCost = DWARVENELITES_BUILDCOST
    BuildTime = STRONG_BUILDTIME

    ShroudClearingRange = 400
    VisionRange = 220
    VisionSide = 35%
    VisionRear = 25%
    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = 200
    VisionBonusPercentPerFoot = 2.0%

    CommandPoints  = 60

    FormationWidth = 2
    FormationDepth = 1

    CrushableLevel = 0
    CrusherLevel   = 1

    CrushOnlyWhileCharging = Yes

    MinCrushVelocityPercent = MINCRUSHVELOCITYPERCENT_STANDARD
    CrushDecelerationPercent = CRUSHDECELERATIONPERCENT_STANDARD

    CrushKnockback = 40
    CrushZFactor = 1.0

    TransportSlotCount = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE MELEE_HORDE NOTIFY_OF_PREATTACK ARMY_SUMMARY LARGE_RECTANGLE_PATHFIND

    ThreatLevel = 150
    ThreatBreakdown DwarvenGuardianHorde_DetailedThreat
        AIKindOf = INFANTRY
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = FighterHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle        = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate               = 500
        MaxCowerTime                      = 5000
        MinCowerTime                      = 3000
        CanAttackWhileContained           = Yes
        AILuaEventsList                   = InfantryFunctions
        AttackPriority                    = AttackPriority_Infantry
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained            =
        InitialPayload                = DwarvenArkenguard 10
        Slots                    = 10
        PassengerFilter                = NONE +INFANTRY
        ShowPips                = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset = X:0 Y:0

        MeleeBehavior = Amoeba
        End


        BannerCarriersAllowed    = DwarvenArkenguardBanner
        BannerCarrierPosition    = UnitType:DwarvenArkenguard Pos:X:70.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:DwarvenArkenguard Position:X:50 Y:0        Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:50 Y:40        Position:X:50 Y:-40
        RankInfo = RankNumber:2 UnitType:DwarvenArkenguard Position:X:30 Y:0 Leader 1 0    Position:X:30 Y:20 Leader 1 1    Position:X:30 Y:-20 Leader 1 2    Position:X:30 Y:40 Leader 1 3    Position:X:30 Y:-40 Leader 1 4

        RanksToReleaseWhenAttacking        = 1 2

        MeleeAttackLeashDistance      = 25
        BackUpMinDelayTime            = 1
        BackUpMaxDelayTime            = 3000
        BackUpMinDistance             = 1
        BackUpMaxDistance             = 3
        BackupPercentage              = 80%
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

    Behavior = CommandButtonHuntUpdate ModuleTag_CommandButtonHuntUpdate
    End

    Behavior = HordeNotifyTargetsOfImminentProbableCrushingUpdate ModuleTag_NotifyCrushScan
        ScanWidth = 60.0
    End

       Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay     =    1000
        TauntAndPointExcluded        =    NONE
        AfraidOf                     =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf               =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
        PointAt                      =    EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance             =    150
        FearScanDistance             =    INFANTRY_FEAR_SCAN_RADIUS

        AddEmotion            =    Terror_Base
        AddEmotion            =    Doom_Base
        AddEmotion            =    BraceForBeingCrushed_Base
        AddEmotion            =    UncontrollableFear_Base
        AddEmotion            =    FearIdle_Base
        AddEmotion            =    FearBusy_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
        AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    HeroCheerIdle_Base
        AddEmotion            =    HeroCheerBusy_Base
        AddEmotion            =    Alert_Base
        AddEmotion            =    CheerForAboutToCrush_Base
    End

    LocomotorSet
        Locomotor     = NormalChargeMeleeHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_FOOT_SLOW_HORDE_SPEED
    End

    LocomotorSet
        Locomotor     = ScaredMeleeHordeLocomotor
        Condition     = SET_SCARED
        Speed         = NORMAL_FOOT_SLOW_HORDE_SPEED
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality16
        TriggeredBy = Upgrade_LastStandZwerge
    End


    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTraining
        LevelsToGain = 1
        LevelCap = 2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality1
        TriggeredBy = Upgrade_DwarvenSiegeHammer
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_ForgedBlades
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality3
        TriggeredBy = Upgrade_DwarvenMithrilMail
    End
	
	Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality4
        TriggeredBy = Upgrade_DwarvenKriegsmaske
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality17
        TriggeredBy = Upgrade_HeavyArmor
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End






    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_KampfkunstEnabler
        SpecialPowerTemplate = SpecialAbilityZwergischeKampfkunst
        TriggeredBy          = Upgrade_AllFactionUpgrade
    End

    Behavior = WeaponModeSpecialPowerUpdate ModuleTag_KampfkunstPowerUpdate
        SpecialPowerTemplate = SpecialAbilityZwergischeKampfkunst
        Duration             = 20000
        AttributeModifier    = ZwergischeKampfkunstBonus
        LockWeaponSlot       = SECONDARY
        StartsPaused         = No
    End

    CommandSet = DwarvenArkenguardHordeCommandSet

    Behavior = ObjectCreationUpgrade ModuleTag_MithrilMailPalantirFix
        TriggeredBy  = Upgrade_TechnologyDwarvenMithrilMail
        GrantUpgrade = Upgrade_HeavyArmor
    End

    Behavior = CommandSetUpgrade ModuleTag_MithrilCommandSet
        TriggeredBy       = Upgrade_TechnologyDwarvenMithrilMail
        CommandSet        = DwarvenArkenguardHordeCommandSet_Mithril
    End





    Behavior = AISpecialPowerUpdate DwarvenGuardianHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Behavior = AISpecialPowerUpdate DwarfGuardianCharge
        CommandButtonName = Command_SpecialAbilityVerteidigerKriegsschrei
        SpecialPowerAIType = AI_SPECIAL_POWER_CHARGE
    End


    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 50.0
    GeometryHeight = 20.0
    GeometryIsSmall = No



    AutoResolveUnitType = AutoResolveUnit_Soldier
    AutoResolveCombatChain = AutoResolve_SoldierCombatChain

    AutoResolveBody = AutoResolve_DwarvenGuardianHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_DwarvenGuardianHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_DwarvenGuardianArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_DwarvenGuardianUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_DwarvenGuardianWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTraining Upgrade_ForgedBlades Upgrade_HeavyArmor
End




Object DwarvenUnburntHorde

    ButtonImage       = UIKhazadDumVeteran
    SelectPortrait    = UPEredLuinUnburnt

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER EMOTION_TERROR EMOTION_LOOK_TO_SKY SELECTED
        DefaultModelConditionState
            Model = None
        End

        ModelConditionState = HORDE_EMPTY
            Model = None
        End

        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkEUDFG
        End
    End

    Side = Dwarves
    EditorSorting = UNIT
    EmotionRange = 240
    DisplayName = OBJECT:DwarvenUnburntHorde
    DisplayNameStrategic = CONTROLBAR:LW_Unit_DwarvenUnburntHorde
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_DwarvenArkenguardHorde

    WeaponSet
        Conditions            = None
        Weapon                = PRIMARY NormalMeleeHordeRangefinder
        AutoChooseSources     = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End



    #include "..\..\..\includes\StandardHordeEvaEvents.inc"
    #include "..\..\..\includes\DwarvenRunesUnits.inc"

    UnitSpecificSounds
        VoiceDesperateAttack  = GondorSoldierVoiceDesperateCharge
    End

    BuildCost = DWARVENELITES_BUILDCOST
    BuildTime = STRONG_BUILDTIME

    ShroudClearingRange = 400
    VisionRange = 220
    VisionSide = 35%
    VisionRear = 25%
    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = 200
    VisionBonusPercentPerFoot = 2.0%

    CommandPoints = 60

    FormationWidth = 2
    FormationDepth = 1

    CrushableLevel = 0
    CrusherLevel = 1

    CrushOnlyWhileCharging = Yes

    MinCrushVelocityPercent = MINCRUSHVELOCITYPERCENT_STANDARD
    CrushDecelerationPercent = CRUSHDECELERATIONPERCENT_STANDARD

    CrushKnockback = 40
    CrushZFactor = 1.0

    TransportSlotCount = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE MELEE_HORDE NOTIFY_OF_PREATTACK LARGE_RECTANGLE_PATHFIND

    ThreatLevel = 150
    ThreatBreakdown DwarvenGuardianHorde_DetailedThreat
        AIKindOf = INFANTRY
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = FighterHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle        = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate            = 500
        MaxCowerTime                = 5000
        MinCowerTime                = 3000
        CanAttackWhileContained            = Yes
        AILuaEventsList                = InfantryFunctions
        AttackPriority                = AttackPriority_Infantry
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained            =
        InitialPayload                = DwarvenUnburnt 10
        Slots                    = 10
        PassengerFilter                = NONE +INFANTRY
        ShowPips                = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset = X:0 Y:0

        MeleeBehavior = Amoeba
        End

        BannerCarriersAllowed    = DwarvenUnburntBanner
        BannerCarrierPosition    = UnitType:DwarvenUnburnt Pos:X:50.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:DwarvenUnburnt Position:X:30 Y:0              Position:X:30 Y:20              Position:X:30 Y:-20              Position:X:30 Y:40              Position:X:30 Y:-40
        RankInfo = RankNumber:2 UnitType:DwarvenUnburnt Position:X:10 Y:0 Leader 1 0    Position:X:10 Y:20 Leader 1 1    Position:X:10 Y:-20 Leader 1 2    Position:X:10 Y:40 Leader 1 3    Position:X:10 Y:-40 Leader 1 4

        RanksToReleaseWhenAttacking        = 1 2

        MeleeAttackLeashDistance        = 50
        BackUpMinDelayTime            = 1
        BackUpMaxDelayTime            = 3000
        BackUpMinDistance            = 1
        BackUpMaxDistance            = 3
        BackupPercentage            = 80%
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

    Behavior = CommandButtonHuntUpdate ModuleTag_CommandButtonHuntUpdate
    End

    Behavior = HordeNotifyTargetsOfImminentProbableCrushingUpdate ModuleTag_NotifyCrushScan
        ScanWidth = 60.0
    End

       Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded        =    NONE
        AfraidOf            =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf            =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
        PointAt                =    EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance        =    150
        FearScanDistance        =    INFANTRY_FEAR_SCAN_RADIUS

        AddEmotion            =    Terror_Base
        AddEmotion            =    Doom_Base
        AddEmotion            =       BraceForBeingCrushed_Base
        AddEmotion            =    UncontrollableFear_Base
        AddEmotion            =    FearIdle_Base
        AddEmotion            =    FearBusy_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
         AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    HeroCheerIdle_Base
        AddEmotion            =    HeroCheerBusy_Base
        AddEmotion            =    Alert_Base
        AddEmotion            =       CheerForAboutToCrush_Base
    End

    LocomotorSet
        Locomotor     = NormalChargeMeleeHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_FOOT_SLOW_HORDE_SPEED_EREDLUIN
    End

    LocomotorSet
        Locomotor     = ScaredMeleeHordeLocomotor
        Condition     = SET_SCARED
        Speed         = NORMAL_FOOT_SLOW_HORDE_SPEED_EREDLUIN
    End


    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End

    CommandSet = DwarvenUnburntHordeCommandSet

    Behavior = ObjectCreationUpgrade ModuleTag_MithrilMailPalantirFix
        TriggeredBy  = Upgrade_TechnologyDwarvenMithrilMail
        GrantUpgrade = Upgrade_HeavyArmor
    End

    Behavior = CommandSetUpgrade ModuleTag_MithrilCommandSet
        TriggeredBy       = Upgrade_TechnologyDwarvenMithrilMail
        CommandSet        = DwarvenUnburntHordeCommandSet_Mithril
    End

    Behavior = SpecialPowerModule ModuleTag_ChargeStarter
        SpecialPowerTemplate          = SpecialAbilityDwarvenCharge
        UpdateModuleStartsAttack      = Yes
        StartsPaused                  = No
    End

    #include "..\..\..\includes\DwarvenChargeUpdate.inc"

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTraining
        LevelsToGain = 1
        LevelCap = 2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_ForgedBlades
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality3
        TriggeredBy = Upgrade_DwarvenMithrilMail
    End
	
	Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality4
        TriggeredBy = Upgrade_DwarvenSiegeHammer
    End
	
    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality16
        TriggeredBy = Upgrade_LastStandZwerge
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality17
        TriggeredBy = Upgrade_HeavyArmor
    End


    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 20.0
    GeometryHeight = 20.0
    GeometryIsSmall = No






    Behavior = AISpecialPowerUpdate DwarvenGuardianHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End



    AutoResolveUnitType = AutoResolveUnit_Soldier
    AutoResolveCombatChain = AutoResolve_SoldierCombatChain

    AutoResolveBody = AutoResolve_DwarvenGuardianHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_DwarvenGuardianHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_DwarvenGuardianArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_DwarvenGuardianUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_DwarvenGuardianWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTraining Upgrade_ForgedBlades Upgrade_HeavyArmor
End

Object DwarvenEreborGuardianHorde_SummonDain

    SelectPortrait     = UPEredVerteidiger
    ButtonImage        = HSEredVerteidiger

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER EMOTION_TERROR EMOTION_LOOK_TO_SKY SELECTED
        DefaultModelConditionState
            Model = None
        End

        ModelConditionState = HORDE_EMPTY
            Model = None
        End

        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkEUDFG
        End
    End

    Side = Dwarves
    EditorSorting = UNIT
    EmotionRange = 240
    DisplayName = OBJECT:HordeDwarvenGuardianErebor
    DisplayNameStrategic = CONTROLBAR:LW_Unit_DwarvenGuardianHordeErebor
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_DwarvenGuardianHorde

    WeaponSet
        Conditions = None
        Weapon = PRIMARY    NormalMeleeHordeRangefinder
    End


    #include "..\..\..\includes\StandardHordeEvaEvents.inc"
    #include "..\..\..\includes\DwarvenRunesUnits.inc"

    UnitSpecificSounds
        VoiceDesperateAttack  = GondorSoldierVoiceDesperateCharge
    End

    BuildCost = 700
    BuildTime = STRONG_BUILDTIME
    VisionRange = 200
    ShroudClearingRange = 250
    VisionSide = 50%
    VisionRear = 25%

    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = 200
    VisionBonusPercentPerFoot = 1.0%
    CommandPoints = 60

    FormationWidth = 2
    FormationDepth = 1

    CrushableLevel = 0
    CrusherLevel = 1

    CrushOnlyWhileCharging = Yes

    MinCrushVelocityPercent = MINCRUSHVELOCITYPERCENT_STANDARD
    CrushDecelerationPercent = CRUSHDECELERATIONPERCENT_STANDARD

    CrushKnockback = 40
    CrushZFactor = 1.0

    TransportSlotCount = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE MELEE_HORDE NOTIFY_OF_PREATTACK ARMY_SUMMARY LARGE_RECTANGLE_PATHFIND

    ThreatLevel = DWARVEN_GUARDIAN_HORDE_THREAT
    ThreatBreakdown DwarvenGuardianHorde_DetailedThreat
        AIKindOf = INFANTRY
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = FighterHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle        = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate            = 500
        MaxCowerTime                = 5000
        MinCowerTime                = 3000

        CanAttackWhileContained            = Yes
        AILuaEventsList                = InfantryFunctions
        AttackPriority                = AttackPriority_Infantry
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained            =
        InitialPayload                = DwarvenEreborGuardian_Summoned 15
        Slots                    = 15
        PassengerFilter                = NONE +INFANTRY +DwarvenEreborGuardianBanner_Summoned
        ShowPips                = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset = X:0 Y:0

        MeleeBehavior = Amoeba
        End

        BannerCarriersAllowed    = DwarvenEreborGuardianBanner_Summoned
        BannerCarrierPosition    = UnitType:DwarvenEreborGuardian_Summoned    Pos:X:70.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:DwarvenEreborGuardian_Summoned Position:X:50 Y:0        Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:50 Y:40        Position:X:50 Y:-40
        RankInfo = RankNumber:2 UnitType:DwarvenEreborGuardian_Summoned Position:X:30 Y:0 Leader 1 0    Position:X:30 Y:20 Leader 1 1    Position:X:30 Y:-20 Leader 1 2    Position:X:30 Y:40 Leader 1 3    Position:X:30 Y:-40 Leader 1 4
		RankInfo = RankNumber:2 UnitType:DwarvenEreborGuardian_Summoned Position:X:10 Y:0 Leader 1 0    Position:X:10 Y:20 Leader 1 1    Position:X:10 Y:-20 Leader 1 2    Position:X:10 Y:40 Leader 1 3    Position:X:10 Y:-40 Leader 1 4

        RanksToReleaseWhenAttacking        = 1 2 3
        AlternateFormation         = DwarvenEreborGuardianHorde_SummonDainBlock

        MeleeAttackLeashDistance      = 25
        BackUpMinDelayTime            = 1
        BackUpMaxDelayTime            = 3000
        BackUpMinDistance             = 1
        BackUpMaxDistance             = 3
        BackupPercentage              = 80%
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

    Behavior = CommandButtonHuntUpdate ModuleTag_CommandButtonHuntUpdate
    End

    Behavior = HordeNotifyTargetsOfImminentProbableCrushingUpdate ModuleTag_NotifyCrushScan
        ScanWidth = 60.0
    End

       Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay     =    1000
        TauntAndPointExcluded        =    NONE
        AfraidOf                     =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf               =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
        PointAt                      =    EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance             =    150
        FearScanDistance             =    INFANTRY_FEAR_SCAN_RADIUS

        AddEmotion            =    Terror_Base
        AddEmotion            =    Doom_Base
        AddEmotion            =    BraceForBeingCrushed_Base
        AddEmotion            =    UncontrollableFear_Base
        AddEmotion            =    FearIdle_Base
        AddEmotion            =    FearBusy_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
        AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    HeroCheerIdle_Base
        AddEmotion            =    HeroCheerBusy_Base
        AddEmotion            =    Alert_Base
        AddEmotion            =    CheerForAboutToCrush_Base
    End

    LocomotorSet
        Locomotor     = NormalChargeMeleeHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_FOOT_SLOW_HORDE_SPEED
    End

    LocomotorSet
        Locomotor     = ScaredMeleeHordeLocomotor
        Condition     = SET_SCARED
        Speed         = NORMAL_FOOT_SLOW_HORDE_SPEED
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTraining
        LevelsToGain = 1
        LevelCap = 2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality1
        TriggeredBy = Upgrade_DwarvenSiegeHammer
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_ForgedBlades
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality3
        TriggeredBy = Upgrade_DwarvenMithrilMail
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality16
        TriggeredBy = Upgrade_LastStandZwerge
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality17
        TriggeredBy        = Upgrade_HeavyArmor
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_KriegsschreiEnabler
        SpecialPowerTemplate      = SpecialAbilityVerteidigerKriegsschrei
        TriggeredBy               = Upgrade_ObjectLevel2
    End

    Behavior = SpecialPowerModule ModuleTag_KriegsschreiStarter
        SpecialPowerTemplate      = SpecialAbilityVerteidigerKriegsschrei
        UpdateModuleStartsAttack  = Yes
        StartsPaused              = Yes
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_KriegsschreiWeaponFireUpdate
        SpecialPowerTemplate      = SpecialAbilityVerteidigerKriegsschrei
        WhichSpecialWeapon        = 1
        SkipContinue              = Yes
        UnpackTime                = 1700
        PackTime                  = 1
        FreezeAfterTriggerDuration = 2500
        AwardXPForTriggering      = 0
        StartAbilityRange         = 80.0
        SpecialWeapon             = VerteidigerKriegsschreiWeapon
    End

    CommandSet = DwarvenGuardianEreborHordeCommandSet2

    Behavior = ObjectCreationUpgrade ModuleTag_MithrilMailPalantirFix
        TriggeredBy  = Upgrade_TechnologyDwarvenMithrilMail
        GrantUpgrade = Upgrade_HeavyArmor
    End

    Behavior = CommandSetUpgrade ModuleTag_MithrilCommandSet
        TriggeredBy       = Upgrade_TechnologyDwarvenMithrilMail
        CommandSet        = DwarvenGuardianEreborHordeCommandSet2_Mithril
    End

    Behavior  = GrantUpgradeCreate ModuleTag_GrantBasicTraining
        UpgradeToGrant     = Upgrade_BasicTraining
    End





    Behavior = AISpecialPowerUpdate DwarvenGuardianHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Behavior = AISpecialPowerUpdate DwarfGuardianCharge
        CommandButtonName = Command_SpecialAbilityVerteidigerKriegsschrei
        SpecialPowerAIType = AI_SPECIAL_POWER_CHARGE
    End


    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 50.0
    GeometryHeight = 20.0
    GeometryIsSmall = No



    AutoResolveUnitType = AutoResolveUnit_Soldier
    AutoResolveCombatChain = AutoResolve_SoldierCombatChain

    AutoResolveBody = AutoResolve_DwarvenGuardianHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_DwarvenGuardianHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_DwarvenGuardianArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_DwarvenGuardianUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_DwarvenGuardianWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTraining Upgrade_ForgedBlades Upgrade_HeavyArmor Upgrade_DwarvenSiegeHammer
End

ChildObject DwarvenEreborGuardianHorde_SummonDainBlock DwarvenEreborGuardianHorde_SummonDain

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained        =
        InitialPayload            = DwarvenEreborGuardian_Summoned 15
        Slots                = 15
        PassengerFilter            = NONE +INFANTRY +DwarvenEreborGuardianBanner_Summoned
        ShowPips            = No
        ThisFormationIsTheMainFormation = No
        AttributeModifiers        = DwarvenGuardianEreborBlock
        RandomOffset            = X:0 Y:0
        MeleeBehavior             = Amoeba
        End


        BannerCarriersAllowed    = DwarvenEreborGuardianBanner_Summoned
        BannerCarrierPosition    = UnitType:DwarvenEreborGuardian_Summoned    Pos:X:46.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:DwarvenEreborGuardian_Summoned Position:X:34 Y:0            Position:X:34 Y:-10                Position:X:34 Y:-20			Position:X:34 Y:20			Position:X:34 Y:10
        RankInfo = RankNumber:2 UnitType:DwarvenEreborGuardian_Summoned Position:X:22 Y:0 Leader 1 0    Position:X:22 Y:10 Leader 1 1    Position:X:22 Y:-10 Leader 1 2		Position:X:22 Y:20 Leader 1 3		Position:X:22 Y:-20 Leader 1 4
        RankInfo = RankNumber:3 UnitType:DwarvenEreborGuardian_Summoned Position:X:10 Y:0 Leader 2 0    Position:X:10 Y:10 Leader 2 1    Position:X:10 Y:-10 Leader 2 2		Position:X:10 Y:20 Leader 2 2		Position:X:10 Y:-20 Leader 2 2
        RanksToReleaseWhenAttacking = 1

        AlternateFormation = DwarvenEreborGuardianHorde_SummonDain

        MeleeAttackLeashDistance     = 1
        BackUpMinDelayTime        = 1
        BackUpMaxDelayTime        = 3000
        BackUpMinDistance        = 1
        BackUpMaxDistance        = 3
        BackupPercentage        = 80%
    End
End

Object IronHillsScoutHorde

    ButtonImage      = HIIronHillsScout_Wotr
    SelectPortrait   = UPIronHillsScout

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR EMOTION_CELEBRATING
        DefaultModelConditionState
            Model = None
        End
        ModelConditionState = HORDE_EMPTY
            Model = None
        End
        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkRURoh
        End
    End

    Side                 = Dwarves
    EditorSorting                    = UNIT
    EmotionRange                     = 240
    DisplayName                      = OBJECT:IronHillsScoutHorde
    DisplayNameStrategic             = CONTROLBAR:LW_Unit_IronHillsScoutHorde
    DescriptionStrategic             = CONTROLBAR:LW_ToolTip_IronHillsScoutHorde
    TransportSlotCount               = TRANSPORTSLOTCOUNT_SMALL_HORDE

    MaxSimultaneousOfType = 6

    VisionRange                     = 200
    ShroudClearingRange             = 400
    VisionSide                      = 35%
    VisionRear                         = 25%
    MaxVisionBonusPercent           = 300%
    VisionBonusTestRadius           = 250
    VisionBonusPercentPerFoot       = 2.0%

    BuildCost                         = 600
    BuildTime                          = MEDIUM_BUILDTIME

    CommandPoints = 50

    FormationWidth = 2
    FormationDepth = 1

    CrushableLevel = 2
    CrusherLevel = 1
    MinCrushVelocityPercent = MINCRUSHVELOCITYPERCENT_STANDARD
    CrushDecelerationPercent = CRUSHDECELERATIONPERCENT_STANDARD
    CrushKnockback = 40
    CrushZFactor = 1.0

    WeaponSet
        Conditions    = None
        Weapon        = PRIMARY    NormalMeleeHordeRangefinder
    End

    CommandSet = IronHillsScoutHordeCommandSet

    Behavior = CommandSetUpgrade ModuleTag_MithrilCommandSet
        TriggeredBy       = Upgrade_HeavyArmor
        CommandSet        = IronHillsScoutHordeCommandSet_Mithril
    End

    TransportSlotCount = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT CAVALRY HORDE MELEE_HORDE ARMY_SUMMARY

    ThreatLevel = 120
    ThreatBreakdown GondorKnightHorde_DetailedThreat
        AIKindOf = CAVALRY
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    #include "..\..\..\includes\StandardHordeEvaEvents.inc"
    #include "..\..\..\includes\DwarvenRunesUnits.inc"

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = CavalryHorde
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle    = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate           = 500
        MaxCowerTime                  = 5000
        MinCowerTime                  = 3000
        AILuaEventsList               = CavalryFunctions
        AttackPriority                = AttackPriority_Cavalry
    End

    Behavior = HorseHordeContain ModuleTag_HordeContain
        FrontAngle = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained         =
        InitialPayload                 = IronHillsScout 10
        Slots                     = 10
        PassengerFilter             = NONE +CAVALRY
        ShowPips                 = No
        RandomOffset                 = X:3 Y:4
        ThisFormationIsTheMainFormation     = Yes


        BannerCarriersAllowed    = IronHillsScoutBanner
        BannerCarriersAllowed        = IronHillsScoutBanner
        BannerCarrierPosition        = UnitType:IronHillsScout    Pos:X:65.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:IronHillsScout Position:X:40 Y:0       Position:X:40 Y:20               Position:X:40 Y:-20
        RankInfo = RankNumber:2 UnitType:IronHillsScout Position:X:15 Y:10 Leader 1 0   Position:X:15 Y:-10 Leader 1 1   Position:X:15 Y:30 Leader 1 2   Position:X:15 Y:-30
        RankInfo = RankNumber:3 UnitType:IronHillsScout Position:X:-10 Y:0 Leader 2 0   Position:X:-10 Y:20 Leader 2 1   Position:X:-10 Y:-20 Leader 2 2

        AlternateFormation                  = IronHillsScoutHordeWedgeFormation
        RanksToReleaseWhenAttacking     = 1 2 3
        AlternateFormation              = IronHillsScoutHorde
        MeleeAttackLeashDistance        = 25
        BackUpMinDelayTime              = 1
        BackUpMaxDelayTime              = 3000
        BackUpMinDistance               = 1
        BackUpMaxDistance               = 3
        BackupPercentage                = 80%
    End

    Behavior = HordeNotifyTargetsOfImminentProbableCrushingUpdate ModuleTag_NotifyCrushScan
        ScanWidth = 40.0
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

    Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance            = INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay        = 1000
        TauntAndPointExcluded           = NONE
        AfraidOf                        = EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf                  = EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
        PointAt                         = EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance               = 150
        FearScanDistance                = INFANTRY_FEAR_SCAN_RADIUS
        AddEmotion                    = Terror_Base
        AddEmotion                    = Doom_Base
        AddEmotion                    = BraceForBeingCrushed_Base
        AddEmotion                    = UncontrollableFear_Base
        AddEmotion                    = FearIdle_Base
        AddEmotion                    = FearBusy_Base
        AddEmotion                    = Point_Base
        AddEmotion                    = Taunt_Base
        AddEmotion                    = CheerIdle_Base
        AddEmotion                    = CheerBusy_Base
        AddEmotion                    = HeroCheerIdle_Base
        AddEmotion                    = HeroCheerBusy_Base
        AddEmotion                    = Alert_Base
        AddEmotion                    = CheerForAboutToCrush_Base
     End

    LocomotorSet
        Locomotor     = NormalCavalryHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_CAVALRY_HORDE_SPEED
    End

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTraining
        LevelsToGain = 1
        LevelCap = 2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_ForgedBlades
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality17
        TriggeredBy = Upgrade_HeavyArmor
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality3
        TriggeredBy = Upgrade_DwarvenMithrilMail
    End


    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName  = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName  = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName  = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Behavior = AISpecialPowerUpdate ElvenLorienWarriorHordeCaptureBuildingAI
        CommandButtonName  = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Geometry = BOX
    GeometryMajorRadius = 12.0
    GeometryMinorRadius = 24.0
    GeometryHeight = 20.0
    GeometryIsSmall = No



    AutoResolveUnitType = AutoResolveUnit_Cavalry
    AutoResolveCombatChain = AutoResolve_CavalryCombatChain

    AutoResolveBody = AutoResolve_GondorKnightHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_GondorKnightHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_GondorKnightArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_GondorKnightUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_GondorKnightWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTraining Upgrade_ForgedBlades Upgrade_HeavyArmor
End



ChildObject IronHillsScoutHordeWedgeFormation IronHillsScoutHorde

    Behavior = HorseHordeContain ModuleTag_HordeContain
        FrontAngle = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay = STANDARD_INFANTRY_FLANKEDDELAY
        AttributeModifiers              = GoatRidersLine
        ObjectStatusOfContained         =
        InitialPayload                  = IronHillsScout 10
        Slots                           = 10
        PassengerFilter                 = NONE +CAVALRY
        ShowPips                        = No
        ThisFormationIsTheMainFormation = No
        RandomOffset                    = X:0 Y:0
        MeleeBehavior                   = Amoeba
        End

        BannerCarriersAllowed        = IronHillsScoutBanner
        BannerCarrierPosition    = UnitType:IronHillsScout    Pos:X:75.0 Y:0.0         for archer horde

        RankInfo = RankNumber:1 UnitType:IronHillsScout Position:X:0 Y:15     Position:X:25 Y:15     Position:X:-25 Y:15     Position:X:50 Y:15     Position:X:-50 Y:15
        RankInfo = RankNumber:2 UnitType:IronHillsScout Position:X:0 Y:-15     Position:X:25 Y:-15     Position:X:-25 Y:-15     Position:X:50 Y:-15     Position:X:-50 Y:-15 
        RanksToReleaseWhenAttacking     = 1 2 
        AlternateFormation              = IronHillsScoutHorde
        MeleeAttackLeashDistance        = 1
        BackUpMinDelayTime              = 1
        BackUpMaxDelayTime              = 3000
        BackUpMinDistance               = 1
        BackUpMaxDistance               = 3
        BackupPercentage                = 80%
    End
End

ChildObject IronHillsScoutHorde_DainSummon IronHillsScoutHorde

    CommandSet = IronHillsScoutHordeCommandSet_Dain

    Behavior = CommandSetUpgrade ModuleTag_MithrilCommandSet
        TriggeredBy       = Upgrade_HeavyArmor
        CommandSet        = IronHillsScoutHordeCommandSet_MithrilDain
    End

    MaxSimultaneousOfType = 8
End

Object DwarvenPhalanxEreborHorde

    ButtonImage       = BDHallofWarriors_EreborGuardian
    SelectPortrait    = BDHallofWarriors_EreborGuardian

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER EMOTION_TERROR EMOTION_LOOK_TO_SKY SELECTED
        DefaultModelConditionState
            Model = None
        End

        ModelConditionState = HORDE_EMPTY
            Model = None
        End

        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkEUDFG
        End
    End

    Side            = Dwarves
    EditorSorting        = UNIT
    EmotionRange        = 240
    DisplayName        = OBJECT:HordeDwarvenPhalanxLangbarte
    DisplayNameStrategic     = CONTROLBAR:LW_Unit_DwarvenPhalanxLangbarteHorde
    DescriptionStrategic     = CONTROLBAR:LW_ToolTip_DwarvenPhalanxLangbarteHorde

    WeaponSet
        Conditions = None
        Weapon = PRIMARY    TowerGuardHordeRangefinder
    End



    #include "..\..\..\includes\StandardHordeEvaEvents.inc"
    #include "..\..\..\includes\DwarvenRunesUnits.inc"
        UnitSpecificSounds
        VoiceDesperateAttack  = GondorSoldierVoiceDesperateCharge
    End

    BuildCost              = 380
    BuildTime              = MEDIUM_BUILDTIME
    VisionRange            = 200
    ShroudClearingRange    = 250

    VisionSide             = 50%
    VisionRear             = 25%

    MaxVisionBonusPercent         = 300%
    VisionBonusTestRadius         = 200
    VisionBonusPercentPerFoot     = 1.0%
    CommandPoints            = 40

    FormationWidth             = 2
    FormationDepth             = 1

    CrushableLevel            = 0
    CrusherLevel            = 0

    TransportSlotCount = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE MELEE_HORDE NOTIFY_OF_PREATTACK ARMY_SUMMARY PIKE LARGE_RECTANGLE_PATHFIND

    ThreatLevel = DWARVEN_PHALANX_HORDE_THREAT
    ThreatBreakdown DwarvenPhalanxHorde_DetailedThreat
        AIKindOf = PIKEMAN
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = PikeHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle    = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate        = 500
        MaxCowerTime            = 5000
        MinCowerTime            = 3000
        CanAttackWhileContained        = Yes
        AILuaEventsList            = InfantryFunctions
        AttackPriority            = AttackPriority_Infantry
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle             = STANDARD_PIKEMAN_FRONTANGLE
        FlankedDelay             = STANDARD_PIKEMAN_FLANKEDDELAY
        ObjectStatusOfContained        =
        InitialPayload            = DwarvenPhalanxErebor 10
        Slots                = 10
        PassengerFilter            = NONE +INFANTRY
        ShowPips            = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset             = X:0 Y:0

        MeleeBehavior             = Amoeba
        End

        BannerCarriersAllowed    = DwarvenEreborBanner
        BannerCarrierPosition    = UnitType:DwarvenPhalanxErebor    Pos:X:70.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:DwarvenPhalanxErebor Position:X:50 Y:0        Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:50 Y:40        Position:X:50 Y:-40
        RankInfo = RankNumber:2 UnitType:DwarvenPhalanxErebor Position:X:30 Y:0 Leader 1 0    Position:X:30 Y:20 Leader 1 1    Position:X:30 Y:-20 Leader 1 2    Position:X:30 Y:40 Leader 1 3    Position:X:30 Y:-40 Leader 1 4


        RanksToReleaseWhenAttacking        = 1 2

        MeleeAttackLeashDistance        = 25
        BackUpMinDelayTime            = 1
        BackUpMaxDelayTime            = 3000
        BackUpMinDistance            = 1
        BackUpMaxDistance            = 3
        BackupPercentage            = 80%

        AlternateFormation            = DwarvenPhalanxEreborHordePorcupine
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

    Behavior = CommandButtonHuntUpdate ModuleTag_CommandButtonHuntUpdate
    End

       Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded        =    NONE
         AfraidOf            =    EMOTION_AFRAIDOF_OBJECTFILTER_LANCERS
        AlwaysAfraidOf            =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER_LANCERS
         PointAt                =    EMOTION_POINTAT_OBJECTFILTER_LANCERS
        HeroScanDistance        =    150
        FearScanDistance        =    INFANTRY_FEAR_SCAN_RADIUS

        AddEmotion            =    Terror_Base
        AddEmotion            =    Doom_Base
        AddEmotion            =    UncontrollableFear_Base
        AddEmotion            =    FearIdle_Base
        AddEmotion            =    FearBusy_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
        AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    HeroCheerIdle_Base
        AddEmotion            =    HeroCheerBusy_Base
        AddEmotion            =    Alert_Base
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End

    LocomotorSet
        Locomotor     = NormalChargeMeleeHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_FOOT_MED_HORDE_SPEED
    End

    LocomotorSet
        Locomotor     = ScaredMeleeHordeLocomotor
        Condition     = SET_SCARED
        Speed         = NORMAL_FOOT_MED_HORDE_SPEED
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy        = Upgrade_BasicTraining
        LevelsToGain        = 1
        LevelCap        = 2
    End

    CommandSet = DwarvenPhalanxHordeCommandSet_Langbarte

    Behavior = ObjectCreationUpgrade ModuleTag_MithrilMailPalantirFix
        TriggeredBy  = Upgrade_TechnologyDwarvenMithrilMail
        GrantUpgrade = Upgrade_HeavyArmor
    End

    Behavior = CommandSetUpgrade ModuleTag_MithrilCommandSet
        TriggeredBy       = Upgrade_TechnologyDwarvenMithrilMail
        CommandSet        = DwarvenPhalanxHordeCommandSet_Langbarte_Mithril
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegalityPhalanx
        TriggeredBy = Upgrade_ForgedBlades
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegalityPhalanx2
        TriggeredBy = Upgrade_DwarvenMithrilMail
    End
	
	Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality4
        TriggeredBy = Upgrade_DwarvenKriegsmaske
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality16
        TriggeredBy = Upgrade_LastStandZwerge
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality17
        TriggeredBy        = Upgrade_HeavyArmor
    End






    Behavior = AISpecialPowerUpdate DwarvenPhalanxHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End


    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 50.0
    GeometryHeight = 20.0
    GeometryIsSmall = No



    AutoResolveUnitType = AutoResolveUnit_Pikemen
    AutoResolveCombatChain = AutoResolve_PikemenCombatChain

    AutoResolveBody = AutoResolve_DwarvenPhalanxHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_DwarvenPhalanxHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_DwarvenPhalanxArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_DwarvenPhalanxUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_DwarvenPhalanxWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTraining Upgrade_ForgedBlades Upgrade_HeavyArmor
End

ChildObject DwarvenPhalanxEreborHordePorcupine DwarvenPhalanxEreborHorde

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle             = STANDARD_PIKEMAN_FRONTANGLE_FORMATION
        FlankedDelay             = STANDARD_PIKEMAN_FLANKEDDELAY
        ObjectStatusOfContained         =
        InitialPayload                = DwarvenPhalanxErebor 10
        Slots                    = 10
        PassengerFilter                = NONE +INFANTRY
        ShowPips                = No
        ThisFormationIsTheMainFormation     = No
        RandomOffset                = X:2 Y:1
        RanksToReleaseWhenAttacking        = 0
        RanksToJustFreeWhenAttacking           = 0
        AttributeModifiers            = DwarvenPhalanxHordePorcupine
        IsPorcupineFormation            = Yes
        MinimumHordeSize            = 5

        AlternateFormation            = DwarvenPhalanxEreborHorde
        VisionRearOverride            = 100%
        VisionSideOverride            = 100%
        NotComboFormation            = Yes


        BannerCarriersAllowed            = DwarvenEreborBanner
        BannerCarrierPosition            = UnitType:DwarvenPhalanxErebor    Pos:X:0.0 Y:0.0

        RankInfo    = RankNumber:1 UnitType:DwarvenPhalanxErebor    Position:X:-16.18 Y:11.76        Position:X:6.18 Y:-19.02    Position:X:6.18 Y:19.02    Position:X:-16.18 Y:-11.76    Position:X:26.77 Y:-29.73    Position:X:-4.18 Y:39.78    Position:X:-20 Y:-34.64    Position:X:26.77 Y:29.73    Position:X:-20 Y:34.64    Position:X:-4.18 Y:-39.78
    End
End

Object DwarvenPhalanxIronHillsHorde

    ButtonImage         = UIIronHillsSentry
    SelectPortrait      = UPIronHillsSentry

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER EMOTION_TERROR EMOTION_LOOK_TO_SKY SELECTED
        DefaultModelConditionState
            Model = None
        End

        ModelConditionState = HORDE_EMPTY
            Model = None
        End

        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkEUDFG
        End
    End

    Side            = Dwarves
    EditorSorting        = UNIT
    EmotionRange        = 240
    DisplayName        = OBJECT:HordeDwarvenPhalanxFeuerbarte
    DisplayNameStrategic     = CONTROLBAR:LW_Unit_DwarvenPhalanxFeuerbarteHorde
    DescriptionStrategic     = CONTROLBAR:LW_ToolTip_DwarvenPhalanxLangbarteHorde

    WeaponSet
        Conditions = None
        Weapon = PRIMARY    TowerGuardHordeRangefinder
    End



    #include "..\..\..\includes\StandardHordeEvaEvents.inc"
    #include "..\..\..\includes\DwarvenRunesUnits.inc"
        UnitSpecificSounds
        VoiceDesperateAttack  = GondorSoldierVoiceDesperateCharge
    End

    BuildCost            = 350
    BuildTime            = MEDIUM_BUILDTIME
    VisionRange            = 200
    ShroudClearingRange         = 250

    VisionSide             = 50%
    VisionRear             = 25%

    MaxVisionBonusPercent         = 300%
    VisionBonusTestRadius         = 200
    VisionBonusPercentPerFoot     = 1.0%
    CommandPoints            = 50

    FormationWidth             = 2
    FormationDepth             = 1

    CrushableLevel            = 0
    CrusherLevel            = 0

    TransportSlotCount = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE MELEE_HORDE NOTIFY_OF_PREATTACK ARMY_SUMMARY PIKE LARGE_RECTANGLE_PATHFIND

    ThreatLevel = DWARVEN_PHALANX_HORDE_THREAT
    ThreatBreakdown DwarvenPhalanxHorde_DetailedThreat
        AIKindOf = PIKEMAN
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = PikeHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle    = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate        = 500
        MaxCowerTime            = 5000
        MinCowerTime            = 3000
        CanAttackWhileContained        = Yes
        AILuaEventsList            = InfantryFunctions
        AttackPriority            = AttackPriority_Infantry
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle             = STANDARD_PIKEMAN_FRONTANGLE
        FlankedDelay             = STANDARD_PIKEMAN_FLANKEDDELAY
        ObjectStatusOfContained        =
        InitialPayload            = DwarvenPhalanxIronHills 10
        Slots                = 10
        PassengerFilter            = NONE +INFANTRY
        ShowPips            = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset             = X:0 Y:0

        MeleeBehavior             = Amoeba
        End


        BannerCarriersAllowed    = DwarvenIronHillsBanner
        BannerCarrierPosition    = UnitType:DwarvenPhalanxIronHills    Pos:X:70.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:DwarvenPhalanxIronHills Position:X:50 Y:0        Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:50 Y:40        Position:X:50 Y:-40
        RankInfo = RankNumber:2 UnitType:DwarvenPhalanxIronHills Position:X:30 Y:0 Leader 1 0    Position:X:30 Y:20 Leader 1 1    Position:X:30 Y:-20 Leader 1 2    Position:X:30 Y:40 Leader 1 3    Position:X:30 Y:-40 Leader 1 4

        RanksToReleaseWhenAttacking        = 1 2

        MeleeAttackLeashDistance        = 25
        BackUpMinDelayTime            = 1
        BackUpMaxDelayTime            = 3000
        BackUpMinDistance            = 1
        BackUpMaxDistance            = 3
        BackupPercentage            = 80%

        AlternateFormation            = DwarvenPhalanxIronHillsHordePorcupine
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

    Behavior = CommandButtonHuntUpdate ModuleTag_CommandButtonHuntUpdate
    End

       Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded        =    NONE
        AfraidOf            =    EMOTION_AFRAIDOF_OBJECTFILTER_LANCERS
        AlwaysAfraidOf            =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER_LANCERS
        PointAt                =    EMOTION_POINTAT_OBJECTFILTER_LANCERS
        HeroScanDistance        =    150
        FearScanDistance        =    INFANTRY_FEAR_SCAN_RADIUS

        AddEmotion            =    Terror_Base
        AddEmotion            =    Doom_Base
        AddEmotion            =    UncontrollableFear_Base
        AddEmotion            =    FearIdle_Base
        AddEmotion            =    FearBusy_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
        AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    HeroCheerIdle_Base
        AddEmotion            =    HeroCheerBusy_Base
        AddEmotion            =    Alert_Base
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End

    LocomotorSet
        Locomotor     = NormalChargeMeleeHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_FOOT_SLOW_HORDE_SPEED_IRONHILLS
    End

    LocomotorSet
        Locomotor     = ScaredMeleeHordeLocomotor
        Condition     = SET_SCARED
        Speed         = NORMAL_FOOT_SLOW_HORDE_SPEED_IRONHILLS
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End






 





    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy        = Upgrade_BasicTraining
        LevelsToGain        = 1
        LevelCap        = 2
    End

    CommandSet = DwarvenPhalanxHordeCommandSet_Feuerbarte

    Behavior = ObjectCreationUpgrade ModuleTag_MithrilMailPalantirFix
        TriggeredBy  = Upgrade_TechnologyDwarvenMithrilMail
        GrantUpgrade = Upgrade_HeavyArmor
    End

    Behavior = CommandSetUpgrade ModuleTag_MithrilCommandSet
        TriggeredBy       = Upgrade_TechnologyDwarvenMithrilMail
        CommandSet        = DwarvenPhalanxHordeCommandSet_Feuerbarte_Mithril
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegalityPhalanx
        TriggeredBy = Upgrade_ForgedBlades
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegalityPhalanx2
        TriggeredBy = Upgrade_DwarvenMithrilMail
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality16
        TriggeredBy = Upgrade_LastStandZwerge
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality17
        TriggeredBy        = Upgrade_HeavyArmor
    End






    Behavior = AISpecialPowerUpdate DwarvenPhalanxHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End


    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 50.0
    GeometryHeight = 20.0
    GeometryIsSmall = No



    AutoResolveUnitType = AutoResolveUnit_Pikemen
    AutoResolveCombatChain = AutoResolve_PikemenCombatChain

    AutoResolveBody = AutoResolve_DwarvenPhalanxHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_DwarvenPhalanxHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_DwarvenPhalanxArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_DwarvenPhalanxUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_DwarvenPhalanxWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTraining Upgrade_ForgedBlades Upgrade_HeavyArmor
End

ChildObject DwarvenPhalanxIronHillsHordePorcupine DwarvenPhalanxIronHillsHorde

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle                    = STANDARD_PIKEMAN_FRONTANGLE_FORMATION
        FlankedDelay                  = STANDARD_PIKEMAN_FLANKEDDELAY
        ObjectStatusOfContained       =
        InitialPayload                = DwarvenPhalanxIronHills 10
        Slots                         = 10
        PassengerFilter               = NONE +INFANTRY
        ShowPips                      = No
        ThisFormationIsTheMainFormation     = No
        RandomOffset                  = X:2 Y:1
        RanksToReleaseWhenAttacking   = 0
        RanksToJustFreeWhenAttacking  = 0
        AttributeModifiers            = DwarvenPhalanxHordePorcupine
        IsPorcupineFormation          = Yes
        MinimumHordeSize              = 5

        AlternateFormation            = DwarvenPhalanxIronHillsHorde
        VisionRearOverride            = 100%
        VisionSideOverride            = 100%
        NotComboFormation            = Yes


        BannerCarriersAllowed            = DwarvenIronHillsBanner
        BannerCarrierPosition            = UnitType:DwarvenPhalanxIronHills    Pos:X:0.0 Y:0.0

        RankInfo    = RankNumber:1 UnitType:DwarvenPhalanxIronHills    Position:X:-16.18 Y:11.76        Position:X:6.18 Y:-19.02    Position:X:6.18 Y:19.02    Position:X:-16.18 Y:-11.76    Position:X:26.77 Y:-29.73    Position:X:-4.18 Y:39.78    Position:X:-20 Y:-34.64    Position:X:26.77 Y:29.73    Position:X:-20 Y:34.64    Position:X:-4.18 Y:-39.78
    End
End