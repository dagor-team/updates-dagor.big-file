Object ElvenRivendellLancerHorde

    ButtonImage        = WOR_RivendellLancer
    SelectPortrait    = UPElven_RivendellLancer

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR EMOTION_CELEBRATING
        DefaultModelConditionState
            Model = None
        End
        ModelConditionState = HORDE_EMPTY
            Model = None
        End
        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkEURIL
        End
    End

    Side            = Elves
    EditorSorting        = UNIT
    EmotionRange        = 240
    DisplayName        = OBJECT:HordeElvenRivendellLancer
    DisplayNameStrategic     = CONTROLBAR:LW_Unit_ElvenRivendellLancerHorde
    DescriptionStrategic     = CONTROLBAR:LW_ToolTip_ElvenRivendellLancerHorde

    WeaponSet
        Conditions    = None
        Weapon        = PRIMARY    NormalMeleeHordeRangefinder
    End





    #include "..\..\..\includes\StandardHordeEvaEvents.inc"

    BuildCost        = ELVEN_RIVENDELLLANCER_BUILDCOST
    BuildTime        = STRONG_BUILDTIME
    VisionRange        = ELVEN_RIVENDELLLANCER_HORDE_VISION_RANGE
        VisionSide     = 50%
    VisionRear         = 25%
    VisionBonusPercentPerFoot = 1.0%
    ShroudClearingRange     = ELVEN_RIVENDELLLANCER_SHROUD_RANGE
    CommandPoints        = 60

    FormationWidth         = 2
    FormationDepth         = 1

    CrushableLevel                = 2
    CrusherLevel                = 1
    MinCrushVelocityPercent = MINCRUSHVELOCITYPERCENT_STANDARD
    CrushDecelerationPercent = CRUSHDECELERATIONPERCENT_STANDARD
    CrushKnockback                = 40
    CrushZFactor                = 1.0

        TransportSlotCount            = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf                    = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT CAVALRY HORDE MELEE_HORDE  ARMY_SUMMARY LARGE_RECTANGLE_PATHFIND
    CommandSet                = ElvenRivendellLancerHordeCommandSet

    ThreatLevel = ELVEN_RIVENDELLLANCER_HORDE_THREAT
    ThreatBreakdown ElvenRivendellLancerHorde_DetailedThreat
        AIKindOf = CAVALRY
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = CavalryHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle    = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate        = 500
        MaxCowerTime            = 5000
        MinCowerTime            = 3000
        AILuaEventsList            = CavalryFunctions
        AttackPriority            = AttackPriority_Cavalry
    End

    Behavior = HorseHordeContain ModuleTag_HordeContain
        FrontAngle             = STANDARD_PIKEMAN_FRONTANGLE
        FlankedDelay             = STANDARD_PIKEMAN_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload         = ElvenRivendellLancer  GOOD_RIDER_LARGE_HORDE_SIZE
        Slots             = 10
        PassengerFilter     = NONE +CAVALRY +ElvenRivendellLancerBanner
        ShowPips         = No
        RandomOffset         = X:2 y:3
        MeleeBehavior         = Amoeba
        End

        ThisFormationIsTheMainFormation = Yes


        BannerCarriersAllowed    = ElvenRivendellLancerBanner
        BannerCarrierPosition    = UnitType:ElvenRivendellLancer    Pos:X:70.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:ElvenRivendellLancer Position:X:40 Y:0            Position:X:40 Y:20        Position:X:40 Y:-20        Position:X:40 Y:40        Position:X:40 Y:-40
        RankInfo = RankNumber:2 UnitType:ElvenRivendellLancer Position:X:10 Y:0 Leader 1 0    Position:X:10 Y:20 Leader 1 1    Position:X:10 Y:-20 Leader 1 2    Position:X:10 Y:40 Leader 1 3    Position:X:10 Y:-40 Leader 1 4

        RanksToReleaseWhenAttacking = 1 2

        MeleeAttackLeashDistance     = 1
        BackUpMinDelayTime        = 1
        BackUpMaxDelayTime        = 3000
        BackUpMinDistance        = 1
        BackUpMaxDistance        = 3
        BackupPercentage        = 80%
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

    Behavior = HordeNotifyTargetsOfImminentProbableCrushingUpdate ModuleTag_NotifyCrushScan
        ScanWidth = 70.0
    End

    Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
         TauntAndPointUpdateDelay    =    1000
         TauntAndPointExcluded        =    NONE
        AfraidOf            =    EMOTION_AFRAIDOF_OBJECTFILTER_LANCERS
        AlwaysAfraidOf            =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER_LANCERS
         PointAt                =    EMOTION_POINTAT_OBJECTFILTER_LANCERS
         HeroScanDistance        =    150
         FearScanDistance        =    CAVALRY_FEAR_SCAN_RADIUS

        AddEmotion            =    Terror_Base
        AddEmotion            =    Doom_Base
        AddEmotion            =       BraceForBeingCrushed_Base
        AddEmotion            =    UncontrollableFear_Base
        AddEmotion            =    FearIdle_Base
        AddEmotion            =    FearBusy_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
         AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    HeroCheerIdle_Base
        AddEmotion            =    HeroCheerBusy_Base
        AddEmotion            =    Alert_Base
        AddEmotion            =       CheerForAboutToCrush_Base
     End

    LocomotorSet
        Locomotor     = NormalCavalryHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_MOUNTED_VERYFAST_HORDE_SPEED
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTraining
        LevelsToGain = 1
        LevelCap = 2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality
        TriggeredBy = Upgrade_ForgedBlades
    End


    Behavior = AISpecialPowerUpdate RivendellLancerHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End






    Behavior = AISpecialPowerUpdate ElvenMirkwoodArcherHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 40.0
    GeometryHeight = 20.0
    GeometryIsSmall = No




    AutoResolveUnitType = AutoResolveUnit_Cavalry
    AutoResolveCombatChain = AutoResolve_CavalryCombatChain

    AutoResolveBody = AutoResolve_ElvenRivendellLancerHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_ElvenRivendellLancerHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_ElvenRivendellLancerArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_ElvenRivendellLancerUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_ElvenRivendellLancerWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTraining Upgrade_ForgedBlades Upgrade_HeavyArmor
End

Object ElvenLorienWarriorHorde

    ButtonImage            = UPElven_LorienWarrior ;WOR_LorienWarrior
    SelectPortrait         = UPElven_LorienWarrior

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags     = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR
        DefaultModelConditionState
            Model         = None
        End
        ModelConditionState     = HORDE_EMPTY
            Model         = None
        End
        ModelConditionState     = WORLD_BUILDER
            Model         = HordeMarkEULoW
        End
    End

    Side                 = Lothlorien
    EditorSorting        = UNIT
    EmotionRange         = 240
    DisplayName          = OBJECT:ElvenLorienWarriorHorde
    DisplayNameStrategic     = CONTROLBAR:LW_Unit_ElvenLorienWarriorHorde
    DescriptionStrategic     = CONTROLBAR:LW_ToolTip_ElvenLorienWarriorHorde

    WeaponSet
        Conditions     = None
        Weapon         = PRIMARY    NormalMeleeHordeRangefinder
    End
    WeaponSet
        Conditions     = CONTAINED
        Weapon         = PRIMARY GarrisonedUnitBowHordeRangefinder
    End

    CommandSet         = ElvenLorienWarriorHordeCommandSet_Edain





    #include "..\..\..\includes\StandardHordeEvaEvents.inc"


     CrushableLevel         = 0
    CrusherLevel         = 0

    BuildCost         = 250
    BuildTime         = WEAK_BUILDTIME
    VisionRange       = 200
    VisionSide        = 50%
    VisionRear        = 25%
    VisionBonusPercentPerFoot = 1.0%
    ShroudClearingRange     = 400
    CommandPoints         = 40

    FormationWidth         = 2
    FormationDepth         = 1

    TransportSlotCount         = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf             = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE ARMY_SUMMARY MELEE_HORDE LARGE_RECTANGLE_PATHFIND

    CamouflageDetectionMultiplier     = CAMOUFLAGE_DETECTION_DISTANCE_LONG

    ThreatLevel         = ELVEN_LORIENWARRIOR_HORDE_THREAT
    ThreatBreakdown ElvenLorienWarriorHorde_DetailedThreat
        AIKindOf     = INFANTRY
    End

    Body             = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth     = 1
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = FighterHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle     = Yes ATTACK_BUILDINGS STEALTHED
        MoodAttackCheckRate            = 500
        MaxCowerTime            = 5000
        MinCowerTime            = 3000
        CanAttackWhileContained        = Yes
        AILuaEventsList                = InfantryFunctions
        AttackPriority                = AttackPriority_Archer
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay         = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained     =
        InitialPayload             = ElvenLorienWarrior 10
        Slots                 = 10
        PassengerFilter            = NONE +INFANTRY
        ShowPips             = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset            = X:0 Y:0
        MeleeBehavior             = Amoeba
        End


        BannerCarriersAllowed        = ElvenBanner
        BannerCarrierPosition        = UnitType:ElvenLorienWarrior    Pos:X:70.0 Y:0.0


        RankInfo = RankNumber:1 UnitType:ElvenLorienWarrior Position:X:50 Y:0            Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:50 Y:40        Position:X:50 Y:-40
        RankInfo = RankNumber:2 UnitType:ElvenLorienWarrior Position:X:30 Y:0 Leader 1 0    Position:X:30 Y:20 Leader 1 1    Position:X:30 Y:-20 Leader 1 2    Position:X:30 Y:40 Leader 1 3    Position:X:30 Y:-40 Leader 1 4



        RanksToReleaseWhenAttacking = 1  2

        MeleeAttackLeashDistance     = 1
        BackUpMinDelayTime        = 1
        BackUpMaxDelayTime        = 3000
        BackUpMinDistance        = 1
        BackUpMaxDistance        = 3
        BackupPercentage        = 80%
    End

    #include "..\..\..\includes\DefaultInvisibilityUpdate.inc"

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

     Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance       =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded       =    NONE
        AfraidOf                    =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf              =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
        PointAt                     =    EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance            =    150
        FearScanDistance            =    ARCHER_FEAR_SCAN_RADIUS

        AddEmotion    =    Terror_Base
        AddEmotion    =    Doom_Base
        AddEmotion    =       BraceForBeingCrushed_Base
        AddEmotion    =    UncontrollableFear_Base
        AddEmotion    =    FearIdle_Base
        AddEmotion    =    FearBusy_Base
        AddEmotion    =    Point_Base
        AddEmotion    =    Taunt_Base
        AddEmotion    =    CheerIdle_Base
        AddEmotion    =    CheerBusy_Base
        AddEmotion    =    HeroCheerIdle_Base
        AddEmotion    =    HeroCheerBusy_Base
        AddEmotion    =    Alert_Base
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly         = Yes
        StuffToPickUp         = ANY +CRATE -TheDroppedRing
        ScanRange         = 200
        ScanIntervalSeconds     = 0.5
    End

    LocomotorSet
        Locomotor         = NormalMeleeHordeLocomotor
        Condition         = SET_NORMAL
        Speed             = NORMAL_FOOT_VERYFAST_HORDE_SPEED
    End


    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior         = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy     = Upgrade_BasicTraining
        LevelsToGain     = 1
        LevelCap     = 2
    End





    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_ForgedBlades
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality3
        TriggeredBy = Upgrade_SilverThornArrows
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality4
        TriggeredBy = Upgrade_TechnologyLothlorienLembasbrotAktive
    End

    Behavior = SpecialPowerModule ModuleTag_Lembasbrot
        SpecialPowerTemplate     = SpecialAbilityLembasbrotHealSpell
        UpdateModuleStartsAttack = Yes
    End

    Behavior = SpecialAbilityUpdate ModuleTag_LembasbrotUpdate
        SpecialPowerTemplate     = SpecialAbilityLembasbrotHealSpell
        StartAbilityRange        = 1.6
        UnpackTime               = 1
        PreparationTime          = 3
        PackTime                 = 2096
        AwardXPForTriggering     = 0
    End

    Behavior = AutoHealBehavior ModuleTag_LembasbrotHealing
        StartsActive             = Yes
        ButtonTriggered          = Yes
        HealingAmount            = 300
        Radius                   = 55
        HealOnlyOthers           = No
        SingleBurst              = Yes
        UnitHealPulseFX          = FX_SpellLembasbrotHealUnitHealBuff
        KindOf                   = INFANTRY
    End







    Behavior = AISpecialPowerUpdate ElvenLorienWarriorHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Behavior = AISpecialPowerUpdate Lembas_AI
        CommandButtonName  = Command_SpecialAbilityLembasbrotHealSpell
        SpecialPowerAIType = AI_SPECIAL_POWER_SELFAOEHEALHEROS
    End

    Geometry         = BOX
    GeometryMajorRadius     = 30.0
    GeometryMinorRadius     = 50.0
    GeometryHeight         = 20.0
    GeometryIsSmall     = No




    AutoResolveUnitType = AutoResolveUnit_Soldier
    AutoResolveCombatChain = AutoResolve_SoldierCombatChain

    AutoResolveBody = AutoResolve_ElvenLorienWarriorHordeBody

    AutoResolveArmor
        Armor = AutoResolve_ElvenLorienWarriorHeavyArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_ElvenLorienWarriorUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_ElvenLorienWarriorWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTraining Upgrade_ForgedBlades
End



Object ElvenMithlondSentryHorde


    ButtonImage            = WOR_MithlondSentry
    SelectPortrait         = UPElven_MithlondSentry


    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags     = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR
        DefaultModelConditionState
            Model     = None
        End
        ModelConditionState = HORDE_EMPTY
            Model = None
        End
        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkEULoW
        End
    End

    Side         = Elves
    EditorSorting     = UNIT
    EmotionRange     = 240
    DisplayName     = OBJECT:HordeMithlondSentry
    DisplayNameStrategic = CONTROLBAR:LW_Unit_ElvenMithlondSentryHorde
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_ElvenMithlondSentryHorde

    WeaponSet
        Conditions     = None
        Weapon         = PRIMARY    TowerGuardHordeRangefinder
    End
    WeaponSet
        Conditions     = CONTAINED
        Weapon     = PRIMARY GarrisonedUnitBowHordeRangefinder
    End

    CommandSet = ElvenMithlondSentryHordeCommandSet





    #include "..\..\..\includes\StandardHordeEvaEvents.inc"


     CrushableLevel = 0
    CrusherLevel = 0

    BuildCost         = 300
    BuildTime         = MEDIUM_BUILDTIME
    VisionRange         = ELVEN_MITHLONDSENTRY_HORDE_VISION_RANGE
    VisionSide         = 50%
    VisionRear         = 25%
    VisionBonusPercentPerFoot = 1.0%
    ShroudClearingRange     = ELVEN_MITHLONDSENTRY_SHROUD_RANGE
    CommandPoints         = 50

    FormationWidth = 2
    FormationDepth = 1

    TransportSlotCount = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE ARMY_SUMMARY MELEE_HORDE LARGE_RECTANGLE_PATHFIND PIKE

    ThreatLevel = ELVEN_MITHLONDSENTRY_HORDE_THREAT
    ThreatBreakdown ElvenMithlondSentryHorde_DetailedThreat
        AIKindOf = PIKEMAN
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = PikeHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle     = Yes ATTACK_BUILDINGS STEALTHED
        MoodAttackCheckRate            = 500
        MaxCowerTime            = 5000
        MinCowerTime            = 3000
        CanAttackWhileContained        = Yes
        AILuaEventsList                = InfantryFunctions
        AttackPriority                = AttackPriority_Archer
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle             = STANDARD_PIKEMAN_FRONTANGLE
        FlankedDelay             = STANDARD_PIKEMAN_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload         = ElvenMithlondSentry 10
        Slots             = 10
        PassengerFilter     = NONE +INFANTRY
        ShowPips         = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset         = X:0 Y:0
        MeleeBehavior         = Amoeba
        End


        BannerCarriersAllowed    = ElvenBanner
        BannerCarrierPosition    = UnitType:ElvenMithlondSentry    Pos:X:70.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:ElvenMithlondSentry Position:X:50 Y:0        Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:50 Y:40        Position:X:50 Y:-40
        RankInfo = RankNumber:2 UnitType:ElvenMithlondSentry Position:X:30 Y:0 Leader 1 0    Position:X:30 Y:20 Leader 1 1    Position:X:30 Y:-20 Leader 1 2    Position:X:30 Y:40 Leader 1 3    Position:X:30 Y:-40 Leader 1 4

        RanksToReleaseWhenAttacking     = 1 2

        MeleeAttackLeashDistance     = 1
        BackUpMinDelayTime        = 1
        BackUpMaxDelayTime        = 3000
        BackUpMinDistance        = 1
        BackUpMaxDistance        = 3
        BackupPercentage        = 80%

        AlternateFormation = ElvenMithlondSentryHordePorcupine
    End

    #include "..\..\..\includes\DefaultInvisibilityUpdate.inc"

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

     Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded        =    NONE
        AfraidOf            =    EMOTION_AFRAIDOF_OBJECTFILTER_LANCERS
        AlwaysAfraidOf            =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER_LANCERS
         PointAt                =    EMOTION_POINTAT_OBJECTFILTER_LANCERS
        HeroScanDistance        =    150
        FearScanDistance        =    INFANTRY_FEAR_SCAN_RADIUS



        AddEmotion    =    Terror_Base
        AddEmotion    =    Doom_Base

        AddEmotion    =    UncontrollableFear_Base
        AddEmotion    =    FearIdle_Base
        AddEmotion    =    FearBusy_Base
        AddEmotion    =    Point_Base
        AddEmotion    =    Taunt_Base
        AddEmotion    =    CheerIdle_Base
        AddEmotion    =    CheerBusy_Base
        AddEmotion    =    HeroCheerIdle_Base
        AddEmotion    =    HeroCheerBusy_Base
        AddEmotion    =    Alert_Base
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End

    LocomotorSet
        Locomotor     = NormalMeleeHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_FOOT_MED_HORDE_SPEED
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTraining
        LevelsToGain = 1
        LevelCap = 2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality
        TriggeredBy = Upgrade_HeavyArmor
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_ForgedBlades
    End

    Behavior = HordeDispatchSpecialPower ModuleTag_ZephyrStrike
        SpecialPowerTemplate        = SpecialAbilityZephyrStrike
        UpdateModuleStartsAttack    = Yes
        StartsPaused                  = No
    End

    #include "..\..\includes\zephyrstrike.inc"





    Behavior = AISpecialPowerUpdate ElvenMithlondSentryHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End


    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 45.0
    GeometryHeight = 20.0
    GeometryIsSmall = No




    AutoResolveUnitType = AutoResolveUnit_Pikemen
    AutoResolveCombatChain = AutoResolve_PikemenCombatChain

    AutoResolveBody = AutoResolve_ElvenMithlondSentryHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_ElvenMithlondSentryHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_ElvenMithlondSentryArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_ElvenMithlondSentryUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_ElvenMithlondSentryWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTraining Upgrade_ForgedBlades Upgrade_HeavyArmor
End

ChildObject ElvenMithlondSentryHordePorcupine ElvenMithlondSentryHorde

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle             = STANDARD_PIKEMAN_FRONTANGLE_FORMATION
        FlankedDelay             = STANDARD_PIKEMAN_FLANKEDDELAY
        ObjectStatusOfContained         =
        InitialPayload                = ElvenMithlondSentry 10
        Slots                    = 10
        PassengerFilter                = NONE +INFANTRY
        ShowPips                = No
        ThisFormationIsTheMainFormation     = No
        RandomOffset                = X:2 Y:1
        RanksToReleaseWhenAttacking        = 0
        RanksToJustFreeWhenAttacking           = 0
        AttributeModifiers            = ElvenMithlondSentryHordePorcupine
        IsPorcupineFormation            = Yes
        MinimumHordeSize            = 5

        AlternateFormation            = ElvenMithlondSentryHorde
        VisionRearOverride            = 100%
        VisionSideOverride            = 100%
        NotComboFormation            = Yes


        BannerCarriersAllowed    = ElvenBanner
        BannerCarrierPosition    = UnitType:ElvenMithlondSentry    Pos:X:0.0 Y:0.0

        RankInfo        = RankNumber:1 UnitType:ElvenMithlondSentry Position:X:20 Y:0    Position:X:-16.18 Y:11.76        Position:X:6.18 Y:-19.02    Position:X:6.18 Y:19.02    Position:X:-16.18 Y:-11.76    Position:X:36.54 Y:16.27    Position:X:-39.13 Y:8.32    Position:X:26.77 Y:-29.73    Position:X:-4.18 Y:39.78    Position:X:-20 Y:-34.64
   End
End



Object NoldorWarriorHorde


    ButtonImage     = WOR_NoldorWarrior
    SelectPortrait  = UPNoldorWarriorPortrait


    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR
        DefaultModelConditionState
            Model = None
        End
        ModelConditionState = HORDE_EMPTY
            Model = None
        End
        ModelConditionState = WORLD_BUILDER
            Model = HordeTemp_5By2
        End
    End

    Side         = Elves
    EditorSorting     = UNIT
    EmotionRange     = 240
    DisplayName     = OBJECT:HordeNoldorWarrior
    DisplayNameStrategic = CONTROLBAR:LW_Unit_ElvenNoldorWarriorHorde
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_ElvenNoldorWarriorHorde

    MaxSimultaneousOfType    = 3

    WeaponSet
        Conditions = None
        Weapon         = PRIMARY        MirkwoodArcherMissileHordeRangefinder
        Weapon         = TERTIARY    MirkwoodArcherMissileHordeRangefinderBombard
        AutoChooseSources = TERTIARY FROM_PLAYER FROM_SCRIPT
    End
    WeaponSet
        Conditions = WEAPONSET_TOGGLE_1
        Weapon         = PRIMARY    NormalMeleeHordeRangefinder
        Weapon         = TERTIARY    MirkwoodArcherMissileHordeRangefinderBombard
        AutoChooseSources = TERTIARY FROM_PLAYER FROM_SCRIPT
    End

    CommandSet = NoldorWarriorHordeCommandSet






     CrushableLevel = 0
    CrusherLevel = 0

    BuildCost = ELVEN_NOLDORWARRIOR_BUILDCOST
    BuildTime = STRONG_BUILDTIME
    VisionRange = ELVEN_NOLDORWARRIOR_HORDE_VISION_RANGE
    ShroudClearingRange = 161
    CommandPoints = 96

    FormationWidth = 2
    FormationDepth = 1



    TransportSlotCount = TRANSPORTSLOTCOUNT_LARGE_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE ARCHER MELEE_HORDE

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = FighterHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle     = Yes ATTACK_BUILDINGS STEALTHED
        MoodAttackCheckRate            = 500
        MaxCowerTime            = 5000
        MinCowerTime            = 3000
        CanAttackWhileContained        = Yes
        AILuaEventsList                = InfantryFunctions
        AttackPriority                = AttackPriority_Archer
    End

    Behavior = HordeContain ModuleTag_HordeContain
        ObjectStatusOfContained     =
        InitialPayload             = NoldorWarrior 6
        Slots                 = 6
        PassengerFilter         = NONE +INFANTRY
        ShowPips             = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset             = X:0 Y:0

        MeleeBehavior = Amoeba
        End


        RankInfo = RankNumber:1 UnitType:NoldorWarrior     Position:X:50 Y:7.5        Position:X:50 Y:-7.5        Position:X:50 Y:25        Position:X:50 Y:-25        Position:X:50 Y:42.5        Position:X:50 Y:-42.5


        RanksToReleaseWhenAttacking = 1
    End

    Behavior = StealthUpdate StealthUpdateModuleTag
        StealthDelay                    = 500
        FriendlyOpacityMin                = STEALTH_FRIENDLY_OPACITY_MIN
        FriendlyOpacityMax                = STEALTH_FRIENDLY_OPACITY_MAX
        PulseFrequency                    = 750
        StealthForbiddenConditions            = AWAY_FROM_TREES ATTACKING
        OrderIdleEnemiesToAttackMeUponReveal        = Yes
        DetectedByAnyoneRange                = 120
        RevealWeaponSets                = CLOSE_RANGE CONTESTING_BUILDING
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

     Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded        =    NONE


         PointAt                =    NONE +MordorFellBeast +MordorWitchKingOnFellBeast +GondorGwaihir
        HeroScanDistance        =    150
        FearScanDistance        =    INFANTRY_FEAR_SCAN_RADIUS



        AddEmotion    =    Terror_Base
        AddEmotion    =    Doom_Base
        AddEmotion    =       BraceForBeingCrushed_Base
        AddEmotion    =    UncontrollableFear_Base
        AddEmotion    =    FearIdle_Base
        AddEmotion    =    FearBusy_Base
        AddEmotion    =    Point_Base
        AddEmotion    =    Taunt_Base
        AddEmotion    =    CheerIdle_Base
        AddEmotion    =    CheerBusy_Base
        AddEmotion    =    HeroCheerIdle_Base
        AddEmotion    =    HeroCheerBusy_Base
        AddEmotion    =    Alert_Base
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_ForgedBlades
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality3
        TriggeredBy = Upgrade_SilverThornArrows
    End




    Behavior = AutoHealBehavior ModuleTag_HearthHeal
        StartsActive            = No
        HealOnlyIfNotInCombat         = Yes
        HealOnlyIfNotUnderAttack    = Yes
        TriggeredBy            = Upgrade_MiniHordeLvl3
        HealingAmount            = 30
        Radius                = 100
        StartHealingDelay         = 7500
        HealingDelay            = 5000
        UnitHealPulseFX            = FX_SpellHealUnitHealBuff
        NonStackable            = Yes
        RespawnNearbyHordeMembers     = Yes
        RespawnFXList            = FX_BannerCarrierSpawnUnit
        RespawnMinimumDelay        = 200
    End


    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_GlorfindelBladeOfPurityEnabler
        SpecialPowerTemplate        = SpecialAbilityGlorfindelBladeOfPurity
        TriggeredBy            = Upgrade_MiniHordeLvl7
    End
      Behavior = SpecialPowerModule ModuleTag_GlorfindelBladeOfPurityStarter
        SpecialPowerTemplate        = SpecialAbilityGlorfindelBladeOfPurity
        StartsPaused            = Yes
        SetModelCondition        = ModelConditionState:USER_1
        SetModelConditionTime        = 2.0
    End
    Behavior = SpecialAbilityUpdate ModuleTag_GlorfindelBladeOfPurityUpdate
        SpecialPowerTemplate        = SpecialAbilityGlorfindelBladeOfPurity
        TriggerAttributeModifier    = NoldorWeaponSong
        AttributeModifierDuration    = 30000
    End
    Behavior = AutoAbilityBehavior ModuleTag_BladeOfPurityAutoAbility
        SpecialAbility            = SpecialAbilityGlorfindelBladeOfPurity
        MaxScanRange            = 200
        Query                = 1 ALL ENEMIES
    End

    LocomotorSet
        Locomotor     = NormalMeleeHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_GOOD_FAST_HORDE_SPEED
    End


    #include "..\..\..\includes\CaptureBuilding.inc"





    Behavior = AISpecialPowerUpdate ElvenLorienWarriorHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Behavior = AISpecialPowerUpdate NoldorWeaponSongAI
        CommandButtonName = Command_SpecialAbilityNoldorWeaponSong
        SpecialPowerAIType = AI_SPECIAL_POWER_BASIC_SELF_BUFF
    End

    Behavior = AISpecialPowerUpdate LindonWarriorHordeToggleWeapon
        CommandButtonName = Command_ToggleElvenWarriorWeapon
        SpecialPowerAIType = AI_SPECIAL_POWER_TOGGLE_MELEE_AND_RANGE
    End


    Geometry = BOX
    GeometryMajorRadius = 20.0
    GeometryMinorRadius = 50.0
    GeometryHeight = 20.0
    GeometryIsSmall = No
End









Object ElvenRivendellArcherHorde


    ButtonImage        = WOR_RivendellArcher
    SelectPortrait        = UPHorseArcherPortrait

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR EMOTION_CELEBRATING
        DefaultModelConditionState
            Model = None
        End
        ModelConditionState = HORDE_EMPTY
            Model = None
        End
        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkEURIL
        End
    End

    Side            = Elves
    EditorSorting        = UNIT
    EmotionRange        = 240
    DisplayName        = OBJECT:HordeElvenRivendellArcher
    DisplayNameStrategic     = CONTROLBAR:LW_Unit_ElvenRivendellArcherHorde
    DescriptionStrategic     = CONTROLBAR:LW_ToolTip_ElvenRivendellArcherHorde

    WeaponSet
        Conditions    = None
        Weapon        = PRIMARY    NormalMissileHordeRangefinder
    End





    #include "..\..\..\includes\StandardHordeEvaEvents.inc"

    BuildCost        = ELVEN_RIVENDELLARCHER_BUILDCOST
    BuildTime        = STRONG_BUILDTIME
    VisionRange        = ELVEN_RIVENDELLARCHER_HORDE_VISION_RANGE
        VisionSide     = 50%
    VisionRear         = 25%
    VisionBonusPercentPerFoot = 1.0%
    ShroudClearingRange     = ELVEN_RIVENDELLARCHER_SHROUD_RANGE
    CommandPoints        = 80

    FormationWidth         = 2
    FormationDepth         = 1

    CrushableLevel                = 2
    CrusherLevel                = 1
    MinCrushVelocityPercent = MINCRUSHVELOCITYPERCENT_STANDARD
    CrushDecelerationPercent = CRUSHDECELERATIONPERCENT_STANDARD
    CrushKnockback                = 40
    CrushZFactor                = 1.0

        TransportSlotCount            = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf                    = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT CAVALRY HORDE MELEE_HORDE  ARMY_SUMMARY LARGE_RECTANGLE_PATHFIND
    CommandSet                = ElvenRivendellArcherHordeCommandSet

    ThreatLevel = ELVEN_RIVENDELLARCHER_HORDE_THREAT
    ThreatBreakdown ElvenRivendellLancerHorde_DetailedThreat
        AIKindOf = CAVALRY
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = CavalryHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle    = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate        = 500
        MaxCowerTime            = 5000
        MinCowerTime            = 3000
        AILuaEventsList            = CavalryFunctions
        AttackPriority            = AttackPriority_Cavalry
    End

    Behavior = HorseHordeContain ModuleTag_HordeContain
        FrontAngle = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay         = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload         = ElvenRivendellArcher  GOOD_RIDER_LARGE_HORDE_SIZE
        Slots             = 10
        PassengerFilter     = NONE +CAVALRY +ElvenRivendellLancerBanner +ElvenRivendellArcherBanner
        ShowPips         = No
        RandomOffset         = X:2 y:3
        MeleeBehavior         = Amoeba
        End

        ThisFormationIsTheMainFormation = Yes


        BannerCarriersAllowed    = ElvenRivendellArcherBanner
        BannerCarrierPosition    = UnitType:ElvenRivendellLancer    Pos:X:75.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:ElvenRivendellArcher Position:X:45 Y:0            Position:X:45 Y:20        Position:X:45 Y:-20        Position:X:45 Y:40        Position:X:45 Y:-40
        RankInfo = RankNumber:2 UnitType:ElvenRivendellArcher Position:X:10 Y:0 Leader 1 0    Position:X:10 Y:20 Leader 1 1    Position:X:10 Y:-20 Leader 1 2    Position:X:10 Y:40 Leader 1 3    Position:X:10 Y:-40 Leader 1 4

        RanksToReleaseWhenAttacking = 1 2

        MeleeAttackLeashDistance     = 1
        BackUpMinDelayTime        = 1
        BackUpMaxDelayTime        = 3000
        BackUpMinDistance        = 1
        BackUpMaxDistance        = 3
        BackupPercentage        = 80%
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

    Behavior = HordeNotifyTargetsOfImminentProbableCrushingUpdate ModuleTag_NotifyCrushScan
        ScanWidth = 70.0
    End

    Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
         TauntAndPointUpdateDelay    =    1000
         TauntAndPointExcluded        =    NONE
        AfraidOf            =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf            =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
         PointAt                =    EMOTION_POINTAT_OBJECTFILTER
         HeroScanDistance        =    150
         FearScanDistance        =    CAVALRY_FEAR_SCAN_RADIUS

        AddEmotion            =    Terror_Base
        AddEmotion            =    Doom_Base
        AddEmotion            =       BraceForBeingCrushed_Base
        AddEmotion            =    UncontrollableFear_Base
        AddEmotion            =    FearIdle_Base
        AddEmotion            =    FearBusy_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
         AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    HeroCheerIdle_Base
        AddEmotion            =    HeroCheerBusy_Base
        AddEmotion            =    Alert_Base
        AddEmotion            =       CheerForAboutToCrush_Base
     End

    LocomotorSet
        Locomotor     = NormalCavalryHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_MOUNTED_VERYFAST_HORDE_SPEED
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTraining
        LevelsToGain = 1
        LevelCap = 2
    End


    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality
        TriggeredBy = Upgrade_SilverThornArrows
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_HeavyArmor
    End


    Behavior = AISpecialPowerUpdate RivendellLancerHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End






    Behavior = AISpecialPowerUpdate ElvenMirkwoodArcherHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 40.0
    GeometryHeight = 20.0
    GeometryIsSmall = No




    AutoResolveUnitType = AutoResolveUnit_Cavalry
    AutoResolveCombatChain = AutoResolve_CavalryCombatChain

    AutoResolveBody = AutoResolve_ElvenRivendellLancerHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_ElvenRivendellLancerHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_ElvenRivendellLancerArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_SilverThornArrows
        Weapon = AutoResolve_ElvenLorienArcherUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_SilverThornArrows
        Weapon = AutoResolve_ElvenLorienArcherWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTraining Upgrade_SilverThornArrows Upgrade_HeavyArmor
End

Object ElvenRivendellArcherHordeMod


    ButtonImage        = WOR_RivendellArcher
    SelectPortrait        = UPHorseArcherPortrait

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR EMOTION_CELEBRATING
        DefaultModelConditionState
            Model = None
        End
        ModelConditionState = HORDE_EMPTY
            Model = None
        End
        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkEURIL
        End
    End

    Side            = Elves
    EditorSorting        = UNIT
    EmotionRange        = 240
    DisplayName        = OBJECT:HordeElvenRivendellArcher
    DisplayNameStrategic     = CONTROLBAR:LW_Unit_ElvenRivendellArcherHorde
    DescriptionStrategic     = CONTROLBAR:LW_ToolTip_ElvenRivendellArcherHorde

    WeaponSet
        Conditions    = None
        Weapon        = PRIMARY    NormalMissileHordeRangefinder
    End





    #include "..\..\..\includes\StandardHordeEvaEvents.inc"

    BuildCost        = ELVEN_RIVENDELLARCHER_BUILDCOST
    BuildTime        = MEDIUM_BUILDTIME
    VisionRange        = ELVEN_RIVENDELLARCHER_HORDE_VISION_RANGE
        VisionSide     = 50%
    VisionRear         = 25%
    VisionBonusPercentPerFoot = 1.0%
    ShroudClearingRange     = ELVEN_RIVENDELLARCHER_SHROUD_RANGE
    CommandPoints        = 50

    FormationWidth         = 2
    FormationDepth         = 1

    CrushableLevel                = 2
    CrusherLevel                = 1
    MinCrushVelocityPercent = MINCRUSHVELOCITYPERCENT_STANDARD
    CrushDecelerationPercent = CRUSHDECELERATIONPERCENT_STANDARD
    CrushKnockback                = 40
    CrushZFactor                = 1.0

        TransportSlotCount            = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf                    = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT CAVALRY HORDE MELEE_HORDE  ARMY_SUMMARY LARGE_RECTANGLE_PATHFIND
    CommandSet                = ElvenRivendellArcherHordeModCommandSet

    ThreatLevel = ELVEN_RIVENDELLARCHER_HORDE_THREAT
    ThreatBreakdown ElvenRivendellLancerHorde_DetailedThreat
        AIKindOf = CAVALRY
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = CavalryHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle    = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate        = 500
        MaxCowerTime            = 5000
        MinCowerTime            = 3000
        AILuaEventsList            = CavalryFunctions
        AttackPriority            = AttackPriority_Cavalry
    End

    Behavior = HorseHordeContain ModuleTag_HordeContain
        FrontAngle = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload         = ElvenRivendellArcherMod  GOOD_RIDER_LARGE_HORDE_SIZE
        Slots             = 10
        PassengerFilter     = NONE +CAVALRY +ElvenRivendellArcherBanner
        ShowPips         = No
        RandomOffset         = X:2 y:3
        MeleeBehavior         = Amoeba
        End

        ThisFormationIsTheMainFormation = Yes


        BannerCarriersAllowed    = ElvenRivendellArcherBanner
        BannerCarrierPosition    = UnitType:ElvenRivendellArcherMod    Pos:X:75.0 Y:0.0         for archer horde

        RankInfo = RankNumber:1 UnitType:ElvenRivendellArcherMod Position:X:45 Y:0            Position:X:45 Y:20        Position:X:45 Y:-20        Position:X:45 Y:40        Position:X:45 Y:-40
        RankInfo = RankNumber:2 UnitType:ElvenRivendellArcherMod Position:X:10 Y:0 Leader 1 0    Position:X:10 Y:20 Leader 1 1    Position:X:10 Y:-20 Leader 1 2    Position:X:10 Y:40 Leader 1 3    Position:X:10 Y:-40 Leader 1 4

        RanksToReleaseWhenAttacking = 1 2

        AlternateFormation = ElvenRivendellArcherHordeModWedgeFormation
        MeleeAttackLeashDistance     = 1
        BackUpMinDelayTime        = 1
        BackUpMaxDelayTime        = 3000
        BackUpMinDistance        = 1
        BackUpMaxDistance        = 3
        BackupPercentage        = 80%
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

    Behavior = HordeNotifyTargetsOfImminentProbableCrushingUpdate ModuleTag_NotifyCrushScan
        ScanWidth = 70.0
    End

    Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
         TauntAndPointUpdateDelay    =    1000
         TauntAndPointExcluded        =    NONE
        AfraidOf            =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf            =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
         PointAt                =    EMOTION_POINTAT_OBJECTFILTER
         HeroScanDistance        =    150
         FearScanDistance        =    CAVALRY_FEAR_SCAN_RADIUS

        AddEmotion            =    Terror_Base
        AddEmotion            =    Doom_Base
        AddEmotion            =       BraceForBeingCrushed_Base
        AddEmotion            =    UncontrollableFear_Base
        AddEmotion            =    FearIdle_Base
        AddEmotion            =    FearBusy_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
         AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    HeroCheerIdle_Base
        AddEmotion            =    HeroCheerBusy_Base
        AddEmotion            =    Alert_Base
        AddEmotion            =       CheerForAboutToCrush_Base
     End

    LocomotorSet
        Locomotor     = NormalCavalryHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_MOUNTED_VERYFAST_HORDE_SPEED
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTraining
        LevelsToGain = 1
        LevelCap = 2
    End


    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality
        TriggeredBy = Upgrade_SilverThornArrows
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_HeavyArmor
    End



    Behavior = AISpecialPowerUpdate RivendellLancerHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End


    Behavior = AttributeModifierAuraUpdate ModuleTag_BowAura
        StartsActive       = No
        BonusName          = ImladrisRiderBonus
        TriggeredBy        = Upgrade_BasicTraining
        RefreshDelay       = 2000
        Range              = 200
        AllowSelf          = Yes
        ObjectFilter       = ANY +CAVALRY +INFANTRY -STRUCTURE -HERO -BASE_FOUNDATION -DOZER
    End






    Behavior = AISpecialPowerUpdate ElvenMirkwoodArcherHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 40.0
    GeometryHeight = 20.0
    GeometryIsSmall = No




    AutoResolveUnitType = AutoResolveUnit_Cavalry
    AutoResolveCombatChain = AutoResolve_CavalryCombatChain

    AutoResolveBody = AutoResolve_ElvenRivendellLancerHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_ElvenRivendellLancerHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_ElvenRivendellLancerArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_SilverThornArrows
        Weapon = AutoResolve_ElvenLorienArcherUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_SilverThornArrows
        Weapon = AutoResolve_ElvenLorienArcherWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTraining Upgrade_SilverThornArrows Upgrade_HeavyArmor
End





ChildObject ElvenRivendellArcherHordeModWedgeFormation ElvenRivendellArcherHordeMod

    Behavior = HorseHordeContain ModuleTag_HordeContain
        AttributeModifiers = GondorKnightWedge
        ObjectStatusOfContained =
        InitialPayload = ElvenRivendellArcherMod 10
        Slots = 10
        PassengerFilter = NONE +CAVALRY +ElvenRivendellArcherBanner
        ShowPips = No
        ThisFormationIsTheMainFormation = No
        RandomOffset = X:8 y:3
        MeleeBehavior = Amoeba
        End


        BannerCarriersAllowed    = ElvenRivendellArcherBanner
        BannerCarrierPosition    = UnitType:ElvenRivendellArcherMod    Pos:X:30.0 Y:0.0         for archer horde

        RankInfo = RankNumber:1 UnitType:ElvenRivendellArcherMod Position:X:0 Y:0        Position:X:-20 Y:20       Position:X:-20 Y:-20      Position:X:-40 Y:40       Position:X:-40 Y:-40
        RankInfo = RankNumber:2 UnitType:ElvenRivendellArcherMod Position:X:-30 Y:0      Position:X:-50 Y:20       Position:X:-50 Y:-20      Position:X:-70 Y:40       Position:X:-70 Y:-40

        RanksToReleaseWhenAttacking = 1
        AlternateFormation = ElvenRivendellArcherHordeMod

        MeleeAttackLeashDistance = 1
        BackUpMinDelayTime       = 1
        BackUpMaxDelayTime       = 3000
        BackUpMinDistance        = 1
        BackUpMaxDistance        = 3
        BackupPercentage         = 80%
    End
End

