Object ImladrisSwordManHorde

    ButtonImage            = UPImladrisSchwert2
    SelectPortrait         = UPImladrisSchwert2

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags     = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR
        DefaultModelConditionState
            Model         = None
        End
        ModelConditionState     = HORDE_EMPTY
            Model         = None
        End
        ModelConditionState     = WORLD_BUILDER
            Model         = HordeMarkEULoW
        End
    End

    Side                 = Imladris
    EditorSorting        = UNIT
    EmotionRange         = 240
    DisplayName          = OBJECT:HordeBruchtalSchwertkampfer
    DisplayNameStrategic = CONTROLBAR:LW_Unit_HordeBruchtalSchwertkampfer
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_HordeBruchtalSchwertkampfer


    WeaponSet
        Conditions     = None
        Weapon         = PRIMARY    NormalMeleeHordeRangefinder
    End
    WeaponSet
        Conditions     = CONTAINED
        Weapon         = PRIMARY GarrisonedUnitBowHordeRangefinder
    End

    CommandSet         = BruchtalSchwertkampferHordeCommandset





    #include "..\..\..\includes\StandardHordeEvaEvents.inc"


    CrushableLevel         = 0
    CrusherLevel         = 0

    BuildCost = 400
    BuildTime = MEDIUM_BUILDTIME

    ShroudClearingRange = INFANTRY_HORDE_SHROUD_CLEARING
    VisionRange = INFANTRY_HORDE_VISION_RANGE
    VisionSide = INFANTRY_HORDE_VISION_SIDE
    VisionRear = INFANTRY_HORDE_VISION_REAR
    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = INFANTRY_VISION_BONUS_TEST_RADIUS
    VisionBonusPercentPerFoot = INFANTRY_HORDE_VISION_BONUS_PERCENT

    CommandPoints = IMLADRIS_WACHTER_HORDE_COMMAND_POINTS

    FormationWidth         = 2
    FormationDepth         = 1

    TransportSlotCount         = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf             = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE ARMY_SUMMARY MELEE_HORDE LARGE_RECTANGLE_PATHFIND

    ThreatLevel         = ELVEN_LORIENWARRIOR_HORDE_THREAT
    ThreatBreakdown ElvenLorienWarriorHorde_DetailedThreat
        AIKindOf     = INFANTRY
    End

    Body             = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth     = 1
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = FighterHorde
    End


    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle    = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate           = 500
        MaxCowerTime                  = 5000
        MinCowerTime                  = 3000
        AILuaEventsList               = InfantryFunctions
        AttackPriority                = AttackPriority_Infantry
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle                 = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay               = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained     =
        InitialPayload             = ImladrisSwordMan 5
        Slots                 = 5
        PassengerFilter            = NONE +INFANTRY
        ShowPips             = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset            = X:0 Y:0
        MeleeBehavior             = Amoeba
        End


        BannerCarriersAllowed        = ImladrisBanner
        BannerCarrierPosition        = UnitType:ImladrisSwordMan    Pos:X:70.0 Y:0.0


        RankInfo = RankNumber:1 UnitType:ImladrisSwordMan Position:X:50 Y:0            Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:50 Y:40        Position:X:50 Y:-40
		
		ComboHorde = Target:ImladrisSwordManErestorHorde             Result:ImladrisSwordManErestorComboHorde        InitiateVoice:ElfBruchtalWarriorVoiceSalute

        RanksToReleaseWhenAttacking = 1

        AlternateFormation = ImladrisSwordManHordeLine
        MeleeAttackLeashDistance     = 1
        BackUpMinDelayTime        = 1
        BackUpMaxDelayTime        = 3000
        BackUpMinDistance        = 1
        BackUpMaxDistance        = 3
        BackupPercentage        = 80%
    End



    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

     Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance       =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded       =    NONE
        AfraidOf                    =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf              =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
         PointAt                    =    EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance            =    150
        FearScanDistance            =    ARCHER_FEAR_SCAN_RADIUS



        AddEmotion    =    Terror_Base
        AddEmotion    =    Doom_Base
        AddEmotion    =    BraceForBeingCrushed_Base
        AddEmotion    =    UncontrollableFear_Base
        AddEmotion    =    FearIdle_Base
        AddEmotion    =    FearBusy_Base
        AddEmotion    =    Point_Base
        AddEmotion    =    Taunt_Base
        AddEmotion    =    CheerIdle_Base
        AddEmotion    =    CheerBusy_Base
        AddEmotion    =    HeroCheerIdle_Base
        AddEmotion    =    HeroCheerBusy_Base
        AddEmotion    =    Alert_Base
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly        = Yes
        StuffToPickUp         = ANY +CRATE -TheDroppedRing
        ScanRange             = 200
        ScanIntervalSeconds   = 0.5
    End

    LocomotorSet
        Locomotor     = NormalMeleeHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_FOOT_IMLADRIS_HORDE_SPEED
    End

; --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_StandhaltenEnabler
        SpecialPowerTemplate = SpecialAbilityBruchtalStandhalten
        TriggeredBy          = Upgrade_AllFactionUpgrade
    End

    Behavior = WeaponModeSpecialPowerUpdate ModuleTag_StandhaltenPowerUpdate
        SpecialPowerTemplate = SpecialAbilityBruchtalStandhalten
        Duration             = 30000
        AttributeModifier    = BruchtalStandhaltenModifier
        LockWeaponSlot       = SECONDARY
        StartsPaused         = No
    End

    Behavior = AutoAbilityBehavior ModuleTag_StandhaltenAutoAbility
		SpecialAbility		= SpecialAbilityBruchtalStandhalten
		ForbiddenStatus 	= INSIDE_GARRISON
		MaxScanRange		= 100
		Query			= 5 ANY ENEMIES +CAVALRY
		Query			= 15 ALL ENEMIES
	End

; --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_VorruckenEnabler
        SpecialPowerTemplate = SpecialAbilityBruchtalVorrucken
        TriggeredBy          = Upgrade_AllFactionUpgrade
    End

    Behavior = WeaponModeSpecialPowerUpdate ModuleTag_VorruckenPowerUpdate
        SpecialPowerTemplate = SpecialAbilityBruchtalVorrucken
        Duration             = 30000
        AttributeModifier    = BruchtalVorruckenModifier
        LockWeaponSlot       = SECONDARY
        StartsPaused         = No
    End

    Behavior = AutoAbilityBehavior ModuleTag_VorruckenAutoAbility

	SpecialAbility		= SpecialAbilityBruchtalVorrucken
		ForbiddenStatus 	= INSIDE_GARRISON
		MaxScanRange		= 100
		Query			= 15 ALL ENEMIES
	End

; --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

	Behavior = DoCommandUpgrade Module_DoCommandUpgrade2    
        TriggeredBy                 = Upgrade_ErestorZweiteReihe
        RequiresAllTriggers         = Yes
        GetUpgradeCommandButtonName = Command_SpecialAbilityOrkstadtOrksSummon
    End
	
	Behavior = ObjectCreationUpgrade ModuleTag_RemoveHealUpgrade
		TriggeredBy = Upgrade_ErestorZweiteReihe
		RemoveUpgrade = Upgrade_ErestorZweiteReihe
		Delay = 10000
	End

    Behavior = OCLSpecialPower ModuleTag_OCLSpecialPower
        StartsPaused                = No
        SpecialPowerTemplate        = SpecialAbilityOrkstadtOrksSummon
        OCL                         = OCL_SpawnErestorSchwertkampfer
        CreateLocation              = CREATE_AT_LOCATION
    End

; --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTrainingImladis
        LevelsToGain = 1
        LevelCap = 2
    End

    Behavior = AttributeModifierUpgrade ModuleTag_Level2BonusFighter
        TriggeredBy       = Upgrade_ObjectLevel2
        AttributeModifier = ImladrisFighterRank2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality
        TriggeredBy = Upgrade_ForgedBlades
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_HeavyArmor
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality3
        TriggeredBy = Upgrade_HerzdesFeuers
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality5
        TriggeredBy = Upgrade_BruchtalForgedBladesEregions
    End

    Behavior = CommandSetUpgrade ModueTag_CommandSetEregions
        TriggeredBy            = Upgrade_ForgedBlades
        CommandSet             = BruchtalSchwertkampferHordeCommandset_Eregions
    End






    Behavior = AISpecialPowerUpdate ElvenLorienWarriorHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End


    Geometry         = BOX
    GeometryMajorRadius     = 30.0
    GeometryMinorRadius     = 50.0
    GeometryHeight         = 20.0
    GeometryIsSmall     = No




    AutoResolveUnitType = AutoResolveUnit_Soldier
    AutoResolveCombatChain = AutoResolve_SoldierCombatChain

    AutoResolveBody = AutoResolve_ElvenLorienWarriorHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_ElvenLorienWarriorHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_ElvenLorienWarriorArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_ElvenLorienWarriorUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_ElvenLorienWarriorWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTrainingImladis Upgrade_ForgedBlades Upgrade_HeavyArmor
End


ChildObject ImladrisSwordManHordeLine ImladrisSwordManHorde

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle                 = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay               = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained            =
        InitialPayload                    = ImladrisSwordMan 5
        Slots                            = 5
        PassengerFilter                    = NONE +INFANTRY
        ShowPips                        = No
        ThisFormationIsTheMainFormation = No
        AttributeModifiers                = ImladrisSwordWall
        RandomOffset                    = X:0 Y:0
        MeleeBehavior = Amoeba
        End


        BannerCarriersAllowed    = ImladrisBanner
        BannerCarrierPosition    = UnitType:ImladrisSwordMan    Pos:X:-25 Y:0.0

        RankInfo = RankNumber:1 UnitType:ImladrisSwordMan Position:X:0 Y:0        Position:X:-20 Y:20       Position:X:-20 Y:-20      Position:X:-40 Y:40       Position:X:-40 Y:-40

        RanksToReleaseWhenAttacking = 1

        AlternateFormation = ImladrisSwordManHorde
        MeleeAttackLeashDistance = 1
        BackUpMinDelayTime         = 1
        BackUpMaxDelayTime         = 3000
        BackUpMinDistance         = 1
        BackUpMaxDistance         = 3
        BackupPercentage         = 80%
    End
End

ChildObject ImladrisSwordManErestorHorde ImladrisSwordManHorde

    IsTrainable    = No
    CommandPoints  = 0
	EquivalentTo   = ImladrisSwordManHorde
	
	Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle                 = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay               = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained     =
        InitialPayload             = ImladrisSwordManErestor 5
        Slots                 = 5
        PassengerFilter            = NONE +INFANTRY
        ShowPips             = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset            = X:0 Y:0
        MeleeBehavior             = Amoeba
        End

        RankInfo = RankNumber:1 UnitType:ImladrisSwordManErestor Position:X:50 Y:0            Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:50 Y:40        Position:X:50 Y:-40

		ComboHorde = Target:ImladrisSwordManHorde             Result:ImladrisSwordManErestorComboHorde        InitiateVoice:ElfBruchtalWarriorVoiceSalute

        RanksToReleaseWhenAttacking = 1

        MeleeAttackLeashDistance     = 1
        BackUpMinDelayTime        = 1
        BackUpMaxDelayTime        = 3000
        BackUpMinDistance        = 1
        BackUpMaxDistance        = 3
        BackupPercentage        = 80%
    End
End
	
ChildObject ImladrisSwordManHorde_Summoned ImladrisSwordManHorde
    IsTrainable    = No
    CommandPoints  = 0
    CommandSet     = BruchtalLancerHordeSummonedCommandSet
    EquivalentTo   = ImladrisSwordManHorde
    DisplayName    =  OBJECT:HordeBruchtalSchwertkampferSpell
    KindOf                = +SUMMONED


    Behavior = HordeContain ModuleTag_HordeContain
        ObjectStatusOfContained =
        InitialPayload = ImladrisSwordMan_Summoned 10
        Slots = 10
        PassengerFilter = NONE +INFANTRY
        ShowPips = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset = X:1 Y:1


        BannerCarriersAllowed    = ImladrisBanner
        BannerCarrierPosition    = UnitType:ImladrisSwordMan_Summoned    Pos:X:70 Y:0.0


        RankInfo = RankNumber:1 UnitType:ImladrisSwordMan_Summoned Position:X:50 Y:0            Position:X:50 Y:20                Position:X:50 Y:-20                Position:X:50 Y:40                Position:X:50 Y:-40
        RankInfo = RankNumber:2 UnitType:ImladrisSwordMan_Summoned Position:X:30 Y:0            Position:X:30 Y:20                Position:X:30 Y:-20                Position:X:30 Y:40                Position:X:30 Y:-40

        RanksToReleaseWhenAttacking = 1 2
    End


    Behavior = LifetimeUpdate ModuleTag_LifetimeUpdate
        MinLifetime        = 180000
        MaxLifetime        = 180000
        DeathType        = FADED
    End
End

ChildObject ImladrisSwordsHorde ImladrisSwordManHorde
    IsTrainable    = Yes
    CommandPoints  = 100
    CommandSet     = BruchtalLancerHordeSummonedCommandSet
    EquivalentTo   = ImladrisSwordManHorde
    DisplayName    =  OBJECT:HordeBruchtalSchwertkampferSpell
	
	BuildCost	   = 750
	BuildTime	   = 35
    KindOf         = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE ARMY_SUMMARY MELEE_HORDE LARGE_RECTANGLE_PATHFIND


    Behavior = HordeContain ModuleTag_HordeContain
        ObjectStatusOfContained =
        InitialPayload = ImladrisSwordMan 10
        Slots = 10
        PassengerFilter = NONE +INFANTRY
        ShowPips = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset = X:1 Y:1


        BannerCarriersAllowed    = ImladrisBanner
        BannerCarrierPosition    = UnitType:ImladrisSwordMan    Pos:X:70 Y:0.0


        RankInfo = RankNumber:1 UnitType:ImladrisSwordMan Position:X:50 Y:0            Position:X:50 Y:20                Position:X:50 Y:-20                Position:X:50 Y:40                Position:X:50 Y:-40
        RankInfo = RankNumber:2 UnitType:ImladrisSwordMan Position:X:30 Y:0            Position:X:30 Y:20                Position:X:30 Y:-20                Position:X:30 Y:40                Position:X:30 Y:-40

        RanksToReleaseWhenAttacking = 1 2
    End

End


Object BruchtalLancerHorde

    ButtonImage            = UPImladrisLanze
    SelectPortrait         = UPImladrisLanze

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR
        DefaultModelConditionState
            Model = None
        End
        ModelConditionState = HORDE_EMPTY
            Model = None
        End
        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkEULoW
        End
    End

    Side = Imladris
    EditorSorting = UNIT
    EmotionRange = 240
    DisplayName = OBJECT:HordeBruchtalLanzer
    DisplayNameStrategic = CONTROLBAR:LW_Unit_BruchtalLanzer
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_ElvenMithlondSentryHorde

    WeaponSet
        Conditions            = None
        Weapon                = PRIMARY    NormalPikeHordeRangefinder
        Weapon                = SECONDARY  NormalPikeHordeRangefinder
        AutoChooseSources     = SECONDARY NONE
        ShareWeaponReloadTime = Yes
    End


    CommandSet = BruchtalLancerHordeCommandSet


    #include "..\..\..\includes\StandardHordeEvaEvents.inc"


    CrushableLevel = 0
    CrusherLevel = 0

    BuildCost = IMLADRISPIKESHORDE_BUILDCOST
    BuildTime = MEDIUM_BUILDTIME

    VisionRange = PIKEMAN_HORDE_VISION_RANGE
    ShroudClearingRange = PIKEMAN_HORDE_SHROUD_CLEARING
    VisionSide = PIKEMAN_HORDE_VISION_SIDE
    VisionRear = PIKEMAN_HORDE_VISION_REAR
    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = PIKEMAN_VISION_BONUS_TEST_RADIUS
    VisionBonusPercentPerFoot = PIKEMAN_HORDE_VISION_BONUS_PERCENT

    CommandPoints = IMLADRIS_WACHTER_HORDE_COMMAND_POINTS

    FormationWidth = 2
    FormationDepth = 1

    TransportSlotCount = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE ARMY_SUMMARY MELEE_HORDE LARGE_RECTANGLE_PATHFIND PIKE

    ThreatLevel = ELVEN_MITHLONDSENTRY_HORDE_THREAT
    ThreatBreakdown ElvenMithlondSentryHorde_DetailedThreat
        AIKindOf = PIKEMAN
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = PikeHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle    =    Yes ATTACK_BUILDINGS
        MoodAttackCheckRate        =    500
        MaxCowerTime            =    5000
        MinCowerTime            =    3000
        AILuaEventsList            =    InfantryFunctions
        AttackPriority            =     AttackPriority_Spearman
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle   = STANDARD_PIKEMAN_FRONTANGLE
        FlankedDelay = STANDARD_PIKEMAN_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload = BruchtalLanzer 5
        Slots = 5
        PassengerFilter = NONE +INFANTRY
        ShowPips = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset = X:0 Y:0
        MeleeBehavior = Amoeba
        End


        BannerCarriersAllowed    = ImladrisBanner
        BannerCarrierPosition    = UnitType:BruchtalLanzer    Pos:X:70.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:BruchtalLanzer Position:X:50 Y:0        Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:50 Y:40        Position:X:50 Y:-40

		ComboHorde = Target:BruchtalLancerErestorHorde             Result:BruchtalLancerErestorComboHorde        InitiateVoice:ElfBruchtalWarriorVoiceSalute 

        RanksToReleaseWhenAttacking = 1

        MeleeAttackLeashDistance = 1
        BackUpMinDelayTime         = 1
        BackUpMaxDelayTime         = 3000
        BackUpMinDistance         = 1
        BackUpMaxDistance         = 3
        BackupPercentage         = 80%

        AlternateFormation = BruchtalLancerHordePorcupine
    End



    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

     Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance       =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded       =    NONE
        AfraidOf                    =    EMOTION_AFRAIDOF_OBJECTFILTER_LANCERS
        AlwaysAfraidOf              =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER_LANCERS
        PointAt                     =    EMOTION_POINTAT_OBJECTFILTER_LANCERS
        HeroScanDistance            =    150
        FearScanDistance            =    INFANTRY_FEAR_SCAN_RADIUS


        AddEmotion    =    Terror_Base
        AddEmotion    =    Doom_Base
        AddEmotion    =    UncontrollableFear_Base
        AddEmotion    =    FearIdle_Base
        AddEmotion    =    FearBusy_Base
        AddEmotion    =    Point_Base
        AddEmotion    =    Taunt_Base
        AddEmotion    =    CheerIdle_Base
        AddEmotion    =    CheerBusy_Base
        AddEmotion    =    HeroCheerIdle_Base
        AddEmotion    =    HeroCheerBusy_Base
        AddEmotion    =    Alert_Base
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly        = Yes
        StuffToPickUp         = ANY +CRATE -TheDroppedRing
        ScanRange             = 200
        ScanIntervalSeconds   = 0.5
    End

    LocomotorSet
        Locomotor     = NormalMeleeHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_FOOT_IMLADRIS_HORDE_SPEED
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTrainingImladis
        LevelsToGain = 1
        LevelCap = 2
    End

    Behavior = AttributeModifierUpgrade ModuleTag_Level2BonusLancer
        TriggeredBy       = Upgrade_ObjectLevel2
        AttributeModifier = ImladrisLancerRank2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality
        TriggeredBy = Upgrade_ForgedBlades
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_HeavyArmor
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality3
        TriggeredBy = Upgrade_HerzdesFeuers
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality5
        TriggeredBy = Upgrade_BruchtalForgedBladesEregions
    End

    Behavior = CommandSetUpgrade ModueTag_CommandSetEregions
        TriggeredBy            = Upgrade_ForgedBlades
        CommandSet             = BruchtalLancerHordeCommandSet_Eregions
    End

; --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_ImladrisNewLeadership
        SpecialPowerTemplate    = SpecialAbilityFakeLeadership
        TriggeredBy                = Upgrade_ObjectLevel1
    End

    Behavior = SpecialPowerModule ModuleTag_ImladrisNewLeadershipUpdate
        SpecialPowerTemplate        = SpecialAbilityFakeLeadership
        UpdateModuleStartsAttack    = No
        StartsPaused                = Yes
    End

    Behavior = AttributeModifierAuraUpdate ModuleTag_LeadershipSpell
        StartsActive     = No
        BonusName        = ImladrisPikesNew
        TriggeredBy      = Upgrade_RaiseShield
        RefreshDelay     = 2000
        Range            = 150
	    TargetEnemy	 = No
        ObjectFilter     = NONE +BruchtalLanzer +BruchtalLancerHorde
    End

; --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

	Behavior = DoCommandUpgrade Module_DoCommandUpgrade2    
        TriggeredBy                 = Upgrade_ErestorZweiteReihe
        RequiresAllTriggers         = Yes
        GetUpgradeCommandButtonName = Command_SpecialAbilityOrkstadtOrksSummon
    End
	
	Behavior = ObjectCreationUpgrade ModuleTag_RemoveHealUpgrade
		TriggeredBy = Upgrade_ErestorZweiteReihe
		RemoveUpgrade = Upgrade_ErestorZweiteReihe
		Delay = 10000
	End

    Behavior = OCLSpecialPower ModuleTag_OCLSpecialPower
        StartsPaused                = No
        SpecialPowerTemplate        = SpecialAbilityOrkstadtOrksSummon
        OCL                         = OCL_SpawnErestorLanzer
        CreateLocation              = CREATE_AT_LOCATION
    End

; --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    Behavior = AISpecialPowerUpdate ElvenMithlondSentryHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 45.0
    GeometryHeight = 20.0
    GeometryIsSmall = No



    AutoResolveUnitType = AutoResolveUnit_Pikemen
    AutoResolveCombatChain = AutoResolve_PikemenCombatChain

    AutoResolveBody = AutoResolve_ElvenMithlondSentryHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_ElvenMithlondSentryHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_ElvenMithlondSentryArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_ElvenMithlondSentryUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_ElvenMithlondSentryWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTrainingImladis Upgrade_ForgedBlades Upgrade_HeavyArmor
End


ChildObject BruchtalLancerHordePorcupine BruchtalLancerHorde

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle   = STANDARD_PIKEMAN_FRONTANGLE_FORMATION
        FlankedDelay = STANDARD_PIKEMAN_FLANKEDDELAY
        ObjectStatusOfContained            =
        InitialPayload                         = BruchtalLanzer 5
        Slots                             = 5
        PassengerFilter                    = NONE +INFANTRY
        ShowPips                        = No
        ThisFormationIsTheMainFormation = No
        AttributeModifiers                = ImladrisLanceWall
        RandomOffset                    = X:0 Y:0
        MeleeBehavior = Amoeba
        End


        BannerCarriersAllowed    = ImladrisBanner
        BannerCarrierPosition    = UnitType:BruchtalLanzer Pos:X:-25.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:BruchtalLanzer Position:X:0 Y:0        Position:X:0 Y:12.5        Position:X:0 Y:-12.5        Position:X:0 Y:25        Position:X:0 Y:-25

        RanksToReleaseWhenAttacking = 1

        AlternateFormation = BruchtalLancerHorde
        MeleeAttackLeashDistance = 1
        BackUpMinDelayTime         = 1
        BackUpMaxDelayTime         = 3000
        BackUpMinDistance         = 1
        BackUpMaxDistance         = 3
        BackupPercentage         = 80%
    End
End

ChildObject BruchtalLancerErestorHorde BruchtalLancerHorde

    IsTrainable    = No
    CommandPoints  = 0
	EquivalentTo   = BruchtalLancerHorde
	
	Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle                 = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay               = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained     =
        InitialPayload             = BruchtalLanzerErestor 5
        Slots                 = 5
        PassengerFilter            = NONE +INFANTRY
        ShowPips             = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset            = X:0 Y:0
        MeleeBehavior             = Amoeba
        End

        RankInfo = RankNumber:1 UnitType:BruchtalLanzerErestor Position:X:50 Y:0            Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:50 Y:40        Position:X:50 Y:-40

		ComboHorde = Target:BruchtalLancerHorde             Result:BruchtalLancerErestorComboHorde        InitiateVoice:ElfBruchtalWarriorVoiceSalute

        RanksToReleaseWhenAttacking = 1

        MeleeAttackLeashDistance     = 1
        BackUpMinDelayTime        = 1
        BackUpMaxDelayTime        = 3000
        BackUpMinDistance        = 1
        BackUpMaxDistance        = 3
        BackupPercentage        = 80%
    End
End

ChildObject BruchtalLancerHordePorcupineOld BruchtalLancerHorde

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle   = STANDARD_PIKEMAN_FRONTANGLE_FORMATION
        FlankedDelay = STANDARD_PIKEMAN_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload                    = BruchtalLanzer 5
        Slots                            = 5
        PassengerFilter                    = NONE +INFANTRY
        ShowPips                        = No
        ThisFormationIsTheMainFormation = No
        RandomOffset                    = X:2 Y:1
        RanksToReleaseWhenAttacking        = 0
        RanksToJustFreeWhenAttacking   = 0
        AttributeModifiers                = EdainHordePorcupine
        IsPorcupineFormation            = Yes
        MinimumHordeSize                = 5

        AlternateFormation                = BruchtalLancerHorde
        VisionRearOverride                = 100%
        VisionSideOverride                = 100%
        NotComboFormation                = Yes


        BannerCarriersAllowed    = ImladrisBanner
        BannerCarrierPosition    = UnitType:BruchtalLanzer    Pos:X:0.0 Y:0.0

        RankInfo    = RankNumber:1 UnitType:BruchtalLanzer    Position:X:36.54 Y:16.27    Position:X:-39.13 Y:8.32    Position:X:26.77 Y:-29.73    Position:X:-4.18 Y:39.78    Position:X:-20 Y:-34.64
    End
End

ChildObject BruchtalLancerHorde_SummonedCaH BruchtalLancerHorde
    IsTrainable    = No
    CommandPoints     = 0
    CommandSet    = BruchtalLancerHordeSummonedCommandSet
    EquivalentTo      = BruchtalLanzerHorde

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle   = STANDARD_PIKEMAN_FRONTANGLE
        FlankedDelay = STANDARD_PIKEMAN_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload     = BruchtalLanzer_SummonedCaH 5
        Slots         = 5
        PassengerFilter    = NONE +INFANTRY
        ShowPips     = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset    = X:0 Y:0
        MeleeBehavior     = Amoeba
        End

        RankInfo = RankNumber:1 UnitType:BruchtalLanzer_SummonedCaH Position:X:50 Y:0            Position:X:50 Y:20                Position:X:50 Y:-20                Position:X:50 Y:40                Position:X:50 Y:-40

        RanksToReleaseWhenAttacking = 1
        MeleeAttackLeashDistance = 25
    End

    Behavior = LifetimeUpdate ModuleTag_LifetimeUpdate

        MinLifetime        = 180000
        MaxLifetime        = 180000
        DeathType        = FADED
    End

End

ChildObject BruchtalLancerHorde_Summoned BruchtalLancerHorde
    IsTrainable    = No
    CommandPoints     = 0
    CommandSet    = BruchtalLancerHordeSummonedCommandSet
    EquivalentTo      = BruchtalLanzerHorde
    DisplayName  =  OBJECT:HordeBruchtalLanzentragerSpell
    KindOf                = +SUMMONED

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle   = STANDARD_PIKEMAN_FRONTANGLE
        FlankedDelay = STANDARD_PIKEMAN_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload     = BruchtalLanzer_Summoned 10
        Slots         = 10
        PassengerFilter    = NONE +INFANTRY
        ShowPips     = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset    = X:0 Y:0
        MeleeBehavior     = Amoeba
        End

        RankInfo = RankNumber:1 UnitType:BruchtalLanzer_Summoned Position:X:50 Y:0            Position:X:50 Y:20                Position:X:50 Y:-20                Position:X:50 Y:40                Position:X:50 Y:-40
        RankInfo = RankNumber:2 UnitType:BruchtalLanzer_Summoned Position:X:30 Y:0            Position:X:30 Y:20                Position:X:30 Y:-20                Position:X:30 Y:40                Position:X:30 Y:-40

        RanksToReleaseWhenAttacking = 1 2
        MeleeAttackLeashDistance = 25
    End

    Behavior = LifetimeUpdate ModuleTag_LifetimeUpdate

        MinLifetime        = 180000
        MaxLifetime        = 180000
        DeathType        = FADED
    End

End

ChildObject RivendelLancerHorde BruchtalLancerHorde
    IsTrainable   = Yes
    CommandPoints = 100
    CommandSet    = BruchtalLancerHordeSummonedCommandSet
    EquivalentTo  = BruchtalLanzerHorde
    DisplayName   = OBJECT:HordeBruchtalLanzentragerSpell
	
	BuildCost = 600
    BuildTime = MEDIUM_BUILDTIME
    KindOf        = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE ARMY_SUMMARY MELEE_HORDE LARGE_RECTANGLE_PATHFIND PIKE

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle   = STANDARD_PIKEMAN_FRONTANGLE
        FlankedDelay = STANDARD_PIKEMAN_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload     = BruchtalLanzer 10
        Slots         = 10
        PassengerFilter    = NONE +INFANTRY
        ShowPips     = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset    = X:0 Y:0
        MeleeBehavior     = Amoeba
        End

        RankInfo = RankNumber:1 UnitType:BruchtalLanzer Position:X:50 Y:0            Position:X:50 Y:20                Position:X:50 Y:-20                Position:X:50 Y:40                Position:X:50 Y:-40
        RankInfo = RankNumber:2 UnitType:BruchtalLanzer Position:X:30 Y:0            Position:X:30 Y:20                Position:X:30 Y:-20                Position:X:30 Y:40                Position:X:30 Y:-40

        RanksToReleaseWhenAttacking = 1 2
        MeleeAttackLeashDistance = 25
    End

End


Object ImladrisWaffenmeisterHorde

    ButtonImage     = UPImladrisSwordEinzel
    SelectPortrait  = UPImladrisSwordEinzel

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags     = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR
        DefaultModelConditionState
            Model     = None
        End
        ModelConditionState = HORDE_EMPTY
            Model = None
        End
        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkEULoW
        End
    End

    Side             = Imladris
    EditorSorting    = UNIT
    EmotionRange     = 240
    DisplayName      = OBJECT:HordeImladrisWaffenmeister
    DisplayNameStrategic = CONTROLBAR:LW_Unit_ImladrisWaffenmeisterHorde
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_ImladrisWaffenmeisterHorde

    WeaponSet
        Conditions            = None
        Weapon                = PRIMARY      NormalMeleeHordeRangefinder
        Weapon                = SECONDARY    NormalMeleeHordeRangefinder
        AutoChooseSources     = SECONDARY NONE
        ShareWeaponReloadTime = Yes
    End

    CommandSet = BruchtalWaffenmeisterHordeCommandset



    #include "..\..\..\includes\StandardHordeEvaEvents.inc"


    CrushableLevel = 0
    CrusherLevel   = 0

    BuildCost         = 500
    BuildTime         = MEDIUM_BUILDTIME

    ShroudClearingRange = INFANTRY_HORDE_SHROUD_CLEARING
    VisionRange = INFANTRY_HORDE_VISION_RANGE
    VisionSide = INFANTRY_HORDE_VISION_SIDE
    VisionRear = INFANTRY_HORDE_VISION_REAR
    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = INFANTRY_VISION_BONUS_TEST_RADIUS
    VisionBonusPercentPerFoot = INFANTRY_HORDE_VISION_BONUS_PERCENT

    CommandPoints         = IMLADRIS_WACHTER_HORDE_COMMAND_POINTS

    FormationWidth = 2
    FormationDepth = 1

    TransportSlotCount = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE ARMY_SUMMARY MELEE_HORDE LARGE_RECTANGLE_PATHFIND PIKE

    ThreatLevel = ELVEN_MITHLONDSENTRY_HORDE_THREAT
    ThreatBreakdown ElvenLorienWarriorHorde_DetailedThreat
        AIKindOf     = INFANTRY
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = FighterHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle  = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate         = 500
        MaxCowerTime                = 5000
        MinCowerTime                = 3000
        AILuaEventsList             = InfantryFunctions
        AttackPriority              = AttackPriority_Infantry
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle                 = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay               = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload         = ImladrisWaffenmeister 5
        Slots             = 5
        PassengerFilter     = NONE +INFANTRY
        ShowPips         = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset         = X:0 Y:0
        MeleeBehavior         = Amoeba
        End


        BannerCarriersAllowed    = ImladrisBanner
        BannerCarrierPosition    = UnitType:ImladrisWaffenmeister    Pos:X:70.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:ImladrisWaffenmeister Position:X:50 Y:0        Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:50 Y:40        Position:X:50 Y:-40

		ComboHorde = Target:ImladrisWaffenmeisterErestorHorde             Result:ImladrisWaffenmeisterErestorComboHorde        InitiateVoice:ElfBruchtalWarriorVoiceSalute

        RanksToReleaseWhenAttacking     = 1

        MeleeAttackLeashDistance     = 1
        BackUpMinDelayTime        = 1
        BackUpMaxDelayTime        = 3000
        BackUpMinDistance        = 1
        BackUpMaxDistance        = 3
        BackupPercentage        = 80%
    End



    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

     Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded        =    NONE
        AfraidOf            =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf            =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
         PointAt                =    EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance        =    150
        FearScanDistance        =    INFANTRY_FEAR_SCAN_RADIUS



        AddEmotion    =    Terror_Base
        AddEmotion    =    Doom_Base
        AddEmotion    =    UncontrollableFear_Base
        AddEmotion    =    FearIdle_Base
        AddEmotion    =    FearBusy_Base
        AddEmotion    =    Point_Base
        AddEmotion    =    Taunt_Base
        AddEmotion    =    CheerIdle_Base
        AddEmotion    =    CheerBusy_Base
        AddEmotion    =    HeroCheerIdle_Base
        AddEmotion    =    HeroCheerBusy_Base
        AddEmotion    =    Alert_Base
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly        = Yes
        StuffToPickUp         = ANY +CRATE -TheDroppedRing
        ScanRange             = 200
        ScanIntervalSeconds   = 0.5
    End

; --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

	Behavior = DoCommandUpgrade Module_DoCommandUpgrade2    
        TriggeredBy                 = Upgrade_ErestorZweiteReihe
        RequiresAllTriggers         = Yes
        GetUpgradeCommandButtonName = Command_SpecialAbilityOrkstadtOrksSummon
    End

	Behavior = ObjectCreationUpgrade ModuleTag_RemoveHealUpgrade
		TriggeredBy = Upgrade_ErestorZweiteReihe
		RemoveUpgrade = Upgrade_ErestorZweiteReihe
		Delay = 10000
	End

    Behavior = OCLSpecialPower ModuleTag_OCLSpecialPower
        StartsPaused                = No
        SpecialPowerTemplate        = SpecialAbilityOrkstadtOrksSummon
        OCL                         = OCL_SpawnErestorWaffenmeister
        CreateLocation              = CREATE_AT_LOCATION
    End

; --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_Enabler
        SpecialPowerTemplate = SpecialAbilityHammerschlage
        TriggeredBy          = Upgrade_AllFactionUpgrade
    End

    Behavior = WeaponModeSpecialPowerUpdate ModuleTag_PowerUpdate
        SpecialPowerTemplate = SpecialAbilityHammerschlage
        Duration             = 30000
        AttributeModifier    = WaffenkunstModifier
        LockWeaponSlot       = SECONDARY
        StartsPaused         = No
    End

    Behavior = AutoAbilityBehavior ModuleTag_AutoAbilityPower
        SpecialAbility       = SpecialAbilityHammerschlage
        MaxScanRange         = 65
        Query                = 10 ANY ENEMIES +INFANTRY
    End

; --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    LocomotorSet
        Locomotor     = NormalMeleeHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_FOOT_IMLADRIS_HORDE_SPEED
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTrainingImladis
        LevelsToGain = 1
        LevelCap = 2
    End

    Behavior = AttributeModifierUpgrade ModuleTag_Level2BonusFighter
        TriggeredBy       = Upgrade_ObjectLevel2
        AttributeModifier = ImladrisFighterRank2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality
        TriggeredBy = Upgrade_HeavyArmor
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_ForgedBlades
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality3
        TriggeredBy = Upgrade_HerzdesFeuers
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality5
        TriggeredBy = Upgrade_BruchtalForgedBladesEregions
    End

    Behavior = CommandSetUpgrade ModueTag_CommandSetEregions
        TriggeredBy            = Upgrade_ForgedBlades
        CommandSet             = BruchtalWaffenmeisterHordeCommandset_Eregions
    End







    Behavior = AISpecialPowerUpdate ElvenMithlondSentryHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End


    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 45.0
    GeometryHeight = 20.0
    GeometryIsSmall = No




    AutoResolveUnitType = AutoResolveUnit_Pikemen
    AutoResolveCombatChain = AutoResolve_PikemenCombatChain

    AutoResolveBody = AutoResolve_ElvenMithlondSentryHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_ElvenMithlondSentryHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_ElvenMithlondSentryArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_ElvenMithlondSentryUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_ElvenMithlondSentryWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTrainingImladis Upgrade_ForgedBlades Upgrade_HeavyArmor
End

ChildObject ImladrisWaffenmeisterErestorHorde ImladrisWaffenmeisterHorde

    IsTrainable    = No
    CommandPoints  = 0
	EquivalentTo   = ImladrisWaffenmeisterHorde
	
	Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle                 = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay               = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained     =
        InitialPayload             = ImladrisWaffenmeisterErestor 5
        Slots                 = 5
        PassengerFilter            = NONE +INFANTRY
        ShowPips             = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset            = X:0 Y:0
        MeleeBehavior             = Amoeba
        End

        RankInfo = RankNumber:1 UnitType:ImladrisWaffenmeisterErestor Position:X:50 Y:0            Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:50 Y:40        Position:X:50 Y:-40

		ComboHorde = Target:ImladrisWaffenmeisterHorde             Result:ImladrisWaffenmeisterErestorComboHorde        InitiateVoice:ElfBruchtalWarriorVoiceSalute

        RanksToReleaseWhenAttacking = 1

        MeleeAttackLeashDistance     = 1
        BackUpMinDelayTime        = 1
        BackUpMaxDelayTime        = 3000
        BackUpMinDistance        = 1
        BackUpMaxDistance        = 3
        BackupPercentage        = 80%
    End
End

Object BruchtalBogenschuetzenHorde

    ButtonImage     = UPImladrisBogen2
    SelectPortrait  = UPImladrisBogen2

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR
        DefaultModelConditionState
            Model = None
        End
        ModelConditionState = HORDE_EMPTY
            Model = None
        End
        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkEULoW
        End
    End

    Side = Imladris
    EditorSorting = UNIT
    EmotionRange = 240
    DisplayName = Object:BruchtalBogenschutzen
    DisplayNameStrategic = CONTROLBAR:LW_Unit_BruchtalBogenschutzenHorde
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_ElvenLorienArcherHorde

    WeaponSet
        Conditions = None
        Weapon     = PRIMARY    ArcherHordeRangefinderMedium
    End

    CommandSet = BruchtalBogenschuetzenHordeCommandset

    #include "..\..\..\includes\StandardHordeEvaEvents.inc"

    CrushableLevel     = 0
    CrusherLevel       = 0
    UseCrushAttack     = No
    BuildCost 	       = 450
    BuildTime 	       = MEDIUM_BUILDTIME

    VisionRange           = ARCHER_HORDE_VISION_RANGE_MEDIUM
    ShroudClearingRange   = ARCHER_HORDE_SHROUD_CLEARING_MEDIUM
    VisionSide            = ARCHER_HORDE_VISION_SIDE
    VisionRear            = ARCHER_HORDE_VISION_REAR
    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = ARCHER_VISION_BONUS_TEST_RADIUS
    VisionBonusPercentPerFoot = ARCHER_HORDE_VISION_BONUS_PERCENT

    CommandPoints = IMLADRIS_WACHTER_HORDE_COMMAND_POINTS

    FormationWidth = 2
    FormationDepth = 1

    TransportSlotCount = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE ARCHER ARMY_SUMMARY LARGE_RECTANGLE_PATHFIND MELEE_HORDE

    ThreatLevel = ELVEN_LORIENARCHER_HORDE_THREAT
    ThreatBreakdown ElvenLorienArcherHorde_DetailedThreat
        AIKindOf = ARCHER
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = ArcherHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle  = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate         = 500
        MaxCowerTime                = 5000
        MinCowerTime                = 3000
        CanAttackWhileContained     = Yes
        AILuaEventsList             = InfantryFunctions
        AttackPriority              = AttackPriority_Archer
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle                 = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay               = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload         = BruchtalBogenschuetzen 5
        Slots             = 5
        PassengerFilter        = NONE +INFANTRY
        ShowPips         = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset        = X:0 Y:0
        MeleeBehavior         = Amoeba
        End

        BannerCarriersAllowed    = ImladrisBanner
        BannerCarrierPosition    = UnitType:BruchtalBogenschuetzen    Pos:X:70.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:BruchtalBogenschuetzen Position:X:50 Y:0            Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:50 Y:40        Position:X:50 Y:-40

		ComboHorde = Target:BruchtalBogenschuetzenErestorHorde             Result:BruchtalBogenschuetzenErestorComboHorde        InitiateVoice:ElfBruchtalWarriorVoiceSalute

        RanksToReleaseWhenAttacking = 1
        AlternateFormation = BruchtalBogenschuetzenHordeAmbush

        MeleeAttackLeashDistance  = 1
        BackUpMinDelayTime        = 1
        BackUpMaxDelayTime        = 3000
        BackUpMinDistance         = 1
        BackUpMaxDistance         = 3
        BackupPercentage          = 80%
    End


    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

    Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay     =    1000
        TauntAndPointExcluded        =    NONE
        AfraidOf                     =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf               =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
        PointAt                      =    EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance             =    150
        FearScanDistance             =    ARCHER_FEAR_SCAN_RADIUS


        AddEmotion    =    Terror_Base
        AddEmotion    =    Doom_Base
        AddEmotion    =    BraceForBeingCrushed_Base
        AddEmotion    =    UncontrollableFear_Base
        AddEmotion    =    FearIdle_Base
        AddEmotion    =    FearBusy_Base
        AddEmotion    =    Point_Base
        AddEmotion    =    Taunt_Base
        AddEmotion    =    CheerIdle_Base
        AddEmotion    =    CheerBusy_Base
        AddEmotion    =    HeroCheerIdle_Base
        AddEmotion    =    HeroCheerBusy_Base
        AddEmotion    =    Alert_Base
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly        = Yes
        StuffToPickUp         = ANY +CRATE -TheDroppedRing
        ScanRange             = 200
        ScanIntervalSeconds   = 0.5
    End

    LocomotorSet
        Locomotor     = NormalMeleeHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_FOOT_IMLADRIS_HORDE_SPEED
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTrainingImladis
        LevelsToGain = 1
        LevelCap = 2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality
        TriggeredBy = Upgrade_SilverThornArrows
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_HeavyArmor
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality3
        TriggeredBy = Upgrade_HerzdesFeuers
    End

    Behavior = WeaponSetUpgrade ModuleTag_WeaponSetUpgradeTagEregions
        TriggeredBy = Upgrade_BruchtalFireArrowsEregions
    End

    Behavior = CommandSetUpgrade ModueTag_CommandSetEregions
        TriggeredBy            = Upgrade_SilverThornArrows
        CommandSet             = BruchtalBogenschuetzenHordeCommandset_Eregions
    End

; --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

	Behavior = DoCommandUpgrade Module_DoCommandUpgrade2    
        TriggeredBy                 = Upgrade_ErestorZweiteReihe
        RequiresAllTriggers         = Yes
        GetUpgradeCommandButtonName = Command_SpecialAbilityOrkstadtOrksSummon
    End

	Behavior = ObjectCreationUpgrade ModuleTag_RemoveHealUpgrade
		TriggeredBy = Upgrade_ErestorZweiteReihe
		RemoveUpgrade = Upgrade_ErestorZweiteReihe
		Delay = 10000
	End

    Behavior = OCLSpecialPower ModuleTag_OCLSpecialPower
        StartsPaused                = No
        SpecialPowerTemplate        = SpecialAbilityOrkstadtOrksSummon
        OCL                         = OCL_SpawnErestorBogenschuetze
        CreateLocation              = CREATE_AT_LOCATION
    End

; --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    Behavior = AISpecialPowerUpdate ElvenLorienWarriorHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 50.0
    GeometryHeight = 20.0
    GeometryIsSmall = No




    AutoResolveUnitType = AutoResolveUnit_Archer
    AutoResolveCombatChain = AutoResolve_ArcherCombatChain

    AutoResolveBody = AutoResolve_ElvenLorienArcherHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_ElvenLorienArcherHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_ElvenLorienArcherArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_SilverThornArrows
        Weapon = AutoResolve_ElvenLorienArcherUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_SilverThornArrows
        Weapon = AutoResolve_ElvenLorienArcherWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTrainingImladis Upgrade_SilverThornArrows Upgrade_HeavyArmor
End

ChildObject BruchtalBogenschuetzenErestorHorde BruchtalBogenschuetzenHorde

    IsTrainable    = No
    CommandPoints  = 0
	EquivalentTo   = BruchtalBogenschuetzenHorde
	
	Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle                 = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay               = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained     =
        InitialPayload             = BruchtalBogenschuetzenErestor 5
        Slots                 = 5
        PassengerFilter            = NONE +INFANTRY
        ShowPips             = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset            = X:0 Y:0
        MeleeBehavior             = Amoeba
        End

        RankInfo = RankNumber:1 UnitType:BruchtalBogenschuetzenErestor Position:X:50 Y:0            Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:50 Y:40        Position:X:50 Y:-40

		ComboHorde = Target:BruchtalBogenschuetzenHorde             Result:BruchtalBogenschuetzenErestorComboHorde        InitiateVoice:ElfBruchtalWarriorVoiceSalute

        RanksToReleaseWhenAttacking = 1

        MeleeAttackLeashDistance     = 1
        BackUpMinDelayTime        = 1
        BackUpMaxDelayTime        = 3000
        BackUpMinDistance        = 1
        BackUpMaxDistance        = 3
        BackupPercentage        = 80%
    End
End

ChildObject BruchtalBogenschuetzenHordeAmbush BruchtalBogenschuetzenHorde

    Behavior = HordeContain ModuleTag_HordeContain
        ObjectStatusOfContained            =
        InitialPayload                    = BruchtalBogenschuetzen 5
        Slots                            = 5
        PassengerFilter                    = NONE +INFANTRY
        ShowPips                        = No
        ThisFormationIsTheMainFormation = No
        AttributeModifiers                = ImladrisArcherAmbush
        RandomOffset                    = X:0 Y:0
        MeleeBehavior = Amoeba
        End


        BannerCarriersAllowed    = ImladrisBanner
        BannerCarrierPosition    = UnitType:BruchtalBogenschuetzen    Pos:X:15.0 Y:0.0


        RankInfo = RankNumber:1 UnitType:BruchtalBogenschuetzen   Position:X:50 Y:-40    Position:X:25 Y:-25    Position:X:50 Y:0    Position:X:25 Y:25    Position:X:50 Y:40

        RanksToReleaseWhenAttacking = 1

        AlternateFormation = BruchtalBogenschuetzenHorde
        MeleeAttackLeashDistance = 1
        BackUpMinDelayTime         = 1
        BackUpMaxDelayTime         = 3000
        BackUpMinDistance         = 1
        BackUpMaxDistance         = 3
        BackupPercentage         = 80%
    End

End


ChildObject BruchtalBogenschuetzenHorde_Summoned BruchtalBogenschuetzenHorde
    IsTrainable    = No
    CommandPoints     = 0
    CommandSet    = BruchtalLancerHordeSummonedCommandSet
    EquivalentTo      = BruchtalBogenschuetzenHorde
    DisplayName  =  OBJECT:HordeBruchtalBogenschuetzen
    KindOf                = +SUMMONED


    Behavior = HordeContain ModuleTag_HordeContain
        ObjectStatusOfContained =
        InitialPayload = BruchtalBogenschuetzen_Summoned 10
        Slots = 10
        PassengerFilter = NONE +INFANTRY
        ShowPips = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset = X:1 Y:1


        BannerCarriersAllowed    = ImladrisBanner
        BannerCarrierPosition    = UnitType:BruchtalBogenschuetzen_Summoned    Pos:X:70.0 Y:0.0


        RankInfo = RankNumber:1 UnitType:BruchtalBogenschuetzen_Summoned Position:X:50 Y:0            Position:X:50 Y:20                Position:X:50 Y:-20                Position:X:50 Y:40                Position:X:50 Y:-40
        RankInfo = RankNumber:2 UnitType:BruchtalBogenschuetzen_Summoned Position:X:30 Y:0            Position:X:30 Y:20                Position:X:30 Y:-20                Position:X:30 Y:40                Position:X:30 Y:-40

        RanksToReleaseWhenAttacking = 1 2
    End

    Behavior = LifetimeUpdate ModuleTag_LifetimeUpdate

        MinLifetime        = 180000
        MaxLifetime        = 180000
        DeathType        = FADED
    End
End

Object ImladrisSwordManErestorComboHorde 

    ButtonImage            = UPImladrisSchwert2
    SelectPortrait         = UPImladrisSchwert2

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags     = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR
        DefaultModelConditionState
            Model         = None
        End
        ModelConditionState     = HORDE_EMPTY
            Model         = None
        End
        ModelConditionState     = WORLD_BUILDER
            Model         = HordeMarkEULoW
        End
    End

    Side                 = Imladris
    EditorSorting        = UNIT
    EmotionRange         = 240
    DisplayName          = OBJECT:HordeBruchtalSchwertkampfer
    DisplayNameStrategic = CONTROLBAR:LW_Unit_HordeBruchtalSchwertkampfer
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_HordeBruchtalSchwertkampfer


    WeaponSet
        Conditions     = None
        Weapon         = PRIMARY    NormalMeleeHordeRangefinder
    End
    WeaponSet
        Conditions     = CONTAINED
        Weapon         = PRIMARY GarrisonedUnitBowHordeRangefinder
    End

    CommandSet         = BruchtalSchwertkampferHordeCommandset


    #include "..\..\..\includes\StandardHordeEvaEvents.inc"


    CrushableLevel         = 0
    CrusherLevel         = 0

    ShroudClearingRange = INFANTRY_HORDE_SHROUD_CLEARING
    VisionRange = INFANTRY_HORDE_VISION_RANGE
    VisionSide = INFANTRY_HORDE_VISION_SIDE
    VisionRear = INFANTRY_HORDE_VISION_REAR
    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = INFANTRY_VISION_BONUS_TEST_RADIUS
    VisionBonusPercentPerFoot = INFANTRY_HORDE_VISION_BONUS_PERCENT

    CommandPoints = IMLADRIS_WACHTER_HORDE_COMMAND_POINTS

    FormationWidth         = 2
    FormationDepth         = 2

    TransportSlotCount         = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf             = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE ARMY_SUMMARY MELEE_HORDE LARGE_RECTANGLE_PATHFIND

    ThreatLevel         = ELVEN_LORIENWARRIOR_HORDE_THREAT
    ThreatBreakdown ElvenLorienWarriorHorde_DetailedThreat
        AIKindOf     = INFANTRY
    End

    Body             = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth     = 1
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = FighterHorde
    End


    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle    = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate           = 500
        MaxCowerTime                  = 5000
        MinCowerTime                  = 3000
        AILuaEventsList               = InfantryFunctions
        AttackPriority                = AttackPriority_Infantry
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle                 = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay               = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained     =
        InitialPayload             = ImladrisSwordMan 5
        InitialPayload             = ImladrisSwordManErestor 5
        Slots                 = 10
        PassengerFilter         = NONE +INFANTRY
        ShowPips            = No
        ThisFormationIsTheMainFormation = Yes

        RandomOffset            = X:0 Y:0
        MeleeBehavior             = Amoeba
        End


        BannerCarriersAllowed        = ImladrisBanner
        BannerCarrierPosition        = UnitType:ImladrisSwordMan    Pos:X:70.0 Y:0.0


        RankInfo = RankNumber:1 UnitType:ImladrisSwordMan 	Position:X:50 Y:0            Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:50 Y:40        Position:X:50 Y:-40
		RankInfo = RankNumber:2 UnitType:ImladrisSwordManErestor    Position:X:30 Y:0  Leader 1 0        Position:X:30 Y:20 Leader 1 1        Position:X:30 Y:-20 Leader 1 2        Position:X:30 Y:40 Leader 1 3        Position:X:30 Y:-40 Leader 1 4


        MeleeAttackLeashDistance = 1
        RanksToReleaseWhenAttacking = 1 2
        RanksToJustFreeWhenAttacking = 1 2

        MeleeAttackLeashDistance     = 1
        BackUpMinDelayTime        = 1
        BackUpMaxDelayTime        = 3000
        BackUpMinDistance        = 1
        BackUpMaxDistance        = 3
        BackupPercentage        = 80%
    End



    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

     Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance       =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded       =    NONE
        AfraidOf                    =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf              =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
         PointAt                    =    EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance            =    150
        FearScanDistance            =    ARCHER_FEAR_SCAN_RADIUS



        AddEmotion    =    Terror_Base
        AddEmotion    =    Doom_Base
        AddEmotion    =    BraceForBeingCrushed_Base
        AddEmotion    =    UncontrollableFear_Base
        AddEmotion    =    FearIdle_Base
        AddEmotion    =    FearBusy_Base
        AddEmotion    =    Point_Base
        AddEmotion    =    Taunt_Base
        AddEmotion    =    CheerIdle_Base
        AddEmotion    =    CheerBusy_Base
        AddEmotion    =    HeroCheerIdle_Base
        AddEmotion    =    HeroCheerBusy_Base
        AddEmotion    =    Alert_Base
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly        = Yes
        StuffToPickUp         = ANY +CRATE -TheDroppedRing
        ScanRange             = 200
        ScanIntervalSeconds   = 0.5
    End

    LocomotorSet
        Locomotor     = NormalMeleeHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_FOOT_IMLADRIS_HORDE_SPEED
    End

; --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_StandhaltenEnabler
        SpecialPowerTemplate = SpecialAbilityBruchtalStandhalten
        TriggeredBy          = Upgrade_AllFactionUpgrade
    End

    Behavior = WeaponModeSpecialPowerUpdate ModuleTag_StandhaltenPowerUpdate
        SpecialPowerTemplate = SpecialAbilityBruchtalStandhalten
        Duration             = 30000
        AttributeModifier    = BruchtalStandhaltenModifier
        LockWeaponSlot       = SECONDARY
        StartsPaused         = No
    End

    Behavior = AutoAbilityBehavior ModuleTag_StandhaltenAutoAbility
		SpecialAbility		= SpecialAbilityBruchtalStandhalten
		ForbiddenStatus 	= INSIDE_GARRISON
		MaxScanRange		= 100
		Query			= 5 ANY ENEMIES +CAVALRY
		Query			= 15 ALL ENEMIES
	End

; --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_VorruckenEnabler
        SpecialPowerTemplate = SpecialAbilityBruchtalVorrucken
        TriggeredBy          = Upgrade_AllFactionUpgrade
    End

    Behavior = WeaponModeSpecialPowerUpdate ModuleTag_VorruckenPowerUpdate
        SpecialPowerTemplate = SpecialAbilityBruchtalVorrucken
        Duration             = 30000
        AttributeModifier    = BruchtalVorruckenModifier
        LockWeaponSlot       = SECONDARY
        StartsPaused         = No
    End

    Behavior = AutoAbilityBehavior ModuleTag_VorruckenAutoAbility

	SpecialAbility		= SpecialAbilityBruchtalVorrucken
		ForbiddenStatus 	= INSIDE_GARRISON
		MaxScanRange		= 100
		Query			= 15 ALL ENEMIES
	End

; --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTrainingImladis
        LevelsToGain = 1
        LevelCap = 2
    End

    Behavior = AttributeModifierUpgrade ModuleTag_Level2BonusFighter
        TriggeredBy       = Upgrade_ObjectLevel2
        AttributeModifier = ImladrisFighterRank2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality
        TriggeredBy = Upgrade_ForgedBlades
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_HeavyArmor
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality3
        TriggeredBy = Upgrade_HerzdesFeuers
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality5
        TriggeredBy = Upgrade_BruchtalForgedBladesEregions
    End

    Behavior = CommandSetUpgrade ModueTag_CommandSetEregions
        TriggeredBy            = Upgrade_ForgedBlades
        CommandSet             = BruchtalSchwertkampferHordeCommandset_Eregions
    End

; --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    Behavior = AISpecialPowerUpdate ElvenLorienWarriorHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End


    Geometry         = BOX
    GeometryMajorRadius     = 30.0
    GeometryMinorRadius     = 50.0
    GeometryHeight         = 20.0
    GeometryIsSmall     = No


    AutoResolveUnitType = AutoResolveUnit_Soldier
    AutoResolveCombatChain = AutoResolve_SoldierCombatChain

    AutoResolveBody = AutoResolve_ElvenLorienWarriorHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_ElvenLorienWarriorHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_ElvenLorienWarriorArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_ElvenLorienWarriorUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_ElvenLorienWarriorWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTrainingImladis Upgrade_ForgedBlades Upgrade_HeavyArmor
End

Object BruchtalLancerErestorComboHorde

    ButtonImage            = UPImladrisLanze
    SelectPortrait         = UPImladrisLanze

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR
        DefaultModelConditionState
            Model = None
        End
        ModelConditionState = HORDE_EMPTY
            Model = None
        End
        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkEULoW
        End
    End

    Side = Imladris
    EditorSorting = UNIT
    EmotionRange = 240
    DisplayName = OBJECT:HordeBruchtalLanzer
    DisplayNameStrategic = CONTROLBAR:LW_Unit_BruchtalLanzer
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_ElvenMithlondSentryHorde

    WeaponSet
        Conditions            = None
        Weapon                = PRIMARY    NormalPikeHordeRangefinder
        Weapon                = SECONDARY  NormalPikeHordeRangefinder
        AutoChooseSources     = SECONDARY NONE
        ShareWeaponReloadTime = Yes
    End


    CommandSet = BruchtalLancerHordeCommandSet


    #include "..\..\..\includes\StandardHordeEvaEvents.inc"


    CrushableLevel = 0
    CrusherLevel = 0

    VisionRange = PIKEMAN_HORDE_VISION_RANGE
    ShroudClearingRange = PIKEMAN_HORDE_SHROUD_CLEARING
    VisionSide = PIKEMAN_HORDE_VISION_SIDE
    VisionRear = PIKEMAN_HORDE_VISION_REAR
    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = PIKEMAN_VISION_BONUS_TEST_RADIUS
    VisionBonusPercentPerFoot = PIKEMAN_HORDE_VISION_BONUS_PERCENT

    CommandPoints = IMLADRIS_WACHTER_HORDE_COMMAND_POINTS

    FormationWidth = 2
    FormationDepth = 2

    TransportSlotCount = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE ARMY_SUMMARY MELEE_HORDE LARGE_RECTANGLE_PATHFIND PIKE

    ThreatLevel = ELVEN_MITHLONDSENTRY_HORDE_THREAT
    ThreatBreakdown ElvenMithlondSentryHorde_DetailedThreat
        AIKindOf = PIKEMAN
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = PikeHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle    =    Yes ATTACK_BUILDINGS
        MoodAttackCheckRate        =    500
        MaxCowerTime            =    5000
        MinCowerTime            =    3000
        AILuaEventsList            =    InfantryFunctions
        AttackPriority            =     AttackPriority_Spearman
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle   = STANDARD_PIKEMAN_FRONTANGLE
        FlankedDelay = STANDARD_PIKEMAN_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload = BruchtalLanzer 5
		InitialPayload = BruchtalLanzerErestor 5
        Slots = 10
        PassengerFilter = NONE +INFANTRY
        ShowPips = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset = X:0 Y:0
        MeleeBehavior = Amoeba
        End


        BannerCarriersAllowed    = ImladrisBanner
        BannerCarrierPosition    = UnitType:BruchtalLanzer    Pos:X:70.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:BruchtalLanzer Position:X:50 Y:0        Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:50 Y:40        Position:X:50 Y:-40
		RankInfo = RankNumber:2 UnitType:BruchtalLanzerErestor    Position:X:30 Y:0  Leader 1 0        Position:X:30 Y:20 Leader 1 1        Position:X:30 Y:-20 Leader 1 2        Position:X:30 Y:40 Leader 1 3        Position:X:30 Y:-40 Leader 1 4

        MeleeAttackLeashDistance = 2
        RanksToReleaseWhenAttacking = 1 2
        RanksToJustFreeWhenAttacking = 1 2
		
        BackUpMinDelayTime         = 1
        BackUpMaxDelayTime         = 3000
        BackUpMinDistance         = 1
        BackUpMaxDistance         = 3
        BackupPercentage         = 80%

        AlternateFormation = BruchtalLancerErestorComboHordePorcupine
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

    Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance       =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded       =    NONE
        AfraidOf                    =    EMOTION_AFRAIDOF_OBJECTFILTER_LANCERS
        AlwaysAfraidOf              =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER_LANCERS
        PointAt                     =    EMOTION_POINTAT_OBJECTFILTER_LANCERS
        HeroScanDistance            =    150
        FearScanDistance            =    INFANTRY_FEAR_SCAN_RADIUS


        AddEmotion    =    Terror_Base
        AddEmotion    =    Doom_Base
        AddEmotion    =    UncontrollableFear_Base
        AddEmotion    =    FearIdle_Base
        AddEmotion    =    FearBusy_Base
        AddEmotion    =    Point_Base
        AddEmotion    =    Taunt_Base
        AddEmotion    =    CheerIdle_Base
        AddEmotion    =    CheerBusy_Base
        AddEmotion    =    HeroCheerIdle_Base
        AddEmotion    =    HeroCheerBusy_Base
        AddEmotion    =    Alert_Base
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly        = Yes
        StuffToPickUp         = ANY +CRATE -TheDroppedRing
        ScanRange             = 200
        ScanIntervalSeconds   = 0.5
    End

    LocomotorSet
        Locomotor     = NormalMeleeHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_FOOT_IMLADRIS_HORDE_SPEED
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTrainingImladis
        LevelsToGain = 1
        LevelCap = 2
    End

    Behavior = AttributeModifierUpgrade ModuleTag_Level2BonusLancer
        TriggeredBy       = Upgrade_ObjectLevel2
        AttributeModifier = ImladrisLancerRank2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality
        TriggeredBy = Upgrade_ForgedBlades
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_HeavyArmor
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality3
        TriggeredBy = Upgrade_HerzdesFeuers
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality5
        TriggeredBy = Upgrade_BruchtalForgedBladesEregions
    End

    Behavior = CommandSetUpgrade ModueTag_CommandSetEregions
        TriggeredBy            = Upgrade_ForgedBlades
        CommandSet             = BruchtalLancerHordeCommandSet_Eregions
    End

; --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_ImladrisNewLeadership
        SpecialPowerTemplate		= SpecialAbilityFakeLeadership
        TriggeredBy   				= Upgrade_ObjectLevel1
    End

    Behavior = SpecialPowerModule ModuleTag_ImladrisNewLeadershipUpdate
        SpecialPowerTemplate        = SpecialAbilityFakeLeadership
        UpdateModuleStartsAttack    = No
        StartsPaused                = Yes
    End

    Behavior = AttributeModifierAuraUpdate ModuleTag_LeadershipSpell
        StartsActive     = No
        BonusName        = ImladrisPikesNew
        TriggeredBy      = Upgrade_RaiseShield
        RefreshDelay     = 2000
        Range            = 150
	    TargetEnemy	 = No
        ObjectFilter     = NONE +BruchtalLanzer +BruchtalLancerHorde
    End

; --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    Behavior = AISpecialPowerUpdate ElvenMithlondSentryHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 45.0
    GeometryHeight = 20.0
    GeometryIsSmall = No



    AutoResolveUnitType = AutoResolveUnit_Pikemen
    AutoResolveCombatChain = AutoResolve_PikemenCombatChain

    AutoResolveBody = AutoResolve_ElvenMithlondSentryHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_ElvenMithlondSentryHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_ElvenMithlondSentryArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_ElvenMithlondSentryUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_ElvenMithlondSentryWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTrainingImladis Upgrade_ForgedBlades Upgrade_HeavyArmor
End

ChildObject BruchtalLancerErestorComboHordePorcupine BruchtalLancerErestorComboHorde

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle   = STANDARD_PIKEMAN_FRONTANGLE_FORMATION
        FlankedDelay = STANDARD_PIKEMAN_FLANKEDDELAY
        ObjectStatusOfContained         =
        InitialPayload	 				= BruchtalLanzer 5
        InitialPayload 					= BruchtalLanzerErestor 5
        Slots 							= 10
        PassengerFilter                 = NONE +INFANTRY
        ShowPips                        = No
        ThisFormationIsTheMainFormation = No
        AttributeModifiers              = ImladrisLanceWall
        RandomOffset                    = X:0 Y:0
        MeleeBehavior = Amoeba
        End


        BannerCarriersAllowed    = ImladrisBanner
        BannerCarrierPosition    = UnitType:BruchtalLanzer Pos:X:-25.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:BruchtalLanzer Position:X:0 Y:0        Position:X:0 Y:12.5        Position:X:0 Y:-12.5        Position:X:0 Y:25        Position:X:0 Y:-25
		RankInfo = RankNumber:2 UnitType:BruchtalLanzerErestor    Position:X:20 Y:0  Leader 1 0        Position:X:20 Y:20 Leader 1 1        Position:X:20 Y:-20 Leader 1 2        Position:X:20 Y:40 Leader 1 3        Position:X:20 Y:-40 Leader 1 4

        MeleeAttackLeashDistance = 2
        RanksToReleaseWhenAttacking = 1 2
        RanksToJustFreeWhenAttacking = 1 2

        AlternateFormation = BruchtalLancerErestorComboHorde
        BackUpMinDelayTime         = 1
        BackUpMaxDelayTime         = 3000
        BackUpMinDistance         = 1
        BackUpMaxDistance         = 3
        BackupPercentage         = 80%
    End
End

Object ImladrisWaffenmeisterErestorComboHorde 

    ButtonImage     = UPImladrisSwordEinzel
    SelectPortrait  = UPImladrisSwordEinzel

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags     = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR
        DefaultModelConditionState
            Model     = None
        End
        ModelConditionState = HORDE_EMPTY
            Model = None
        End
        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkEULoW
        End
    End

    Side             = Imladris
    EditorSorting    = UNIT
    EmotionRange     = 240
    DisplayName      = OBJECT:HordeImladrisWaffenmeister
    DisplayNameStrategic = CONTROLBAR:LW_Unit_ImladrisWaffenmeisterHorde
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_ImladrisWaffenmeisterHorde

    WeaponSet
        Conditions            = None
        Weapon                = PRIMARY      NormalMeleeHordeRangefinder
        Weapon                = SECONDARY    NormalMeleeHordeRangefinder
        AutoChooseSources     = SECONDARY NONE
        ShareWeaponReloadTime = Yes
    End

    CommandSet = BruchtalWaffenmeisterHordeCommandset



    #include "..\..\..\includes\StandardHordeEvaEvents.inc"


    CrushableLevel = 0
    CrusherLevel   = 0

    ShroudClearingRange = INFANTRY_HORDE_SHROUD_CLEARING
    VisionRange = INFANTRY_HORDE_VISION_RANGE
    VisionSide = INFANTRY_HORDE_VISION_SIDE
    VisionRear = INFANTRY_HORDE_VISION_REAR
    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = INFANTRY_VISION_BONUS_TEST_RADIUS
    VisionBonusPercentPerFoot = INFANTRY_HORDE_VISION_BONUS_PERCENT

    CommandPoints         = IMLADRIS_WACHTER_HORDE_COMMAND_POINTS

    FormationWidth = 2
    FormationDepth = 2

    TransportSlotCount = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE ARMY_SUMMARY MELEE_HORDE LARGE_RECTANGLE_PATHFIND PIKE

    ThreatLevel = ELVEN_MITHLONDSENTRY_HORDE_THREAT
    ThreatBreakdown ElvenLorienWarriorHorde_DetailedThreat
        AIKindOf     = INFANTRY
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = FighterHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle  = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate         = 500
        MaxCowerTime                = 5000
        MinCowerTime                = 3000
        AILuaEventsList             = InfantryFunctions
        AttackPriority              = AttackPriority_Infantry
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle                 = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay               = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload = ImladrisWaffenmeister 5
		InitialPayload = ImladrisWaffenmeisterErestor 5
        Slots = 10
        PassengerFilter = NONE +INFANTRY
        ShowPips = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset = X:0 Y:0
        MeleeBehavior = Amoeba
        End


        BannerCarriersAllowed    = ImladrisBanner
        BannerCarrierPosition    = UnitType:ImladrisWaffenmeister    Pos:X:70.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:ImladrisWaffenmeister Position:X:50 Y:0        Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:50 Y:40        Position:X:50 Y:-40
		RankInfo = RankNumber:2 UnitType:ImladrisWaffenmeisterErestor    Position:X:30 Y:0  Leader 1 0        Position:X:30 Y:20 Leader 1 1        Position:X:30 Y:-20 Leader 1 2        Position:X:30 Y:40 Leader 1 3        Position:X:30 Y:-40 Leader 1 4

        MeleeAttackLeashDistance = 2
        RanksToReleaseWhenAttacking = 1 2
        RanksToJustFreeWhenAttacking = 1 2
		
        BackUpMinDelayTime        = 1
        BackUpMaxDelayTime        = 3000
        BackUpMinDistance        = 1
        BackUpMaxDistance        = 3
        BackupPercentage        = 80%
    End



    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

     Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded        =    NONE
        AfraidOf            =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf            =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
         PointAt                =    EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance        =    150
        FearScanDistance        =    INFANTRY_FEAR_SCAN_RADIUS



        AddEmotion    =    Terror_Base
        AddEmotion    =    Doom_Base
        AddEmotion    =    UncontrollableFear_Base
        AddEmotion    =    FearIdle_Base
        AddEmotion    =    FearBusy_Base
        AddEmotion    =    Point_Base
        AddEmotion    =    Taunt_Base
        AddEmotion    =    CheerIdle_Base
        AddEmotion    =    CheerBusy_Base
        AddEmotion    =    HeroCheerIdle_Base
        AddEmotion    =    HeroCheerBusy_Base
        AddEmotion    =    Alert_Base
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly        = Yes
        StuffToPickUp         = ANY +CRATE -TheDroppedRing
        ScanRange             = 200
        ScanIntervalSeconds   = 0.5
    End

; --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_Enabler
        SpecialPowerTemplate = SpecialAbilityHammerschlage
        TriggeredBy          = Upgrade_AllFactionUpgrade
    End

    Behavior = WeaponModeSpecialPowerUpdate ModuleTag_PowerUpdate
        SpecialPowerTemplate = SpecialAbilityHammerschlage
        Duration             = 30000
        AttributeModifier    = WaffenkunstModifier
        LockWeaponSlot       = SECONDARY
        StartsPaused         = No
    End

    Behavior = AutoAbilityBehavior ModuleTag_AutoAbilityPower
        SpecialAbility       = SpecialAbilityHammerschlage
        MaxScanRange         = 65
        Query                = 10 ANY ENEMIES +INFANTRY
    End

; --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    LocomotorSet
        Locomotor     = NormalMeleeHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_FOOT_IMLADRIS_HORDE_SPEED
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTrainingImladis
        LevelsToGain = 1
        LevelCap = 2
    End

    Behavior = AttributeModifierUpgrade ModuleTag_Level2BonusFighter
        TriggeredBy       = Upgrade_ObjectLevel2
        AttributeModifier = ImladrisFighterRank2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality
        TriggeredBy = Upgrade_HeavyArmor
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_ForgedBlades
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality3
        TriggeredBy = Upgrade_HerzdesFeuers
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality5
        TriggeredBy = Upgrade_BruchtalForgedBladesEregions
    End

    Behavior = CommandSetUpgrade ModueTag_CommandSetEregions
        TriggeredBy            = Upgrade_ForgedBlades
        CommandSet             = BruchtalWaffenmeisterHordeCommandset_Eregions
    End







    Behavior = AISpecialPowerUpdate ElvenMithlondSentryHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End


    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 45.0
    GeometryHeight = 20.0
    GeometryIsSmall = No




    AutoResolveUnitType = AutoResolveUnit_Pikemen
    AutoResolveCombatChain = AutoResolve_PikemenCombatChain

    AutoResolveBody = AutoResolve_ElvenMithlondSentryHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_ElvenMithlondSentryHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_ElvenMithlondSentryArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_ElvenMithlondSentryUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_ElvenMithlondSentryWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTrainingImladis Upgrade_ForgedBlades Upgrade_HeavyArmor
End

Object BruchtalBogenschuetzenErestorComboHorde

    ButtonImage     = UPImladrisBogen2
    SelectPortrait  = UPImladrisBogen2

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR
        DefaultModelConditionState
            Model = None
        End
        ModelConditionState = HORDE_EMPTY
            Model = None
        End
        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkEULoW
        End
    End

    Side = Imladris
    EditorSorting = UNIT
    EmotionRange = 240
    DisplayName = Object:BruchtalBogenschutzen
    DisplayNameStrategic = CONTROLBAR:LW_Unit_BruchtalBogenschutzenHorde
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_ElvenLorienArcherHorde

    WeaponSet
        Conditions = None
        Weapon     = PRIMARY    ArcherHordeRangefinderMedium
    End

    CommandSet = BruchtalBogenschuetzenHordeCommandset

    #include "..\..\..\includes\StandardHordeEvaEvents.inc"

    CrushableLevel     = 0
    CrusherLevel       = 0
	

    VisionRange           = ARCHER_HORDE_VISION_RANGE_MEDIUM
    ShroudClearingRange   = ARCHER_HORDE_SHROUD_CLEARING_MEDIUM
    VisionSide            = ARCHER_HORDE_VISION_SIDE
    VisionRear            = ARCHER_HORDE_VISION_REAR
    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = ARCHER_VISION_BONUS_TEST_RADIUS
    VisionBonusPercentPerFoot = ARCHER_HORDE_VISION_BONUS_PERCENT

    CommandPoints = IMLADRIS_WACHTER_HORDE_COMMAND_POINTS

    FormationWidth = 2
    FormationDepth = 2

    TransportSlotCount = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE ARCHER ARMY_SUMMARY LARGE_RECTANGLE_PATHFIND MELEE_HORDE

    ThreatLevel = ELVEN_LORIENARCHER_HORDE_THREAT
    ThreatBreakdown ElvenLorienArcherHorde_DetailedThreat
        AIKindOf = ARCHER
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = ArcherHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle  = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate         = 500
        MaxCowerTime                = 5000
        MinCowerTime                = 3000
        CanAttackWhileContained     = Yes
        AILuaEventsList             = InfantryFunctions
        AttackPriority              = AttackPriority_Archer
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle                 = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay               = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload = BruchtalBogenschuetzen 5
		InitialPayload = BruchtalBogenschuetzenErestor 5
        Slots = 10
        PassengerFilter = NONE +INFANTRY
        ShowPips = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset = X:0 Y:0
        MeleeBehavior = Amoeba
        End


        BannerCarriersAllowed    = ImladrisBanner
        BannerCarrierPosition    = UnitType:BruchtalBogenschuetzen    Pos:X:70.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:BruchtalBogenschuetzen Position:X:50 Y:0        Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:50 Y:40        Position:X:50 Y:-40
		RankInfo = RankNumber:2 UnitType:BruchtalBogenschuetzenErestor    Position:X:30 Y:0  Leader 1 0        Position:X:30 Y:20 Leader 1 1        Position:X:30 Y:-20 Leader 1 2        Position:X:30 Y:40 Leader 1 3        Position:X:30 Y:-40 Leader 1 4

        MeleeAttackLeashDistance = 2
        RanksToReleaseWhenAttacking = 1 2
        RanksToJustFreeWhenAttacking = 1 2
		
        AlternateFormation = BruchtalBogenschuetzenErestorComboHordeAmbush

        BackUpMinDelayTime        = 1
        BackUpMaxDelayTime        = 3000
        BackUpMinDistance         = 1
        BackUpMaxDistance         = 3
        BackupPercentage          = 80%
    End


    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

    Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay     =    1000
        TauntAndPointExcluded        =    NONE
        AfraidOf                     =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf               =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
        PointAt                      =    EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance             =    150
        FearScanDistance             =    ARCHER_FEAR_SCAN_RADIUS


        AddEmotion    =    Terror_Base
        AddEmotion    =    Doom_Base
        AddEmotion    =    BraceForBeingCrushed_Base
        AddEmotion    =    UncontrollableFear_Base
        AddEmotion    =    FearIdle_Base
        AddEmotion    =    FearBusy_Base
        AddEmotion    =    Point_Base
        AddEmotion    =    Taunt_Base
        AddEmotion    =    CheerIdle_Base
        AddEmotion    =    CheerBusy_Base
        AddEmotion    =    HeroCheerIdle_Base
        AddEmotion    =    HeroCheerBusy_Base
        AddEmotion    =    Alert_Base
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly        = Yes
        StuffToPickUp         = ANY +CRATE -TheDroppedRing
        ScanRange             = 200
        ScanIntervalSeconds   = 0.5
    End

    LocomotorSet
        Locomotor     = NormalMeleeHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_FOOT_IMLADRIS_HORDE_SPEED
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTrainingImladis
        LevelsToGain = 1
        LevelCap = 2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality
        TriggeredBy = Upgrade_SilverThornArrows
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_HeavyArmor
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality3
        TriggeredBy = Upgrade_HerzdesFeuers
    End

    Behavior = WeaponSetUpgrade ModuleTag_WeaponSetUpgradeTagEregions
        TriggeredBy = Upgrade_BruchtalFireArrowsEregions
    End

    Behavior = CommandSetUpgrade ModueTag_CommandSetEregions
        TriggeredBy            = Upgrade_SilverThornArrows
        CommandSet             = BruchtalBogenschuetzenHordeCommandset_Eregions
    End

; --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    Behavior = AISpecialPowerUpdate ElvenLorienWarriorHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 50.0
    GeometryHeight = 20.0
    GeometryIsSmall = No




    AutoResolveUnitType = AutoResolveUnit_Archer
    AutoResolveCombatChain = AutoResolve_ArcherCombatChain

    AutoResolveBody = AutoResolve_ElvenLorienArcherHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_ElvenLorienArcherHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_ElvenLorienArcherArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_SilverThornArrows
        Weapon = AutoResolve_ElvenLorienArcherUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_SilverThornArrows
        Weapon = AutoResolve_ElvenLorienArcherWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTrainingImladis Upgrade_SilverThornArrows Upgrade_HeavyArmor
End

ChildObject BruchtalBogenschuetzenErestorComboHordeAmbush BruchtalBogenschuetzenErestorComboHorde

    Behavior = HordeContain ModuleTag_HordeContain
        ObjectStatusOfContained            =
        InitialPayload                    = BruchtalBogenschuetzen 5
		InitialPayload                    = BruchtalBogenschuetzenErestor 5
        Slots                            = 10
        PassengerFilter                    = NONE +INFANTRY
        ShowPips                        = No
        ThisFormationIsTheMainFormation = No
        AttributeModifiers                = ImladrisArcherAmbush
        RandomOffset                    = X:0 Y:0
        MeleeBehavior = Amoeba
        End


        BannerCarriersAllowed    = ImladrisBanner
        BannerCarrierPosition    = UnitType:BruchtalBogenschuetzen    Pos:X:15.0 Y:0.0


        RankInfo = RankNumber:1 UnitType:BruchtalBogenschuetzen   Position:X:50 Y:-40    Position:X:25 Y:-25    Position:X:50 Y:0    Position:X:25 Y:25    Position:X:50 Y:40
		RankInfo = RankNumber:1 UnitType:BruchtalBogenschuetzenErestor   Position:X:50 Y:-40    Position:X:25 Y:-25    Position:X:50 Y:0    Position:X:25 Y:25    Position:X:50 Y:40

        MeleeAttackLeashDistance = 2
        RanksToReleaseWhenAttacking = 1 2
        RanksToJustFreeWhenAttacking = 1 2

        AlternateFormation = BruchtalBogenschuetzenErestorComboHorde
        BackUpMinDelayTime         = 1
        BackUpMaxDelayTime         = 3000
        BackUpMinDistance         = 1
        BackUpMaxDistance         = 3
        BackupPercentage         = 80%
    End

End

Object ElvenRivendellLancerHordeMod

    SelectPortrait = UPImladrisKnight
    ButtonImage    = USImladrisKnight

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR EMOTION_CELEBRATING
        DefaultModelConditionState
            Model = None
        End
        ModelConditionState = HORDE_EMPTY
            Model = None
        End
        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkEURIL
        End
    End

    Side                = Imladris
    EditorSorting       = UNIT
    EmotionRange        = 240
    DisplayName         = OBJECT:HordeElvenRivendellLancer
    DisplayNameStrategic     = CONTROLBAR:LW_Unit_ElvenRivendellLancerHorde
    DescriptionStrategic     = CONTROLBAR:LW_ToolTip_ElvenRivendellLancerHorde

    WeaponSet
        Conditions    = None
        Weapon        = PRIMARY    NormalMeleeHordeRangefinder
    End





    #include "..\..\..\includes\StandardHordeEvaEvents.inc"

    BuildCost          = 500
    BuildTime          = MEDIUM_BUILDTIME
    VisionRange        = 250
    VisionSide         = 50%
    VisionRear         = 25%
    VisionBonusPercentPerFoot = 1.0%
    ShroudClearingRange     = 450
    CommandPoints           = IMLADRIS_WACHTER_HORDE_COMMAND_POINTS

    FormationWidth         = 2
    FormationDepth         = 1
	MaxSimultaneousOfType  = 3

    CrushableLevel             = 2
    CrusherLevel               = 1
    MinCrushVelocityPercent = MINCRUSHVELOCITYPERCENT_STANDARD
    CrushDecelerationPercent = CRUSHDECELERATIONPERCENT_STANDARD
    CrushKnockback             = 40
    CrushZFactor               = 1.0

        TransportSlotCount            = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf                    = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT CAVALRY HORDE MELEE_HORDE ARMY_SUMMARY LARGE_RECTANGLE_PATHFIND
    CommandSet                = ElvenRivendellLancerHordeModCommandSet

    ThreatLevel = 125
    ThreatBreakdown ElvenRivendellLancerHorde_DetailedThreat
        AIKindOf = CAVALRY
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = CavalryHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle  = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate         = 500
        MaxCowerTime                = 5000
        MinCowerTime                = 3000
        AILuaEventsList             = CavalryFunctions
        AttackPriority              = AttackPriority_Cavalry
    End

    Behavior = HorseHordeContain ModuleTag_HordeContain
        FrontAngle                 = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay               = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload         = ElvenRivendellLancerMod  5
        Slots             = 5
        PassengerFilter     = NONE +CAVALRY +ElvenRivendellLancerBanner
        ShowPips        = No
        RandomOffset         = X:1 y:2
        MeleeBehavior         = Amoeba
        End

        ThisFormationIsTheMainFormation = Yes


        BannerCarriersAllowed    = ElvenRivendellLancerBanner
        BannerCarrierPosition    = UnitType:ElvenRivendellLancerMod    Pos:X:70.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:ElvenRivendellLancerMod Position:X:40 Y:0            Position:X:40 Y:20        Position:X:40 Y:-20        Position:X:40 Y:40        Position:X:40 Y:-40

        RanksToReleaseWhenAttacking = 1

        AlternateFormation = ElvenRivendellLancerHordeModWedgeFormation
        MeleeAttackLeashDistance     = 1
        BackUpMinDelayTime        = 1
        BackUpMaxDelayTime        = 3000
        BackUpMinDistance        = 1
        BackUpMaxDistance        = 3
        BackupPercentage        = 80%
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

    Behavior = HordeNotifyTargetsOfImminentProbableCrushingUpdate ModuleTag_NotifyCrushScan
        ScanWidth = 70.0
    End

    Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded        =    NONE
        AfraidOf            =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf            =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
        PointAt                =    EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance        =    150
        FearScanDistance        =    CAVALRY_FEAR_SCAN_RADIUS

        AddEmotion            =    Terror_Base
        AddEmotion            =    Doom_Base
        AddEmotion            =    BraceForBeingCrushed_Base
        AddEmotion            =    UncontrollableFear_Base
        AddEmotion            =    FearIdle_Base
        AddEmotion            =    FearBusy_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
        AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    HeroCheerIdle_Base
        AddEmotion            =    HeroCheerBusy_Base
        AddEmotion            =    Alert_Base
        AddEmotion            =    CheerForAboutToCrush_Base
     End

    LocomotorSet
        Locomotor     = NormalCavalryHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_MOUNTED_VERYFAST_HORDE_SPEED
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_VeterancyLeadership
        SpecialPowerTemplate     = SpecialAbilityFakeLeadership
        TriggeredBy         = Upgrade_ObjectLevel5
    End
    Behavior = SpecialPowerModule ModuleTag_VeterancyLeadershipUpdate
        SpecialPowerTemplate      = SpecialAbilityFakeLeadership
        UpdateModuleStartsAttack  = No
        StartsPaused           = Yes
    End
    Behavior = AttributeModifierAuraUpdate ModuleTag_Leadership
        StartsActive        = No
        BonusName        = ImladrisCavalryVeterancy
        TriggeredBy        = Upgrade_ObjectLevel5
        RefreshDelay        = 2000
        Range            = 200
        ObjectFilter        = GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTrainingImladis
        LevelsToGain = 1
        LevelCap = 2
    End

    Behavior = AttributeModifierUpgrade ModuleTag_Level2BonusCavalry
        TriggeredBy       = Upgrade_ObjectLevel2
        AttributeModifier = ImladrisCavalryRank2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality
        TriggeredBy = Upgrade_ForgedBlades
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_HeavyArmor
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality8
        TriggeredBy = Upgrade_Shields
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality3
        TriggeredBy = Upgrade_HerzdesFeuers
    End

    Behavior = AISpecialPowerUpdate RivendellLancerHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End

    Behavior = CommandSetUpgrade ModueTag_CommandSetEregions
        TriggeredBy            = Upgrade_ForgedBlades
        CommandSet             = ElvenRivendellLancerHordeModCommandSet_Eregions
    End

    Behavior = AttributeModifierAuraUpdate ModuleTag_BowAura
        StartsActive       = No
        BonusName          = ImladrisRiderBonus
        TriggeredBy        = Upgrade_BasicTrainingImladis
        RefreshDelay       = 2000
        Range              = 200
        AllowSelf          = Yes
        ObjectFilter       = ANY +CAVALRY +INFANTRY -STRUCTURE -HERO -BASE_FOUNDATION -DOZER
    End





    Behavior = AISpecialPowerUpdate ElvenMirkwoodArcherHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 40.0
    GeometryHeight = 20.0
    GeometryIsSmall = No




    AutoResolveUnitType = AutoResolveUnit_Cavalry
    AutoResolveCombatChain = AutoResolve_CavalryCombatChain

    AutoResolveBody = AutoResolve_ElvenRivendellLancerHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_ElvenRivendellLancerHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_ElvenRivendellLancerArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_ElvenRivendellLancerUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_ElvenRivendellLancerWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTrainingImladis Upgrade_ForgedBlades Upgrade_HeavyArmor Upgrade_Shields
End

ChildObject ElvenRivendellLancerHordeModWedgeFormation ElvenRivendellLancerHordeMod

    Behavior = HorseHordeContain ModuleTag_HordeContain
        AttributeModifiers = GondorKnightWedge
        ObjectStatusOfContained =
        InitialPayload = ElvenRivendellLancerMod 5
        Slots = 5
        PassengerFilter = NONE +CAVALRY +ElvenRivendellLancerBanner
        ShowPips = No
        ThisFormationIsTheMainFormation = No
        RandomOffset = X:8 y:3
        MeleeBehavior = Amoeba
        End


        BannerCarriersAllowed    = ElvenRivendellLancerBanner
        BannerCarrierPosition    = UnitType:ElvenRivendellLancerMod    Pos:X:30.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:ElvenRivendellLancerMod Position:X:0 Y:0        Position:X:-20 Y:20       Position:X:-20 Y:-20      Position:X:-40 Y:40       Position:X:-40 Y:-40

        RanksToReleaseWhenAttacking = 1
        AlternateFormation = ElvenRivendellLancerHordeMod

        MeleeAttackLeashDistance = 1
        BackUpMinDelayTime       = 1
        BackUpMaxDelayTime       = 3000
        BackUpMinDistance        = 1
        BackUpMaxDistance        = 3
        BackupPercentage         = 80%
    End
End


Object ElvenKnightHorde



    SelectPortrait    = UPImlaReiter
    ButtonImage       = HIImlaReiter_Wotr

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR EMOTION_LOOK_TO_SKY
        DefaultModelConditionState
            Model = None
        End
        ModelConditionState = HORDE_EMPTY
            Model = None
        End
        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkGUKni
        End
    End

    Side = Imladris
    EditorSorting = UNIT
    EmotionRange = 240
    DisplayName = OBJECT:HordeElvenKnight
    DisplayNameStrategic = CONTROLBAR:LW_Unit_ElvenKnightHorde
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_ElvenKnightHorde
    MaxSimultaneousOfType    = 3

    WeaponSet
        Conditions = None
        Weapon = PRIMARY    NormalMeleeHordeRangefinder
    End

    CommandSet = ImladrisAmrothreiterHordeCommandSet





    #include "..\..\..\includes\StandardHordeEvaEvents.inc"

    BuildCost             = 1500
    BuildTime             = ELITE_BUILDTIME
    VisionRange             = 250
    VisionSide             = 35%
    VisionRear             = 25%
    MaxVisionBonusPercent        = 300%
    VisionBonusTestRadius        = 200
    VisionBonusPercentPerFoot     = 5.0%
    ShroudClearingRange         = 400

    CommandPoints = 70

    FormationWidth = 2
    FormationDepth = 1

    CrushableLevel = 2
    CrusherLevel = 1
    MinCrushVelocityPercent = MINCRUSHVELOCITYPERCENT_STANDARD
    CrushDecelerationPercent = CRUSHDECELERATIONPERCENT_STANDARD
    CrushKnockback = 40
    CrushZFactor = 1.0


    TransportSlotCount = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT CAVALRY HORDE MELEE_HORDE ARMY_SUMMARY LARGE_RECTANGLE_PATHFIND

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    ThreatLevel = 175
    ThreatBreakdown GondorKnightHorde_DetailedThreat
        AIKindOf = CAVALRY
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = CavalryHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle    = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate            = 500
        MaxCowerTime                = 5000
        MinCowerTime                = 3000
        AILuaEventsList                = CavalryFunctions
        AttackPriority                = AttackPriority_Cavalry
    End

    Behavior = HorseHordeContain ModuleTag_HordeContain
        FrontAngle                 = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay               = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload = ElvenKnight   5
        Slots = 5
        PassengerFilter = NONE +CAVALRY
        ShowPips = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset=X:0 Y:0
        MeleeBehavior = Amoeba
        End





        RankInfo = RankNumber:1 UnitType:ElvenKnight Position:X:40 Y:0        Position:X:40 Y:15        Position:X:40 Y:-15        Position:X:40 Y:30        Position:X:40 Y:-30

        RanksToReleaseWhenAttacking = 1
        AlternateFormation = ElvenKnightHordeWedgeFormation
        MeleeAttackLeashDistance = 1
        BackUpMinDelayTime         = 1
        BackUpMaxDelayTime         = 3000
        BackUpMinDistance         = 1
        BackUpMaxDistance         = 3
        BackupPercentage         = 80%
    End




    Behavior = HordeNotifyTargetsOfImminentProbableCrushingUpdate ModuleTag_NotifyCrushScan
        ScanWidth = 70.0
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

    Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
         TauntAndPointUpdateDelay    =    1000
         TauntAndPointExcluded        =    NONE
         AfraidOf                    =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf                =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
         PointAt                        =    EMOTION_POINTAT_OBJECTFILTER
         HeroScanDistance            =    150
         FearScanDistance            =    INFANTRY_FEAR_SCAN_RADIUS

        AddEmotion            =    Terror_Base
        AddEmotion            =    Doom_Base
        AddEmotion            =    BraceForBeingCrushed_Base
        AddEmotion            =    UncontrollableFear_Base
        AddEmotion            =    FearIdle_Base
        AddEmotion            =    FearBusy_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
        AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    HeroCheerIdle_Base
        AddEmotion            =    HeroCheerBusy_Base
        AddEmotion            =    Alert_Base
        AddEmotion            =   CheerForAboutToCrush_Base
     End

    LocomotorSet
        Locomotor     = NormalCavalryHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_MOUNTED_VERYFAST_HORDE_SPEED
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_TheodenGloriousChargeUpdate
        SpecialPowerTemplate        = SpecialAbilityTheodenGloriousCharge
        UpdateModuleStartsAttack    = Yes
        StartsPaused             = No
        AttributeModifier         = ElvenKnightsAnsturm

        AttributeModifierAffectsSelf     = Yes

        AttributeModifierFX         = FX_TheodenGloriousChargeFX
        InitiateSound            = KnightsDolAmrothGloriousCharge
    End

    Behavior = SpecialAbilityUpdate ModuleTag_GloriousChargeAnimation
        UnpackTime                  = 1000
        UnpackingVariation        = 1
        SpecialPowerTemplate    = SpecialAbilityTheodenGloriousCharge
        PreparationTime         = 0
        PersistentPrepTime      = 0
        PackTime                = 1330
     End


    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTrainingImladis
        LevelsToGain = 1
        LevelCap = 2
    End

    Behavior = AttributeModifierUpgrade ModuleTag_Level2BonusCavalry
        TriggeredBy       = Upgrade_ObjectLevel2
        AttributeModifier = ImladrisCavalryRank2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality
        TriggeredBy = Upgrade_ForgedBlades
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_HeavyArmor
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality3
        TriggeredBy = Upgrade_Shields
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality4
        TriggeredBy = Upgrade_HerzdesFeuers
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality5
        TriggeredBy = Upgrade_ImladrisGelehrtenWeisheit
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI3
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 70000
        GrantUpgrade = Upgrade_ImladrisGelehrtenWeisheit
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End





    Behavior = AISpecialPowerUpdate GondorKnightHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate NoldorWeaponSongAI
        CommandButtonName  = Command_ElvenKnightAnsturm
        SpecialPowerAIType = AI_SPECIAL_POWER_BASIC_SELF_BUFF
    End

    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 40.0
    GeometryHeight = 20.0
    GeometryIsSmall = No

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_VeterancyLeadership
        SpecialPowerTemplate     = SpecialAbilityFakeLeadership
        TriggeredBy         = Upgrade_ObjectLevel5
    End
    Behavior = SpecialPowerModule ModuleTag_VeterancyLeadershipUpdate
        SpecialPowerTemplate      = SpecialAbilityFakeLeadership
        UpdateModuleStartsAttack  = No
        StartsPaused           = Yes
    End
    Behavior = AttributeModifierAuraUpdate ModuleTag_Leadership
        StartsActive        = No
        BonusName        = ImladrisWindriderVeterancy
        TriggeredBy        = Upgrade_ObjectLevel5
        RefreshDelay        = 2000
        Range            = 200
        ObjectFilter        = GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
    End


    Behavior = AutoHealBehavior ModuleTag_HearthHeal
        StartsActive               = Yes
        HealOnlyIfNotInCombat      = Yes
        HealOnlyIfNotUnderAttack   = Yes
        HealingAmount              = 30
        Radius                     = 100
        StartHealingDelay          = 7500
        HealingDelay               = 5000
        UnitHealPulseFX            = FX_SpellHealUnitHealBuff
        NonStackable               = Yes
        RespawnNearbyHordeMembers  = Yes
        RespawnFXList              = FX_BannerCarrierSpawnUnit
        RespawnMinimumDelay        = 200
    End



    AutoResolveUnitType = AutoResolveUnit_Cavalry
    AutoResolveCombatChain = AutoResolve_CavalryCombatChain

    AutoResolveBody = AutoResolve_GondorKnightHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_GondorKnightHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_GondorKnightArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_GondorKnightUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_GondorKnightWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_ImladrisGelehrtenWeisheit
End

ChildObject ElvenKnightHorde_forFornost ElvenKnightHorde

    CommandSet = ImladrisAmrothreiterHordeCommandSet_forFornost

    Behavior = HorseHordeContain ModuleTag_HordeContain
        FrontAngle                 = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay               = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload = ElvenKnight_forFornost  5
        Slots = 5
        PassengerFilter = NONE +CAVALRY
        ShowPips = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset=X:0 Y:0
        MeleeBehavior = Amoeba
        End

        RankInfo = RankNumber:1 UnitType:ElvenKnight_forFornost Position:X:40 Y:0        Position:X:40 Y:15        Position:X:40 Y:-15        Position:X:40 Y:30        Position:X:40 Y:-30

        RanksToReleaseWhenAttacking = 1
        AlternateFormation = ElvenKnightHordeWedgeFormation_forFornost
        MeleeAttackLeashDistance = 1
        BackUpMinDelayTime         = 1
        BackUpMaxDelayTime         = 3000
        BackUpMinDistance         = 1
        BackUpMaxDistance         = 3
        BackupPercentage         = 80%
    End

End

ChildObject ElvenKnightHordeWedgeFormation ElvenKnightHorde

    Behavior = HorseHordeContain ModuleTag_HordeContain
        AttributeModifiers = EliteKnightWedge
        ObjectStatusOfContained =
        InitialPayload = ElvenKnight 5
        Slots = 5
        PassengerFilter = NONE +CAVALRY
        ShowPips = No
        ThisFormationIsTheMainFormation = No
        RandomOffset = X:8 y:3
        MeleeBehavior = Amoeba
        End





        RankInfo = RankNumber:1 UnitType:ElvenKnight   Position:X:0 Y:0        Position:X:-20 Y:20       Position:X:-20 Y:-20      Position:X:-40 Y:40       Position:X:-40 Y:-40

        RanksToReleaseWhenAttacking = 1
        AlternateFormation = ElvenKnightHorde

        MeleeAttackLeashDistance = 1
        BackUpMinDelayTime       = 1
        BackUpMaxDelayTime       = 3000
        BackUpMinDistance        = 1
        BackUpMaxDistance        = 3
        BackupPercentage         = 80%
    End
End

ChildObject ElvenKnightHordeWedgeFormation_forFornost ElvenKnightHorde_forFornost

    Behavior = HorseHordeContain ModuleTag_HordeContain
        AttributeModifiers = GondorKnightWedge
        ObjectStatusOfContained =
        InitialPayload = ElvenKnight_forFornost 5
        Slots = 5
        PassengerFilter = NONE +CAVALRY
        ShowPips = No
        ThisFormationIsTheMainFormation = No
        RandomOffset = X:8 y:3
        MeleeBehavior = Amoeba
        End

        RankInfo = RankNumber:1 UnitType:ElvenKnight_forFornost   Position:X:0 Y:0        Position:X:-20 Y:20       Position:X:-20 Y:-20      Position:X:-40 Y:40       Position:X:-40 Y:-40

        RanksToReleaseWhenAttacking = 1
        AlternateFormation = ElvenKnightHorde_forFornost

        MeleeAttackLeashDistance = 1
        BackUpMinDelayTime       = 1
        BackUpMaxDelayTime       = 3000
        BackUpMinDistance        = 1
        BackUpMaxDistance        = 3
        BackupPercentage         = 80%
    End
End


Object BruchtalSchwertmeisterHorde

    ButtonImage            = HICelebrimbor
    SelectPortrait         = HPCelebrimbor

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR
        DefaultModelConditionState
            Model = None
        End
        ModelConditionState = HORDE_EMPTY
            Model = None
        End
        ModelConditionState = WORLD_BUILDER
            Model = HordeTemp_5By2
        End
    End

    Side = Imladris
    EditorSorting = UNIT
    EmotionRange = 240
    DisplayName = OBJECT:HordeBruchtalwachter
    DisplayNameStrategic = CONTROLBAR:LW_Unit_BruchtalwachterHorde
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_BruchtalwachterHorde

    WeaponSet
        Conditions            = None
        Weapon                = PRIMARY      NormalMeleeHordeRangefinder
        Weapon                = SECONDARY    NormalMeleeHordeRangefinder
        AutoChooseSources     = SECONDARY NONE
        ShareWeaponReloadTime = Yes
    End


    CommandSet = BruchtalSchwertmeisterHordeNewCommandSet



    CrushableLevel = 0
    CrusherLevel = 0

    BuildCost = 800
    BuildTime = MEDIUM_BUILDTIME
    VisionRange = 200
    ShroudClearingRange = 350
    CommandPoints = 60
    MaxSimultaneousOfType = 4
    FormationWidth = 2
    FormationDepth = 1

    TransportSlotCount = 1
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE MELEE_HORDE NOTIFY_OF_PREATTACK ARMY_SUMMARY LARGE_RECTANGLE_PATHFIND

    ThreatLevel = 150
    ThreatBreakdown GondorFighterHorde_DetailedThreat
        AIKindOf = INFANTRY
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End



    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = FighterHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle    = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate            = 500
        MaxCowerTime                = 5000
        MinCowerTime                = 3000
        AILuaEventsList                = InfantryFunctions
        AttackPriority                = AttackPriority_Infantry
    End

    Behavior = HordeContain ModuleTag_HordeContain
        ObjectStatusOfContained =
        InitialPayload = BruchtalSchwertmeister 4
        Slots = 4
        PassengerFilter = NONE +INFANTRY
        ShowPips = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset = X:1 Y:1

        RankInfo = RankNumber:1 UnitType:BruchtalSchwertmeister Position:X:50 Y:15            Position:X:50 Y:-15        Position:X:50 Y:30         Position:X:50 Y:0

        RanksToReleaseWhenAttacking = 1
    End

    Behavior = StealthUpdate StealthUpdateModuleTag
        StealthDelay                        = 500
        FriendlyOpacityMin                    = STEALTH_FRIENDLY_OPACITY_MIN
        FriendlyOpacityMax                    = STEALTH_FRIENDLY_OPACITY_MAX
        PulseFrequency                        = 750
        StealthForbiddenConditions            = AWAY_FROM_TREES ATTACKING
        OrderIdleEnemiesToAttackMeUponReveal= Yes
        DetectedByAnyoneRange                = 120
        RevealWeaponSets                    = CLOSE_RANGE CONTESTING_BUILDING
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End


    #include "..\..\..\includes\CaptureBuilding.inc"

     Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded        =    NONE
        AfraidOf                    =    NONE +GondorGwaihir +RohanTreeBerd +RohanEntFir +RohanEntAsh +RohanEntBirch +MordorMountainTroll +MordorDrummerTroll +MordorFellBeast +MordorWitchKingOnFellBeast +MordorMumakil
        AlwaysAfraidOf                =    NONE +MordorBalrog +RohanOathbreaker +MordorSauron
         PointAt                =    NONE +MordorFellBeast +MordorWitchKingOnFellBeast +GondorGwaihir
        HeroScanDistance        =    150
        FearScanDistance        =    INFANTRY_FEAR_SCAN_RADIUS



        AddEmotion    =    Terror_Base
        AddEmotion    =    Doom_Base
        AddEmotion    =    BraceForBeingCrushed_Base
        AddEmotion    =    UncontrollableFear_Base
        AddEmotion    =    FearIdle_Base
        AddEmotion    =    FearBusy_Base
        AddEmotion    =    Point_Base
        AddEmotion    =    Taunt_Base
        AddEmotion    =    CheerIdle_Base
        AddEmotion    =    CheerBusy_Base
        AddEmotion    =    HeroCheerIdle_Base
        AddEmotion    =    HeroCheerBusy_Base
        AddEmotion    =    Alert_Base
    End


    LocomotorSet
        Locomotor     = NormalMeleeHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_FOOT_IMLADRIS_HORDE_SPEED
    End


    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTrainingImladis
        LevelsToGain = 1
        LevelCap = 2
    End

    Behavior = AttributeModifierUpgrade ModuleTag_Level2BonusFighter
        TriggeredBy       = Upgrade_ObjectLevel2
        AttributeModifier = ImladrisFighterRank2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality
        TriggeredBy = Upgrade_ForgedBlades
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_HeavyArmor
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality3
        TriggeredBy = Upgrade_HerzdesFeuers
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality4
        TriggeredBy = Upgrade_ImladrisGelehrtenWeisheit
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI3
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 70000
        GrantUpgrade = Upgrade_ImladrisGelehrtenWeisheit
    End

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_ChargeUnpause
        SpecialPowerTemplate        = SpecialAbilityDwarvenCharge
        TriggeredBy                 = Upgrade_MiniHordeLvl2
    End

    Behavior = SpecialPowerModule ModuleTag_ChargeStarter
        SpecialPowerTemplate        = SpecialAbilityDwarvenCharge
        UpdateModuleStartsAttack    = Yes
        StartsPaused                = Yes
        InitiateSound               = DwarfGuardianBullRushMS
    End

    Behavior = SpecialAbilityUpdate ModuleTag_ChargeUpdate
        SpecialPowerTemplate        = SpecialAbilityDwarvenCharge
        StartAbilityRange           = 150.0
        AbilityAbortRange           = 50.0
        PreparationTime             = 0
        PackTime                    = 3000
        TriggerSound                = DwarfBullRushMS
        TriggerAttributeModifier    = SchwertmeisterChargeBonus
        AttributeModifierDuration   = 10000
        ChargeAttackSpeedBoost      = Yes
        IgnoreFacingCheck           = Yes
    End

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_Enabler
        SpecialPowerTemplate = SpecialAbilityBlitzendeKlingen
        TriggeredBy          = Upgrade_AllFactionUpgrade
    End

    Behavior = WeaponModeSpecialPowerUpdate ModuleTag_PowerUpdate
        SpecialPowerTemplate = SpecialAbilityBlitzendeKlingen
        Duration             = 20000
        AttributeModifier    = BlitzendeKlingenBonus
        LockWeaponSlot       = SECONDARY
        StartsPaused         = No
    End

    Behavior = AutoAbilityBehavior ModuleTag_PowerAutoAbility

	SpecialAbility		= SpecialAbilityBlitzendeKlingen
	ForbiddenStatus 	= INSIDE_GARRISON

	MaxScanRange		= 150
	Query			= 15 ALL ENEMIES
	Query			= 1 ANY ENEMIES +HERO +MONSTER

   End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End

    Behavior = AutoHealBehavior ModuleTag_HearthHeal
        StartsActive               = Yes
        HealOnlyIfNotInCombat      = Yes
        HealOnlyIfNotUnderAttack   = Yes
        HealingAmount              = 30
        Radius                     = 100
        StartHealingDelay          = 7500
        HealingDelay               = 5000
        UnitHealPulseFX            = FX_SpellHealUnitHealBuff
        NonStackable               = Yes
        RespawnNearbyHordeMembers  = Yes
        RespawnFXList              = FX_BannerCarrierSpawnUnit
        RespawnMinimumDelay        = 200
    End


    Behavior = AISpecialPowerUpdate BlitzendeKlingen
        CommandButtonName = Command_SpecialAbilityBlitzendeKlingen
        SpecialPowerAIType = AI_SPECIAL_POWER_CHARGE
    End

    Behavior = AISpecialPowerUpdate GondorKnightHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Geometry = BOX
    GeometryMajorRadius = 20.0
    GeometryMinorRadius = 20.0
    GeometryHeight = 20.0
    GeometryIsSmall = No



    AutoResolveUnitType = AutoResolveUnit_Soldier
    AutoResolveCombatChain = AutoResolve_SoldierCombatChain

    AutoResolveBody = AutoResolve_ElvenLorienWarriorHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_ElvenLorienWarriorHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_ElvenLorienWarriorArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_ElvenLorienWarriorUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_ElvenLorienWarriorWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_ImladrisGelehrtenWeisheit
End


Object LindonWachterHorde

    SelectPortrait     = UPLindonWachter
    ButtonImage        = HILindonWachter_Wotr

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR
        DefaultModelConditionState
            Model = None
        End
        ModelConditionState = HORDE_EMPTY
            Model = None
        End
        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkEULoW
        End
    End

    Side = Imladris
    EditorSorting = UNIT
    EmotionRange = 240
    DisplayName = OBJECT:LindonWachterHorde
    DisplayNameStrategic = CONTROLBAR:LW_Unit_LindonWachterHorde
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_LindonWachterHorde

    WeaponSet
        Conditions = None
        Weapon = PRIMARY    GaladhrimArcherMissileHordeRangefinder
        Weapon = TERTIARY   LorienGaladhrimMissileHordeRangefinderEdainStandardBombard
        AutoChooseSources = TERTIARY FROM_PLAYER FROM_SCRIPT
    End

    WeaponSet
        Conditions = WEAPONSET_TOGGLE_1
        Weapon = PRIMARY    NormalMeleeHordeRangefinder
    End

    CommandSet = LindonWachterHordeCommandSet




    #include "..\..\..\includes\StandardHordeEvaEvents.inc"

    CrushableLevel = 0
    CrusherLevel = 0

    BuildCost = 700
    BuildTime = STRONG_BUILDTIME
    VisionRange = 440
    VisionSide = 50%
    VisionRear = 25%
    VisionBonusPercentPerFoot = 1.0%
    ShroudClearingRange = 440
    CommandPoints = 70

    MaxSimultaneousOfType             = 3

    FormationWidth = 2
    FormationDepth = 1

    TransportSlotCount = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE ARMY_SUMMARY MELEE_HORDE LARGE_RECTANGLE_PATHFIND
    CamouflageDetectionMultiplier     = CAMOUFLAGE_DETECTION_DISTANCE_LONG
    ThreatLevel = 120
    ThreatBreakdown ElvenLorienWarriorHorde_DetailedThreat
        AIKindOf = INFANTRY
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = FighterHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle = Yes ATTACK_BUILDINGS STEALTHED
        MoodAttackCheckRate        = 500
        MaxCowerTime               = 5000
        MinCowerTime               = 3000
        CanAttackWhileContained    = Yes
        AILuaEventsList            = InfantryFunctions
        AttackPriority             = AttackPriority_Archer
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle                 = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay               = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload = LindonWachter 10
        Slots = 10
        PassengerFilter    = NONE +INFANTRY
        ShowPips = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset=X:0 Y:0
        MeleeBehavior = Amoeba
        End

        BannerCarriersAllowed    = LindonBanner
        BannerCarrierPosition    = UnitType:LindonWachter    Pos:X:70.0 Y:0.0


        RankInfo = RankNumber:1 UnitType:LindonWachter Position:X:50 Y:0        Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:50 Y:40        Position:X:50 Y:-40
        RankInfo = RankNumber:2 UnitType:LindonWachter Position:X:30 Y:0 Leader 1 0    Position:X:30 Y:20 Leader 1 1    Position:X:30 Y:-20 Leader 1 2    Position:X:30 Y:40 Leader 1 3    Position:X:30 Y:-40 Leader 1 4

        RanksToReleaseWhenAttacking = 1  2

        MeleeAttackLeashDistance = 1
        BackUpMinDelayTime        = 1
        BackUpMaxDelayTime        = 3000
        BackUpMinDistance        = 1
        BackUpMaxDistance        = 3
        BackupPercentage        = 80%
    End


    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

     Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded        =    NONE
        AfraidOf                    =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf                =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
         PointAt                        =    EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance        =    150
        FearScanDistance        =    ARCHER_FEAR_SCAN_RADIUS


        AddEmotion    =    Terror_Base
        AddEmotion    =    Doom_Base
        AddEmotion    =   BraceForBeingCrushed_Base
        AddEmotion    =    UncontrollableFear_Base
        AddEmotion    =    FearIdle_Base
        AddEmotion    =    FearBusy_Base
        AddEmotion    =    Point_Base
        AddEmotion    =    Taunt_Base
        AddEmotion    =    CheerIdle_Base
        AddEmotion    =    CheerBusy_Base
        AddEmotion    =    HeroCheerIdle_Base
        AddEmotion    =    HeroCheerBusy_Base
        AddEmotion    =    Alert_Base
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End

    LocomotorSet
        Locomotor     = NormalMeleeHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_FOOT_FAST_HORDE_SPEED
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTrainingImladis
        LevelsToGain = 1
        LevelCap = 2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality
        TriggeredBy = Upgrade_ForgedBlades
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_SilverThornArrows
    End






    Behavior = WeaponChangeSpecialPowerModule THING
        SpecialPowerTemplate      = SpecialAbilityBerserkerLightTorch
        FlagsUsedForToggle        = WEAPONSET_TOGGLE_1
        ToggleOnAttributeModifier = WeaponSwitchUnitModifier
    End







    Behavior = AISpecialPowerUpdate ElvenLorienWarriorHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 45.0
    GeometryHeight = 20.0
    GeometryIsSmall = No



    AutoResolveUnitType = AutoResolveUnit_Archer
    AutoResolveCombatChain = AutoResolve_ArcherCombatChain

    AutoResolveBody = AutoResolve_DwarvenGuardianHordeBody

    AutoResolveArmor
        Armor = AutoResolve_GondorWachterderVesteHeavyArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_GondorWachterderVesteUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_GondorWachterderVesteWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTrainingImladis Upgrade_ForgedBlades Upgrade_SilverThornArrows Upgrade_BasicTraining
End


Object LindonWachterHorde_forFornost


    SelectPortrait     = UPLindonWachter
    ButtonImage        = HSLindonWachter


    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR
        DefaultModelConditionState
            Model = None
        End
        ModelConditionState = HORDE_EMPTY
            Model = None
        End
        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkEULoW
        End
    End

    Side = Imladris
    EditorSorting = UNIT
    EmotionRange = 240
    DisplayName = OBJECT:LindonWachterHorde
    DisplayNameStrategic = CONTROLBAR:LW_Unit_LindonWachterHorde
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_LothlorienGaladhrimHorde

    WeaponSet
        Conditions = None
        Weapon = PRIMARY    GaladhrimArcherMissileHordeRangefinder
        Weapon = TERTIARY   LorienGaladhrimMissileHordeRangefinderEdainStandardBombard
        AutoChooseSources = TERTIARY FROM_PLAYER FROM_SCRIPT
    End

    WeaponSet
        Conditions = WEAPONSET_TOGGLE_1
        Weapon = PRIMARY    NormalMeleeHordeRangefinder
    End

    CommandSet = LindonWachterHordeCommandSet_forFornost




    #include "..\..\..\includes\StandardHordeEvaEvents.inc"


     CrushableLevel = 0
    CrusherLevel = 0

    BuildCost = 800
    BuildTime = MEDIUM_BUILDTIME
    VisionRange = 440
    VisionSide = 50%
    VisionRear = 25%
    VisionBonusPercentPerFoot = 1.0%
    ShroudClearingRange = 440
    CommandPoints = 65

    MaxSimultaneousOfType = 4

    FormationWidth = 2
    FormationDepth = 1

    TransportSlotCount = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE ARMY_SUMMARY MELEE_HORDE LARGE_RECTANGLE_PATHFIND
    CamouflageDetectionMultiplier     = CAMOUFLAGE_DETECTION_DISTANCE_LONG
    ThreatLevel = ELVEN_LORIENWARRIOR_HORDE_THREAT
    ThreatBreakdown ElvenLorienWarriorHorde_DetailedThreat
        AIKindOf = INFANTRY
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = FighterHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle = Yes ATTACK_BUILDINGS STEALTHED
        MoodAttackCheckRate        = 500
        MaxCowerTime               = 5000
        MinCowerTime               = 3000
        CanAttackWhileContained    = Yes
        AILuaEventsList            = InfantryFunctions
        AttackPriority             = AttackPriority_Archer
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle                 = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay               = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload = LindonWachter_forFornost 10
        Slots = 10
        PassengerFilter    = NONE +INFANTRY
        ShowPips = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset=X:0 Y:0
        MeleeBehavior = Amoeba
        End

        BannerCarriersAllowed    = LindonBanner
        BannerCarrierPosition    = UnitType:LindonWachter_forFornost    Pos:X:70.0 Y:0.0


        RankInfo = RankNumber:1 UnitType:LindonWachter_forFornost Position:X:50 Y:0        Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:50 Y:40        Position:X:50 Y:-40
        RankInfo = RankNumber:2 UnitType:LindonWachter_forFornost Position:X:30 Y:0 Leader 1 0    Position:X:30 Y:20 Leader 1 1    Position:X:30 Y:-20 Leader 1 2    Position:X:30 Y:40 Leader 1 3    Position:X:30 Y:-40 Leader 1 4

        RanksToReleaseWhenAttacking = 1  2

        MeleeAttackLeashDistance = 1
        BackUpMinDelayTime        = 1
        BackUpMaxDelayTime        = 3000
        BackUpMinDistance        = 1
        BackUpMaxDistance        = 3
        BackupPercentage        = 80%
    End


    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End




     Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded        =    NONE
        AfraidOf                    =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf                =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
         PointAt                        =    EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance        =    150
        FearScanDistance        =    ARCHER_FEAR_SCAN_RADIUS


        AddEmotion    =    Terror_Base
        AddEmotion    =    Doom_Base
        AddEmotion    =   BraceForBeingCrushed_Base
        AddEmotion    =    UncontrollableFear_Base
        AddEmotion    =    FearIdle_Base
        AddEmotion    =    FearBusy_Base
        AddEmotion    =    Point_Base
        AddEmotion    =    Taunt_Base
        AddEmotion    =    CheerIdle_Base
        AddEmotion    =    CheerBusy_Base
        AddEmotion    =    HeroCheerIdle_Base
        AddEmotion    =    HeroCheerBusy_Base
        AddEmotion    =    Alert_Base
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End

    LocomotorSet
        Locomotor     = NormalMeleeHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_FOOT_FAST_HORDE_SPEED
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTraining
        LevelsToGain = 1
        LevelCap = 2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality
        TriggeredBy = Upgrade_ForgedBlades
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_LindonArrowsEregions
    End







    Behavior = AISpecialPowerUpdate ElvenLorienWarriorHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 45.0
    GeometryHeight = 20.0
    GeometryIsSmall = No



    AutoResolveUnitType = AutoResolveUnit_Archer
    AutoResolveCombatChain = AutoResolve_ArcherCombatChain

    AutoResolveBody = AutoResolve_DwarvenGuardianHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_GondorWachterderVesteHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_GondorWachterderVesteArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_GondorWachterderVesteUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_GondorWachterderVesteWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_LindonArrowsEregions Upgrade_ForgedBlades Upgrade_BasicTraining
End

Object BruchtalwachterHorde


    ButtonImage            = HSImladrisWachter
    SelectPortrait         = UPImladrisWachter


    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR
        DefaultModelConditionState
            Model = None
        End
        ModelConditionState = HORDE_EMPTY
            Model = None
        End
        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkEULoW
        End
    End

    Side = Imladris
    EditorSorting = UNIT
    EmotionRange = 240
    DisplayName = OBJECT:HordeBruchtalwachter
    DisplayNameStrategic = CONTROLBAR:LW_Unit_imladriswachterHorde
    DescriptionStrategic = CONTROLBAR:LW_ToolTipBuild_imladriswachterHorde

    WeaponSet
        Conditions     = None
        Weapon         = PRIMARY    NormalMeleeHordeRangefinder
    End

    CommandSet = BruchtalSchwertmeisterHordeNewCommandSet




    #include "..\..\..\includes\StandardHordeEvaEvents.inc"


     CrushableLevel = 0
    CrusherLevel = 0

    BuildCost = 600
    BuildTime = MEDIUM_BUILDTIME
    VisionRange = ELVEN_MITHLONDSENTRY_HORDE_VISION_RANGE
    VisionSide = 50%
    VisionRear = 25%
    VisionBonusPercentPerFoot = 1.0%
    ShroudClearingRange = ELVEN_MITHLONDSENTRY_SHROUD_RANGE
    CommandPoints = IMLADRIS_WACHTER_HORDE_COMMAND_POINTS

    FormationWidth = 2
    FormationDepth = 1

    TransportSlotCount = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf             = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE ARMY_SUMMARY MELEE_HORDE LARGE_RECTANGLE_PATHFIND

    ThreatLevel         = ELVEN_LORIENWARRIOR_HORDE_THREAT
    ThreatBreakdown ElvenLorienWarriorHorde_DetailedThreat
        AIKindOf     = INFANTRY
    End

    Body             = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth     = 1
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = FighterHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle     = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate            = 500
        MaxCowerTime            = 5000
        MinCowerTime            = 3000
        AILuaEventsList            = InfantryFunctions
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle         = STANDARD_PIKEMAN_FRONTANGLE
        FlankedDelay         = STANDARD_PIKEMAN_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload = Bruchtalwachter 10
        Slots = 10
        PassengerFilter = NONE +INFANTRY +BANNER
        ShowPips = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset = X:0 Y:0
        MeleeBehavior = Amoeba
        End





        RankInfo = RankNumber:1 UnitType:Bruchtalwachter Position:X:50 Y:0        Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:50 Y:40        Position:X:50 Y:-40
        RankInfo = RankNumber:2 UnitType:Bruchtalwachter Position:X:30 Y:0 Leader 1 0    Position:X:30 Y:20 Leader 1 1    Position:X:30 Y:-20 Leader 1 2    Position:X:30 Y:40 Leader 1 3    Position:X:30 Y:-40 Leader 1 4


        RanksToReleaseWhenAttacking = 1 2

        MeleeAttackLeashDistance = 1
        BackUpMinDelayTime         = 1
        BackUpMaxDelayTime         = 3000
        BackUpMinDistance         = 1
        BackUpMaxDistance         = 3
        BackupPercentage         = 80%


    End

    #include "..\..\..\includes\DefaultInvisibilityUpdate.inc"

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

     Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded        =    NONE
        AfraidOf                    =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf                =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
         PointAt                        =    EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance            =    150
        FearScanDistance            =    INFANTRY_FEAR_SCAN_RADIUS



        AddEmotion    =    Terror_Base
        AddEmotion    =    Doom_Base

        AddEmotion    =    UncontrollableFear_Base
        AddEmotion    =    FearIdle_Base
        AddEmotion    =    FearBusy_Base
        AddEmotion    =    Point_Base
        AddEmotion    =    Taunt_Base
        AddEmotion    =    CheerIdle_Base
        AddEmotion    =    CheerBusy_Base
        AddEmotion    =    HeroCheerIdle_Base
        AddEmotion    =    HeroCheerBusy_Base
        AddEmotion    =    Alert_Base
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End

    LocomotorSet
        Locomotor     = NormalMeleeHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_GOOD_FAST_HORDE_SPEED
    End


    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTrainingImladis
        LevelsToGain = 1
        LevelCap = 2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality
        TriggeredBy = Upgrade_ForgedBlades
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_HeavyArmor
    End

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_ChargeUnpause
        SpecialPowerTemplate        = SpecialAbilityDwarvenCharge
        TriggeredBy                 = Upgrade_MiniHordeLvl2
    End

    Behavior = SpecialPowerModule ModuleTag_ChargeStarter
        SpecialPowerTemplate        = SpecialAbilityDwarvenCharge
        UpdateModuleStartsAttack    = Yes
        InitiateSound               = DwarfGuardianBullRushMS
    End

    Behavior = SpecialAbilityUpdate ModuleTag_ChargeUpdate
        SpecialPowerTemplate        = SpecialAbilityDwarvenCharge
        StartAbilityRange           = 150.0
        AbilityAbortRange           = 50.0
        PreparationTime             = 0
        PackTime                    = 3000
        TriggerSound                = DwarfBullRushMS
        TriggerAttributeModifier    = SchwertmeisterChargeBonus
        AttributeModifierDuration   = 10000
        ChargeAttackSpeedBoost      = Yes
        IgnoreFacingCheck           = Yes
    End








    Behavior = AISpecialPowerUpdate ElvenMithlondSentryHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 45.0
    GeometryHeight = 20.0
    GeometryIsSmall = No



    AutoResolveUnitType = AutoResolveUnit_Pikemen
    AutoResolveCombatChain = AutoResolve_PikemenCombatChain

    AutoResolveBody = AutoResolve_ElvenMithlondSentryHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_ElvenMithlondSentryHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_ElvenMithlondSentryArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_ElvenMithlondSentryUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_ElvenMithlondSentryWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTrainingImladis Upgrade_ForgedBlades Upgrade_HeavyArmor
End

ChildObject BruchtalwachterHordePorcupine BruchtalwachterHorde

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle         = STANDARD_PIKEMAN_FRONTANGLE_FORMATION
        FlankedDelay         = STANDARD_PIKEMAN_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload                    = Bruchtalwachter 10
        Slots                            = 10
        PassengerFilter                    = NONE +INFANTRY +BANNER
        ShowPips                        = No
        ThisFormationIsTheMainFormation = No
        RandomOffset                    = X:2 Y:1
        RanksToReleaseWhenAttacking        = 0
        RanksToJustFreeWhenAttacking   = 0
        AttributeModifiers                = ElvenMithlondSentryHordePorcupine
        IsPorcupineFormation            = Yes
        MinimumHordeSize                = 5

        AlternateFormation                = BruchtalwachterHorde
        VisionRearOverride                = 100%
        VisionSideOverride                = 100%
        NotComboFormation                = Yes


        BannerCarriersAllowed    = ImladrisSwordmasterBanner
        BannerCarrierPosition    = UnitType:Bruchtalwachter    Pos:X:0.0 Y:0.0

        RankInfo    = RankNumber:1 UnitType:Bruchtalwachter Position:X:20 Y:0    Position:X:-16.18 Y:11.76        Position:X:6.18 Y:-19.02    Position:X:6.18 Y:19.02    Position:X:-16.18 Y:-11.76    Position:X:36.54 Y:16.27    Position:X:-39.13 Y:8.32    Position:X:26.77 Y:-29.73    Position:X:-4.18 Y:39.78    Position:X:-20 Y:-34.64    Position:X:26.77 Y:29.73    Position:X:-39.13 Y:-8.32    Position:X:36.54 Y:-16.27    Position:X:-20 Y:34.64    Position:X:-4.18 Y:-39.78
    End
End

Object LindonHeavenArcherHorde


    ButtonImage           =    HSHeavenArcher
    SelectPortrait        =    UPHeavenArcher


    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR
        DefaultModelConditionState
            Model = None
        End
        ModelConditionState = HORDE_EMPTY
            Model = None
        End
        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkEULoW
        End
    End

    Side = Imladris
    EditorSorting = UNIT
    EmotionRange = 240
    DisplayName = OBJECT:LindonHeavenArcher
    DisplayNameStrategic = CONTROLBAR:LW_Unit_LindonHeavenArcherHorde
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_ElvenLorienArcherHorde

    WeaponSet
        Conditions = None
        Weapon = PRIMARY     HeavenBowArcherMissileHordeRangefinder
        Weapon = TERTIARY    HeavenBowArcherMissileHordeRangefinderBombard
        AutoChooseSources = TERTIARY FROM_PLAYER FROM_SCRIPT
    End

    CommandSet = LindonHeavenArcherHordeCommandSet





    #include "..\..\..\includes\StandardHordeEvaEvents.inc"


     CrushableLevel     = 0
    CrusherLevel     = 0
    UseCrushAttack     = No

    BuildCost     = 450
    BuildTime     = MEDIUM_BUILDTIME
    VisionRange     = 390
    VisionSide     = 50%
    VisionRear     = 25%
    VisionBonusPercentPerFoot = 1.0%
    ShroudClearingRange = 440
    CommandPoints     = 65

    FormationWidth = 2
    FormationDepth = 1

    TransportSlotCount = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE ARCHER LARGE_RECTANGLE_PATHFIND


    ThreatLevel = ELVEN_LORIENARCHER_HORDE_THREAT
    ThreatBreakdown ElvenLorienArcherHorde_DetailedThreat
        AIKindOf = ARCHER
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = ArcherHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate        = 500
        MaxCowerTime                =    5000
        MinCowerTime                =    3000
        CanAttackWhileContained    = Yes
        AILuaEventsList                = InfantryFunctions
        AttackPriority                =     AttackPriority_Archer
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload         = LindonHeavenArcher 10
        Slots             = 10
        PassengerFilter        = NONE +INFANTRY
        ShowPips         = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset        = X:0 Y:0
        MeleeBehavior         = Amoeba
        End


        BannerCarriersAllowed    = LindonBanner
        BannerCarrierPosition    = UnitType:LindonHeavenArcher    Pos:X:40.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:LindonHeavenArcher Position:X:20 Y:0    Position:X:20 Y:25    Position:X:20 Y:-25    Position:X:20 Y:50    Position:X:20 Y:-50
        RankInfo = RankNumber:2 UnitType:LindonHeavenArcher Position:X:0 Y:0    Position:X:0 Y:25    Position:X:0 Y:-25    Position:X:0 Y:50    Position:X:0 Y:-50

        RanksToReleaseWhenAttacking = 1 2 3

        MeleeAttackLeashDistance = 1
        BackUpMinDelayTime        = 1
        BackUpMaxDelayTime        = 3000
        BackUpMinDistance        = 1
        BackUpMaxDistance        = 3
        BackupPercentage        = 80%
    End

    #include "..\..\..\includes\DefaultInvisibilityUpdate.inc"

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

     Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded        =    NONE
        AfraidOf            =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf            =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
         PointAt                =    EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance        =    150
        FearScanDistance        =    ARCHER_FEAR_SCAN_RADIUS


        AddEmotion    =    Terror_Base
        AddEmotion    =    Doom_Base
        AddEmotion    =   BraceForBeingCrushed_Base
        AddEmotion    =    UncontrollableFear_Base
        AddEmotion    =    FearIdle_Base
        AddEmotion    =    FearBusy_Base
        AddEmotion    =    Point_Base
        AddEmotion    =    Taunt_Base
        AddEmotion    =    CheerIdle_Base
        AddEmotion    =    CheerBusy_Base
        AddEmotion    =    HeroCheerIdle_Base
        AddEmotion    =    HeroCheerBusy_Base
        AddEmotion    =    Alert_Base
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End

    LocomotorSet
        Locomotor     = NormalMeleeHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_FOOT_VERYFAST_HORDE_SPEED
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTrainingImladis
        LevelsToGain = 1
        LevelCap = 2
    End


    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality
        TriggeredBy = Upgrade_HeavyArmor
    End






    Behavior = AISpecialPowerUpdate ElvenLorienWarriorHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End


    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 50.0
    GeometryHeight = 20.0
    GeometryIsSmall = No




    AutoResolveUnitType = AutoResolveUnit_Archer
    AutoResolveCombatChain = AutoResolve_ArcherCombatChain

    AutoResolveBody = AutoResolve_ElvenLorienArcherHordeBody

    AutoResolveArmor
        Armor = AutoResolve_ElvenLorienArcherHeavyArmor
    End

    AutoResolveWeapon
        Weapon = AutoResolve_ElvenLorienArcherWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTrainingImladis
End

ChildObject LindonHeavenArcherHordeFree LindonHeavenArcherHorde
    BuildCost     = 0
End

Object LindonHeavenWarriorHorde


    ButtonImage           =    HSHeavenWarrior
    SelectPortrait        =    UPHeavenWarrior


    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags     = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR
        DefaultModelConditionState
            Model         = None
        End
        ModelConditionState     = HORDE_EMPTY
            Model         = None
        End
        ModelConditionState     = WORLD_BUILDER
            Model         = HordeMarkEULoW
        End
    End

    Side                  = Imladris
    EditorSorting         = UNIT
    EmotionRange          = 240
    DisplayName           = OBJECT:LindonHeavenWarrior
    DisplayNameStrategic  = CONTROLBAR:LW_Unit_LindonHeavenWarrior
    DescriptionStrategic  = CONTROLBAR:LW_ToolTip_ElvenLorienWarriorHorde


    WeaponSet
        Conditions     = None
        Weapon         = PRIMARY    NormalMeleeHordeRangefinder
    End
    WeaponSet
        Conditions     = CONTAINED
        Weapon         = PRIMARY GarrisonedUnitBowHordeRangefinder
    End

    CommandSet         = LindonHeavenWarriorHordeCommandSet





    #include "..\..\..\includes\StandardHordeEvaEvents.inc"


     CrushableLevel         = 0
    CrusherLevel         = 0

    BuildCost         = 400
    BuildTime         = WEAK_BUILDTIME
    VisionRange         = 200
        VisionSide     = 50%
    VisionRear         = 25%
    VisionBonusPercentPerFoot = 1.0%
    ShroudClearingRange     = 400
    CommandPoints         = 60

    FormationWidth         = 2
    FormationDepth         = 1

    TransportSlotCount         = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf             = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE ARMY_SUMMARY MELEE_HORDE LARGE_RECTANGLE_PATHFIND

    ThreatLevel         = ELVEN_LORIENWARRIOR_HORDE_THREAT
    ThreatBreakdown ElvenLorienWarriorHorde_DetailedThreat
        AIKindOf     = INFANTRY
    End

    Body             = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth     = 1
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = FighterHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle     = Yes ATTACK_BUILDINGS STEALTHED
        MoodAttackCheckRate            = 500
        MaxCowerTime            = 5000
        MinCowerTime            = 3000
        CanAttackWhileContained        = Yes
        AILuaEventsList                = InfantryFunctions
        AttackPriority                = AttackPriority_Archer
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained     =
        InitialPayload             = LindonHeavenWarrior 10
        Slots                 = 10
        PassengerFilter            = NONE +INFANTRY
        ShowPips             = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset            = X:0 Y:0
        MeleeBehavior             = Amoeba
        End


        BannerCarriersAllowed        = LindonBanner
        BannerCarrierPosition        = UnitType:LindonHeavenWarrior    Pos:X:70.0 Y:0.0


        RankInfo = RankNumber:1 UnitType:LindonHeavenWarrior Position:X:0 Y:0    Position:X:0 Y:25    Position:X:0 Y:-25    Position:X:0 Y:50    Position:X:0 Y:-50
        RankInfo = RankNumber:2 UnitType:LindonHeavenWarrior Position:X:20 Y:0    Position:X:15 Y:25    Position:X:20 Y:-25    Position:X:20 Y:50    Position:X:20 Y:-50

        RanksToReleaseWhenAttacking = 1  2 3

        MeleeAttackLeashDistance     = 1
        BackUpMinDelayTime        = 1
        BackUpMaxDelayTime        = 3000
        BackUpMinDistance        = 1
        BackUpMaxDistance        = 3
        BackupPercentage        = 80%
    End

    #include "..\..\..\includes\DefaultInvisibilityUpdate.inc"

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

     Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded        =    NONE
        AfraidOf            =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf            =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
         PointAt                =    EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance        =    150
        FearScanDistance        =    ARCHER_FEAR_SCAN_RADIUS



        AddEmotion    =    Terror_Base
        AddEmotion    =    Doom_Base
        AddEmotion    =       BraceForBeingCrushed_Base
        AddEmotion    =    UncontrollableFear_Base
        AddEmotion    =    FearIdle_Base
        AddEmotion    =    FearBusy_Base
        AddEmotion    =    Point_Base
        AddEmotion    =    Taunt_Base
        AddEmotion    =    CheerIdle_Base
        AddEmotion    =    CheerBusy_Base
        AddEmotion    =    HeroCheerIdle_Base
        AddEmotion    =    HeroCheerBusy_Base
        AddEmotion    =    Alert_Base
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly         = Yes
        StuffToPickUp         = ANY +CRATE -TheDroppedRing
        ScanRange         = 200
        ScanIntervalSeconds     = 0.5
    End

    LocomotorSet
        Locomotor         = NormalMeleeHordeLocomotor
        Condition         = SET_NORMAL
        Speed             = NORMAL_FOOT_VERYFAST_HORDE_SPEED
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior         = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy     = Upgrade_BasicTrainingImladis
        LevelsToGain     = 1
        LevelCap     = 2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality
        TriggeredBy = Upgrade_HeavyArmor
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_ForgedBlades
    End








    Behavior = AISpecialPowerUpdate ElvenLorienWarriorHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End


    Geometry         = BOX
    GeometryMajorRadius     = 30.0
    GeometryMinorRadius     = 50.0
    GeometryHeight         = 20.0
    GeometryIsSmall     = No




    AutoResolveUnitType = AutoResolveUnit_Soldier
    AutoResolveCombatChain = AutoResolve_SoldierCombatChain

    AutoResolveBody = AutoResolve_ElvenLorienWarriorHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_ElvenLorienWarriorHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_ElvenLorienWarriorArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_ElvenLorienWarriorUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_ElvenLorienWarriorWeapon
    End

End

Object LindonHeavenLancerHorde


    ButtonImage            = HSImladrisLanze
       SelectPortrait         = UPImladrisLanze

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR EMOTION_LOOK_TO_SKY
        DefaultModelConditionState
            Model = None
        End
        ModelConditionState = HORDE_EMPTY
            Model = None
        End

        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkGUTow
        End
    End

    Side = Imladris
    EditorSorting = UNIT
    EmotionRange = 240
    DisplayName = OBJECT:LindonHeavenLancerHorde
    DisplayNameStrategic = CONTROLBAR:LW_Unit_LindonHeavenLancerHorde
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_GondorTowerGuardHorde

    WeaponSet
        Conditions = None
        Weapon = PRIMARY    TowerGuardHordeRangefinder
    End






    BuildCost             = 700
    BuildTime             = MEDIUM_BUILDTIME
	MaxSimultaneousOfType    = 4
    VisionRange             = GONDOR_TOWERGUARD_HORDE_VISION_RANGE
    ShroudClearingRange         = GONDOR_TOWERGUARD_HORDE_SHROUD_RANGE
    VisionSide             = 50%
    VisionRear             = 25%
    MaxVisionBonusPercent         = 300%
    VisionBonusTestRadius         = 200
    VisionBonusPercentPerFoot     = 1.0%
    CommandPoints             = 50

    CommandSet = LindonLanzentragerHordeCommandSet

    FormationWidth = 2
    FormationDepth = 1

     CrushableLevel = 0
    CrusherLevel = 0

    TransportSlotCount = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE ARMY_SUMMARY MELEE_HORDE PIKE LARGE_RECTANGLE_PATHFIND
    #include "..\..\..\includes\StandardHordeEvaEvents.inc"

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    ThreatLevel = GONDOR_TOWERSHIELDGUARD_HORDE_THREAT
    ThreatBreakdown GondorTowerShieldGuardHorde_DetailedThreat
        AIKindOf = PIKEMAN
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = PikeHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle    =    Yes ATTACK_BUILDINGS
        MoodAttackCheckRate        =    500
        MaxCowerTime            =    5000
        MinCowerTime            =    3000
        AILuaEventsList            =    InfantryFunctions
        AttackPriority            =     AttackPriority_Spearman
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle             = STANDARD_PIKEMAN_FRONTANGLE
        FlankedDelay             = STANDARD_PIKEMAN_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload         = LindonHeavenLancer 10
        Slots             = 10
        PassengerFilter        = NONE +INFANTRY
        ShowPips         = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset        = X:0 Y:0
        MeleeBehavior = Amoeba
            FacingBonus    = 30.0
            AngleLimitCos    = -0.17
            InnerRange    = 30
            OuterRange    = 80
            OuterRangeBuildings    = 140
        End


        BannerCarriersAllowed    = LindonBanner
        BannerCarrierPosition    = UnitType:LindonHeavenLancer    Pos:X:70.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:LindonHeavenLancer Position:X:50 Y:0        Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:50 Y:40        Position:X:50 Y:-40
        RankInfo = RankNumber:2 UnitType:LindonHeavenLancer Position:X:30 Y:0 Leader 1 0    Position:X:30 Y:20 Leader 1 1    Position:X:30 Y:-20 Leader 1 2    Position:X:30 Y:40 Leader 1 3    Position:X:30 Y:-40 Leader 1 4

        RanksToReleaseWhenAttacking = 1

        AlternateFormation = GondorTowerShieldGuardHordeShieldWall2
        MeleeAttackLeashDistance = 1
        BackUpMinDelayTime         = 1
        BackUpMaxDelayTime         = 3000
        BackUpMinDistance         = 1
        BackUpMaxDistance         = 3
        BackupPercentage         = 80%
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

       Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded        =    NONE
         AfraidOf                    =    EMOTION_AFRAIDOF_OBJECTFILTER_LANCERS
        AlwaysAfraidOf                =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER_LANCERS
         PointAt                        =    EMOTION_POINTAT_OBJECTFILTER_LANCERS
        HeroScanDistance            =    150
        FearScanDistance            =    INFANTRY_FEAR_SCAN_RADIUS

        AddEmotion            =    Terror_Base
        AddEmotion            =    Doom_Base
        AddEmotion            =    UncontrollableFear_Base
        AddEmotion            =    FearIdle_Base
        AddEmotion            =    FearBusy_Base
        AddEmotion            =    Point_Base

        AddEmotion            =    OVERRIDE Taunt_Base
         End

        AddEmotion    =    CheerIdle_Base
        AddEmotion    =    CheerBusy_Base
        AddEmotion    =    HeroCheerIdle_Base
        AddEmotion    =    HeroCheerBusy_Base
        AddEmotion    =    Alert_Base
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End

    LocomotorSet
        Locomotor     = NormalMeleeHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_FOOT_MED_HORDE_SPEED
    End

    Behavior = AttributeModifierUpgrade ModuleTag_CrushDecelerateBonus
        TriggeredBy       = Upgrade_AllFactionUpgrade
        AttributeModifier = Crushed_Decelerate_Pikes
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTraining
        LevelsToGain = 1
        LevelCap = 2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality
        TriggeredBy = Upgrade_ForgedBlades
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_HeavyArmor
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality3
        TriggeredBy = Upgrade_TechnologyLothlorienLembasbrotAktive
    End



    Behavior = SpecialPowerModule ModuleTag_Lembasbrot
        SpecialPowerTemplate     = SpecialAbilityLembasbrotHealSpell
        UpdateModuleStartsAttack = Yes
    End

    Behavior = SpecialAbilityUpdate ModuleTag_LembasbrotUpdate
        SpecialPowerTemplate     = SpecialAbilityLembasbrotHealSpell
        StartAbilityRange        = 1.6
        UnpackTime               = 1
        PreparationTime          = 3
        PackTime                 = 2096
        AwardXPForTriggering     = 0
    End

    Behavior = AutoHealBehavior ModuleTag_LembasbrotHealing
        StartsActive             = Yes
        ButtonTriggered          = Yes
        HealingAmount            = 300
        Radius                   = 55
        HealOnlyOthers           = No
        SingleBurst              = Yes
        UnitHealPulseFX          = FX_SpellLembasbrotHealUnitHealBuff
        KindOf                   = INFANTRY
    End


    Behavior = CommandSetUpgrade ModuleTag_CloakCommandSet
        TriggeredBy       = Upgrade_LothlorienLembasbrotAktive
        CommandSet        = LindonLanzentragerHordeCommandSet_Lembasbrot
    End






    Behavior = AISpecialPowerUpdate GondorTowerShieldGuardHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End


    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 45.0
    GeometryHeight = 20.0
    GeometryIsSmall = No



    AutoResolveUnitType = AutoResolveUnit_Pikemen
    AutoResolveCombatChain = AutoResolve_PikemenCombatChain

    AutoResolveBody = AutoResolve_GondorTowerGuardHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_GondorTowerGuardHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_GondorTowerGuardArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_GondorTowerGuardUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_GondorTowerGuardWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTrainingImladis Upgrade_ForgedBlades Upgrade_HeavyArmor
End

ChildObject GondorTowerShieldGuardHordeShieldWall2 LindonHeavenLancerHorde

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle         		 = STANDARD_PIKEMAN_FRONTANGLE
        FlankedDelay        		 = STANDARD_PIKEMAN_FLANKEDDELAY
        ObjectStatusOfContained          =
        InitialPayload                   = LindonHeavenLancer 10
        Slots                            = 10
        PassengerFilter                  = NONE +INFANTRY
        ShowPips                         = No
        ThisFormationIsTheMainFormation  = No
        AttributeModifiers               = GilGaladsLeibwachterShieldWall
        RandomOffset                     = X:0 Y:0
        MeleeBehavior = Amoeba
        End


        BannerCarriersAllowed    = LindonBanner
        BannerCarrierPosition    = UnitType:LindonHeavenLancer   Pos:X:20.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:LindonHeavenLancer Position:X:0 Y:0        Position:X:0 Y:12.5        Position:X:0 Y:-12.5        Position:X:0 Y:25        Position:X:0 Y:-25
        RankInfo = RankNumber:2 UnitType:LindonHeavenLancer Position:X:-12.5 Y:0        Position:X:-12.5 Y:12.5        Position:X:-12.5 Y:-12.5        Position:X:-12.5 Y:25        Position:X:-12.5 Y:-25
        RanksToReleaseWhenAttacking = 1

        AlternateFormation = LindonHeavenLancerHorde
        MeleeAttackLeashDistance = 1
        BackUpMinDelayTime         = 1
        BackUpMaxDelayTime         = 3000
        BackUpMinDistance         = 1
        BackUpMaxDistance         = 3
        BackupPercentage         = 80%
    End
End



ChildObject LindonHeavenLancerHordePorcupine LindonHeavenLancerHorde

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle             = STANDARD_PIKEMAN_FRONTANGLE_FORMATION
        FlankedDelay             = STANDARD_PIKEMAN_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload                    = LindonHeavenLancer 10
        Slots                            = 10
        PassengerFilter                    = NONE +INFANTRY
        ShowPips                        = No
        ThisFormationIsTheMainFormation = No
        RandomOffset                    = X:2 Y:1
        RanksToReleaseWhenAttacking        = 0
        RanksToJustFreeWhenAttacking   = 0
        AttributeModifiers                = GondorTowerShieldGuardHordePorcupine
        IsPorcupineFormation            = Yes
        MinimumHordeSize                = 5

        AlternateFormation                = LindonHeavenLancerHorde
        VisionRearOverride                = 100%
        VisionSideOverride                = 100%
        NotComboFormation                = Yes


        BannerCarriersAllowed            = LindonBanner
        BannerCarrierPosition            = UnitType:LindonHeavenLancer    Pos:X:0.0 Y:0.0

        RankInfo    = RankNumber:1 UnitType:LindonHeavenLancer Position:X:20 Y:0    Position:X:-16.18 Y:11.76        Position:X:6.18 Y:-19.02    Position:X:6.18 Y:19.02    Position:X:-16.18 Y:-11.76    Position:X:36.54 Y:16.27    Position:X:-39.13 Y:8.32    Position:X:26.77 Y:-29.73    Position:X:-4.18 Y:39.78    Position:X:-20 Y:-34.64

     End

End

