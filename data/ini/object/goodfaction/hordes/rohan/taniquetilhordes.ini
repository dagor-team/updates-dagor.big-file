Object TaniquetilGuardHorde

    SelectPortrait = HPTaniquetilGuard
    ButtonImage    = HITaniquetilGuard_Wotr

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR
        DefaultModelConditionState
            Model = None
        End
        ModelConditionState = HORDE_EMPTY
            Model = None
        End
        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkEULoW
        End
    End

    Side                         = Rohan
    EditorSorting                 = UNIT
    EmotionRange                 = 240
    DisplayName                 = OBJECT:TaniquetilGuardHorde
    DisplayNameStrategic             = CONTROLBAR:LW_Unit_TaniquetilGuardHorde
    DescriptionStrategic            = CONTROLBAR:LW_ToolTip_TaniquetilGuardHorde
    ThreatLevel                 = 175
    TransportSlotCount                 = TRANSPORTSLOTCOUNT_SMALL_HORDE

    BuildCost                     = 1000
    BuildTime                     = FirstAgeHordeBuildtime

    VisionRange                            = 320
    ShroudClearingRange                    = 380
    VisionSide                             = 35%
    VisionRear                             = 25%
    MaxVisionBonusPercent                  = 300%
    VisionBonusTestRadius                  = 200
    VisionBonusPercentPerFoot              = 2.0%

    CrushableLevel                     = 0
    CrusherLevel                       = 0
    CrushRevengeWeapon                 = SuperInfantryCrushRevenge

    CommandPoints                 = 50
    CommandSet                     = TaniquetilGuardHordeCommandSet

    WeaponSet
        Conditions                 = None
        Weapon                     = PRIMARY TowerGuardHordeRangefinder
    End

    FormationWidth = 2
    FormationDepth = 1

    #include "..\..\..\includes\StandardHordeEvaEvents.inc"

    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE ARMY_SUMMARY MELEE_HORDE LARGE_RECTANGLE_PATHFIND PIKE

    ThreatBreakdown ElvenMithlondSentryHorde_DetailedThreat
        AIKindOf = PIKEMAN
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = PikeHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle         = Yes ATTACK_BUILDINGS STEALTHED
        MoodAttackCheckRate               = 500
        MaxCowerTime                    = 5000
        MinCowerTime                    = 3000
        CanAttackWhileContained            = Yes
        AILuaEventsList                 = InfantryFunctions
        AttackPriority                  = AttackPriority_Archer
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle         = STANDARD_PIKEMAN_FRONTANGLE
        FlankedDelay         = STANDARD_PIKEMAN_FLANKEDDELAY
        ObjectStatusOfContained         =
        InitialPayload                 = TaniquetilGuard 5
        Slots                         = 5
        PassengerFilter                = NONE +INFANTRY
        ShowPips                    = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset                 = X:0 Y:0
        MeleeBehavior                 = Amoeba
        End

        BannerCarriersAllowed         = TaniquetilBanner
        BannerCarrierPosition         = UnitType:TaniquetilGuard  Pos:X:20 Y:0

        RankInfo = RankNumber:1 UnitType:TaniquetilGuard  Position:X:0 Y:0   Position:X:0 Y:20   Position:X:0 Y:-20   Position:X:0 Y:40    Position:X:0 Y:-40

        RanksToReleaseWhenAttacking     = 1
        AlternateFormation             = TaniquetilGuardHordeShieldWall
        MeleeAttackLeashDistance         = 1
        BackUpMinDelayTime                 = 1
        BackUpMaxDelayTime                 = 3000
        BackUpMinDistance                 = 1
        BackUpMaxDistance                 = 3
        BackupPercentage                 = 80%
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult             = 1.0
    End

    Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance           = INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay        = 1000
        TauntAndPointExcluded           = NONE
        AfraidOf                        = EMOTION_AFRAIDOF_OBJECTFILTER_LANCERS
        AlwaysAfraidOf                  = EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER_LANCERS
        PointAt                        = EMOTION_POINTAT_OBJECTFILTER_LANCERS
        HeroScanDistance                = 150
        FearScanDistance                = INFANTRY_FEAR_SCAN_RADIUS
        AddEmotion                    = Terror_Base
        AddEmotion                    = Doom_Base
        AddEmotion                   = UncontrollableFear_Base
        AddEmotion                    = FearIdle_Base
        AddEmotion                    = FearBusy_Base
        AddEmotion                    = Point_Base
        AddEmotion                    = Taunt_Base
        AddEmotion                    = CheerIdle_Base
        AddEmotion                    = CheerBusy_Base
        AddEmotion                    = HeroCheerIdle_Base
        AddEmotion                    = HeroCheerBusy_Base
        AddEmotion                    = Alert_Base
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly             = Yes
        StuffToPickUp             = ANY +CRATE -TheDroppedRing
        ScanRange             = 200
        ScanIntervalSeconds         = 0.5
    End

    LocomotorSet
        Locomotor = NormalMeleeHordeLocomotor
        Condition = SET_NORMAL
        Speed     = 55
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = AutoHealBehavior ModuleTag_HearthHeal
        StartsActive                  = No
        HealOnlyIfNotInCombat         = Yes
        HealOnlyIfNotUnderAttack      = Yes
        TriggeredBy                   = Upgrade_EliteHordeLvl2
        HealingAmount                 = 30
        Radius                        = 100
        StartHealingDelay             = 7500
        HealingDelay                  = 5000
        UnitHealPulseFX               = FX_SpellHealUnitHealBuff
        NonStackable                  = Yes
        RespawnNearbyHordeMembers     = Yes
        RespawnFXList                 = FX_BannerCarrierSpawnUnit
        RespawnMinimumDelay           = 200
    End

    Behavior = AttributeModifierUpgrade ModuleTag_AMU
        TriggeredBy                   = Upgrade_AllFactionUpgrade
        AttributeModifier             = FearlessForever
    End

    Behavior = StatusBitsUpgrade ForgedBlades_UpgradeDetection
        TriggeredBy                   = Upgrade_FormenosForgedBlades
    End

    Behavior = SubObjectsUpgrade ForgedBlades_Upgrade1
        TriggeredBy                   = Upgrade_AllFactionUpgrade
        HideSubObjects                = Forged_Blade
    End

    Behavior = SubObjectsUpgrade ModuleTag_FireArrowSwapUpgrade
        TriggeredBy                   = Upgrade_FormenosForgedBlades
        ShowSubObjects                = Forged_Blade
    End











    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_DreadVisageLeadership
        SpecialPowerTemplate           = SpecialAbilityFakeLeadership
        TriggeredBy                    = Upgrade_EliteHordeLvl2
    End

    Behavior = SpecialPowerModule ModuleTag_DreadVisageUpdate
        SpecialPowerTemplate           = SpecialAbilityFakeLeadership
        UpdateModuleStartsAttack       = No
        StartsPaused                   = Yes
    End

    Behavior = AttributeModifierAuraUpdate ModuleTag_DreadVisage
        StartsActive                   = No
        BonusName                      = FormenosGuardArmorRupture
        TriggeredBy                    = Upgrade_EliteHordeLvl2
        RefreshDelay                   = 2000
        Range                          = 200
        TargetEnemy                    = Yes
        AntiCategory                   = LEADERSHIP BUFF
        ObjectFilter                   = ANY -INFANTRY +CAVALRY -STRUCTURE -BASE_FOUNDATION -HERO
    End





    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_FormenosArmorUpgradeEnabler
        SpecialPowerTemplate           = SpecialAbilityFakeLeadership2
        TriggeredBy                    = Upgrade_EliteHordeLvl5
    End

    Behavior = SpecialPowerModule ModuleTag_FormenosArmorUpgradeStarter
        SpecialPowerTemplate           = SpecialAbilityFakeLeadership2
        UpdateModuleStartsAttack       = Yes
        StartsPaused                   = Yes
    End

    Behavior = ArmorUpgrade ArmorUpgradeModuleTag
        TriggeredBy                    = Upgrade_EliteHordeLvl5
        ArmorSetFlag                   = PLAYER_UPGRADE
    End







    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName  = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName  = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName  = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Behavior = AISpecialPowerUpdate ElvenLorienWarriorHordeCaptureBuildingAI
        CommandButtonName  = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End




    Geometry         = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 45.0
    GeometryHeight     = 20.0
    GeometryIsSmall     = No





    AutoResolveUnitType            = AutoResolveUnit_Pikemen
    AutoResolveCombatChain         = AutoResolve_PikemenCombatChain

    AutoResolveBody                = AutoResolve_EliteLegndaryHordeBody

    AutoResolveArmor
        Armor                      = AutoResolve_EliteLegndaryPikemanArmor
    End

    AutoResolveWeapon
        Weapon                     = AutoResolve_EliteLegndaryPikemanWeapon
    End
End


ChildObject TaniquetilGuardHordeShieldWall TaniquetilGuardHorde

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle         = STANDARD_PIKEMAN_FRONTANGLE
        FlankedDelay         = STANDARD_PIKEMAN_FLANKEDDELAY
        ObjectStatusOfContained         =
        InitialPayload                  = TaniquetilGuard 5
        Slots                           = 5
        PassengerFilter                 = NONE +INFANTRY
        ShowPips                        = No
        ThisFormationIsTheMainFormation = No
        AttributeModifiers              = FormenosGuardShieldWallBonus
        RandomOffset                    = X:0 Y:0
        MeleeBehavior                 = Amoeba
        End

        BannerCarriersAllowed         = TaniquetilBanner
        BannerCarrierPosition         = UnitType:TaniquetilGuard  Pos:X:20 Y:0

        RankInfo = RankNumber:1 UnitType:TaniquetilGuard  Position:X:0 Y:0   Position:X:0 Y:10   Position:X:0 Y:-10  Position:X:0 Y:20   Position:X:0 Y:-20

        RanksToReleaseWhenAttacking     = 1
        AlternateFormation             = TaniquetilGuardHorde
        MeleeAttackLeashDistance         = 1
        BackUpMinDelayTime                 = 1
        BackUpMaxDelayTime                 = 3000
        BackUpMinDistance                = 1
        BackUpMaxDistance                 = 3
        BackupPercentage                 = 80%
    End
End


Object TaniquetilWatcherHorde

    SelectPortrait = HPTaniquetilWatcher
    ButtonImage    = HITaniquetilWatcher_Wotr

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR
        DefaultModelConditionState
            Model = None
        End
        ModelConditionState = HORDE_EMPTY
            Model = None
        End
        ModelConditionState = WORLD_BUILDER
            Model = HordeTemp_5By2
        End
    End

    Side                              	= Rohan
    EditorSorting                     	= UNIT
    EmotionRange                      	= 240
    TransportSlotCount                 	= TRANSPORTSLOTCOUNT_LARGE_HORDE
    DisplayName                       	= OBJECT:TaniquetilWatcherHorde
    DisplayNameStrategic              	= CONTROLBAR:LW_Unit_TaniquetilWatcherHorde
    DescriptionStrategic              	= CONTROLBAR:LW_ToolTip_TaniquetilWatcherHorde

    BuildCost                     	= 1100
    BuildTime                     	= FirstAgeHordeBuildtime

    VisionRange                      	= 420
    VisionSide                        	= 50%
    VisionRear                        	= 25%
    VisionBonusPercentPerFoot         	= 1.0%
    ShroudClearingRange               	= 450

    CrushableLevel                 	= 0
    CrusherLevel                 	= 0

    CommandSet                     	= TaniquetilWatcherHordeCommandSet
    CommandPoints                     	= 50


    WeaponSet
        Conditions                 	= None
        Weapon                         	= PRIMARY  MirkwoodArcherMissileHordeRangefinder
    End

    WeaponSet
        Conditions                  	= CONTAINED
        Weapon                      	= PRIMARY GarrisonedUnitBowHordeRangefinder
    End

    WeaponSet
        Conditions                 	= WEAPONSET_TOGGLE_1
        Weapon                         	= PRIMARY  NormalMeleeHordeRangefinder
    End

    FormationWidth = 2
    FormationDepth = 1

    #include "..\..\..\includes\StandardHordeEvaEvents.inc"

    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE ARCHER ARMY_SUMMARY MELEE_HORDE LARGE_RECTANGLE_PATHFIND

    ThreatLevel = 175
        ThreatBreakdown ElvenLorienArcherHorde_DetailedThreat
        AIKindOf = ARCHER
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = ArcherHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle     = Yes ATTACK_BUILDINGS STEALTHED
        MoodAttackCheckRate            = 500
        MaxCowerTime                   = 5000
        MinCowerTime                   = 3000
        CanAttackWhileContained        = Yes
        AILuaEventsList                = InfantryFunctions
        AttackPriority                 = AttackPriority_Archer
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle                      = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay                    = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained         =
        InitialPayload                  = TaniquetilWatcher 5
        Slots                           = 5
        PassengerFilter                 = NONE +INFANTRY
        ShowPips                        = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset                    = X:0 Y:0
        MeleeBehavior                   = Amoeba
        End

        BannerCarriersAllowed         = TaniquetilBanner
        BannerCarrierPosition         = UnitType:TaniquetilWatcher  Pos:X:20 Y:0

        RankInfo = RankNumber:1 UnitType:TaniquetilWatcher  Position:X:0 Y:0   Position:X:0 Y:20   Position:X:0 Y:-20   Position:X:0 Y:40    Position:X:0 Y:-40

        RanksToReleaseWhenAttacking     = 1
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult             = 1.0
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance         = INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay      = 1000
        TauntAndPointExcluded         = NONE
        PointAt                       = NONE +MordorFellBeast +MordorWitchKingOnFellBeast +GondorGwaihir
        HeroScanDistance              = 150
        FearScanDistance              = INFANTRY_FEAR_SCAN_RADIUS
        AddEmotion                = Terror_Base
        AddEmotion                = Doom_Base
        AddEmotion                = BraceForBeingCrushed_Base
        AddEmotion                = UncontrollableFear_Base
        AddEmotion                = FearIdle_Base
        AddEmotion                = FearBusy_Base
        AddEmotion                = Point_Base
        AddEmotion                = Taunt_Base
        AddEmotion                = CheerIdle_Base
        AddEmotion                = CheerBusy_Base
        AddEmotion                = HeroCheerIdle_Base
        AddEmotion                = HeroCheerBusy_Base
        AddEmotion                = Alert_Base
    End

    LocomotorSet
        Locomotor = NormalMeleeHordeLocomotor
        Condition = SET_NORMAL
        Speed     = 55
    End

    Behavior = AutoHealBehavior ModuleTag_HearthHeal
        StartsActive                  = No
        HealOnlyIfNotInCombat         = Yes
        HealOnlyIfNotUnderAttack      = Yes
        TriggeredBy                   = Upgrade_EliteHordeLvl2
        HealingAmount                 = 30
        Radius                        = 100
        StartHealingDelay             = 7500
        HealingDelay                  = 5000
        UnitHealPulseFX               = FX_SpellHealUnitHealBuff
        NonStackable                  = Yes
        RespawnNearbyHordeMembers     = Yes
        RespawnFXList                 = FX_BannerCarrierSpawnUnit
        RespawnMinimumDelay           = 200
    End

    Behavior = RadiateFearUpdate ModuleTag_GoldenArrowDaylightUpdate
        EmotionPulseRadius          = 100
        EmotionPulseInterval        = 1000
        GenerateFear                = Yes
        InitiallyActive             = Yes
        VictimFilter                = ALL ENEMIES
    End

    Behavior = AttributeModifierUpgrade ModuleTag_AMU
        TriggeredBy                   = Upgrade_AllFactionUpgrade
        AttributeModifier             = FearlessForever
    End

    Behavior = StatusBitsUpgrade ForgedBlades_UpgradeDetection
        TriggeredBy                   = Upgrade_FormenosForgedBlades
    End

    Behavior = SubObjectsUpgrade ForgedBlades_Upgrade1
        TriggeredBy                   = Upgrade_AllFactionUpgrade
        HideSubObjects                = Forged_Blade FIREAROWTIP
    End

    Behavior = SubObjectsUpgrade ModuleTag_FireArrowSwapUpgrade
        TriggeredBy                   = Upgrade_FormenosForgedBlades
        ShowSubObjects                = Forged_Blade FIREAROWTIP
    End











    Behavior = WeaponChangeSpecialPowerModule THING
        SpecialPowerTemplate          = SpecialAbilityBerserkerLightTorch
        FlagsUsedForToggle            = WEAPONSET_TOGGLE_1
        ToggleOnAttributeModifier     = WeaponSwitchUnitModifier
    End





    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_FormenosArmorUpgradeEnabler
        SpecialPowerTemplate          = SpecialAbilityFakeLeadership2
        TriggeredBy                   = Upgrade_EliteHordeLvl5
    End

    Behavior = SpecialPowerModule ModuleTag_FormenosArmorUpgradeStarter
        SpecialPowerTemplate          = SpecialAbilityFakeLeadership2
        UpdateModuleStartsAttack      = Yes
        StartsPaused                  = Yes
    End

    Behavior = ArmorUpgrade ArmorUpgradeModuleTag
        TriggeredBy                   = Upgrade_EliteHordeLvl5
        ArmorSetFlag                  = PLAYER_UPGRADE
    End





    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_GlorfindelBladeOfPurityEnabler
        SpecialPowerTemplate          = SpecialAbilityGlorfindelBladeOfPurity
        TriggeredBy                   = Upgrade_EliteHordeLvl7
    End

    Behavior = SpecialPowerModule ModuleTag_GlorfindelBladeOfPurityStarter
        SpecialPowerTemplate          = SpecialAbilityGlorfindelBladeOfPurity
        StartsPaused                  = Yes
    End

    Behavior = SpecialAbilityUpdate ModuleTag_GlorfindelBladeOfPurityUpdate
        SpecialPowerTemplate          = SpecialAbilityGlorfindelBladeOfPurity
        TriggerAttributeModifier      = TaniquetilWatcherWeaponSong
        AttributeModifierDuration     = 30000
    End

    Behavior = AutoAbilityBehavior ModuleTag_BladeOfPurityAutoAbility
        SpecialAbility                = SpecialAbilityGlorfindelBladeOfPurity
        MaxScanRange                  = 500
        Query                         = 5 ALL ENEMIES
    End







    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName  = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName  = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName  = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Behavior = AISpecialPowerUpdate ElvenLorienWarriorHordeCaptureBuildingAI
        CommandButtonName  = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End


    Behavior = AISpecialPowerUpdate HordeToggleWeapon_AI
        CommandButtonName  = Command_ToggleElvenWeaponSwitchUnit
        SpecialPowerAIType = AI_SPECIAL_POWER_TOGGLE_MELEE_AND_RANGE
    End

    Behavior = AISpecialPowerUpdate WeaponSong_AI
        CommandButtonName  = Command_TaniquetilWatcherWeaponSong
        SpecialPowerAIType = AI_SPECIAL_POWER_BASIC_SELF_BUFF
    End




    Geometry         	= BOX
    GeometryMajorRadius = 20.0
    GeometryMinorRadius = 50.0
    GeometryHeight     	= 20.0
    GeometryIsSmall     = No





    AutoResolveUnitType            = AutoResolveUnit_Archer
    AutoResolveCombatChain         = AutoResolve_ArcherCombatChain

    AutoResolveBody                = AutoResolve_EliteLegndaryHordeBody

    AutoResolveArmor
        Armor                      = AutoResolve_EliteLegndaryArcherArmor
    End

    AutoResolveWeapon
        Weapon                     = AutoResolve_EliteLegndaryArcherWeapon
    End
End

Object TaniquetilExpeditionaryHorde

    SelectPortrait = HPTaniquetilGuard
    ButtonImage    = HITaniquetilGuard_Wotr

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR
        DefaultModelConditionState
            Model = None
        End
        ModelConditionState = HORDE_EMPTY
            Model = None
        End
        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkEULoW
        End
    End

    Side                         = Rohan
    EditorSorting                 = UNIT
    EmotionRange                 = 240
    DisplayName                 = OBJECT:TaniquetilExpeditionaryHorde
    DisplayNameStrategic             = CONTROLBAR:LW_Unit_TaniquetilExpeditionaryHorde
    DescriptionStrategic            = CONTROLBAR:LW_ToolTip_TaniquetilExpeditionaryHorde
    ThreatLevel                 = 175
    TransportSlotCount                 = TRANSPORTSLOTCOUNT_SMALL_HORDE

    BuildCost                     = 1100
    BuildTime                        = FirstAgeHordeBuildtime

    VisionRange                      = 200
    ShroudClearingRange              = 400
    VisionSide                       = 35%
    VisionRear                       = 25%
    MaxVisionBonusPercent            = 300%
    VisionBonusTestRadius            = 250
    VisionBonusPercentPerFoot        = 2.0%

    CrushableLevel                   = 2
    CrusherLevel                     = 1
    MinCrushVelocityPercent = MINCRUSHVELOCITYPERCENT_STANDARD
    CrushDecelerationPercent = CRUSHDECELERATIONPERCENT_STANDARD
    CrushKnockback                   = 40
    CrushZFactor                     = 1.0

    CommandSet                       = TaniquetilExpeditionaryHordeCommandSet
    CommandPoints                    = 80

    WeaponSet
        Conditions                 = None
        Weapon                     = PRIMARY  NormalMeleeHordeRangefinder
    End

    FormationWidth = 2
    FormationDepth = 1

    #include "..\..\..\includes\StandardHordeEvaEvents.inc"

    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE ARMY_SUMMARY MELEE_HORDE LARGE_RECTANGLE_PATHFIND PIKE

    ThreatLevel = 175
		
    ThreatBreakdown GondorKnightHorde_DetailedThreat
        AIKindOf = CAVALRY
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = CavalryHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle      = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate             = 500
        MaxCowerTime                    = 5000
        MinCowerTime                    = 3000
        AILuaEventsList                 = CavalryFunctions
        AttackPriority                  = AttackPriority_Cavalry
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle         = STANDARD_PIKEMAN_FRONTANGLE
        FlankedDelay         = STANDARD_PIKEMAN_FLANKEDDELAY
        ObjectStatusOfContained         =
        InitialPayload                 = TaniquetilExpeditionary 5
        Slots                         = 5
        PassengerFilter                = NONE +CAVALRY
        ShowPips                    = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset                 = X:0 Y:0
        MeleeBehavior                 = Amoeba
        End

        BannerCarriersAllowed         = TaniquetilExpeditionaryBanner
        BannerCarrierPosition         = UnitType:TaniquetilExpeditionary  Pos:X:20 Y:0

        RankInfo = RankNumber:1 UnitType:TaniquetilExpeditionary  Position:X:0 Y:0   Position:X:0 Y:20   Position:X:0 Y:-20   Position:X:0 Y:40    Position:X:0 Y:-40

        RanksToReleaseWhenAttacking     = 1
        AlternateFormation             = TaniquetilExpeditionaryHordeStarFormation
        MeleeAttackLeashDistance         = 1
        BackUpMinDelayTime                 = 1
        BackUpMaxDelayTime                 = 3000
        BackUpMinDistance                 = 1
        BackUpMaxDistance                 = 3
        BackupPercentage                 = 80%
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult             = 1.0
    End

    Behavior = HordeNotifyTargetsOfImminentProbableCrushingUpdate ModuleTag_NotifyCrushScan
        ScanWidth             = 70.0
    End

    Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance            = INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay        = 1000
        TauntAndPointExcluded           = NONE
        AfraidOf                        = EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf                  = EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
        PointAt                         = EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance               = 150
        FearScanDistance                = INFANTRY_FEAR_SCAN_RADIUS
        AddEmotion                    = Terror_Base
        AddEmotion                    = Doom_Base
        AddEmotion                    = BraceForBeingCrushed_Base
        AddEmotion                    = UncontrollableFear_Base
        AddEmotion                    = FearIdle_Base
        AddEmotion                    = FearBusy_Base
        AddEmotion                    = Point_Base
        AddEmotion                    = Taunt_Base
        AddEmotion                    = CheerIdle_Base
        AddEmotion                    = CheerBusy_Base
        AddEmotion                    = HeroCheerIdle_Base
        AddEmotion                    = HeroCheerBusy_Base
        AddEmotion                    = Alert_Base
        AddEmotion                    = CheerForAboutToCrush_Base
     End

    LocomotorSet
        Locomotor  = NormalCavalryHordeLocomotor
        Condition  = SET_NORMAL
        Speed      = NORMAL_MOUNTED_VERYFAST_HORDE_SPEED
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP             = Yes
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly             = Yes
        StuffToPickUp              = ANY +CRATE -TheDroppedRing
        ScanRange                  = 200
        ScanIntervalSeconds         = 0.5
    End

    Behavior = AutoHealBehavior ModuleTag_HearthHeal
        StartsActive                   = No
        HealOnlyIfNotInCombat          = Yes
        HealOnlyIfNotUnderAttack       = Yes
        TriggeredBy                    = Upgrade_EliteHordeLvl2
        HealingAmount                  = 30
        Radius                         = 100
        StartHealingDelay              = 7500
        HealingDelay                   = 5000
        UnitHealPulseFX                = FX_SpellHealUnitHealBuff
        NonStackable                   = Yes
        RespawnNearbyHordeMembers      = Yes
        RespawnFXList                  = FX_BannerCarrierSpawnUnit
        RespawnMinimumDelay            = 200
    End

    Behavior = AttributeModifierUpgrade ModuleTag_AMU
        TriggeredBy                = Upgrade_AllFactionUpgrade
        AttributeModifier          = FearlessForever
    End

    Behavior = WeaponSetUpgrade WeaponSetUpgradeModuleTag
        TriggeredBy               = Upgrade_EliteHordeLvl5
    End

    Behavior = StatusBitsUpgrade ForgedBlades_UpgradeDetection
        TriggeredBy                = Upgrade_EliteHordeLvl5
    End

    Behavior = SubObjectsUpgrade ModuleTag_MakingThebla
        TriggeredBy                = Upgrade_AllFactionUpgrade
        HideSubObjects             = FORGED_BLADE
    End

    Behavior = SubObjectsUpgrade ForgedBlades_Upgrade
        TriggeredBy                = Upgrade_EliteHordeLvl5
        ShowSubObjects             = FORGED_BLADE
    End


    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_TheodenLeadership
        SpecialPowerTemplate     = SpecialAbilityFakeLeadership
        TriggeredBy              = Upgrade_EliteHordeLvl2
    End

    Behavior = SpecialPowerModule ModuleTag_TheodenLeadershipUpdate
        SpecialPowerTemplate     = SpecialAbilityFakeLeadership
        UpdateModuleStartsAttack = No
        StartsPaused             = Yes
    End

    Behavior = AttributeModifierAuraUpdate ModuleTag_Leadership
        StartsActive             = No
        BonusName                = TaniquetilExpeditionaryCloseContact
        TriggeredBy              = Upgrade_EliteHordeLvl2
        RefreshDelay             = 2000
        Range                    = 200
        ObjectFilter             = NONE +TaniquetilExpeditionary +TaniquetilExpeditionaryBanner +TaniquetilExpeditionaryHorde +TaniquetilExpeditionaryHordeStarFormation SAME_PLAYER
    End

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_FormenosArmorUpgradeEnabler
        SpecialPowerTemplate               = SpecialAbilityFakeLeadership2
        TriggeredBy                        = Upgrade_EliteHordeLvl5
    End

    Behavior = SpecialPowerModule ModuleTag_FormenosArmorUpgradeStarter
        SpecialPowerTemplate               = SpecialAbilityFakeLeadership2
        UpdateModuleStartsAttack           = Yes
        StartsPaused                       = Yes
    End

    Behavior = ArmorUpgrade ArmorUpgradeModuleTag
        TriggeredBy                        = Upgrade_EliteHordeLvl5
        ArmorSetFlag                       = PLAYER_UPGRADE
    End




    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName  = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName  = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName  = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Behavior = AISpecialPowerUpdate ElvenLorienWarriorHordeCaptureBuildingAI
        CommandButtonName  = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Geometry            = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 40.0
    GeometryHeight      = 20.0
    GeometryIsSmall     = No


    AutoResolveUnitType             = AutoResolveUnit_Cavalry
    AutoResolveCombatChain          = AutoResolve_CavalryCombatChain

    AutoResolveBody                 = AutoResolve_EliteLegndaryHordeBody

    AutoResolveArmor
        Armor                       = AutoResolve_EliteLegndaryCavalaryArmor
    End

    AutoResolveWeapon
        Weapon                      = AutoResolve_EliteLegndaryCavalaryWeapon
    End
End



ChildObject TaniquetilExpeditionaryHordeStarFormation TaniquetilExpeditionaryHorde

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle         = STANDARD_PIKEMAN_FRONTANGLE
        FlankedDelay         = STANDARD_PIKEMAN_FLANKEDDELAY
        ObjectStatusOfContained         =
        InitialPayload                  = TaniquetilExpeditionary 5
        Slots                           = 5
        PassengerFilter                 = NONE +CAVALRY
        ShowPips                        = No
        ThisFormationIsTheMainFormation = No
        AttributeModifiers              = TaniquetilExpeditionaryFormationBonus
        RandomOffset                    = X:0 Y:0
        MeleeBehavior                 = Amoeba
        End

        BannerCarriersAllowed         = TaniquetilExpeditionaryBanner
        BannerCarrierPosition         = UnitType:TaniquetilExpeditionary  Pos:X:0 Y:0

        RankInfo = RankNumber:1 UnitType:TaniquetilExpeditionary  Position:X:15 Y:0   Position:X:0 Y:30   Position:X:0 Y:-30  Position:X:-15 Y:15   Position:X:-15 Y:-15

        RanksToReleaseWhenAttacking     = 1
        AlternateFormation             = TaniquetilExpeditionaryHorde
        MeleeAttackLeashDistance         = 1
        BackUpMinDelayTime                 = 1
        BackUpMaxDelayTime                 = 3000
        BackUpMinDistance                = 1
        BackUpMaxDistance                 = 3
        BackupPercentage                 = 80%
    End
End


Object RohanHelmAxeGuardHorde

    SelectPortrait = HPRohanHelmAxeGuard
    ButtonImage    = HIRohanHelmAxeGuard_Wotr

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR

        DefaultModelConditionState
            Model = None
        End

        ModelConditionState = HORDE_EMPTY
            Model = None
        End

        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkMUCor
        End
    End

    Side                         = Rohan
    EditorSorting                 = UNIT
    EmotionRange                 = 240
    DisplayName                 = OBJECT:RohanHelmAxeGuardHorde
    DisplayNameStrategic             = CONTROLBAR:LW_Unit_RohanHelmAxeGuardHorde
    DescriptionStrategic             = CONTROLBAR:LW_ToolTip_RohanHelmAxeGuardHorde
    TransportSlotCount                 = TRANSPORTSLOTCOUNT_SMALL_HORDE
    ThreatLevel                 = 150

    BuildCost                          = 950
    BuildTime                          = FirstAgeHordeBuildtime

    VisionRange                        = 280
    VisionSide                         = 35%
    VisionRear                         = 25%
    VisionBonusPercentPerFoot          = 5.0%
    ShroudClearingRange                = 340
    ShowHealthInSelectionDecal         = Yes

    CrushableLevel                 = 2
    CrusherLevel                   = 0
    CrushRevengeWeapon                     = SuperInfantryCrushRevenge

    CommandPoints                      = 50
    CommandSet                     = RohanHelmAxeGuardHordeCommandSet


    WeaponSet
        Conditions                    = None
        Weapon                        = PRIMARY  NormalMeleeHordeRangefinder
    End

    FormationWidth = 2
    FormationDepth = 1

    #include "..\..\..\includes\StandardHordeEvaEvents.inc"

    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE MELEE_HORDE NOTIFY_OF_PREATTACK ARMY_SUMMARY LARGE_RECTANGLE_PATHFIND HEAVY_MELEE_HITTER

    ThreatBreakdown MordorCorsairsOfUmbarHorde_DetailedThreat
        AIKindOf = INFANTRY
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = FighterHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle     = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate             = 500
        MaxCowerTime                    = 5000
        MinCowerTime                    = 3000
        AILuaEventsList                 = InfantryFunctions
        AttackPriority                  = AttackPriority_Infantry
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle 			= STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay 			= STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained         =
        InitialPayload                  = RohanHelmAxeGuard 5
        Slots                           = 5
        PassengerFilter                 = NONE +INFANTRY
        ShowPips                        = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset                    = X:0 Y:0
        MeleeBehavior                   = Amoeba
        End

        RankInfo = RankNumber:1 UnitType:RohanHelmAxeGuard Position:X:0 Y:0  Position:X:0 Y:20   Position:X:0 Y:-20 Position:X:0 Y:40   Position:X:0 Y:-40

        RanksToReleaseWhenAttacking     = 1
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult             = 1.0
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance           = 200
        TauntAndPointUpdateDelay        = 10000
        PointAt                         = ANY +HERO
        AddEmotion                      = Doom_Base



        AddEmotion                      = Point_Base
        AddEmotion                      = Taunt_Base
         AddEmotion                     = CheerIdle_Base
        AddEmotion                      = CheerBusy_Base


        AddEmotion                      = Alert_Base
        AddEmotion                      = CheerForAboutToCrush_Base
    End

    LocomotorSet
        Locomotor = NormalMeleeHordeLocomotor
        Condition = SET_NORMAL
        Speed     = 52
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly             = Yes
        StuffToPickUp             = ANY +CRATE -TheDroppedRing
        ScanRange             = 200
        ScanIntervalSeconds         = 0.5
    End

    Behavior = AutoHealBehavior ModuleTag_HearthHeal
        StartsActive                   = Yes
        HealOnlyIfNotInCombat          = Yes
        HealOnlyIfNotUnderAttack       = Yes
        HealingAmount                  = 30
        Radius                         = 100
        StartHealingDelay              = 7500
        HealingDelay                   = 5000
        UnitHealPulseFX                = FX_SpellHealUnitHealBuff
        NonStackable                   = Yes
        RespawnNearbyHordeMembers      = Yes
        RespawnFXList                  = FX_BannerCarrierSpawnUnit
        RespawnMinimumDelay            = 200
    End

    Behavior = AttributeModifierUpgrade ModuleTag_AMU
        TriggeredBy                = Upgrade_AllFactionUpgrade
        AttributeModifier          = FearlessForever
    End

    Behavior = WeaponSetUpgrade WeaponSetUpgradeModuleTag
        TriggeredBy               = Upgrade_EliteHordeLvl3
    End

    Behavior = StatusBitsUpgrade ForgedBlades_UpgradeDetection
        TriggeredBy                = Upgrade_EliteHordeLvl3
    End

    Behavior = SubObjectsUpgrade ForgedBlades_Upgrade
        TriggeredBy                = Upgrade_EliteHordeLvl3
        ShowSubObjects             = FORGED_BLADE01A FORGED_BLADE02A
    End











    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_TheodenLeadership
        SpecialPowerTemplate          = SpecialAbilityFakeLeadership
    End

    Behavior = SpecialPowerModule ModuleTag_TheodenLeadershipUpdate
        SpecialPowerTemplate          = SpecialAbilityFakeLeadership
        UpdateModuleStartsAttack      = No
        StartsPaused                  = No
    End

    Behavior = AttributeModifierAuraUpdate ModuleTag_Leadership
        StartsActive                  = Yes
        BonusName                     = FormenosElitLeadership
        RefreshDelay                  = 2000
        Range                         = 200
        ObjectFilter                  = GENERIC_BUFF_RECIPIENT_OBJECT_FILTER +HERO
    End





    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_FormenosArmorUpgradeEnabler
        SpecialPowerTemplate          = SpecialAbilityFakeLeadership2
        TriggeredBy                   = Upgrade_EliteHordeLvl5
    End

    Behavior = SpecialPowerModule ModuleTag_FormenosArmorUpgradeStarter
        SpecialPowerTemplate          = SpecialAbilityFakeLeadership2
        UpdateModuleStartsAttack      = Yes
        StartsPaused                  = Yes
    End

    Behavior = ArmorUpgrade ArmorUpgradeModuleTag
        TriggeredBy                   = Upgrade_EliteHordeLvl5
        ArmorSetFlag                  = PLAYER_UPGRADE
    End







    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName  = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName  = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName  = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Behavior = AISpecialPowerUpdate ElvenLorienWarriorHordeCaptureBuildingAI
        CommandButtonName  = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End




    Geometry             = BOX
    GeometryMajorRadius  = 20.0
    GeometryMinorRadius  = 40.0
    GeometryHeight       = 20.0
    GeometryIsSmall      = No





    AutoResolveUnitType             = AutoResolveUnit_Soldier
    AutoResolveCombatChain          = AutoResolve_SoldierCombatChain

    AutoResolveBody                 = AutoResolve_EliteLegndaryHordeBody

    AutoResolveArmor
        Armor                       = AutoResolve_EliteLegndaryInfantryArmor
    End

    AutoResolveWeapon
        Weapon                      = AutoResolve_EliteLegndaryInfantryWeapon
    End
End

ChildObject RohanHelmAxeGuardPeasantHorde RohanHelmAxeGuardHorde

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle 		= STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay 		= STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload 		= RohanHelmAxeGuardPeasant 15
        Slots 			= 15
        PassengerFilter 	= NONE +INFANTRY
        ShowPips 		= No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset 		= X:4 Y:4

        BannerCarriersAllowed    = RohanBanner
        BannerCarrierPosition    = UnitType:RohanHelmAxeGuardPeasant   Pos:X:75.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:RohanHelmAxeGuardPeasant  Position:X:50 Y:0               Position:X:50 Y:20               Position:X:50 Y:-20               Position:X:50 Y:40               Position:X:50 Y:-40
        RankInfo = RankNumber:2 UnitType:RohanHelmAxeGuardPeasant  Position:X:30 Y:0 Leader 1 0    Position:X:30 Y:20 Leader 1 1    Position:X:30 Y:-20 Leader 1 2    Position:X:30 Y:40 Leader 1 3    Position:X:30 Y:-40 Leader 1 4
        RankInfo = RankNumber:3 UnitType:RohanHelmAxeGuardPeasant  Position:X:10 Y:0 Leader 2 0    Position:X:10 Y:20 Leader 2 1    Position:X:10 Y:-20 Leader 2 2    Position:X:10 Y:40 Leader 2 3    Position:X:10 Y:-40 Leader 2 4

        RanksToReleaseWhenAttacking = 1 2 3

        MeleeAttackLeashDistance = 1
        BackUpMinDelayTime       = 1
        BackUpMaxDelayTime       = 3000
        BackUpMinDistance        = 1
        BackUpMaxDistance        = 3
        BackupPercentage         = 80%
    End
End

