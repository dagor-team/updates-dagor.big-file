Object MenegrothGuardHorde

    SelectPortrait         = HPMenegrothGuard
    ButtonImage            = HIMenegrothGuard_Wotr

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR EMOTION_LOOK_TO_SKY
        DefaultModelConditionState
            Model = None
        End
        ModelConditionState = HORDE_EMPTY
            Model = None
        End

        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkGUTow
        End
    End

    Side                             = Lothlorien
    EditorSorting                    = UNIT
    EmotionRange                     = 240
    DisplayName                      = OBJECT:MenegrothGuardHorde
    DisplayNameStrategic             = CONTROLBAR:LW_Unit_MenegrothGuardHorde
    DescriptionStrategic             = CONTROLBAR:LW_ToolTip_MenegrothGuardHorde
    TransportSlotCount               = TRANSPORTSLOTCOUNT_SMALL_HORDE

    BuildCost                         = 1000
    BuildTime                         = FirstAgeHordeBuildtime

    VisionRange                       = 220
    ShroudClearingRange               = 400
    VisionSide                        = 50%
    VisionRear                        = 25%
    MaxVisionBonusPercent             = 300%
    VisionBonusTestRadius             = 200
    VisionBonusPercentPerFoot         = 1.0%

    CrushableLevel                    = 0
    CrusherLevel                      = 0

    CommandSet                        = MenegrothGuardHordeCommandSet
    CommandPoints                     = 80

    WeaponSet
        Conditions                    = None
        Weapon                        = PRIMARY  TowerGuardHordeRangefinder
    End

    FormationWidth = 2
    FormationDepth = 1

    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE ARMY_SUMMARY MELEE_HORDE PIKE LARGE_RECTANGLE_PATHFIND
    CamouflageDetectionMultiplier = CAMOUFLAGE_DETECTION_DISTANCE_LONG

    #include "..\..\..\includes\StandardHordeEvaEvents.inc"

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    ThreatLevel = 175
        ThreatBreakdown GondorTowerShieldGuardHorde_DetailedThreat
        AIKindOf = PIKEMAN
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = PikeHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle     = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate            = 500
        MaxCowerTime                   = 5000
        MinCowerTime                   = 3000
        AILuaEventsList                = InfantryFunctions
        AttackPriority                 = AttackPriority_Spearman
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle         	       = STANDARD_PIKEMAN_FRONTANGLE
        FlankedDelay         	       = STANDARD_PIKEMAN_FLANKEDDELAY
        ObjectStatusOfContained        =
        InitialPayload                 = MenegrothGuard 10
        Slots                          = 10
        PassengerFilter                = NONE +INFANTRY
        ShowPips                       = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset                   = X:0 Y:0
        MeleeBehavior                  = Amoeba
            FacingBonus                = 30.0
            AngleLimitCos              = -0.17
            InnerRange                 = 30
            OuterRange                 = 80
            OuterRangeBuildings        = 140
        End

        BannerCarriersAllowed    = MenegrothGuardBanner
        BannerCarrierPosition    = UnitType:MenegrothGuard    Pos:X:80.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:MenegrothGuard Position:X:50 Y:0        Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:50 Y:40        Position:X:50 Y:-40
        RankInfo = RankNumber:2 UnitType:MenegrothGuard Position:X:30 Y:0 Leader 1 0    Position:X:30 Y:20 Leader 1 1    Position:X:30 Y:-20 Leader 1 2    Position:X:30 Y:40 Leader 1 3    Position:X:30 Y:-40 Leader 1 4

        RanksToReleaseWhenAttacking     = 1 2
        AlternateFormation              = MenegrothGuardHordeShieldWall
        MeleeAttackLeashDistance        = 1
        BackUpMinDelayTime              = 1
        BackUpMaxDelayTime              = 3000
        BackUpMinDistance               = 1
        BackUpMaxDistance               = 3
        BackupPercentage                = 80%
    End

    Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance           = INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay        = 1000
        TauntAndPointExcluded           = NONE
        AfraidOf                       = EMOTION_AFRAIDOF_OBJECTFILTER_LANCERS
        AlwaysAfraidOf                 = EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER_LANCERS
        PointAt                        = EMOTION_POINTAT_OBJECTFILTER_LANCERS
        HeroScanDistance                = 150
        FearScanDistance                = INFANTRY_FEAR_SCAN_RADIUS
        AddEmotion                        = Terror_Base
        AddEmotion                      = Doom_Base
        AddEmotion                      = UncontrollableFear_Base
        AddEmotion                      = FearIdle_Base
        AddEmotion                      = FearBusy_Base
        AddEmotion                      = Point_Base
        AddEmotion                      = OVERRIDE Taunt_Base
        End
        AddEmotion                      = CheerIdle_Base
        AddEmotion                      = CheerBusy_Base
        AddEmotion                      = HeroCheerIdle_Base
        AddEmotion                      = HeroCheerBusy_Base
        AddEmotion                      = Alert_Base
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly               = Yes
        StuffToPickUp                = ANY +CRATE -TheDroppedRing
        ScanRange                    = 200
        ScanIntervalSeconds          = 0.5
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult             = 1.0
    End

    LocomotorSet
        Locomotor = NormalMeleeHordeLocomotor
        Condition = SET_NORMAL
        Speed     = NORMAL_FOOT_MED_HORDE_SPEED
    End

    Behavior = AutoHealBehavior ModuleTag_HearthHeal
        StartsActive                   = No
        HealOnlyIfNotInCombat          = Yes
        HealOnlyIfNotUnderAttack       = Yes
        TriggeredBy                   = Upgrade_EliteHordeLvl2
        HealingAmount                  = 30
        Radius                         = 100
        StartHealingDelay              = 7500
        HealingDelay                   = 5000
        UnitHealPulseFX                = FX_SpellHealUnitHealBuff
        NonStackable                   = Yes
        RespawnNearbyHordeMembers      = Yes
        RespawnFXList                  = FX_BannerCarrierSpawnUnit
        RespawnMinimumDelay            = 200
    End

    Behavior = AttributeModifierUpgrade ModuleTag_AMU
        TriggeredBy                = Upgrade_AllFactionUpgrade
        AttributeModifier          = FearlessForever
    End

    Behavior = WeaponSetUpgrade WeaponSetUpgradeModuleTag
        TriggeredBy               = Upgrade_FormenosForgedBlades
    End

    Behavior = StatusBitsUpgrade ForgedBlades_UpgradeDetection
        TriggeredBy                = Upgrade_FormenosForgedBlades
    End

    Behavior = SubObjectsUpgrade ModuleTag_MakingThebla
        TriggeredBy                = Upgrade_AllFactionUpgrade
        HideSubObjects             = FORGED_BLADE
    End

    Behavior = SubObjectsUpgrade ForgedBlades_Upgrade
        TriggeredBy                = Upgrade_FormenosForgedBlades
        ShowSubObjects             = FORGED_BLADE
    End


    Behavior = InvisibilityUpdate ModuleTag_ElvenCloak
        InvisibilityNugget
            InvisibilityType           = STEALTH
            ForbiddenConditions        = MOVING FIRING_ANY TAKING_DAMAGE
            BecomeStealthedFX          = FX_ElvenCloakOn
            ExitStealthFX              = FX_ElvenCloakOff
            Options                    = UNTOGGLE_HIDDEN_WHEN_LEAVING_STEALTH
        End
        StartsActive                   = Yes
        UpdatePeriod                   = 2000
    End



    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_DreadVisageLeadership
        SpecialPowerTemplate               = SpecialAbilityFakeLeadership
        TriggeredBy                        = Upgrade_EliteHordeLvl2
    End

    Behavior = SpecialPowerModule ModuleTag_DreadVisageUpdate
        SpecialPowerTemplate               = SpecialAbilityFakeLeadership
        UpdateModuleStartsAttack           = No
        StartsPaused                       = Yes
    End

    Behavior = AttributeModifierAuraUpdate ModuleTag_DreadVisage
        StartsActive                       = No
        BonusName                          = FormenosGuardArmorRupture
        TriggeredBy                        = Upgrade_EliteHordeLvl2
        RefreshDelay                       = 2000
        Range                              = 200
        TargetEnemy                        = Yes
        AntiCategory                       = LEADERSHIP BUFF
        ObjectFilter                       = ANY -INFANTRY +CAVALRY -STRUCTURE -BASE_FOUNDATION -HERO
    End





    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_FormenosArmorUpgradeEnabler
        SpecialPowerTemplate               = SpecialAbilityFakeLeadership2
        TriggeredBy                        = Upgrade_EliteHordeLvl5
    End

    Behavior = SpecialPowerModule ModuleTag_FormenosArmorUpgradeStarter
        SpecialPowerTemplate               = SpecialAbilityFakeLeadership2
        UpdateModuleStartsAttack           = Yes
        StartsPaused                       = Yes
    End

    Behavior = ArmorUpgrade ArmorUpgradeModuleTag
        TriggeredBy                        = Upgrade_EliteHordeLvl5
        ArmorSetFlag                       = PLAYER_UPGRADE
    End







    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName  = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName  = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName  = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Behavior = AISpecialPowerUpdate ElvenLorienWarriorHordeCaptureBuildingAI
        CommandButtonName  = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End




    Geometry            = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 45.0
    GeometryHeight      = 20.0
    GeometryIsSmall     = No





    AutoResolveUnitType            = AutoResolveUnit_Pikemen
    AutoResolveCombatChain         = AutoResolve_PikemenCombatChain

    AutoResolveBody               = AutoResolve_EliteLegndaryHordeBody

    AutoResolveArmor
        Armor                      = AutoResolve_EliteLegndaryPikemanArmor
    End

    AutoResolveWeapon
        Weapon                     = AutoResolve_EliteLegndaryPikemanWeapon
    End
End


ChildObject MenegrothGuardHordeShieldWall MenegrothGuardHorde

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle         = STANDARD_PIKEMAN_FRONTANGLE
        FlankedDelay         = STANDARD_PIKEMAN_FLANKEDDELAY
        ObjectStatusOfContained         =
        InitialPayload                  = MenegrothGuard 10
        Slots                           = 10
        PassengerFilter                 = NONE +INFANTRY
        ShowPips                        = No
        ThisFormationIsTheMainFormation = No
        AttributeModifiers              = FormenosGuardShieldWallBonus
        RandomOffset                    = X:0 Y:0
        MeleeBehavior                    = Amoeba
    End

        BannerCarriersAllowed            = MenegrothGuardBanner
        BannerCarrierPosition            = UnitType:MenegrothGuard    Pos:X:25.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:MenegrothGuard Position:X:0 Y:0    Position:X:0 Y:12.5        Position:X:0 Y:-12.5        Position:X:0 Y:25        Position:X:0 Y:-25
        RankInfo = RankNumber:2 UnitType:MenegrothGuard Position:X:-12.5 Y:0  Position:X:-12.5 Y:12.5        Position:X:-12.5 Y:-12.5        Position:X:-12.5 Y:25        Position:X:-12.5 Y:-25

        RanksToReleaseWhenAttacking    = 1 2
        AlternateFormation             = MenegrothGuardHorde
        MeleeAttackLeashDistance       = 1
        BackUpMinDelayTime             = 1
        BackUpMaxDelayTime             = 3000
        BackUpMinDistance              = 1
        BackUpMaxDistance              = 3
        BackupPercentage               = 80%
    End
End


Object MenegrothEliteHorde

    SelectPortrait = HPMenegrothElite
    ButtonImage    = HIMenegrothElite_Wotr


    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags     = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR
        DefaultModelConditionState
            Model         = None
        End
        ModelConditionState     = HORDE_EMPTY
            Model         = None
        End
        ModelConditionState     = WORLD_BUILDER
            Model         = HordeMarkEULoW
        End
    End

    Side                              = Lothlorien
    EditorSorting                     = UNIT
    EmotionRange                      = 240
    DisplayName                       = OBJECT:MenegrothEliteHorde
    DisplayNameStrategic              = CONTROLBAR:LW_Unit_MenegrothEliteHorde
    DescriptionStrategic              = CONTROLBAR:LW_ToolTip_MenegrothEliteHorde
    TransportSlotCount                = TRANSPORTSLOTCOUNT_SMALL_HORDE

    BuildCost                         = 1000
    BuildTime                         = FirstAgeHordeBuildtime

    CrushableLevel                    = 0
    CrusherLevel                      = 0
    CrushRevengeWeapon                = SuperInfantryCrushRevenge

    VisionRange                       = 200
    VisionSide                        = 50%
    VisionRear                        = 25%
    VisionBonusPercentPerFoot         = 1.0%
    ShroudClearingRange               = 400

    CommandSet                        = MenegrothEliteHordeCommandSet
    CommandPoints                     = 60

    WeaponSet
        Conditions                    = None
        Weapon                        = PRIMARY  NormalMeleeHordeRangefinder
    End

    FormationWidth = 2
    FormationDepth = 1

    #include "..\..\..\includes\StandardHordeEvaEvents.inc"

    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE ARMY_SUMMARY MELEE_HORDE LARGE_RECTANGLE_PATHFIND
    CamouflageDetectionMultiplier = CAMOUFLAGE_DETECTION_DISTANCE_LONG

    ThreatLevel = 175
        ThreatBreakdown ElvenLorienWarriorHorde_DetailedThreat
        AIKindOf = INFANTRY
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = FighterHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle    = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate           = 500
        MaxCowerTime                  = 5000
        MinCowerTime                  = 3000
        CanAttackWhileContained       = Yes
        AILuaEventsList               = InfantryFunctions
        AttackPriority                = AttackPriority_Archer
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle         		= STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay         		= STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained         =
        InitialPayload                  = MenegrothElite 10
        Slots                           = 10
        PassengerFilter                 = NONE +INFANTRY
        ShowPips                        = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset                    = X:0 Y:0
        MeleeBehavior                   = Amoeba
        End

        BannerCarriersAllowed           = MenegrothBanner
        BannerCarrierPosition           = UnitType:MenegrothElite    Pos:X:40.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:MenegrothElite Position:X:0 Y:0    Position:X:0 Y:25    Position:X:0 Y:-25    Position:X:0 Y:50    Position:X:0 Y:-50
        RankInfo = RankNumber:2 UnitType:MenegrothElite Position:X:20 Y:0    Position:X:20 Y:25    Position:X:20 Y:-25    Position:X:20 Y:50    Position:X:20 Y:-50

        RanksToReleaseWhenAttacking     = 1 2
        AlternateFormation              = MenegrothEliteHordeBlock
        MeleeAttackLeashDistance        = 1
        BackUpMinDelayTime              = 1
        BackUpMaxDelayTime              = 3000
        BackUpMinDistance               = 1
        BackUpMaxDistance               = 3
        BackupPercentage                = 80%
    End

    Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance         = INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay      = 1000
        TauntAndPointExcluded         = NONE
        AfraidOf                      = EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf                = EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
        PointAt                       = EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance              = 150
        FearScanDistance              = ARCHER_FEAR_SCAN_RADIUS
        AddEmotion                = Terror_Base
        AddEmotion                = Doom_Base
        AddEmotion                = BraceForBeingCrushed_Base
        AddEmotion                = UncontrollableFear_Base
        AddEmotion                = FearIdle_Base
        AddEmotion                = FearBusy_Base
        AddEmotion                = Point_Base
        AddEmotion                = Taunt_Base
        AddEmotion                = CheerIdle_Base
        AddEmotion                = CheerBusy_Base
        AddEmotion                = HeroCheerIdle_Base
        AddEmotion                = HeroCheerBusy_Base
        AddEmotion                = Alert_Base
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly               = Yes
        StuffToPickUp                = ANY +CRATE -TheDroppedRing
        ScanRange                    = 200
        ScanIntervalSeconds          = 0.5
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult             = 1.0
    End

    LocomotorSet
        Locomotor = NormalMeleeHordeLocomotor
        Condition = SET_NORMAL
        Speed     = 58
    End

    Behavior = InvisibilityUpdate ModuleTag_ElvenCloak
        InvisibilityNugget
            InvisibilityType           = STEALTH
            ForbiddenConditions        = FIRING_ANY TAKING_DAMAGE
            BecomeStealthedFX          = FX_ElvenCloakOn
            ExitStealthFX              = FX_ElvenCloakOff
            Options                    = UNTOGGLE_HIDDEN_WHEN_LEAVING_STEALTH
        End
        StartsActive                   = Yes
        UpdatePeriod                   = 2000
    End

    Behavior = AttributeModifierUpgrade ModuleTag_AMU
        TriggeredBy                = Upgrade_AllFactionUpgrade
        AttributeModifier          = FearlessForever
    End

    Behavior = WeaponSetUpgrade WeaponSetUpgradeModuleTag
        TriggeredBy               = Upgrade_EliteHordeLvl5
    End

    Behavior = StatusBitsUpgrade ForgedBlades_UpgradeDetection
        TriggeredBy                = Upgrade_EliteHordeLvl5
    End

    Behavior = SubObjectsUpgrade ModuleTag_MakingThebla
        TriggeredBy                = Upgrade_AllFactionUpgrade
        HideSubObjects             = FORGED_BLADE01 FORGED_BLADE
    End

    Behavior = SubObjectsUpgrade ForgedBlades_Upgrade
        TriggeredBy                = Upgrade_EliteHordeLvl5
        ShowSubObjects             = FORGED_BLADE01 FORGED_BLADE
    End











    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy                    = Upgrade_EliteHordeLvl3
    End

    Behavior = SpecialPowerModule ModuleTag_ElfCloakStarter
        SpecialPowerTemplate           = SpecialAbilityElfCloak
        UpdateModuleStartsAttack       = Yes
        StartsPaused                   = No
    End

    Behavior = ToggleHiddenSpecialAbilityUpdate ModuleTag_ElfCloakUpdate
        SpecialPowerTemplate           = SpecialAbilityElfCloak
    End

    Behavior = InvisibilityUpdate ModuleTag_ElvenCloakPowerLevel3
        InvisibilityNugget
            InvisibilityType           = STEALTH
            ForbiddenConditions        = FIRING_ANY TAKING_DAMAGE
            BecomeStealthedFX          = FX_ElvenCloakOn
            ExitStealthFX              = FX_ElvenCloakOff
            Options                    = UNTOGGLE_HIDDEN_WHEN_LEAVING_STEALTH
        End
        StartsActive                   = No
        UpdatePeriod                   = 2000
    End





    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_FormenosArmorUpgradeEnabler
        SpecialPowerTemplate          = SpecialAbilityFakeLeadership2
        TriggeredBy                   = Upgrade_EliteHordeLvl5
    End

    Behavior = SpecialPowerModule ModuleTag_FormenosArmorUpgradeStarter
        SpecialPowerTemplate          = SpecialAbilityFakeLeadership2
        UpdateModuleStartsAttack      = Yes
        StartsPaused                  = Yes
    End

    Behavior = ArmorUpgrade ArmorUpgradeModuleTag
        TriggeredBy                   = Upgrade_EliteHordeLvl5
        ArmorSetFlag                  = PLAYER_UPGRADE
    End





    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_SpionageEnabler
        SpecialPowerTemplate          = SpecialAbilityMenegrothSpionage
        TriggeredBy                   = Upgrade_EliteHordeLvl7
    End

    Behavior = SpecialPowerModule ModuleTag_SpionagePower
        SpecialPowerTemplate          = SpecialAbilityMenegrothSpionage
        UpdateModuleStartsAttack      = Yes
        StartsPaused                  = Yes
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_SpionageUpdate
        SpecialPowerTemplate          = SpecialAbilityMenegrothSpionage
        SkipContinue                  = Yes
        UnpackTime                    = 1500
        PreparationTime               = 1
        PersistentPrepTime            = 1000
        PackTime                      = 500
        AwardXPForTriggering          = 0
        StartAbilityRange             = 290
        ApproachRequiresLOS           = Yes
        SpecialWeapon                 = MenegrothEliteSpionageWeapon
        MustFinishAbility             = Yes
        WhichSpecialWeapon            = 3
        BusyForDuration               = 2500
    End







    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName  = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName  = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName  = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Behavior = AISpecialPowerUpdate ElvenLorienWarriorHordeCaptureBuildingAI
        CommandButtonName  = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Geometry         = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 50.0
    GeometryHeight     = 20.0
    GeometryIsSmall     = No

    AutoResolveUnitType             = AutoResolveUnit_Soldier
    AutoResolveCombatChain          = AutoResolve_SoldierCombatChain

    AutoResolveBody                 = AutoResolve_EliteLegndaryHordeBody

    AutoResolveArmor
        Armor                       = AutoResolve_EliteLegndaryInfantryArmor
    End

    AutoResolveWeapon
        Weapon                      = AutoResolve_EliteLegndaryInfantryWeapon
    End
End


ChildObject MenegrothEliteHordeBlock MenegrothEliteHorde

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle         = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay         = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained         =
        InitialPayload                  = MenegrothElite 10
        Slots                           = 10
        PassengerFilter                 = NONE +INFANTRY
        ShowPips                        = No
        ThisFormationIsTheMainFormation = No
        AttributeModifiers              = MenegrothEliteBlockBonus
        MeleeBehavior                   = Amoeba
        End

        BannerCarriersAllowed            = MenegrothBanner
        BannerCarrierPosition            = UnitType:MenegrothElite    Pos:X:0.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:MenegrothElite Position:X:70 Y:0    Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:30 Y:30        Position:X:30 Y:-30
        RankInfo = RankNumber:2 UnitType:MenegrothElite Position:X:10 Y:30 Leader 1 0    Position:X:10 Y:-30 Leader 1 1    Position:X:-10 Y:20 Leader 1 2    Position:X:-10 Y:-20 Leader 1 3    Position:X:-30 Y:0 Leader 1 4

        RanksToReleaseWhenAttacking   = 1 2
        AlternateFormation            = MenegrothEliteHorde
        MeleeAttackLeashDistance      = 1
        BackUpMinDelayTime            = 1
        BackUpMaxDelayTime            = 3000
        BackUpMinDistance             = 1
        BackUpMaxDistance             = 3
        BackupPercentage              = 80%
    End
End


Object MenegrothCavalaryHorde

    SelectPortrait = HPMenegrothCavalary
    ButtonImage    = HIMenegrothCavalary_Wotr

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR EMOTION_LOOK_TO_SKY
        DefaultModelConditionState
            Model = None
        End

        ModelConditionState = HORDE_EMPTY
            Model = None
        End

        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkGUKni
        End
    End

    Side                             = Lothlorien
    EditorSorting                    = UNIT
    EmotionRange                     = 240
    DisplayName                      = OBJECT:MenegrothCavalaryHorde
    DisplayNameStrategic             = CONTROLBAR:LW_Unit_MenegrothCavalaryHorde
    DescriptionStrategic             = CONTROLBAR:LW_ToolTip_MenegrothCavalaryHorde
    TransportSlotCount               = TRANSPORTSLOTCOUNT_SMALL_HORDE

    BuildCost                        = 1400
    BuildTime                        = FirstAgeHordeBuildtime

    VisionRange                      = 200
    ShroudClearingRange              = 400
    VisionSide                       = 35%
    VisionRear                       = 25%
    MaxVisionBonusPercent            = 300%
    VisionBonusTestRadius            = 250
    VisionBonusPercentPerFoot        = 2.0%

    CrushableLevel                   = 2
    CrusherLevel                     = 1
    MinCrushVelocityPercent = MINCRUSHVELOCITYPERCENT_STANDARD
    CrushDecelerationPercent = CRUSHDECELERATIONPERCENT_STANDARD
    CrushKnockback                   = 40
    CrushZFactor                     = 1.0

    CommandSet                       = MenegrothCavalaryHordeCommandSet
    CommandPoints                    = 80

    WeaponSet
        Conditions                 = None
        Weapon                     = PRIMARY  NormalMeleeHordeRangefinder
    End

    FormationWidth = 2
    FormationDepth = 1

    #include "..\..\..\includes\StandardHordeEvaEvents.inc"

    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT CAVALRY HORDE MELEE_HORDE ARMY_SUMMARY LARGE_RECTANGLE_PATHFIND
    CamouflageDetectionMultiplier = CAMOUFLAGE_DETECTION_DISTANCE_LONG

    ThreatLevel = 175
    ThreatBreakdown GondorKnightHorde_DetailedThreat
        AIKindOf = CAVALRY
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = CavalryHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle      = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate             = 500
        MaxCowerTime                    = 5000
        MinCowerTime                    = 3000
        AILuaEventsList                 = CavalryFunctions
        AttackPriority                  = AttackPriority_Cavalry
    End

    Behavior = HorseHordeContain ModuleTag_HordeContain
        FrontAngle         = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay         = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained         =
        InitialPayload                  = MenegrothCavalary  10
        Slots                           = 10
        PassengerFilter                 = NONE +CAVALRY
        ShowPips                        = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset                    = X:0 Y:0
        MeleeBehavior                   = Amoeba
        End

        BannerCarriersAllowed        = MenegrothCavalaryBanner
        BannerCarrierPosition        = UnitType:MenegrothCavalary Pos:X:70.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:MenegrothCavalary Position:X:40 Y:0   Position:X:40 Y:20   Position:X:40 Y:-20   Position:X:40 Y:40        Position:X:40 Y:-40
        RankInfo = RankNumber:2 UnitType:MenegrothCavalary Position:X:10 Y:0 Leader 1 0  Position:X:10 Y:20 Leader 1 1   Position:X:10 Y:-20 Leader 1 2    Position:X:10 Y:40 Leader 1 3  Position:X:10 Y:-40 Leader 1 4

        RanksToReleaseWhenAttacking     = 1 2
        AlternateFormation              = MenegrothCavalaryHordeWedgeFormation
        MeleeAttackLeashDistance        = 1
        BackUpMinDelayTime              = 1
        BackUpMaxDelayTime              = 3000
        BackUpMinDistance              = 1
        BackUpMaxDistance               = 3
        BackupPercentage                = 80%
    End

    Behavior = HordeNotifyTargetsOfImminentProbableCrushingUpdate ModuleTag_NotifyCrushScan
        ScanWidth             = 70.0
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult             = 1.0
    End

    Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance            = INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay        = 1000
        TauntAndPointExcluded           = NONE
        AfraidOf                        = EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf                  = EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
        PointAt                         = EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance               = 150
        FearScanDistance                = INFANTRY_FEAR_SCAN_RADIUS
        AddEmotion                    = Terror_Base
        AddEmotion                    = Doom_Base
        AddEmotion                    = BraceForBeingCrushed_Base
        AddEmotion                    = UncontrollableFear_Base
        AddEmotion                    = FearIdle_Base
        AddEmotion                    = FearBusy_Base
        AddEmotion                    = Point_Base
        AddEmotion                    = Taunt_Base
        AddEmotion                    = CheerIdle_Base
        AddEmotion                    = CheerBusy_Base
        AddEmotion                    = HeroCheerIdle_Base
        AddEmotion                    = HeroCheerBusy_Base
        AddEmotion                    = Alert_Base
        AddEmotion                    = CheerForAboutToCrush_Base
     End

    LocomotorSet
        Locomotor  = NormalCavalryHordeLocomotor
        Condition  = SET_NORMAL
        Speed      = NORMAL_MOUNTED_VERYFAST_HORDE_SPEED
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP             = Yes
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly             = Yes
        StuffToPickUp              = ANY +CRATE -TheDroppedRing
        ScanRange                  = 200
        ScanIntervalSeconds         = 0.5
    End

    Behavior = AutoHealBehavior ModuleTag_HearthHeal
        StartsActive                   = No
        HealOnlyIfNotInCombat          = Yes
        HealOnlyIfNotUnderAttack       = Yes
        TriggeredBy                    = Upgrade_EliteHordeLvl2
        HealingAmount                  = 30
        Radius                         = 100
        StartHealingDelay              = 7500
        HealingDelay                   = 5000
        UnitHealPulseFX                = FX_SpellHealUnitHealBuff
        NonStackable                   = Yes
        RespawnNearbyHordeMembers      = Yes
        RespawnFXList                  = FX_BannerCarrierSpawnUnit
        RespawnMinimumDelay            = 200
    End

    Behavior = AttributeModifierUpgrade ModuleTag_AMU
        TriggeredBy                = Upgrade_AllFactionUpgrade
        AttributeModifier          = FearlessForever
    End

    Behavior = WeaponSetUpgrade WeaponSetUpgradeModuleTag
        TriggeredBy               = Upgrade_FormenosForgedBlades
    End

    Behavior = StatusBitsUpgrade ForgedBlades_UpgradeDetection
        TriggeredBy                = Upgrade_FormenosForgedBlades
    End

    Behavior = SubObjectsUpgrade ModuleTag_MakingThebla
        TriggeredBy                = Upgrade_AllFactionUpgrade
        HideSubObjects             = FORGED_BLADE
    End

    Behavior = SubObjectsUpgrade ForgedBlades_Upgrade
        TriggeredBy                = Upgrade_FormenosForgedBlades
        ShowSubObjects             = FORGED_BLADE
    End











    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_FormenosArmorUpgradeEnabler
        SpecialPowerTemplate               = SpecialAbilityFakeLeadership2
        TriggeredBy                        = Upgrade_EliteHordeLvl5
    End

    Behavior = SpecialPowerModule ModuleTag_FormenosArmorUpgradeStarter
        SpecialPowerTemplate               = SpecialAbilityFakeLeadership2
        UpdateModuleStartsAttack           = Yes
        StartsPaused                       = Yes
    End

    Behavior = ArmorUpgrade ArmorUpgradeModuleTag
        TriggeredBy                        = Upgrade_EliteHordeLvl5
        ArmorSetFlag                       = PLAYER_UPGRADE
    End




    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName  = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName  = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName  = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Behavior = AISpecialPowerUpdate ElvenLorienWarriorHordeCaptureBuildingAI
        CommandButtonName  = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Geometry            = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 40.0
    GeometryHeight      = 20.0
    GeometryIsSmall     = No


    AutoResolveUnitType             = AutoResolveUnit_Cavalry
    AutoResolveCombatChain          = AutoResolve_CavalryCombatChain

    AutoResolveBody                 = AutoResolve_EliteLegndaryHordeBody

    AutoResolveArmor
        Armor                       = AutoResolve_EliteLegndaryCavalaryArmor
    End

    AutoResolveWeapon
        Weapon                      = AutoResolve_EliteLegndaryCavalaryWeapon
    End
End


ChildObject MenegrothCavalaryHordeWedgeFormation MenegrothCavalaryHorde

    Behavior = HorseHordeContain ModuleTag_HordeContain
        FrontAngle         = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay         = STANDARD_INFANTRY_FLANKEDDELAY
        AttributeModifiers              = MenegrothCavalarySkirmishFormation
        ObjectStatusOfContained         =
        InitialPayload                  = MenegrothCavalary 10
        Slots                           = 10
        PassengerFilter                 = NONE +CAVALRY +MenegrothCavalaryBanner
        ShowPips                        = No
        ThisFormationIsTheMainFormation = No
        RandomOffset                    = X:0 Y:0
        MeleeBehavior                   = Amoeba
        End

        BannerCarriersAllowed        = MenegrothCavalaryBanner
        BannerCarrierPosition        = UnitType:MenegrothCavalary    Pos:X:65.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:MenegrothCavalary Position:X:40 Y:0       Position:X:40 Y:20               Position:X:40 Y:-20
        RankInfo = RankNumber:2 UnitType:MenegrothCavalary Position:X:15 Y:10 Leader 1 0   Position:X:15 Y:-10 Leader 1 1   Position:X:15 Y:30 Leader 1 2   Position:X:15 Y:-30
        RankInfo = RankNumber:3 UnitType:MenegrothCavalary Position:X:-10 Y:0 Leader 2 0   Position:X:-10 Y:20 Leader 2 1   Position:X:-10 Y:-20 Leader 2 2
        RanksToReleaseWhenAttacking     = 1 2 3
        AlternateFormation              = MenegrothCavalaryHorde
        MeleeAttackLeashDistance        = 1
        BackUpMinDelayTime              = 1
        BackUpMaxDelayTime              = 3000
        BackUpMinDistance               = 1
        BackUpMaxDistance               = 3
        BackupPercentage                = 80%
    End
End

Object AlqualondeGuardianHorde

    SelectPortrait = HPAlqualondeGuardian
    ButtonImage    = HIAlqualondeGuardian_Wotr

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR EMOTION_CELEBRATING
        DefaultModelConditionState
            Model = None
        End
        ModelConditionState = HORDE_EMPTY
            Model = None
        End
        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkMUHLa
        End
    End

    Side                             = Lothlorien
    EditorSorting                    = UNIT
    EmotionRange                     = 240
    DisplayName                      = OBJECT:AlqualondeGuardianHorde
    DisplayNameStrategic             = CONTROLBAR:LW_Unit_AlqualondeGuardianHorde
    DescriptionStrategic             = CONTROLBAR:LW_ToolTip_AlqualondeGuardianHorde

    BuildCost                       = 1400
    BuildTime                       = FirstAgeHordeBuildtime

    VisionRange                         = 200
    ShroudClearingRange                 = 500
    VisionSide                          = 35%
    VisionRear                          = 25%
    MaxVisionBonusPercent               = 300%
    VisionBonusTestRadius               = 250
    VisionBonusPercentPerFoot           = 2.0%

    CrushableLevel                  = 2
    MountedCrusherLevel             = 1
    MountedCrushableLevel           = 3
    CrushWeapon                     = FirstAgeHeroCrush
    MinCrushVelocityPercent = MINCRUSHVELOCITYPERCENT_STANDARD
    CrushDecelerationPercent = CRUSHDECELERATIONPERCENT_STANDARD
    RamPower                        = 30
    RamZMult                        = 0.5
    ShockwaveResistance             = 60

    CommandSet                       = AlqualondeGuardianHordeCommandSet
    CommandPoints                   = 50

    WeaponSet
        Conditions    = None
        Weapon        = PRIMARY    TowerGuardHordeRangefinder
    End

    WeaponSet
        Conditions    = MOUNTED
        Weapon        = PRIMARY    NormalMeleeHordeRangefinder
    End

    FormationWidth              = 2
    FormationDepth              = 1

    TransportSlotCount          = TRANSPORTSLOTCOUNT_SMALL_HORDE

    #include "..\..\..\includes\StandardHordeEvaEvents.inc"

    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT CAVALRY INFANTRY HORDE MELEE_HORDE ARMY_SUMMARY LARGE_RECTANGLE_PATHFIND
    CamouflageDetectionMultiplier = CAMOUFLAGE_DETECTION_DISTANCE_LONG

    ThreatLevel = 150
    ThreatBreakdown ElvenRivendellLancerHorde_DetailedThreat
        AIKindOf = CAVALRY
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = Hero
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate        = 500
        MaxCowerTime               = 5000
        MinCowerTime               = 3000
        AILuaEventsList                 = InfantryFunctions
        AttackPriority                  = AttackPriority_Cavalry
    End

    Behavior = HorseHordeContain ModuleTag_HordeContain
        FrontAngle = STANDARD_PIKEMAN_FRONTANGLE
        FlankedDelay = STANDARD_PIKEMAN_FLANKEDDELAY
        ObjectStatusOfContained     =
        InitialPayload              = AlqualondeGuardian 5
        Slots                       = 5
        PassengerFilter             = NONE +AlqualondeGuardian +AlqualondeGuardianBanner +CAVALRY
        ShowPips                    = No
        RandomOffset                = X:1 y:1
        MeleeBehavior               = Amoeba
        End

        BannerCarriersAllowed        = AlqualondeGuardianBanner
        BannerCarrierPosition        = UnitType:AlqualondeGuardian    Pos:X:20.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:AlqualondeGuardian Position:X:0 Y:0   Position:X:0 Y:20   Position:X:0 Y:-20   Position:X:0 Y:40    Position:X:0 Y:-40

        ThisFormationIsTheMainFormation = Yes
        AlternateFormation         = AlqualondeGuardianHordeMount
        RanksToReleaseWhenAttacking     = 1
        MeleeAttackLeashDistance         = 1
        BackUpMinDelayTime            = 1
        BackUpMaxDelayTime            = 3000
        BackUpMinDistance            = 1
        BackUpMaxDistance            = 3
        BackupPercentage            = 80%
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = AutoHealBehavior ModuleTag_HearthHeal
        StartsActive                   = No
        HealOnlyIfNotInCombat          = Yes
        HealOnlyIfNotUnderAttack       = Yes
        TriggeredBy                    = Upgrade_EliteHordeLvl2
        HealingAmount                  = 30
        Radius                         = 100
        StartHealingDelay              = 7500
        HealingDelay                   = 5000
        UnitHealPulseFX                = FX_SpellHealUnitHealBuff
        NonStackable                   = Yes
        RespawnNearbyHordeMembers      = Yes
        RespawnFXList                  = FX_BannerCarrierSpawnUnit
        RespawnMinimumDelay            = 200
    End

    Behavior = NotifyTargetsOfImminentProbableCrushingUpdate ModuleTag_NotifyCrushScan
    End

    LocomotorSet
        Locomotor = NormalMeleeHordeLocomotor
        Condition = SET_NORMAL
        Speed     = 55
    End

    LocomotorSet
        Locomotor = NormalCavalryHordeLocomotor
        Condition = SET_NORMAL_UPGRADED
        Speed     = NORMAL_MOUNTED_VERYFAST_HORDE_SPEED
    End

    LocomotorSet
        Locomotor = NormalCavalryHordeLocomotor
        Condition = SET_MOUNTED
        Speed     = NORMAL_MOUNTED_VERYFAST_HORDE_SPEED
    End

    Behavior = AttributeModifierUpgrade ModuleTag_AMU
        TriggeredBy                    = Upgrade_AllFactionUpgrade
        AttributeModifier              = FearlessForever
    End

    Behavior = WeaponSetUpgrade WeaponSetUpgradeModuleTag
        TriggeredBy                   = Upgrade_FormenosForgedBlades
    End

    Behavior = StatusBitsUpgrade ForgedBlades_UpgradeDetection
        TriggeredBy                    = Upgrade_FormenosForgedBlades
    End

    Behavior = SubObjectsUpgrade ModuleTag_MakingThebla
        TriggeredBy                    = Upgrade_EliteHordeLvl1
        HideSubObjects                 = FORGED_BLADE
    End

    Behavior = SubObjectsUpgrade ForgedBlades_Upgrade
        TriggeredBy                    = Upgrade_FormenosForgedBlades
        ShowSubObjects                 = FORGED_BLADE
    End











    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_FormenosArmorUpgradeEnabler
        SpecialPowerTemplate               = SpecialAbilityFakeLeadership2
        TriggeredBy                        = Upgrade_EliteHordeLvl5
    End

    Behavior = SpecialPowerModule ModuleTag_FormenosArmorUpgradeStarter
        SpecialPowerTemplate               = SpecialAbilityFakeLeadership2
        UpdateModuleStartsAttack           = Yes
        StartsPaused                       = Yes
    End

    Behavior = ArmorUpgrade ArmorUpgradeModuleTag
        TriggeredBy                        = Upgrade_EliteHordeLvl5
        ArmorSetFlag                       = PLAYER_UPGRADE
    End





    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_TheodenGloriousChargeEnabler
    SpecialPowerTemplate         = SpecialAbilityTheodenGloriousCharge
    TriggeredBy             = Upgrade_EliteHordeLvl8
        ObeyRechageOnTrigger            = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_TheodenGloriousChargeUpdate
    SpecialPowerTemplate        = SpecialAbilityTheodenGloriousCharge
    UpdateModuleStartsAttack    = Yes
    StartsPaused             = Yes
    AttributeModifier         = AlqualondeGuardianCharge
    AttributeModifierAffectsSelf     = Yes
    AttributeModifierFX         = FX_TheodenGloriousChargeFX
    InitiateSound            = KnightsDolAmrothGloriousCharge
    End

    Behavior = SpecialAbilityUpdate ModuleTag_GloriousChargeAnimation
    UnpackTime                  = 1000
    UnpackingVariation        = 1
    SpecialPowerTemplate        = SpecialAbilityTheodenGloriousCharge
     PreparationTime             = 0
     PersistentPrepTime          = 0
     PackTime                    = 1330
    End







    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName  = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName  = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName  = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Behavior = AISpecialPowerUpdate ElvenLorienWarriorHordeCaptureBuildingAI
        CommandButtonName  = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate AragornBladeMasterAI
        CommandButtonName = Command_AlqualondeGuardianCharge
        SpecialPowerAIType = AI_SPECIAL_POWER_BASIC_SELF_BUFF
    End


    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 40.0
    GeometryHeight = 20.0
    GeometryIsSmall = No


    AutoResolveUnitType             = AutoResolveUnit_Pikemen
    AutoResolveCombatChain          = AutoResolve_PikemenCombatChain

    AutoResolveBody                 = AutoResolve_EliteLegndaryHordeBody

    AutoResolveArmor
        Armor                       = AutoResolve_EliteLegndaryInfantryArmor
    End

    AutoResolveWeapon
        Weapon                      = AutoResolve_EliteLegndaryInfantryWeapon
    End
End


ChildObject AlqualondeGuardianHordeMount AlqualondeGuardianHorde

    Behavior = HorseHordeContain ModuleTag_HordeContain
        FrontAngle = STANDARD_PIKEMAN_FRONTANGLE
        FlankedDelay = STANDARD_PIKEMAN_FLANKEDDELAY
        ObjectStatusOfContained     =
        InitialPayload              = AlqualondeGuardian 5
        Slots                       = 5
        PassengerFilter             = NONE +AlqualondeGuardian +AlqualondeGuardianBanner +CAVALRY
        ShowPips                    = No
        RandomOffset                = X:1 y:1
        AttributeModifiers          = MordorNazgulMountBonus
        MeleeBehavior               = Amoeba
        End

        BannerCarriersAllowed        = AlqualondeGuardianBanner
        BannerCarrierPosition        = UnitType:AlqualondeGuardian    Pos:X:30.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:AlqualondeGuardian Position:X:0 Y:0   Position:X:0 Y:20   Position:X:0 Y:-20   Position:X:0 Y:40    Position:X:0 Y:-40

        ThisFormationIsTheMainFormation = No
        AlternateFormation         = AlqualondeGuardianHorde
        RanksToReleaseWhenAttacking     = 1
        MeleeAttackLeashDistance         = 1
        BackUpMinDelayTime            = 1
        BackUpMaxDelayTime            = 3000
        BackUpMinDistance            = 1
        BackUpMaxDistance            = 3
        BackupPercentage            = 80%
    End

    LocomotorSet
        Locomotor = NormalCavalryHordeLocomotor
        Condition = SET_NORMAL
        Speed     = NORMAL_MOUNTED_VERYFAST_HORDE_SPEED
    End
End