Object ElvenLorienArcherHorde

    ButtonImage		= UPLorienArcher_NewModel ;UILorienArchers_NewModel
    SelectPortrait	= UPLorienArcher_NewModel

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR
        DefaultModelConditionState
            Model = None
        End
        ModelConditionState = HORDE_EMPTY
            Model = None
        End
        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkEULoW
        End
    End

    Side = Lothlorien
    EditorSorting = UNIT
    EmotionRange = 240
    DisplayName = OBJECT:ElvenLorienArcher
    DisplayNameStrategic = CONTROLBAR:LW_Unit_ElvenLorienArcherHorde
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_ElvenLorienArcherHorde

    WeaponSet
	Conditions = None
	Weapon = PRIMARY     LorienArcherMissileHordeRangefinder
	Weapon = TERTIARY    LorienArcherMissileHordeRangefinderBombard
	AutoChooseSources = TERTIARY FROM_PLAYER FROM_SCRIPT
    End

    CommandSet = ElvenLorienArcherHordeCommandSet_Edain




    #include "..\..\..\includes\StandardHordeEvaEvents.inc"

    CrushableLevel   = 0
    CrusherLevel     = 0
    UseCrushAttack   = No

    BuildCost      = 400
    BuildTime      = MEDIUM_BUILDTIME
    VisionRange    = 410
    VisionSide     = 50%
    VisionRear     = 25%
    VisionBonusPercentPerFoot = 1.0%
    ShroudClearingRange = 410
    CommandPoints     = 40

    FormationWidth = 2
    FormationDepth = 1

    TransportSlotCount = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE ARCHER ARMY_SUMMARY LARGE_RECTANGLE_PATHFIND

    CamouflageDetectionMultiplier     = CAMOUFLAGE_DETECTION_DISTANCE_LONG

    ThreatLevel = ELVEN_LORIENARCHER_HORDE_THREAT
    ThreatBreakdown ElvenLorienArcherHorde_DetailedThreat
        AIKindOf = ARCHER
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = ArcherHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate        = 500
        MaxCowerTime               = 5000
        MinCowerTime               = 3000
        CanAttackWhileContained    = Yes
        AILuaEventsList            = InfantryFunctions
        AttackPriority             = AttackPriority_Archer
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle         = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay         = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload         = ElvenLorienArcher 10
        Slots             = 10
        PassengerFilter        = NONE +INFANTRY
        ShowPips         = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset        = X:0 Y:0
        MeleeBehavior         = Amoeba
    End

        BannerCarriersAllowed    = ElvenBanner
        BannerCarrierPosition    = UnitType:ElvenLorienArcher    Pos:X:70.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:ElvenLorienArcher Position:X:50 Y:0            Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:50 Y:40        Position:X:50 Y:-40
        RankInfo = RankNumber:2 UnitType:ElvenLorienArcher Position:X:30 Y:0 Leader 1 0    Position:X:30 Y:20 Leader 1 1    Position:X:30 Y:-20 Leader 1 2    Position:X:30 Y:40 Leader 1 3    Position:X:30 Y:-40 Leader 1 4

        RanksToReleaseWhenAttacking = 1 2

        MeleeAttackLeashDistance = 1
        BackUpMinDelayTime        = 1
        BackUpMaxDelayTime        = 3000
        BackUpMinDistance        = 1
        BackUpMaxDistance        = 3
        BackupPercentage        = 80%
    End

    #include "..\..\..\includes\DefaultInvisibilityUpdate.inc"

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

     Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance       =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded       =    NONE
        AfraidOf                =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf          =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
        PointAt                 =    EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance        =    150
        FearScanDistance        =    ARCHER_FEAR_SCAN_RADIUS


        AddEmotion    =    Terror_Base
        AddEmotion    =    Doom_Base
        AddEmotion    =    BraceForBeingCrushed_Base
        AddEmotion    =    UncontrollableFear_Base
        AddEmotion    =    FearIdle_Base
        AddEmotion    =    FearBusy_Base
        AddEmotion    =    Point_Base
        AddEmotion    =    Taunt_Base
        AddEmotion    =    CheerIdle_Base
        AddEmotion    =    CheerBusy_Base
        AddEmotion    =    HeroCheerIdle_Base
        AddEmotion    =    HeroCheerBusy_Base
        AddEmotion    =    Alert_Base
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End

    LocomotorSet
        Locomotor     = NormalMeleeHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_FOOT_VERYFAST_HORDE_SPEED
    End

    CamouflageDetectionMultiplier     = CAMOUFLAGE_DETECTION_DISTANCE_LONG

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    #include "..\..\..\includes\CaptureBuilding.inc"


    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTraining
        LevelsToGain = 1
        LevelCap = 2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality
	 TriggeredBy = Upgrade_HeavyArmor
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_ForgedBlades
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality3
        TriggeredBy = Upgrade_SilverThornArrows
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality4
        TriggeredBy = Upgrade_TechnologyLothlorienLembasbrotAktive
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality7
        TriggeredBy = Upgrade_LothlorienLongBows
    End


    Behavior = AttributeModifierUpgrade ModuleTag_SHU
        TriggeredBy          = Upgrade_LothlorienLongBows
        AttributeModifier    = LongbowsModifier
    End


    Behavior = SpecialPowerModule ModuleTag_Lembasbrot
        SpecialPowerTemplate     = SpecialAbilityLembasbrotHealSpell
        UpdateModuleStartsAttack = Yes
    End

    Behavior = SpecialAbilityUpdate ModuleTag_LembasbrotUpdate
        SpecialPowerTemplate     = SpecialAbilityLembasbrotHealSpell
        StartAbilityRange        = 1.6
        UnpackTime               = 1
        PreparationTime          = 3
        PackTime                 = 2096
        AwardXPForTriggering     = 0
    End

    Behavior = AutoHealBehavior ModuleTag_LembasbrotHealing
        StartsActive             = Yes
        ButtonTriggered          = Yes
        HealingAmount            = 300
        Radius                   = 55
        HealOnlyOthers           = No
        SingleBurst              = Yes
        UnitHealPulseFX          = FX_SpellLembasbrotHealUnitHealBuff
        KindOf                   = INFANTRY
    End






    Behavior = AISpecialPowerUpdate ElvenLorienWarriorHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End


    Behavior = AISpecialPowerUpdate Lembas_AI
        CommandButtonName  = Command_SpecialAbilityLembasbrotHealSpell
        SpecialPowerAIType = AI_SPECIAL_POWER_SELFAOEHEALHEROS
    End

    Geometry            = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 50.0
    GeometryHeight      = 20.0
    GeometryIsSmall     = No




    AutoResolveUnitType = AutoResolveUnit_Archer
    AutoResolveCombatChain = AutoResolve_ArcherCombatChain

    AutoResolveBody = AutoResolve_ElvenLorienArcherHordeBody

    AutoResolveArmor
        Armor = AutoResolve_ElvenLorienArcherHeavyArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_SilverThornArrows
        Weapon = AutoResolve_ElvenLorienArcherUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_SilverThornArrows
        Weapon = AutoResolve_ElvenLorienArcherWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTraining Upgrade_SilverThornArrows Upgrade_LothlorienLongBows
End


Object ElvenMirkwoodArcherHorde

    ButtonImage        = USMirkwoodArchersNew
    SelectPortrait     = UPElven_MirkwoodArcher

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_TAUNTING EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED  EMOTION_TERROR EMOTION_LOOK_TO_SKY
        DefaultModelConditionState
            Model = None
        End
        ModelConditionState = HORDE_EMPTY
            Model = None
        End

        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkEUMIA
        End
    End

    Side = Lothlorien
    EditorSorting = UNIT
    EmotionRange = 240
    DisplayName = OBJECT:ElvenMirkwoodArcherHorde
    DisplayNameStrategic = CONTROLBAR:LW_Unit_ElvenMirkwoodArcherHorde
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_ElvenMirkwoodArcherHorde
    MaxSimultaneousOfType = 3

    WeaponSet
        Conditions = None
        Weapon = PRIMARY    MirkwoodArcherMissileHordeRangefinderEdainNew
        Weapon = SECONDARY  MirkwoodArcherMissileHordeRangefinderEdainNew
        Weapon = TERTIARY   MirkwoodArcherMissileHordeRangefinderBombard
        Weapon = QUATERNARY MirkwoodArcherMissileHordeRangefinderEdainNew
        AutoChooseSources = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
        AutoChooseSources = SECONDARY  FROM_PLAYER FROM_SCRIPT
        AutoChooseSources = TERTIARY FROM_PLAYER FROM_SCRIPT
        AutoChooseSources = QUATERNARY NONE
        ShareWeaponReloadTime = Yes
    End





    #include "..\..\..\includes\StandardHordeEvaEvents.inc"

    BuildCost              = 1000
    BuildTime              = STRONG_BUILDTIME
    VisionRange            = 530
    VisionSide             = 60%
    VisionRear             = 35%
    VisionBonusPercentPerFoot = 1.0%
    ShroudClearingRange       = 500
    CommandPoints             = 50
    CommandSet         	      = ElvenMirkwoodArcherHordeCommandSetMod

    FormationWidth             = 2
    FormationDepth             = 1

    CrushableLevel             = 1
    CrusherLevel               = 0
    UseCrushAttack             = No

    TransportSlotCount         = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf                     = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE ARCHER ARMY_SUMMARY LARGE_RECTANGLE_PATHFIND
    CamouflageDetectionMultiplier     = CAMOUFLAGE_DETECTION_DISTANCE_LONG


    ThreatLevel         = 175
    ThreatBreakdown ElvenMirkwoodArcherHorde_DetailedThreat
        AIKindOf     = ARCHER
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = ArcherHorde
        End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle    = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate           = 500
        MaxCowerTime                  = 5000
        MinCowerTime                  = 3000
        CanAttackWhileContained       = Yes
        AILuaEventsList               = InfantryFunctions
        AttackPriority                = AttackPriority_Archer
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle               = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay             = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained  =
        InitialPayload           = ElvenMirkwoodArcher 5
        Slots                    = 5
        PassengerFilter          = NONE +INFANTRY
        ShowPips                 = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset             = X:0 Y:0

        MeleeBehavior         = Amoeba
        End


        BannerCarriersAllowed    = ElvenMirkwoodArcherBanner
        BannerCarrierPosition    = UnitType:ElvenMirkwoodArcher        Pos:X:30.0 Y:0.0


        RankInfo = RankNumber:1 UnitType:ElvenMirkwoodArcher Position:X:0 Y:0    Position:X:0 Y:25    Position:X:0 Y:-25    Position:X:0 Y:50    Position:X:0 Y:-50

        RanksToReleaseWhenAttacking = 1

        MeleeAttackLeashDistance  = 1
        BackUpMinDelayTime        = 1
        BackUpMaxDelayTime        = 3000
        BackUpMinDistance         = 1
        BackUpMaxDistance         = 3
        BackupPercentage          = 80%
    End


    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

       Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay     =    1000
        TauntAndPointExcluded        =    NONE
        AfraidOf                     =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf               =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
        PointAt                      =    EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance             =    150
        FearScanDistance             =    ARCHER_FEAR_SCAN_RADIUS

        AddEmotion            =    Terror_Base
        AddEmotion            =    Doom_Base
        AddEmotion            =   BraceForBeingCrushed_Base
        AddEmotion            =    UncontrollableFear_Base
        AddEmotion            =    FearIdle_Base
        AddEmotion            =    FearBusy_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
        AddEmotion    =    CheerIdle_Base
        AddEmotion    =    CheerBusy_Base
        AddEmotion    =    HeroCheerIdle_Base
        AddEmotion    =    HeroCheerBusy_Base
        AddEmotion    =    Alert_Base
    End

    #include "..\..\..\includes\CaptureBuilding.inc"


    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality4
        TriggeredBy = Upgrade_ElvenCloak
    End

    Behavior = DoCommandUpgrade Module_DoCommandUpgradeAI
        TriggeredBy                     = Upgrade_TechnologyElvenCloak
        GetUpgradeCommandButtonName     = Command_PurchaseUpgradeMirkwoodElvenCloak
    End

    Behavior = SpecialPowerModule ModuleTag_ElfCloakStarter
        SpecialPowerTemplate      = SpecialAbilityElfCloak
        UpdateModuleStartsAttack  = Yes
        StartsPaused              = No
    End

    Behavior = ToggleHiddenSpecialAbilityUpdate ModuleTag_ElfCloakUpdate
        SpecialPowerTemplate = SpecialAbilityElfCloak
    End

    Behavior = InvisibilityUpdate ModuleTag_ElvenCloak
        InvisibilityNugget
            InvisibilityType    = STEALTH
            ForbiddenConditions    = MOVING FIRING_ANY TAKING_DAMAGE
            BecomeStealthedFX       = FX_ElvenCloakOn
            ExitStealthFX           = FX_ElvenCloakOff
            Options            = UNTOGGLE_HIDDEN_WHEN_LEAVING_STEALTH
        End

        StartsActive            = No
        UpdatePeriod            = 2000
    End

    LocomotorSet
        Locomotor     = NormalRangedHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_FOOT_VERYFAST_HORDE_SPEED
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly         = Yes
        StuffToPickUp          = ANY +CRATE -TheDroppedRing
        ScanRange              = 200
        ScanIntervalSeconds    = 0.5
    End


    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_Enabler
        SpecialPowerTemplate = SpecialAbilityHammerschlage
        TriggeredBy          = Upgrade_MiniHordeLvl5
    End

    Behavior = WeaponModeSpecialPowerUpdate ModuleTag_PowerUpdate
        SpecialPowerTemplate = SpecialAbilityHammerschlage
        Duration             = 20000
        AttributeModifier    = ElvenMirkwoodArrowsBonus
        LockWeaponSlot       = QUATERNARY
        StartsPaused         = Yes
    End

    Behavior = AutoAbilityBehavior ModuleTag_MirkwoodArcherAutoAbility
	SpecialAbility		= SpecialAbilityHammerschlage
	ForbiddenStatus 	= INSIDE_GARRISON
	MaxScanRange		= 400.0
	Query			= 1 ALL ENEMIES -STRUCTURE
    End


    Behavior = AutoHealBehavior ModuleTag_HearthHeal
        StartsActive               = No
        HealOnlyIfNotInCombat      = Yes
        HealOnlyIfNotUnderAttack   = Yes
        TriggeredBy                = Upgrade_MiniHordeLvl2
        HealingAmount              = 30
        Radius                     = 55
        StartHealingDelay          = 7500
        HealingDelay               = 5000
        UnitHealPulseFX            = FX_SpellHealUnitHealBuff
        NonStackable               = Yes
        RespawnNearbyHordeMembers  = Yes
        RespawnFXList              = FX_BannerCarrierSpawnUnit
        RespawnMinimumDelay        = 200
    End






    Behavior = AISpecialPowerUpdate ElvenMirkwoodArcherHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

   Behavior = AISpecialPowerUpdate DornpfeileDusterwaldsSpecialAI
        CommandButtonName  = Command_SpecialAbilityDornpfeileDusterwalds
        SpecialPowerAIType = AI_SPECIAL_POWER_BASIC_SELF_BUFF
   End

    Geometry         = BOX
    GeometryMajorRadius     = 20.0
    GeometryMinorRadius     = 60.0
    GeometryHeight         = 10.0
    GeometryIsSmall     = No




    AutoResolveUnitType = AutoResolveUnit_Archer
    AutoResolveCombatChain = AutoResolve_ArcherCombatChain

    AutoResolveBody = AutoResolve_ElvenMirkwoodArcherHordeBody

    AutoResolveArmor
        Armor = AutoResolve_ElvenMirkwoodArcherArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_SilverThornArrows
        Weapon = AutoResolve_ElvenMirkwoodArcherUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_SilverThornArrows
        Weapon = AutoResolve_ElvenMirkwoodArcherWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_ElvenCloak
End




Object LothlorienBerserkerHorde

    ButtonImage            = HSLeibwachter
    SelectPortrait         = UPLeibwachter


    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR
        DefaultModelConditionState
            Model = None
        End
        ModelConditionState = HORDE_EMPTY
            Model = None
        End
        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkEULoW
        End
    End

    Side = Lothlorien
    EditorSorting = UNIT
    EmotionRange = 240
    DisplayName = OBJECT:LothlorienBerserker
    DisplayNameStrategic = CONTROLBAR:LW_Unit_LeibwachenHorde
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_LeibwachenHorde

    MaxSimultaneousOfType    = 3

    WeaponSet
        Conditions = None
        Weapon = PRIMARY    TowerGuardHordeRangefinder
    End

    CommandSet = LorienLeibwacheCommandSet




    #include "..\..\..\includes\StandardHordeEvaEvents.inc"


     CrushableLevel = 0
    CrusherLevel = 0

    BuildCost = 850
    BuildTime = STRONG_BUILDTIME
    VisionRange = ELVEN_MITHLONDSENTRY_HORDE_VISION_RANGE
    VisionSide = 50%
    VisionRear = 25%
    VisionBonusPercentPerFoot = 1.0%
    ShroudClearingRange = ELVEN_MITHLONDSENTRY_SHROUD_RANGE
    CommandPoints = 50

    FormationWidth = 2
    FormationDepth = 1

    TransportSlotCount = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE ARMY_SUMMARY MELEE_HORDE LARGE_RECTANGLE_PATHFIND PIKE
    CamouflageDetectionMultiplier     = CAMOUFLAGE_DETECTION_DISTANCE_LONG
    ThreatLevel = ELVEN_MITHLONDSENTRY_HORDE_THREAT
    ThreatBreakdown ElvenMithlondSentryHorde_DetailedThreat
        AIKindOf = PIKEMAN
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = PikeHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle = Yes ATTACK_BUILDINGS STEALTHED
        MoodAttackCheckRate        = 500
        MaxCowerTime                =    5000
        MinCowerTime                =    3000
        CanAttackWhileContained    = Yes
        AILuaEventsList                = InfantryFunctions
        AttackPriority                =     AttackPriority_Archer
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle         = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay         = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload = LothlorienBerserker 5
        Slots = 5
        PassengerFilter = NONE +INFANTRY
        ShowPips = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset = X:0 Y:0
        MeleeBehavior = Amoeba
        End


        BannerCarriersAllowed    = ElvenSpear
        BannerCarrierPosition    = UnitType:LothlorienBerserker   Pos:X:20.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:LothlorienBerserker Position:X:0 Y:0        Position:X:0 Y:20        Position:X:0 Y:-20        Position:X:0 Y:40        Position:X:0 Y:-40

        RanksToReleaseWhenAttacking = 1 2 3

        AlternateFormation = LothlorienBerserkerHordeShieldWall
        MeleeAttackLeashDistance = 1
        BackUpMinDelayTime         = 1
        BackUpMaxDelayTime         = 3000
        BackUpMinDistance         = 1
        BackUpMaxDistance         = 3
        BackupPercentage         = 80%

    End

    #include "..\..\..\includes\DefaultInvisibilityUpdate.inc"

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

     Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded        =    NONE
        AfraidOf                    =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf                =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
         PointAt                        =    EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance            =    150
        FearScanDistance            =    INFANTRY_FEAR_SCAN_RADIUS



        AddEmotion    =    Terror_Base
        AddEmotion    =    Doom_Base

        AddEmotion    =    UncontrollableFear_Base
        AddEmotion    =    FearIdle_Base
        AddEmotion    =    FearBusy_Base
        AddEmotion    =    Point_Base
        AddEmotion    =    Taunt_Base
        AddEmotion    =    CheerIdle_Base
        AddEmotion    =    CheerBusy_Base
        AddEmotion    =    HeroCheerIdle_Base
        AddEmotion    =    HeroCheerBusy_Base
        AddEmotion    =    Alert_Base
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End

    LocomotorSet
        Locomotor     = NormalMeleeHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = 50
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTraining
        LevelsToGain = 1
        LevelCap = 2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality
        TriggeredBy = Upgrade_HeavyArmor
    End


    Behavior = HordeDispatchSpecialPower ModuleTag_ZephyrStrike
        SpecialPowerTemplate        = SpecialAbilityZephyrStrike
        UpdateModuleStartsAttack    = Yes
        StartsPaused                  = No
    End


    Behavior = AutoHealBehavior ModuleTag_HearthHeal
        StartsActive               = No
        HealOnlyIfNotInCombat      = Yes
        HealOnlyIfNotUnderAttack   = Yes
        TriggeredBy                = Upgrade_EliteHordeLvl2
        HealingAmount              = 30
        Radius                     = 100
        StartHealingDelay          = 7500
        HealingDelay               = 5000
        UnitHealPulseFX            = FX_SpellHealUnitHealBuff
        NonStackable               = Yes
        RespawnNearbyHordeMembers  = Yes
        RespawnFXList              = FX_BannerCarrierSpawnUnit
        RespawnMinimumDelay        = 200
    End


    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality3
        TriggeredBy = Upgrade_ForgedBlades
    End





    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_FormenosArmorUpgradeEnabler
        SpecialPowerTemplate               = SpecialAbilityFakeLeadership2
        TriggeredBy                        = Upgrade_EliteHordeLvl5
    End

    Behavior = SpecialPowerModule ModuleTag_FormenosArmorUpgradeStarter
        SpecialPowerTemplate               = SpecialAbilityFakeLeadership2
        UpdateModuleStartsAttack           = Yes
        StartsPaused                       = Yes
    End

    Behavior = ArmorUpgrade ArmorUpgradeModuleTag
        TriggeredBy                        = Upgrade_EliteHordeLvl5
        ArmorSetFlag                       = PLAYER_UPGRADE
    End






    Behavior = AISpecialPowerUpdate DwarvenGuardianHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Behavior = AISpecialPowerUpdate ZephyrSchlagAI
        CommandButtonName = Command_ZephyrSchlag
        SpecialPowerAIType = AI_SPECIAL_POWER_GANDALF_WIZARD_BLAST
        SpecialPowerRadius = 100
    End


    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 45.0
    GeometryHeight = 20.0
    GeometryIsSmall = No


    AutoResolveUnitType            = AutoResolveUnit_Pikemen
    AutoResolveCombatChain         = AutoResolve_PikemenCombatChain

    AutoResolveBody = AutoResolve_DwarvenGuardianHordeBody

    AutoResolveArmor
        Armor = AutoResolve_GondorWachterderVesteHeavyArmor
    End

    AutoResolveWeapon
        Weapon = AutoResolve_GondorWachterderVesteUpgradedWeapon
    End
End


ChildObject LothlorienBerserkerHordeShieldWall LothlorienBerserkerHorde

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle         = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay         = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained            =
        InitialPayload                         = LothlorienBerserker 5
        Slots                             = 5
        PassengerFilter                    = NONE +INFANTRY
        ShowPips                        = No
        ThisFormationIsTheMainFormation = No
        AttributeModifiers                = GilGaladsLeibwachterShieldWall
        RandomOffset                    = X:0 Y:0
        MeleeBehavior = Amoeba
        End


        BannerCarriersAllowed    = ElvenSpear
        BannerCarrierPosition    = UnitType:LothlorienBerserker   Pos:X:20.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:LothlorienBerserker Position:X:0 Y:0        Position:X:0 Y:12.5        Position:X:0 Y:-12.5        Position:X:0 Y:25        Position:X:0 Y:-25

        RanksToReleaseWhenAttacking = 1

        AlternateFormation = LothlorienBerserkerHorde
        MeleeAttackLeashDistance = 1
        BackUpMinDelayTime         = 1
        BackUpMaxDelayTime         = 3000
        BackUpMinDistance         = 1
        BackUpMaxDistance         = 3
        BackupPercentage         = 80%
    End
End



ChildObject LothlorienBerserkerHorde_Summoned LothlorienBerserkerHorde
    IsTrainable      =    No
    CommandPoints =    0
    CommandSet = LothlorienBerserkerHordeCommandSet
    EquivalentTo  =    LothlorienBerserkerHorde

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle         = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay         = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload = LothlorienBerserker_Summoned 5
        Slots = 5
        PassengerFilter    = NONE +INFANTRY
        ShowPips = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset=X:0 Y:0
        MeleeBehavior = Amoeba
            FacingBonus            =    30.0
            AngleLimitCos        =    -0.17
            InnerRange            =    30
            OuterRange            =    80
            OuterRangeBuildings    =    140
        End

        RankInfo = RankNumber:1 UnitType:LothlorienBerserker_Summoned Position:X:50 Y:0        Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:50 Y:40        Position:X:50 Y:-40

        RanksToReleaseWhenAttacking = 1

        AlternateFormation = LothlorienBerserkerHordeShieldWall_Summoned
        MeleeAttackLeashDistance = 1
        BackUpMinDelayTime         = 1
        BackUpMaxDelayTime         = 3000
        BackUpMinDistance         = 1
        BackUpMaxDistance         = 3
        BackupPercentage         = 80%
    End

    Behavior = LifetimeUpdate ModuleTag_LifetimeUpdate

        MinLifetime        = 260000
        MaxLifetime        = 260000
        DeathType        = FADED
    End
End



ChildObject LothlorienBerserkerHordeShieldWall_Summoned LothlorienBerserkerHorde_Summoned

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle         = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay         = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained            =
        InitialPayload                         = LothlorienBerserker_Summoned 5
        Slots                             = 5
        PassengerFilter                    = NONE +INFANTRY
        ShowPips                        = No
        ThisFormationIsTheMainFormation = No
        AttributeModifiers                = GilGaladsLeibwachterShieldWall
        RandomOffset                    = X:0 Y:0
        MeleeBehavior = Amoeba
        End





        RankInfo = RankNumber:1 UnitType:LothlorienBerserker_Summoned Position:X:0 Y:0        Position:X:0 Y:12.5        Position:X:0 Y:-12.5        Position:X:0 Y:25        Position:X:0 Y:-25

        RanksToReleaseWhenAttacking = 1

        AlternateFormation       = LothlorienBerserkerHorde_Summoned
        MeleeAttackLeashDistance = 1
        BackUpMinDelayTime       = 1
        BackUpMaxDelayTime       = 3000
        BackUpMinDistance        = 1
        BackUpMaxDistance        = 3
        BackupPercentage         = 80%
    End
End

Object LothlorienGaladhrimHorde

    SelectPortrait     = UPGaladhrim
    ButtonImage        = HILothlorienGaladhrim_Wotr

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR
        DefaultModelConditionState
            Model = None
        End
        ModelConditionState = HORDE_EMPTY
            Model = None
        End
        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkEULoW
        End
    End

    Side = Lothlorien
    EditorSorting = UNIT
    EmotionRange = 240
    DisplayName = OBJECT:LothlorienGaladhrimHorde
    DisplayNameStrategic = CONTROLBAR:LW_Unit_LothlorienGaladhrimHorde
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_LothlorienGaladhrimHorde

    WeaponSet
        Conditions = NONE
        Weapon     = PRIMARY    GaladhrimArcherMissileHordeRangefinder
        Weapon     = TERTIARY   LorienGaladhrimMissileHordeRangefinderEdainStandardBombard
        AutoChooseSources = TERTIARY FROM_PLAYER FROM_SCRIPT
    End

    WeaponSet
        Conditions = CONTAINED
        Weapon     = PRIMARY    GarrisonedUnitBowHordeRangefinder
    End

    WeaponSet
        Conditions = WEAPONSET_TOGGLE_1
        Weapon = PRIMARY    NormalMeleeHordeRangefinder
    End

    CommandSet = LothlorienGaladhirmHordeCommandSet




    #include "..\..\..\includes\StandardHordeEvaEvents.inc"


    CrushableLevel = 0
    CrusherLevel   = 0

    BuildCost = GALADHRIMHORDE_BUILDCOST
    BuildTime = STRONG_BUILDTIME
    VisionRange = 440
    VisionSide = 50%
    VisionRear = 25%
    VisionBonusPercentPerFoot = 1.0%
    ShroudClearingRange = 440
    CommandPoints = 70

    FormationWidth = 2
    FormationDepth = 1

    TransportSlotCount = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY ARCHER HORDE ARMY_SUMMARY MELEE_HORDE LARGE_RECTANGLE_PATHFIND
    CamouflageDetectionMultiplier     = CAMOUFLAGE_DETECTION_DISTANCE_LONG

    ThreatLevel         = 150
    ThreatBreakdown ElvenMirkwoodArcherHorde_DetailedThreat
        AIKindOf     = ARCHER
    End


    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = ArcherHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle  = Yes ATTACK_BUILDINGS STEALTHED
        MoodAttackCheckRate         = 500
        MaxCowerTime                =    5000
        MinCowerTime                =    3000
        CanAttackWhileContained     = Yes
        AILuaEventsList             = InfantryFunctions
        AttackPriority              =     AttackPriority_Archer
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle         = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay         = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload = LothlorienGaladhrim 10
        Slots = 10
        PassengerFilter    = NONE +INFANTRY
        ShowPips = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset=X:0 Y:0
        MeleeBehavior = Amoeba
        End

        BannerCarriersAllowed    = LothlorienGaladhrimBanner
        BannerCarrierPosition    = UnitType:LothlorienGaladhrim    Pos:X:70.0 Y:0.0


        RankInfo = RankNumber:1 UnitType:LothlorienGaladhrim Position:X:50 Y:0        Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:50 Y:40        Position:X:50 Y:-40
        RankInfo = RankNumber:2 UnitType:LothlorienGaladhrim Position:X:30 Y:0 Leader 1 0    Position:X:30 Y:20 Leader 1 1    Position:X:30 Y:-20 Leader 1 2    Position:X:30 Y:40 Leader 1 3    Position:X:30 Y:-40 Leader 1 4

        RanksToReleaseWhenAttacking = 1  2

        MeleeAttackLeashDistance = 1
        BackUpMinDelayTime        = 1
        BackUpMaxDelayTime        = 3000
        BackUpMinDistance        = 1
        BackUpMaxDistance        = 3
        BackupPercentage        = 80%
    End

    #include "..\..\..\includes\DefaultInvisibilityUpdate.inc"

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

    Behavior = InvisibilityUpdate ModuleTag_ElvenCloak
        InvisibilityNugget
            InvisibilityType    = STEALTH
            ForbiddenConditions    = MOVING FIRING_ANY TAKING_DAMAGE
            BecomeStealthedFX       = FX_ElvenCloakOn
            ExitStealthFX           = FX_ElvenCloakOff
            Options            = UNTOGGLE_HIDDEN_WHEN_LEAVING_STEALTH
        End
        StartsActive            = No
        UpdatePeriod            = 2000
    End

    Behavior = StealthUpdate StealthUpdateModuleTag
        StealthDelay                        = 500
        FriendlyOpacityMin                    = STEALTH_FRIENDLY_OPACITY_MIN
        FriendlyOpacityMax                    = STEALTH_FRIENDLY_OPACITY_MAX
        PulseFrequency                        = 750
        StealthForbiddenConditions            = AWAY_FROM_TREES ATTACKING
        OrderIdleEnemiesToAttackMeUponReveal= Yes
        DetectedByAnyoneRange                = 120
        RevealWeaponSets                    = CLOSE_RANGE CONTESTING_BUILDING
    End

     Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded        =    NONE
        AfraidOf                    =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf                =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
         PointAt                        =    EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance        =    150
        FearScanDistance        =    ARCHER_FEAR_SCAN_RADIUS


        AddEmotion    =    Terror_Base
        AddEmotion    =    Doom_Base
        AddEmotion    =   BraceForBeingCrushed_Base
        AddEmotion    =    UncontrollableFear_Base
        AddEmotion    =    FearIdle_Base
        AddEmotion    =    FearBusy_Base
        AddEmotion    =    Point_Base
        AddEmotion    =    Taunt_Base
        AddEmotion    =    CheerIdle_Base
        AddEmotion    =    CheerBusy_Base
        AddEmotion    =    HeroCheerIdle_Base
        AddEmotion    =    HeroCheerBusy_Base
        AddEmotion    =    Alert_Base
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End

    LocomotorSet
        Locomotor     = NormalMeleeHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_FOOT_FAST_HORDE_SPEED
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTraining
        LevelsToGain = 1
        LevelCap = 2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality
        TriggeredBy = Upgrade_HeavyArmor
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_ForgedBlades
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality3
        TriggeredBy = Upgrade_SilverThornArrows
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality5
        TriggeredBy = Upgrade_TechnologyLothlorienLembasbrotAktive
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality6
        TriggeredBy = Upgrade_ElvenCloak
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality7
        TriggeredBy = Upgrade_LothlorienLongBows
    End

    Behavior = AttributeModifierUpgrade ModuleTag_SHU
        TriggeredBy            = Upgrade_LothlorienLongBows
        AttributeModifier      = LongbowsModifier
    End

    Behavior = SpecialPowerModule ModuleTag_Lembasbrot
        SpecialPowerTemplate     = SpecialAbilityLembasbrotHealSpell
        UpdateModuleStartsAttack = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_ElfCloakStarter
        SpecialPowerTemplate      = SpecialAbilityElfCloak
        UpdateModuleStartsAttack  = Yes
        StartsPaused              = No
    End

    Behavior = ToggleHiddenSpecialAbilityUpdate ModuleTag_ElfCloakUpdate
        SpecialPowerTemplate      = SpecialAbilityElfCloak
    End

    Behavior = SpecialAbilityUpdate ModuleTag_LembasbrotUpdate
        SpecialPowerTemplate     = SpecialAbilityLembasbrotHealSpell
        StartAbilityRange        = 1.6
        UnpackTime               = 1
        PreparationTime          = 3
        PackTime                 = 2096
        AwardXPForTriggering     = 0
    End

    Behavior = AutoHealBehavior ModuleTag_LembasbrotHealing
        StartsActive             = Yes
        ButtonTriggered          = Yes
        HealingAmount            = 300
        Radius                   = 55
        HealOnlyOthers           = No
        SingleBurst              = Yes
        UnitHealPulseFX          = FX_SpellLembasbrotHealUnitHealBuff
        KindOf                   = INFANTRY
    End







    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName  = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName  = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName  = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Behavior = AISpecialPowerUpdate ElvenLorienWarriorHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate HordeToggleWeapon_AI
        CommandButtonName  = Command_ToggleElvenWarriorWeapon
        SpecialPowerAIType = AI_SPECIAL_POWER_TOGGLE_MELEE_AND_RANGE
    End

    Behavior = AISpecialPowerUpdate Lembas_AI
        CommandButtonName  = Command_SpecialAbilityLembasbrotHealSpell
        SpecialPowerAIType = AI_SPECIAL_POWER_SELFAOEHEALHEROS
    End

    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 45.0
    GeometryHeight = 20.0
    GeometryIsSmall = No



    AutoResolveUnitType = AutoResolveUnit_Soldier
    AutoResolveCombatChain = AutoResolve_SoldierCombatChain

    AutoResolveBody = AutoResolve_DwarvenGuardianHordeBody

    AutoResolveArmor
        Armor = AutoResolve_GondorWachterderVesteHeavyArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_GondorWachterderVesteUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_GondorWachterderVesteWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTraining Upgrade_ForgedBlades Upgrade_SilverThornArrows Upgrade_LothlorienLongBows
End


ChildObject LothlorienGaladhrimHordeHorde_Summoned LothlorienGaladhrimHorde
    IsTrainable      =    No
    CommandPoints =    0
    CommandSet      =    ElvenLorienWarriorHordeHorde_SummonedCommandSet
    EquivalentTo  =    LothlorienGaladhrimHorde

    DisplayName  =  OBJECT:LothlorienGaladhrimHorde

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle         = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay         = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload = LothlorienGaladhrim_Summoned 10
        Slots = 10
        PassengerFilter    = NONE +INFANTRY
        ShowPips = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset=X:0 Y:0
        MeleeBehavior = Amoeba
        End

        RankInfo = RankNumber:1 UnitType:LothlorienGaladhrim_Summoned Position:X:50 Y:0            Position:X:50 Y:20                Position:X:50 Y:-20                Position:X:50 Y:40                Position:X:50 Y:-40
        RankInfo = RankNumber:2 UnitType:LothlorienGaladhrim_Summoned Position:X:30 Y:0 Leader 1 0    Position:X:30 Y:20 Leader 1 1    Position:X:30 Y:-20 Leader 1 2    Position:X:30 Y:40 Leader 1 3    Position:X:30 Y:-40 Leader 1 4


        RanksToReleaseWhenAttacking = 1 2
        MeleeAttackLeashDistance = 25
End

    Behavior = LifetimeUpdate ModuleTag_LifetimeUpdate

        MinLifetime        = CREATE_A_HERO_REINFORCEMENT_LIFETIME
        MaxLifetime        = CREATE_A_HERO_REINFORCEMENT_LIFETIME
        DeathType        = FADED
    End

End

ChildObject LothlorienGaladhrimHorde_SB LothlorienGaladhrimHorde

    CommandSet    =    LindonWachterHordeCommandSet_Summoned
    EquivalentTo  =    LothlorienGaladhrimHorde

End

ChildObject LothlorienGaladhrimHordeInn LothlorienGaladhrimHorde

    CommandSet      =    LorienGaladhrimInnHordeCommandSet
    EquivalentTo    =    LothlorienGaladhrimHorde

    DisplayName  =  OBJECT:LothlorienGaladhrimHorde

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle         = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay         = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload = LothlorienGaladhrimInn 10
        Slots = 10
        PassengerFilter    = NONE +INFANTRY
        ShowPips = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset=X:0 Y:0
        MeleeBehavior = Amoeba
        End

        BannerCarriersAllowed    = ElvenBanner
        BannerCarrierPosition    = UnitType:LothlorienGaladhrimInn    Pos:X:70.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:LothlorienGaladhrimInn Position:X:50 Y:0            Position:X:50 Y:20                Position:X:50 Y:-20                Position:X:50 Y:40                Position:X:50 Y:-40
        RankInfo = RankNumber:2 UnitType:LothlorienGaladhrimInn Position:X:30 Y:0 Leader 1 0    Position:X:30 Y:20 Leader 1 1    Position:X:30 Y:-20 Leader 1 2    Position:X:30 Y:40 Leader 1 3    Position:X:30 Y:-40 Leader 1 4

        RanksToReleaseWhenAttacking = 1  2

        MeleeAttackLeashDistance = 1
        BackUpMinDelayTime       = 1
        BackUpMaxDelayTime       = 3000
        BackUpMinDistance        = 1
        BackUpMaxDistance        = 3
        BackupPercentage         = 80%
    End
End

Object LothlorienReiterHorde


    ButtonImage        = WOR_RivendellLancer
    SelectPortrait    = UPElven_RivendellLancer

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR EMOTION_CELEBRATING
        DefaultModelConditionState
            Model = None
        End
        ModelConditionState = HORDE_EMPTY
            Model = None
        End
        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkEURIL
        End
    End

    Side            = Lothlorien
    EditorSorting        = UNIT
    EmotionRange        = 240
    DisplayName        = OBJECT:LothRiderHorde
    DisplayNameStrategic     = CONTROLBAR:LW_Unit_LothRiderHorde
    DescriptionStrategic     = CONTROLBAR:LW_ToolTipBuild_LothRiderHorde

    WeaponSet
        Conditions    = None
        Weapon        = PRIMARY    NormalMeleeHordeRangefinder
    End





    #include "..\..\..\includes\StandardHordeEvaEvents.inc"

    BuildCost        = 650
    BuildTime        = STRONG_BUILDTIME
    VisionRange        = ELVEN_RIVENDELLLANCER_HORDE_VISION_RANGE
        VisionSide     = 50%
    VisionRear         = 25%
    VisionBonusPercentPerFoot = 1.0%
    ShroudClearingRange     = ELVEN_RIVENDELLLANCER_SHROUD_RANGE
    CommandPoints        = 40

    FormationWidth         = 2
    FormationDepth         = 1

    CrushableLevel                = 2
    CrusherLevel                = 1
    MinCrushVelocityPercent = MINCRUSHVELOCITYPERCENT_STANDARD
    CrushDecelerationPercent = CRUSHDECELERATIONPERCENT_STANDARD
    CrushKnockback                = 40
    CrushZFactor                = 1.0

        TransportSlotCount            = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf                    = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT CAVALRY HORDE MELEE_HORDE  ARMY_SUMMARY LARGE_RECTANGLE_PATHFIND
    CommandSet                = LorienNoldorreiterHordeCommandSet

    ThreatLevel = ELVEN_RIVENDELLLANCER_HORDE_THREAT
    ThreatBreakdown ElvenRivendellLancerHorde_DetailedThreat
        AIKindOf = CAVALRY
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = CavalryHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle    = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate        = 500
        MaxCowerTime            = 5000
        MinCowerTime            = 3000
        AILuaEventsList            = CavalryFunctions
        AttackPriority            = AttackPriority_Cavalry
    End

    Behavior = HorseHordeContain ModuleTag_HordeContain
        FrontAngle         = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay         = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload         = LothlorienReiter  10
        Slots             = 10
        PassengerFilter     = NONE +CAVALRY +ElvenRivendellLancerBanner
        ShowPips         = No
        RandomOffset         = X:2 y:3
        MeleeBehavior         = Amoeba
        End

        ThisFormationIsTheMainFormation = Yes


        BannerCarriersAllowed    = NoldorreiterBanner
        BannerCarrierPosition    = UnitType:LothlorienReiter Pos:X:70.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:LothlorienReiter Position:X:40 Y:0            Position:X:40 Y:20        Position:X:40 Y:-20        Position:X:40 Y:40        Position:X:40 Y:-40
        RankInfo = RankNumber:2 UnitType:LothlorienReiter Position:X:10 Y:0 Leader 1 0    Position:X:10 Y:20 Leader 1 1    Position:X:10 Y:-20 Leader 1 2    Position:X:10 Y:40 Leader 1 3    Position:X:10 Y:-40 Leader 1 4

        RanksToReleaseWhenAttacking = 1 2

        AlternateFormation = LothlorienReiterHordeWedgeFormation
        MeleeAttackLeashDistance     = 1
        BackUpMinDelayTime        = 1
        BackUpMaxDelayTime        = 3000
        BackUpMinDistance        = 1
        BackUpMaxDistance        = 3
        BackupPercentage        = 80%
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

    Behavior = HordeNotifyTargetsOfImminentProbableCrushingUpdate ModuleTag_NotifyCrushScan
        ScanWidth = 70.0
    End

    Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
         TauntAndPointUpdateDelay    =    1000
         TauntAndPointExcluded        =    NONE
        AfraidOf            =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf            =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
         PointAt                =    EMOTION_POINTAT_OBJECTFILTER
         HeroScanDistance        =    150
         FearScanDistance        =    CAVALRY_FEAR_SCAN_RADIUS

        AddEmotion            =    Terror_Base
        AddEmotion            =    Doom_Base
        AddEmotion            =       BraceForBeingCrushed_Base
        AddEmotion            =    UncontrollableFear_Base
        AddEmotion            =    FearIdle_Base
        AddEmotion            =    FearBusy_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
         AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    HeroCheerIdle_Base
        AddEmotion            =    HeroCheerBusy_Base
        AddEmotion            =    Alert_Base
        AddEmotion            =       CheerForAboutToCrush_Base
     End

    LocomotorSet
        Locomotor     = NormalCavalryHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_MOUNTED_VERYFAST_HORDE_SPEED
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTraining
        LevelsToGain = 1
        LevelCap = 2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality
        TriggeredBy = Upgrade_ForgedBlades
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_HeavyArmor
    End


    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality4
        TriggeredBy = Upgrade_TechnologyLothlorienLembasbrotAktive
    End


















    Behavior = AISpecialPowerUpdate RivendellLancerHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End






    Behavior = AISpecialPowerUpdate ElvenMirkwoodArcherHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 40.0
    GeometryHeight = 20.0
    GeometryIsSmall = No

End

ChildObject LothlorienReiterHordeWedgeFormation LothlorienReiterHorde

    Behavior = HorseHordeContain ModuleTag_HordeContain
        AttributeModifiers = GondorKnightWedge
        ObjectStatusOfContained =
        InitialPayload = LothlorienReiter 10
        Slots = 10
        PassengerFilter = NONE +CAVALRY +NoldorreiterBanner
        ShowPips = No
        ThisFormationIsTheMainFormation = No
        RandomOffset = X:8 y:3
        MeleeBehavior = Amoeba
        End


        BannerCarriersAllowed    = NoldorreiterBanner
        BannerCarrierPosition    = UnitType:LothlorienReiter    Pos:X:30.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:LothlorienReiter Position:X:0 Y:0        Position:X:-20 Y:20       Position:X:-20 Y:-20      Position:X:-40 Y:40       Position:X:-40 Y:-40
        RankInfo = RankNumber:2 UnitType:LothlorienReiter Position:X:-30 Y:0      Position:X:-50 Y:20       Position:X:-50 Y:-20      Position:X:-70 Y:40       Position:X:-70 Y:-40

        RanksToReleaseWhenAttacking = 1
        AlternateFormation = LothlorienReiterHorde

        MeleeAttackLeashDistance = 1
        BackUpMinDelayTime       = 1
        BackUpMaxDelayTime       = 3000
        BackUpMinDistance        = 1
        BackUpMaxDistance        = 3
        BackupPercentage         = 80%
    End
End

Object LothlorienBowRiderHorde


    ButtonImage        = HSLothBowRider
    SelectPortrait     = UPLothBowRider

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR EMOTION_CELEBRATING
        DefaultModelConditionState
            Model = None
        End
        ModelConditionState = HORDE_EMPTY
            Model = None
        End
        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkEURIL
        End
    End

    Side                 = Lothlorien
    EditorSorting        = UNIT
    EmotionRange         = 240
    DisplayName          = OBJECT:LothlorienBowRiderHorde
    DisplayNameStrategic = CONTROLBAR:LW_Unit_LothlorienBowRiderHorde
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_ElvenRivendellArcherHorde

    WeaponSet
        Conditions    = None
        Weapon        = PRIMARY    NormalMissileHordeRangefinder
    End





    #include "..\..\..\includes\StandardHordeEvaEvents.inc"

    BuildCost          = 600
    BuildTime          = STRONG_BUILDTIME
    VisionRange        = ELVEN_RIVENDELLARCHER_HORDE_VISION_RANGE
        VisionSide     = 50%
    VisionRear         = 25%
    VisionBonusPercentPerFoot = 1.0%
    ShroudClearingRange     = ELVEN_RIVENDELLARCHER_SHROUD_RANGE
    CommandPoints        = 40

    FormationWidth         = 2
    FormationDepth         = 1

    CrushableLevel                = 2
    CrusherLevel                = 1
    MinCrushVelocityPercent = MINCRUSHVELOCITYPERCENT_STANDARD
    CrushDecelerationPercent = CRUSHDECELERATIONPERCENT_STANDARD
    CrushKnockback                = 40
    CrushZFactor                = 1.0

        TransportSlotCount            = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf                    = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT CAVALRY HORDE MELEE_HORDE ARMY_SUMMARY LARGE_RECTANGLE_PATHFIND
    CommandSet                = ElvenRivendellArcherHordeCommandSet

    ThreatLevel = ELVEN_RIVENDELLARCHER_HORDE_THREAT
    ThreatBreakdown ElvenRivendellLancerHorde_DetailedThreat
        AIKindOf = CAVALRY
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = CavalryHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle    = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate        = 500
        MaxCowerTime            = 5000
        MinCowerTime            = 3000
        AILuaEventsList            = CavalryFunctions
        AttackPriority            = AttackPriority_Cavalry
    End

    Behavior = HorseHordeContain ModuleTag_HordeContain
        FrontAngle         = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay         = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload         = LothlorienBowRider  10
        Slots             = 10
        PassengerFilter     = NONE +CAVALRY
        ShowPips         = No
        RandomOffset         = X:2 y:3
        MeleeBehavior         = Amoeba
        End

        ThisFormationIsTheMainFormation = Yes


        BannerCarriersAllowed    = NoldorreiterBanner
        BannerCarrierPosition    = UnitType:LothlorienBowRider    Pos:X:75.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:LothlorienBowRider Position:X:45 Y:0            Position:X:45 Y:20        Position:X:45 Y:-20        Position:X:45 Y:40        Position:X:45 Y:-40
        RankInfo = RankNumber:2 UnitType:LothlorienBowRider Position:X:10 Y:0 Leader 1 0    Position:X:10 Y:20 Leader 1 1    Position:X:10 Y:-20 Leader 1 2    Position:X:10 Y:40 Leader 1 3    Position:X:10 Y:-40 Leader 1 4

        RanksToReleaseWhenAttacking = 1 2

        AlternateFormation = LothlorienBowRiderHordeWedgeFormation
        MeleeAttackLeashDistance     = 1
        BackUpMinDelayTime        = 1
        BackUpMaxDelayTime        = 3000
        BackUpMinDistance        = 1
        BackUpMaxDistance        = 3
        BackupPercentage        = 80%
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

    Behavior = HordeNotifyTargetsOfImminentProbableCrushingUpdate ModuleTag_NotifyCrushScan
        ScanWidth = 70.0
    End

    Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
         TauntAndPointUpdateDelay    =    1000
         TauntAndPointExcluded        =    NONE
        AfraidOf            =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf            =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
         PointAt                =    EMOTION_POINTAT_OBJECTFILTER
         HeroScanDistance        =    150
         FearScanDistance        =    CAVALRY_FEAR_SCAN_RADIUS

        AddEmotion            =    Terror_Base
        AddEmotion            =    Doom_Base
        AddEmotion            =       BraceForBeingCrushed_Base
        AddEmotion            =    UncontrollableFear_Base
        AddEmotion            =    FearIdle_Base
        AddEmotion            =    FearBusy_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
         AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    HeroCheerIdle_Base
        AddEmotion            =    HeroCheerBusy_Base
        AddEmotion            =    Alert_Base
        AddEmotion            =       CheerForAboutToCrush_Base
     End

    LocomotorSet
        Locomotor     = NormalCavalryHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_MOUNTED_VERYFAST_HORDE_SPEED
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTraining
        LevelsToGain = 1
        LevelCap = 2
    End


    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality
        TriggeredBy = Upgrade_SilverThornArrows
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_HeavyArmor
    End


    Behavior = AISpecialPowerUpdate RivendellLancerHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End


    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality4
        TriggeredBy = Upgrade_TechnologyLothlorienLembasbrotAktive
    End

    Behavior = SpecialPowerModule ModuleTag_Lembasbrot
        SpecialPowerTemplate     = SpecialAbilityLembasbrotHealSpell
        UpdateModuleStartsAttack = Yes
    End

    Behavior = SpecialAbilityUpdate ModuleTag_LembasbrotUpdate
        SpecialPowerTemplate     = SpecialAbilityLembasbrotHealSpell
        StartAbilityRange        = 1.6
        UnpackTime               = 1
        PreparationTime          = 3
        PackTime                 = 2096
        AwardXPForTriggering     = 0
    End

    Behavior = AutoHealBehavior ModuleTag_LembasbrotHealing
        StartsActive             = Yes
        ButtonTriggered          = Yes
        HealingAmount            = 300
        Radius                   = 55
        HealOnlyOthers           = No
        SingleBurst              = Yes
        UnitHealPulseFX          = FX_SpellHealUnitHealBuff
        KindOf                   = INFANTRY
    End







    Behavior = AISpecialPowerUpdate ElvenMirkwoodArcherHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 40.0
    GeometryHeight = 20.0
    GeometryIsSmall = No




    AutoResolveUnitType = AutoResolveUnit_Cavalry
    AutoResolveCombatChain = AutoResolve_CavalryCombatChain

    AutoResolveBody = AutoResolve_ElvenRivendellLancerHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_ElvenRivendellLancerHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_ElvenRivendellLancerArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_SilverThornArrows
        Weapon = AutoResolve_ElvenLorienArcherUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_SilverThornArrows
        Weapon = AutoResolve_ElvenLorienArcherWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTraining Upgrade_SilverThornArrows Upgrade_HeavyArmor
End

ChildObject LothlorienBowRiderHordeWedgeFormation LothlorienBowRiderHorde

    Behavior = HorseHordeContain ModuleTag_HordeContain
        AttributeModifiers = GondorKnightWedge
        ObjectStatusOfContained =
        InitialPayload = LothlorienBowRider 10
        Slots = 10
        PassengerFilter = NONE +CAVALRY
        ShowPips = No
        ThisFormationIsTheMainFormation = No
        RandomOffset = X:8 y:3
        MeleeBehavior = Amoeba
        End


        BannerCarriersAllowed    = NoldorreiterBanner
        BannerCarrierPosition    = UnitType:LothlorienBowRider    Pos:X:30.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:LothlorienBowRider Position:X:0 Y:0        Position:X:-20 Y:20       Position:X:-20 Y:-20      Position:X:-40 Y:40       Position:X:-40 Y:-40
        RankInfo = RankNumber:2 UnitType:LothlorienBowRider Position:X:-30 Y:0      Position:X:-50 Y:20       Position:X:-50 Y:-20      Position:X:-70 Y:40       Position:X:-70 Y:-40

        RanksToReleaseWhenAttacking = 1
        AlternateFormation = LothlorienBowRiderHorde

        MeleeAttackLeashDistance = 1
        BackUpMinDelayTime       = 1
        BackUpMaxDelayTime       = 3000
        BackUpMinDistance        = 1
        BackUpMaxDistance        = 3
        BackupPercentage         = 80%
    End
End


Object ElvenLorienPikemanHorde

       ButtonImage            = UPLorienPikeman ;HILorienPikeman_Wotr
       SelectPortrait         = UPLorienPikeman

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags     = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR
        DefaultModelConditionState
            Model     = None
        End
        ModelConditionState = HORDE_EMPTY
            Model = None
        End
        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkEULoW
        End
    End

    Side         = Lothlorien
    EditorSorting     = UNIT
    EmotionRange     = 240
    DisplayName     = OBJECT:ElvenLorienPikemanHorde
    DisplayNameStrategic = CONTROLBAR:LW_Unit_ElvenLorienPikemanHorde
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_ElvenMithlondSentryHorde

    WeaponSet
        Conditions     = None
        Weapon         = PRIMARY    TowerGuardHordeRangefinder
    End
    WeaponSet
        Conditions     = CONTAINED
        Weapon     = PRIMARY GarrisonedUnitBowHordeRangefinder
    End

    CommandSet = ElvenLorienPikeHordeCommandSet_Edain



    #include "..\..\..\includes\StandardHordeEvaEvents.inc"

    CrushableLevel = 0
    CrusherLevel = 0

    BuildCost         = 300
    BuildTime         = MEDIUM_BUILDTIME
    VisionRange         = 200
    VisionSide         = 50%
    VisionRear         = 25%
    VisionBonusPercentPerFoot = 1.0%
    ShroudClearingRange     = 400
    CommandPoints         = 40

    FormationWidth = 2
    FormationDepth = 1

    TransportSlotCount = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE ARMY_SUMMARY MELEE_HORDE LARGE_RECTANGLE_PATHFIND PIKE

    ThreatLevel = ELVEN_MITHLONDSENTRY_HORDE_THREAT
    ThreatBreakdown ElvenMithlondSentryHorde_DetailedThreat
        AIKindOf = PIKEMAN
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = PikeHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle     = Yes ATTACK_BUILDINGS STEALTHED
        MoodAttackCheckRate            = 500
        MaxCowerTime            = 5000
        MinCowerTime            = 3000
        CanAttackWhileContained        = Yes
        AILuaEventsList                = InfantryFunctions
        AttackPriority                = AttackPriority_Archer
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle   = STANDARD_PIKEMAN_FRONTANGLE
        FlankedDelay = STANDARD_PIKEMAN_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload         = ElvenLorienPikeman 10
        Slots             = 10
        PassengerFilter     = NONE +INFANTRY
        ShowPips         = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset         = X:0 Y:0
        MeleeBehavior         = Amoeba
        End


        BannerCarriersAllowed    = ElvenBanner
        BannerCarrierPosition    = UnitType:ElvenLorienPikeman    Pos:X:70.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:ElvenLorienPikeman Position:X:50 Y:0        Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:50 Y:40        Position:X:50 Y:-40
        RankInfo = RankNumber:2 UnitType:ElvenLorienPikeman Position:X:30 Y:0 Leader 1 0    Position:X:30 Y:20 Leader 1 1    Position:X:30 Y:-20 Leader 1 2    Position:X:30 Y:40 Leader 1 3    Position:X:30 Y:-40 Leader 1 4


        RanksToReleaseWhenAttacking     = 1 2

        MeleeAttackLeashDistance     = 1
        BackUpMinDelayTime        = 1
        BackUpMaxDelayTime        = 3000
        BackUpMinDistance        = 1
        BackUpMaxDistance        = 3
        BackupPercentage        = 80%

        AlternateFormation = ElvenLorienPikemanHordePorcupine
    End

    #include "..\..\..\includes\DefaultInvisibilityUpdate.inc"

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

     Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded        =    NONE
        AfraidOf            =    EMOTION_AFRAIDOF_OBJECTFILTER_LANCERS
        AlwaysAfraidOf            =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER_LANCERS
         PointAt                =    EMOTION_POINTAT_OBJECTFILTER_LANCERS
        HeroScanDistance        =    150
        FearScanDistance        =    INFANTRY_FEAR_SCAN_RADIUS

        AddEmotion    =    Terror_Base
        AddEmotion    =    Doom_Base
        AddEmotion    =    UncontrollableFear_Base
        AddEmotion    =    FearIdle_Base
        AddEmotion    =    FearBusy_Base
        AddEmotion    =    Point_Base
        AddEmotion    =    Taunt_Base
        AddEmotion    =    CheerIdle_Base
        AddEmotion    =    CheerBusy_Base
        AddEmotion    =    HeroCheerIdle_Base
        AddEmotion    =    HeroCheerBusy_Base
        AddEmotion    =    Alert_Base
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End

    LocomotorSet
        Locomotor     = NormalMeleeHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_FOOT_FAST_HORDE_SPEED
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTraining
        LevelsToGain = 1
        LevelCap = 2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality
        TriggeredBy = Upgrade_HeavyArmor
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_ForgedBlades
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality4
        TriggeredBy = Upgrade_TechnologyLothlorienLembasbrotAktive
    End

    Behavior = SpecialPowerModule ModuleTag_Lembasbrot
        SpecialPowerTemplate     = SpecialAbilityLembasbrotHealSpell
        UpdateModuleStartsAttack = Yes
    End

    Behavior = SpecialAbilityUpdate ModuleTag_LembasbrotUpdate
        SpecialPowerTemplate     = SpecialAbilityLembasbrotHealSpell
        StartAbilityRange        = 1.6
        UnpackTime               = 1
        PreparationTime          = 3
        PackTime                 = 2096
        AwardXPForTriggering     = 0
    End

    Behavior = AutoHealBehavior ModuleTag_LembasbrotHealing
        StartsActive             = Yes
        ButtonTriggered          = Yes
        HealingAmount            = 300
        Radius                   = 55
        HealOnlyOthers           = No
        SingleBurst              = Yes
        UnitHealPulseFX          = FX_SpellHealUnitHealBuff
        KindOf                   = INFANTRY
    End


    Behavior = HordeDispatchSpecialPower ModuleTag_ZephyrStrike
        SpecialPowerTemplate        = SpecialAbilityZephyrStrike
        UpdateModuleStartsAttack    = Yes
        StartsPaused                  = No
    End

    #include "..\..\includes\zephyrstrike.inc"





    Behavior = AISpecialPowerUpdate ElvenMithlondSentryHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Behavior = AISpecialPowerUpdate Lembas_AI
        CommandButtonName  = Command_SpecialAbilityLembasbrotHealSpell
        SpecialPowerAIType = AI_SPECIAL_POWER_SELFAOEHEALHEROS
    End

    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 45.0
    GeometryHeight = 20.0
    GeometryIsSmall = No




    AutoResolveUnitType = AutoResolveUnit_Pikemen
    AutoResolveCombatChain = AutoResolve_PikemenCombatChain

    AutoResolveBody = AutoResolve_ElvenMithlondSentryHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_ElvenMithlondSentryHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_ElvenMithlondSentryArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_ElvenMithlondSentryUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_ElvenMithlondSentryWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTraining Upgrade_ForgedBlades
End

ChildObject ElvenLorienPikemanHordePorcupine ElvenLorienPikemanHorde

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle   = STANDARD_PIKEMAN_FRONTANGLE_FORMATION
        FlankedDelay = STANDARD_PIKEMAN_FLANKEDDELAY
        ObjectStatusOfContained         =
        InitialPayload                = ElvenLorienPikeman 10
        Slots                    = 10
        PassengerFilter                = NONE +INFANTRY
        ShowPips                = No
        ThisFormationIsTheMainFormation     = No
        RandomOffset                = X:2 Y:1
        RanksToReleaseWhenAttacking        = 0
        RanksToJustFreeWhenAttacking           = 0
        AttributeModifiers            = ElvenMithlondSentryHordePorcupine
        IsPorcupineFormation            = Yes
        MinimumHordeSize            = 5

        AlternateFormation            = ElvenLorienPikemanHorde
        VisionRearOverride            = 100%
        VisionSideOverride            = 100%
        NotComboFormation            = Yes


        BannerCarriersAllowed    = ElvenBanner
        BannerCarrierPosition    = UnitType:ElvenLorienPikeman    Pos:X:0.0 Y:0.0

        RankInfo        = RankNumber:1 UnitType:ElvenLorienPikeman Position:X:20 Y:0    Position:X:-16.18 Y:11.76        Position:X:6.18 Y:-19.02    Position:X:6.18 Y:19.02    Position:X:-16.18 Y:-11.76    Position:X:36.54 Y:16.27    Position:X:-39.13 Y:8.32    Position:X:26.77 Y:-29.73    Position:X:-4.18 Y:39.78    Position:X:-20 Y:-34.64
   End
End


Object LothlorienGrenzwachterHorde

    SelectPortrait     = UPGrenzwachter
    ButtonImage        = UPGrenzwachter

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags     = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR
        DefaultModelConditionState
            Model         = None
        End
        ModelConditionState     = HORDE_EMPTY
            Model         = None
        End
        ModelConditionState     = WORLD_BUILDER
            Model         = HordeMarkEULoW
        End
    End

    Side                 = Lothlorien
    EditorSorting        = UNIT
    EmotionRange         = 240
    DisplayName          = OBJECT:LothlorienGrenzwachterHorde
    DisplayNameStrategic = CONTROLBAR:LW_Unit_LothlorienGrenzwachterHorde
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_LothlorienGrenzwachter

    WeaponSet
        Conditions     = None
        Weapon         = PRIMARY    NormalMeleeHordeRangefinder
    End

    CommandSet         = LothlorienGrenzwachterHordeCommandSet



    #include "..\..\..\includes\StandardHordeEvaEvents.inc"

    CrushableLevel      = 0
    CrusherLevel        = 0
    BuildCost           = 450
    BuildTime           = MEDIUM_BUILDTIME
    VisionRange         = 200
    VisionSide          = 50%
    VisionRear          = 25%
    VisionBonusPercentPerFoot = 1.0%
    ShroudClearingRange   = 400
    CommandPoints         = 50

    FormationWidth        = 2
    FormationDepth        = 1

    TransportSlotCount    = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf                = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE ARMY_SUMMARY MELEE_HORDE LARGE_RECTANGLE_PATHFIND

    CamouflageDetectionMultiplier     = CAMOUFLAGE_DETECTION_DISTANCE_LONG

    ThreatLevel         = 120
    ThreatBreakdown ElvenLorienWarriorHorde_DetailedThreat
        AIKindOf     = INFANTRY
    End

    Body             = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth     = 1
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = FighterHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle     = Yes ATTACK_BUILDINGS STEALTHED
        MoodAttackCheckRate            = 500
        MaxCowerTime                   = 5000
        MinCowerTime                   = 3000
        CanAttackWhileContained        = Yes
        AILuaEventsList                = InfantryFunctions
        AttackPriority                 = AttackPriority_Infantry
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle         = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay         = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained     =
        InitialPayload             = LothlorienGrenzwachter 10
        Slots                 = 10
        PassengerFilter            = NONE +INFANTRY
        ShowPips             = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset            = X:0 Y:0
        MeleeBehavior             = Amoeba
        End


        BannerCarriersAllowed        = ElvenBanner
        BannerCarrierPosition        = UnitType:LothlorienGrenzwachter    Pos:X:70.0 Y:0.0


        RankInfo = RankNumber:1 UnitType:LothlorienGrenzwachter Position:X:50 Y:0            Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:50 Y:40        Position:X:50 Y:-40
        RankInfo = RankNumber:2 UnitType:LothlorienGrenzwachter Position:X:30 Y:0 Leader 1 0    Position:X:30 Y:20 Leader 1 1    Position:X:30 Y:-20 Leader 1 2    Position:X:30 Y:40 Leader 1 3    Position:X:30 Y:-40 Leader 1 4

        RanksToReleaseWhenAttacking = 1  2

        MeleeAttackLeashDistance     = 1
        BackUpMinDelayTime        = 1
        BackUpMaxDelayTime        = 3000
        BackUpMinDistance        = 1
        BackUpMaxDistance        = 3
        BackupPercentage        = 80%
    End

    #include "..\..\..\includes\DefaultInvisibilityUpdate.inc"

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

     Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded        =    NONE
        AfraidOf            =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf            =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
         PointAt                =    EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance        =    150
        FearScanDistance        =    ARCHER_FEAR_SCAN_RADIUS

        AddEmotion    =    Terror_Base
        AddEmotion    =    Doom_Base
        AddEmotion    =       BraceForBeingCrushed_Base
        AddEmotion    =    UncontrollableFear_Base
        AddEmotion    =    FearIdle_Base
        AddEmotion    =    FearBusy_Base
        AddEmotion    =    Point_Base
        AddEmotion    =    Taunt_Base
        AddEmotion    =    CheerIdle_Base
        AddEmotion    =    CheerBusy_Base
        AddEmotion    =    HeroCheerIdle_Base
        AddEmotion    =    HeroCheerBusy_Base
        AddEmotion    =    Alert_Base
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly         = Yes
        StuffToPickUp         = ANY +CRATE -TheDroppedRing
        ScanRange         = 200
        ScanIntervalSeconds     = 0.5
    End

    LocomotorSet
        Locomotor         = NormalMeleeHordeLocomotor
        Condition         = SET_NORMAL
        Speed             = NORMAL_FOOT_VERYFAST_HORDE_SPEED
    End


    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior         = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy     = Upgrade_BasicTraining
        LevelsToGain     = 1
        LevelCap     = 2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality
        TriggeredBy = Upgrade_HeavyArmor
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_ForgedBlades
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality3
        TriggeredBy = Upgrade_SilverThornArrows
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality4
        TriggeredBy = Upgrade_TechnologyLothlorienLembasbrotAktive
    End

    Behavior = SpecialPowerModule ModuleTag_Lembasbrot
        SpecialPowerTemplate     = SpecialAbilityLembasbrotHealSpell
        UpdateModuleStartsAttack = Yes
    End

    Behavior = SpecialAbilityUpdate ModuleTag_LembasbrotUpdate
        SpecialPowerTemplate     = SpecialAbilityLembasbrotHealSpell
        StartAbilityRange        = 1.6
        UnpackTime               = 1
        PreparationTime          = 3
        PackTime                 = 2096
        AwardXPForTriggering     = 0
    End

    Behavior = AutoHealBehavior ModuleTag_LembasbrotHealing
        StartsActive             = Yes
        ButtonTriggered          = Yes
        HealingAmount            = 300
        Radius                   = 55
        HealOnlyOthers           = No
        SingleBurst              = Yes
        UnitHealPulseFX          = FX_SpellLembasbrotHealUnitHealBuff
        KindOf                   = INFANTRY
    End



    Behavior = SpecialPowerModule ModuleTag_TheodenGloriousChargeUpdate
        SpecialPowerTemplate         = SpecialAbilityHeulenRudelfuhrer
        UpdateModuleStartsAttack     = Yes
        StartsPaused                 = No
        AttributeModifier            = GrenzwachterStandfestigkeit
        AttributeModifierAffectsSelf = Yes
        AttributeModifierFX          = FX_GrenzwachterStandfestigkeitFX
        InitiateSound                = KnightsDolAmrothGloriousCharge
    End

    Behavior = SpecialAbilityUpdate ModuleTag_GloriousChargeAnimation
        UnpackTime                   = 0
        UnpackingVariation           = 1
        SpecialPowerTemplate         = SpecialAbilityHeulenRudelfuhrer
        PreparationTime              = 0
        PersistentPrepTime           = 0
        PackTime                     = 0
     End







    Behavior = AISpecialPowerUpdate ElvenLorienWarriorHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Behavior = AISpecialPowerUpdate Lembas_AI
        CommandButtonName  = Command_SpecialAbilityLembasbrotHealSpell
        SpecialPowerAIType = AI_SPECIAL_POWER_SELFAOEHEALHEROS
    End

    Behavior = AISpecialPowerUpdate NoldorWeaponSongAI
        CommandButtonName  = Command_GrenzwachterStandfestigkeit
        SpecialPowerAIType = AI_SPECIAL_POWER_BASIC_SELF_BUFF
    End

    Geometry         = BOX
    GeometryMajorRadius     = 30.0
    GeometryMinorRadius     = 50.0
    GeometryHeight         = 20.0
    GeometryIsSmall     = No




    AutoResolveUnitType = AutoResolveUnit_Pikemen
    AutoResolveCombatChain = AutoResolve_PikemenCombatChain

    AutoResolveBody = AutoResolve_ElvenMithlondSentryHordeBody

    AutoResolveArmor
        Armor = AutoResolve_ElvenMithlondSentryHeavyArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_ElvenMithlondSentryUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_ElvenMithlondSentryWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTraining Upgrade_ForgedBlades
End

Object LothlorienMirkwoodPalaceGuardHorde


    SelectPortrait         = UPMirkwoodGuard
    ButtonImage            = UIMirkwoodGuard

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags     = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR
        DefaultModelConditionState
            Model     = None
        End
        ModelConditionState = HORDE_EMPTY
            Model = None
        End
        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkEULoW
        End
    End

    Side                 = Lothlorien
    EditorSorting        = UNIT
    EmotionRange         = 240
    DisplayName          = OBJECT:LothlorienMirkwoodPalaceGuardHorde
    DisplayNameStrategic = CONTROLBAR:LW_Unit_LothlorienMirkwoodPalaceGuardHorde
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_LothlorienMirkwoodPalaceGuardHorde

    WeaponSet
        Conditions     = None
        Weapon         = PRIMARY    TowerGuardHordeRangefinder
    End
    WeaponSet
        Conditions     = CONTAINED
        Weapon         = PRIMARY GarrisonedUnitBowHordeRangefinder
    End

    CommandSet = MirkwoodPalaceGuardHordeCommandSet




    #include "..\..\..\includes\StandardHordeEvaEvents.inc"

    CrushableLevel = 0
    CrusherLevel = 0

    BuildCost         = 800
    BuildTime         = MEDIUM_BUILDTIME

    VisionRange            = GONDOR_SPEARMEN_HORDE_VISION_RANGE
    ShroudClearingRange    = GONDOR_SPEARMEN_HORDE_SHROUD_RANGE
    VisionSide             = 50%
    VisionRear             = 25%
    MaxVisionBonusPercent         = 300%
    VisionBonusTestRadius         = 200
    VisionBonusPercentPerFoot     = 1.0%

    CommandPoints         = 60

    FormationWidth = 2
    FormationDepth = 1

    TransportSlotCount = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE ARMY_SUMMARY MELEE_HORDE LARGE_RECTANGLE_PATHFIND PIKE

    ThreatLevel = 150
    ThreatBreakdown ElvenMithlondSentryHorde_DetailedThreat
        AIKindOf = PIKEMAN
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = PikeHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle     = Yes ATTACK_BUILDINGS STEALTHED
        MoodAttackCheckRate            = 500
        MaxCowerTime            = 5000
        MinCowerTime            = 3000
        CanAttackWhileContained        = Yes
        AILuaEventsList                = InfantryFunctions
        AttackPriority                = AttackPriority_Archer
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle   = STANDARD_PIKEMAN_FRONTANGLE
        FlankedDelay = STANDARD_PIKEMAN_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload         = LothlorienMirkwoodPalaceGuard 10
        Slots             = 10
        PassengerFilter     = NONE +INFANTRY
        ShowPips         = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset         = X:0 Y:0
        MeleeBehavior         = Amoeba
        End


        BannerCarriersAllowed    = MirkwoodBanner
        BannerCarrierPosition    = UnitType:LothlorienMirkwoodPalaceGuard Pos:X:70.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:LothlorienMirkwoodPalaceGuard Position:X:50 Y:0        Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:50 Y:40        Position:X:50 Y:-40
        RankInfo = RankNumber:2 UnitType:LothlorienMirkwoodPalaceGuard Position:X:30 Y:0 Leader 1 0    Position:X:30 Y:20 Leader 1 1    Position:X:30 Y:-20 Leader 1 2    Position:X:30 Y:40 Leader 1 3    Position:X:30 Y:-40 Leader 1 4

        RanksToReleaseWhenAttacking     = 1 2

        MeleeAttackLeashDistance = 1
        BackUpMinDelayTime       = 1
        BackUpMaxDelayTime       = 3000
        BackUpMinDistance        = 1
        BackUpMaxDistance        = 3
        BackupPercentage         = 80%

        AlternateFormation = LothlorienMirkwoodPalaceGuardHordePorcupine
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

     Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded        =    NONE
        AfraidOf            =    EMOTION_AFRAIDOF_OBJECTFILTER_LANCERS
        AlwaysAfraidOf            =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER_LANCERS
        PointAt                =    EMOTION_POINTAT_OBJECTFILTER_LANCERS
        HeroScanDistance        =    150
        FearScanDistance        =    INFANTRY_FEAR_SCAN_RADIUS

        AddEmotion    =    Terror_Base
        AddEmotion    =    Doom_Base
        AddEmotion    =    UncontrollableFear_Base
        AddEmotion    =    FearIdle_Base
        AddEmotion    =    FearBusy_Base
        AddEmotion    =    Point_Base
        AddEmotion    =    Taunt_Base
        AddEmotion    =    CheerIdle_Base
        AddEmotion    =    CheerBusy_Base
        AddEmotion    =    HeroCheerIdle_Base
        AddEmotion    =    HeroCheerBusy_Base
        AddEmotion    =    Alert_Base
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End

    LocomotorSet
        Locomotor     = NormalMeleeHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_FOOT_MED_HORDE_SPEED
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTraining
        LevelsToGain = 1
        LevelCap = 2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality
        TriggeredBy = Upgrade_HeavyArmor
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_ForgedBlades
    End





    Behavior = AISpecialPowerUpdate ElvenMithlondSentryHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 45.0
    GeometryHeight = 20.0
    GeometryIsSmall = No




    AutoResolveUnitType = AutoResolveUnit_Pikemen
    AutoResolveCombatChain = AutoResolve_PikemenCombatChain

    AutoResolveBody = AutoResolve_ElvenMithlondSentryHordeBody

    AutoResolveArmor
        Armor = AutoResolve_ElvenMithlondSentryHeavyArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_ElvenMithlondSentryUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_ElvenMithlondSentryWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTraining Upgrade_ForgedBlades
End

ChildObject LothlorienMirkwoodPalaceGuardHordeShieldWall LothlorienMirkwoodPalaceGuardHorde

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle         		 = STANDARD_PIKEMAN_FRONTANGLE
        FlankedDelay        		 = STANDARD_PIKEMAN_FLANKEDDELAY
        ObjectStatusOfContained          =
        InitialPayload                   = LothlorienMirkwoodPalaceGuard 10
        Slots                            = 10
        PassengerFilter                  = NONE +INFANTRY
        ShowPips                         = No
        ThisFormationIsTheMainFormation  = No
        AttributeModifiers               = GilGaladsLeibwachterShieldWall
        RandomOffset                     = X:0 Y:0
        MeleeBehavior = Amoeba
        End


        BannerCarriersAllowed    = MirkwoodBanner
        BannerCarrierPosition    = UnitType:LothlorienMirkwoodPalaceGuard   Pos:X:20.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:LothlorienMirkwoodPalaceGuard Position:X:0 Y:0        Position:X:0 Y:12.5        Position:X:0 Y:-12.5        Position:X:0 Y:25        Position:X:0 Y:-25
        RankInfo = RankNumber:2 UnitType:LothlorienMirkwoodPalaceGuard Position:X:-12.5 Y:0        Position:X:-12.5 Y:12.5        Position:X:-12.5 Y:-12.5        Position:X:-12.5 Y:25        Position:X:-12.5 Y:-25
        RanksToReleaseWhenAttacking = 1

        AlternateFormation = LothlorienMirkwoodPalaceGuardHorde
        MeleeAttackLeashDistance = 1
        BackUpMinDelayTime         = 1
        BackUpMaxDelayTime         = 3000
        BackUpMinDistance         = 1
        BackUpMaxDistance         = 3
        BackupPercentage         = 80%
    End
End


ChildObject LothlorienMirkwoodPalaceGuardHordePorcupine LothlorienMirkwoodPalaceGuardHorde

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle   = STANDARD_PIKEMAN_FRONTANGLE_FORMATION
        FlankedDelay = STANDARD_PIKEMAN_FLANKEDDELAY
        ObjectStatusOfContained         =
        InitialPayload                = LothlorienMirkwoodPalaceGuard 10
        Slots                    = 10
        PassengerFilter                = NONE +INFANTRY
        ShowPips                = No
        ThisFormationIsTheMainFormation     = No
        RandomOffset                = X:2 Y:1
        RanksToReleaseWhenAttacking        = 0
        RanksToJustFreeWhenAttacking           = 0
        AttributeModifiers            = GondorTowerShieldGuardHorde
        IsPorcupineFormation            = Yes
        MinimumHordeSize            = 5

        AlternateFormation            = LothlorienMirkwoodPalaceGuardHorde
        VisionRearOverride            = 100%
        VisionSideOverride            = 100%
        NotComboFormation            = Yes


        BannerCarriersAllowed    = MirkwoodBanner
        BannerCarrierPosition    = UnitType:LothlorienMirkwoodPalaceGuard Pos:X:0.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:LothlorienMirkwoodPalaceGuard Position:X:20 Y:0    Position:X:-16.18 Y:11.76        Position:X:6.18 Y:-19.02    Position:X:6.18 Y:19.02    Position:X:-16.18 Y:-11.76    Position:X:36.54 Y:16.27    Position:X:-39.13 Y:8.32    Position:X:26.77 Y:-29.73    Position:X:-4.18 Y:39.78    Position:X:-20 Y:-34.64
   End
End

Object MirkwoodSpearmenHorde

    SelectPortrait         = UPMirkwoodPikeman
    ButtonImage            = USMirkwoodPikeman

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR EMOTION_LOOK_TO_SKY
        DefaultModelConditionState
            Model = None
        End
        ModelConditionState = HORDE_EMPTY
            Model = None
        End

        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkGUTow
        End
    End

    Side                 = Lothlorien
    EditorSorting        = UNIT
    EmotionRange         = 240
    DisplayName          = OBJECT:HordeMirkwoodSpearmen
    DisplayNameStrategic     = CONTROLBAR:LW_Unit_HordeMirkwoodSpearmen
    DescriptionStrategic     = CONTROLBAR:LW_ToolTip_HordeMirkwoodSpearmen

    WeaponSet
        Conditions = None
        Weapon = PRIMARY    TowerGuardHordeRangefinder
    End






    BuildCost             = 550
    BuildTime             = MEDIUM_BUILDTIME
    VisionRange           = GONDOR_SPEARMEN_HORDE_VISION_RANGE
    ShroudClearingRange   = GONDOR_SPEARMEN_HORDE_SHROUD_RANGE
    VisionSide             = 50%
    VisionRear             = 25%
    MaxVisionBonusPercent         = 300%
    VisionBonusTestRadius         = 200
    VisionBonusPercentPerFoot     = 1.0%
    CommandPoints             = 50

    CommandSet = MirkwoodSpearmenHordeCommandSet

    FormationWidth = 2
    FormationDepth = 1

     CrushableLevel = 0
    CrusherLevel = 0

    TransportSlotCount = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE ARMY_SUMMARY MELEE_HORDE PIKE LARGE_RECTANGLE_PATHFIND
    #include "..\..\..\includes\StandardHordeEvaEvents.inc"

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    ThreatLevel = 115
    ThreatBreakdown GondorTowerShieldGuardHorde_DetailedThreat
        AIKindOf = PIKEMAN
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = PikeHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle    =    Yes ATTACK_BUILDINGS
        MoodAttackCheckRate        =    500
        MaxCowerTime            =    5000
        MinCowerTime            =    3000
        AILuaEventsList            =    InfantryFunctions
        AttackPriority            =     AttackPriority_Spearman
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle   = STANDARD_PIKEMAN_FRONTANGLE
        FlankedDelay = STANDARD_PIKEMAN_FLANKEDDELAY
        ObjectStatusOfContained         =
        InitialPayload             = MirkwoodSpearmen 10
        Slots                 = 10
        PassengerFilter            = NONE +INFANTRY
        ShowPips             = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset            = X:0 Y:0
        MeleeBehavior             = Amoeba
            FacingBonus        = 30.0
            AngleLimitCos        = -0.17
            InnerRange        = 30
            OuterRange        = 80
            OuterRangeBuildings    = 140
        End


        BannerCarriersAllowed    = MirkwoodBanner
        BannerCarrierPosition    = UnitType:MirkwoodSpearmen    Pos:X:70.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:MirkwoodSpearmen Position:X:50 Y:0        Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:50 Y:40        Position:X:50 Y:-40
        RankInfo = RankNumber:2 UnitType:MirkwoodSpearmen Position:X:30 Y:0 Leader 1 0    Position:X:30 Y:20 Leader 1 1    Position:X:30 Y:-20 Leader 1 2    Position:X:30 Y:40 Leader 1 3    Position:X:30 Y:-40 Leader 1 4


        RanksToReleaseWhenAttacking = 1 2

        AlternateFormation         = MirkwoodSpearmenHordePorcupine
        MeleeAttackLeashDistance     = 1
        BackUpMinDelayTime        = 1
        BackUpMaxDelayTime        = 3000
        BackUpMinDistance        = 1
        BackUpMaxDistance        = 3
        BackupPercentage        = 80%
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

       Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded        =    NONE
         AfraidOf            =    EMOTION_AFRAIDOF_OBJECTFILTER_LANCERS
        AlwaysAfraidOf            =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER_LANCERS
         PointAt                =    EMOTION_POINTAT_OBJECTFILTER_LANCERS
        HeroScanDistance        =    150
        FearScanDistance        =    INFANTRY_FEAR_SCAN_RADIUS

        AddEmotion            =    Terror_Base
        AddEmotion            =    Doom_Base
        AddEmotion            =    UncontrollableFear_Base
        AddEmotion            =    FearIdle_Base
        AddEmotion            =    FearBusy_Base
        AddEmotion            =    Point_Base

        AddEmotion            =    OVERRIDE Taunt_Base
         End

        AddEmotion        =    CheerIdle_Base
        AddEmotion        =    CheerBusy_Base
        AddEmotion        =    HeroCheerIdle_Base
        AddEmotion        =    HeroCheerBusy_Base
        AddEmotion        =    Alert_Base
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly         = Yes
        StuffToPickUp         = ANY +CRATE -TheDroppedRing
        ScanRange         = 200
        ScanIntervalSeconds     = 0.5
    End

    LocomotorSet
        Locomotor     = NormalMeleeHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_FOOT_VERYFAST_HORDE_SPEED
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    Behavior         = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy     = Upgrade_BasicTraining
        LevelsToGain     = 1
        LevelCap     = 2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality
        TriggeredBy = Upgrade_HeavyArmor
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_ForgedBlades
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality3
        TriggeredBy = Upgrade_SilverThornArrows
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality4
        TriggeredBy = Upgrade_ElvenCloak
    End

    Behavior = DoCommandUpgrade Module_DoCommandUpgradeAI
        TriggeredBy                     = Upgrade_TechnologyElvenCloak
        GetUpgradeCommandButtonName     = Command_PurchaseUpgradeMirkwoodElvenCloak
    End

    Behavior = SpecialPowerModule ModuleTag_ElfCloakStarter
        SpecialPowerTemplate      = SpecialAbilityElfCloak
        UpdateModuleStartsAttack  = Yes
        StartsPaused              = No
    End

    Behavior = ToggleHiddenSpecialAbilityUpdate ModuleTag_ElfCloakUpdate
        SpecialPowerTemplate = SpecialAbilityElfCloak
    End





    Behavior = InvisibilityUpdate ModuleTag_ElvenCloak
        InvisibilityNugget
            InvisibilityType    = STEALTH
            ForbiddenConditions    = MOVING FIRING_ANY TAKING_DAMAGE
            BecomeStealthedFX       = FX_ElvenCloakOn
            ExitStealthFX           = FX_ElvenCloakOff
            Options            = UNTOGGLE_HIDDEN_WHEN_LEAVING_STEALTH
        End
        StartsActive            = No
        UpdatePeriod            = 2000
    End






    Behavior = AISpecialPowerUpdate GondorTowerShieldGuardHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End


    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 45.0
    GeometryHeight = 20.0
    GeometryIsSmall = No

    AutoResolveUnitType = AutoResolveUnit_Pikemen
    AutoResolveCombatChain = AutoResolve_PikemenCombatChain

    AutoResolveBody = AutoResolve_GondorTowerGuardHordeBody

    AutoResolveArmor
        Armor = AutoResolve_GondorTowerGuardHeavyArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_GondorTowerGuardUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_GondorTowerGuardWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTraining Upgrade_ForgedBlades Upgrade_ElvenCloak
End

ChildObject MirkwoodSpearmenHordePorcupine MirkwoodSpearmenHorde

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle   = STANDARD_PIKEMAN_FRONTANGLE_FORMATION
        FlankedDelay = STANDARD_PIKEMAN_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload                    = MirkwoodSpearmen 10
        Slots                            = 10
        PassengerFilter                    = NONE +INFANTRY
        ShowPips                        = No
        ThisFormationIsTheMainFormation = No
        RandomOffset                    = X:2 Y:1
        RanksToReleaseWhenAttacking        = 0
        RanksToJustFreeWhenAttacking   = 0
        AttributeModifiers                = GondorSpearmanHordePorcupine
        IsPorcupineFormation            = Yes
        MinimumHordeSize                = 5

        AlternateFormation                = MirkwoodSpearmenHorde
        VisionRearOverride                = 100%
        VisionSideOverride                = 100%
        NotComboFormation                = Yes


        BannerCarriersAllowed            = MirkwoodBanner
        BannerCarrierPosition            = UnitType:MirkwoodSpearmen    Pos:X:0.0 Y:0.0

        RankInfo    = RankNumber:1 UnitType:MirkwoodSpearmen Position:X:20 Y:0    Position:X:-16.18 Y:11.76        Position:X:6.18 Y:-19.02    Position:X:6.18 Y:19.02    Position:X:-16.18 Y:-11.76    Position:X:36.54 Y:16.27    Position:X:-39.13 Y:8.32    Position:X:26.77 Y:-29.73    Position:X:-4.18 Y:39.78    Position:X:-20 Y:-34.64
    End
End

Object MirkwoodArcherHorde

    ButtonImage     = USMirkwoodArchersNew
    SelectPortrait  = UPMirkwoodArchersNew


    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR
        DefaultModelConditionState
            Model = None
        End
        ModelConditionState = HORDE_EMPTY
            Model = None
        End
        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkEULoW
        End
    End

    Side = Lothlorien
    EditorSorting = UNIT
    EmotionRange = 240
    DisplayName = OBJECT:MirkwoodArcherHorde
    DisplayNameStrategic = CONTROLBAR:LW_Unit_MirkwoodWachterPfadeHorde
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_MirkwoodWachterPfadeHorde

     WeaponSet
        Conditions = None
        Weapon = PRIMARY    MirkwoodPfadeArcherMissileHordeRangefinder
        Weapon = TERTIARY   MirkwoodPfadeMissileHordeRangefinderBombard
        AutoChooseSources = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
        AutoChooseSources = TERTIARY FROM_PLAYER FROM_SCRIPT
    End

    CommandSet = MirkwoodWachterPfadeHordeCommandSet

    #include "..\..\..\includes\StandardHordeEvaEvents.inc"

    CrushableLevel = 0
    CrusherLevel = 0

    BuildCost = 700
    BuildTime = MEDIUM_BUILDTIME
    VisionRange = 470
    VisionSide = 50%
    VisionRear = 25%
    VisionBonusPercentPerFoot = 1.0%
    ShroudClearingRange = 470
    CommandPoints = 50

    FormationWidth = 2
    FormationDepth = 1

    TransportSlotCount = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE ARCHER ARMY_SUMMARY LARGE_RECTANGLE_PATHFIND
    CamouflageDetectionMultiplier = CAMOUFLAGE_DETECTION_DISTANCE_LONG

    ThreatLevel = 115
    ThreatBreakdown ElvenLorienWarriorHorde_DetailedThreat
        AIKindOf = ARCHER
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = FighterHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate        = 500
        MaxCowerTime                =    5000
        MinCowerTime                =    3000
        CanAttackWhileContained    = Yes
        AILuaEventsList                = InfantryFunctions
        AttackPriority                =     AttackPriority_Archer
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle         = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay         = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload = MirkwoodArcher 10
        Slots = 10
        PassengerFilter    = NONE +INFANTRY
        ShowPips = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset  = X:0 Y:0
        MeleeBehavior = Amoeba
        End

        BannerCarriersAllowed    = MirkwoodBanner
        BannerCarrierPosition    = UnitType:MirkwoodArcher   Pos:X:70.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:MirkwoodArcher  Position:X:50 Y:0    Position:X:50 Y:20     Position:X:50 Y:-20    Position:X:50 Y:40        Position:X:50 Y:-40
        RankInfo = RankNumber:2 UnitType:MirkwoodArcher  Position:X:30 Y:0 Leader 1 0   Position:X:30 Y:20 Leader 1 1   Position:X:30 Y:-20 Leader 1 2    Position:X:30 Y:40 Leader 1 3    Position:X:30 Y:-40 Leader 1 4

        RanksToReleaseWhenAttacking = 1  2

        MeleeAttackLeashDistance = 1
        BackUpMinDelayTime        = 1
        BackUpMaxDelayTime        = 3000
        BackUpMinDistance        = 1
        BackUpMaxDistance        = 3
        BackupPercentage        = 80%
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

    Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded        =    NONE
        AfraidOf                    =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf                =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
         PointAt                        =    EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance        =    150
        FearScanDistance        =    ARCHER_FEAR_SCAN_RADIUS


        AddEmotion    =    Terror_Base
        AddEmotion    =    Doom_Base
        AddEmotion    =   BraceForBeingCrushed_Base
        AddEmotion    =    UncontrollableFear_Base
        AddEmotion    =    FearIdle_Base
        AddEmotion    =    FearBusy_Base
        AddEmotion    =    Point_Base
        AddEmotion    =    Taunt_Base
        AddEmotion    =    CheerIdle_Base
        AddEmotion    =    CheerBusy_Base
        AddEmotion    =    HeroCheerIdle_Base
        AddEmotion    =    HeroCheerBusy_Base
        AddEmotion    =    Alert_Base
    End


    Behavior = SpecialPowerModule ModuleTag_LongShot
        SpecialPowerTemplate        = SpecialAbilityHaradrimArcherBarbedArrow
        UpdateModuleStartsAttack    = Yes
        StartsPaused                = No
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_FireballUpdate
        SpecialPowerTemplate        = SpecialAbilityHaradrimArcherBarbedArrow
        PackTime                    = 3000
        StartAbilityRange           = #SUBTRACT( MORDOR_HARADRIM_BOW_RANGE 100 )
        SpecialWeapon               = MirkwoodDornArrowRangeFinder
        ApproachUntilMembersInRange = Yes
    End

    Behavior = AutoAbilityBehavior ModuleTag_AutoAbilityBehaviorBarbedArrows
        SpecialAbility      = SpecialAbilityHaradrimArcherBarbedArrow
		ForbiddenStatus     = INSIDE_GARRISON
		MaxScanRange	    = 250.0
		Query		    	= 1 ANY ENEMIES +HERO +MONSTER
		Query		    	= 10 ALL ENEMIES -STRUCTURE
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End

    LocomotorSet
        Locomotor     = NormalMeleeHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_ELVEN_FAST_HORDE_SPEED
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTraining
        LevelsToGain = 1
        LevelCap = 2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality
        TriggeredBy = Upgrade_HeavyArmor
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_SilverThornArrows
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality3
        TriggeredBy = Upgrade_ElvenCloak
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality4
        TriggeredBy = Upgrade_LothlorienLongBows
    End

    Behavior = DoCommandUpgrade Module_DoCommandUpgradeAI
        TriggeredBy                     = Upgrade_TechnologyElvenCloak
        GetUpgradeCommandButtonName     = Command_PurchaseUpgradeMirkwoodElvenCloak
    End

    Behavior = SpecialPowerModule ModuleTag_ElfCloakStarter
        SpecialPowerTemplate      = SpecialAbilityElfCloak
        UpdateModuleStartsAttack  = Yes
        StartsPaused              = No
    End

    Behavior = ToggleHiddenSpecialAbilityUpdate ModuleTag_ElfCloakUpdate
        SpecialPowerTemplate = SpecialAbilityElfCloak
    End





    Behavior = InvisibilityUpdate ModuleTag_ElvenCloak
        InvisibilityNugget
            InvisibilityType    = STEALTH
            ForbiddenConditions    = MOVING FIRING_ANY TAKING_DAMAGE
            BecomeStealthedFX       = FX_ElvenCloakOn
            ExitStealthFX           = FX_ElvenCloakOff
            Options            = UNTOGGLE_HIDDEN_WHEN_LEAVING_STEALTH
        End
        StartsActive            = No
        UpdatePeriod            = 2000
    End







    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName  = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName  = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName  = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Behavior = AISpecialPowerUpdate ElvenLorienWarriorHordeCaptureBuildingAI
        CommandButtonName  = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 45.0
    GeometryHeight = 20.0
    GeometryIsSmall = No



    AutoResolveUnitType = AutoResolveUnit_Archer
    AutoResolveCombatChain = AutoResolve_ArcherCombatChain

    AutoResolveBody = AutoResolve_ElvenLorienArcherHordeBody

    AutoResolveArmor
        Armor = AutoResolve_ElvenLorienArcherHeavyArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_SilverThornArrows
        Weapon = AutoResolve_ElvenLorienArcherUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_SilverThornArrows
        Weapon = AutoResolve_ElvenLorienArcherWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTraining Upgrade_SilverThornArrows Upgrade_LothlorienLongBows Upgrade_ElvenCloak
End

Object MirkwoodAvariWarriorHorde

    ButtonImage           = HSAvari
    SelectPortrait        = UPAvari

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags     = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR
        DefaultModelConditionState
            Model         = None
        End
        ModelConditionState     = HORDE_EMPTY
            Model         = None
        End
        ModelConditionState     = WORLD_BUILDER
            Model         = HordeMarkEULoW
        End
    End

    Side                  = Lothlorien
    EditorSorting         = UNIT
    EmotionRange          = 240
    DisplayName           = OBJECT:MirkwoodAvariWarrior
    DisplayNameStrategic  = CONTROLBAR:LW_Unit_MirkwoodAvariWarrior
    DescriptionStrategic  = CONTROLBAR:LW_ToolTip_MirkwoodAvariWarrior


    WeaponSet
        Conditions     = None
        Weapon         = PRIMARY    NormalMeleeHordeRangefinder
    End

    CommandSet         = MirkwoodAvariHordeCommandSet

    #include "..\..\..\includes\StandardHordeEvaEvents.inc"

    CrushableLevel         = 0
    CrusherLevel         = 0

    BuildCost         = 450
    BuildTime         = MEDIUM_BUILDTIME
    VisionRange         = 200
    VisionSide     = 50%
    VisionRear         = 25%
    VisionBonusPercentPerFoot = 1.0%
    ShroudClearingRange         = 400
    CommandPoints         = 50

    FormationWidth         = 2
    FormationDepth         = 1

    TransportSlotCount         = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf             = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE ARMY_SUMMARY MELEE_HORDE LARGE_RECTANGLE_PATHFIND
    CamouflageDetectionMultiplier = CAMOUFLAGE_DETECTION_DISTANCE_LONG
    ThreatLevel         = ELVEN_LORIENWARRIOR_HORDE_THREAT

    ThreatBreakdown ElvenLorienWarriorHorde_DetailedThreat
        AIKindOf     = INFANTRY
    End

    Body             = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth    = 1
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = FighterHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle    =    Yes ATTACK_BUILDINGS
        MoodAttackCheckRate        =    500
        MaxCowerTime            =    5000
        MinCowerTime            =    3000
        CanAttackWhileContained        =    Yes
        AILuaEventsList            =    InfantryFunctions
        AttackPriority            =     AttackPriority_Archer
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle         = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay         = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained     =
        InitialPayload             = MirkwoodAvariWarrior 10
        Slots                 = 10
        PassengerFilter            = NONE +INFANTRY
        ShowPips             = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset            = X:0 Y:0
        MeleeBehavior             = Amoeba
        End


        BannerCarriersAllowed        = ElvenMirkwoodArcherBanner
        BannerCarrierPosition        = UnitType:MirkwoodAvariWarrior    Pos:X:30.0 Y:0.0


        RankInfo = RankNumber:1 UnitType:MirkwoodAvariWarrior Position:X:0 Y:0    Position:X:0 Y:25    Position:X:0 Y:-25    Position:X:0 Y:50    Position:X:0 Y:-50
        RankInfo = RankNumber:2 UnitType:MirkwoodAvariWarrior Position:X:20 Y:0    Position:X:20 Y:25    Position:X:20 Y:-25    Position:X:20 Y:50    Position:X:20 Y:-50


        RanksToReleaseWhenAttacking = 1 2

        AlternateFormation        = MirkwoodAvariWarriorHordeBlock

        MeleeAttackLeashDistance     = 1
        BackUpMinDelayTime        = 1
        BackUpMaxDelayTime        = 3000
        BackUpMinDistance        = 1
        BackUpMaxDistance        = 3
        BackupPercentage        = 80%
    End


    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

     Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded        =    NONE
        AfraidOf            =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf            =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
         PointAt                =    EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance        =    150
        FearScanDistance        =    ARCHER_FEAR_SCAN_RADIUS



        AddEmotion    =    Terror_Base
        AddEmotion    =    Doom_Base
        AddEmotion    =       BraceForBeingCrushed_Base
        AddEmotion    =    UncontrollableFear_Base
        AddEmotion    =    FearIdle_Base
        AddEmotion    =    FearBusy_Base
        AddEmotion    =    Point_Base
        AddEmotion    =    Taunt_Base
        AddEmotion    =    CheerIdle_Base
        AddEmotion    =    CheerBusy_Base
        AddEmotion    =    HeroCheerIdle_Base
        AddEmotion    =    HeroCheerBusy_Base
        AddEmotion    =    Alert_Base
    End





    Behavior = InvisibilityUpdate ModuleTag_ElvenCloak
        InvisibilityNugget
            InvisibilityType    = STEALTH
            ForbiddenConditions    = MOVING FIRING_ANY TAKING_DAMAGE
            BecomeStealthedFX       = FX_ElvenCloakOn
            ExitStealthFX           = FX_ElvenCloakOff
            Options            = UNTOGGLE_HIDDEN_WHEN_LEAVING_STEALTH
        End
        StartsActive            = No
        UpdatePeriod            = 2000
    End



    Behavior     = InvisibilityUpdate ModuleTag_ElvenCamouflage
        InvisibilityNugget
            InvisibilityType    = CAMOUFLAGE
            DetectionRange        = CAMOUFLAGE_RADIUS
            ForbiddenConditions    = MOVING FIRING_ANY
            Options                = ALLOW_NEAR_TREES
        End
        UpdatePeriod            = 2000
        StartsActive            = Yes
        UnitSpecificSoundNameToUseAsVoiceMoveToStealthyArea = VoiceMoveToTrees
        UnitSpecificSoundNameToUseAsVoiceEnterStateMoveToStealthyArea = VoiceEnterStateMoveToTrees
    End



    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly       = Yes
        StuffToPickUp        = ANY +CRATE -TheDroppedRing
        ScanRange            = 200
        ScanIntervalSeconds  = 0.5
    End

    LocomotorSet
        Locomotor         = NormalMeleeHordeLocomotor
        Condition         = SET_NORMAL
        Speed             = NORMAL_FOOT_VERYFAST_HORDE_SPEED
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior         = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy  = Upgrade_BasicTraining
        LevelsToGain = 1
        LevelCap     = 2
    End


    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality
        TriggeredBy = Upgrade_ForgedBlades
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_ElvenCloak
    End


    Behavior = SpecialPowerModule ModuleTag_ElfCloakStarter
        SpecialPowerTemplate      = SpecialAbilityElfCloak
        UpdateModuleStartsAttack  = Yes
        StartsPaused              = No
    End

    Behavior = ToggleHiddenSpecialAbilityUpdate ModuleTag_ElfCloakUpdate
        SpecialPowerTemplate      = SpecialAbilityElfCloak
    End







    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_SpionageEnabler
        SpecialPowerTemplate = SpecialAbilityAvariSpionage
        TriggeredBy = Upgrade_ObjectLevel2
    End

    Behavior = SpecialPowerModule ModuleTag_SpionagePower
        SpecialPowerTemplate        = SpecialAbilityAvariSpionage
        UpdateModuleStartsAttack    = Yes
        StartsPaused                = Yes
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_SpionageUpdate
        SpecialPowerTemplate    = SpecialAbilityAvariSpionage
        SkipContinue            = Yes
        UnpackTime              = 1500
         PreparationTime         = 1
         PersistentPrepTime      = 1000
         PackTime                = 500
        AwardXPForTriggering    = 0
        StartAbilityRange        = 290
        ApproachRequiresLOS        = Yes
        SpecialWeapon            = AvariSpionageObjectWeapon
        MustFinishAbility        = Yes
        WhichSpecialWeapon        = 3
        BusyForDuration            = 2500
    End







    Behavior = AISpecialPowerUpdate ElvenLorienWarriorHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End


    Geometry         = BOX
    GeometryMajorRadius     = 30.0
    GeometryMinorRadius     = 50.0
    GeometryHeight         = 20.0
    GeometryIsSmall     = No




    AutoResolveUnitType = AutoResolveUnit_Soldier
    AutoResolveCombatChain = AutoResolve_SoldierCombatChain

    AutoResolveBody = AutoResolve_ElvenLorienWarriorHordeBody

    AutoResolveArmor
        Armor = AutoResolve_ElvenLorienWarriorHeavyArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_ElvenLorienWarriorUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_ElvenLorienWarriorWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTraining Upgrade_ForgedBlades
End

ChildObject MirkwoodAvariWarriorHordeBlock MirkwoodAvariWarriorHorde

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle         = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay         = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload = MirkwoodAvariWarrior 10
        Slots = 10
        PassengerFilter    = NONE +INFANTRY
        ShowPips = No
        ThisFormationIsTheMainFormation = No
        AttributeModifiers = AvariHordeBlockBonus
        MeleeBehavior = Amoeba
        End


        BannerCarriersAllowed        = ElvenMirkwoodArcherBanner
        BannerCarrierPosition        = UnitType:MirkwoodAvariWarrior    Pos:X:0.0 Y:0.0


        RankInfo = RankNumber:1 UnitType:MirkwoodAvariWarrior Position:X:70 Y:0            Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:30 Y:30        Position:X:30 Y:-30
        RankInfo = RankNumber:2 UnitType:MirkwoodAvariWarrior Position:X:10 Y:30 Leader 1 0    Position:X:10 Y:-30 Leader 1 1    Position:X:-10 Y:20 Leader 1 2    Position:X:-10 Y:-20 Leader 1 3    Position:X:-30 Y:0 Leader 1 4

        RanksToReleaseWhenAttacking = 1 2

        AlternateFormation        = MirkwoodAvariWarriorHorde
        MeleeAttackLeashDistance  = 1
        BackUpMinDelayTime        = 1
        BackUpMaxDelayTime        = 3000
        BackUpMinDistance         = 1
        BackUpMaxDistance         = 3
        BackupPercentage          = 80%
    End

End

Object MirkwoodWarriorHorde


    ButtonImage           =    USMirkwoodWarriorNew
    SelectPortrait        =    UPMirkwoodSword


    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags     = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR
        DefaultModelConditionState
            Model         = None
        End
        ModelConditionState     = HORDE_EMPTY
            Model         = None
        End
        ModelConditionState     = WORLD_BUILDER
            Model         = HordeMarkEULoW
        End
    End

    Side                  = Lothlorien
    EditorSorting         = UNIT
    EmotionRange          = 240
    DisplayName           = OBJECT:HordeMirkwoodWarrior
    DisplayNameStrategic  = CONTROLBAR:LW_Unit_MirkwoodWarrior
    DescriptionStrategic  = CONTROLBAR:LW_ToolTip_MirkwoodWarriorHorde


    WeaponSet
        Conditions     = None
        Weapon         = PRIMARY    NormalMeleeHordeRangefinder
    End

    CommandSet         = MirkwoodWarriorHordeCommandSet





    #include "..\..\..\includes\StandardHordeEvaEvents.inc"


     CrushableLevel         = 0
    CrusherLevel         = 0

    BuildCost         = 500
    BuildTime         = MEDIUM_BUILDTIME
    VisionRange         = ELVEN_LORIENWARRIOR_HORDE_VISION_RANGE
    VisionSide     = 50%
    VisionRear         = 25%
    VisionBonusPercentPerFoot = 1.0%
    ShroudClearingRange         = ELVEN_MIRKWOOD_ARCHER_HORDE_SHROUD_RANGE
    CommandPoints         = 50

    FormationWidth         = 2
    FormationDepth         = 1

    TransportSlotCount         = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf             = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE ARMY_SUMMARY MELEE_HORDE LARGE_RECTANGLE_PATHFIND
    CamouflageDetectionMultiplier = CAMOUFLAGE_DETECTION_DISTANCE_LONG

    ThreatLevel         = 115
    ThreatBreakdown ElvenLorienWarriorHorde_DetailedThreat
        AIKindOf     = INFANTRY
    End

    Body             = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth     = 1
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = FighterHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle     = Yes ATTACK_BUILDINGS STEALTHED
        MoodAttackCheckRate            = 500
        MaxCowerTime            = 5000
        MinCowerTime            = 3000
        CanAttackWhileContained        = Yes
        AILuaEventsList                = InfantryFunctions
        AttackPriority                = AttackPriority_Archer
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle         = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay         = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained     =
        InitialPayload             = MirkwoodWarrior 10
        Slots                 = 10
        PassengerFilter            = NONE +INFANTRY
        ShowPips             = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset            = X:0 Y:0
        MeleeBehavior             = Amoeba
        End


        BannerCarriersAllowed        = MirkwoodBanner
        BannerCarrierPosition        = UnitType:MirkwoodWarrior    Pos:X:70.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:MirkwoodWarrior Position:X:50 Y:0   Position:X:50 Y:20     Position:X:50 Y:-20    Position:X:50 Y:40        Position:X:50 Y:-40
        RankInfo = RankNumber:2 UnitType:MirkwoodWarrior Position:X:30 Y:0 Leader 1 0    Position:X:30 Y:20 Leader 1 1    Position:X:30 Y:-20 Leader 1 2    Position:X:30 Y:40 Leader 1 3    Position:X:30 Y:-40 Leader 1 4

        RanksToReleaseWhenAttacking = 1  2

        MeleeAttackLeashDistance     = 1
        BackUpMinDelayTime        = 1
        BackUpMaxDelayTime        = 3000
        BackUpMinDistance        = 1
        BackUpMaxDistance        = 3
        BackupPercentage        = 80%
    End


    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

     Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded        =    NONE
        AfraidOf            =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf            =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
         PointAt                =    EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance        =    150
        FearScanDistance        =    ARCHER_FEAR_SCAN_RADIUS
        AddEmotion    =    Terror_Base
        AddEmotion    =    Doom_Base
        AddEmotion    =       BraceForBeingCrushed_Base
        AddEmotion    =    UncontrollableFear_Base
        AddEmotion    =    FearIdle_Base
        AddEmotion    =    FearBusy_Base
        AddEmotion    =    Point_Base
        AddEmotion    =    Taunt_Base
        AddEmotion    =    CheerIdle_Base
        AddEmotion    =    CheerBusy_Base
        AddEmotion    =    HeroCheerIdle_Base
        AddEmotion    =    HeroCheerBusy_Base
        AddEmotion    =    Alert_Base
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly       = Yes
        StuffToPickUp        = ANY +CRATE -TheDroppedRing
        ScanRange            = 200
        ScanIntervalSeconds  = 0.5
    End

    LocomotorSet
        Locomotor         = NormalMeleeHordeLocomotor
        Condition         = SET_NORMAL
        Speed             = NORMAL_FOOT_VERYFAST_HORDE_SPEED
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior         = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy     = Upgrade_BasicTraining
        LevelsToGain     = 1
        LevelCap     = 2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality
        TriggeredBy = Upgrade_HeavyArmor
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_ForgedBlades
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality3
        TriggeredBy = Upgrade_SilverThornArrows
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality4
        TriggeredBy = Upgrade_ElvenCloak
    End

    Behavior = DoCommandUpgrade Module_DoCommandUpgradeAI
        TriggeredBy                     = Upgrade_TechnologyElvenCloak
        GetUpgradeCommandButtonName     = Command_PurchaseUpgradeMirkwoodElvenCloak
    End

    Behavior = SpecialPowerModule ModuleTag_ElfCloakStarter
        SpecialPowerTemplate      = SpecialAbilityElfCloak
        UpdateModuleStartsAttack  = Yes
        StartsPaused              = No
    End

    Behavior = ToggleHiddenSpecialAbilityUpdate ModuleTag_ElfCloakUpdate
        SpecialPowerTemplate = SpecialAbilityElfCloak
    End





    Behavior = InvisibilityUpdate ModuleTag_ElvenCloak
        InvisibilityNugget
            InvisibilityType    = STEALTH
            ForbiddenConditions    = MOVING FIRING_ANY TAKING_DAMAGE
            BecomeStealthedFX       = FX_ElvenCloakOn
            ExitStealthFX           = FX_ElvenCloakOff
            Options            = UNTOGGLE_HIDDEN_WHEN_LEAVING_STEALTH
        End
        StartsActive            = No
        UpdatePeriod            = 2000
    End





    Behavior = AISpecialPowerUpdate ElvenLorienWarriorHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End


    Geometry         = BOX
    GeometryMajorRadius     = 30.0
    GeometryMinorRadius     = 50.0
    GeometryHeight         = 20.0
    GeometryIsSmall     = No




    AutoResolveUnitType = AutoResolveUnit_Soldier
    AutoResolveCombatChain = AutoResolve_SoldierCombatChain

    AutoResolveBody = AutoResolve_ElvenLorienWarriorHordeBody

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_ElvenLorienWarriorUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_ElvenLorienWarriorWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTraining Upgrade_ForgedBlades Upgrade_ElvenCloak
End

Object MirkwoodElkriderHorde

    ButtonImage        = HIElkrider_Wotr
    SelectPortrait     = UPElkrider

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR EMOTION_CELEBRATING
        DefaultModelConditionState
            Model = None
        End
        ModelConditionState = HORDE_EMPTY
            Model = None
        End
        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkEURIL
        End
    End

    Side                 = Lothlorien
    EditorSorting        = UNIT
    EmotionRange         = 240
    DisplayName          = OBJECT:MirkwoodElkriderHorde
    DisplayNameStrategic = CONTROLBAR:LW_Unit_MirkwoodElkriderHordeHorde
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_MirkwoodElkriderHordeHorde

    WeaponSet
        Conditions    = None
        Weapon        = PRIMARY  ElkriderHordeRangefinder
    End





    #include "..\..\..\includes\StandardHordeEvaEvents.inc"

    BuildCost          = 670
    BuildTime          = STRONG_BUILDTIME
    VisionRange        = ELVEN_RIVENDELLARCHER_HORDE_VISION_RANGE
    VisionSide         = 50%
    VisionRear         = 25%
    VisionBonusPercentPerFoot = 1.0%
    ShroudClearingRange     = ELVEN_RIVENDELLARCHER_SHROUD_RANGE
    CommandPoints      = 60
    MaxSimultaneousOfType    = 5

    FormationWidth         = 2
    FormationDepth         = 1

    CrushableLevel              = 2
    CrusherLevel                = 1
    MinCrushVelocityPercent = MINCRUSHVELOCITYPERCENT_STANDARD
    CrushDecelerationPercent = CRUSHDECELERATIONPERCENT_STANDARD
    CrushKnockback              = 40
    CrushZFactor                = 1.0
    TransportSlotCount          = TRANSPORTSLOTCOUNT_SMALL_HORDE

    KindOf                    = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT CAVALRY HORDE MELEE_HORDE ARMY_SUMMARY LARGE_RECTANGLE_PATHFIND
    CommandSet                = ElkriderHordeCommandSet

    CamouflageDetectionMultiplier = CAMOUFLAGE_DETECTION_DISTANCE_LONG
    ThreatLevel = 120
    ThreatBreakdown ElvenRivendellLancerHorde_DetailedThreat
        AIKindOf = CAVALRY
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = CavalryHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle  = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate         = 500
        MaxCowerTime                = 5000
        MinCowerTime                = 3000
        AILuaEventsList             = RohirrimFunctions
        AttackPriority              = AttackPriority_Cavalry
        Turret
            TurretTurnRate            = 360
            ControlledWeaponSlots    = PRIMARY
        End
    End

    Behavior = HorseHordeContain ModuleTag_HordeContain
        FrontAngle         = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay         = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload         = MirkwoodElkrider  10
        Slots             = 10
        PassengerFilter     = NONE +CAVALRY
        ShowPips         = No
        RandomOffset         = X:2 y:3
        MeleeBehavior         = Amoeba
        End

        ThisFormationIsTheMainFormation = Yes


        BannerCarriersAllowed    = ElkriderBanner
        BannerCarrierPosition    = UnitType:MirkwoodElkrider    Pos:X:75.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:MirkwoodElkrider Position:X:45 Y:0            Position:X:45 Y:20        Position:X:45 Y:-20        Position:X:45 Y:40        Position:X:45 Y:-40
        RankInfo = RankNumber:2 UnitType:MirkwoodElkrider Position:X:10 Y:0 Leader 1 0    Position:X:10 Y:20 Leader 1 1    Position:X:10 Y:-20 Leader 1 2    Position:X:10 Y:40 Leader 1 3    Position:X:10 Y:-40 Leader 1 4

        RanksToReleaseWhenAttacking = 1 2

        AlternateFormation        = MirkwoodElkriderHordeWedgeFormation
        MeleeAttackLeashDistance  = 1
        BackUpMinDelayTime        = 1
        BackUpMaxDelayTime        = 3000
        BackUpMinDistance         = 1
        BackUpMaxDistance         = 3
        BackupPercentage          = 80%
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

    Behavior = HordeNotifyTargetsOfImminentProbableCrushingUpdate ModuleTag_NotifyCrushScan
        ScanWidth = 70.0
    End

    Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay     =    1000
        TauntAndPointExcluded        =    NONE
        AfraidOf                     =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf               =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
        PointAt                      =    EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance             =    150
        FearScanDistance             =    CAVALRY_FEAR_SCAN_RADIUS

        AddEmotion            =    Terror_Base
        AddEmotion            =    Doom_Base
        AddEmotion            =    BraceForBeingCrushed_Base
        AddEmotion            =    UncontrollableFear_Base
        AddEmotion            =    FearIdle_Base
        AddEmotion            =    FearBusy_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
        AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    HeroCheerIdle_Base
        AddEmotion            =    HeroCheerBusy_Base
        AddEmotion            =    Alert_Base
        AddEmotion            =    CheerForAboutToCrush_Base
     End

    LocomotorSet
        Locomotor     = NormalCavalryHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_MOUNTED_VERYFAST_HORDE_SPEED
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTraining
        LevelsToGain = 1
        LevelCap = 2
    End


    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality
        TriggeredBy = Upgrade_SilverThornArrows
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_HeavyArmor
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality3
        TriggeredBy = Upgrade_ElvenCloak
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality4
        TriggeredBy = Upgrade_LothlorienLongBows
    End

    Behavior = DoCommandUpgrade Module_DoCommandUpgradeAI
        TriggeredBy                     = Upgrade_TechnologyElvenCloak
        GetUpgradeCommandButtonName     = Command_PurchaseUpgradeMirkwoodElvenCloak
    End

    Behavior = AttributeModifierUpgrade ModuleTag_SHU
        TriggeredBy            = Upgrade_LothlorienLongBows
        AttributeModifier      = LongbowsModifier
    End

    Behavior = SpecialPowerModule ModuleTag_ElfCloakStarter
        SpecialPowerTemplate      = SpecialAbilityElfCloak
        UpdateModuleStartsAttack  = Yes
        StartsPaused              = No
    End

    Behavior = ToggleHiddenSpecialAbilityUpdate ModuleTag_ElfCloakUpdate
        SpecialPowerTemplate = SpecialAbilityElfCloak
    End

    Behavior = InvisibilityUpdate ModuleTag_ElvenCloak
        InvisibilityNugget
            InvisibilityType    = STEALTH
            ForbiddenConditions    = MOVING FIRING_ANY TAKING_DAMAGE
            BecomeStealthedFX       = FX_ElvenCloakOn
            ExitStealthFX           = FX_ElvenCloakOff
            Options            = UNTOGGLE_HIDDEN_WHEN_LEAVING_STEALTH
        End
        StartsActive            = No
        UpdatePeriod            = 2000
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End





    Behavior = AISpecialPowerUpdate ElvenMirkwoodArcherHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 40.0
    GeometryHeight = 20.0
    GeometryIsSmall = No




    AutoResolveUnitType = AutoResolveUnit_Cavalry
    AutoResolveCombatChain = AutoResolve_CavalryCombatChain

    AutoResolveBody = AutoResolve_ElvenRivendellLancerHordeBody

    AutoResolveArmor
        Armor = AutoResolve_ElvenRivendellLancerHeavyArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_SilverThornArrows
        Weapon = AutoResolve_ElvenLorienArcherUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_SilverThornArrows
        Weapon = AutoResolve_ElvenLorienArcherWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTraining Upgrade_SilverThornArrows Upgrade_LothlorienLongBows Upgrade_ElvenCloak
End

ChildObject MirkwoodElkriderHordeWedgeFormation MirkwoodElkriderHorde

    Behavior = HorseHordeContain ModuleTag_HordeContain
        AttributeModifiers = GondorKnightWedge
        ObjectStatusOfContained =
        InitialPayload = MirkwoodElkrider 10
        Slots = 10
        PassengerFilter = NONE +CAVALRY
        ShowPips = No
        ThisFormationIsTheMainFormation = No
        RandomOffset = X:8 y:3
        MeleeBehavior = Amoeba
        End


        BannerCarriersAllowed    = ElkriderBanner
        BannerCarrierPosition    = UnitType:MirkwoodElkrider    Pos:X:30.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:MirkwoodElkrider Position:X:0 Y:0        Position:X:-20 Y:20       Position:X:-20 Y:-20      Position:X:-40 Y:40       Position:X:-40 Y:-40
        RankInfo = RankNumber:2 UnitType:MirkwoodElkrider Position:X:-30 Y:0      Position:X:-50 Y:20       Position:X:-50 Y:-20      Position:X:-70 Y:40       Position:X:-70 Y:-40

        RanksToReleaseWhenAttacking = 1
        AlternateFormation = MirkwoodElkriderHorde

        MeleeAttackLeashDistance = 1
        BackUpMinDelayTime       = 1
        BackUpMaxDelayTime       = 3000
        BackUpMinDistance        = 1
        BackUpMaxDistance        = 3
        BackupPercentage         = 80%
    End
End

ChildObject MirkwoodElkriderHorde_Summoned MirkwoodElkriderHorde

    Behavior = HorseHordeContain ModuleTag_HordeContain
        FrontAngle           = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay         = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload       = MirkwoodElkrider_Summoned  10
        Slots                = 10
        PassengerFilter      = NONE +CAVALRY
        ShowPips             = No
        RandomOffset         = X:2 y:3
        MeleeBehavior        = Amoeba
        End

        ThisFormationIsTheMainFormation = Yes

        BannerCarriersAllowed    = MirkwoodElkrider_Summoned
        BannerCarrierPosition    = UnitType:MirkwoodElkrider_Summoned    Pos:X:75.0 Y:0.0

        RankInfo = RankNumber:1 UnitType:MirkwoodElkrider_Summoned Position:X:45 Y:0            Position:X:45 Y:20        Position:X:45 Y:-20        Position:X:45 Y:40        Position:X:45 Y:-40
        RankInfo = RankNumber:2 UnitType:MirkwoodElkrider_Summoned Position:X:10 Y:0 Leader 1 0    Position:X:10 Y:20 Leader 1 1    Position:X:10 Y:-20 Leader 1 2    Position:X:10 Y:40 Leader 1 3    Position:X:10 Y:-40 Leader 1 4

        RanksToReleaseWhenAttacking = 1 2

        MeleeAttackLeashDistance    = 1
        BackUpMinDelayTime          = 1
        BackUpMaxDelayTime          = 3000
        BackUpMinDistance           = 1
        BackUpMaxDistance           = 3
        BackupPercentage            = 80%
    End

    CommandSet          = ElkriderHordeCommandSet_Summoned

    Behavior = GrantUpgradeCreate ModuleTag_GrantSilverthornArrows
	UpgradeToGrant = Upgrade_SilverThornArrows
    End
    Behavior = GrantUpgradeCreate ModuleTag_GrantLongBows
	UpgradeToGrant = Upgrade_LothlorienLongBows
    End
    Behavior = GrantUpgradeCreate ModuleTag_GrantCloak
	UpgradeToGrant = Upgrade_ElvenCloak
    End
    Behavior = GrantUpgradeCreate ModuleTag_GrantBasicTraining
	UpgradeToGrant = Upgrade_BasicTraining
    End

    Behavior = LifetimeUpdate ModuleTag_LifetimeUpdate
        MinLifetime        = 180000
        MaxLifetime        = 180000
        DeathType          = FADED
    End
End

Object LothlorienHaldirsElvesHorde

    SelectPortrait     = UPGaladhrim
    ButtonImage        = UPGaladhrim ;HSGaladhrim

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR
        DefaultModelConditionState
            Model = None
        End
        ModelConditionState = HORDE_EMPTY
            Model = None
        End
        ModelConditionState = WORLD_BUILDER
            Model = HordeTemp_5By2
        End
    End

    Side = Lothlorien
    EditorSorting = UNIT
    EmotionRange = 240
    DisplayName = OBJECT:LothlorienHaldirsElvesHorde
    DisplayNameStrategic = CONTROLBAR:LW_Unit_HaldirselvesHorde
    DescriptionStrategic = CONTROLBAR:LW_ToolTipBuild_HaldirselvesHorde
    MaxSimultaneousOfType    = 3

    WeaponSet
        Conditions = None
        Weapon = PRIMARY     HaldirsArcherMissileHordeRangefinder
        Weapon = TERTIARY    LorienArcherMissileHordeRangefinderBombard
        AutoChooseSources = TERTIARY FROM_PLAYER FROM_SCRIPT
    End
    WeaponSet
        Conditions = WEAPONSET_TOGGLE_1
        Weapon = PRIMARY    NormalMeleeHordeRangefinder
    End

    CommandSet = ElvenHaldirGaladrimHordeCommandSet




    CrushableLevel = 0
    CrusherLevel = 0

    BuildCost = 800
    BuildTime = STRONG_BUILDTIME
    VisionRange = 420
    ShroudClearingRange = 420
    VisionSide = 50%
    VisionRear = 25%
    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = 200
    VisionBonusPercentPerFoot = 1.0%
    CommandPoints = 70

    FormationWidth = 2
    FormationDepth = 1

    TransportSlotCount = 1
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE ARCHER MELEE_HORDE

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle   = Yes ATTACK_BUILDINGS STEALTHED
        MoodAttackCheckRate          = 500
        MaxCowerTime                 = 5000
        MinCowerTime                 = 3000
        CanAttackWhileContained      = Yes
        AILuaEventsList              = InfantryFunctions
        AttackPriority               = AttackPriority_Archer
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle             = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay             = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload = LothlorienHaldirsElves 10
        Slots = 10
        PassengerFilter = NONE +INFANTRY
        ShowPips = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset = X:1 Y:1


        BannerCarriersAllowed    = ElvenBanner
        BannerCarrierPosition    = UnitType:LothlorienHaldirsElves    Pos:X:70.0 Y:0.0


        RankInfo = RankNumber:1 UnitType:LothlorienHaldirsElves Position:X:50 Y:0            Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:50 Y:40        Position:X:50 Y:-40
        RankInfo = RankNumber:2 UnitType:LothlorienHaldirsElves Position:X:30 Y:0 Leader 1 0    Position:X:30 Y:20 Leader 1 1    Position:X:30 Y:-20 Leader 1 2    Position:X:30 Y:40 Leader 1 3    Position:X:30 Y:-40 Leader 1 4

        RanksToReleaseWhenAttacking = 1 2
    End

    Behavior = StealthUpdate StealthUpdateModuleTag
        StealthDelay                          = 500
        FriendlyOpacityMin                    = STEALTH_FRIENDLY_OPACITY_MIN
        FriendlyOpacityMax                    = STEALTH_FRIENDLY_OPACITY_MAX
        PulseFrequency                        = 750
        StealthForbiddenConditions            = AWAY_FROM_TREES ATTACKING
        OrderIdleEnemiesToAttackMeUponReveal  = Yes
        DetectedByAnyoneRange                 = 120
        RevealWeaponSets                      = CLOSE_RANGE CONTESTING_BUILDING
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = FighterHorde
    End


    #include "..\..\..\includes\CaptureBuilding.inc"

     Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded        =    NONE
        PointAt                =    NONE +MordorFellBeast +MordorWitchKingOnFellBeast +GondorGwaihir
        HeroScanDistance        =    150
        FearScanDistance        =    INFANTRY_FEAR_SCAN_RADIUS



        AddEmotion    =    Terror_Base
        AddEmotion    =    Doom_Base
        AddEmotion    =   BraceForBeingCrushed_Base
        AddEmotion    =    UncontrollableFear_Base
        AddEmotion    =    FearIdle_Base
        AddEmotion    =    FearBusy_Base
        AddEmotion    =    Point_Base
        AddEmotion    =    Taunt_Base
        AddEmotion    =    CheerIdle_Base
        AddEmotion    =    CheerBusy_Base
        AddEmotion    =    HeroCheerIdle_Base
        AddEmotion    =    HeroCheerBusy_Base
        AddEmotion    =    Alert_Base
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality5
        TriggeredBy = Upgrade_LothlorienKampfbereitschaft
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality6
        TriggeredBy = Upgrade_LothlorienKampfausrustung
    End

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_GaladhrimBasicTraining
        LevelsToGain = 1
        LevelCap = 2
    End

    LocomotorSet
        Locomotor     = NormalMeleeHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_FOOT_MED_HORDE_SPEED
    End

    





    Behavior = AISpecialPowerUpdate ElvenLorienWarriorHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Behavior = AISpecialPowerUpdate ImladrisWarriorHordeToggleWeapon
        CommandButtonName = Command_ToggleElvenWarriorWeapon
        SpecialPowerAIType = AI_SPECIAL_POWER_TOGGLE_MELEE_AND_RANGE
    End


    Geometry = BOX
    GeometryMajorRadius = 20.0
    GeometryMinorRadius = 20.0
    GeometryHeight = 20.0
    GeometryIsSmall = No



    AutoResolveUnitType = AutoResolveUnit_Soldier
    AutoResolveCombatChain = AutoResolve_SoldierCombatChain

    AutoResolveBody = AutoResolve_DwarvenGuardianHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_GondorWachterderVesteHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_GondorWachterderVesteArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_GondorWachterderVesteUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_GondorWachterderVesteWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTraining Upgrade_ForgedBlades Upgrade_HeavyArmor
End


Object LothlorienHaldirsElvesHordeStufe10

    SelectPortrait     = UPGaladhrim
    ButtonImage        = HSGaladhrim

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR
        DefaultModelConditionState
            Model = None
        End
        ModelConditionState = HORDE_EMPTY
            Model = None
        End
        ModelConditionState = WORLD_BUILDER
            Model = HordeTemp_5By2
        End
    End

    Side = Lothlorien
    EditorSorting = UNIT
    EmotionRange = 240
    DisplayName = OBJECT:LothlorienHaldirsElvesHorde
    DisplayNameStrategic = CONTROLBAR:LW_Unit_HaldirselvesHorde
    DescriptionStrategic = CONTROLBAR:LW_ToolTipBuild_HaldirselvesHorde
    MaxSimultaneousOfType    = 3

    WeaponSet
        Conditions = NONE
        Weapon = PRIMARY     HaldirsArcherMissileHordeRangefinder
        Weapon = TERTIARY    LorienArcherMissileHordeRangefinderBombard
        AutoChooseSources = TERTIARY FROM_PLAYER FROM_SCRIPT
    End
    WeaponSet
        Conditions = WEAPONSET_TOGGLE_1
        Weapon = PRIMARY    NormalMeleeHordeRangefinder
    End

    CommandSet = ElvenHaldirGaladrimHordeCommandSet





    CrushableLevel = 0
    CrusherLevel = 0

    BuildCost = 800
    BuildTime = STRONG_BUILDTIME
    VisionRange = 420
    ShroudClearingRange = 420
    CommandPoints = 50

    FormationWidth = 2
    FormationDepth = 1

    TransportSlotCount = 1
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE ARCHER MELEE_HORDE ARMY_SUMMARY

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle = Yes ATTACK_BUILDINGS STEALTHED
        MoodAttackCheckRate        = 500
        MaxCowerTime                =    5000
        MinCowerTime                =    3000
        CanAttackWhileContained    = Yes
        AILuaEventsList                = InfantryFunctions
        AttackPriority                =     AttackPriority_Archer
    End

    Behavior = HordeContain ModuleTag_HordeContain
        ObjectStatusOfContained =
        InitialPayload = LothlorienHaldirsElves 10
        Slots = 10
        PassengerFilter = NONE +INFANTRY
        ShowPips = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset = X:1 Y:1


        BannerCarriersAllowed    = ElvenBanner
        BannerCarrierPosition    = UnitType:LothlorienHaldirsElves    Pos:X:70.0 Y:0.0


        RankInfo = RankNumber:1 UnitType:LothlorienHaldirsElves Position:X:50 Y:0            Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:50 Y:40        Position:X:50 Y:-40
        RankInfo = RankNumber:2 UnitType:LothlorienHaldirsElves Position:X:30 Y:0 Leader 1 0    Position:X:30 Y:20 Leader 1 1    Position:X:30 Y:-20 Leader 1 2    Position:X:30 Y:40 Leader 1 3    Position:X:30 Y:-40 Leader 1 4

        RanksToReleaseWhenAttacking = 1 2
    End

    Behavior = StealthUpdate StealthUpdateModuleTag
        StealthDelay                        = 500
        FriendlyOpacityMin                    = STEALTH_FRIENDLY_OPACITY_MIN
        FriendlyOpacityMax                    = STEALTH_FRIENDLY_OPACITY_MAX
        PulseFrequency                        = 750
        StealthForbiddenConditions            = AWAY_FROM_TREES ATTACKING
        OrderIdleEnemiesToAttackMeUponReveal= Yes
        DetectedByAnyoneRange                = 120
        RevealWeaponSets                    = CLOSE_RANGE CONTESTING_BUILDING
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = FighterHorde
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

     Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded        =    NONE
        PointAt                =    NONE +MordorFellBeast +MordorWitchKingOnFellBeast +GondorGwaihir
        HeroScanDistance        =    150
        FearScanDistance        =    INFANTRY_FEAR_SCAN_RADIUS



        AddEmotion    =    Terror_Base
        AddEmotion    =    Doom_Base
        AddEmotion    =   BraceForBeingCrushed_Base
        AddEmotion    =    UncontrollableFear_Base
        AddEmotion    =    FearIdle_Base
        AddEmotion    =    FearBusy_Base
        AddEmotion    =    Point_Base
        AddEmotion    =    Taunt_Base
        AddEmotion    =    CheerIdle_Base
        AddEmotion    =    CheerBusy_Base
        AddEmotion    =    HeroCheerIdle_Base
        AddEmotion    =    HeroCheerBusy_Base
        AddEmotion    =    Alert_Base
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End


    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality5
        TriggeredBy = Upgrade_LothlorienKampfbereitschaft
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality6
        TriggeredBy = Upgrade_LothlorienKampfausrustung
    End

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_GaladhrimBasicTraining
        LevelsToGain = 1
        LevelCap = 2
    End

    LocomotorSet
        Locomotor     = NormalMeleeHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_FOOT_VERYFAST_HORDE_SPEED
    End


    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality4
        TriggeredBy = Upgrade_TechnologyLothlorienLembasbrotAktive
    End






    Behavior = AISpecialPowerUpdate ElvenLorienWarriorHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Behavior = AISpecialPowerUpdate ImladrisWarriorHordeToggleWeapon
        CommandButtonName = Command_ToggleElvenWarriorWeapon
        SpecialPowerAIType = AI_SPECIAL_POWER_TOGGLE_MELEE_AND_RANGE
    End


    Geometry = BOX
    GeometryMajorRadius = 20.0
    GeometryMinorRadius = 20.0
    GeometryHeight = 20.0
    GeometryIsSmall = No



    AutoResolveUnitType = AutoResolveUnit_Soldier
    AutoResolveCombatChain = AutoResolve_SoldierCombatChain

    AutoResolveBody = AutoResolve_DwarvenGuardianHordeBody

    AutoResolveArmor
        RequiredUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_GondorWachterderVesteHeavyArmor
    End

    AutoResolveArmor
        ExcludedUpgrades = Upgrade_HeavyArmor
        Armor = AutoResolve_GondorWachterderVesteArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_GondorWachterderVesteUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_ForgedBlades
        Weapon = AutoResolve_GondorWachterderVesteWeapon
    End

End



ChildObject LothlorienHaldirsElvesFreeHorde LothlorienHaldirsElvesHorde
    BuildCost = 0
End




ChildObject LothlorienHaldirsElvesHordeMod_Summoned LothlorienHaldirsElvesHorde
    IsTrainable    =    No
    CommandPoints     =    0
    EquivalentTo      =    LothlorienHaldirsElvesHorde


    Behavior = HordeContain ModuleTag_HordeContain
        ObjectStatusOfContained =
        InitialPayload = LothlorienHaldirsElves 10
        Slots = 10
        PassengerFilter = NONE +INFANTRY
        ShowPips = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset = X:1 Y:1


        BannerCarriersAllowed    = ElvenBanner
        BannerCarrierPosition    = UnitType:LothlorienHaldirsElves    Pos:X:70.0 Y:0.0


        RankInfo = RankNumber:1 UnitType:LothlorienHaldirsElves Position:X:50 Y:0            Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:50 Y:40        Position:X:50 Y:-40
        RankInfo = RankNumber:2 UnitType:LothlorienHaldirsElves Position:X:30 Y:0 Leader 1 0    Position:X:30 Y:20 Leader 1 1    Position:X:30 Y:-20 Leader 1 2    Position:X:30 Y:40 Leader 1 3    Position:X:30 Y:-40 Leader 1 4

        RanksToReleaseWhenAttacking = 1 2
    End
    Behavior = SlowDeathBehavior ModuleTag_FadeDeath
		DeathTypes 	= NONE +FADED
		DestructionDelay = 2000
	End

	Behavior = LifetimeUpdate ModuleTag_LifetimeUpdate
		MinLifetime	= 120000
		MaxLifetime	= 120000
		DeathType	= FADED
	End

End



Object LothlorienHaldirsElvesHordeInnGasthaus

    SelectPortrait     = UPGaladhrim
    ButtonImage        = HSGaladhrim

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR
        DefaultModelConditionState
            Model = None
        End
        ModelConditionState = HORDE_EMPTY
            Model = None
        End
        ModelConditionState = WORLD_BUILDER
            Model = HordeTemp_5By2
        End
    End

    Side = Lothlorien
    EditorSorting = UNIT
    EmotionRange = 240
    DisplayName = OBJECT:LothlorienHaldirsElvesHorde
    DisplayNameStrategic = CONTROLBAR:LW_Unit_HaldirselvesHorde
    DescriptionStrategic = CONTROLBAR:LW_ToolTipBuild_HaldirselvesHorde
    MaxSimultaneousOfType    = 3

    WeaponSet
        Conditions = None
        Weapon = PRIMARY     LorienArcherMissileHordeRangefinder
        Weapon = TERTIARY     LorienArcherMissileHordeRangefinderBombard
        AutoChooseSources = TERTIARY FROM_PLAYER FROM_SCRIPT
    End
    WeaponSet
        Conditions = WEAPONSET_TOGGLE_1
        Weapon = PRIMARY    NormalMeleeHordeRangefinder
    End

    CommandSet   = ElvenHaldirGaladrimHordeInnGasthausCommandSet





    CrushableLevel = 0
    CrusherLevel = 0

    BuildCost = 800
    BuildTime = STRONG_BUILDTIME
    VisionRange = ELVEN_LINDONWARRIOR_HORDE_VISION_RANGE
    ShroudClearingRange = 161
    CommandPoints = 50

    FormationWidth = 2
    FormationDepth = 1

    TransportSlotCount = 1
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE ARCHER MELEE_HORDE

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle = Yes ATTACK_BUILDINGS STEALTHED
        MoodAttackCheckRate        = 500
        MaxCowerTime                =    5000
        MinCowerTime                =    3000
        CanAttackWhileContained    = Yes
        AILuaEventsList                = InfantryFunctions
        AttackPriority                =     AttackPriority_Archer
    End

    Behavior = HordeContain ModuleTag_HordeContain
        ObjectStatusOfContained =
        InitialPayload = LothlorienHaldirsElvesInn 10
        Slots = 10
        PassengerFilter = NONE +INFANTRY
        ShowPips = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset = X:1 Y:1


        BannerCarriersAllowed    = ElvenBanner
        BannerCarrierPosition    = UnitType:LothlorienHaldirsElvesInn    Pos:X:70.0 Y:0.0


        RankInfo = RankNumber:1 UnitType:LothlorienHaldirsElvesInn Position:X:50 Y:0            Position:X:50 Y:20        Position:X:50 Y:-20        Position:X:50 Y:40        Position:X:50 Y:-40
        RankInfo = RankNumber:2 UnitType:LothlorienHaldirsElvesInn Position:X:30 Y:0 Leader 1 0    Position:X:30 Y:20 Leader 1 1    Position:X:30 Y:-20 Leader 1 2    Position:X:30 Y:40 Leader 1 3    Position:X:30 Y:-40 Leader 1 4

        RanksToReleaseWhenAttacking = 1 2
    End

    Behavior = StealthUpdate StealthUpdateModuleTag
        StealthDelay                        = 500
        FriendlyOpacityMin                    = STEALTH_FRIENDLY_OPACITY_MIN
        FriendlyOpacityMax                    = STEALTH_FRIENDLY_OPACITY_MAX
        PulseFrequency                        = 750
        StealthForbiddenConditions            = AWAY_FROM_TREES ATTACKING
        OrderIdleEnemiesToAttackMeUponReveal= Yes
        DetectedByAnyoneRange                = 120
        RevealWeaponSets                    = CLOSE_RANGE CONTESTING_BUILDING
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = FighterHorde
    End

    #include "..\..\..\includes\CaptureBuilding.inc"

     Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded        =    NONE
        PointAt                =    NONE +MordorFellBeast +MordorWitchKingOnFellBeast +GondorGwaihir
        HeroScanDistance        =    150
        FearScanDistance        =    INFANTRY_FEAR_SCAN_RADIUS



        AddEmotion    =    Terror_Base
        AddEmotion    =    Doom_Base
        AddEmotion    =   BraceForBeingCrushed_Base
        AddEmotion    =    UncontrollableFear_Base
        AddEmotion    =    FearIdle_Base
        AddEmotion    =    FearBusy_Base
        AddEmotion    =    Point_Base
        AddEmotion    =    Taunt_Base
        AddEmotion    =    CheerIdle_Base
        AddEmotion    =    CheerBusy_Base
        AddEmotion    =    HeroCheerIdle_Base
        AddEmotion    =    HeroCheerBusy_Base
        AddEmotion    =    Alert_Base
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTraining
        LevelsToGain = 1
        LevelCap = 2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality
        TriggeredBy = Upgrade_HeavyArmor
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_ForgedBlades
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality3
        TriggeredBy = Upgrade_SilverThornArrows
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality4
        TriggeredBy = Upgrade_TechnologyLothlorienLembasbrotAktive
    End


    Behavior = SpecialPowerModule ModuleTag_Lembasbrot
        SpecialPowerTemplate     = SpecialAbilityLembasbrotHealSpell
        UpdateModuleStartsAttack = Yes
    End

    Behavior = SpecialAbilityUpdate ModuleTag_LembasbrotUpdate
        SpecialPowerTemplate     = SpecialAbilityLembasbrotHealSpell
        StartAbilityRange        = 1.6
        UnpackTime               = 1
        PreparationTime          = 3
        PackTime                 = 2096
        AwardXPForTriggering     = 0
    End

    Behavior = AutoHealBehavior ModuleTag_LembasbrotHealing
        StartsActive             = Yes
        ButtonTriggered          = Yes
        HealingAmount            = 300
        Radius                   = 55
        HealOnlyOthers           = No
        SingleBurst              = Yes
        UnitHealPulseFX          = FX_SpellHealUnitHealBuff
        KindOf                   = INFANTRY
    End

    LocomotorSet
        Locomotor     = NormalMeleeHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_FOOT_VERYFAST_HORDE_SPEED
    End





    Behavior = AISpecialPowerUpdate ElvenLorienWarriorHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Behavior = AISpecialPowerUpdate ImladrisWarriorHordeToggleWeapon
        CommandButtonName = Command_ToggleElvenWarriorWeapon
        SpecialPowerAIType = AI_SPECIAL_POWER_TOGGLE_MELEE_AND_RANGE
    End

    Geometry = BOX
    GeometryMajorRadius = 20.0
    GeometryMinorRadius = 20.0
    GeometryHeight = 20.0
    GeometryIsSmall = No
End

Object BeorningerBearHorde


    ButtonImage        = WOR_WargPack
    SelectPortrait    = UPBearNew

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED EMOTION_TERROR EMOTION_LOOK_TO_SKY
        DefaultModelConditionState
            Model = None
        End
        ModelConditionState = HORDE_EMPTY
            Model = None
        End
        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkIUWar
        End
    End

    Side             = Lothlorien
    EditorSorting         = UNIT
    EmotionRange         = 240
    DisplayName         = OBJECT:HordeBeorningerBear
    DisplayNameStrategic     = CONTROLBAR:LW_Unit_BeorningerBear
    DescriptionStrategic     = CONTROLBAR:LW_ToolTip_IsengardWargPackHorde

    WeaponSet
        Conditions = None
        Weapon        = PRIMARY    NormalMeleeHordeRangefinder
        Weapon        = SECONDARY    NormalMissileHordeRangefinder
    End







    BuildCost         = 500
    BuildTime         = MEDIUM_BUILDTIME
    VisionRange = 200
    ShroudClearingRange = 250
    VisionSide         = 50%
    VisionRear         = 25%

    MaxVisionBonusPercent     = 300%
    VisionBonusTestRadius     = 200
    VisionBonusPercentPerFoot = 1.0%


    CommandPoints         = 75

    CommandSet         = HoehlenBaerHordeCommandSet

    FormationWidth         = 2
    FormationDepth         = 1

    CrushableLevel         = 3
    CrusherLevel           = 2
    CrushKnockback         = 40
    CrushZFactor           = 1.0


    TransportSlotCount = TRANSPORTSLOTCOUNT_LARGE_HORDE
    KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE MELEE_HORDE ARMY_SUMMARY LARGE_RECTANGLE_PATHFIND

    ThreatLevel = ISENGARD_WARGPACK_HORDE_THREAT
    ThreatBreakdown IsengardWargRiderHorde_DetailedThreat
        AIKindOf = CAVALRY
    End

    #include "..\..\..\includes\StandardHordeEvaEvents.inc"

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = CavalryHorde
    End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle     = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate            = 500
        MaxCowerTime            = 5000
        MinCowerTime            = 3000
        AttackPriority            = AttackPriority_Cavalry
    End

    Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded        =    NONE
        AfraidOf            =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf            =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
        PointAt                =    EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance        =    150
        FearScanDistance        =    CAVALRY_FEAR_SCAN_RADIUS

        AddEmotion    =    Terror_Base
        AddEmotion    =    Doom_Base
        AddEmotion    =       BraceForBeingCrushed_Base
        AddEmotion    =    UncontrollableFear_Base_Evil
        AddEmotion    =    FearIdle_Base
        AddEmotion    =    FearBusy_Base
        AddEmotion    =    Point_Base
        AddEmotion    =    Taunt_Base
        AddEmotion    =    CheerIdle_Base
        AddEmotion    =    CheerBusy_Base
        AddEmotion    =    HeroCheerIdle_Base
        AddEmotion    =    HeroCheerBusy_Base
        AddEmotion    =    Alert_Base
        AddEmotion    =       CheerForAboutToCrush_Base
    End

    Behavior = HorseHordeContain ModuleTag_HordeContain
        FrontAngle = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload         = BeorningerBear  5
        Slots             = 5
        PassengerFilter     = NONE +INFANTRY +BeorningerBear
        ShowPips         = No
        RandomOffset         = X:2 y:2

        MeleeBehavior         = Amoeba
        End


        ThisFormationIsTheMainFormation = Yes

        RankInfo = RankNumber:1 UnitType:BeorningerBear Position:X:40 Y:0        Position:X:40 Y:30        Position:X:40 Y:-30         Position:X:40 Y:60        Position:X:40 Y:-60

        RanksToReleaseWhenAttacking = 1
        MeleeAttackLeashDistance = 25
        AttributeModifiers = IsengardWargSkirmish
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

    Behavior = HordeNotifyTargetsOfImminentProbableCrushingUpdate ModuleTag_NotifyCrushScan
        ScanWidth = 40.0
    End

    Behavior = SpecialPowerModule ModuleTag_HowlUpdate
        SpecialPowerTemplate          = SpecialAbilityWargHowl
        UpdateModuleStartsAttack      = No
        AttributeModifier         = IsengardWargHowl

        AttributeModifierAffectsSelf     = Yes

        AttributeModifierFX         = FX_WargHowl
    End

    LocomotorSet
        Locomotor     = NormalCavalryHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_MOUNTED_VERYFAST_HORDE_SPEED
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End

    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTraining
        LevelsToGain = 1
        LevelCap = 2
    End






    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly = Yes
        StuffToPickUp = ANY +CRATE -TheDroppedRing
        ScanRange = 200
        ScanIntervalSeconds = 0.5
    End







    Behavior = AISpecialPowerUpdate IsengardWargRiderHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate HowlAI
        CommandButtonName = Command_SpecialAbilityWargHowl
        SpecialPowerAIType = AI_SPECIAL_POWER_BASIC_SELF_BUFF
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End



    Geometry = BOX
    GeometryMajorRadius = 30.0
    GeometryMinorRadius = 40.0
    GeometryHeight = 20.0
    GeometryIsSmall = No



    AutoResolveUnitType = AutoResolveUnit_Cavalry
    AutoResolveCombatChain = AutoResolve_CavalryCombatChain

    AutoResolveBody = AutoResolve_GondorKnightHordeBody


    AutoResolveArmor
        Armor = AutoResolve_IsengardWargRiderHeavyArmor
    End


    AutoResolveWeapon
        Weapon = AutoResolve_IsengardWargRiderUpgradedWeapon
    End
End

Object LorienMirkwoodArcherHorde

    ButtonImage        = WOR_MirkwoodArcher
    SelectPortrait     = UPElven_MirkwoodArcher

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_TAUNTING EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED  EMOTION_TERROR EMOTION_LOOK_TO_SKY
        DefaultModelConditionState
            Model = None
        End
        ModelConditionState = HORDE_EMPTY
            Model = None
        End

        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkEUMIA
        End
    End

    Side = Lothlorien
    EditorSorting = UNIT
    EmotionRange = 240
    DisplayName = OBJECT:ElvenMirkwoodArcherHorde
    DisplayNameStrategic = CONTROLBAR:LW_Unit_ElvenMirkwoodArcherHorde
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_ElvenMirkwoodArcherHorde

    WeaponSet
        Conditions = None
        Weapon = PRIMARY    MirkwoodArcherMissileHordeRangefinder
        Weapon = TERTIARY    MirkwoodArcherMissileHordeRangefinderBombard
        AutoChooseSources = TERTIARY FROM_PLAYER FROM_SCRIPT
    End



    BuildCost             = ELVEN_MIRKWOOD_ARCHER_BUILDCOST
    BuildTime             = STRONG_BUILDTIME
    VisionRange             = ELVEN_MIRKWOOD_ARCHER_HORDE_VISION_RANGE
    VisionSide             = 50%
    VisionRear             = 25%
    VisionBonusPercentPerFoot     = 1.0%
    ShroudClearingRange         = ELVEN_MIRKWOOD_ARCHER_HORDE_SHROUD_RANGE
    CommandPoints             = 80

    FormationWidth             = 2
    FormationDepth             = 1

     CrushableLevel             = 0
    CrusherLevel             = 0
    UseCrushAttack             = No

        TransportSlotCount         = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf                 = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE ARCHER ARMY_SUMMARY LARGE_RECTANGLE_PATHFIND
    CamouflageDetectionMultiplier     = CAMOUFLAGE_DETECTION_DISTANCE_LONG

    CommandSet         = ElvenMirkwoodArcherHordeCommandSet

    ThreatLevel         = ELVEN_MIRKWOODARCHER_HORDE_THREAT
    ThreatBreakdown ElvenMirkwoodArcherHorde_DetailedThreat
        AIKindOf     = ARCHER
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = ArcherHorde
        End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle    =    Yes ATTACK_BUILDINGS
        MoodAttackCheckRate        =    500
        MaxCowerTime            =    5000
        MinCowerTime            =    3000
        CanAttackWhileContained        =    Yes
        AILuaEventsList            =    InfantryFunctions
        AttackPriority            =     AttackPriority_Archer
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload         = LorienMirkwoodArcher 10
        Slots             = 10
        PassengerFilter     = NONE +INFANTRY
        ShowPips         = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset        = X:0 Y:0

        MeleeBehavior         = Amoeba
        End


        BannerCarriersAllowed    = ElvenMirkwoodArcherBanner
        BannerCarrierPosition    = UnitType:LorienMirkwoodArcher        Pos:X:40.0 Y:0.0


        RankInfo = RankNumber:1 UnitType:LorienMirkwoodArcher Position:X:0 Y:0    Position:X:0 Y:25    Position:X:0 Y:-25    Position:X:0 Y:50    Position:X:0 Y:-50
        RankInfo = RankNumber:2 UnitType:LorienMirkwoodArcher Position:X:20 Y:0    Position:X:15 Y:25    Position:X:20 Y:-25    Position:X:20 Y:50    Position:X:20 Y:-50

        RanksToReleaseWhenAttacking = 1 2

        MeleeAttackLeashDistance = 1
        BackUpMinDelayTime         = 1
        BackUpMaxDelayTime         = 3000
        BackUpMinDistance         = 1
        BackUpMaxDistance         = 3
        BackupPercentage         = 80%

    End

    Behavior = InvisibilityUpdate ModuleTag_ElvenCloak
        InvisibilityNugget
            InvisibilityType    = STEALTH
            ForbiddenConditions    = MOVING FIRING_ANY TAKING_DAMAGE
            BecomeStealthedFX       = FX_ElvenCloakOn
            ExitStealthFX           = FX_ElvenCloakOff
            Options            = UNTOGGLE_HIDDEN_WHEN_LEAVING_STEALTH
        End
        StartsActive            = No
        UpdatePeriod            = 2000
    End



    Behavior     = InvisibilityUpdate ModuleTag_ElvenCamouflage
        InvisibilityNugget
            InvisibilityType    = CAMOUFLAGE
            DetectionRange        = CAMOUFLAGE_RADIUS
            ForbiddenConditions    = MOVING FIRING_ANY
            Options                = ALLOW_NEAR_TREES
        End
        UpdatePeriod            = 2000
        StartsActive            = Yes
        UnitSpecificSoundNameToUseAsVoiceMoveToStealthyArea = VoiceMoveToTrees
        UnitSpecificSoundNameToUseAsVoiceEnterStateMoveToStealthyArea = VoiceEnterStateMoveToTrees
    End


    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

       Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded        =    NONE
         AfraidOf            =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf            =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
         PointAt                =    EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance        =    150
        FearScanDistance        =     ARCHER_FEAR_SCAN_RADIUS

        AddEmotion            =    Terror_Base



        AddEmotion            =    Doom_Base


        AddEmotion            =   BraceForBeingCrushed_Base

        AddEmotion            =    UncontrollableFear_Base



        AddEmotion            =    FearIdle_Base



        AddEmotion            =    FearBusy_Base



        AddEmotion            =    Point_Base




        AddEmotion            =    Taunt_Base



         AddEmotion    =    CheerIdle_Base
        AddEmotion    =    CheerBusy_Base
        AddEmotion    =    HeroCheerIdle_Base
        AddEmotion    =    HeroCheerBusy_Base
        AddEmotion    =    Alert_Base
    End


    Behavior = SpecialPowerModule ModuleTag_ElfCloakStarter
        SpecialPowerTemplate      = SpecialAbilityElfCloak
        UpdateModuleStartsAttack  = Yes
        StartsPaused              = No
    End
    Behavior = ToggleHiddenSpecialAbilityUpdate ModuleTag_ElfCloakUpdate
        SpecialPowerTemplate = SpecialAbilityElfCloak
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End


    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTraining
        LevelsToGain = 1
        LevelCap = 2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality
        TriggeredBy = Upgrade_SilverThornArrows
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_HeavyArmor
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality4
        TriggeredBy = Upgrade_SilverThornArrows
    End

    LocomotorSet
        Locomotor     = NormalRangedHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_FOOT_VERYFAST_HORDE_SPEED
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly         = Yes
        StuffToPickUp         = ANY +CRATE -TheDroppedRing
        ScanRange         = 200
        ScanIntervalSeconds     = 0.5
    End





    Behavior = AISpecialPowerUpdate ElvenMirkwoodArcherHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End


    Behavior = LifetimeUpdate ModuleTag_LifetimeUpdate

        MinLifetime        = 120000
        MaxLifetime        = 120000
        DeathType        = FADED
    End

    Geometry         = BOX
    GeometryMajorRadius     = 20.0
    GeometryMinorRadius     = 60.0
    GeometryHeight         = 10.0
    GeometryIsSmall     = No




    AutoResolveUnitType = AutoResolveUnit_Archer
    AutoResolveCombatChain = AutoResolve_ArcherCombatChain

    AutoResolveBody = AutoResolve_ElvenMirkwoodArcherHordeBody

    AutoResolveArmor
        Armor = AutoResolve_ElvenMirkwoodArcherArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_SilverThornArrows
        Weapon = AutoResolve_ElvenMirkwoodArcherUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_SilverThornArrows
        Weapon = AutoResolve_ElvenMirkwoodArcherWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTraining Upgrade_SilverThornArrows
End

ChildObject LorienMirkwoodArcherHorde_Summoned LorienMirkwoodArcherHorde
    IsTrainable    = No
    CommandPoints     = 0
    CommandSet    = IsengartSpellUnitsCommandSet
    EquivalentTo      = LorienMirkwoodArcherHorde
    KindOf                = +SUMMONED

    DisplayName  =  OBJECT:HordeLorienMirkwoodArcher

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload     = LorienMirkwoodArcher_Summoned 10
        Slots         = 10
        PassengerFilter    = NONE +INFANTRY
        ShowPips     = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset    = X:0 Y:0
        MeleeBehavior     = Amoeba
        End

        RankInfo = RankNumber:1 UnitType:LorienMirkwoodArcher_Summoned Position:X:50 Y:0            Position:X:50 Y:20                Position:X:50 Y:-20                Position:X:50 Y:40                Position:X:50 Y:-40
        RankInfo = RankNumber:2 UnitType:LorienMirkwoodArcher_Summoned Position:X:30 Y:0 Leader 1 0    Position:X:30 Y:20 Leader 1 1    Position:X:30 Y:-20 Leader 1 2    Position:X:30 Y:40 Leader 1 3    Position:X:30 Y:-40 Leader 1 4
        RankInfo = RankNumber:3 UnitType:LorienMirkwoodArcher_Summoned Position:X:10 Y:0 Leader 2 0    Position:X:10 Y:20 Leader 2 1    Position:X:10 Y:-20 Leader 2 2    Position:X:10 Y:40 Leader 2 3    Position:X:10 Y:-40 Leader 2 4

        RanksToReleaseWhenAttacking = 1 2
    End

    Behavior = LifetimeUpdate ModuleTag_LifetimeUpdate

        MinLifetime        = 120000
        MaxLifetime        = 120000
        DeathType        = FADED
    End

End

Object MirkwoodWachterArcherHorde

    SelectPortrait     = UPWachterPfade2
    ButtonImage        = HSWachterPfade2

    Draw = W3DScriptedModelDraw ModuleTag_W3DModelDraw
        DependencySharedModelFlags = EMOTION_TAUNTING EMOTION_ALERT EMOTION_MORALE_HIGH EMOTION_MORALE_LOW EMOTION_AFRAID EMOTION_COWER SELECTED  EMOTION_TERROR EMOTION_LOOK_TO_SKY
        DefaultModelConditionState
            Model = None
        End
        ModelConditionState = HORDE_EMPTY
            Model = None
        End

        ModelConditionState = WORLD_BUILDER
            Model = HordeMarkEUMIA
        End
    End

    Side = Lothlorien
    EditorSorting = UNIT
    EmotionRange = 240
    DisplayName = OBJECT:ElvenMirkwoodArcherHorde
    DisplayNameStrategic = CONTROLBAR:LW_Unit_ElvenMirkwoodArcherHorde
    DescriptionStrategic = CONTROLBAR:LW_ToolTip_ElvenMirkwoodArcherHorde

    WeaponSet
        Conditions = None
        Weapon = PRIMARY    MirkwoodArcherMissileHordeRangefinder
        Weapon = TERTIARY    MirkwoodArcherMissileHordeRangefinderBombard
        AutoChooseSources = TERTIARY FROM_PLAYER FROM_SCRIPT
    End







    BuildCost             = ELVEN_MIRKWOOD_ARCHER_BUILDCOST
    BuildTime             = STRONG_BUILDTIME
    VisionRange             = ELVEN_MIRKWOOD_ARCHER_HORDE_VISION_RANGE
    VisionSide             = 50%
    VisionRear             = 25%
    VisionBonusPercentPerFoot     = 1.0%
    ShroudClearingRange         = ELVEN_MIRKWOOD_ARCHER_HORDE_SHROUD_RANGE
    CommandPoints             = 80

    FormationWidth             = 2
    FormationDepth             = 1

     CrushableLevel             = 0
    CrusherLevel             = 0
    UseCrushAttack             = No

        TransportSlotCount         = TRANSPORTSLOTCOUNT_SMALL_HORDE
    KindOf                 = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE ARCHER ARMY_SUMMARY LARGE_RECTANGLE_PATHFIND
    CamouflageDetectionMultiplier     = CAMOUFLAGE_DETECTION_DISTANCE_LONG

    CommandSet         = ElvenMirkwoodArcherHordeCommandSet

    ThreatLevel         = ELVEN_MIRKWOODARCHER_HORDE_THREAT
    ThreatBreakdown ElvenMirkwoodArcherHorde_DetailedThreat
        AIKindOf     = ARCHER
    End

    Body = ImmortalBody ModuleTag_ImmortalBody
        MaxHealth = 1
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = ArcherHorde
        End

    Behavior = HordeAIUpdate ModuleTag_HordeAIUpdate
        AutoAcquireEnemiesWhenIdle    =    Yes ATTACK_BUILDINGS
        MoodAttackCheckRate        =    500
        MaxCowerTime            =    5000
        MinCowerTime            =    3000
        CanAttackWhileContained        =    Yes
        AILuaEventsList            =    InfantryFunctions
        AttackPriority            =     AttackPriority_Archer
    End

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload         = MirkwoodWachterArcher 10
        Slots             = 10
        PassengerFilter     = NONE +INFANTRY
        ShowPips         = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset        = X:0 Y:0

        MeleeBehavior         = Amoeba
        End


        BannerCarriersAllowed    = ElvenMirkwoodArcherBanner
        BannerCarrierPosition    = UnitType:MirkwoodWachterArcher        Pos:X:40.0 Y:0.0


        RankInfo = RankNumber:1 UnitType:MirkwoodWachterArcher Position:X:0 Y:0    Position:X:0 Y:25    Position:X:0 Y:-25    Position:X:0 Y:50    Position:X:0 Y:-50
        RankInfo = RankNumber:2 UnitType:MirkwoodWachterArcher Position:X:20 Y:0    Position:X:15 Y:25    Position:X:20 Y:-25    Position:X:20 Y:50    Position:X:20 Y:-50

        RanksToReleaseWhenAttacking = 1 2

        MeleeAttackLeashDistance = 1
        BackUpMinDelayTime         = 1
        BackUpMaxDelayTime         = 3000
        BackUpMinDistance         = 1
        BackUpMaxDistance         = 3
        BackupPercentage         = 80%

    End

    Behavior = InvisibilityUpdate ModuleTag_ElvenCloak
        InvisibilityNugget
            InvisibilityType    = STEALTH
            ForbiddenConditions    = MOVING FIRING_ANY TAKING_DAMAGE
            BecomeStealthedFX       = FX_ElvenCloakOn
            ExitStealthFX           = FX_ElvenCloakOff
            Options            = UNTOGGLE_HIDDEN_WHEN_LEAVING_STEALTH
        End
        StartsActive            = No
        UpdatePeriod            = 2000
    End



    Behavior     = InvisibilityUpdate ModuleTag_ElvenCamouflage
        InvisibilityNugget
            InvisibilityType    = CAMOUFLAGE
            DetectionRange        = CAMOUFLAGE_RADIUS
            ForbiddenConditions    = MOVING FIRING_ANY
            Options                = ALLOW_NEAR_TREES
        End
        UpdatePeriod            = 2000
        StartsActive            = Yes
        UnitSpecificSoundNameToUseAsVoiceMoveToStealthyArea = VoiceMoveToTrees
        UnitSpecificSoundNameToUseAsVoiceEnterStateMoveToStealthyArea = VoiceEnterStateMoveToTrees
    End


    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End

       Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance        =    INFANTRY_TAUNT_POINT_RADIUS
        TauntAndPointUpdateDelay    =    1000
        TauntAndPointExcluded        =    NONE
         AfraidOf            =    EMOTION_AFRAIDOF_OBJECTFILTER
        AlwaysAfraidOf            =    EMOTION_ALWAYS_AFRAIDOF_OBJECTFILTER
         PointAt                =    EMOTION_POINTAT_OBJECTFILTER
        HeroScanDistance        =    150
        FearScanDistance        =     ARCHER_FEAR_SCAN_RADIUS

        AddEmotion            =    Terror_Base



        AddEmotion            =    Doom_Base


        AddEmotion            =   BraceForBeingCrushed_Base

        AddEmotion            =    UncontrollableFear_Base



        AddEmotion            =    FearIdle_Base



        AddEmotion            =    FearBusy_Base



        AddEmotion            =    Point_Base




        AddEmotion            =    Taunt_Base



         AddEmotion    =    CheerIdle_Base
        AddEmotion    =    CheerBusy_Base
        AddEmotion    =    HeroCheerIdle_Base
        AddEmotion    =    HeroCheerBusy_Base
        AddEmotion    =    Alert_Base
    End


    Behavior = SpecialPowerModule ModuleTag_ElfCloakStarter
        SpecialPowerTemplate      = SpecialAbilityElfCloak
        UpdateModuleStartsAttack  = Yes
        StartsPaused              = No
    End
    Behavior = ToggleHiddenSpecialAbilityUpdate ModuleTag_ElfCloakUpdate
        SpecialPowerTemplate = SpecialAbilityElfCloak
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP = Yes
    End


    Behavior = LevelUpUpgrade ModuleTag_BasicTraining
        TriggeredBy = Upgrade_BasicTraining
        LevelsToGain = 1
        LevelCap = 2
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality
        TriggeredBy = Upgrade_SilverThornArrows
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
        TriggeredBy = Upgrade_HeavyArmor
    End

    Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality4
        TriggeredBy = Upgrade_SilverThornArrows
    End

    LocomotorSet
        Locomotor     = NormalRangedHordeLocomotor
        Condition     = SET_NORMAL
        Speed         = NORMAL_FOOT_VERYFAST_HORDE_SPEED
    End

    Behavior = PickupStuffUpdate ModuleTag_PickupStuffUpdate
        SkirmishAIOnly         = Yes
        StuffToPickUp         = ANY +CRATE -TheDroppedRing
        ScanRange         = 200
        ScanIntervalSeconds     = 0.5
    End





    Behavior = AISpecialPowerUpdate ElvenMirkwoodArcherHordeCaptureBuildingAI
        CommandButtonName = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End


    Behavior = LifetimeUpdate ModuleTag_LifetimeUpdate

        MinLifetime        = 120000
        MaxLifetime        = 120000
        DeathType        = FADED
    End

    Geometry         = BOX
    GeometryMajorRadius     = 20.0
    GeometryMinorRadius     = 60.0
    GeometryHeight         = 10.0
    GeometryIsSmall     = No




    AutoResolveUnitType = AutoResolveUnit_Archer
    AutoResolveCombatChain = AutoResolve_ArcherCombatChain

    AutoResolveBody = AutoResolve_ElvenMirkwoodArcherHordeBody

    AutoResolveArmor
        Armor = AutoResolve_ElvenMirkwoodArcherArmor
    End

    AutoResolveWeapon
        RequiredUpgrades = Upgrade_SilverThornArrows
        Weapon = AutoResolve_ElvenMirkwoodArcherUpgradedWeapon
    End

    AutoResolveWeapon
        ExcludedUpgrades = Upgrade_SilverThornArrows
        Weapon = AutoResolve_ElvenMirkwoodArcherWeapon
    End

    WorldMapArmoryUpgradesAllowed = Upgrade_BasicTraining Upgrade_SilverThornArrows
End


ChildObject MirkwoodWachterArcherHorde_Summoned MirkwoodWachterArcherHorde
    IsTrainable    = No
    CommandPoints     = 0
    CommandSet    = IsengartSpellUnitsCommandSet
    EquivalentTo      = MirkwoodWachterArcherHorde
    KindOf                = +SUMMONED

    DisplayName  =  OBJECT:HordeLorienMirkwoodArcher

    Behavior = HordeContain ModuleTag_HordeContain
        FrontAngle = STANDARD_INFANTRY_FRONTANGLE
        FlankedDelay = STANDARD_INFANTRY_FLANKEDDELAY
        ObjectStatusOfContained =
        InitialPayload     = MirkwoodWachterArcher_Summoned 10
        Slots         = 10
        PassengerFilter    = NONE +INFANTRY
        ShowPips     = No
        ThisFormationIsTheMainFormation = Yes
        RandomOffset    = X:0 Y:0
        MeleeBehavior     = Amoeba
        End

        RankInfo = RankNumber:1 UnitType:MirkwoodWachterArcher Position:X:50 Y:0            Position:X:50 Y:20                Position:X:50 Y:-20                Position:X:50 Y:40                Position:X:50 Y:-40
        RankInfo = RankNumber:2 UnitType:MirkwoodWachterArcher Position:X:30 Y:0 Leader 1 0    Position:X:30 Y:20 Leader 1 1    Position:X:30 Y:-20 Leader 1 2    Position:X:30 Y:40 Leader 1 3    Position:X:30 Y:-40 Leader 1 4

        RanksToReleaseWhenAttacking = 1 2
    End

    Behavior = LifetimeUpdate ModuleTag_LifetimeUpdate

        MinLifetime        = 120000
        MaxLifetime        = 120000
        DeathType        = FADED
    End
End