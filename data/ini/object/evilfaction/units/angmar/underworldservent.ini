Object UnderworldServent

    SelectPortrait = HPUnderworldServent
    ButtonImage    = HIUnderworldServent

    Draw = W3DHordeModelDraw ModuleTag_01

   WadingParticleSys    = WaterRipplesTrail

        DefaultModelConditionState
             Model               = muschergg
             Model               = muscherge  ExtraMesh:Yes
             Model               = muschergb  ExtraMesh:Yes
            Skeleton             = MUGblnSwrd_SKL
        End

        AnimationState                        = PASSENGER
            Animation                        = Wiggling
                AnimationName                = MUGblnSwrd_FLLA
                AnimationMode                = LOOP
            End
        End

        AnimationState                        = THROWN_PROJECTILE
            StateName                        = STATE_Flying
            Animation                        = Thrown
                AnimationName                = MUGblnSwrd_FLYA
                AnimationMode                = LOOP
            End
            Animation                        = Thrown
                AnimationName                = MUGblnSwrd_FLYB
                AnimationMode                = LOOP
            End
            Animation                        = Thrown
                AnimationName                = MUGblnSwrd_FLYC
                AnimationMode                = LOOP
            End
        End


    AnimationState                        = CLIMBING
        StateName                        = STATE_Climbing
        Animation                        = Climbing
            AnimationName                = MUGblnSwrd_WALB
            AnimationMode                = LOOP
            AnimationBlendTime            = 10
        End
        BeginScript
            Prev = CurDrawablePrevAnimationState()
            if Prev == "STATE_Running"  then CurDrawableSetTransitionAnimState("Trans_RunningToClimbing") return end
            if Prev == "STATE_Rappelling"  then CurDrawableSetTransitionAnimState("Trans_RappellingToClimbing") return end
        EndScript
    End
    TransitionState = Trans_RunningToClimbing
        Animation = Transition
            AnimationName = MUGblnSwrd_WALA
            AnimationMode = ONCE
        End
    End
    TransitionState = Trans_RappellingToClimbing
        Animation = Transition
            AnimationName = MUGblnSwrd_WALG
            AnimationMode = ONCE_BACKWARDS
        End
    End
    AnimationState                        = RAPPELLING
        StateName                        = STATE_Rappelling
        Animation                        = Rapelling
            AnimationName                = MUGblnSwrd_WALE
            AnimationMode                = LOOP
            AnimationBlendTime            = 10
        End
        BeginScript
            Prev = CurDrawablePrevAnimationState()
            if Prev == "STATE_Running"  then CurDrawableSetTransitionAnimState("Trans_RunningToRappelling") return end
            if Prev == "STATE_Climbing"  then CurDrawableSetTransitionAnimState("Trans_ClimbingToRappelling") return end
        EndScript
    End
    TransitionState = Trans_RunningToRappelling
        Animation = Transition
            AnimationName = MUGblnSwrd_WALD
            AnimationMode = ONCE
        End
    End
    TransitionState = Trans_ClimbingToRappelling
        Animation = Transition
            AnimationName = MUGblnSwrd_WALG
            AnimationMode = ONCE
        End
    End


        AnimationState                        = FREEFALL
            Animation                        = Falling
                AnimationName                = MUGblnSwrd_FLYB
                AnimationMode                = LOOP
                AnimationBlendTime            = 10
                AnimationSpeedFactorRange    = 0.7    0.7
            End
        End

        AnimationState                        = STUNNED_FLAILING
            StateName                        = STATE_Flying
            Animation                        = ready_for_sweet_landing
                AnimationName                = MUGblnSwrd_FLYA
                AnimationMode                = LOOP
                AnimationSpeedFactorRange    = 0.4 0.6
                AnimationBlendTime            = 0
            End
            Animation                        = flying
                AnimationName                = MUGblnSwrd_FLYB
                AnimationMode                = LOOP
                AnimationPriority            = 10
                AnimationSpeedFactorRange    = 0.4 0.6
                AnimationBlendTime            = 0
            End
            Flags                            = RANDOMSTART
        End

        AnimationState            = DYING BURNINGDEATH
            Animation
                AnimationName    = MUGblnSwrd_DIEA
                AnimationMode    = ONCE
                AnimationBlendTime = 10
            End
            Animation
                AnimationName    = MUGblnSwrd_DIEB
                AnimationMode    = ONCE
                AnimationBlendTime = 10
            End
            Animation
                AnimationName    = MUGblnSwrd_DIEC
                AnimationMode    = ONCE
                AnimationBlendTime = 10
            End
        End

        AnimationState                        = DYING SPLATTED
            Animation                        = splat
                AnimationName                = MUGblnSwrd_LNDB
                AnimationMode                = ONCE
            End
        End





        AnimationState                        = DYING AFLAME
            StateName                        = STATE_Dead.
            Animation                        = Flaming_Death
                AnimationName                = MUGblnSwrd_MFDA
                AnimationMode                = LOOP
            End
        End

        AnimationState                        = DYING
            StateName                        = STATE_Dead.
            Animation                        = Dying_1
                AnimationName                = MUGblnSwrd_DIEA
                AnimationMode                = ONCE
            End
            Animation                        = Dying_2
                AnimationName                = MUGblnSwrd_DIEB
                AnimationMode                = ONCE
            End
            Animation                        = Dying_2
                AnimationName                = MUGblnSwrd_DIEC
                AnimationMode                = ONCE
            End
            Animation                        = landb
                AnimationName                = MUGblnSwrd_LNDB
                AnimationMode                = ONCE
            End
            Animation                        = landc
                AnimationName                = MUGblnSwrd_LNDC
                AnimationMode                = ONCE
            End
            BeginScript
                Preva = CurDrawablePrevAnimation()
                if Preva == "ready_for_sweet_landing" then return "landc"
                elseif Preva == "flying" then return "landb"
                elseif GetClientRandomNumberReal(0,1) > 0.50 then return "Dying_1"
                else return "Dying_2" end
            EndScript
        End

        AnimationState                        = STUNNED_STANDING_UP
            StateName                        = STATE_Ready
            Animation                        = standing_back_up
                AnimationName                = MUGblnSwrd_GTPA
                AnimationMode                = ONCE

            End
            Animation                        = already_up
                AnimationName                = MUGblnSwrd_IDLB
                AnimationMode                = LOOP
                AnimationBlendTime            = 20
            End
            BeginScript
                if CurDrawablePrevAnimation() == "sweet_landing"
                then
                    return "already_up"
                else
                    return "standing_back_up"
                end
            EndScript
        End

        AnimationState                        = STUNNED
            StateName                        = STATE_Stunned
            Animation                        = splatted_on_ground
                AnimationName                = MUGblnSwrd_LNDC
                AnimationMode                = ONCE
            End
            Animation                        = sweet_landing
                AnimationName                = MUGblnSwrd_LNDA
                AnimationMode                = ONCE
            End
            BeginScript
                if CurDrawablePrevAnimation() == "ready_for_sweet_landing"
                then
                    return "sweet_landing"
                else
                    return "splatted_on_ground"
                end
            EndScript
        End

        AnimationState            = BURNINGDEATH
            Animation
                AnimationName    = MUGblnSwrd_MFDA
                AnimationMode    = LOOP
                Distance        = 30
            End
        End

        AnimationState                        = PARALYZED
            Animation
                AnimationName                = MUGblnSwrd_IDLA
                AnimationMode                = LOOP
            End
        End



        AnimationState = MOVING FIRING_OR_PREATTACK_A
            Animation = TrotAndFire
                AnimationName = MUGblnSwrd_RUNA
                AnimationMode = LOOP
            End
            Flags = RANDOMSTART

        End

        AnimationState                        = MOVING BACKING_UP
            Animation                        = BackingUp
                AnimationName                = MUGblnSwrd_BAKA
                AnimationMode                = LOOP
                AnimationSpeedFactorRange    = 0.9 1.1
            End
            Animation                        = BackingUp
                AnimationName                = MUGblnSwrd_BAKB
                AnimationMode                = LOOP
                AnimationSpeedFactorRange    = 0.9 1.1

            End
            Animation                        = BackingUp
                AnimationName                = MUGblnSwrd_BAKC
                AnimationMode                = LOOP
                AnimationSpeedFactorRange    = 0.9 1.1
            End
            Flags                            = RANDOMSTART
        End

        AnimationState                        = MOVING EMOTION_TERROR
            ShareAnimation                    = Yes
            Animation                        = Moving_1
                AnimationName                = MUGblnSwrd_RUNA
                AnimationMode                = LOOP

                AnimationSpeedFactorRange    = 0.5 0.6
                Distance                    = 20
            End
            Flags                            = RANDOMSTART
            ParticleSysBone                    = None InfantryDustTrails
        End

        AnimationState                        = MOVING
            StateName                        = STATE_Running
            ShareAnimation                    = Yes
            Animation                        = Moving_1
                AnimationName                = MUGblnSwrd_RUNA
                AnimationMode                = LOOP

                AnimationSpeedFactorRange    = 0.5 0.6
                Distance                    = 20
            End
            Flags                            = RANDOMSTART
            ParticleSysBone                    = None InfantryDustTrails
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Climbing"  then CurDrawableSetTransitionAnimState("Trans_ClimbingToRunning") return end
                if Prev == "STATE_Rappelling"  then CurDrawableSetTransitionAnimState("Trans_RappellingToRunning") return end
            EndScript
        End
    TransitionState = Trans_ClimbingToRunning
        Animation = Transition
            AnimationName = MUGblnSwrd_WALC
            AnimationMode = ONCE
        End
        Animation = Transition
            AnimationName = MUGblnSwrd_WALH
            AnimationMode = ONCE
        End
    End
    TransitionState = Trans_RappellingToRunning
        Animation = Transition
            AnimationName = MUGblnSwrd_WALF
            AnimationMode = ONCE
        End
    End



        AnimationState                        = FIRING_OR_PREATTACK_A
            StateName                        = STATE_Ready
            Animation                        = ATKA
                AnimationName                = MUGblnSwrd_ATKA
                AnimationMode                = ONCE
                UseWeaponTiming                = Yes
            End
            Animation                        = ATKB
                AnimationName                = MUGblnSwrd_ATKA
                AnimationMode                = ONCE
                UseWeaponTiming                = Yes
            End
            Animation                        = ATKC
                AnimationName                = MUGblnSwrd_ATKC
                AnimationMode                = ONCE
                UseWeaponTiming                = Yes
            End
        End



        AnimationState                        = EMOTION_AFRAID
            Animation                        = FERA
                AnimationName                = MUGblnSwrd_FERA
                AnimationMode                = LOOP
            End
            Animation                        = FERB
                AnimationName                = MUGblnSwrd_FERB
                AnimationMode                = LOOP
            End
            Animation                        = FERC
                AnimationName                = MUGblnSwrd_FERC
                AnimationMode                = LOOP
            End
            Flags                            = RANDOMSTART
        End
        AnimationState                        = EMOTION_TAUNTING
            Animation                        = TNTA
                AnimationName                = MUGblnSwrd_TNTA
                AnimationMode                = LOOP
            End
            Animation                        = TNTB
                AnimationName                = MUGblnSwrd_TNTB
                AnimationMode                = LOOP
            End
            Animation                        = TNTC
                AnimationName                = MUGblnSwrd_TNTC
                AnimationMode                = LOOP
            End
            Flags                            = RANDOMSTART
        End
        AnimationState                        = EMOTION_POINTING
            Animation                        = Pointing1A
                AnimationName                = MUGblnSwrd_PNTA
                AnimationMode                = LOOP
            End
            Animation                        = Pointing1B
                AnimationName                = MUGblnSwrd_PNTB
                AnimationMode                = LOOP
            End
            Animation                        = Pointing1C
                AnimationName                = MUGblnSwrd_PNTC
                AnimationMode                = LOOP
            End
            Flags                            = RANDOMSTART
        End
        AnimationState                        = EMOTION_CELEBRATING
            Animation                        = CHRA
                AnimationName                = MUGblnSwrd_CHRA
                AnimationMode                = LOOP
            End
            Animation                        = CHRB
                AnimationName                = MUGblnSwrd_CHRB
                AnimationMode                = LOOP
            End
            Animation                        = CHRC
                AnimationName                = MUGblnSwrd_CHRC
                AnimationMode                = LOOP
            End
            Flags                            = RANDOMSTART
        End
        AnimationState                        = EMOTION_ALERT
            Animation                        = IDLB
                AnimationName                = MUGblnSwrd_IDLB
                AnimationMode                = LOOP
            End
            Flags                            = RANDOMSTART
        End

        AnimationState                        = RAISING_FLAG
            Animation                        = CHRA
                AnimationName                = MUGblnSwrd_CHRA
                AnimationMode                = LOOP
            End
            Animation                        = CHRB
                AnimationName                = MUGblnSwrd_CHRB
                AnimationMode                = LOOP
            End
            Animation                        = CHRC
                AnimationName                = MUGblnSwrd_CHRC
                AnimationMode                = LOOP
            End
        End



        AnimationState = SELECTED
            Animation                = Selected_Loop
                AnimationName        = MUGblnSwrd_ATNB
                AnimationMode        = LOOP
                AnimationBlendTime    = 10
            End
            StateName                = Selected
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Idle"    then CurDrawableSetTransitionAnimState("Trans_Down_To_Up") return end
                if Prev == "Selected" then CurDrawableSetTransitionAnimState("Trans_Up_To_Down") end
            EndScript
            Flags = RESTART_ANIM_WHEN_COMPLETE
        End




        TransitionState = Trans_Down_To_Up
            Animation = Transition
                AnimationName = MUGblnSwrd_ATNA
                AnimationMode = ONCE
            End
        End

        TransitionState = Trans_Up_To_Down
            Animation = Transition
                AnimationName = MUGblnSwrd_ATNC
                AnimationMode = ONCE
            End
        End



        IdleAnimationState
            StateName                        = Idle
            Animation                        = IDLA
                AnimationName                = MUGblnSwrd_IDLA
                AnimationMode                = ONCE
                AnimationSpeedFactorRange    = 0.9 1.1
                AnimationPriority            = 10
            End
            Animation                        = IDLB
                AnimationName                = MUGblnSwrd_IDLB
                AnimationMode                = ONCE
                AnimationSpeedFactorRange    = 0.9 1.1
                AnimationPriority            = 10
            End
            Animation                        = IDLC
                AnimationName                = MUGblnSwrd_IDLC
                AnimationMode                = ONCE
                AnimationSpeedFactorRange    = 0.9 1.1
                AnimationPriority            = 5
            End
            Animation                        = IDLD
                AnimationName                = MUGblnSwrd_IDLD
                AnimationMode                = ONCE
                AnimationSpeedFactorRange    = 0.9 1.1
                AnimationPriority            = 5
            End
            Animation                        = IDLE
                AnimationName                = MUGblnSwrd_IDLE
                AnimationMode                = ONCE
                AnimationSpeedFactorRange    = 0.9 1.1
                AnimationPriority            = 5
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Planted"    then CurDrawableSetTransitionAnimState("Trans_Down_To_Up") return end

            EndScript
        End

    End



    Draw = W3DScriptedModelDraw Icon
        ModelConditionState = NONE
            Model           = bbox
        End
    End

    #include "..\..\..\includes\StunDrawModuleSmall.inc"







    Side                            = Angmar
    EditorSorting                   = UNIT
    IsTrainable                = Yes
    ThreatLevel                = 1.0
    ShockwaveResistance          = 10
    ThingClass                = HORDE_UNIT
    TransportSlotCount             = TRANSPORTSLOTCOUNT_UNIT

    MaxSimultaneousOfType            = 12

    VisionRange             = CREEP_VISION
    ShroudClearingRange         = 100
    VisionSide                 = 35%
    VisionRear                 = 25%
    MaxVisionBonusPercent         = 300%
    VisionBonusTestRadius         = 200
    VisionBonusPercentPerFoot       = 2.0%

    CrushableLevel                = 0
    CrusherLevel                  = 0
    BountyValue                   = 50
    CrushRevengeWeapon            = BasicInfantryCrushRevenge

    DisplayName                   = OBJECT:UnderworldServent

    CommandSet                    = UnderworldServentCommandSet
    CommandPoints                = 0





    WeaponSet
        Conditions             = None
        Weapon                 = PRIMARY UnderworldServentSword
        AutoChooseSources         = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End





    ArmorSet
        Conditions              = None
        Armor                   = AngbandSupportHeroArmor
        DamageFX                = NormalDamageFX
    End





    VoiceAttack                         = GoblinCreepVoxAttack
    VoiceAttackAir                      = GoblinCreepVoxAttack
    VoiceAttackStructure                = GoblinCreepVoxAttack
    VoiceAttackCharge                   = GoblinCreepVoxAttack
    VoiceMove                           = GoblinCreepVoxMove
    VoiceMoveWhileAttacking             = GoblinCreepVoxMove
    VoicePriority                       = 3
    VoiceRetreatToCastle                = GoblinCreepVoxMove
    VoiceSelect                         = GoblinCreepVoxSelectMS
    VoiceSelectBattle                   = GoblinCreepVoxSelectMS

    SoundImpact                         = ImpactHorse

    CrowdResponseKey = Goblin

    Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
        Key = Goblin
    End

    #include "..\..\..\includes\StandardUnitEvaEvents.inc"

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound:BodyFallGeneric2  Animation:MUGblnSwrd_SKL.MUGblnSwrd_DIEA    Frames:10
        AnimationSound = Sound:BodyFallGeneric2  Animation:MUGblnSwrd_SKL.MUGblnSwrd_DIEB    Frames:7
        AnimationSound = Sound:BodyFallOrc       Animation:MUGblnSwrd_SKL.MUGblnSwrd_LNDB    Frames:6
        AnimationSound = Sound:BodyFallOrc       Animation:MUGblnSwrd_SKL.MUGblnSwrd_LNDC    Frames:3
    End







    RadarPriority = UNIT
    KindOf = PRELOAD CREEP SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE THROWN_OBJECT GRAB_AND_DROP CAN_CLIMB_WALLS ORC CAN_USE_SIEGE_TOWER

    ThreatBreakdown MordorGoblinSwordsmanSlaved_ThreatBreakdown
        AIKindOf = CREEP
    End

    Behavior = SlavedUpdate ModuleTag_Slave
        GuardMaxRange                = 300
        GuardWanderRange             = 100
        UseSlaverAsControlForEvaObjectSightedEvents = Yes
        DieOnMastersDeath                           = Yes
    End

    Body = ActiveBody ModuleTag_02
        MaxHealth                    = 350
        MaxHealthDamaged             = 100
        BurningDeathBehavior         = Yes
        BurningDeathFX               = FX_InfantryBurningFlame
    End

    Behavior = AIUpdateInterface ModuleTag_03
        AutoAcquireEnemiesWhenIdle        = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate               = 500
        AILuaEventsList                   = GoblinFighterFunctions
        AttackPriority                    = AttackPriority_Infantry
        BurningDeathTime                  = BURNINGDEATH_DURATION_INFANTRY
    End

    LocomotorSet
        Locomotor  = TestWallScalingHordeLocomotor
        Condition  = SET_NORMAL
        Speed      = 60
    End

    LocomotorSet
        Locomotor  = HumanWanderLocomotor
        Condition  = SET_WANDER
        Speed      = 50
    End

    LocomotorSet
        Locomotor = BurningDeathLocomotorInfantry
        Condition = SET_BURNINGDEATH
        Speed     = BURNINGDEATH_WANDERSPEED_INFANTRY
    End

    Behavior = PhysicsBehavior ModuleTag_04
        GravityMult                   = 1.0
        ShockStunnedTimeLow           = 800
        ShockStunnedTimeHigh          = 1000
        ShockStandingTime             = 2133
    End

    Behavior = SlowDeathBehavior ModuleTag_05
        DeathTypes                    = ALL -KNOCKBACK -EXTRA_8
        SinkDelay                     = 3000
        SinkRate                      = 0.40
        DestructionDelay              = 8000
        Sound                         = INITIAL GoblinVoxDieMS
    End

    Behavior = SquishCollide ModuleTag_06
    End

    Behavior = HordeMemberCollide ModuleTag_HMC
    End

    Behavior = SlowDeathBehavior ModuleTag_07
        DeathTypes                    = NONE +KNOCKBACK
        SinkDelay                     = 3000
        SinkRate                      = 0.40
        DestructionDelay              = 8000
        Sound                         = INITIAL GoblinVoxDieMS
    End

    Behavior = SlowDeathBehavior ModuleTag_GrabandDrop
        DeathTypes                    = NONE +EXTRA_8
        SinkDelay                     = 3000
        SinkRate                      = 0.60
        DestructionDelay              = 10000
        DeathFlags                    = DEATH_4
        ShadowWhenDead                = Yes
    End

    Behavior = FireWeaponWhenDeadBehavior ModuleTag_GrabandDropImpact
        RequiredStatus                = DEATH_4
        StartsActive                  = Yes
        DelayTime                     = 0
        DeathWeapon                   = GrabandDropInfantryImpactWarhead
        WeaponOffset                  = X:0 Y:0 Z:0
    End

    Behavior = BezierProjectileBehavior ModuleTag_BodyHitHuman
       FirstHeight                   = 24
       SecondHeight                  = 24
       FirstPercentIndent            = 30%
       SecondPercentIndent           = 70%
       TumbleRandomly                = Yes
       CrushStyle                    = Yes
       DieOnImpact                   = Yes
       BounceCount                   = 1
       BounceDistance                = 40
       BounceFirstHeight             = 24
       BounceSecondHeight            = 24
       BounceFirstPercentIndent      = 20%
       BounceSecondPercentIndent     = 80%
       GroundHitFX                   = FX_GrabandDropInfantryGroundHit
       GroundBounceFX                = FX_GrabandDropInfantryGroundHit
    End

    Behavior = SubObjectsUpgrade ModuleTag_Making
        TriggeredBy               = Upgrade_ObjectLevel1
        HideSubObjects            = FEET SHOULDER ARM WEAPON02 WEAPON03 WEAPON04 WEAPON05
    End

    Behavior = SubObjectsUpgrade ModuleTag_Making2
        TriggeredBy               = Upgrade_HeavyArmor
        ShowSubObjects            = FEET SHOULDER ARM
    End

    Behavior = AttributeModifierUpgrade ModuleTag_AMU
        TriggeredBy                = Upgrade_AllFactionUpgrade
        AttributeModifier          = FearlessForever
    End

    Geometry            = CYLINDER
    GeometryMajorRadius = 8.0
    GeometryMinorRadius = 8.0
    GeometryHeight      = 19.2
    GeometryIsSmall     = Yes
    Shadow              = SHADOW_DECAL
    ShadowSizeX         = 11
    ShadowSizeY         = 11
    ShadowTexture       = ShadowI
End

