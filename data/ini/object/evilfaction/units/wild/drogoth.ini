Object Drogoth

    ButtonImage    = HIDrogoth
    SelectPortrait = HPDrogoth

    DescriptionStrategic = CONTROLBAR:LW_ToolTip_LeaderHero

    ShockwaveResistance = SHOCKWAVE_RESISTANCE_ALWAYS

    Draw = W3DScriptedModelDraw ModuleTag_01

        OkToChangeModelColor = Yes

        DefaultModelConditionState
            Model               = WUDrogoth_SKN
            WeaponLaunchBone    = PRIMARY BAT_JAW
            WeaponLaunchBone    = SECONDARY BAT_TAIL08
        End
	ModelConditionState     = USER_5
            Model               = wudrogbtp_skn
        End

        IdleAnimationState
            StateName = Idle
            Animation = IDLA
                AnimationName = WUDrogoth_SKL.WUDrogoth_FLYA
                AnimationMode = LOOP
                AnimationSpeedFactorRange = 0.95 1.05
            End
            BeginScript
                 Prev = CurDrawablePrevAnimationState()
                 if Prev == "STATE_WingBlastLoop" then
                     CurDrawableSetTransitionAnimState("TRANS_WingBlastStop") end
             EndScript
        End


        AnimationState = RUBBLE
            Animation = RubbleDieF
                AnimationName = WUDrogoth_SKL.WUDrogoth_DIEC
                AnimationMode = ONCE
                AnimationBlendTime = 8
            End
        End

        TransitionState = Trans_Dying
            Animation = Transition
                AnimationName = WUDrogoth_SKL.WUDrogoth_DIEA
                AnimationMode = ONCE
                AnimationBlendTime = 3
            End
        End

        AnimationState = DYING DEATH_1
            StateName = DYING
            Animation = DyingA
                AnimationName = WUDrogoth_SKL.WUDrogoth_DIEB
                AnimationMode = ONCE
                AnimationBlendTime = 4
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Idle"     then CurDrawableSetTransitionAnimState("Trans_Dying") return end
                if Prev == "Moving"   then CurDrawableSetTransitionAnimState("Trans_Dying") return end
                if Prev == "Freefall" then CurDrawableSetTransitionAnimState("Trans_Dying") return end
                if Prev == "Climbing" then CurDrawableSetTransitionAnimState("Trans_Dying") return end
                if Prev == "Diving"   then CurDrawableSetTransitionAnimState("Trans_Dying") return end
                if Prev == "backup"   then CurDrawableSetTransitionAnimState("Trans_Dying") return end
                if Prev == "STUNNED"  then CurDrawableSetTransitionAnimState("Trans_Dying") return end
                if Prev == "Claw"     then CurDrawableSetTransitionAnimState("Trans_Dying") return end
                if Prev == "STATE_WingBlastLoop"     then CurDrawableSetTransitionAnimState("Trans_Dying") return end
           EndScript
        End

          AnimationState = DYING DEATH_2
               StateName = DYING
            Animation = DyingA
                AnimationName = WUDrogoth_SKL.WUDrogoth_DIEK
                  AnimationMode = ONCE
              End
        End

         AnimationState    = BACKING_UP
               StateName = backup
               Animation = IDLA
                   AnimationName = WUDrogoth_SKL.WUDrogoth_FLYA
                   AnimationMode = LOOP

                AnimationSpeedFactorRange = 0.95 1.05
               End
           End

           AnimationState = DIVING
               StateName = Diving
               Animation = Diving
                   AnimationName = WUDrogoth_SKL.WUDrogoth_FLYA
                   AnimationMode = LOOP

                 AnimationSpeedFactorRange = 0.95 1.05
              End
           End


        AnimationState = ABOUT_TO_HIT
            StateName = Claw
            Animation = Claw
                AnimationName = WUDrogoth_SKL.WUDrogoth_ATKA
                AnimationMode = LOOP
            End
        End

        AnimationState            = SPECIAL_WEAPON_ONE
            Animation
                AnimationName    = WUDrogoth_SKL.WUDrogoth_SPCA
                AnimationMode   = LOOP
            End
        End

        AnimationState            = SPECIAL_WEAPON_TWO
            Animation
                AnimationName    = WUDrogoth_SKL.WUDrogoth_SPCB
                AnimationMode   = LOOP
            End

            ParticleSysBone = BAT_HEAD DrogothFireBreath FollowBone:Yes
            ParticleSysBone = BAT_JAW balrogBreathEmbers FollowBone:Yes
            ParticleSysBone = BAT_JAW balrogBreathSmoke FollowBone:Yes
            ParticleSysBone = BAT_HEAD DrogothBreathProxy FollowBone:Yes
        End


        AnimationState            = SPECIAL_WEAPON_THREE
            StateName            = STATE_WingBlastLoop
            Animation
                AnimationName                = WUDrogoth_SKL.WUDrogoth_SPC2
                AnimationMode                = LOOP
                AnimationSpeedFactorRange    = 0.9 0.9
            End
            FXEvent    = Frame:6 Name:FX_WindBlast
              BeginScript
                 Prev = CurDrawablePrevAnimationState()
                 if Prev ~= "TRANS_WingBlastStart" and Prev ~= "STATE_WingBlastLoop" then
                     CurDrawableSetTransitionAnimState("TRANS_WingBlastStart") end
             EndScript
        End

           TransitionState = TRANS_WingBlastStart
               Animation
                   AnimationName = WUDrogoth_SKL.WUDrogoth_SPC1
                   AnimationMode = ONCE
               End
           End

           TransitionState = TRANS_WingBlastStop
               Animation
                   AnimationName = WUDrogoth_SKL.WUDrogoth_SPC3
                   AnimationMode = ONCE
               End
           End


        AnimationState            = USER_1
            Animation
                AnimationName    = WUDrogoth_SKL.WUDrogoth_SPCF
                AnimationMode    = ONCE
            End
        End


        AnimationState = CLIMBING
            StateName = Climbing
            Animation = Moving
                AnimationName = WUDrogoth_SKL.WUDrogoth_FLYA
                AnimationMode = LOOP
                AnimationSpeedFactorRange = 0.95 1.05
            End
        End
        AnimationState = FREEFALL
            StateName = Freefall
            Animation = Moving
                AnimationName = WUDrogoth_SKL.WUDrogoth_FLYA
                AnimationMode = LOOP
            End
        End

        AnimationState = MOVING
            StateName = Moving
            Animation = Moving
                AnimationName = WUDrogoth_SKL.WUDrogoth_FLYB
                AnimationMode = LOOP

                AnimationSpeedFactorRange = 0.9 1.1
            End
              BeginScript
                 Prev = CurDrawablePrevAnimationState()
                 if Prev == "Idle"    then CurDrawableSetTransitionAnimState("Trans_Begin_Moving") return end
                 if Prev == "Climbing"    then CurDrawableSetTransitionAnimState("Trans_Begin_Moving") return end
                 if Prev == "STATE_WingBlastLoop" then
                     CurDrawableSetTransitionAnimState("TRANS_WingBlastStop") end
             EndScript
         End

           TransitionState = Trans_Begin_Moving
               Animation = Transition
                   AnimationName = WUDrogoth_SKL.WUDrogoth_FLYC
                   AnimationMode = ONCE
                   AnimationBlendTime = 6
               End
           End

           AnimationState = LEVELED
            Animation
                AnimationName = WUDrogoth_SKL.WUDrogoth_LVLA
                AnimationMode = LOOP
            End
        End
    End

    Side                  = Wild
    EditorSorting         = UNIT
    ThreatLevel           = DROGOTH_THREAT_LEVEL
    ThingClass            = LARGE_MONSTER
    TransportSlotCount    = TRANSPORTSLOTCOUNT_NOT_TRANSPORTABLE
    DisplayMeleeDamage = STANDARD_PLOW_DAMAGE_INNER
    BuildCost             = STRONG_FLYING_HERO_COST
    BuildTime             = STRONG_HERO_BUILDTIME
    MaxSimultaneousOfType = 1
    DisplayMeleeDamage    = STRONG_HERO_DAMAGE

    WeaponSet
        Weapon                 = SECONDARY       ThorondorGrabAttack
        PreferredAgainst       = SECONDARY       STRUCTURE MACHINE HORDE INFANTRY CAVALRY
        Weapon                 = TERTIARY        NazgulClawAttack
        OnlyAgainst            = TERTIARY        MONSTER
        ReadyStatusSharedWithinSet = Yes
    End

    ArmorSet
        Conditions      = None
        Armor           = MediumFlyingHeroArmor
        DamageFX        = FellBeastDamageFX
    End

    ArmorSet
        Conditions      = PLAYER_UPGRADE
        Armor           = StrongFlyingHeroArmor
        DamageFX        = FellBeastDamageFX
    End


    VisionRange         = VISION_FLIER
    ShroudClearingRange = SHROUD_CLEAR_FLIER


    DisplayName         = OBJECT:Drogothnew
    RecruitText         = CONTROLBAR:WildDrogothnewRecruit
    ReviveText          = CONTROLBAR:WildDrogothnewRevive
    Hotkey              = CONTROLBAR:WildDrogothnewHotkey
    RamPower            = 45
    RamZMult            = 0.5
    CrusherLevel        = 3
    CrushKnockback      = 50
    CrushZFactor        = 1.0
    CommandSet          = DrogothFlyCommandSet
    CommandPoints       = 0

    AutoResolveUnitType = AutoResolveUnit_Hero
    AutoResolveCombatChain = AutoResolve_HeroCombatChain

    AutoResolveBody = AutoResolve_DrogothBody

    AutoResolveArmor
        Armor = AutoResolve_DrogothArmor
    End

    AutoResolveWeapon
        Weapon = AutoResolve_DrogothWeapon
    End

    VoiceAttack                            = DrogothVoxAttack
    VoiceAttackCharge                    = DrogothVoxAttackCharge
    VoiceCreated                        = EVA:DrogothCreated
    VoiceFullyCreated                    = EVA:DrogothCreated
    VoiceFear                            = EVA:DrogothHelpMe
    VoiceGuard                            = DrogothVoxMoveMS
    VoiceMove                            = DrogothVoxMoveMS
    VoicePriority                        = 90
    VoiceSelect                            = DrogothVoxSelect

    VoiceEnterStateAttack                = DrogothVoxEnterStateAttack
    VoiceEnterStateAttackCharge            = DrogothVoxEnterStateAttackCharge
    VoiceEnterStateAttackStructure        = DrogothVoxEnterStateAttackBuilding

    SoundAmbient                        = DrogothVoxAmbientLoop
    SoundImpact                            = ImpactHorse
    SoundMoveStart                        = FellBeastMoveStart


    #include "..\..\..\includes\StandardUnitEvaEvents.inc"
    EvaEventDieOwner        = DrogothDie

    ClientBehavior = ModelConditionAudioLoopClientBehavior ModuleTag_foo
        ModelCondition = Required:SPECIAL_WEAPON_TWO    Excluded:DYING Sound:DrogothIncinerateMS
        ModelCondition = Required:SPECIAL_WEAPON_THREE    Excluded:DYING Sound:DrogothWingBlastLoop
    End

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound: FellBeastWingFlaps            Animation:WUDrogoth_SKL.WUDrogoth_FLYA     Frames: 1
        AnimationSound = Sound: FellBeastWingFlaps            Animation:WUDrogoth_SKL.WUDrogoth_FLYB     Frames: 1
        AnimationSound = Sound: FellBeastWingFlaps            Animation:WUDrogoth_SKL.WUDrogoth_FLYC     Frames: 1 43 91
        AnimationSound = Sound: FellBeastWingFlapsShort        Animation:WUDrogoth_SKL.WUDrogoth_HITA     Frames: 11
        AnimationSound = Sound: FellBeastWingFlaps            Animation:WUDrogoth_SKL.WUDrogoth_LVLA     Frames: 1 42
        AnimationSound = Sound: DrogothVoxVeterancy            Animation:WUDrogoth_SKL.WUDrogoth_LVLA     Frames: 15
        AnimationSound = Sound: FellBeastWingFlapsShort        Animation:WUDrogoth_SKL.WUDrogoth_SPC1     Frames: 1 22
        AnimationSound = Sound: DrogothWingBlastWingFlaps    Animation:WUDrogoth_SKL.WUDrogoth_SPC1     Frames: 56
        AnimationSound = Sound: DrogothWingBlastWingFlaps    Animation:WUDrogoth_SKL.WUDrogoth_SPC2     Frames: 0
        AnimationSound = Sound: FellBeastWingFlapsShort        Animation:WUDrogoth_SKL.WUDrogoth_SPC3     Frames: 1
        AnimationSound = Sound: FellBeastWingFlaps            Animation:WUDrogoth_SKL.WUDrogoth_SPCA     Frames: 1 41
        AnimationSound = Sound: FellBeastWingFlaps            Animation:WUDrogoth_SKL.WUDrogoth_SPCB     Frames: 1 37 71 106
        AnimationSound = Sound: FellBeastWingFlaps            Animation:WUDrogoth_SKL.WUDrogoth_SPCF     Frames: 1
        AnimationSound = Sound: DrogothWingBlastWingFlaps    Animation:WUDrogoth_SKL.WUDrogoth_SPCF     Frames: 28
    End

    RadarPriority = UNIT
    KindOf = HERO PRELOAD SELECTABLE CAN_CAST_REFLECTIONS SCORE NO_FREEWILL_ENTER SCARY MONSTER CANNOT_RETALIATE ARMY_SUMMARY GIANT_BIRD

    Body = RespawnBody ModuleTag_02
        CheerRadius       = EMOTION_CHEER_RADIUS
        MaxHealth         = DORGOTH_FLYING_HERO_HEALTH 
        HealingBuffFx     = None
		DodgePercent        = HERO_DODGE_PERCENT
    End

    Behavior = RespawnUpdate ModuleTag_RespawnUpdate
        DeathAnim                     = DYING
        AutoRespawnAtObjectFilter     = NONE +CASTLE_KEEP
        ButtonImage                   = HIDrogoth
        RespawnAsTemplate             = Drogoth

        RespawnRules =    AutoSpawn:No           Cost:3800       Time:STRONG_HERO_RESPAWNTIME        Health:100%
    End

    Behavior = AutoHealBehavior ModuleTag_FellbeastHealing
        StartsActive            = Yes
        HealingAmount           = DROGOTH_HEAL_AMOUNT
        HealingDelay            = 1000
        StartHealingDelay       = 15000
        HealOnlyIfNotInCombat   = Yes
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = Hero
    End

     Behavior = GiantBirdAIUpdate ModuleTag_GiantBirdAI
        AutoAcquireEnemiesWhenIdle    = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate            = 500
        AILuaEventsList                = DrogothundSmaugFunctions
        FollowThroughDistance        = 200
        FollowThroughCheckStep        = 50
        FollowThroughGradient        = 1.0

        GrabTossTimeTrigger            = 2.5
        GrabTossHeightTrigger        = 100.0
        TossFX                        = FX_DiebyFalling
        SpecialContactPoints        = Swoop

        AttackPriority = AttackPriority_FellBeast
      End

    LocomotorSet
        Locomotor = FellBeastLocomotor
        Condition = SET_NORMAL
        Speed     = 95
    End
    LocomotorSet
        Locomotor = FellBeastLocomotor
        Condition = SET_SUPERSONIC
        Speed     = 150
    End
    LocomotorSet
        Locomotor = FellBeastLocomotor
        Condition = SET_WANDER
        Speed     = 78
    End
    LocomotorSet
        Locomotor = FellBeastSwoopLocomotor
        Condition = SET_PANIC
        Speed     = 160
    End

    Behavior = PhysicsBehavior ModuleTag_04
    End

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_FireballUnpause
        SpecialPowerTemplate  = SpecialAbilityDrogothFireball
        TriggeredBy           = Upgrade_Level_2
        ObeyRechageOnTrigger  = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_FireballStarter
        SpecialPowerTemplate      = SpecialAbilityDrogothFireball
        UpdateModuleStartsAttack  = Yes
        StartsPaused              = Yes
        InitiateSound             = DrogothVoxAttack
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_FireballUpdate
        SpecialPowerTemplate      = SpecialAbilityDrogothFireball
        WhichSpecialWeapon        = 1
        UnpackTime                = 1800
        PreparationTime           = 10
        PackTime                  = 950
        AwardXPForTriggering      = 0
        StartAbilityRange         = DROGOTH_FIREBALL_RANGE
        MustFinishAbility         = Yes
        SpecialWeapon             = DrogothFireball
    End


    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_WingBlastUnpause
        SpecialPowerTemplate  = SpecialAbilityWingBlast
        TriggeredBy           = Upgrade_Level_3
        ObeyRechageOnTrigger  = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_WingBlastStarter
        SpecialPowerTemplate       = SpecialAbilityWingBlast
        UpdateModuleStartsAttack   = Yes
        StartsPaused               = Yes
        InitiateSound              = DrogothVoxWingBlast
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_WingBlastUpdate
        SpecialPowerTemplate    = SpecialAbilityWingBlast
        UnpackTime              = 2000
        PreparationTime         = 1
        PackTime                = 1000
        PersistentPrepTime      = 900
        PersistentCount         = 20
        AwardXPForTriggering    = 0
        StartAbilityRange       = 1.0
        SpecialWeapon           = DrogothWingBlast
        WhichSpecialWeapon      = 3
    End

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_IncinerateUnpause
        SpecialPowerTemplate  = SpecialAbilityDrogothIncinerate
        TriggeredBy           = Upgrade_Level_10
        ObeyRechageOnTrigger  = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_IncinerateStarter
        SpecialPowerTemplate        = SpecialAbilityDrogothIncinerate
        UpdateModuleStartsAttack    = Yes
        StartsPaused                = Yes
        InitiateSound                = DrogothVoxAttack
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_IncinerateUpdate
        SpecialPowerTemplate    = SpecialAbilityDrogothIncinerate
        UnpackTime              = 1300
        PackTime                = 3700
        AwardXPForTriggering    = 0
        StartAbilityRange       = 40.0
        SpecialWeapon           = DrogothIncinerate
        WhichSpecialWeapon      = 2
    End

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_FireflightUnpause
        SpecialPowerTemplate  		= SpecialAbilityDrogothFireflight
        TriggeredBy           		= Upgrade_Level_10
        ObeyRechageOnTrigger  		= Yes
    End

    Behavior = SpecialPowerModule ModuleTag_FireflightStarter
        SpecialPowerTemplate        	= SpecialAbilityDrogothFireflight
        UpdateModuleStartsAttack    	= Yes
        StartsPaused                	= Yes
        InitiateSound               	= DrogothVoxAttack
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_FireflightUpdate
        SpecialPowerTemplate     	= SpecialAbilityDrogothFireflight
        CustomAnimAndDuration    	= AnimState:USER_1    AnimTime:2000
        SkipContinue             	= Yes
        UnpackTime               	= 1100
        PreparationTime          	= 1
        PackTime                 	= 900
        AwardXPForTriggering     	= 0
        StartAbilityRange        	= DROGOTH_FIREFLIGHT_RANGE
        MustFinishAbility        	= Yes
        SpecialWeapon            	= DrogothGorgorothSpireWeapon
        TriggerSound             	= DrogothFireflightMS
    End

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_CallFromTheDeepEnabler
        SpecialPowerTemplate      = SpecialAbilityCallFromTheDeep
        TriggeredBy               = Upgrade_Level_7
        ObeyRechageOnTrigger      = Yes
    End

    Behavior = OCLSpecialPower ModuleTag_CallFromTheDeepPower
        SpecialPowerTemplate      = SpecialAbilityCallFromTheDeep
        OCL                       = OCL_DrogothFireDrakeEgg
        CreateLocation            = CREATE_AT_LOCATION
        StartsPaused              = Yes
        TriggerFX                 = FX_DrakeSummon
    End



    Behavior = SpecialPowerModule ModuleTag_DismountStarter
         SpecialPowerTemplate        = SpecialAbilityToggleMountedFromFellBeast
         UpdateModuleStartsAttack    = Yes
         StartsPaused                = No
    End

    Behavior = ToggleMountedSpecialAbilityUpdate ModuleTag_Dismount
         SpecialPowerTemplate    = SpecialAbilityToggleMountedFromFellBeast
         StartAbilityRange       = 50.0
         MountedTemplate         = DrogothGround
         SynchronizeTimerOnSpecialPower = SpecialAbilityDrogothFireball SpecialAbilityWingBlast SpecialAbilityDrogothIncinerate SpecialAbilityDrogothFireflight SpecialAbilityCallFromTheDeep
         UnpackTime              = MORDOR_MOUNT_TIME
         PreparationTime         = 1
         PackTime                = 0
         OpacityTarget           = 1
         AwardXPForTriggering    = 0
         IgnoreFacingCheck       = Yes
    End


    Behavior = ModelConditionUpgrade ModuleTag_TurnWhite
        TriggeredBy          = Upgrade_Level_5
        AddConditionFlags    = USER_5
    End

    Behavior = ArmorUpgrade ModuleTag_ArmorUpgrade
        TriggeredBy        = Upgrade_Level_5
    End

    Behavior = SpecialPowerModule ModuleTag_FellbeastLevelAttack
        SpecialPowerTemplate      = SpecialAbilityLevelAttack
        UpdateModuleStartsAttack  = Yes
    End

    Behavior = FellBeastSwoopPower ModuleTag_FellBeastSwoopPower
        SpecialPowerTemplate        = SpecialAbilityLevelAttack
        UnpackTime                    = 1
        AwardXPForTriggering        = 0
        StartAbilityRange            = 1000.0
    End


    Behavior = GiantBirdSlowDeathBehavior ModuleTag_GiantBirdSlowDeath
        DeathTypes                   = ALL -FADED
        SinkDelay                    = 15000
        SinkRate                     = 1.0
        DestructionDelay             = 20000
        Sound                        = INITIAL DrogothVoxDie
        Weapon                       = HIT_GROUND FlyingUnitDeathWarhead
        FX                           = HIT_GROUND FX_TrebuchetImpactHit
        Sound                        = HIT_GROUND FellBeastDieImpact
        CrashAvoidKindOfs            = STRUCTURE
        CrashAvoidRadius             = CRASH_AVOID_RADIUS
        CrashAvoidStrength           = 0.3
        NeedToMaintainFlailingHeight = No
        DeathFlags                   = DEATH_1
    End

    Behavior = SquishCollide ModuleTag_06
    End

    Behavior = NotifyTargetsOfImminentProbableCrushingUpdate ModuleTag_NotifyCrushScan
    End


    Behavior = AutoAbilityBehavior ModuleTag_FireBallAutoAbility
        SpecialAbility    = SpecialAbilityDrogothFireball
        Query            = 1 ALL ENEMIES
    End

    Behavior = AutoAbilityBehavior ModuleTag_FireflightAutoAbility
        SpecialAbility    = SpecialAbilityDrogothFireflight
        Query            = 1 ANY ENEMIES +HERO
        Query            = 10 ANY ENEMIES +INFANTRY +CAVALRY
        Query            = 1 ALL ENEMIES
    End

    FormationPreviewDecal
            Texture = FPflyingUnitDecal
            Width   = 128
            Height  = 128
    End


    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
	CommandButtonName = Command_SetStanceBattle
	SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
	CommandButtonName = Command_SetStanceAggressive
	SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
	CommandButtonName = Command_SetStanceHoldGround
	SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Behavior = AISpecialPowerUpdate DrogothFireballAI
        CommandButtonName = Command_DrogothFireball
        SpecialPowerAIType = AI_SPECIAL_POWER_ENEMY_TYPE_KILLER_RANGED
    End

    Behavior = AISpecialPowerUpdate DrogothWingBlastAI
        CommandButtonName = Command_DrogothWingBlast
        SpecialPowerAIType = AI_SPELLBOOK_ARMY_BREAKER
        SpecialPowerRadius = 50
    End

    Behavior = AISpecialPowerUpdate DrogothFireflightAI
        CommandButtonName = Command_DrogothFireflight
        SpecialPowerAIType = AI_SPECIAL_POWER_RANGED_AOE_ATTACK
        SpecialPowerRadius = 100
    End

    Behavior = AISpecialPowerUpdate ToggleMountedAI
        CommandButtonName = Command_DrogothKriechen
        SpecialPowerAIType = AI_SPECIAL_POWER_TOGGLE_MOUNTED
    End

    Behavior = AISpecialPowerUpdate GoblinKingCallOfTheDeepAI
        CommandButtonName = Command_DrogothCallFromTheDeep
        SpecialPowerAIType = AI_SPECIAL_POWER_GOBLINKING_CALLOFTHEDEEP
        SpecialPowerRadius = 100
    End

    Behavior = AISpecialPowerUpdate DrogothIncinerateAI
	 CommandButtonName = Command_DrogothIncinerate
	 SpecialPowerAIType = AI_SPECIAL_POWER_RANGED_AOE_ATTACK
	 SpecialPowerRadius = 100
    End

    Scale                 = 1.07
    Geometry              = CYLINDER
    GeometryMinorRadius   = 39.0
    GeometryMajorRadius   = 39.0
    GeometryHeight        = 40.0
    GeometryOffset        = X:0 Y:0 Z:-10
    GeometryIsSmall       = No
    Shadow                = SHADOW_VOLUME_NON_SELF_3
    ShadowSunAngle        = 89
End


Object DrogothGround

    SelectPortrait = HPDrogoth
    ButtonImage    = HIDrogoth

     EquivalentTo = Drogoth

    Draw = W3DScriptedModelDraw ModuleTag_01
        StaticModelLODMode = No

        DefaultModelConditionState
            Model = WUDrogoth_SKN
            Skeleton = WUDrogoth_SKL
            ParticleSysBone = B_MAINBONE SummonedDragonWaves    FollowBone:Yes
            ParticleSysBone = B_MAINBONE SummonedDragonSmokeWaves FollowBone:Yes
        End
	ModelConditionState     = USER_5
            Model           = wudrogbtp_skn
            Skeleton 	    = WUDrogoth_SKL
            ParticleSysBone = B_MAINBONE SummonedDragonWaves    FollowBone:Yes
            ParticleSysBone = B_MAINBONE SummonedDragonSmokeWaves FollowBone:Yes
        End

        IdleAnimationState
            StateName = STATE_Idle
            Animation = Breathe
                AnimationName = WUDrgrd_IDLA
                AnimationMode = ONCE
                AnimationPriority = 5
            End
            ParticleSysBone = BAT_HEAD SummonedDragonFireSnort    FollowBone:Yes
            ParticleSysBone = BAT_HEAD SummonedDragonSnortEmbers    FollowBone:Yes
            ParticleSysBone = B_MAINBONE SummonedDragonWaves    FollowBone:Yes
            ParticleSysBone = B_MAINBONE SummonedDragonSmokeWaves FollowBone:Yes

            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Selected"    then
                CurDrawableSetTransitionAnimState("TRANS_Selected_to_Idle") return end
            EndScript
        End

        AnimationState            = USER_2
            StateName = State_JustBuilt
            Animation
                AnimationName = WUDrgrd_LNDA
                AnimationMode = ONCE
                AnimationBlendTime = 0
                AnimationSpeedFactorRange    =    0.5 0.5
            End
            ParticleSysBone = NONE SummonedDragonDust    FollowBone:Yes
        End

        AnimationState                    =    DYING DEATH_1
            Animation                    =    Dying
                AnimationName            =    WUDrgrd_DIEA
                AnimationMode            =    ONCE
                AnimationBlendTime        =    15
            End
            ParticleSysBone = BAT_HEAD SummonedDragonDeathEmbers        FollowBone:Yes
            ParticleSysBone = BAT_HEAD SummonedDragonDeathSmoke            FollowBone:Yes
            ParticleSysBone = NONE SummonedDragonDeathDust        FollowBone:Yes

        End

        AnimationState                    =    DYING DEATH_2
            Animation                    =    JumpingAwayAtTimeUp
                AnimationName            =    WUDrgrd_JMPB
                AnimationMode            =    ONCE
                AnimationBlendTime        =    15
            End
            ParticleSysBone = BAT_HEAD SummonedDragonDeathEmbers        FollowBone:Yes
            ParticleSysBone = BAT_HEAD SummonedDragonDeathSmoke            FollowBone:Yes
        End

        AnimationState = FIRING_OR_PREATTACK_A MOVING
            Animation
                AnimationName                = WUDrgrd_WLKA
                AnimationMode                = LOOP
                AnimationSpeedFactorRange    = 1.3 1.3
            End
            ParticleSysBone = B_MAINBONE SummonedDragonWaves    FollowBone:Yes
            ParticleSysBone = B_MAINBONE SummonedDragonSmokeWaves FollowBone:Yes
        End

        AnimationState = FIRING_OR_PREATTACK_A
            Animation            = Burninate
                AnimationName    = WUDrgrd_ATKA
                AnimationMode    = ONCE
            End
            ParticleSysBone = BAT_HEAD SummonedDragonFireBreath2    FollowBone:Yes
            ParticleSysBone = BAT_HEAD SummonedDragonHeat    FollowBone:Yes
            ParticleSysBone = BAT_HEAD SummonedDragonEmbers        FollowBone:Yes
            ParticleSysBone = BAT_HEAD SummonedDragonSmoke            FollowBone:Yes
            ParticleSysBone = BAT_HEAD SummonedDragonFireProxy2            FollowBone:Yes
            ParticleSysBone = B_MAINBONE SummonedDragonWaves    FollowBone:Yes
            ParticleSysBone = B_MAINBONE SummonedDragonSmokeWaves FollowBone:Yes
        End

        AnimationState = HIT_REACTION HIT_LEVEL_1
            Animation
                AnimationName    = WUDrgrd_HITA
                AnimationMode    = ONCE
            End
        End

        AnimationState = MOVING TURN_RIGHT_HIGH_SPEED
            Animation
                AnimationName    = WUDrgrd_WLKA
                AnimationMode    = LOOP
                AnimationSpeedFactorRange = 1.8 1.8
                AnimationBlendTime        =    15
            End
        End

        AnimationState = MOVING TURN_LEFT_HIGH_SPEED
            Animation
                AnimationName    = WUDrgrd_WLKA
                AnimationMode    = LOOP
                AnimationSpeedFactorRange = 1.8 1.8
                AnimationBlendTime        =    15
            End
        End

        AnimationState = TURN_LEFT
            Animation            = Left
                AnimationName    = WUDrgrd_TRNL
                AnimationMode    = LOOP
                AnimationSpeedFactorRange = 0.85 0.85
                AnimationBlendTime        =    15
            End
        End

        AnimationState = TURN_RIGHT
            Animation            = YourOtherLeft
                AnimationName    = WUDrgrd_TRNR
                AnimationMode    = LOOP
                AnimationSpeedFactorRange = 0.85 0.85
                AnimationBlendTime        =    15
            End
        End

        AnimationState = MOVING ACCELERATE
            Animation
                AnimationName    = WUDrgrd_ACCL
                AnimationMode    = ONCE
                AnimationSpeedFactorRange = 2.0 2.0
                AnimationBlendTime        =    15
            End
        End

        AnimationState = MOVING DECELERATE
            Animation
                AnimationName    = WUDrgrd_DECL
                AnimationMode    = ONCE
                AnimationSpeedFactorRange = 0.9 0.9
            End

        End

        AnimationState = UNPACKING
            StateName            = STATE_TakeOff
            Animation
                AnimationName    = WUDrgrd_JMPA
                AnimationMode    = ONCE
            End
            ParticleSysBone = NONE SummonedDragonDust    FollowBone:Yes
        End

        AnimationState = PREPARING
            Animation
                AnimationName        = WUDrgrd_JMPA
                AnimationMode        = ONCE
            End
            Flags = START_FRAME_LAST
        End


        AnimationState = PACKING
            StateName                = STATE_Land
            Animation
                AnimationName        = WUDrgrd_LNDA
                AnimationMode        = ONCE
                AnimationBlendTime    = 0
                AnimationSpeedFactorRange = 0.5 0.5
            End
            ParticleSysBone = NONE SummonedDragonDust    FollowBone:Yes
        End

        AnimationState = MOVING
            Animation
                AnimationName    = WUDrgrd_WLKA
                AnimationMode    = LOOP
                AnimationSpeedFactorRange = 1.4 1.4
            End
        End

        AnimationState = SELECTED
            Animation
                AnimationName    = WUDrgrd_IDLA
                AnimationMode    = LOOP
                AnimationSpeedFactorRange = 1.3 1.3
            End

            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Idle"    then
                    CurDrawableSetTransitionAnimState("TRANS_Idle_to_Selected")
                    return
                end
            EndScript
        End

        AnimationState = USER_1
            Animation
                AnimationName    = WUDrgrd_RORA
                AnimationMode    = ONCE
            End
            ParticleSysBone = BAT_HEAD SummonedDragonFireRoar    FollowBone:Yes
            ParticleSysBone = BAT_HEAD SummonedDragonSmokeRoar    FollowBone:Yes
            ParticleSysBone = B_MAINBONE SummonedDragonWaves    FollowBone:Yes
            ParticleSysBone = B_MAINBONE SummonedDragonSmokeWaves FollowBone:Yes
        End

        AnimationState = SPECIAL_WEAPON_ONE
            Animation            = Salute
                AnimationName    = WUDrgrd_RORA
                AnimationMode    = ONCE
            End
            ParticleSysBone = BAT_HEAD SummonedDragonFireRoar    FollowBone:Yes
            ParticleSysBone = BAT_HEAD SummonedDragonSmokeRoar    FollowBone:Yes
            ParticleSysBone = B_MAINBONE SummonedDragonWaves    FollowBone:Yes
            ParticleSysBone = B_MAINBONE SummonedDragonSmokeWaves FollowBone:Yes
        End

        TransitionState = TRANS_Idle_to_Selected
            Animation            = Salute
                AnimationName    = WUDrgrd_RORA
                AnimationMode    = ONCE
            End
            ParticleSysBone = BAT_HEAD SummonedDragonFireRoar    FollowBone:Yes
            ParticleSysBone = BAT_HEAD SummonedDragonSmokeRoar    FollowBone:Yes
            ParticleSysBone = B_MAINBONE SummonedDragonWaves    FollowBone:Yes
            ParticleSysBone = B_MAINBONE SummonedDragonSmokeWaves FollowBone:Yes
        End

        TransitionState = TRANS_Selected_to_Idle
            Animation            = ATNC
                AnimationName    = WUDrgrd_IDLA
                AnimationMode    = ONCE
            End
        End

        TransitionState = TRANS_JustBuilt_To_Idle
            Animation = BeingSummoned
                AnimationName = WUDrgrd_LNDA
                AnimationMode = ONCE
            End
        End

    End

    Side                  = Wild
    EditorSorting         = UNIT
    CommandSet            = DrogothGroundCommandSet
    CommandPoints         = 0
    BuildCost             = 3800
    BuildTime             = STRONG_HERO_BUILDTIME
    MaxSimultaneousOfType = 1
    ShockwaveResistance   = SHOCKWAVE_RESISTANCE_ALWAYS
    ShroudClearingRange   = SHROUD_CLEAR_GIANT
    VisionRange           = 200
    TransportSlotCount    = TRANSPORTSLOTCOUNT_MONSTER
    KindOf                = HERO PRELOAD SELECTABLE CAN_CAST_REFLECTIONS SCORE NO_FREEWILL_ENTER SCARY MONSTER CANNOT_RETALIATE ARMY_SUMMARY CAN_ATTACK
    ThreatLevel           = SUMMONEDDRAGON_THREAT_LEVEL
    RadarPriority         = UNIT
    DisplayName           = OBJECT:Drogothnew
    RecruitText           = CONTROLBAR:WildDrogothnewRecruit
    ReviveText            = CONTROLBAR:WildDrogothnewRevive
    Hotkey                = CONTROLBAR:WildDrogothnewHotkey
    DisplayMeleeDamage    = MEDIUM_HERO_DAMAGE

    WeaponSet
        Conditions = None
        Weapon     = PRIMARY   DrogothGroundFireBreath
    End



    AutoResolveUnitType = AutoResolveUnit_Hero
    AutoResolveCombatChain = AutoResolve_HeroCombatChain

    AutoResolveBody = AutoResolve_DrogothBody

    AutoResolveArmor
        Armor = AutoResolve_DrogothArmor
    End

    AutoResolveWeapon
        Weapon = AutoResolve_DrogothWeapon
    End







    VoiceAttack                            = DrogothVoxAttack
    VoiceAttackCharge                    = DrogothVoxAttackCharge
    VoiceFear                            = EVA:DrogothHelpMe
    VoiceGuard                            = DrogothVoxMoveMS
    VoiceMove                            = DrogothVoxMoveMS
    VoicePriority                        = 90
    VoiceSelect                            = DrogothVoxSelect

    VoiceEnterStateAttack                = DrogothVoxEnterStateAttack
    VoiceEnterStateAttackCharge            = DrogothVoxEnterStateAttackCharge
    VoiceEnterStateAttackStructure        = DrogothVoxEnterStateAttackBuilding

    SoundAmbient                        = DrogothVoxAmbientLoop
    SoundImpact                            = ImpactHorse
    SoundMoveStart                        = FellBeastMoveStart

    #include "..\..\..\includes\StandardUnitEvaEvents.inc"

    ClientBehavior = ModelConditionAudioLoopClientBehavior ModuleTag_foo
        ModelCondition = Required:FIRING_OR_PREATTACK_A        Excluded:DYING    Sound:DragonAllyFirebreathMS
    End

    EvaEventDieOwner        = DrogothDie

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound: DragonAllyFootstep        Animation:SumnDrag_SKL.SumnDrag_WLKA     Frames: 19 40
        AnimationSound = Sound: BalrogLand                Animation:SumnDrag_SKL.SumnDrag_LNDA     Frames: 27
        AnimationSound = Sound: FellBeastWingFlaps        Animation:SumnDrag_SKL.SumnDrag_LNDA     Frames: 27
        AnimationSound = Sound: FellBeastWingFlaps        Animation:SumnDrag_SKL.SumnDrag_JMPA     Frames: 24 51 83
        AnimationSound = Sound: DragonAllyFootstep        Animation:SumnDrag_SKL.SumnDrag_JMPA     Frames: 10
        AnimationSound = Sound: DragonAllyVoxRoar        Animation:SumnDrag_SKL.SumnDrag_JMPA     Frames: 28
        AnimationSound = Sound: DragonAllyVoxHurt        Animation:SumnDrag_SKL.SumnDrag_HITA     Frames: 14
        AnimationSound = Sound: DragonAllyFootstep        Animation:SumnDrag_SKL.SumnDrag_TRNL     Frames: 11 22 33 44
        AnimationSound = Sound: DragonAllyFootstep        Animation:SumnDrag_SKL.SumnDrag_TRNR     Frames: 11 22 33 44
        AnimationSound = Sound: DragonAllyFootstep        Animation:SumnDrag_SKL.SumnDrag_ACCL     Frames: 18 23
        AnimationSound = Sound: DragonAllyFootstep        Animation:SumnDrag_SKL.SumnDrag_DECL     Frames: 17 25
        AnimationSound = Sound: DragonAllyFootstep        Animation:SumnDrag_SKL.SumnDrag_JMPA     Frames: 11 21
        AnimationSound = Sound: FellBeastWingFlaps        Animation:SumnDrag_SKL.SumnDrag_JMPA     Frames: 19 55 85
        AnimationSound = Sound: DragonAllyVoxRoar        Animation:SumnDrag_SKL.SumnDrag_JMPA     Frames: 31
        AnimationSound = Sound: FellBeastWingFlaps        Animation:SumnDrag_SKL.SumnDrag_LNDA     Frames: 1
        AnimationSound = Sound: BalrogLand                Animation:SumnDrag_SKL.SumnDrag_LNDA     Frames: 26
        AnimationSound = Sound: DragonAllyVoxRoarBig    Animation:SumnDrag_SKL.SumnDrag_RORA     Frames: 14
    End

    EvaEnemyObjectSightedEvent = DiscoveredEnemyDragon

    ClientUpdate = EvaAnnounceClientCreate ModuleTag_CreateAnnounce
        AnnouncementEventEnemy = DiscoveredEnemyDragon
        AnnouncementEventAlly = None
        AnnouncementEventOwner = None

        OnlyIfVisible = Yes
        CountAsFirstSightedAnnoucement = Yes
        UseObjectsPosition = No
        CreateFakeRadarEvent = Yes
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = Hero
    End

      Behavior = HitReactionBehavior HitReactionBehaviorModuleTag
        HitReactionLifeTimer1 = 2000
        HitReactionThreshold1 = 200
    End

    ArmorSet
        Conditions      = None
        Armor           = MediumHeroArmor
        DamageFX        = FellBeastDamageFX
    End

    ArmorSet
        Conditions      = PLAYER_UPGRADE
        Armor           = StrongHeroArmor
        DamageFX        = FellBeastDamageFX
    End

    Body = RespawnBody ModuleTag_02
        CheerRadius       = EMOTION_CHEER_RADIUS
        MaxHealth         = STRONG_FLYING_HERO_HEALTH
        HealingBuffFx     = None
		DodgePercent        = HERO_DODGE_PERCENT
    End

    Behavior = RespawnUpdate ModuleTag_RespawnUpdate
        DeathAnim                     = DYING
        AutoRespawnAtObjectFilter     = NONE +CASTLE_KEEP
        ButtonImage                   = HIDrogoth
        RespawnAsTemplate             = Drogoth

        RespawnRules =    AutoSpawn:No           Cost:3800       Time:STRONG_HERO_RESPAWNTIME        Health:100%
   End

    Behavior = SlowDeathBehavior ModuleTag_NormalDeath
        DeathTypes           = ALL -FADED
        DestructionDelay     = 20000
        DecayBeginTime       = 3000
        SinkDelay            = 5000
        SinkRate             = 2.0
        DeathFlags           = DEATH_1
        Sound                = INITIAL DrogothVoxDie
    End

    Behavior = AutoHealBehavior ModuleTag_FellbeastHealing
        StartsActive            = Yes
        HealingAmount            = DROGOTH_HEAL_AMOUNT
        HealingDelay            = 1000
        StartHealingDelay        = 15000
        HealOnlyIfNotInCombat    = Yes
    End


    Behavior = AIUpdateInterface ModuleTag_AI
        AutoAcquireEnemiesWhenIdle = Yes ATTACK_BUILDINGS
        AILuaEventsList            = DrogothundSmaugFunctions
    End

    Behavior = PhysicsBehavior ModuleTag_PhysicsBehavior
        GravityMult = 1.0
    End




    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_FireballUnpause
        SpecialPowerTemplate  = SpecialAbilityDrogothFireball
        TriggeredBy           = Upgrade_Level_3
        ObeyRechageOnTrigger  = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_FireballStarter
        SpecialPowerTemplate      = SpecialAbilityDrogothFireball
        UpdateModuleStartsAttack  = Yes
        StartsPaused              = Yes
        InitiateSound             = DrogothVoxAttack
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_FireballUpdate
        SpecialPowerTemplate    = SpecialAbilityDrogothFireball
        WhichSpecialWeapon        = 1
        UnpackTime                 = 1800
        PreparationTime            = 10
        PackTime                = 950
        AwardXPForTriggering    = 0
        StartAbilityRange        = DROGOTH_FIREBALL_RANGE
        MustFinishAbility        = Yes
        SpecialWeapon            = DrogothFireball
    End


    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_WingBlastUnpause
        SpecialPowerTemplate  = SpecialAbilityWingBlast
        TriggeredBy           = Upgrade_Level_3
        ObeyRechageOnTrigger  = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_WingBlastStarter
        SpecialPowerTemplate        = SpecialAbilityWingBlast
        UpdateModuleStartsAttack    = Yes
        StartsPaused            = Yes
        InitiateSound            = DrogothVoxWingBlast
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_WingBlastUpdate
        SpecialPowerTemplate    = SpecialAbilityWingBlast
        UnpackTime              = 2000
        PreparationTime            = 1
        PackTime                = 1000
        PersistentPrepTime        = 900
        PersistentCount            = 20
        AwardXPForTriggering    = 0
        StartAbilityRange        = 1.0

        SpecialWeapon            = DrogothWingBlast
        WhichSpecialWeapon        = 3

    End


    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_IncinerateUnpause
        SpecialPowerTemplate  = SpecialAbilityDrogothIncinerate
        TriggeredBy           = Upgrade_Level_10
        ObeyRechageOnTrigger  = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_IncinerateStarter
        SpecialPowerTemplate        = SpecialAbilityDrogothIncinerate
        UpdateModuleStartsAttack    = Yes
        StartsPaused                = Yes
        InitiateSound                = DrogothVoxAttack
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_IncinerateUpdate
        SpecialPowerTemplate    = SpecialAbilityDrogothIncinerate
        UnpackTime              = 1300
        PackTime                = 3700
        AwardXPForTriggering    = 0
        StartAbilityRange       = 40.0
        SpecialWeapon           = DrogothIncinerate
        WhichSpecialWeapon      = 2
    End


    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_FireflightUnpause
        SpecialPowerTemplate  = SpecialAbilityDrogothFireflight
        TriggeredBy           = Upgrade_Level_10
        ObeyRechageOnTrigger  = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_FireflightStarter
        SpecialPowerTemplate        = SpecialAbilityDrogothFireflight
        UpdateModuleStartsAttack    = Yes
        StartsPaused                = Yes
        InitiateSound                = DrogothVoxAttack
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_FireflightUpdate
        SpecialPowerTemplate    = SpecialAbilityDrogothFireflight
        CustomAnimAndDuration    = AnimState:USER_1    AnimTime:2000
        SkipContinue            = Yes

        UnpackTime                 = 1100
        PreparationTime            = 1
        PackTime                = 900

        AwardXPForTriggering    = 0

        StartAbilityRange        = DROGOTH_FIREFLIGHT_RANGE
        MustFinishAbility        = Yes
        SpecialWeapon            = DrogothFireflight
        TriggerSound            = DrogothFireflightMS
    End


    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_CallFromTheDeepEnabler
        SpecialPowerTemplate      = SpecialAbilityCallFromTheDeep
        TriggeredBy               = Upgrade_Level_7
        ObeyRechageOnTrigger      = Yes
    End

    Behavior = OCLSpecialPower ModuleTag_CallFromTheDeepPower
        SpecialPowerTemplate      = SpecialAbilityCallFromTheDeep
        OCL                       = OCL_DrogothFireDrakeEgg
        CreateLocation            = CREATE_AT_LOCATION
        StartsPaused              = Yes
        TriggerFX                 = FX_DrakeSummon
    End


     Behavior = SpecialPowerModule ModuleTag_HorseToggleStarter
         SpecialPowerTemplate        = SpecialAbilityToggleMounted
         UpdateModuleStartsAttack    = Yes
         StartsPaused                = No
     End

    Behavior = ToggleMountedSpecialAbilityUpdate ModuleTag_HorseToggle
         SpecialPowerTemplate     	= SpecialAbilityToggleMounted
         MountedTemplate            	= Drogoth
         SynchronizeTimerOnSpecialPower = SpecialAbilityDrogothFireball SpecialAbilityWingBlast SpecialAbilityDrogothFireflight SpecialAbilityWingBlast SpecialAbilityCallFromTheDeep
         UnpackTime              	= MORDOR_MOUNT_TIME
         PreparationTime         	= 0
         PackTime                	= 0
         OpacityTarget            	= .0
         AwardXPForTriggering    	= 0
         IgnoreFacingCheck        	= Yes
    End

    Behavior = ModelConditionUpgrade ModuleTag_TurnWhite
        TriggeredBy          = Upgrade_Level_5
        AddConditionFlags    = USER_5
    End

    Behavior = ArmorUpgrade ModuleTag_ArmorUpgrade
        TriggeredBy        = Upgrade_Level_5
    End

    Behavior = GrantUpgradeCreate ModuleTag_BuildHackUpgrade
           UpgradeToGrant                = Upgrade_TestBuilding
           GiveOnBuildComplete           = Yes
     End

    Behavior = ModelConditionUpgrade ModuleTag_BuildHackUserFlag
           TriggeredBy                   = Upgrade_TestBuilding
           RequiresAllTriggers           = Yes
           AddTempConditionFlag          = ModelConditionState:USER_2
           TempConditionTime             = 4.0
     End


    LocomotorSet
        Locomotor     = SummonedDragonLocomotor
        Condition     = SET_NORMAL
        Speed         = 60
    End





    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
	CommandButtonName = Command_SetStanceBattle
	SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
	CommandButtonName = Command_SetStanceAggressive
	SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
	CommandButtonName = Command_SetStanceHoldGround
	SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Behavior = AISpecialPowerUpdate DrogothFireflightAI
        CommandButtonName = Command_DrogothFireflight
        SpecialPowerAIType = AI_SPECIAL_POWER_RANGED_AOE_ATTACK
        SpecialPowerRadius = 100
    End

    Behavior = AISpecialPowerUpdate GoblinKingCallOfTheDeepAI
        CommandButtonName = Command_DrogothCallFromTheDeep
        SpecialPowerAIType = AI_SPECIAL_POWER_GOBLINKING_CALLOFTHEDEEP
        SpecialPowerRadius = 100
    End

    Behavior = AISpecialPowerUpdate ToggleMountedAI
        CommandButtonName = Command_DrogothFliegen
        SpecialPowerAIType = AI_SPECIAL_POWER_TOGGLE_MOUNTED
    End

    Scale = 1.12
    Geometry            = CYLINDER
    GeometryMajorRadius = 50
    GeometryHeight        = 25.0
    GeometryOffset        = X:-10 Y:0 Z:0
    GeometryIsSmall        = No
    Shadow                = SHADOW_VOLUME
End



Object SmallPatrolDragon_Slaved

    ButtonImage    = HIDrogoth
    SelectPortrait = HPDrogoth_Portrait

    DescriptionStrategic = CONTROLBAR:LW_ToolTip_Drogoth

    ShockwaveResistance = SHOCKWAVE_RESISTANCE_ALWAYS

    Draw = W3DScriptedModelDraw ModuleTag_01

        OkToChangeModelColor = Yes

        StaticModelLODMode = Yes

        DefaultModelConditionState
            Model                = WUDrogoth_SKN
            WeaponLaunchBone    = PRIMARY BAT_JAW
            WeaponLaunchBone    = SECONDARY BAT_TAIL08
        End

        IdleAnimationState
            StateName = Idle
            Animation = IDLA
                AnimationName = WUDrogoth_SKL.WUDrogoth_FLYA
                AnimationMode = LOOP

                AnimationSpeedFactorRange = 0.95 1.05
            End
            BeginScript
                 Prev = CurDrawablePrevAnimationState()
                 if Prev == "STATE_WingBlastLoop" then
                     CurDrawableSetTransitionAnimState("TRANS_WingBlastStop") end
             EndScript
        End

          AnimationState = DYING
               StateName = DYING
            Animation = DyingA
                AnimationName = WUDrogoth_SKL.WUDrogoth_DIEK
                  AnimationMode = ONCE

              End
        End

         AnimationState    = BACKING_UP
               StateName = backup
               Animation = IDLA
                   AnimationName = WUDrogoth_SKL.WUDrogoth_FLYA
                   AnimationMode = LOOP

                AnimationSpeedFactorRange = 0.95 1.05
               End
           End

           AnimationState = DIVING
               StateName = Diving
               Animation = Diving
                   AnimationName = WUDrogoth_SKL.WUDrogoth_FLYA
                   AnimationMode = LOOP

                 AnimationSpeedFactorRange = 0.95 1.05
              End
           End

        AnimationState = ABOUT_TO_HIT
            StateName = Claw
            Animation = Claw
                AnimationName = WUDrogoth_SKL.WUDrogoth_ATKA
                AnimationMode = LOOP

            End
        End

        AnimationState            = SPECIAL_WEAPON_ONE
            Animation
                AnimationName    = WUDrogoth_SKL.WUDrogoth_SPCA
                AnimationMode   = LOOP
            End
        End

        AnimationState            = SPECIAL_WEAPON_TWO
            Animation
                AnimationName    = WUDrogoth_SKL.WUDrogoth_SPCB
                AnimationMode   = LOOP
            End

            ParticleSysBone = BAT_HEAD DrogothFireBreath FollowBone:Yes
            ParticleSysBone = BAT_JAW balrogBreathEmbers FollowBone:Yes
            ParticleSysBone = BAT_JAW balrogBreathSmoke FollowBone:Yes
            ParticleSysBone = BAT_HEAD DrogothBreathProxy FollowBone:Yes
        End


        AnimationState            = SPECIAL_WEAPON_THREE
            StateName            = STATE_WingBlastLoop
            Animation
                AnimationName                = WUDrogoth_SKL.WUDrogoth_SPC2
                AnimationMode                = LOOP
                AnimationSpeedFactorRange    = 0.9 0.9
            End
            FXEvent    = Frame:6 Name:FX_WindBlast
              BeginScript
                 Prev = CurDrawablePrevAnimationState()
                 if Prev ~= "TRANS_WingBlastStart" and Prev ~= "STATE_WingBlastLoop" then
                     CurDrawableSetTransitionAnimState("TRANS_WingBlastStart") end
             EndScript
        End

           TransitionState = TRANS_WingBlastStart
               Animation
                   AnimationName = WUDrogoth_SKL.WUDrogoth_SPC1
                   AnimationMode = ONCE
               End
           End

           TransitionState = TRANS_WingBlastStop
               Animation
                   AnimationName = WUDrogoth_SKL.WUDrogoth_SPC3
                   AnimationMode = ONCE
               End
           End


        AnimationState            = USER_1
            Animation
                AnimationName    = WUDrogoth_SKL.WUDrogoth_SPCF
                AnimationMode    = ONCE
            End
        End

        AnimationState = CLIMBING
            StateName = Climbing
            Animation = Moving
                AnimationName = WUDrogoth_SKL.WUDrogoth_FLYA
                AnimationMode = LOOP

                AnimationSpeedFactorRange = 0.95 1.05
            End
        End
        AnimationState = FREEFALL
            StateName = Freefall
            Animation = Moving
                AnimationName = WUDrogoth_SKL.WUDrogoth_FLYA
                AnimationMode = LOOP

            End
        End

        AnimationState = MOVING
            StateName = Moving
            Animation = Moving
                AnimationName = WUDrogoth_SKL.WUDrogoth_FLYB
                AnimationMode = LOOP

                AnimationSpeedFactorRange = 0.9 1.1
            End
              BeginScript
                 Prev = CurDrawablePrevAnimationState()
                 if Prev == "Idle"    then CurDrawableSetTransitionAnimState("Trans_Begin_Moving") return end
                 if Prev == "Climbing"    then CurDrawableSetTransitionAnimState("Trans_Begin_Moving") return end
                 if Prev == "STATE_WingBlastLoop" then
                     CurDrawableSetTransitionAnimState("TRANS_WingBlastStop") end
             EndScript
         End

           TransitionState = Trans_Begin_Moving
               Animation = Transition
                   AnimationName = WUDrogoth_SKL.WUDrogoth_FLYC
                   AnimationMode = ONCE
                   AnimationBlendTime = 6
               End
           End

           AnimationState = LEVELED
            Animation
                AnimationName = WUDrogoth_SKL.WUDrogoth_LVLA
                AnimationMode = LOOP
            End
        End
    End

    Side                = Wild
	EditorSorting		= UNIT
	ThreatLevel		= FELL_BEAST_THREAT_LEVEL
	ThingClass		= LARGE_MONSTER
	TransportSlotCount	= TRANSPORTSLOTCOUNT_NOT_TRANSPORTABLE
  
	ShockwaveResistance = SHOCKWAVE_RESISTANCE_ALWAYS

  WeaponSet
	Conditions	= None
	Weapon          = PRIMARY	ThorondorGrabAttack
	PreferredAgainst= PRIMARY	INFANTRY THROWN_OBJECT CAVALRY
	Weapon		= SECONDARY	NazgulPlowAttack
	OnlyAgainst	= SECONDARY	STRUCTURE MACHINE HORDE SHIP CAN_RIDE_SIEGE_LADDER
	Weapon		= TERTIARY	NazgulClawAttack
	PreferredAgainst = TERTIARY	HERO MONSTER
 End

         ArmorSet
		Conditions      = None
        Armor            = DrogothArmor
        DamageFX         = FellBeastDamageFX
	End

	VisionRange = VISION_FLIER
	ShroudClearingRange = SHROUD_CLEAR_FLIER

	BountyValue = GONDOR_GWAIHIR_BOUNTY_VALUE

    DisplayName          = OBJECT:SmallPatrolDragon_Slaved
    DisplayNameStrategic = OBJECT:DescriptionSmallPatrolDragon_Slaved

	CrusherLevel	= 3
	RamPower 	= 45
	RamZMult 	= 0.5
	CommandSet 	= emptyCommandSet
	CommandPoints = 0
	
	EvaEnemyObjectSightedEvent = None 

	SoundCreated = DrogothVoxAttack

    VoiceAttack                            = DrogothVoxAttack
    VoiceAttackCharge                      = DrogothVoxAttackCharge
    VoiceCreated                           = EVA:DrogothCreated
    VoiceFullyCreated                      = EVA:DrogothCreated
    VoiceFear                              = EVA:DrogothHelpMe
    VoiceGuard                             = DrogothVoxMoveMS
    VoiceMove                              = DrogothVoxMoveMS
    VoicePriority                          = 90
    VoiceSelect                            = DrogothVoxSelect

    VoiceEnterStateAttack                  = DrogothVoxEnterStateAttack
    VoiceEnterStateAttackCharge            = DrogothVoxEnterStateAttackCharge
    VoiceEnterStateAttackStructure         = DrogothVoxEnterStateAttackBuilding

    SoundAmbient                           = DrogothVoxAmbientLoop
    SoundImpact                            = ImpactHorse
    SoundMoveStart                         = FellBeastMoveStart

    #include "..\..\..\includes\StandardUnitEvaEvents.inc"
    EvaEventDieOwner        = DrogothDie

    ClientBehavior = ModelConditionAudioLoopClientBehavior ModuleTag_foo
        ModelCondition = Required:SPECIAL_WEAPON_TWO    Excluded:DYING Sound:DrogothIncinerateMS
        ModelCondition = Required:SPECIAL_WEAPON_THREE    Excluded:DYING Sound:DrogothWingBlastLoop
    End

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound: FellBeastWingFlaps            Animation:WUDrogoth_SKL.WUDrogoth_FLYA     Frames: 1
        AnimationSound = Sound: FellBeastWingFlaps            Animation:WUDrogoth_SKL.WUDrogoth_FLYB     Frames: 1
        AnimationSound = Sound: FellBeastWingFlaps            Animation:WUDrogoth_SKL.WUDrogoth_FLYC     Frames: 1 43 91
        AnimationSound = Sound: FellBeastWingFlapsShort        Animation:WUDrogoth_SKL.WUDrogoth_HITA     Frames: 11
        AnimationSound = Sound: FellBeastWingFlaps            Animation:WUDrogoth_SKL.WUDrogoth_LVLA     Frames: 1 42
        AnimationSound = Sound: DrogothVoxVeterancy            Animation:WUDrogoth_SKL.WUDrogoth_LVLA     Frames: 15
        AnimationSound = Sound: FellBeastWingFlapsShort        Animation:WUDrogoth_SKL.WUDrogoth_SPC1     Frames: 1 22
        AnimationSound = Sound: DrogothWingBlastWingFlaps    Animation:WUDrogoth_SKL.WUDrogoth_SPC1     Frames: 56
        AnimationSound = Sound: DrogothWingBlastWingFlaps    Animation:WUDrogoth_SKL.WUDrogoth_SPC2     Frames: 0
        AnimationSound = Sound: FellBeastWingFlapsShort        Animation:WUDrogoth_SKL.WUDrogoth_SPC3     Frames: 1
        AnimationSound = Sound: FellBeastWingFlaps            Animation:WUDrogoth_SKL.WUDrogoth_SPCA     Frames: 1 41
        AnimationSound = Sound: FellBeastWingFlaps            Animation:WUDrogoth_SKL.WUDrogoth_SPCB     Frames: 1 37 71 106
        AnimationSound = Sound: FellBeastWingFlaps            Animation:WUDrogoth_SKL.WUDrogoth_SPCF     Frames: 1
        AnimationSound = Sound: DrogothWingBlastWingFlaps    Animation:WUDrogoth_SKL.WUDrogoth_SPCF     Frames: 28
    End


	RadarPriority	= UNIT
	KindOf	= PRELOAD SELECTABLE CAN_CAST_REFLECTIONS SCORE NO_FREEWILL_ENTER MONSTER SCARY CAN_ATTACK
	
	Body = ActiveBody ModuleTag_02
		CheerRadius 	= EMOTION_CHEER_RADIUS
		MaxHealth       = MEDIUM_FLYING_HERO_HEALTH
		HealingBuffFx	= None
		DodgePercent        = HERO_DODGE_PERCENT
	End

    Behavior = AutoHealBehavior ModuleTag_FellbeastHealing
        StartsActive                   = Yes
        HealingAmount                  = 25
        HealingDelay                   = 1000
        StartHealingDelay              = 15000
        HealOnlyIfNotInCombat          = Yes
    End
	
    Behavior = GiantBirdAIUpdate ModuleTag_GiantBirdAI
        AutoAcquireEnemiesWhenIdle      = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate             = 500
        AILuaEventsList                 = FellBeastFunctions
        FollowThroughDistance           = 200
        FollowThroughCheckStep          = 50
        FollowThroughGradient           = 1.0
        GrabTossTimeTrigger             = 2.5
        GrabTossHeightTrigger           = 100.0
        TossFX                          = FX_DiebyFalling
        SpecialContactPoints            = Swoop
        AttackPriority                  = AttackPriority_FellBeast
    End

    Behavior = RadiateFearUpdate ModuleTag_GoldenArrowDaylightUpdate
        EmotionPulseRadius              = 100
        EmotionPulseInterval            = 2500
        GenerateFear                    = Yes
        InitiallyActive                 = Yes
        VictimFilter                    = ALL ENEMIES
    End

    Behavior = SlowDeathBehavior ModuleTag_SlowDeath
        DeathTypes            = ALL
        DestructionDelay    = 500
        ShadowWhenDead        = No
        Sound                = INITIAL DrogothVoxDie
        FX                    = INITIAL FX_DrogothDeath
       End
	
	LocomotorSet
		Locomotor = MordorFlyingFireLocomotor
		Condition = SET_NORMAL 
		Speed     = 120
	End
	LocomotorSet
		Locomotor = MordorFlyingFireLocomotor
		Condition = SET_SUPERSONIC 
		Speed     = 165
	End
	LocomotorSet
		Locomotor = MordorFlyingFireLocomotor
		Condition = SET_WANDER 
		Speed     = 88
	End

	  LocomotorSet
	    Locomotor = MordorFlyingFireSwoopLocomotor
	    Condition = SET_PANIC
	    Speed     = 185
	  End

	Behavior = PhysicsBehavior ModuleTag_04
	End
	
	Behavior = NotifyTargetsOfImminentProbableCrushingUpdate ModuleTag_NotifyCrushScan
	End

	Behavior = SquishCollide ModuleTag_06
	End

    Behavior = TransportContain TransportContainModuleTag
        ObjectStatusOfContained     = UNSELECTABLE UNATTACKABLE
        PassengerFilter             = ANY +INFANTRY +HULK +CAVALRY +GRAB_AND_DROP -HERO -PORTER
        Slots                       = 1
        ShowPips                    = No
        CollidePickup               = No
        AllowEnemiesInside          = Yes
        AllowNeutralInside          = Yes
        AllowAlliesInside           = Yes
        DamagePercentToUnits        = 0%
        PassengerBonePrefix         = PassengerBone:B_PASSENGER KindOf:GRAB_AND_DROP
        EjectPassengersOnDeath      = No
        GrabWeapon                  = FellbeastGrabWeapon
        FireGrabWeaponOnVictim      = No
        ReleaseSnappyness           = 0.05
    End

    Behavior = StealthDetectorUpdate StealthDetectorUpdateModuleTag
        DetectionRate              = 500
    End

    Behavior = HitReactionBehavior HitReactionBehaviorModuleTag
        HitReactionLifeTimer1         = 7
        HitReactionLifeTimer2         = 15
        HitReactionLifeTimer3         = 10

        HitReactionThreshold1         = 0.0
        HitReactionThreshold2         = 25.0
        HitReactionThreshold3         = 50.0
    End

    Behavior = SlavedUpdate ModuleTag_Slave
		GuardMaxRange		= 500
		GuardWanderRange	= 250
		UseSlaverAsControlForEvaObjectSightedEvents = No 
                DieOnMastersDeath	= Yes
	End

	Scale	= 0.70

    Geometry            = CYLINDER
    GeometryMinorRadius = 39.0
    GeometryMajorRadius = 39.0
    GeometryHeight        = 40.0
    GeometryOffset        = X:0 Y:0 Z:-10
    GeometryIsSmall        = No
    Shadow                = SHADOW_VOLUME_NON_SELF_3
    ShadowSunAngle        = 89

End
