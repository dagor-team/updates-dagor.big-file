Object WildGoblinKing_mod

    SelectPortrait = HPGorkilNew
    ButtonImage    = HIGoblinKingnew

    DescriptionStrategic = CONTROLBAR:LW_ToolTip_LeaderHero

    Draw = W3DScriptedModelDraw ModuleTag_DRAW

        WadingParticleSys    = EntRipples
        StaticModelLODMode   = Yes
        OkToChangeModelColor = Yes

        DefaultModelConditionState
            Model                   = mugobking_skn
            Skeleton                = WUGobKng_SKL
        End

        TransitionState                =    TRANS_SelectFromIdleMounted
            Animation
                AnimationName        =    WUGbkMnt_ATNA
                AnimationMode        =    ONCE
            End
        End
        TransitionState                =    TRANS_SelectFromSkullTotemMounted
            Animation
                AnimationName        =    WUGbkMnt_ATNB
                AnimationMode        =    ONCE
                AnimationBlendTime    =    0
            End
        End
        TransitionState                =    TRANS_SelectFromMovingMounted
            Animation
                AnimationName        =    WUGbkMnt_ATNB
                AnimationMode        =    ONCE
            End
        End


        TransitionState                =    TRANS_IdleFromSelectMountedNoBlend
            Animation
                AnimationName        =    WUGbkMnt_ATNC
                AnimationMode        =    ONCE
                AnimationBlendTime    =    0
            End
        End
        TransitionState                =    TRANS_IdleFromSelectMounted
            Animation
                AnimationName        =    WUGbkMnt_ATNC
                AnimationMode        =    ONCE
            End
        End

        IdleAnimationState
            Animation
                AnimationName = WuGobKng_IDLB
                AnimationMode = ONCE
                AnimationPriority = 30
            End
            Animation
                AnimationName = WuGobKng_IDLC
                AnimationMode = ONCE
                AnimationPriority = 5
            End
            Animation
                AnimationName = WuGobKng_IDLD
                AnimationMode = ONCE
                AnimationPriority = 5
            End
            StateName = Idle
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_PlantingTotem" then
                    CurDrawableSetTransitionAnimState("TRANS_TotemToIdle")
                elseif Prev == "STATE_Selected" then
                    CurDrawableSetTransitionAnimState("TRANS_SelectedToBored")
                end
            EndScript
        End


        AnimationState                        = PASSENGER
            Animation
                AnimationName                = WuGobKng_FLYA
                AnimationMode                = LOOP
            End
        End

        AnimationState                        = FREEFALL
            Animation
                AnimationName                = WuGobKng_FLYA
                AnimationMode                = LOOP
                AnimationSpeedFactorRange    = 0.5    0.5
                AnimationBlendTime            = 5
            End
        End

        AnimationState            = STUNNED_FLAILING
            Animation
                AnimationName   = WuGobKng_FLYA
                AnimationMode   = LOOP
                AnimationSpeedFactorRange    = 0.4 0.6
            End
        End

        AnimationState            = DYING BURNINGDEATH
            Animation
                AnimationName    = WuGobKng_DTHA
                AnimationMode    = ONCE
                AnimationBlendTime = 10
            End
        End

        AnimationState            = DYING SPLATTED
            Animation
                AnimationName    = WuGobKng_LNDA
                AnimationMode    = ONCE
            End
        End

        AnimationState = DYING
            Animation
                AnimationName = WuGobKng_DTHA
                AnimationMode = ONCE
            End
        End

        AnimationState            = BURNINGDEATH
            Animation
                AnimationName    = WUGobKNG_MFDA
                AnimationMode    = LOOP
                Distance        = 120
            End
        End

        AnimationState                        = PARALYZED
            Animation
                AnimationName                = WuGobKng_IDLA
                AnimationMode                = LOOP
            End
        End


        AnimationState        = STUNNED
            Animation
                AnimationName     = WuGobKng_LNDA
                AnimationMode     = ONCE
            End
        End

        AnimationState        = STUNNED_STANDING_UP
            Animation
                AnimationName     = WuGobKng_GTPA
                AnimationMode     = ONCE
            End
        End

        AnimationState        = THROWN_PROJECTILE
            Animation
                AnimationName     = WuGobKng_FLYA
                AnimationMode     = LOOP
            End
        End


        AnimationState = MOVING WANDER
            Animation
                AnimationName = WuGobKng_WLKA
                AnimationMode = LOOP
            End
        End

        AnimationState = MOVING DAMAGED AFLAME
            Animation
                AnimationName = WuGobKng_MFDA
                AnimationMode = LOOP
            End
            Flags = RANDOMSTART
        End

        AnimationState = MOVING ATTACKING
            Animation
                AnimationName = WuGobKng_RUNA
                AnimationMode = LOOP
            End
            Flags = RANDOMSTART
            ParticleSysBone = None InfantryDustTrails
        End

        AnimationState = MOVING WALKING
            Animation
                AnimationName = WuGobKng_WLKA
                AnimationMode = LOOP
            End
            Flags = RANDOMSTART
            ParticleSysBone = None InfantryDustTrails
        End

        AnimationState = MOVING
            Animation
                AnimationName = WuGobKng_RUNA
                AnimationMode = LOOP
            End
            Flags = RANDOMSTART
            ParticleSysBone = None InfantryDustTrails
        End

        AnimationState = PACKING_TYPE_1
            StateName = STATE_PlantingTotem
            Animation
                AnimationName = WuGobKng_SPCC
                AnimationMode = ONCE
            End

        End



        AnimationState                = USER_1
            Animation
                AnimationName        = WuGobKng_SPCA
                AnimationMode        = ONCE
            End
        End


        AnimationState                = USER_2
            Animation
                AnimationName        = WuGobKng_SPCB
                AnimationMode        = ONCE
            End
        End


        AnimationState = HIT_REACTION
            Animation
                AnimationName = WuGobKng_HITA
                AnimationMode = LOOP
            End
        End

        AnimationState                = SPECIAL_WEAPON_ONE
            Animation
                AnimationName = WuGobKng_ATKA
                AnimationMode = ONCE
                UseWeaponTiming        =    Yes
            End
            Animation
                AnimationName = WuGobKng_ATKB
                AnimationMode = ONCE
                UseWeaponTiming        =    Yes
            End
            Animation
                AnimationName = WuGobKng_ATKC
                AnimationMode = ONCE
                UseWeaponTiming        =    Yes
            End
            ParticleSysBone B_SWORD GoblinKingPoison FollowBone:Yes
            ParticleSysBone B_SWORD GoblinKingPoison2 FollowBone:Yes
        End

        AnimationState = FIRING_OR_PREATTACK_A
            Animation
                AnimationName = WuGobKng_ATKA
                AnimationMode = ONCE
                UseWeaponTiming        =    Yes
            End
            Animation
                AnimationName = WuGobKng_ATKB
                AnimationMode = ONCE
                UseWeaponTiming        =    Yes
            End
            Animation
                AnimationName = WuGobKng_ATKC
                AnimationMode = ONCE
                UseWeaponTiming        =    Yes
            End
        End

        AnimationState = FIRING_OR_PREATTACK_B
            Animation
                AnimationName = WuGobKng_ATKA
                AnimationMode = ONCE
                UseWeaponTiming        =    Yes
            End
            Animation
                AnimationName = WuGobKng_ATKB
                AnimationMode = ONCE
                UseWeaponTiming        =    Yes
            End
            Animation
                AnimationName = WuGobKng_ATKC
                AnimationMode = ONCE
                UseWeaponTiming        =    Yes
            End
        End

        AnimationState = BETWEEN_FIRING_SHOTS_A
            Animation
                AnimationName = WuGobKng_IDLA
                AnimationMode = ONCE
            End
        End

        AnimationState = ATTACKING
            Animation
                AnimationName = WuGobKng_ATKA
                AnimationMode = LOOP
            End
        End

        AnimationState                            = EMOTION_TAUNTING
            Animation
                AnimationName                    = WuGobKng_TNTA
                AnimationMode                    = LOOP
                AnimationBlendTime                = 10
            End
            Flags                = RESTART_ANIM_WHEN_COMPLETE
        End

        AnimationState                =    MOUNTED EMOTION_CELEBRATING
            Animation
                AnimationName        =    WUGbkMnt_CHRA
                AnimationMode        =    LOOP
            End
        End

        AnimationState                            = EMOTION_CELEBRATING
            Animation
                AnimationName                    = WuGobKng_CHRA
                AnimationMode                    = ONCE
                AnimationBlendTime                = 10
            End
            Flags                = RESTART_ANIM_WHEN_COMPLETE
        End

        AnimationState                = LEVELED
            Animation                = LevelUp
                AnimationName        = WuGobKng_LVLA
                AnimationMode        = ONCE
            End
        End

        AnimationState                            = RAISING_FLAG
            Animation
                AnimationName                    = WuGobKng_CHRA
                AnimationMode                    = LOOP
            End
        End

        AnimationState        = SELECTED
            StateName           = STATE_Selected
            Animation
                AnimationName     = WuGobKng_ATNB
                AnimationMode     = LOOP
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_PlantingTotem" then
                    CurDrawableSetTransitionAnimState("TRANS_TotemToIdle")
                elseif Prev ~= "STATE_Selected" and Prev ~= "TRANS_IdleToSelected" then
                    CurDrawableSetTransitionAnimState("TRANS_IdleToSelected")
                end
            EndScript
        End



        TransitionState       = TRANS_IdleToSelected
            Animation
                AnimationName     = WuGobKng_ATNA
                AnimationMode     = ONCE
            End
        End

        TransitionState        = TRANS_SelectedToBored
            Animation
                AnimationName    = WuGobKng_ATNC
                AnimationMode    = ONCE
            End
        End

        TransitionState        = TRANS_TotemToIdle
            Animation
                AnimationName        = WuGobKng_IDLA
                AnimationMode        = ONCE
                AnimationBlendTime    = 0
            End
        End

    End

    Draw = W3DScriptedModelDraw Icon
        ModelConditionState = NONE
            Model           = bbox
        End
    End


    Draw = W3DScriptedModelDraw DustEffects
        DefaultModelConditionState
          Model = None
        End
        IdleAnimationState
        End
        AnimationState = MOUNTED MOVING WADING
            ParticleSysBone = None FootstepSlash
        End
        AnimationState = MOUNTED MOVING ACCELERATE
            ParticleSysBone = None GenericSiegeTrailDust
        End
        AnimationState = MOUNTED MOVING ACCELERATE
            ParticleSysBone = None GenericSiegeTrailDust
        End
        AnimationState = DISGUISED MOUNTED MOVING ACCELERATE
            ParticleSysBone = None GenericSiegeTrailDust
        End
        AnimationState = DISGUISED MOUNTED MOVING DECELERATE
            ParticleSysBone = None GenericSiegeTrailDust
        End
        AnimationState = MOUNTED MOVING
        End
        AnimationState = DISGUISED MOUNTED MOVING
        End
    End

    #include "..\..\..\includes\StunDrawModuleSmall.inc"


    Side = Wild
    Scale = 0.98
    EditorSorting = UNIT
    ThreatLevel = GOBLIN_KING_THREAT_LEVEL
    ThingClass = CHARACTER_UNIT
    TransportSlotCount = TRANSPORTSLOTCOUNT_HERO
    BuildCost           = GORKILDAG_COST
    BuildTime           = MEDIUM_HERO_BUILDTIME

    BountyValue         = WILD_GOBLIN_KING_BOUNTY_VALUE
    MaxSimultaneousOfType = 1
    DisplayMeleeDamage = GORKILDAG_DAMAGE


    WeaponSet
        Conditions            = None
        Weapon                = PRIMARY        GoblinKingBladeHero
        Weapon                = SECONDARY      GoblinKingBladeHero
        OnlyAgainst           = SECONDARY        STRUCTURE
        AutoChooseSources     = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End


    ArmorSet
        Conditions      = None
        Armor           = MediumHeroArmor
        DamageFX        = NormalDamageFX
		End


    VisionRange = 300
    ShroudClearingRange = 260

    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = 200
    VisionBonusPercentPerFoot = 1.0%

    DisplayName = OBJECT:WildGoblinKing
    RecruitText = CONTROLBAR:WildGoblinKingRecruit
    ReviveText    = CONTROLBAR:WildGoblinKingReviveNew
    Hotkey        = CONTROLBAR:WildGoblinKingHotkey
    CrusherLevel = 0
    CrushableLevel = 2

    CommandSet = WildGoblinKingCommandSetMod
    CommandPoints = 0



    AutoResolveUnitType = AutoResolveUnit_Hero
    AutoResolveCombatChain = AutoResolve_HeroCombatChain

    AutoResolveBody = AutoResolve_GoblinKingBody

    AutoResolveArmor
        Armor = AutoResolve_GoblinKingArmor
    End

    AutoResolveWeapon
        Weapon = AutoResolve_GoblinKingWeapon
    End

    AutoResolveLeadership = AutoResolve_GoblinKingBonus


    VoiceAttack                             = GoblinKingVoiceAttack
    VoiceAttackCharge                       = GoblinKingVoiceAttackCharge
    VoiceAttackMachine                      = GoblinKingVoiceAttack
    VoiceAttackStructure                    = GoblinKingVoiceAttackBuilding
    VoiceFear                               = GoblinKingVoiceHelpMe
    VoiceGuard                              = GoblinKingVoiceMove
    VoiceMove                               = GoblinKingVoiceMove
    VoiceMoveOverWalls                      = GoblinKingVoiceMove
    VoiceMoveToCamp                         = GoblinKingVoiceMoveCamp
    VoiceMoveWhileAttacking                 = GoblinKingVoiceDisengage
    VoicePriority                           = 88
    VoiceRetreatToCastle                    = GoblinKingVoiceRetreat
    VoiceSelect                             = GoblinKingVoiceSelectMS
    VoiceSelectBattle                       = GoblinKingVoiceSelectBattle

    SoundImpact                             = ImpactHorse

    UnitSpecificSounds
        VoiceEnterUnitEvilMenTransportShip  = GoblinKingVoiceMoveShip
        VoiceEnterUnitMordorMumakil         = GoblinKingVoiceMoveGarrison
        VoiceEnterUnitSlaughterHouse        = GoblinKingVoiceMoveGarrison
        VoiceGarrison                       = GoblinKingVoiceMoveGarrison
        VoiceInitiateCaptureBuilding        = GoblinKingVoiceCaptureBuilding
    End

    ClientBehavior = ModelConditionSoundSelectorClientBehavior ModuleTag_MCSoundSelector
        SoundState = MOUNTED
            VoiceMove        = GoblinKingVoiceMoveMountedMS
            VoiceSelect      = GoblinKingVoiceSelectMountedMS
            SoundMoveLoop    = ScorpionMoveLoop
        End
    End

    CrowdResponseKey = Goblin

    #include "..\..\..\includes\StandardUnitEvaEvents.inc"
    EvaEventDieOwner        = GoblinKingDie

    Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
        Key = Goblin Hero
    End

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound:GoblinKingPoisonStingerStrike      Animation:WUGbkMnt_SKL.WUGbkMnt_ATKB    Frames:4
        AnimationSound = Sound:BodyFallOrc                        Animation:WUGOBKNG_SKL.WUGOBKNG_DTHA    Frames:73
        AnimationSound = Sound:BodyFallOrc                        Animation:WUGOBKNG_SKL.WUGOBKNG_LNDA    Frames:5
        AnimationSound = Sound:BodyFallOrc                        Animation:WUGBKMNT_SKL.WUGBKMNT_DIEA    Frames:24 30
        AnimationSound = Sound:BodyFallOrc                        Animation:WUGBKMNT_SKL.WUGBKMNT_LNDA    Frames:8 21
    End



    Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance               = 200
        TauntAndPointUpdateDelay            = 10000
        PointAt                             = ANY +HERO
        AddEmotion            =    Doom_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
        AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    Alert_Base
        AddEmotion            =    CheerForAboutToCrush_Base
    End

    RadarPriority = UNIT
    KindOf = HERO PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY ATTACK_NEEDS_LINE_OF_SIGHT PATH_THROUGH_EACH_OTHER SCORE ARMY_SUMMARY HEAVY_MELEE_HITTER
    PathfindDiameter = 40.0

    Body = RespawnBody ModuleTag_RespawnBody
        MaxHealth                   = GORKILDAG_HEALTH
        PermanentlyKilledByFilter   = NONE
        DodgePercent                = HERO_DODGE_PERCENT
    End

    Behavior = RespawnUpdate ModuleTag_RespawnUpdate
        DeathAnim                    = DYING
        DeathAnimationTime           = 6500
        RespawnAnim                  = LEVELED
        RespawnAnimationTime         = 2000
        AutoRespawnAtObjectFilter    = NONE +CASTLE_KEEP
        ButtonImage                  = HIGoblinKingnew
        RespawnAsTemplate            = WildGoblinKing_mod

        RespawnRules =    AutoSpawn:No           Cost:GORKILDAG_COST       Time:MEDIUM_HERO_RESPAWNTIME        Health:100%
    End

    Behavior = AutoHealBehavior ModuleTag_GoblinKingHealing
        StartsActive = Yes
        HealingAmount = HERO_HEAL_AMOUNT
        HealingDelay = 1000
        StartHealingDelay = HERO_HEAL_DELAY
        HealOnlyIfNotInCombat = Yes
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = Hero
    End



    #include "..\..\..\includes\CaptureBuilding.inc"

    Behavior = AIUpdateInterface ModuleTag_03
        AutoAcquireEnemiesWhenIdle = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate        = 500
        BurningDeathTime           = BURNINGDEATH_DURATION_INFANTRY
    End

    LocomotorSet
        Locomotor = HeroHumanLocomotor
        Condition = SET_NORMAL
        Speed     = NORMAL_EVIL_FAST_HERO_SPEED
    End

    Behavior = PhysicsBehavior ModuleTag_04
        GravityMult = 1.0
        ShockStandingTime = 4500
    End

    Behavior = SlowDeathBehavior ModuleTag_05
        DeathTypes = ALL
        SinkDelay = 3000
        SinkRate = 1.40
        DestructionDelay = 8000
        Sound = INITIAL GoblinKingVoiceDie
    End

    Behavior = SquishCollide ModuleTag_06

    End

    Behavior = HitReactionBehavior HitReactionBehaviorModuleTag
        HitReactionLifeTimer1 = 1800
        HitReactionThreshold1 = 5.0
        FastHitsResetReaction = No
    End





    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_ScorpionToggleEnabler
        SpecialPowerTemplate = SpecialAbilityToggleMounted
        TriggeredBy = Upgrade_Level_1
    End

    Behavior = SpecialPowerModule ModuleTag_HorseToggleStarter
         SpecialPowerTemplate        = SpecialAbilityToggleMounted
         UpdateModuleStartsAttack    = Yes
         StartsPaused                = Yes
    End

    Behavior = ToggleMountedSpecialAbilityUpdate ModuleTag_HorseToggle
         SpecialPowerTemplate    = SpecialAbilityToggleMounted
         MountedTemplate            = WildGoblinKingMounted
         SynchronizeTimerOnSpecialPower = SpecialAbilityGoblinKingPoisonedStinger SpecialAbilityGoblinKingPoisonedStinger2 SpecialAbilitySkullTotem SpecialAbilitySkullTotemKing SpecialAbilityCallFromTheDeep SpecialAbilityGorkilGloriousCharge SpecialAbilityZuchtspinnenSummon SpecialAbilityZuchtspinnenSummon2 SpecialAbilityBuhrdurOilFire SpecialAbilityBuhrdurIgniteOil SpecialAbilityTheodenGloriousCharge SpecialAbilitySkullTotemKing2
         UnpackTime              = GOOD_MOUNT_TIME
         PreparationTime         = 0
         PackTime                = GOOD_MOUNT_TIME
         OpacityTarget            = .3
         AwardXPForTriggering    = 0
         IgnoreFacingCheck        = Yes
    End






    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_GoblinKingPoisonedStinger
        SpecialPowerTemplate = SpecialAbilityGoblinKingPoisonedStinger
        TriggeredBy = Upgrade_Level_4
       ObeyRechageOnTrigger       = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_GoblinKingPoisonedStingerStarter
        SpecialPowerTemplate      = SpecialAbilityGoblinKingPoisonedStinger
        UpdateModuleStartsAttack  = Yes
        StartsPaused = Yes
        InitiateSound = GoblinKingVoiceAttackStinger
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_GoblinKingPoisonedStingerUpdate
        SpecialPowerTemplate    = SpecialAbilityGoblinKingPoisonedStinger
        SkipContinue            = Yes
        UnpackTime              = 250
        PreparationTime         = 1
        PersistentPrepTime      = 500
        PackTime                = 100
        MustFinishAbility       = Yes
        AwardXPForTriggering    = 0
        StartAbilityRange       = 15.0
        SpecialWeapon           = WildGoblinKingPoisonedStingerMod
        WhichSpecialWeapon      = 1
    End

    Behavior = AutoAbilityBehavior ModuleTag_AutoAbilityBehaviorPoisonedStinger
	SpecialAbility  = SpecialAbilityGoblinKingPoisonedStinger
	ForbiddenStatus = INSIDE_GARRISON
	Query 		= 1 AFFECTED_BY_POISON_OBJECTFILTER -MordorFellBeast -MordorFellBeastInterface -GondorGwaihir -GondorGwaihir_Summoned -ElvenFortressEagle -Drogoth ENEMIES
	MaxScanRange    = 100
    End




    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_GoblinKingPoisonedStinger2
        SpecialPowerTemplate = SpecialAbilityGoblinKingPoisonedStinger2
        TriggeredBy = Upgrade_Level_4
        ObeyRechageOnTrigger       = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_GoblinKingPoisonedStingerStarter2
        SpecialPowerTemplate      = SpecialAbilityGoblinKingPoisonedStinger2
        UpdateModuleStartsAttack  = Yes
        StartsPaused = Yes
        InitiateSound = GoblinKingVoiceAttackStinger
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_GoblinKingPoisonedStingerUpdate2
        SpecialPowerTemplate    = SpecialAbilityGoblinKingPoisonedStinger2
        SkipContinue            = Yes
        UnpackTime              = 250
        PreparationTime         = 1
        PersistentPrepTime      = 500
        PackTime                = 100
        MustFinishAbility       = Yes
        AwardXPForTriggering    = 0
        StartAbilityRange       = 15.0
        SpecialWeapon           = WildGoblinKingPoisonedStingerMod2
        WhichSpecialWeapon      = 1
    End

    Behavior = AutoAbilityBehavior ModuleTag_AutoAbilityBehavior2
	SpecialAbility  = SpecialAbilityGoblinKingPoisonedStinger2
	ForbiddenStatus = INSIDE_GARRISON
	Query 		= 1 AFFECTED_BY_POISON_OBJECTFILTER -MordorFellBeast -MordorFellBeastInterface -GondorGwaihir -GondorGwaihir_Summoned -ElvenFortressEagle -Drogoth ENEMIES
	MaxScanRange    = 100
    End




    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_SkullTotemEnabler
        SpecialPowerTemplate       = SpecialAbilitySkullTotem
        TriggeredBy                = Upgrade_Level_2
        ObeyRechageOnTrigger       = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_SkullTotemStarter
        SpecialPowerTemplate          = SpecialAbilitySkullTotem
        UpdateModuleStartsAttack      = Yes
        StartsPaused                  = Yes
        InitiateSound                 = GoblinKingVoiceSkullTotem
        OnTriggerRechargeSpecialPower = SpecialAbilityMountedSkullTotem
     End

    Behavior = ActivateModuleSpecialPower ModuleTag_SkullTotemUpdate
        SpecialPowerTemplate      = SpecialAbilitySkullTotem
        StartAbilityRange         = 25
        MustFinishAbility         = Yes
        UnpackTime                = 800
        PackTime                  = 1200
        UnpackingVariation        = 1
        TriggerSpecialPower       = ModuleTag_SkullTotemPower2 OBJECTPOS
    End

    Behavior = OCLSpecialPower ModuleTag_SkullTotemPower2
        SpecialPowerTemplate    = SpecialAbilitySkullTotem2
        OCL                     = OCL_SpawnSkullTotem
        CreateLocation          = CREATE_AT_LOCATION
        StartsPaused            = No
    End

    Behavior = AutoAbilityBehavior ModuleTag_KingsFavorAutoAbility2
	SpecialAbility	= SpecialAbilitySkullTotem
	ForbiddenStatus = INSIDE_GARRISON
	MaxScanRange	= 200
	Query		= 20 ANY +CAVALRY +INFANTRY -STRUCTURE -CASTLE_KEEP -BASE_FOUNDATION -HERO -MOVE_ONLY -DOZER ALLIES
    End




    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_SkullTotemEnablerKing
       SpecialPowerTemplate       = SpecialAbilitySkullTotemKing
       TriggeredBy                = Upgrade_Level_2
       ObeyRechageOnTrigger       = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_SkullTotemStarterKing
        SpecialPowerTemplate            = SpecialAbilitySkullTotemKing
        UpdateModuleStartsAttack        = Yes
        StartsPaused                    = Yes
        InitiateSound                   = GoblinKingVoiceSkullTotem
     End

    Behavior = ActivateModuleSpecialPower ModuleTag_SkullTotemUpdateKing
        SpecialPowerTemplate    = SpecialAbilitySkullTotemKing
        StartAbilityRange       = 25
        MustFinishAbility       = Yes
        UnpackTime              = 800
        PackTime                = 1200
        UnpackingVariation      = 1
        TriggerSpecialPower     = ModuleTag_SkullTotemPowerKing OBJECTPOS
    End

    Behavior = OCLSpecialPower ModuleTag_SkullTotemPowerKing
        SpecialPowerTemplate    = SpecialAbilitySkullTotemKing2
        OCL                     = OCL_SpawnSkullTotemKing
        CreateLocation          = CREATE_AT_LOCATION
        StartsPaused            = No
    End

    Behavior = AutoAbilityBehavior ModuleTag_KingsFavorAutoAbility3
	SpecialAbility	= SpecialAbilitySkullTotemKing
	ForbiddenStatus = INSIDE_GARRISON
	MaxScanRange	= 200
	Query		= 20 ANY +CAVALRY +INFANTRY -STRUCTURE -CASTLE_KEEP -BASE_FOUNDATION -HERO -MOVE_ONLY -DOZER ALLIES
    End




    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_MountedSkullTotemEnabler
       SpecialPowerTemplate     = SpecialAbilityMountedSkullTotem
       TriggeredBy              = Upgrade_Level_2
       ObeyRechageOnTrigger     = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_MountedSkullTotemStarter
        SpecialPowerTemplate          = SpecialAbilityMountedSkullTotem
        UpdateModuleStartsAttack      = Yes
        StartsPaused                  = Yes
        OnTriggerRechargeSpecialPower = SpecialAbilitySkullTotem
     End

    Behavior = ActivateModuleSpecialPower ModuleTag_MountedSkullTotemUpdate
        SpecialPowerTemplate    = SpecialAbilityMountedSkullTotem
        StartAbilityRange       = 25
        MustFinishAbility       = Yes
        UnpackTime              = 1300
        PackTime                = 1000
        UnpackingVariation      = 1
        TriggerSpecialPower     = ModuleTag_MountedSkullTotemPower2 OBJECTPOS
    End

    Behavior = OCLSpecialPower ModuleTag_MountedSkullTotemPower2
        SpecialPowerTemplate    = SpecialAbilityMountedSkullTotem2
        OCL                     = OCL_SpawnMountedSkullTotem
        CreateLocation          = CREATE_AT_LOCATION
        StartsPaused            = No
    End

    Behavior = AutoAbilityBehavior ModuleTag_KingsFavorAutoAbility4
	SpecialAbility	= SpecialAbilityMountedSkullTotem2
	ForbiddenStatus = INSIDE_GARRISON
	MaxScanRange	= 200
	Query		= 20 ANY +CAVALRY +INFANTRY -STRUCTURE -CASTLE_KEEP -BASE_FOUNDATION -HERO -MOVE_ONLY -DOZER ALLIES
    End




    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_CallFromTheDeepEnabler
        SpecialPowerTemplate      = SpecialAbilityZuchtspinnenSummon
        TriggeredBy               = Upgrade_Level_8
       ObeyRechageOnTrigger       = Yes
    End

    Behavior = OCLSpecialPower ModuleTag_CallFromTheDeepPower
        SpecialPowerTemplate      = SpecialAbilityZuchtspinnenSummon
        OCL                       = OCL_SpawnZuchtspinnenEgg
        CreateLocation            = CREATE_AT_LOCATION
        StartsPaused              = Yes
        TriggerFX                 = FX_ZuchtspinnenSummonStart
        SetModelCondition         = ModelConditionState:USER_2
        SetModelConditionTime     = 3.5
        DisableDuringAnimDuration = Yes
    End






    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_CallFromTheDeepEnabler2
        SpecialPowerTemplate      = SpecialAbilityZuchtspinnenSummon2
        TriggeredBy               = Upgrade_Level_8
       ObeyRechageOnTrigger       = Yes
    End

    Behavior = OCLSpecialPower ModuleTag_CallFromTheDeepPower2
        SpecialPowerTemplate      = SpecialAbilityZuchtspinnenSummon2
        OCL                       = OCL_SpawnZuchtspinnenEgg
        CreateLocation            = CREATE_AT_LOCATION
        StartsPaused              = Yes
        TriggerFX                 = FX_ZuchtspinnenSummonStart
        SetModelCondition         = ModelConditionState:USER_2
        SetModelConditionTime     = 3.5
        DisableDuringAnimDuration = Yes
    End


	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_CreateAHeroOilFireEnabler_Level3
		SpecialPowerTemplate = SpecialAbilityBuhrdurOilFire
		TriggeredBy = Upgrade_Level_9
	End

	Behavior = OCLSpecialPower ModuleTag_CreateAHeroOilFireStarter_Level3
		SpecialPowerTemplate    = SpecialAbilityBuhrdurOilFire
		OCL                        = OCL_BuhrdurOilFire
		CreateLocation            = USE_OWNER_OBJECT
		StartsPaused            = Yes
        AvailableAtStart               = No
	End

	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_CreateAHeroIgniteOilEnabler_Level3
		SpecialPowerTemplate = SpecialAbilityBuhrdurIgniteOil
		TriggeredBy = Upgrade_Level_9
	End

	Behavior = SpecialPowerModule ModuleTag_CreateAHeroIgniteOilStarter_Level3
		SpecialPowerTemplate     = SpecialAbilityBuhrdurIgniteOil
        AvailableAtStart         = No
		UpdateModuleStartsAttack = Yes
		StartsPaused             = Yes
	End

	Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_CreateAHeroIgniteOilUpdate_Level3
		SpecialPowerTemplate    = SpecialAbilityBuhrdurIgniteOil

		UnpackTime              = 2000
		PackTime                = 2000 

		AwardXPForTriggering    = 0
			
		SpecialWeapon = BuhrdurTriggerIgniteOil
		WhichSpecialWeapon = 1

		Instant                    = Yes
	End




        Behavior = UnpauseSpecialPowerUpgrade ModuleTag_TheodenGloriousChargeEnabler
        SpecialPowerTemplate = SpecialAbilityGorkilGloriousCharge
        TriggeredBy = Upgrade_Level_1
        ObeyRechageOnTrigger       = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_TheodenGloriousChargeUpdate
        SpecialPowerTemplate      = SpecialAbilityGorkilGloriousCharge
        UpdateModuleStartsAttack  = Yes
        StartsPaused = Yes
        AttributeModifier = GorkilAnsturmModifier
        AttributeModifierRange = 200
        AttributeModifierAffectsSelf = No
        AttributeModifierAffects NONE +GoblinSpiderRider +GoblinSpiderRiderHorde +WildBannerSpiderRider ALLIES
        AttributeModifierFX = FX_GorkilGloriousChargeFX
    End

    Behavior = SpecialAbilityUpdate ModuleTag_GloriousChargeAnimation
        UnpackTime              = 1000
        UnpackingVariation      = 1
        SpecialPowerTemplate    = SpecialAbilityGorkilGloriousCharge
        PreparationTime         = 0
        PersistentPrepTime      = 0
        PackTime                = 1330
    End

    Behavior = AttributeModifierUpgrade ModuleTag_Bonus
        TriggeredBy 	  = Upgrade_GorkilCrown
        AttributeModifier = GorkilKingBonus
    End

    Behavior = CommandSetUpgrade ModueTag_CommandSetKing
        TriggeredBy   = Upgrade_GorkilCrown
        CommandSet    = WildGoblinKingCommandSetModKing
    End


Behavior = AttributeModifierAuraUpdate ModuleTag_LeadershipUpgradeGroßorkKrone
        StartsActive     = No
        BonusName        = EomerPassiveOutlawLeadership
        TriggeredBy      = Upgrade_GorkilCrown
        RefreshDelay     = 2000
        Range            = 150000
        AllowSelf        = Yes
        ObjectFilter     = WILD_LEADERSHIP_UNITS_OBF
    End

    
	

    Behavior = GrantUpgradeCreate ModuleTag_VoraussetzungKrone
        UpgradeToGrant      = Upgrade_SchattenAngmars
        GiveOnBuildComplete = Yes
    End





    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End

    Behavior = AISpecialPowerUpdate ElvenLorienWarriorHordeCaptureBuildingAI
        CommandButtonName  = Command_CaptureBuilding
        SpecialPowerAIType = AI_SPECIAL_POWER_CAPTURE_BUILDING
    End


    Behavior = AISpecialPowerUpdate GoblinKingPoisonedStingerAI
        CommandButtonName = Command_GoblinKingGiftangriff
        SpecialPowerAIType = AI_SPECIAL_POWER_ENEMY_TYPE_KILLER
        SpecialPowerRadius = 100
    End

    Behavior = AISpecialPowerUpdate SummonAlliesHotWL1AI
        CommandButtonName = Command_GorkilZuchtspinnenSummon
        SpecialPowerAIType = AI_SPECIAL_POWER_TARGETAOE_SUMMON
        SpecialPowerRadius = 30.0
    End

    Behavior = AISpecialPowerUpdate GoblinKingCallOfTheDeepAI
        CommandButtonName = Command_GoblinKingSkullTotem
        SpecialPowerAIType = AI_SPECIAL_POWER_GOBLINKING_CALLOFTHEDEEP
        SpecialPowerRadius = 100
    End

    Geometry = CYLINDER
    GeometryMajorRadius = 8.0
    GeometryMinorRadius = 8.0
    GeometryHeight = 19.2
    GeometryIsSmall = Yes
    Shadow = SHADOW_DECAL
    ShadowSizeX = 20
    ShadowSizeY = 20
    ShadowTexture = ShadowI
End


Object WildGoblinKingMounted


    SelectPortrait = HPGorkilNew
    ButtonImage    = HIGoblinKingnew

     EquivalentTo = WildGoblinKing_mod

    DescriptionStrategic = CONTROLBAR:LW_ToolTip_LeaderHero

    Draw = W3DScriptedModelDraw ModuleTag_DRAW

        WadingParticleSys    = EntRipples
        StaticModelLODMode   = Yes
        OkToChangeModelColor = Yes





        DefaultModelConditionState
            Model                   = wugoblking_m
            Skeleton                = MUSpidRdr_SKL
        End

        ModelConditionState         = WEAPONSET_TOGGLE_1
            WeaponLaunchBone        = PRIMARY FIREAROWTIP
        End







        AnimationState                        = CLIMBING
            StateName                        = STATE_Climbing
            Animation                        = Climbing
                AnimationName                = MUSpidRdr_WALB
                AnimationMode                = LOOP
                AnimationBlendTime            = 10
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Running"  then CurDrawableSetTransitionAnimState("Trans_RunningToClimbing") return end

            EndScript
        End
        TransitionState = Trans_RunningToClimbing
            Animation = Transition
                AnimationName = MUSpidRdr_WALC
                AnimationMode = ONCE
            End
        End
        AnimationState                        = RAPPELLING
            StateName                        = STATE_Rappelling
            Animation                        = Rapelling
                AnimationName                = MUSpidRdr_WALD
                AnimationMode                = LOOP
                AnimationBlendTime            = 10
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Running"  then CurDrawableSetTransitionAnimState("Trans_RunningToRappelling") return end

            EndScript
        End
        TransitionState = Trans_RunningToRappelling
            Animation = Transition
                AnimationName = MUSpidRdr_WALG
                AnimationMode = ONCE
            End
        End
        TransitionState = Trans_ClimbingToRunning
            Animation = Transition
                AnimationName = MUSpidRdr_WALF
                AnimationMode = ONCE
            End
        End
        TransitionState = Trans_RappellingToRunning
            Animation = Transition
                AnimationName = MUSpidRdr_WALE
                AnimationMode = ONCE
            End
        End




        AnimationState                    = PASSENGER WEAPONSET_TOGGLE_1
            StateName                    = STATE_Grabbed
            Animation                    = Bow
                AnimationName            = MUSpidRdr_FLYB
                AnimationMode            = LOOP
            End
        End

        AnimationState                    = PASSENGER
            StateName                    = STATE_Grabbed
            Animation                    = Sword
                AnimationName            = MUSpidRdr_FLYA
                AnimationMode            = LOOP
            End
        End

        AnimationState                    = FREEFALL WEAPONSET_TOGGLE_1
            StateName                    = STATE_Falling
            Animation                    = Bow
                AnimationName            = MUSpidRdr_FLYB
                AnimationMode            = LOOP
                AnimationBlendTime        = 10
            End
        End

        AnimationState                    = FREEFALL
            StateName                    = STATE_Falling
            Animation                    = Sword
                AnimationName            = MUSpidRdr_FLYA
                AnimationMode            = LOOP
                AnimationBlendTime        = 10
            End
        End

        AnimationState                    = STUNNED_FLAILING WEAPONSET_TOGGLE_1
            StateName                    = STATE_Fly
            Animation
                AnimationName           = MUSpidRdr_FLYB
                AnimationMode           = LOOP
            End
            Flags                        = MAINTAIN_FRAME_ACROSS_STATES2
        End

        AnimationState                    = STUNNED_FLAILING
            StateName                    = STATE_Fly
            Animation                   = Sword
                AnimationName           = MUSpidRdr_FLYA
                AnimationMode           = LOOP
            End
            Flags                        = MAINTAIN_FRAME_ACROSS_STATES2
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                PrevAnim = CurDrawablePrevAnimation()
                if PrevState == "Ready_Bow" or PrevState == "Moving_Bow" or PrevState == "Bored_Bow"
                then
                    CurDrawableShowSubObject("arrrow")
                    return "WantSword"
                elseif PrevState == "STATE_Fly"
                then
                    if PrevAnim == "Bow" or PrevAnim == "WantSword"
                    then
                        CurDrawableShowSubObject("arrrow")
                        return "WantSword"
                    end
                end

                CurDrawableHideSubObject("arrrow")
                return "Sword"
            EndScript
        End

        AnimationState                    = DYING BURNINGDEATH
            Animation                    = Bow
                AnimationName            = MUSpidRdr_DIEB
                AnimationMode            = ONCE
                AnimationBlendTime        = 10
            End
        End

        AnimationState                    = DYING SPLATTED WEAPONSET_TOGGLE_1
            StateName                    = STATE_Dead
            Animation                    = Bow
                AnimationName            = MUSpidRdr_LNDB
                AnimationMode            = ONCE
            End
        End

        AnimationState                    = DYING SPLATTED
            StateName                    = STATE_Dead
            Animation                    = Sword
                AnimationName            = MUSpidRdr_LNDA
                AnimationMode            = ONCE
            End
        End



        AnimationState                    = DYING WEAPONSET_TOGGLE_1
            Animation                   = Bow1
                AnimationName           = MUSpidRdr_DIEB
                AnimationMode           = ONCE
            End
            Animation                   = Bow2
                AnimationName           = MUSpidRdr_DIED
                AnimationMode           = ONCE
            End
            Animation                   = WantBow
                AnimationName           = MUSpidRdr_LNDB
                AnimationMode           = ONCE
            End
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                PrevAnim = CurDrawablePrevAnimation()

                if PrevState == "STATE_Fly"
                then
                    CurDrawableHideSubObject("arrrow")
                    return "WantBow"
                end

                if GetClientRandomNumberReal(0,2) < 1
                then
                    CurDrawableShowSubObject("arrrow")
                    return "Bow1"
                else
                    CurDrawableShowSubObject("arrrow")
                    return "Bow2"
                end
            EndScript
        End

        AnimationState                    = DYING
            Animation                   = Sword1
                AnimationName           = MUSpidRdr_DIEA
                AnimationMode           = ONCE
            End
            Animation                   = WantSword
                AnimationName           = MUSpidRdr_DIEC
                AnimationMode           = ONCE
            End

            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                PrevAnim = CurDrawablePrevAnimation()
                if PrevState == "STATE_Fly"
                then
                    CurDrawableShowSubObject("arrrow")
                    return "WantSword"
                end

                CurDrawableHideSubObject("arrrow")
                if GetClientRandomNumberReal(0,2) < 1
                then
                    return "Sword1"
                else
                    return "WantSword"
                end
            EndScript
        End

        AnimationState                    = STUNNED_STANDING_UP WEAPONSET_TOGGLE_1
            StateName                    = STATE_GetUp
            Animation                   = Bow
                AnimationName           = MUSpidRdr_GTPB
                AnimationMode           = ONCE
            End
            Animation                   = WantBow
                AnimationName           = MUSpidRdr_GTPA
                AnimationMode           = ONCE
            End
            Flags                        = MAINTAIN_FRAME_ACROSS_STATES4
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                PrevAnim = CurDrawablePrevAnimation()
                if PrevState == "STATE_GetUp" or PrevState == "STATE_Land"
                then
                    if PrevAnim == "WantBow" or PrevAnim == "Sword"
                    then
                        CurDrawableHideSubObject("arrrow")
                        return "WantBow"
                    end
                else
                    CurDrawableShowSubObject("arrrow")
                    return "Bow"
                end
            EndScript
        End

        AnimationState                    = STUNNED_STANDING_UP
            StateName                    = STATE_GetUp
            Animation                   = Sword
                AnimationName           = MUSpidRdr_GTPA
                AnimationMode           = ONCE
            End
            Animation                   = WantSword
                AnimationName           = MUSpidRdr_GTPB
                AnimationMode           = ONCE
            End
            Flags                        = MAINTAIN_FRAME_ACROSS_STATES4
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                PrevAnim = CurDrawablePrevAnimation()
                if PrevState == "STATE_GetUp" or PrevState == "STATE_Land"
                then
                    if PrevAnim == "Bow" or PrevAnim == "WantSword"
                    then
                        CurDrawableShowSubObject("arrrow")
                        return "WantSword"
                    end
                end

                CurDrawableHideSubObject("arrrow")
                return "Sword"
            EndScript
        End

        AnimationState                    = STUNNED WEAPONSET_TOGGLE_1
            StateName                    = STATE_Land
            Animation                   = Bow
                AnimationName           = MUSpidRdr_LNDA
                AnimationMode           = ONCE
            End
            Animation                   = WantBow
                AnimationName           = MUSpidRdr_LNDB
                AnimationMode           = ONCE
            End
            Flags                        = MAINTAIN_FRAME_ACROSS_STATES3
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                PrevAnim = CurDrawablePrevAnimation()
                if PrevState == "STATE_Fly"
                then
                    if PrevAnim == "WantBow" or PrevAnim == "Sword"
                    then
                        CurDrawableHideSubObject("arrrow")
                        return "WantBow"
                    end
                end

                CurDrawableShowSubObject("arrrow")
                return "Bow"
            EndScript
        End

        AnimationState                    = STUNNED
            StateName                    = STATE_Land
            Animation                   = Sword
                AnimationName           = MUSpidRdr_LNDA
                AnimationMode           = ONCE
            End
            Animation                   = WantSword
                AnimationName           = MUSpidRdr_LNDB
                AnimationMode           = ONCE
            End
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                PrevAnim = CurDrawablePrevAnimation()
                if PrevState == "STATE_Fly"
                then
                    if PrevAnim == "WantSword" or PrevAnim == "Bow"
                    then
                        CurDrawableShowSubObject("arrrow")
                        return "WantSword"
                    end
                end
                Flags                        = MAINTAIN_FRAME_ACROSS_STATES3
                CurDrawableHideSubObject("arrrow")
                return "Sword"
            EndScript
        End

        AnimationState                        = BURNINGDEATH
            Animation
                AnimationName                = MUSpidRdr_MFDA
                AnimationMode                = LOOP
                Distance                    = 55
            End
        End

        AnimationState                        = PARALYZED
            Animation
                AnimationName                = MUSpidRdr_IDLA
                AnimationMode                = LOOP
            End
        End

        AnimationState                    = ATTACKING TURN_LEFT WEAPONSET_TOGGLE_1
            StateName                    = Moving_Bow
            SimilarRestart                = Yes
            Animation                   = run_s
                AnimationName           = MUSpidRdr_TNLBH
                AnimationMode           = LOOP
            End
        End

        AnimationState                    = ATTACKING TURN_LEFT
            StateName                    = Moving_Sword
            SimilarRestart                = Yes
            Animation                   = run_s
                AnimationName           = MUSpidRdr_TRNLH
                AnimationMode           = LOOP
            End
        End

        AnimationState                    = ATTACKING TURN_RIGHT WEAPONSET_TOGGLE_1
            StateName                    = Moving_Bow
            SimilarRestart                = Yes
            Animation                   = run_s
                AnimationName           = MUSpidRdr_TNRBH
                AnimationMode           = LOOP
            End
        End

        AnimationState                    = ATTACKING TURN_RIGHT
            StateName                    = Moving_Sword
            SimilarRestart                = Yes
            Animation                   = run_s
                AnimationName           = MUSpidRdr_TRNRH
                AnimationMode           = LOOP
            End
        End

        AnimationState                    = FIRING_OR_PREATTACK_A WEAPONSET_TOGGLE_1
            Animation
                AnimationName            = MUSpidRdr_ATKB
                AnimationMode            = ONCE
                AnimationBlendTime        = 15
            End

            Flags                        = MAINTAIN_FRAME_ACROSS_STATES
            FrameForPristineBonePositions = 16

            BeginScript
                CurDrawableShowSubObject("arrrow")
            EndScript
        End

        AnimationState                    =    BETWEEN_FIRING_SHOTS_A WEAPONSET_TOGGLE_1
            Animation                    =    BetweenFiringShots
                AnimationName            =    MUSpidRdr_IDLB
                AnimationMode            =    LOOP
                AnimationBlendTime        =   15
            End
        End

        AnimationState                    = FIRING_OR_PREATTACK_A MOVING
            StateName                    = Ready_Sword

            Animation                   = AttackWithSwordWhileMoving
                AnimationName           = MUSpidRdr_ATRA
                AnimationMode           = ONCE
                UseWeaponTiming            = Yes
            End
            BeginScript
                CurDrawableHideSubObject("arrrow")
            EndScript
        End

        AnimationState                    = FIRING_OR_PREATTACK_A
            StateName                    = Ready_Sword

            Animation                   = AttackWithSwordA
                AnimationName           = MUSpidRdr_ATKA
                AnimationMode           = ONCE
                UseWeaponTiming            = Yes
            End
            Animation                   = AttackWithSwordB
                AnimationName           = MUSpidRdr_ATKC
                AnimationMode           = ONCE
                UseWeaponTiming            = Yes
            End
            BeginScript
                CurDrawableHideSubObject("arrrow")
            EndScript
        End

        AnimationState                    = FIRING_OR_PREATTACK_B
            StateName                    = Ready_Sword

            Animation                   = AttackWithSwordA
                AnimationName           = MUSpidRdr_ATKA
                AnimationMode           = ONCE
                UseWeaponTiming            = Yes
            End
            Animation                   = AttackWithSwordB
                AnimationName           = MUSpidRdr_ATKC
                AnimationMode           = ONCE
                UseWeaponTiming            = Yes
            End
            BeginScript
                CurDrawableHideSubObject("arrrow")
            EndScript
        End

        AnimationState                    = SPECIAL_WEAPON_ONE
            StateName                    = Ready_Sword

            Animation                   = AttackWithSwordA
                AnimationName           = MUSpidRdr_ATKA
                AnimationMode           = ONCE
                UseWeaponTiming            = Yes
            End
            Animation                   = AttackWithSwordB
                AnimationName           = MUSpidRdr_ATKC
                AnimationMode           = ONCE
                UseWeaponTiming            = Yes
            End
            ParticleSysBone Sword01 SpiderRiderPoison FollowBone:Yes
            ParticleSysBone Sword01 SpiderRiderPoison2 FollowBone:Yes

            BeginScript
                CurDrawableHideSubObject("arrrow")
            EndScript
        End






        AnimationState                    = MOVING BACKING_UP WEAPONSET_TOGGLE_1
            StateName                    = STATE_BackingUp
            Animation                    = Bow
                AnimationName            = MUSpidRdr_BAKB
                AnimationMode            = LOOP
            End
            Animation                    = WantBow
                AnimationName            = MUSpidRdr_BAKA
                AnimationMode            = LOOP
            End
            Flags                        = MAINTAIN_FRAME_ACROSS_STATES4
            BeginScript
                CurDrawableShowSubObject("arrrow")
                PrevAnim    = CurDrawablePrevAnimation()
                PrevState    = CurDrawablePrevAnimationState()
                if PrevState == "STATE_BackingUp"
                then
                    if PrevAnim == "WantBow" or PrevAnim == "Sword"
                    then
                        return "WantBow"
                    end
                end

                return "Bow"
            EndScript
        End

        AnimationState                    = MOVING BACKING_UP
            StateName                    = STATE_BackingUp
            Animation                    = Sword
                AnimationName            = MUSpidRdr_BAKA
                AnimationMode            = LOOP
            End
            Animation                    = WantSword
                AnimationName            = MUSpidRdr_BAKB
                AnimationMode            = LOOP
            End
            Flags                        = MAINTAIN_FRAME_ACROSS_STATES4
            BeginScript
                CurDrawableHideSubObject("arrrow")
                PrevAnim    = CurDrawablePrevAnimation()
                PrevState    = CurDrawablePrevAnimationState()
                if PrevState == "STATE_BackingUp"
                then
                    if PrevAnim == "Bow" or PrevAnim == "WantSword"
                    then
                        return "WantSword"
                    end
                end

                return "Sword"
            EndScript
        End



        AnimationState                    = TURN_LEFT_HIGH_SPEED WEAPONSET_TOGGLE_1
            StateName                    = Moving_Bow
            SimilarRestart                = Yes
            Animation                   = run_s
                AnimationName           = MUSpidRdr_TNLBH
                AnimationMode           = LOOP
            End
        End

        AnimationState                    = TURN_LEFT_HIGH_SPEED
            StateName                    = Moving_Sword
            SimilarRestart                = Yes
            Animation                   = run_s
                AnimationName           = MUSpidRdr_TRNLH
                AnimationMode           = LOOP
            End
        End

        AnimationState                    = TURN_RIGHT_HIGH_SPEED  WEAPONSET_TOGGLE_1
            StateName                    = Moving_Bow
            SimilarRestart                = Yes
            Animation                   = run_s
                AnimationName           = MUSpidRdr_TNRBH
                AnimationMode           = LOOP
            End
        End

        AnimationState                    = TURN_RIGHT_HIGH_SPEED
            StateName                    = Moving_Sword
            SimilarRestart                = Yes
            Animation                   = run_s
                AnimationName           = MUSpidRdr_TRNRH
                AnimationMode           = LOOP
            End
        End

        AnimationState                    = TURN_LEFT  WEAPONSET_TOGGLE_1
            StateName                    = Moving_Bow
            SimilarRestart                = Yes
            Animation                   = run_s
                AnimationName           = MUSpidRdr_TNLBH
                AnimationMode           = LOOP
            End
        End

        AnimationState                    = TURN_LEFT
            StateName                    = Moving_Sword
            SimilarRestart                = Yes
            Animation                   = run_s
                AnimationName           = MUSpidRdr_TRNLH
                AnimationMode           = LOOP
            End
        End

        AnimationState                    = TURN_RIGHT WEAPONSET_TOGGLE_1
            StateName                    = Moving_Bow
            SimilarRestart                = Yes
            Animation                   = run_s
                AnimationName           = MUSpidRdr_TNRBH
                AnimationMode           = LOOP
            End
        End

        AnimationState                    = TURN_RIGHT
            StateName                    = Moving_Sword
            SimilarRestart                = Yes
            Animation                   = run_s
                AnimationName           = MUSpidRdr_TRNRH
                AnimationMode           = LOOP
            End
        End





        AnimationState                    = MOVING WEAPONSET_TOGGLE_1
            StateName                    = Moving_Bow
            SimilarRestart                = Yes
            Animation                   = run_b
                AnimationName           = MUSpidRdr_RUND
                AnimationMode           = LOOP
            End
            Animation                    = finishrun_s
                AnimationName           = MUSpidRdr_RUNC
                AnimationMode           = ONCE
                AnimationBlendTime        = 0
            End
            Animation                    = runtrans_sb
                AnimationName           = MUSpidRdr_RUNC
                AnimationMode           = ONCE
                AnimationBlendTime        = 0
            End
            Animation                    = runtrans_bs_finish
                AnimationName           = MUSpidRdr_RUNC
                AnimationMode           = ONCE
                AnimationBlendTime        = 0
            End
            Animation                    = runnoblend_b
                AnimationName           = MUSpidRdr_RUND
                AnimationMode           = LOOP
                AnimationBlendTime        = 0
            End
            Flags = MAINTAIN_FRAME_ACROSS_STATES RESTART_ANIM_WHEN_COMPLETE

            BeginScript
                CurDrawableShowSubObject("arrrow")
                PrevAnim    = CurDrawablePrevAnimation()
                PrevState    = CurDrawablePrevAnimationState()



                Prev = CurDrawablePrevAnimationState()
                if PrevState == "STATE_Climbing"
                then
                    CurDrawableSetTransitionAnimState("Trans_ClimbingToRunning")
                    return
                elseif PrevState == "STATE_Rappelling"
                then
                    CurDrawableSetTransitionAnimState("Trans_RappellingToRunning")
                    return
                elseif PrevState == "Moving_Sword"
                then
                    if PrevAnim == "runtrans_bs"
                    then
                        return "runtrans_bs_finish"
                    elseif PrevAnim == "finishrun_b"
                    then
                        return "runnoblend_b"
                    else
                        return "finishrun_s"
                    end
                elseif PrevAnim == "finishrun_s" or PrevAnim == "runtrans_bs_finish" or PrevAnim == "WantBow"
                then
                    return "runtrans_sb"
                elseif PrevAnim == "runtrans_sb" or PrevAnim == "run_b" or PrevAnim == "runnoblend_b"
                then
                    return "runnoblend_b"
                else
                    return "run_b"
                end
            EndScript
        End

        AnimationState                    = MOVING
            StateName                    = Moving_Sword
            SimilarRestart                = Yes
            Animation                   = run_s
                AnimationName           = MUSpidRdr_RUNC
                AnimationMode           = LOOP
            End
            Animation                    = finishrun_b
                AnimationName           = MUSpidRdr_RUND
                AnimationMode           = ONCE
                AnimationBlendTime        = 0
            End
            Animation                    = runtrans_bs
                AnimationName           = MUSpidRdr_RUND
                AnimationMode           = ONCE
                AnimationBlendTime        = 0
            End
            Animation                    = runtrans_sb_finish
                AnimationName           = MUSpidRdr_RUND
                AnimationMode           = ONCE
                AnimationBlendTime        = 0
            End
            Animation                    = runnoblend_s
                AnimationName           = MUSpidRdr_RUNC
                AnimationMode           = LOOP
                AnimationBlendTime        = 0
            End
            Flags = MAINTAIN_FRAME_ACROSS_STATES RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                PrevAnim    = CurDrawablePrevAnimation()
                PrevState    = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("arrrow")

                if PrevState == "Moving_Bow"
                then
                    if PrevAnim == "runtrans_sb"
                    then
                        return "runtrans_sb_finish"
                    elseif PrevAnim == "finishrun_s"
                    then
                        return "runnoblend_s"
                    else
                        return "finishrun_b"
                    end
                elseif PrevAnim == "finishrun_b" or PrevAnim == "runtrans_sb_finish" or PrevAnim == "WantSword"
                then
                    return "runtrans_bs"
                elseif PrevAnim == "runtrans_bs" or PrevAnim == "run_s" or PrevAnim == "runnoblend_s"
                then
                    return "runnoblend_s"
                else
                    return "run_s"
                end
            EndScript
        End




        AnimationState                    = CONTINUOUS_FIRE_MEAN
            Animation                    = HangFrameWhileCoasting
                AnimationName            = MUSpidRdr_ATKB
                AnimationMode            = LOOP
                AnimationBlendTime        = 0
            End
            Flags                        = START_FRAME_LAST

            BeginScript
                CurDrawableShowSubObject("arrrow")
                if CurDrawablePrevAnimationState() == "STATE_Firing" then CurDrawableAllowToContinue() end
            EndScript
        End

        AnimationState                    = CONTINUOUS_FIRE_SLOW
            StateName                    = Ready_Bow
            Animation                    = PutAwayArrow
                AnimationName            = MUSpidRdr_ATKB
                AnimationMode            = ONCE
            End

            BeginScript
                CurDrawableShowSubObject("arrrow")
            EndScript
        End



        AnimationState                    = ATTACKING WEAPONSET_TOGGLE_1
            StateName                    = Ready_Bow

            Animation                    = IDLB
                AnimationName            = MUSpidRdr_IDLB
                AnimationMode            = LOOP
            End

            BeginScript
                CurDrawableShowSubObject("arrrow")
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                if Prev == "Selected_Sword" or Prev == "Moving_Sword" or Prev == "Ready_Sword" or Prev == "Bored_Sword" or PrevAnim == "WantBow"
                then
                    CurDrawableSetTransitionAnimState("TRANS_SwordToBow_Ready")
                end
            EndScript
        End



        AnimationState                    = EMOTION_UNCONTROLLABLY_AFRAID  WEAPONSET_TOGGLE_1
            StateName                    = STATE_Emotion_Bow
            Animation                    = Bow
                AnimationName            = MUSpidRdr_FERB
                AnimationMode            = ONCE
                AnimationBlendTime        = 15
            End
            Animation                    = Bow2
                AnimationName            = MUSpidRdr_FERB
                AnimationMode            = ONCE
                AnimationBlendTime        = 15
            End
            Flags                        = MAINTAIN_FRAME_ACROSS_STATES RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                CurDrawableShowSubObject("arrrow")

                if PrevState == "STATE_Emotion_Sword"
                then
                    CurDrawableAllowToContinue()
                    if( CurDrawablePrevAnimFraction() > .89 )
                    then
                        CurDrawableSetTransitionAnimState("TRANS_SwordToBow_Ready")
                    end
                end
            EndScript
        End
            AnimationState                    = EMOTION_UNCONTROLLABLY_AFRAID
            StateName                    = STATE_Emotion_Sword
            Animation                    = Sword
                AnimationName            = MUSpidRdr_FERA
                AnimationMode            = ONCE
            End
            Animation                    = Sword2
                AnimationName            = MUSpidRdr_FERB
                AnimationMode            = ONCE
            End
            Flags                        = MAINTAIN_FRAME_ACROSS_STATES RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("arrrow")

                if PrevState == "STATE_Emotion_Bow"
                then
                    CurDrawableAllowToContinue()
                    if( CurDrawablePrevAnimFraction() > .89 )
                    then
                        CurDrawableSetTransitionAnimState("TRANS_BowToSword_Ready")
                    end
                end
            EndScript
        End




        AnimationState                    = EMOTION_ALERT WEAPONSET_TOGGLE_1
            StateName                    = Ready_Bow

            Animation                    = Alert_1
                AnimationName            = MUSpidRdr_IDLB
                AnimationMode            = LOOP
            End

            BeginScript
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("arrrow")
                if Prev == "Selected_Sword" or Prev == "Moving_Sword" or Prev == "Ready_Sword" or Prev == "Bored_Sword" or PrevAnim == "WantBow"
                then
                    CurDrawableSetTransitionAnimState("TRANS_SwordToBow_Ready")
                end
            EndScript
        End
        AnimationState                    = ENGAGED WEAPONSET_TOGGLE_1
            StateName                    = Ready_Bow

            Animation                    = Alert_1
                AnimationName            = MUSpidRdr_IDLB
                AnimationMode            = LOOP
            End

            BeginScript
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("arrrow")
                if Prev == "Selected_Sword" or Prev == "Moving_Sword" or Prev == "Ready_Sword" or Prev == "Bored_Sword" or PrevAnim == "WantBow"
                then
                    CurDrawableSetTransitionAnimState("TRANS_SwordToBow_Ready")
                end
            EndScript
        End

        AnimationState                    = EMOTION_ALERT
            StateName                    = Ready_Sword

            Animation                    = Alert_1
                AnimationName            = MUSpidRdr_IDLA
                AnimationMode            = LOOP
            End

            BeginScript
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("arrrow")
                if Prev == "Selected_Bow" or Prev == "Moving_Bow" or Prev == "Ready_Bow" or Prev == "Bored_Bow" or PrevAnim == "WantSword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BowToSword_Ready")
                end
            EndScript
        End
        AnimationState                    = ENGAGED
            StateName                    = Ready_Sword

            Animation                    = Alert_1
                AnimationName            = MUSpidRdr_IDLA
                AnimationMode            = LOOP
            End

            BeginScript
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("arrrow")
                if Prev == "Selected_Bow" or Prev == "Moving_Bow" or Prev == "Ready_Bow" or Prev == "Bored_Bow" or PrevAnim == "WantSword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BowToSword_Ready")
                end
            EndScript
        End




        AnimationState                    = EMOTION_AFRAID  WEAPONSET_TOGGLE_1
            StateName                    = STATE_Emotion_Bow
            Animation                    = Bow
                AnimationName            = MUSpidRdr_FERB
                AnimationMode            = ONCE
                AnimationBlendTime        = 15
            End
            Animation                    = Bow2
                AnimationName            = MUSpidRdr_FERB
                AnimationMode            = ONCE
                AnimationBlendTime        = 15
            End
            Flags                        = MAINTAIN_FRAME_ACROSS_STATES RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                CurDrawableShowSubObject("arrrow")

                if PrevState == "STATE_Emotion_Sword"
                then
                    CurDrawableAllowToContinue()
                    if( CurDrawablePrevAnimFraction() > .89 )
                    then
                        CurDrawableSetTransitionAnimState("TRANS_SwordToBow_Ready")
                    end
                end
            EndScript
        End

        AnimationState                    = EMOTION_AFRAID
            StateName                    = STATE_Emotion_Sword
            Animation                    = Sword
                AnimationName            = MUSpidRdr_FERA
                AnimationMode            = ONCE
            End
            Animation                    = Sword2
                AnimationName            = MUSpidRdr_FERA
                AnimationMode            = ONCE
            End
            Flags                        = MAINTAIN_FRAME_ACROSS_STATES RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("arrrow")

                if PrevState == "STATE_Emotion_Bow"
                then
                    CurDrawableAllowToContinue()
                    if( CurDrawablePrevAnimFraction() > .89 )
                    then
                        CurDrawableSetTransitionAnimState("TRANS_BowToSword_Ready")
                    end
                end
            EndScript
        End

        AnimationState                    = EMOTION_POINTING WEAPONSET_TOGGLE_1
            StateName                    = STATE_Emotion_Bow
            Animation                    = Bow
                AnimationName            = MUSpidRdr_PNTB
                AnimationMode            = ONCE
            End
            Animation                    = Bow2
                AnimationName            = MUSpidRdr_PNTB
                AnimationMode            = ONCE
            End
            Flags                        = MAINTAIN_FRAME_ACROSS_STATES RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                CurDrawableShowSubObject("arrrow")

                if PrevState == "STATE_Emotion_Sword"
                then
                    CurDrawableAllowToContinue()
                    if( CurDrawablePrevAnimFraction() > .89 )
                    then
                        CurDrawableSetTransitionAnimState("TRANS_SwordToBow_Ready")
                    end
                elseif PrevState == "STATE_Emotion_Bow"
                then
                    CurDrawableAllowToContinue()
                end
            EndScript
        End

        AnimationState                    = EMOTION_POINTING
            StateName                    = STATE_Emotion_Sword
            Animation                    = Sword
                AnimationName            = MUSpidRdr_PNTA
                AnimationMode            = ONCE
            End
            Animation                    = Sword2
                AnimationName            = MUSpidRdr_PNTA
                AnimationMode            = ONCE
            End
            Flags                        = MAINTAIN_FRAME_ACROSS_STATES RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("arrrow")

                if PrevState == "STATE_Emotion_Bow"
                then
                    CurDrawableAllowToContinue()
                    if( CurDrawablePrevAnimFraction() > .89 )
                    then
                        CurDrawableSetTransitionAnimState("TRANS_BowToSword_Ready")
                    end
                elseif PrevState == "STATE_Emotion_Sword"
                then
                    CurDrawableAllowToContinue()
                end
            EndScript
        End


        AnimationState                    = ATTACKING
            StateName                    = Ready_Sword

            Animation                    = Alert_1
                AnimationName            = MUSpidRdr_IDLA
                AnimationMode            = LOOP
            End

            BeginScript
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("arrrow")
                if Prev == "Selected_Bow" or Prev == "Moving_Bow" or Prev == "Ready_Bow" or Prev == "Bored_Bow" or PrevAnim == "WantSword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BowToSword_Ready")
                end
            EndScript
        End



        AnimationState                =    SELECTED  WEAPONSET_TOGGLE_1
            StateName               =    Selected_Bow

            Animation                =    ATNE
                AnimationName        =    MUSpidRdr_ATNF
                AnimationMode        =    LOOP
            End

            BeginScript
                CurDrawableShowSubObject("arrrow")
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Emotion_Bow" or Prev == "STATE_Emotion_Sword" then CurDrawableAllowToContinue() end
                if Prev == "Bored_Bow" then CurDrawableSetTransitionAnimState("TRANS_BS_Bow")                end
                if Prev == "Selected_Sword" or Prev == "Moving_Sword" or Prev == "Ready_Sword" or Prev == "Bored_Sword" or PrevAnim == "WantBow"
                then
                    CurDrawableSetTransitionAnimState("TRANS_SwordToBow_Selected")
                end
            EndScript
        End

        AnimationState                    = RAISING_FLAG WEAPONSET_TOGGLE_1
            StateName                    = STATE_Emotion_Bow
            Animation                    = Bow
                AnimationName            = MUSpidRdr_CHRA
                AnimationMode            = ONCE
            End
            Flags                        = MAINTAIN_FRAME_ACROSS_STATES RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                CurDrawableShowSubObject("arrrow")

                if PrevState == "STATE_Emotion_Sword"
                then
                    CurDrawableAllowToContinue()
                    if( CurDrawablePrevAnimFraction() > .89 )
                    then
                        CurDrawableSetTransitionAnimState("TRANS_SwordToBow_Ready")
                    end
                elseif PrevState == "STATE_Emotion_Bow"
                then
                    CurDrawableAllowToContinue()
                end
            EndScript
        End

        AnimationState                    = RAISING_FLAG
            StateName                    = STATE_Emotion_Sword
            Animation                    = Sword
                AnimationName            = MUSpidRdr_CHRB
                AnimationMode            = ONCE
            End
            Flags                        = MAINTAIN_FRAME_ACROSS_STATES RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("arrrow")

                if PrevState == "STATE_Emotion_Bow"
                then
                    CurDrawableAllowToContinue()
                    if( CurDrawablePrevAnimFraction() > .89 )
                    then
                        CurDrawableSetTransitionAnimState("TRANS_BowToSword_Ready")
                    end
                elseif PrevState == "STATE_Emotion_Sword"
                then
                    CurDrawableAllowToContinue()
                end
            EndScript
        End

        AnimationState                =    SELECTED
            StateName                =    Selected_Sword

            Animation                =    ATNA
                AnimationName        =    MUSpidRdr_ATNB
                AnimationMode        =    LOOP
            End

            BeginScript
                CurDrawableHideSubObject("arrrow")

                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                if Prev == "STATE_Emotion_Bow" or Prev == "STATE_Emotion_Sword" then CurDrawableAllowToContinue() end
                if Prev == "Bored_Sword"        then CurDrawableSetTransitionAnimState("TRANS_BS_Sword")        end
                if Prev == "Selected_Bow" or Prev == "Moving_Bow" or Prev == "Ready_Bow" or Prev == "Bored_Bow" or PrevAnim == "WantSword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BowToSword_Selected")
                end

            EndScript
        End




        AnimationState                         = HIT_REACTION HIT_LEVEL_1 WEAPONSET_TOGGLE_1
            StateName                        = Bored_Bow
            Animation                         = Hit_Level_1_a
                AnimationName                = MUSpidRdr_HITB
                AnimationMode                 = ONCE
            End
        End

        AnimationState                        = HIT_REACTION HIT_LEVEL_1
            StateName                        = Bored_Sword
            Animation                        = Hit_Level_1_a
                AnimationName                = MUSpidRdr_HITA
                AnimationMode                = ONCE
            End
        End



        AnimationState                    = EMOTION_TAUNTING WEAPONSET_TOGGLE_1
            StateName                    = STATE_Emotion_Bow
            Animation                    = Bow
                AnimationName            = MUSpidRdr_TNTB
                AnimationMode            = ONCE
            End
            Flags                        = MAINTAIN_FRAME_ACROSS_STATES RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                CurDrawableShowSubObject("arrrow")

                if PrevState == "STATE_Emotion_Sword"
                then
                    CurDrawableAllowToContinue()
                    if( CurDrawablePrevAnimFraction() > .89 )
                    then
                        CurDrawableSetTransitionAnimState("TRANS_SwordToBow_Ready")
                    end
                elseif PrevState == "STATE_Emotion_Bow"
                then
                    CurDrawableAllowToContinue()
                end
            EndScript
        End

        AnimationState                    = EMOTION_TAUNTING
            StateName                    = STATE_Emotion_Sword
            Animation                    = Sword
                AnimationName            = MUSpidRdr_TNTA
                AnimationMode            = ONCE
            End
            Flags                        = MAINTAIN_FRAME_ACROSS_STATES RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("arrrow")

                if PrevState == "STATE_Emotion_Bow"
                then
                    CurDrawableAllowToContinue()
                    if( CurDrawablePrevAnimFraction() > .89 )
                    then
                        CurDrawableSetTransitionAnimState("TRANS_BowToSword_Ready")
                    end
                elseif PrevState == "STATE_Emotion_Sword"
                then
                    CurDrawableAllowToContinue()
                end
            EndScript
        End



        AnimationState                    = EMOTION_CELEBRATING WEAPONSET_TOGGLE_1
            StateName                    = STATE_Emotion_Bow
            Animation                    = Bow
                AnimationName            = MUSpidRdr_CHRA
                AnimationMode            = ONCE
            End
            Flags                        = MAINTAIN_FRAME_ACROSS_STATES RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                CurDrawableShowSubObject("arrrow")

                if PrevState == "STATE_Emotion_Sword"
                then
                    CurDrawableAllowToContinue()
                    if( CurDrawablePrevAnimFraction() > .89 )
                    then
                        CurDrawableSetTransitionAnimState("TRANS_SwordToBow_Ready")
                    end
                elseif PrevState == "STATE_Emotion_Bow"
                then
                    CurDrawableAllowToContinue()
                end
            EndScript
        End

        AnimationState                    = EMOTION_CELEBRATING
            StateName                    = STATE_Emotion_Sword
            Animation                    = Sword
                AnimationName            = MUSpidRdr_CHRB
                AnimationMode            = ONCE
            End
            Flags                        = MAINTAIN_FRAME_ACROSS_STATES RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                PrevState = CurDrawablePrevAnimationState()
                CurDrawableHideSubObject("arrrow")

                if PrevState == "STATE_Emotion_Bow"
                then
                    CurDrawableAllowToContinue()
                    if( CurDrawablePrevAnimFraction() > .89 )
                    then
                        CurDrawableSetTransitionAnimState("TRANS_BowToSword_Ready")
                    end
                elseif PrevState == "STATE_Emotion_Sword"
                then
                    CurDrawableAllowToContinue()
                end
            EndScript
        End



        IdleAnimationState
            StateName                    = Bored_Sword

            Animation                   = Idle_Sword1
                AnimationName           = MUSpidRdr_IDLA
                AnimationMode           = ONCE
            End
            Animation                   = Idle_Sword2
                AnimationName           = MUSpidRdr_IDLA
                AnimationMode           = ONCE
            End
            Animation                   = Idle_Sword3
                AnimationName           = MUSpidRdr_IDLA
                AnimationMode           = ONCE
            End
            Animation                    = IdleNoFidget
                AnimationName            = MUSpidRdr_IDLA
                AnimationMode            = ONCE
                AnimationPriority        = 20
            End
            Animation                    = IdleNoFidget2
                AnimationName            = MUSpidRdr_IDLA
                AnimationMode            = ONCE
                AnimationPriority        = 0
            End
            Flags                        = RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                CurDrawableHideSubObject("arrrow")

                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                if Prev == "TRANS_SB_Sword"        then return "IdleNoFidget" end
                if Prev == "Selected_Sword"        then CurDrawableSetTransitionAnimState("TRANS_SB_Sword")        end
                if Prev == "Selected_Bow" or Prev == "Moving_Bow" or Prev == "Ready_Bow" or Prev == "Bored_Bow" or PrevAnim == "WantSword"
                then
                    CurDrawableSetTransitionAnimState("TRANS_BowToSword_Selected")
                end
            EndScript
        End

        AnimationState                    = WEAPONSET_TOGGLE_1
            StateName                    = Bored_Bow

            Animation                    = IdleBowB
                AnimationName            = MUSpidRdr_IDLB
                AnimationMode            = ONCE
            End
            Animation                    = IdleBowD
                AnimationName            = MUSpidRdr_IDLB
                AnimationMode            = ONCE
            End
            Animation                    = IdleNoFidget
                AnimationName            = MUSpidRdr_IDLB
                AnimationMode            = ONCE
                AnimationPriority        = 20
            End
            Animation                    = IdleNoFidget2
                AnimationName            = MUSpidRdr_IDLB
                AnimationMode            = ONCE
                AnimationPriority        = 10
            End
            Flags                        = RESTART_ANIM_WHEN_COMPLETE
            BeginScript
                CurDrawableShowSubObject("arrrow")
                PrevAnim = CurDrawablePrevAnimation()
                Prev = CurDrawablePrevAnimationState()
                if Prev == "TRANS_SB_Bow" then return "IdleNoFidget" end
                if Prev == "Selected_Bow"        then CurDrawableSetTransitionAnimState("TRANS_SB_Bow")        end
                if Prev == "Selected_Sword" or Prev == "Moving_Sword" or Prev == "Ready_Sword" or Prev == "Bored_Sword" or PrevAnim == "WantBow"
                then
                    CurDrawableSetTransitionAnimState("TRANS_SwordToBow_Selected")
                end
            EndScript
        End




        TransitionState                   = TRANS_BS_Bow
            Animation                   = ATND
                AnimationName             = MUSpidRdr_ATNG
                AnimationMode             = ONCE_BACKWARDS
                AnimationBlendTime        = 10
            End
            Flags                        = START_FRAME_LAST
        End

        TransitionState                   = TRANS_SB_Bow
            Animation                   = ATND
                AnimationName             = MUSpidRdr_ATNG
                AnimationMode             = ONCE
            End
        End



        TransitionState                   = TRANS_BS_Sword
            Animation
                AnimationName             = MUSpidRdr_ATNC
                AnimationMode             = ONCE_BACKWARDS
            End
            Flags                        = START_FRAME_LAST
        End

        TransitionState                   = TRANS_SB_Sword
            Animation                   = ATNA
                AnimationName             = MUSpidRdr_ATNC
                AnimationMode             = ONCE
            End
        End



        TransitionState                   = TRANS_BowToSword_Ready
            Animation                   = DrawSwords
                AnimationName           = MUSpidRdr_TGLB
                AnimationMode           = ONCE
            End
        End

        TransitionState                   = TRANS_SwordToBow_Ready
            Animation                   = DrawBow
                AnimationName           = MUSpidRdr_TGLA
                AnimationMode           = ONCE
            End
        End

        TransitionState                   = TRANS_BowToSword_Selected
            Animation                   = DrawSwords
                AnimationName           = MUSpidRdr_TGLB
                AnimationMode           = ONCE
            End
        End

        TransitionState                   = TRANS_SwordToBow_Selected
            Animation                   = DrawBow
                AnimationName           = MUSpidRdr_TGLA
                AnimationMode           = ONCE
            End
        End
    End


    Draw = W3DScriptedModelDraw Icon
        ModelConditionState = NONE
            Model           = bbox
        End
    End


    Draw = W3DScriptedModelDraw DustEffects
        DefaultModelConditionState
          Model = None
        End
        IdleAnimationState
        End
        AnimationState = MOUNTED MOVING WADING
            ParticleSysBone = None FootstepSlash
        End
        AnimationState = MOUNTED MOVING ACCELERATE
            ParticleSysBone = None GenericSiegeTrailDust
        End
        AnimationState = MOUNTED MOVING ACCELERATE
            ParticleSysBone = None GenericSiegeTrailDust
        End
        AnimationState = DISGUISED MOUNTED MOVING ACCELERATE
            ParticleSysBone = None GenericSiegeTrailDust
        End
        AnimationState = DISGUISED MOUNTED MOVING DECELERATE
            ParticleSysBone = None GenericSiegeTrailDust
        End
        AnimationState = MOUNTED MOVING
        End
        AnimationState = DISGUISED MOUNTED MOVING
        End
    End

    #include "..\..\..\includes\StunDrawModuleSmall.inc"


    Side = Wild
    Scale = 0.95
    EditorSorting = UNIT
    ThreatLevel = GOBLIN_KING_THREAT_LEVEL
    ThingClass = CHARACTER_UNIT
    TransportSlotCount = TRANSPORTSLOTCOUNT_HERO
    BuildCost           = GORKILDAG_COST
    BuildTime           = MEDIUM_HERO_BUILDTIME
    ShockwaveResistance = SHOCKWAVE_RESISTANCE_STRONG
    BountyValue         = WILD_GOBLIN_KING_BOUNTY_VALUE
    MaxSimultaneousOfType = 1
    DisplayMeleeDamage = GORKILDAG_DAMAGE
    DisplayRangedDamage = GORKILDAG_DAMAGE


    WeaponSet
        Conditions         = None
        Weapon             = PRIMARY        GoblinKingBladeHero
        AutoChooseSources  = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End

    WeaponSet
        Conditions         = WEAPONSET_TOGGLE_1
        Weapon             = PRIMARY        WildGoblinKingBow
        AutoChooseSources  = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End



    ArmorSet
        Conditions      = None
        Armor           = MediumHeroArmorMounted
        DamageFX        = NormalDamageFX
    End


    VisionRange = 250
    ShroudClearingRange = 340

    MaxVisionBonusPercent = 300%
    VisionBonusTestRadius = 200
    VisionBonusPercentPerFoot = 1.0%

    DisplayName = OBJECT:WildGoblinKing
    RecruitText = CONTROLBAR:WildGoblinKingRecruit
    ReviveText    = CONTROLBAR:WildGoblinKingReviveNew
    Hotkey        = CONTROLBAR:WildGoblinKingHotkey
    CrusherLevel = 1
    MountedCrusherLevel = 1
    CrushableLevel = 2
    MountedCrushableLevel = 2

    CrushWeapon        = HeroCrush

    MinCrushVelocityPercent     = MINCRUSHVELOCITYPERCENT_HERO
    CrushDecelerationPercent    = CRUSHDECELERATIONPERCENT_HERO

    CrushKnockback = 40
    CrushZFactor = 1.0

    CommandSet = MountedWildGoblinKingCommandSetMod
    CommandPoints = 0



    AutoResolveUnitType = AutoResolveUnit_Hero
    AutoResolveCombatChain = AutoResolve_HeroCombatChain

    AutoResolveBody = AutoResolve_GoblinKingBody

    AutoResolveArmor
        Armor = AutoResolve_GoblinKingArmor
    End

    AutoResolveWeapon
        Weapon = AutoResolve_GoblinKingWeapon
    End

    AutoResolveLeadership = AutoResolve_GoblinKingBonus



    VoiceAttack                                = GoblinKingVoiceAttack
    VoiceAttackCharge                        = GoblinKingVoiceAttackCharge
    VoiceAttackMachine                        = GoblinKingVoiceAttack
    VoiceAttackStructure                    = GoblinKingVoiceAttackBuilding
    VoiceFear                                = GoblinKingVoiceHelpMe
    VoiceGuard                                = GoblinKingVoiceMove
    VoiceMove                                = GoblinKingVoiceMove
    VoiceMoveOverWalls                        = GoblinKingVoiceMove
    VoiceMoveToCamp                            = GoblinKingVoiceMoveCamp
    VoiceMoveWhileAttacking                    = GoblinKingVoiceDisengage
    VoicePriority                            = 85
    VoiceRetreatToCastle                    = GoblinKingVoiceRetreat
    VoiceSelect                                = GoblinKingVoiceSelectMS
    VoiceSelectBattle                         = GoblinKingVoiceSelectBattle

    SoundImpact                                = ImpactHorse
    SoundAmbient                            = WildSpiderRiderAmbientLoopMS

    UnitSpecificSounds
        VoiceEnterUnitEvilMenTransportShip    = GoblinKingVoiceMoveShip
        VoiceEnterUnitMordorMumakil            = GoblinKingVoiceMoveGarrison
        VoiceEnterUnitSlaughterHouse        = GoblinKingVoiceMoveGarrison
        VoiceGarrison                        = GoblinKingVoiceMoveGarrison
        VoiceInitiateCaptureBuilding        = GoblinKingVoiceCaptureBuilding
    End

    CrowdResponseKey = Goblin

    #include "..\..\..\includes\StandardUnitEvaEvents.inc"
    EvaEventDieOwner        = GoblinKingDie

    Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
        Key = Goblin Hero
    End

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound:WeaponSwitchToSpearSpiderRiderMS    Animation:MUSpidRdr_SKL.MUSpidRdr_TGLB    Frames:1
        AnimationSound = Sound:WeaponSwitchToBowSpiderRiderMS    Animation:MUSpidRdr_SKL.MUSpidRdr_TGLA    Frames:1
        AnimationSound = Sound:BodyFallOrc                        Animation:MUSPIDRDR_SKL.MUSPIDRDR_DIEA    Frames:29
        AnimationSound = Sound:BodyFallOrc                        Animation:MUSPIDRDR_SKL.MUSPIDRDR_DIEB    Frames:29
        AnimationSound = Sound:BodyFallOrc                        Animation:MUSPIDRDR_SKL.MUSPIDRDR_DIEC    Frames:25
        AnimationSound = Sound:BodyFallOrc                        Animation:MUSPIDRDR_SKL.MUSPIDRDR_DIED    Frames:25
        AnimationSound = Sound:BodyFallOrc                        Animation:MUSPIDRDR_SKL.MUSPIDRDR_LNDA    Frames:7
        AnimationSound = Sound:BodyFallOrc                        Animation:MUSPIDRDR_SKL.MUSPIDRDR_LNDB    Frames:7
    End



    Behavior = EmotionTrackerUpdate    Module_EmotionTracker
        TauntAndPointDistance               = 200
        TauntAndPointUpdateDelay            = 10000
        PointAt                             = ANY +HERO
        AddEmotion            =    Doom_Base
        AddEmotion            =    Point_Base
        AddEmotion            =    Taunt_Base
        AddEmotion            =    CheerIdle_Base
        AddEmotion            =    CheerBusy_Base
        AddEmotion            =    Alert_Base
        AddEmotion            =    CheerForAboutToCrush_Base
    End

    RadarPriority = UNIT
    KindOf = HERO PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY ATTACK_NEEDS_LINE_OF_SIGHT PATH_THROUGH_EACH_OTHER SCORE ARMY_SUMMARY HEAVY_MELEE_HITTER CAN_CLIMB_WALLS
    PathfindDiameter = 40.0

    Body = RespawnBody ModuleTag_RespawnBody
        MaxHealth         		= GORKILDAG_HEALTH
        PermanentlyKilledByFilter       = NONE
        DodgePercent      		= HERO_DODGE_PERCENT
    End

    Behavior = RespawnUpdate ModuleTag_RespawnUpdate
        DeathAnim                     = DYING
        DeathAnimationTime            = 6500
        RespawnAnim                   = LEVELED
        RespawnAnimationTime          = 2000
        AutoRespawnAtObjectFilter     = NONE +CASTLE_KEEP
        ButtonImage                   = HIGoblinKingnew
        RespawnAsTemplate             = WildGoblinKing_mod

        RespawnRules =    AutoSpawn:No           Cost:GORKILDAG_COST       Time:MEDIUM_HERO_RESPAWNTIME        Health:100%
    End

    Behavior = AutoHealBehavior ModuleTag_GoblinKingHealing
        StartsActive = Yes
        HealingAmount = HERO_HEAL_AMOUNT
        HealingDelay = 1000
        StartHealingDelay = HERO_HEAL_DELAY
        HealOnlyIfNotInCombat = Yes
    End




    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_GoblinKingPoisonedStinger
        SpecialPowerTemplate = SpecialAbilityGoblinKingPoisonedStinger
        TriggeredBy = Upgrade_Level_4
       ObeyRechageOnTrigger       = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_GoblinKingPoisonedStingerStarter
        SpecialPowerTemplate      = SpecialAbilityGoblinKingPoisonedStinger
        UpdateModuleStartsAttack  = Yes
        StartsPaused = Yes
        InitiateSound = GoblinKingVoiceAttackStinger
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_GoblinKingPoisonedStingerUpdate
        SpecialPowerTemplate    = SpecialAbilityGoblinKingPoisonedStinger
        SkipContinue            = Yes
        UnpackTime              = 250
        PreparationTime         = 1
        PersistentPrepTime      = 500
        PackTime                = 100
        MustFinishAbility       = Yes
        AwardXPForTriggering    = 0
        StartAbilityRange       = 15.0
        SpecialWeapon           = WildGoblinKingPoisonedStingerMod
        WhichSpecialWeapon      = 1
    End

    Behavior = AutoAbilityBehavior ModuleTag_AutoAbilityBehavior3
	SpecialAbility  = SpecialAbilityGoblinKingPoisonedStinger
	ForbiddenStatus = INSIDE_GARRISON
	Query           = 1 AFFECTED_BY_POISON_OBJECTFILTER -MordorFellBeast -MordorFellBeastInterface -GondorGwaihir -GondorGwaihir_Summoned -ElvenFortressEagle -Drogoth ENEMIES
	MaxScanRange    = 100
    End




    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_GoblinKingPoisonedStinger2
       SpecialPowerTemplate 	= SpecialAbilityGoblinKingPoisonedStinger2
       TriggeredBy 		= Upgrade_Level_4
       ObeyRechageOnTrigger     = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_GoblinKingPoisonedStingerStarter2
        SpecialPowerTemplate      = SpecialAbilityGoblinKingPoisonedStinger2
        UpdateModuleStartsAttack  = Yes
        StartsPaused = Yes
        InitiateSound = GoblinKingVoiceAttackStinger
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_GoblinKingPoisonedStingerUpdate2
        SpecialPowerTemplate    = SpecialAbilityGoblinKingPoisonedStinger2
        SkipContinue            = Yes
        UnpackTime              = 250
        PreparationTime         = 1
        PersistentPrepTime      = 500
        PackTime                = 100
        MustFinishAbility       = Yes
        AwardXPForTriggering    = 0
        StartAbilityRange       = 15.0
        SpecialWeapon           = WildGoblinKingPoisonedStingerMod2
        WhichSpecialWeapon      = 1
    End

    Behavior = AutoAbilityBehavior ModuleTag_AutoAbilityBehavior4
	SpecialAbility  = SpecialAbilityGoblinKingPoisonedStinger2
	ForbiddenStatus = INSIDE_GARRISON
	Query           = 1 AFFECTED_BY_POISON_OBJECTFILTER -MordorFellBeast -MordorFellBeastInterface -GondorGwaihir -GondorGwaihir_Summoned -ElvenFortressEagle -Drogoth ENEMIES
	MaxScanRange    = 100
    End

    Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = Hero
    End



    #include "..\..\..\includes\CaptureBuilding.inc"

  Behavior = AIUpdateInterface ModuleTag_03
    AutoAcquireEnemiesWhenIdle     = Yes ATTACK_BUILDINGS
    MoodAttackCheckRate            = 500
    AttackPriority                 = AttackPriority_Cavalry
    BurningDeathTime               = BURNINGDEATH_DURATION_CAVALRY
    AILuaEventsList                = WildSpiderFunctions
  End

    LocomotorSet
        Locomotor = NormalHorseHordeMemberLocomotor
        Condition = SET_NORMAL
        Speed     = NORMAL_MOUNTED_MED_MEMBER_SPEED
    End

    Behavior = PhysicsBehavior ModuleTag_04
        GravityMult = 1.0
        ShockStandingTime = 4500
    End

    Behavior = SlowDeathBehavior ModuleTag_05
        DeathTypes = ALL
        SinkDelay = 3000
        SinkRate = 1.40
        DestructionDelay = 8000
        Sound = INITIAL GoblinKingVoiceDie
    End

    Behavior = SquishCollide ModuleTag_06

    End

    Behavior = NotifyTargetsOfImminentProbableCrushingUpdate ModuleTag_NotifyCrushScan
    End

    Behavior = HitReactionBehavior HitReactionBehaviorModuleTag
        HitReactionLifeTimer1 = 1800
        HitReactionThreshold1 = 5.0
        FastHitsResetReaction = No
    End





    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_ScorpionToggleEnabler
        SpecialPowerTemplate = SpecialAbilityToggleMounted
        TriggeredBy = Upgrade_Level_1
    End

    Behavior = SpecialPowerModule ModuleTag_HorseToggleStarter
         SpecialPowerTemplate        = SpecialAbilityToggleMounted
         UpdateModuleStartsAttack    = Yes
         StartsPaused                = Yes
    End

    Behavior = ToggleMountedSpecialAbilityUpdate ModuleTag_HorseToggle
         SpecialPowerTemplate    = SpecialAbilityToggleMounted
         MountedTemplate            = WildGoblinKing_mod
         SynchronizeTimerOnSpecialPower = SpecialAbilityGoblinKingPoisonedStinger SpecialAbilityGoblinKingPoisonedStinger2 SpecialAbilitySkullTotem SpecialAbilitySkullTotemKing SpecialAbilityCallFromTheDeep SpecialAbilityGorkilGloriousCharge SpecialAbilityZuchtspinnenSummon SpecialAbilityZuchtspinnenSummon2 SpecialAbilityBuhrdurOilFire SpecialAbilityBuhrdurIgniteOil SpecialAbilityTheodenGloriousCharge SpecialAbilitySkullTotemKing2
         UnpackTime              = GOOD_MOUNT_TIME
         PreparationTime         = 0
         PackTime                = GOOD_MOUNT_TIME
         OpacityTarget            = .3
         AwardXPForTriggering    = 0
         IgnoreFacingCheck        = Yes
    End






    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_SkullTotemEnabler
        SpecialPowerTemplate    = SpecialAbilitySkullTotem
        TriggeredBy                = Upgrade_Level_2
       ObeyRechageOnTrigger       = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_SkullTotemStarter
         SpecialPowerTemplate        = SpecialAbilitySkullTotem
         UpdateModuleStartsAttack    = Yes
         StartsPaused            = Yes
        InitiateSound            = GoblinKingVoiceSkullTotem
        OnTriggerRechargeSpecialPower    = SpecialAbilityMountedSkullTotem
     End

    Behavior = ActivateModuleSpecialPower ModuleTag_SkullTotemUpdate
         SpecialPowerTemplate    = SpecialAbilitySkullTotem
        StartAbilityRange        = 25
        MustFinishAbility        = Yes
         UnpackTime              = 800
         PackTime                = 1200
         UnpackingVariation        = 1
        TriggerSpecialPower        = ModuleTag_SkullTotemPower2 OBJECTPOS
    End

    Behavior = OCLSpecialPower ModuleTag_SkullTotemPower2
        SpecialPowerTemplate    = SpecialAbilitySkullTotem2
        OCL                        = OCL_SpawnSkullTotem
        CreateLocation            = CREATE_AT_LOCATION
        StartsPaused            = No
    End

    Behavior = AutoAbilityBehavior ModuleTag_KingsFavorAutoAbility
	SpecialAbility	= SpecialAbilitySkullTotem
	ForbiddenStatus = INSIDE_GARRISON
	MaxScanRange	= 200
	Query		= 20 ANY +CAVALRY +INFANTRY -STRUCTURE -CASTLE_KEEP -BASE_FOUNDATION -HERO -MOVE_ONLY -DOZER ALLIES
    End




    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_MountedSkullTotemEnabler
        SpecialPowerTemplate    = SpecialAbilityMountedSkullTotem
        TriggeredBy                = Upgrade_Level_2
       ObeyRechageOnTrigger       = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_MountedSkullTotemStarter
        SpecialPowerTemplate          = SpecialAbilityMountedSkullTotem
        UpdateModuleStartsAttack      = Yes
        StartsPaused                  = Yes
        OnTriggerRechargeSpecialPower = SpecialAbilitySkullTotem
     End

    Behavior = ActivateModuleSpecialPower ModuleTag_MountedSkullTotemUpdate
        SpecialPowerTemplate    = SpecialAbilityMountedSkullTotem
        StartAbilityRange       = 25
        MustFinishAbility       = Yes
        UnpackTime              = 1300
        PackTime                = 1000
        UnpackingVariation      = 1
        TriggerSpecialPower     = ModuleTag_MountedSkullTotemPower2 OBJECTPOS
    End

    Behavior = OCLSpecialPower ModuleTag_MountedSkullTotemPower2
        SpecialPowerTemplate    = SpecialAbilityMountedSkullTotem2
        OCL                     = OCL_SpawnMountedSkullTotem
        CreateLocation          = CREATE_AT_LOCATION
        StartsPaused            = No
    End

    Behavior = AutoAbilityBehavior ModuleTag_KingsFavorAutoAbility2
	SpecialAbility	= SpecialAbilityMountedSkullTotem
	ForbiddenStatus = INSIDE_GARRISON
	MaxScanRange	= 200
	Query		= 20 ANY +CAVALRY +INFANTRY -STRUCTURE -CASTLE_KEEP -BASE_FOUNDATION -HERO -MOVE_ONLY -DOZER ALLIES
    End





    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_CallFromTheDeepEnabler
        SpecialPowerTemplate      = SpecialAbilityZuchtspinnenSummon
        TriggeredBy               = Upgrade_Level_8
       ObeyRechageOnTrigger       = Yes
    End

    Behavior = OCLSpecialPower ModuleTag_CallFromTheDeepPower
        SpecialPowerTemplate      = SpecialAbilityZuchtspinnenSummon
        OCL                       = OCL_SpawnZuchtspinnenEgg
        CreateLocation            = CREATE_AT_LOCATION
        StartsPaused              = Yes
        TriggerFX                 = FX_ZuchtspinnenSummonStart
        SetModelCondition         = ModelConditionState:USER_2
        SetModelConditionTime     = 3.5
        DisableDuringAnimDuration = Yes
    End






    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_CallFromTheDeepEnabler2
        SpecialPowerTemplate      = SpecialAbilityZuchtspinnenSummon2
        TriggeredBy               = Upgrade_Level_8
       ObeyRechageOnTrigger       = Yes
    End

    Behavior = OCLSpecialPower ModuleTag_CallFromTheDeepPower2
        SpecialPowerTemplate      = SpecialAbilityZuchtspinnenSummon2
        OCL                       = OCL_SpawnZuchtspinnenEgg
        CreateLocation            = CREATE_AT_LOCATION
        StartsPaused              = Yes
        TriggerFX                 = FX_ZuchtspinnenSummonStart
        SetModelCondition         = ModelConditionState:USER_2
        SetModelConditionTime     = 3.5
        DisableDuringAnimDuration = Yes
    End


    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_TheodenGloriousChargeEnabler
        SpecialPowerTemplate = SpecialAbilityGorkilGloriousCharge
        TriggeredBy = Upgrade_Level_1
        ObeyRechageOnTrigger       = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_TheodenGloriousChargeUpdate
        SpecialPowerTemplate      = SpecialAbilityGorkilGloriousCharge
        UpdateModuleStartsAttack  = Yes
        StartsPaused = Yes
        AttributeModifier = GorkilAnsturmModifier
        AttributeModifierRange = 200
        AttributeModifierAffectsSelf = No
        AttributeModifierAffects NONE +GoblinSpiderRider +GoblinSpiderRiderHorde +WildBannerSpiderRider ALLIES
        AttributeModifierFX = FX_GorkilGloriousChargeFX
    End

    Behavior = SpecialAbilityUpdate ModuleTag_GloriousChargeAnimation
        UnpackTime              = 1000
        UnpackingVariation      = 1
        SpecialPowerTemplate    = SpecialAbilityGorkilGloriousCharge
        PreparationTime         = 0
        PersistentPrepTime      = 0
        PackTime                = 1330
    End


    Behavior = AttributeModifierUpgrade ModuleTag_Bonus
        TriggeredBy 	  = Upgrade_GorkilCrown
        AttributeModifier = GorkilKingBonus
    End

    Behavior = CommandSetUpgrade ModueTag_CommandSetKing
        TriggeredBy   = Upgrade_GorkilCrown
        CommandSet    = MountedWildGoblinKingCommandSetModKing
    End


    Behavior = AttributeModifierAuraUpdate ModuleTag_Spinnendasein
        StartsActive      = Yes
        RefreshDelay      = 2000
        Range             = 100
        TargetEnemy       = Yes
        AntiCategory      = LEADERSHIP BUFF STRUCTURE INNATE_ARMOR
        BonusName         = SpinnendaseinDebuff
        ObjectFilter      = ANY +CAVALRY -INFANTRY -STRUCTURE -BASE_FOUNDATION -HERO -MACHINE -SHIP -DOZER
    End

    Behavior = GrantUpgradeCreate ModuleTag_VoraussetzungKrone
        UpgradeToGrant      = Upgrade_SchattenAngmars
        GiveOnBuildComplete = Yes
    End

        Behavior = UnpauseSpecialPowerUpgrade ModuleTag_CreateAHeroOilFireEnabler_Level3
        SpecialPowerTemplate = SpecialAbilityBuhrdurOilFire
        TriggeredBy = Upgrade_Level_9
    End

    Behavior = OCLSpecialPower ModuleTag_CreateAHeroOilFireStarter_Level3
        SpecialPowerTemplate    = SpecialAbilityBuhrdurOilFire
        OCL                        = OCL_BuhrdurOilFire
        CreateLocation            = USE_OWNER_OBJECT
        StartsPaused            = Yes
        AvailableAtStart               = No
    End

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_CreateAHeroIgniteOilEnabler_Level3
        SpecialPowerTemplate = SpecialAbilityBuhrdurIgniteOil
        TriggeredBy = Upgrade_Level_9
    End

    Behavior = SpecialPowerModule ModuleTag_CreateAHeroIgniteOilStarter_Level3
        SpecialPowerTemplate     = SpecialAbilityBuhrdurIgniteOil
        AvailableAtStart         = No
        UpdateModuleStartsAttack = Yes
        StartsPaused             = Yes
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_CreateAHeroIgniteOilUpdate_Level3
        SpecialPowerTemplate    = SpecialAbilityBuhrdurIgniteOil

        UnpackTime              = 2000
        PackTime                = 2000 

        AwardXPForTriggering    = 0
            
        SpecialWeapon = BuhrdurTriggerIgniteOil
        WhichSpecialWeapon = 1

        Instant                    = Yes
    End





    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
        CommandButtonName = Command_SetStanceBattle
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
        CommandButtonName = Command_SetStanceAggressive
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
    End

    Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
        CommandButtonName = Command_SetStanceHoldGround
        SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
    End


    Behavior = AISpecialPowerUpdate GoblinKingSkullTotemAI2
	CommandButtonName = Command_GoblinKingSkullTotemKing
	SpecialPowerAIType = AI_SPECIAL_POWER_HEAL_AOE
	SpecialPowerRadius = 25
    End

    Behavior = AISpecialPowerUpdate CMToggleWeaponL1AI
        CommandButtonName = Command_GorkilToggleWeapon
        SpecialPowerAIType = AI_SPECIAL_POWER_TOGGLE_MELEE_AND_RANGE
    End

    Behavior = AISpecialPowerUpdate GoblinKingPoisonedStingerAI
	CommandButtonName = Command_GoblinKingPoisonedStingerEdain
	SpecialPowerAIType = AI_SPECIAL_POWER_ENEMY_TYPE_KILLER
    End

    Behavior = AISpecialPowerUpdate SummonAlliesHotWL1AI
        CommandButtonName = Command_GorkilZuchtspinnenSummon
        SpecialPowerAIType = AI_SPECIAL_POWER_TARGETAOE_SUMMON
        SpecialPowerRadius = 30.0
    End

    Geometry = CYLINDER
    GeometryMajorRadius = 8.0
    GeometryMinorRadius = 8.0
    GeometryHeight = 19.2
    GeometryIsSmall = Yes
    Shadow = SHADOW_DECAL
    ShadowSizeX = 20
    ShadowSizeY = 20
    ShadowTexture = ShadowI
End



Object WildSkullTotem

    SelectPortrait = UPSkullTotemNew

    Draw = W3DScriptedModelDraw ModuleTag_Draw

        DefaultModelConditionState
            Model               = WUGobKng_Totem
            ParticleSysBone = None TaintHCPing HouseColor:Yes
            ParticleSysBone = None GoblinKingTaint

                Shadow =  SHADOW_ALPHA_DECAL_DYNAMIC
                ShadowSizeX = 200
                ShadowSizeY = 200
                ShadowTexture = EXTaint

                ShadowOpacityStart = 0
                ShadowOpacityFadeInTime = 1000
                ShadowOpacityPeak = 175
                ShadowOpacityFadeOutTime = 1000
                ShadowOpacityEnd = 0
                ShadowOverrideLODVisibility = Yes
        End
    End


    DisplayName            = OBJECT:SkullTotem
    EditorSorting          = MISC_MAN_MADE
    Side                   = Wild
    ShroudClearingRange    = SHROUD_CLEAR_SKULL_TOTEM
    CommandSet             = SkullTotemCommandset
    KindOf                 = STRUCTURE IMMOBILE SELECTABLE IGNORE_FOR_VICTORY
    RadarPriority          = UNIT

    Body            = ActiveBody ModuleTag_Body
        MaxHealth   = SKULL_TOTEM_HEALTH
    End

    Behavior = DestroyDie ModuleTagDeath_Die
        DeathTypes = ALL
    End


    Behavior = PassiveAreaEffectBehavior ModuleTag_FeelGoodHero
        EffectRadius                = ELVEN_STATUE_AOE_RADIUS
        PingDelay                   = 2000
        ModifierName                = SkullTotemLeadership
        AllowFilter                 = GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
    End

    Behavior = StealthDetectorUpdate ModuleTag_DetectStealth
        DetectionRate    = SKULL_TOTEM_STEALTH_DETECT_RATE
        DetectionRange   = SKULL_TOTEM_STEALTH_DETECT_RADIUS
    End

    Geometry                = CYLINDER
    GeometryMajorRadius     = 5.0
    GeometryHeight          = 20.0

    GeometryIsSmall         = No

    BuildCompletion         = PLACED_BY_PLAYER

    GeometryContactPoint = X:0.0    Y:0.0        Z:0
    GeometryContactPoint = X:0.0    Y:0.0        Z:20.0        Swoop
End


Object WildSkullTotemKing

    SelectPortrait = UPSkullTotemNew

    Draw = W3DScriptedModelDraw ModuleTag_Draw

        DefaultModelConditionState
            Model               = WUGobKng_Totem
            ParticleSysBone = None TaintHCPing HouseColor:Yes
            ParticleSysBone = None GoblinKingTaint

                Shadow =  SHADOW_ALPHA_DECAL_DYNAMIC
                ShadowSizeX = 200
                ShadowSizeY = 200
                ShadowTexture = EXTaint

                ShadowOpacityStart = 0
                ShadowOpacityFadeInTime = 1000
                ShadowOpacityPeak = 175
                ShadowOpacityFadeOutTime = 1000
                ShadowOpacityEnd = 0
                ShadowOverrideLODVisibility = Yes
        End
    End


    DisplayName            = OBJECT:SkullTotem
    EditorSorting          = MISC_MAN_MADE
    CommandSet             = SkullTotemCommandset
    Side                   = Wild
    ShroudClearingRange    = SHROUD_CLEAR_SKULL_TOTEM
    KindOf                 = STRUCTURE IMMOBILE SELECTABLE IGNORE_FOR_VICTORY
    RadarPriority          = UNIT

    Body            = ActiveBody ModuleTag_Body
        MaxHealth    = SKULL_TOTEM_HEALTH
    End

    Behavior = DestroyDie ModuleTagDeath_Die
        DeathTypes = ALL
    End

    Behavior = StealthDetectorUpdate ModuleTag_DetectStealth
        DetectionRate    = SKULL_TOTEM_STEALTH_DETECT_RATE
        DetectionRange   = SKULL_TOTEM_STEALTH_DETECT_RADIUS
    End

    Behavior = AttributeModifierAuraUpdate ModuleTag_Leadership
        StartsActive    = Yes
        BonusName       = SkullTotemLeadershipKing
        RefreshDelay    = 2000
        Range           = 250
        ObjectFilter    = GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
    End

    Geometry                  = CYLINDER
    GeometryMajorRadius       = 5.0
    GeometryHeight            = 20.0
    GeometryIsSmall           = No
    BuildCompletion           = PLACED_BY_PLAYER
    GeometryContactPoint = X:0.0    Y:0.0        Z:0
    GeometryContactPoint = X:0.0    Y:0.0        Z:20.0        Swoop
End

Object WildGoblinKing
End

