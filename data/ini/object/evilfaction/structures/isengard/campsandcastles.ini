Object IsengardCampKeep

    SelectPortrait = BPICamp

  Draw = W3DScriptedModelDraw ModuleTag_Draw
    OkToChangeModelColor  = Yes
    UseStandardModelNames = Yes

    DefaultModelConditionState
      Model = IBCCenter
      ParticleSysBone      = smokebone01 furnaceSparks
    End

    ModelConditionState = WORLD_BUILDER
        Model = IBCCenterW
    End

    IdleAnimationState
    End


    ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED
      Model               = IBCCenter_A
      ParticleSysBone     = NONE BuildingContructDust
    End

    AnimationState          = ACTIVELY_BEING_CONSTRUCTED
        Animation
            AnimationName    = IBCCenter_A.IBCCenter_A
            AnimationMode   = MANUAL
        End
        StateName        = BeingConstructed
        BeginScript
            CurDrawablePlaySound("GondorBarracksBeginConstruction")
            CurDrawablePlaySound("BuildingTopple")
        EndScript
    End


    ModelConditionState   = BASE_BUILD
      Model               = IBCCenter_A
      ParticleSysBone     = NONE BuildingContructDust
    End

    AnimationState          = BASE_BUILD
        Animation
            AnimationName = IBCCenter_A.IBCCenter_A
            AnimationMode = ONCE
            AnimationBlendTime = 0
            AnimationSpeedFactorRange = 2.0 2.0
        End
        BeginScript
            CurDrawablePlaySound("DebrisDust")
            CurDrawablePlaySound("GondorBarracksBeginConstruction")
            CurDrawablePlaySound("BuildingTopple")
        EndScript
    End

    ModelConditionState   = JUST_BUILT
      Model               = IBCCenter_A

      ParticleSysBone     = NONE BuildingContructDust
    End

    AnimationState          = JUST_BUILT
        Animation
            AnimationName = IBCCenter_A.IBCCenter_A
            AnimationMode = MANUAL
            AnimationBlendTime = 0
        End
        Flags = START_FRAME_FIRST




    End

    ModelConditionState  = DAMAGED
      Model         = IBCCenter_D1
      ParticleSysBone Smokebone01 TrebuchetImpactSplinters



    End
    AnimationState = DAMAGED
     EnteringStateFX    = FX_BuildingDamaged
    End

    ModelConditionState  = REALLYDAMAGED
      Model         = IBCCenter_D2
      ParticleSysBone Smokebone01 TrebuchetImpactSplinters

    End
    AnimationState = REALLYDAMAGED
         EnteringStateFX    = FX_BuildingReallyDamaged
    End

    ModelConditionState  = RUBBLE
      Model         = IBCCenter_D2
      ParticleSysBone Smokebone01 Explosion3
      ParticleSysBone Smokebone02 Explosion5
    End

    AnimationState = RUBBLE

    End

      ModelConditionState  = POST_RUBBLE
        Model         = GBGenRubble
        ParticleSysBone NONE SmokeBuildingMediumRubble
    End
    AnimationState = POST_RUBBLE
    End

    ModelConditionState  = POST_COLLAPSE
        Model         = GBGenRubble
        ParticleSysBone NONE SmokeBuildingMediumRubble
    End
    AnimationState = POST_COLLAPSE
    End

  End




    VoiceSelect                = IsengardCitadelSelect

    SoundOnDamaged            = BuildingLightDamageStone
    SoundOnReallyDamaged        = BuildingHeavyDamageStone

    VoiceSelectUnderConstruction    = BuildingEvilVoiceSelectUnderConstruction

    UnitSpecificSounds
        UnderConstruction        = BuildingBigConstructionLoop

        UnderRepairFromRubble    = BuildingBigConstructionLoop
    End
    EvaEventDieOwner = CitadelDie



    #include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

    DisplayName      = OBJECT:IsengardCampKeep
    Side = Isengard
    EditorSorting   = STRUCTURE
    ThreatLevel = 1.0
    BuildCost           = 1000
    BuildTime           = 30.0
    CommandSet            = IsengardCampKeepCommandSet

    ArmorSet
        Conditions        = None
        Armor             = CitadelArmor
        DamageFX          = None
    End
    CampnessValue = CAMPNESS_FORTRESS


    KindOf                    = VITAL_FOR_BASE_SURVIVAL STRUCTURE SELECTABLE IMMOBILE CASTLE_KEEP MP_COUNT_FOR_VICTORY FS_FACTORY AUTO_RALLYPOINT MADE_OF_WOOD SCORE
    RadarPriority            = STRUCTURE
    KeepSelectableWhenDead    = Yes


    Body              = ActiveBody ModuleTag_02
        MaxHealth       = ISGENARD_CENTRAL_CAMP_KEEP_HEALTH
    End

    Behavior = GettingBuiltBehavior ModuleTag_04
        SelfBuildingLoop = BuildingBigConstructionLoop
        SelfRepairFromDamageLoop  = NoSound
        SelfRepairFromRubbleLoop  = BuildingBigConstructionLoop
    End

  Behavior = CastleMemberBehavior ModuleTag_CMB
    BeingBuiltSound = BuildingBigConstructionLoop
  End

    Behavior = AutoDepositUpdate AutoDepositModuleTag
        DepositTiming            = GENERIC_KEEP_MONEY_TIME
        DepositAmount            = GENERIC_KEEP_MONEY_AMOUNT
        InitialCaptureBonus        = 0
    End



    Behavior = ProductionUpdate ProductionUpdateModuleTag

    End
    Behavior = QueueProductionExitUpdate ModuleTag_QueuePEU
        UnitCreatePoint   = X:0.0 Y:-20.0 Z:0.0
        NaturalRallyPoint = X:28.8 Y:-80.0 Z:0.0
        ExitDelay = STANDARD_HERO_EXIT_DELAY
    End





  Behavior = KeepObjectDie ModuleTag_IWantRubble
  End

     Behavior                  = StructureCollapseUpdate ModuleTag_06
       MinCollapseDelay        = 000
       MaxCollapseDelay        = 000
       CollapseDamping         = .5
       MaxShudder              = 0.6
       MinBurstDelay           = 250
       MaxBurstDelay           = 800
       BigBurstFrequency       = 4
       FXList                  = INITIAL FX_StructureMediumCollapse
     End

    Behavior                  = RubbleRiseUpdate ModuleTag_07
        MinRubbleRiseDelay      = 000
        MaxRubbleRiseDelay      = 000

        RubbleHeight            = 4.0
        MaxShudder              = 0.6
        MinBurstDelay           = 250
        MaxBurstDelay           = 800
        BigBurstFrequency       = 4
        FXList                  = INITIAL FX_StructureMediumPostCollapse
    End

  Geometry              = BOX
  GeometryMajorRadius   = 15.0
  GeometryMinorRadius   = 15.0
  GeometryHeight        = 148.0

  AdditionalGeometry    = BOX
  GeometryMajorRadius   = 35.0
  GeometryMinorRadius   = 33.0
  GeometryHeight        = 30.0

  GeometryIsSmall       = No
  Shadow                = SHADOW_VOLUME

  GeometryContactPoint    = X:0.115    Y:0        Z:150.622        Swoop
  GeometryContactPoint    = X:0        Y:0        Z:0
End


Object IsengardEconomyKeep

    SelectPortrait = BPIOrthancTower



  Draw = W3DScriptedModelDraw ModuleTag_Draw
    OkToChangeModelColor  = Yes
    UseStandardModelNames = Yes

    DefaultModelConditionState
      Model = IBTent2
    End
    AnimationState        = NONE
      Animation           = IBTent2
        AnimationName     = IBTent2.IBTent2
        AnimationMode     = LOOP
      End
    End

    ModelConditionState  = RUBBLE
      Model         = IBTent2
      ParticleSysBone SmokeLarge01 SmokeBuildingLarge
    End
    AnimationState = RUBBLE
    End

    ModelConditionState  = POST_RUBBLE
      Model         = None
        ParticleSysBone NONE SmokeBuildingMediumRubble
    End
    AnimationState = POST_RUBBLE
    End

    ModelConditionState  = POST_COLLAPSE
      Model         = None
        ParticleSysBone NONE SmokeBuildingMediumRubble
    End
    AnimationState = POST_COLLAPSE
    End
  End



    #include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

    SoundOnDamaged        = BuildingLightDamageStone
    SoundOnReallyDamaged    = BuildingHeavyDamageStone
    VoiceSelectUnderConstruction    = BuildingEvilVoiceSelectUnderConstruction

    UnitSpecificSounds
        UnderConstruction        = BuildingConstructionLoop

        UnderRepairFromRubble    = BuildingConstructionLoop
    End

    CampnessValue = CAMPNESS_RESOURCE_BUILDING




  DisplayName      = OBJECT:IsengardCampKeep
  Side = Isengard
  EditorSorting   = STRUCTURE
  ThreatLevel = 1.0



  ArmorSet
    Conditions        = None
    Armor             = NoArmor
    DamageFX          = None
  End


  KindOf            = STRUCTURE SELECTABLE IMMOBILE CASTLE_KEEP MP_COUNT_FOR_VICTORY MADE_OF_WOOD
  RadarPriority        = STRUCTURE
  Body              = ActiveBody ModuleTag_02
    MaxHealth       = 2000.0
  End

  Behavior = GettingBuiltBehavior ModuleTag_04
    WorkerName    = MordorWorkerNoSelect
    SpawnTimer  = 120
    RebuildWhenDead = Yes
  End

  Behavior = CastleMemberBehavior ModuleTag_CMB
    BeingBuiltSound = BuildingBigConstructionLoop
  End




  Behavior = SlowDeathBehavior ModuleTag_SlowDeathWithoutRubble
      DestructionDelay  = 4000
  End

  Behavior                  = StructureCollapseUpdate ModuleTag_06
    MinCollapseDelay        = 000
    MaxCollapseDelay        = 000
    CollapseDamping         = .5
    MaxShudder              = 0.6
    MinBurstDelay           = 250
    MaxBurstDelay           = 800
    BigBurstFrequency       = 4
    FXList                  = INITIAL   FX_StructureMediumCollapse

  End

  Geometry              = CYLINDER
  GeometryMajorRadius   = 50.0
  GeometryMinorRadius   = 0
  GeometryHeight        = 31.0

  GeometryIsSmall       = No
  Shadow                = SHADOW_VOLUME
End




Object IBCastleFloor


  Draw = W3DFloorDraw ModuleTag_01
    StaticModelLODMode = Yes
      ModelName = IBCastFloor
        ForceToBack = Yes
  End


    Draw = W3DScriptedModelDraw ModuleTag_Draw2
        DefaultModelConditionState
            Model = OBBFoundationX
        End
        ModelConditionState = WORLD_BUILDER
              Model = IBSizeTemplate
          End

    End




    VoiceSelect        = Gui_PlotSelect



  DisplayName      = OBJECT:IBCastFloor
  Side = Isengard
  EditorSorting = STRUCTURE


  ArmorSet
    Conditions        = None
    Armor             = NoArmor
    DamageFX          = None
  End


  KindOf                = STRUCTURE IMMOBILE NO_COLLIDE UNATTACKABLE INERT
  RadarPriority = NOT_ON_RADAR
  Body                  = ImmortalBody ModuleTag_03
    MaxHealth       = 2000.0
  End




  Behavior = SlowDeathBehavior ModuleTag_SlowDeathWithoutRubble
      DestructionDelay  = 1000
  End

  Geometry              = BOX
  GeometryMajorRadius   = 0.8
  GeometryMinorRadius   = 0.8
  GeometryHeight        = 0.8
  GeometryIsSmall       = Yes

  Shadow                = SHADOW_VOLUME
End




Object IBCampFloor


  Draw = W3DFloorDraw ModuleTag_01
    StaticModelLODMode = Yes
      ModelName = IBCampFloor
        ForceToBack = Yes
  End



  DisplayName      = OBJECT:IBCampFloor
  Side = Isengard
  EditorSorting = STRUCTURE


  ArmorSet
    Conditions        = None
    Armor             = NoArmor
    DamageFX          = None
  End


  KindOf                = STRUCTURE IMMOBILE NO_COLLIDE UNATTACKABLE INERT
  RadarPriority = NOT_ON_RADAR
  Body                  = ImmortalBody ModuleTag_03
    MaxHealth       = 2000.0
  End




  Behavior = SlowDeathBehavior ModuleTag_SlowDeathWithoutRubble
      DestructionDelay  = 1000
  End

  Geometry              = BOX
  GeometryMajorRadius   = 0.8
  GeometryMinorRadius   = 0.8
  GeometryHeight        = 0.8
  GeometryIsSmall       = Yes

  Shadow                = SHADOW_VOLUME
End




Object IsengardBuildingFoundation

 SelectPortrait = BPICamp_Plot




    Draw = W3DScriptedModelDraw ModuleTag_Draw2
        DefaultModelConditionState
            Model = OBBFoundationX
        End
        ModelConditionState = WORLD_BUILDER
              Model = MBSizeTemplate
          End

    End

    Draw = W3DFloorDraw ModuleTag_Draw
        ModelName = IBFoundationX
    End




  DisplayName         = OBJECT:IsengardBuildingFoundation
  Side                = Isengard
  EditorSorting       = STRUCTURE
  ThreatLevel = 1.0

  BuildCost           = 1
  BuildTime           = 5.0
  VisionRange         = 160.0
  ShroudClearingRange = 161

  CommandSet = IsengardFoundationCommandSet


  VoiceSelect = Gui_PlotSelect


  RadarPriority       = STRUCTURE
  KindOf              = STRUCTURE SELECTABLE IMMOBILE BASE_FOUNDATION UNATTACKABLE MP_COUNT_FOR_VICTORY NO_COLLIDE DO_NOT_CLASSIFY

  Behavior            = FoundationAIUpdate ModuleTag_foundationAI
  End

  Behavior = CastleMemberBehavior ModuleTag_CMB
  End

  Body                = ImmortalBody ModuleTag_05
    MaxHealth         = 15000.0
  End

  Geometry              = BOX
  GeometryMajorRadius   = 24.0
  GeometryMinorRadius   = 24.0
  GeometryHeight        = 0.8
  GeometryIsSmall       = No
  Shadow                = SHADOW_VOLUME
  BuildCompletion        = PLACED_BY_PLAYER
End


Object IsengardBaseDefenceFoundation

    SelectPortrait = BPICamp_Plot


    Scale = 0.7

    Draw = W3DScriptedModelDraw ModuleTag_Draw2
        DefaultModelConditionState
            Model = OBBFoundationX
        End
        ModelConditionState = WORLD_BUILDER
              Model = IBBtlTwrM
          End

    End
   Draw = W3DFloorDraw ModuleTag_Draw
      ModelName = IBFoundationM
  End




  DisplayName         = OBJECT:IsengardBaseDefenseFoundation
  Side                = Mordor
  EditorSorting       = STRUCTURE
  ThreatLevel = 1.0

  BuildCost           = 1
  BuildTime           = 5.0
  VisionRange         = 160.0
  ShroudClearingRange = 160

  CommandSet = IsengardBaseDefenceFoundationCommandSet


  VoiceSelect = Gui_PlotSelect


  RadarPriority       = STRUCTURE
  KindOf              = STRUCTURE SELECTABLE IMMOBILE BASE_FOUNDATION BASE_DEFENSE_FOUNDATION UNATTACKABLE MP_COUNT_FOR_VICTORY NO_COLLIDE DO_NOT_CLASSIFY

  Behavior            = FoundationAIUpdate ModuleTag_foundationAI
  End

  Behavior = CastleMemberBehavior ModuleTag_CMB
  End

  Body                = ImmortalBody ModuleTag_05
    MaxHealth         = 15000.0
  End

  Geometry              = BOX
  GeometryMajorRadius   = 24.0
  GeometryMinorRadius   = 24.0
  GeometryHeight        = 0.8
  GeometryIsSmall       = No
  Shadow                = SHADOW_VOLUME
  BuildCompletion        = PLACED_BY_PLAYER
End


Object IsengardCastleBaseKeep

    SelectPortrait = BPIOrthancTower
        ButtonImage            = BIWatchTower


  Draw = W3DScriptedModelDraw ModuleTag_Draw
    OkToChangeModelColor  = Yes
    UseStandardModelNames = Yes

    DefaultModelConditionState
      Model = IB_Orthanc
    End



    ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
      Model               = IB_Orthanc_A

      ParticleSysBone     = NONE BuildingContructDust
    End

    AnimationState          = ACTIVELY_BEING_CONSTRUCTED
        Animation
            AnimationName    = IB_Orthanc_A.IB_Orthanc_A
            AnimationMode   = MANUAL
        End
        BeginScript

        EndScript
    End


    ModelConditionState   = BASE_BUILD
      Model               = IB_Orthanc_A

      ParticleSysBone     = NONE BuildingContructDust
    End

    AnimationState          = BASE_BUILD
        Animation
            AnimationName = IB_Orthanc_A.IB_Orthanc_A
            AnimationMode = ONCE
            AnimationBlendTime = 0
            AnimationSpeedFactorRange = 2.0 2.0
        End
        BeginScript

        EndScript
    End

    AnimationState          = JUST_BUILT
        Animation
            AnimationName = IB_Orthanc_A.IB_Orthanc_A
            AnimationMode = MANUAL
            AnimationBlendTime = 0
        End
        Flags = START_FRAME_FIRST
        BeginScript

        EndScript
    End

    ModelConditionState  = DAMAGED
      Model         = IB_Orthanc_D1
    End

    AnimationState = DAMAGED
     EnteringStateFX    = FX_BuildingDamaged
    End

    ModelConditionState  = REALLYDAMAGED
      Model         = IB_Orthanc_D2

    End
    AnimationState = REALLYDAMAGED
           Animation                =    ReallyDamagedanimation
            AnimationName        =     IB_Orthanc_D2.IB_Orthanc_D2
            AnimationMode        =    ONCE
           End
         EnteringStateFX    = FX_BuildingReallyDamaged
    End

    ModelConditionState  = RUBBLE
      Model         = IB_Orthanc_D3
      ParticleSysBone FXbone01 BaradDurDust01 FollowBone:Yes
      ParticleSysBone FXbone02 BaradDurDust01 FollowBone:Yes
      ParticleSysBone NONE ExplosiveMineSmoke02
    End

    AnimationState = RUBBLE
        Animation                =    Death
            AnimationName        =    IB_Orthanc_D3.IB_Orthanc_D3
            AnimationMode        =    ONCE
        End

    End

    ModelConditionState  = POST_RUBBLE
        Model         = None
    End

    ModelConditionState  = POST_COLLAPSE
         Model         = None
    End


  End




    SoundOnDamaged        = BuildingLightDamageStone
    SoundOnReallyDamaged    = BuildingHeavyDamageStone

    VoiceSelectUnderConstruction    = BuildingEvilVoiceSelectUnderConstruction

    UnitSpecificSounds
        UnderConstruction        = BuildingBigConstructionLoop

        UnderRepairFromRubble    = BuildingBigConstructionLoop
    End




    DisplayName      = OBJECT:IsengardCastleBaseKeep
    Side = Isengard
    EditorSorting   = STRUCTURE
    ThreatLevel = 1.0


    VisionRange         = 160.0
    ShroudClearingRange = 161
    CommandSet            = GenericKeepCommandSet
    HealthBoxHeightOffset = -200

    ArmorSet
        Conditions        = None
        Armor             = StructureArmor
        DamageFX          = OrthancDamageFX
    End


  KindOf            = PRELOAD STRUCTURE IMMOBILE SCORE NEED_BASE_FOUNDATION CASTLE_KEEP NOT_AUTOACQUIRABLE FS_FACTORY AUTO_RALLYPOINT SELECTABLE MADE_OF_METAL
  RadarPriority        = STRUCTURE
  Body              = ActiveBody ModuleTag_02
    MaxHealth       = 4000.0
  End

  Behavior = GettingBuiltBehavior ModuleTag_04
    WorkerName    = MordorWorkerNoSelect
    SpawnTimer  = 120
    RebuildWhenDead = Yes
  End

  Behavior = CastleMemberBehavior ModuleTag_CMB
    BeingBuiltSound = BuildingBigConstructionLoop
  End



    Behavior = ProductionUpdate ProductionUpdateModuleTag

    End
    Behavior = QueueProductionExitUpdate ModuleTag_QueuePEU
        UnitCreatePoint   = X:0.0 Y:-20.0 Z:0.0
        NaturalRallyPoint = X:28.8 Y:-80.0 Z:0.0
        ExitDelay = STANDARD_HERO_EXIT_DELAY
    End





  Behavior = KeepObjectDie ModuleTag_IWantRubble
  End












    Behavior                  = RubbleRiseUpdate ModuleTag_07
        MinRubbleRiseDelay      = 000
        MaxRubbleRiseDelay      = 000

        RubbleHeight            = 4.0
        MaxShudder              = 0.6
        MinBurstDelay           = 250
        MaxBurstDelay           = 800
        BigBurstFrequency       = 4
        FXList                  = INITIAL FX_StructureMediumCollapse
    End


  Geometry              = CYLINDER
  GeometryMajorRadius   = 42.6
  GeometryMinorRadius   = 0
  GeometryHeight        = 65.2

  AdditionalGeometry    = CYLINDER
  GeometryMajorRadius   = 22.6
  GeometryMinorRadius   = 0
  GeometryHeight        = 265.2

  GeometryIsSmall       = No
  Shadow                = SHADOW_VOLUME

  AttackContactPoint    = X:0 Y:0 Z:262
  AttackContactPoint    = X:0 Y:0 Z:0
End


Object WOR_IsengardCastleBaseKeep

    SelectPortrait = BPIOrthancTower
        ButtonImage            = BIWatchTower


    Draw = W3DScriptedModelDraw ModuleTag_Draw

        ExtraPublicBone         = ARROWBONE01
        ExtraPublicBone         = ARROWBONE02
        ExtraPublicBone         = ARROWBONE03
        ExtraPublicBone         = ARROWBONE04
        ExtraPublicBone         = ARROWBONE05
        ExtraPublicBone         = ARROWBONE06
        ExtraPublicBone         = ARROWBONE07
        ExtraPublicBone         = ARROWBONE08
        ExtraPublicBone         = ARROWBONE09
        ExtraPublicBone         = ARROWBONE10
        ExtraPublicBone         = ARROWBONE11
        ExtraPublicBone         = ARROWBONE12
        ExtraPublicBone         = ARROWBONE13
        ExtraPublicBone         = ARROWBONE14
        ExtraPublicBone         = ARROWBONE15
        ExtraPublicBone         = ARROWBONE16
        ExtraPublicBone         = B_BANNER

        OkToChangeModelColor  = Yes
        UseStandardModelNames = Yes

        DefaultModelConditionState
           Model = iborthancea
        End



        ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
        Model               = IB_Orthanc_A

        ParticleSysBone     = NONE BuildingContructDust
        End

        AnimationState          = ACTIVELY_BEING_CONSTRUCTED
            Animation
                AnimationName    = IB_Orthanc_A.IB_Orthanc_A
                AnimationMode   = MANUAL
            End
            BeginScript

            EndScript
        End


        ModelConditionState   = BASE_BUILD
            Model               = IB_Orthanc_A

            ParticleSysBone     = NONE BuildingContructDust
        End

        AnimationState          = BASE_BUILD
            Animation
                AnimationName = IB_Orthanc_A.IB_Orthanc_A
                AnimationMode = ONCE
                AnimationBlendTime = 0
                AnimationSpeedFactorRange = 2.0 2.0
            End
            BeginScript

            EndScript
        End

        AnimationState          = JUST_BUILT
            Animation
                AnimationName = IB_Orthanc_A.IB_Orthanc_A
                AnimationMode = MANUAL
                AnimationBlendTime = 0
            End
            Flags = START_FRAME_FIRST
            BeginScript

            EndScript
        End

        ModelConditionState  = DAMAGED
        Model         = iborthancea
        End

        AnimationState = DAMAGED
        EnteringStateFX    = FX_BuildingDamaged
        End

        ModelConditionState  = REALLYDAMAGED
        Model         = iborthancea

        End
        AnimationState = REALLYDAMAGED
               Animation                =    ReallyDamagedanimation
                AnimationName        =     iborthancea.iborthancea
                AnimationMode        =    ONCE
               End
             EnteringStateFX    = FX_BuildingReallyDamaged
        End

        ModelConditionState  = RUBBLE
        Model         = iborthancea
        ParticleSysBone FXbone02 BaradDurDust01 FollowBone:Yes
        ParticleSysBone NONE CastleExplosion
        End

        AnimationState = RUBBLE
            Animation                =    Death
                AnimationName        =    iborthancea.iborthancea
                AnimationMode        =    ONCE
            End
            EnteringStateFX = FX_StructureMediumCollapse
        End

        ModelConditionState  = POST_RUBBLE
            Model         = IB_Orthanc_R
        End

        ModelConditionState  = POST_COLLAPSE
            Model         = IB_Orthanc_R
        End
    End


    #include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

    SoundOnDamaged                    = BuildingLightDamageStone
    SoundOnReallyDamaged            = BuildingHeavyDamageStone

    VoiceSelectUnderConstruction    = BuildingEvilVoiceSelectUnderConstruction
    VoiceSelect                        = IsengardFortressSelect

    UnitSpecificSounds
        UnderConstruction        = BuildingBigConstructionLoop

        UnderRepairFromRubble    = BuildingBigConstructionLoop
    End



    DisplayName        = OBJECT:IsengardCastleBaseKeep
    Side               = WOR
    EditorSorting      = STRUCTURE
    ThreatLevel        = 1.0
    BuildCost               = 5000
    BuildTime               = 120.0
    VisionRange             = 400
    ShroudClearingRange     = 800

    ArmorSet
        Conditions    = None
        Armor        = FortressArmor
        DamageFX    = OrthancDamageFX
    End

    WeaponSet
        Conditions        = None
    End

    WeaponSet
        Conditions        = PASSENGER_TYPE_ONE
    End

    WeaponSet
        Conditions        = PASSENGER_TYPE_TWO
    End

    CommandSet        = GenericKeepCommandSet

    HealthBoxHeightOffset    = -200



    KindOf            = VITAL_FOR_BASE_SURVIVAL PRELOAD SELECTABLE STRUCTURE IMMOBILE SCORE CASTLE_KEEP MP_COUNT_FOR_VICTORY CAN_ATTACK FS_FACTORY AUTO_RALLYPOINT DOZER_FACTORY NEVER_CULL_FOR_MP COMMANDCENTER DONT_HIDE_IF_FOGGED GARRISON GARRISONABLE_UNTIL_DESTROYED TRANSPORT
    RadarPriority        = STRUCTURE
    KeepSelectableWhenDead    = Yes

    Behavior = AIUpdateInterface ModuleTag_SoWeCanUseWeapon
        AutoAcquireEnemiesWhenIdle = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate        = 250
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSetDwarven
        TriggeredBy    = Upgrade_DwarfFaction
        CommandSet    = DwarvenMonumentFortressRebuildCommandSetMod
    End
    Behavior = CommandSetUpgrade ModuleTag_CommandSetMen
        TriggeredBy    = Upgrade_MenFaction
        CommandSet    = GondorMonumentFortressRebuildCommandSetMod
    End
    Behavior = CommandSetUpgrade ModuleTag_CommandSetRohan
        TriggeredBy    = Upgrade_RohanFaction
        CommandSet    = RohanMonumentFortressRebuildCommandSetMod
    End
    Behavior = CommandSetUpgrade ModuleTag_CommandSetImladris
        TriggeredBy    = Upgrade_ImladrisFaction
        CommandSet    = ImladrisMonumentFortressRebuildCommandSetMod
    End
    Behavior = CommandSetUpgrade ModuleTag_CommandSetElven
        TriggeredBy    = Upgrade_LothlorienFaction
        CommandSet    = LothlorienMonumentFortressRebuildCommandSetMod
    End
    Behavior = CommandSetUpgrade ModuleTag_CommandSetArnor
        TriggeredBy    = Upgrade_ArnorFaction
        CommandSet    = ArnorMonumentFortressRebuildCommandSetMod
    End
    Behavior = CommandSetUpgrade ModuleTag_CommandSetIsengard
        TriggeredBy    = Upgrade_IsengardFaction
        CommandSet    = IsengardMapIsengardRebuildCommandSet
    End
    Behavior = CommandSetUpgrade ModuleTag_CommandSetMordor
        TriggeredBy    = Upgrade_MordorFaction
        CommandSet    = MordorMonumentFortressRebuildCommandSetMod
    End
    Behavior = CommandSetUpgrade ModuleTag_CommandSetWild
        TriggeredBy    = Upgrade_WildFaction
        CommandSet    = WildMonumentFortressRebuildCommandSetMod
    End
    Behavior = CommandSetUpgrade ModuleTag_CommandSetAngmar
        TriggeredBy    = Upgrade_AngmarFaction
        CommandSet    = AngmarMonumentFortressRebuildCommandSetMod
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSet1
        TriggeredBy       = Upgrade_SubFactionErebor
        CommandSet        = DwarvenMonumentFortressRebuildCommandSetMod_mitZwergenreich
    End
    Behavior = CommandSetUpgrade ModuleTag_CommandSet2
        TriggeredBy       = Upgrade_SubFactionIronHills
        CommandSet        = DwarvenMonumentFortressRebuildCommandSetMod_mitZwergenreich
    End
    Behavior = CommandSetUpgrade ModuleTag_CommandSet3
        TriggeredBy       = Upgrade_SubFactionEredLuin
        CommandSet        = DwarvenMonumentFortressRebuildCommandSetMod_mitZwergenreich
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSetKrone1
        TriggeredBy         = Upgrade_GreatGoblinCrown
        CommandSet          = WildMonumentFortressRebuildCommandSetMod_King
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSetKrone2
        TriggeredBy         = Upgrade_DurbutzCrown
        CommandSet          = WildMonumentFortressRebuildCommandSetMod_King
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSetKrone3
        TriggeredBy         = Upgrade_GorkilCrown
        CommandSet          = WildMonumentFortressRebuildCommandSetMod_King
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
    End

    Behavior = QueueProductionExitUpdate ModuleTag_QueuePEU
        UnitCreatePoint            = X:0.0 Y:-0.0 Z:0.0
        NaturalRallyPoint        = X:50.0 Y:-60.0 Z:0.0
        ExitDelay            = STANDARD_HERO_EXIT_DELAY
        AllowAirborneCreation        = Yes
    End


    Behavior = GettingBuiltBehavior GetBuiltBehaviorTag
        SelfBuildingLoop        = BuildingBigConstructionLoop
        SelfRepairFromDamageLoop    = NoSound
        SelfRepairFromRubbleLoop    = BuildingBigConstructionLoop
        SpawnTimer            = -1.0
        RebuildTimeSeconds        = 120
    End

    Behavior = CastleMemberBehavior ModuleTag_CMB
        BeingBuiltSound = BuildingBigConstructionLoop
    End

    Body = ActiveBody ModuleTag_02
        MaxHealth        = MONUMENT_FORTRESS_HEALTH
        MaxHealthDamaged    = MONUMENT_FORTRESS_HEALTH_DAMAGED
        MaxHealthReallyDamaged    = MONUMENT_FORTRESS_HEALT_REALLY_DAMAGED
    End

    Behavior = KeepObjectDie ModuleTag_IWantRubble
    End

	#include "..\..\..\FortressRingFunc.inc"
	
    Behavior = AutoDepositUpdate AutoDepositModuleTag
        DepositTiming           = GENERIC_KEEP_MONEY_TIME
        DepositAmount           = 80
        InitialCaptureBonus     = 0
    End
	
    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_SummonPortalEnabler
        SpecialPowerTemplate         = SpellSummonUnderworldPortal
        TriggeredBy                  = Upgrade_GlobalFirstAgeSpell
    End

    Behavior = OCLSpecialPower ModuleTag_SummonPortal
        SpecialPowerTemplate         = SpellSummonUnderworldPortal
        OCL                          = OCL_SummonUnderworldPortal
        CreateLocation               = CREATE_AT_LOCATION
        StartsPaused                 = Yes
    End

    Behavior = AISpecialPowerUpdate SummonPortal_AI
        CommandButtonName  = Command_SummonUnderworldPortal
        SpecialPowerAIType = AI_SPELLBOOK_ASSIST_BATTLE_DEBUFF
        SpecialPowerRadius = 1000
        RandomizeTargetLocation = Yes
    End

    Behavior = TerrainResourceBehavior ModuleTag_NewMoneyDeadSpot
        Radius            = GENERIC_KEEP_MONEY_RANGE
        MaxIncome        = 0
        IncomeInterval        = 999999
        HighPriority        = Yes
        Visible         = No
    End

    Behavior = TransportContain ModuleTag_TransportContainTag01
        ObjectStatusOfContained      = UNSELECTABLE
        PassengerFilter              = NONE +GANDALF
        Slots                        = 1
        ShowPips                     = No
        AllowEnemiesInside           = No
        AllowNeutralInside           = No
        AllowAlliesInside            = No
        AllowOwnPlayerInsideOverride = Yes
        DamagePercentToUnits         = 0%
        TypeOneForWeaponSet          = GANDALF
        PassengerBonePrefix          = PassengerBone:B_BANNER KindOf:GANDALF
        EjectPassengersOnDeath       = Yes
        ExitDelay                    = 0
        NumberOfExitPaths            = 0
        EnterSound                   = GarrisonEnter
        ExitSound                    = GarrisonExit
        FadeFilter                   = ALL
        FadePassengerOnEnter         = Yes
        EnterFadeTime                = 1000
        FadePassengerOnExit          = Yes
        ExitFadeTime                 = 1000
        ForceOrientationContainer    = No
    End


    Behavior = MonitorConditionUpdate ModuleTag_CommandSetSwapper1
        WeaponSetFlags            = PASSENGER_TYPE_ONE
        WeaponToggleCommandSet    = IsengardMapIsengardRebuildCommandSet_Saruman
    End


    Behavior = GrantUpgradeCreate ModuleTag_EnableUpgrade
        UpgradeToGrant      = Upgrade_IsengardAufmarschTrigger
        GiveOnBuildComplete = Yes
    End

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_PalantirEnabler
        SpecialPowerTemplate = SpecialAbilityOrthancPalantir
        TriggeredBy          = Upgrade_IsengardFortressWizardsTower
        RequiresAllTriggers  = Yes
    End

    Behavior                 = OCLSpecialPower ModuleTag_PalantirVision
        SpecialPowerTemplate = SpecialAbilityOrthancPalantir
        OCL                  = SpecialPowerPalantirVision
        CreateLocation       = CREATE_AT_LOCATION
        StartsPaused         = Yes
    End








    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_LightningEnabler
        SpecialPowerTemplate        = SpecialAbilityLightningStrike
        TriggeredBy                 = Upgrade_Held5RespawnLevel Upgrade_IsengardFortressWizardsTower
        RequiresAllTriggers         = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_LightningStrike
        SpecialPowerTemplate        = SpecialAbilityLightningStrike
        UpdateModuleStartsAttack    = Yes
        StartsPaused                = Yes
        InitiateSound                = WizardTowerLightningStrikeRumbleMS
    End

    Behavior = ArrowStormUpdate ModuleTag_ShootLightningBolts
        SpecialPowerTemplate    = SpecialAbilityLightningStrike
        StartAbilityRange       = ISENGARD_WIZARDSTOWER_LIGHTNING_RANGE
        UnpackingVariation        = 1
        CanShootEmptyGround        = Yes

        UnpackTime              = 2500
        PreparationTime         = 1
        PersistentPrepTime      = 500
        PackTime                = 1500

        ApproachRequiresLOS     = No
        AwardXPForTriggering    = 0




        WeaponTemplate  = WizardTowerLightningWeapon
        TargetRadius    = ISENGARD_WIZARDSTOWER_LIGHTNING_FIRE_RADIUS
        ShotsPerTarget  = 1
        ShotsPerBurst   = 1
        MaxShots        = ISENGARD_WIZARDSTOWER_LIGHTNING_NUMSHOTS
    End

    Behavior = AutoAbilityBehavior ModuleTag_AutoAbilityLightningBehavior
        SpecialAbility                = SpecialAbilityLightningStrike
    End



    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_FireEnabler
        SpecialPowerTemplate        = SpecialAbilityWizardsTowerFireStrike
        TriggeredBy                 = Upgrade_Held5RespawnLevel Upgrade_IsengardFortressWizardsTower
        RequiresAllTriggers         = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_FireStrikeStarter
       SpecialPowerTemplate        = SpecialAbilityWizardsTowerFireStrike
       UpdateModuleStartsAttack    = Yes
       StartsPaused                = Yes
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_FireStrikeUpdate
       SpecialPowerTemplate    = SpecialAbilityWizardsTowerFireStrike
       WhichSpecialWeapon      = 1
       SkipContinue            = Yes
       UnpackTime              = 900
       PreparationTime         = 1
       PersistentPrepTime      = 1500
       PackTime                = 1100
       FreezeAfterTriggerDuration = 2500
       AwardXPForTriggering    = 0
       StartAbilityRange       = ISENGARD_WIZARDSTOWER_LIGHTNING_RANGE
       MustFinishAbility       = Yes
       SpecialWeapon           = WizardTowerFireWeapon
    End







    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_ZorndesCaradhrasEnabler
        SpecialPowerTemplate     = SpecialAbilityZorndesCaradhras
        TriggeredBy              = Upgrade_Held7RespawnLevel Upgrade_IsengardFortressWizardsTower
        RequiresAllTriggers      = Yes
    End

    Behavior = OCLSpecialPower ModuleTag_ZorndesCaradhras
        SpecialPowerTemplate     = SpecialAbilityZorndesCaradhras
        OCL                      = OCL_ZorndesCaradhrasEgg
        CreateLocation           = CREATE_AT_LOCATION
        TriggerFX                = FX_Avalanche
        StartsPaused             = Yes
    End







    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_StarlightEnabler
        SpecialPowerTemplate        = SpecialAbilitySarumanUeberzeugungskunst
        TriggeredBy                 = Upgrade_Held10RespawnLevel Upgrade_IsengardFortressWizardsTower
        RequiresAllTriggers         = Yes
    End

    Behavior = OCLSpecialPower ModuleTag_Starlight
        StartsPaused                = Yes
        SpecialPowerTemplate        = SpecialAbilitySarumanUeberzeugungskunst
        OCL                         = OCL_UeberzeugenSaruman
        CreateLocation              = CREATE_AT_LOCATION
    End

    Behavior = PassiveAreaEffectBehavior ModuleTag_FeelGoodSaruman

        EffectRadius                = 1000000000
        PingDelay                   = 2000
        ModifierName                = SarumanGiveUpgrade
        AllowFilter                 = ANY +IsengardSaruman_Mod ALLIES
    End



    Geometry        = CYLINDER
    GeometryMajorRadius    = 42.6
    GeometryMinorRadius    = 0
    GeometryHeight        = 65.2

    AdditionalGeometry    = CYLINDER
    GeometryMajorRadius    = 22.6
    GeometryMinorRadius    = 0
    GeometryHeight        = 265.2

    GeometryIsSmall        = No
    Shadow            = SHADOW_VOLUME

    AttackContactPoint    = X:0 Y:0 Z:262
    AttackContactPoint    = X:0 Y:0 Z:0
End



Object WOR_IsengardCastleBaseKeep_Edain

    SelectPortrait = BPIOrthancTower
        ButtonImage            = BIWatchTower


    Draw = W3DScriptedModelDraw ModuleTag_Draw

        ExtraPublicBone         = ARROWBONE01
        ExtraPublicBone         = ARROWBONE02
        ExtraPublicBone         = ARROWBONE03
        ExtraPublicBone         = ARROWBONE04
        ExtraPublicBone         = ARROWBONE05
        ExtraPublicBone         = ARROWBONE06
        ExtraPublicBone         = ARROWBONE07
        ExtraPublicBone         = ARROWBONE08
        ExtraPublicBone         = ARROWBONE09
        ExtraPublicBone         = ARROWBONE10
        ExtraPublicBone         = ARROWBONE11
        ExtraPublicBone         = ARROWBONE12
        ExtraPublicBone         = ARROWBONE13
        ExtraPublicBone         = ARROWBONE14
        ExtraPublicBone         = ARROWBONE15
        ExtraPublicBone         = ARROWBONE16
        ExtraPublicBone         = B_BANNER

        OkToChangeModelColor  = Yes
        UseStandardModelNames = Yes

        DefaultModelConditionState
           Model = iborthancea
        End



        ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
        Model               = IB_Orthanc_A

        ParticleSysBone     = NONE BuildingContructDust
        End

        AnimationState          = ACTIVELY_BEING_CONSTRUCTED
            Animation
                AnimationName    = IB_Orthanc_A.IB_Orthanc_A
                AnimationMode   = MANUAL
            End
            BeginScript

            EndScript
        End


        ModelConditionState   = BASE_BUILD
            Model               = IB_Orthanc_A

            ParticleSysBone     = NONE BuildingContructDust
        End

        AnimationState          = BASE_BUILD
            Animation
                AnimationName = IB_Orthanc_A.IB_Orthanc_A
                AnimationMode = ONCE
                AnimationBlendTime = 0
                AnimationSpeedFactorRange = 2.0 2.0
            End
            BeginScript

            EndScript
        End

        AnimationState          = JUST_BUILT
            Animation
                AnimationName = IB_Orthanc_A.IB_Orthanc_A
                AnimationMode = MANUAL
                AnimationBlendTime = 0
            End
            Flags = START_FRAME_FIRST
            BeginScript

            EndScript
        End

        ModelConditionState  = DAMAGED
        Model         = iborthancea
        End

        AnimationState = DAMAGED
        EnteringStateFX    = FX_BuildingDamaged
        End

        ModelConditionState  = REALLYDAMAGED
        Model         = iborthancea

        End
        AnimationState = REALLYDAMAGED
               Animation                =    ReallyDamagedanimation
                AnimationName        =     iborthancea.iborthancea
                AnimationMode        =    ONCE
               End
             EnteringStateFX    = FX_BuildingReallyDamaged
        End

        ModelConditionState  = RUBBLE
        Model         = iborthancea
        ParticleSysBone FXbone02 BaradDurDust01 FollowBone:Yes
        ParticleSysBone NONE CastleExplosion
        End

        AnimationState = RUBBLE
            Animation                =    Death
                AnimationName        =    iborthancea.iborthancea
                AnimationMode        =    ONCE
            End
            EnteringStateFX = FX_StructureMediumCollapse
        End

        ModelConditionState  = POST_RUBBLE
            Model         = IB_Orthanc_R
        End

        ModelConditionState  = POST_COLLAPSE
            Model         = IB_Orthanc_R
        End
    End


    #include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

    SoundOnDamaged                    = BuildingLightDamageStone
    SoundOnReallyDamaged            = BuildingHeavyDamageStone

    VoiceSelectUnderConstruction    = BuildingEvilVoiceSelectUnderConstruction
    VoiceSelect                        = IsengardFortressSelect

    UnitSpecificSounds
        UnderConstruction        = BuildingBigConstructionLoop

        UnderRepairFromRubble    = BuildingBigConstructionLoop
    End



    DisplayName        = OBJECT:IsengardCastleBaseKeep
    Side               = WOR
    EditorSorting      = STRUCTURE
    ThreatLevel        = 1.0
    BuildCost               = 5000
    BuildTime               = 120.0
    VisionRange             = 400
    ShroudClearingRange     = 800

    ArmorSet
        Conditions    = None
        Armor        = FortressArmor
        DamageFX    = OrthancDamageFX
    End

    WeaponSet
        Conditions        = None
    End

    WeaponSet
        Conditions        = PASSENGER_TYPE_ONE
    End

    WeaponSet
        Conditions        = PASSENGER_TYPE_TWO
    End

    CommandSet        = GenericKeepCommandSet

    HealthBoxHeightOffset    = -200



    KindOf            = VITAL_FOR_BASE_SURVIVAL PRELOAD SELECTABLE STRUCTURE IMMOBILE SCORE CASTLE_KEEP MP_COUNT_FOR_VICTORY CAN_ATTACK FS_FACTORY AUTO_RALLYPOINT DOZER_FACTORY NEVER_CULL_FOR_MP COMMANDCENTER DONT_HIDE_IF_FOGGED GARRISON GARRISONABLE_UNTIL_DESTROYED TRANSPORT
    RadarPriority        = STRUCTURE
    KeepSelectableWhenDead    = Yes

    Behavior = AIUpdateInterface ModuleTag_SoWeCanUseWeapon
        AutoAcquireEnemiesWhenIdle = Yes ATTACK_BUILDINGS
        MoodAttackCheckRate        = 250
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSetDwarven
        TriggeredBy    = Upgrade_DwarfFaction
        CommandSet    = DwarvenMonumentFortressRebuildCommandSetMod
    End
    Behavior = CommandSetUpgrade ModuleTag_CommandSetMen
        TriggeredBy    = Upgrade_MenFaction
        CommandSet    = GondorMonumentFortressRebuildCommandSetMod
    End
    Behavior = CommandSetUpgrade ModuleTag_CommandSetRohan
        TriggeredBy    = Upgrade_RohanFaction
        CommandSet    = RohanMonumentFortressRebuildCommandSetMod
    End
    Behavior = CommandSetUpgrade ModuleTag_CommandSetImladris
        TriggeredBy    = Upgrade_ImladrisFaction
        CommandSet    = ImladrisMonumentFortressRebuildCommandSetMod
    End
    Behavior = CommandSetUpgrade ModuleTag_CommandSetElven
        TriggeredBy    = Upgrade_LothlorienFaction
        CommandSet    = LothlorienMonumentFortressRebuildCommandSetMod
    End
    Behavior = CommandSetUpgrade ModuleTag_CommandSetArnor
        TriggeredBy    = Upgrade_ArnorFaction
        CommandSet    = ArnorMonumentFortressRebuildCommandSetMod
    End
    Behavior = CommandSetUpgrade ModuleTag_CommandSetIsengard
        TriggeredBy    = Upgrade_IsengardFaction
        CommandSet    = IsengardMapIsengardRebuildCommandSet
    End
    Behavior = CommandSetUpgrade ModuleTag_CommandSetMordor
        TriggeredBy    = Upgrade_MordorFaction
        CommandSet    = MordorMonumentFortressRebuildCommandSetMod
    End
    Behavior = CommandSetUpgrade ModuleTag_CommandSetWild
        TriggeredBy    = Upgrade_WildFaction
        CommandSet    = WildMonumentFortressRebuildCommandSetMod
    End
    Behavior = CommandSetUpgrade ModuleTag_CommandSetAngmar
        TriggeredBy    = Upgrade_AngmarFaction
        CommandSet    = AngmarMonumentFortressRebuildCommandSetMod
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSet1
        TriggeredBy       = Upgrade_SubFactionErebor
        CommandSet        = DwarvenMonumentFortressRebuildCommandSetMod_mitZwergenreich
    End
    Behavior = CommandSetUpgrade ModuleTag_CommandSet2
        TriggeredBy       = Upgrade_SubFactionIronHills
        CommandSet        = DwarvenMonumentFortressRebuildCommandSetMod_mitZwergenreich
    End
    Behavior = CommandSetUpgrade ModuleTag_CommandSet3
        TriggeredBy       = Upgrade_SubFactionEredLuin
        CommandSet        = DwarvenMonumentFortressRebuildCommandSetMod_mitZwergenreich
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSetKrone1
        TriggeredBy         = Upgrade_GreatGoblinCrown
        CommandSet          = WildMonumentFortressRebuildCommandSetMod_King
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSetKrone2
        TriggeredBy         = Upgrade_DurbutzCrown
        CommandSet          = WildMonumentFortressRebuildCommandSetMod_King
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSetKrone3
        TriggeredBy         = Upgrade_GorkilCrown
        CommandSet          = WildMonumentFortressRebuildCommandSetMod_King
    End

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_SummonPortalEnabler
        SpecialPowerTemplate         = SpellSummonUnderworldPortal
        TriggeredBy                  = Upgrade_GlobalFirstAgeSpell
    End

    Behavior = OCLSpecialPower ModuleTag_SummonPortal
        SpecialPowerTemplate         = SpellSummonUnderworldPortal
        OCL                          = OCL_SummonUnderworldPortal
        CreateLocation               = CREATE_AT_LOCATION
        StartsPaused                 = Yes
    End

    Behavior = AISpecialPowerUpdate SummonPortal_AI
        CommandButtonName  = Command_SummonUnderworldPortal
        SpecialPowerAIType = AI_SPELLBOOK_ASSIST_BATTLE_DEBUFF
        SpecialPowerRadius = 1000
        RandomizeTargetLocation = Yes
    End

    Behavior = ProductionUpdate ProductionUpdateModuleTag
		ProductionModifier
		RequiredUpgrade = Upgrade_ObjectUnderAIControl
		TimeMultiplier  = TIME_MULTIPLIER_AI_HEROES
		HeroRevive      = Yes
		ModifierFilter  = NONE +HERO
	End
	ProductionModifier
		RequiredUpgrade = Upgrade_BrutalAIMultiPlayer Upgrade_BrutalAISinglePlayer
		CostMultiplier  = COST_MULTIPLIER_AI_HEROES
		HeroPurchase    = Yes
		HeroRevive      = Yes
		ModifierFilter  = NONE +HERO
	End
    End

    Behavior = QueueProductionExitUpdate ModuleTag_QueuePEU
        UnitCreatePoint            = X:0.0 Y:-0.0 Z:0.0
        NaturalRallyPoint        = X:50.0 Y:-60.0 Z:0.0
        ExitDelay            = STANDARD_HERO_EXIT_DELAY
        AllowAirborneCreation        = Yes
    End


    Behavior = GettingBuiltBehavior GetBuiltBehaviorTag
        SelfBuildingLoop        = BuildingBigConstructionLoop
        SelfRepairFromDamageLoop    = NoSound
        SelfRepairFromRubbleLoop    = BuildingBigConstructionLoop
        SpawnTimer            = -1.0
        RebuildTimeSeconds        = 120
    End

    Behavior = CastleMemberBehavior ModuleTag_CMB
        BeingBuiltSound = BuildingBigConstructionLoop
    End

    Body = ActiveBody ModuleTag_02
        MaxHealth        = MONUMENT_FORTRESS_HEALTH
        MaxHealthDamaged    = MONUMENT_FORTRESS_HEALTH_DAMAGED
        MaxHealthReallyDamaged    = MONUMENT_FORTRESS_HEALT_REALLY_DAMAGED
    End

    Behavior = KeepObjectDie ModuleTag_IWantRubble
    End


    Behavior = AutoDepositUpdate AutoDepositModuleTag
        DepositTiming           = GENERIC_KEEP_MONEY_TIME
        DepositAmount           = 80
        InitialCaptureBonus     = 0
    End

    Behavior = TerrainResourceBehavior ModuleTag_NewMoneyDeadSpot
        Radius            = GENERIC_KEEP_MONEY_RANGE
        MaxIncome        = 0
        IncomeInterval     = 999999
        HighPriority        = Yes
        Visible            = No
    End

    Behavior = TransportContain ModuleTag_TransportContainTag01
        ObjectStatusOfContained      = UNSELECTABLE
        PassengerFilter              = NONE +GANDALF
        Slots                        = 1
        ShowPips                     = No
        AllowEnemiesInside           = No
        AllowNeutralInside           = No
        AllowAlliesInside            = No
        AllowOwnPlayerInsideOverride = Yes
        DamagePercentToUnits         = 0%
        TypeOneForWeaponSet          = GANDALF
        PassengerBonePrefix          = PassengerBone:B_BANNER KindOf:GANDALF
        EjectPassengersOnDeath       = Yes
        ExitDelay                    = 0
        NumberOfExitPaths            = 0
        EnterSound                   = GarrisonEnter
        ExitSound                    = GarrisonExit
        FadeFilter                   = ALL
        FadePassengerOnEnter         = Yes
        EnterFadeTime                = 1000
        FadePassengerOnExit          = Yes
        ExitFadeTime                 = 1000
        ForceOrientationContainer    = No
    End


    Behavior = MonitorConditionUpdate ModuleTag_CommandSetSwapper1
        WeaponSetFlags            = PASSENGER_TYPE_ONE
        WeaponToggleCommandSet    = IsengardMapIsengardRebuildCommandSet_Saruman
    End


    Behavior = GrantUpgradeCreate ModuleTag_EnableUpgrade
        UpgradeToGrant      = Upgrade_IsengardAufmarschTrigger
        GiveOnBuildComplete = Yes
    End

	#include "..\..\..\FortressRingFunc.inc"






    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_PalantirEnabler
        SpecialPowerTemplate = SpecialAbilityOrthancPalantir
        TriggeredBy          = Upgrade_IsengardFortressWizardsTower
        RequiresAllTriggers  = Yes
    End

    Behavior                 = OCLSpecialPower ModuleTag_PalantirVision
        SpecialPowerTemplate = SpecialAbilityOrthancPalantir
        OCL                  = SpecialPowerPalantirVision
        CreateLocation       = CREATE_AT_LOCATION
        StartsPaused         = Yes
    End








    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_LightningEnabler
        SpecialPowerTemplate        = SpecialAbilityLightningStrike
        TriggeredBy                 = Upgrade_Held5RespawnLevel Upgrade_IsengardFortressWizardsTower
        RequiresAllTriggers         = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_LightningStrike
        SpecialPowerTemplate        = SpecialAbilityLightningStrike
        UpdateModuleStartsAttack    = Yes
        StartsPaused                = Yes
        InitiateSound                = WizardTowerLightningStrikeRumbleMS
    End

    Behavior = ArrowStormUpdate ModuleTag_ShootLightningBolts
        SpecialPowerTemplate    = SpecialAbilityLightningStrike
        StartAbilityRange       = ISENGARD_WIZARDSTOWER_LIGHTNING_RANGE
        UnpackingVariation        = 1
        CanShootEmptyGround        = Yes

        UnpackTime              = 2500
        PreparationTime         = 1
        PersistentPrepTime      = 500
        PackTime                = 1500

        ApproachRequiresLOS     = No
        AwardXPForTriggering    = 0




        WeaponTemplate  = WizardTowerLightningWeapon
        TargetRadius    = ISENGARD_WIZARDSTOWER_LIGHTNING_FIRE_RADIUS
        ShotsPerTarget  = 1
        ShotsPerBurst   = 1
        MaxShots        = ISENGARD_WIZARDSTOWER_LIGHTNING_NUMSHOTS
    End

    Behavior = AutoAbilityBehavior ModuleTag_AutoAbilityLightningBehavior
        SpecialAbility                = SpecialAbilityLightningStrike
    End



    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_FireEnabler
        SpecialPowerTemplate        = SpecialAbilityWizardsTowerFireStrike
        TriggeredBy                 = Upgrade_Held5RespawnLevel Upgrade_IsengardFortressWizardsTower
        RequiresAllTriggers         = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_FireStrikeStarter
       SpecialPowerTemplate        = SpecialAbilityWizardsTowerFireStrike
       UpdateModuleStartsAttack    = Yes
       StartsPaused                = Yes
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_FireStrikeUpdate
       SpecialPowerTemplate    = SpecialAbilityWizardsTowerFireStrike
       WhichSpecialWeapon      = 1
       SkipContinue            = Yes
       UnpackTime              = 900
       PreparationTime         = 1
       PersistentPrepTime      = 1500
       PackTime                = 1100
       FreezeAfterTriggerDuration = 2500
       AwardXPForTriggering    = 0
       StartAbilityRange       = ISENGARD_WIZARDSTOWER_LIGHTNING_RANGE
       MustFinishAbility       = Yes
       SpecialWeapon           = WizardTowerFireWeapon
    End







    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_ZorndesCaradhrasEnabler
        SpecialPowerTemplate     = SpecialAbilityZorndesCaradhras
        TriggeredBy              = Upgrade_Held7RespawnLevel Upgrade_IsengardFortressWizardsTower
        RequiresAllTriggers      = Yes
    End

    Behavior = OCLSpecialPower ModuleTag_ZorndesCaradhras
        SpecialPowerTemplate     = SpecialAbilityZorndesCaradhras
        OCL                      = OCL_ZorndesCaradhrasEgg
        CreateLocation           = CREATE_AT_LOCATION
        TriggerFX                = FX_Avalanche
        StartsPaused             = Yes
    End







    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_StarlightEnabler
        SpecialPowerTemplate        = SpecialAbilitySarumanUeberzeugungskunst
        TriggeredBy                 = Upgrade_Held10RespawnLevel Upgrade_IsengardFortressWizardsTower
        RequiresAllTriggers         = Yes
    End

    Behavior = OCLSpecialPower ModuleTag_Starlight
        StartsPaused                = Yes
        SpecialPowerTemplate        = SpecialAbilitySarumanUeberzeugungskunst
        OCL                         = OCL_UeberzeugenSaruman
        CreateLocation              = CREATE_AT_LOCATION
    End


    Behavior = PassiveAreaEffectBehavior ModuleTag_FeelGoodSaruman

        EffectRadius                = 1000000000
        PingDelay                   = 2000
        ModifierName                = SarumanGiveUpgrade
        AllowFilter                 = ANY +IsengardSaruman_Mod ALLIES
    End


    Geometry        = CYLINDER
    GeometryMajorRadius    = 80
    GeometryMinorRadius    = 0
    GeometryHeight         = 120

    AdditionalGeometry     = CYLINDER
    GeometryMajorRadius    = 44
    GeometryMinorRadius    = 0
    GeometryHeight         = 450.2

    GeometryIsSmall        = No
    Shadow                 = SHADOW_VOLUME

    AttackContactPoint     = X:0 Y:0 Z:450
    AttackContactPoint     = X:0 Y:0 Z:0
    Scale = 1.9
End