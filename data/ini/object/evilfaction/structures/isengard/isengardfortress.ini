Object IsengardFortressCenterGeneric

    SelectPortrait = BPIFortress

    Draw = W3DScriptedModelDraw ModuleTag_01

        DefaultModelConditionState
              Model = None
        End

        ModelConditionState = WORLD_BUILDER
            Model = NBasePin
        End
    End

    Side              = Isengard
    EditorSorting     = STRUCTURE
    KindOf            = IMMOBILE BASE_FOUNDATION CASTLE_CENTER

    Behavior = CastleBehavior ModuleTag_castle
        FilterValidOwnedEntries = ANY +STRUCTURE +WALK_ON_TOP_OF_WALL +BASE_FOUNDATION +TACTICAL_MARKER
    End
End


Object IsengardFortressExpansionPadCorner

    SelectPortrait = BPIFortress_BuildPlot



    Draw = W3DFloorDraw DrawFloorBase
        ModelName = IBFoundation
    End

    Draw = W3DScriptedModelDraw ModuleTag_DrawMain
        DefaultModelConditionState
            Model = WBFoundationP
        End

        ModelConditionState = CONSTRUCTION_COMPLETE
            Model = None
        End
    End


    DisplayName         = OBJECT:IsengardBuildingFoundation
    Side                = Isengard
    EditorSorting       = STRUCTURE
    ThreatLevel         = 1.0

    BuildCost           = 1
    BuildTime           = 5.0
    VisionRange         = 0.0
    ShroudClearingRange = 0

    CommandSet 		= IsengardFortressExpansionPadCornerCommandSet



    VoiceSelect = Gui_PlotSelect2


    KindOf              = STRUCTURE SELECTABLE IMMOBILE BASE_FOUNDATION UNATTACKABLE MP_COUNT_FOR_VICTORY NO_COLLIDE DO_NOT_CLASSIFY EXPANSION_PAD

    Behavior        = FoundationAIUpdate ModuleTag_foundationAI
        BuildVariation    = 2
    End

    Behavior = CastleMemberBehavior ModuleTag_CMB
    End

    Body                = ImmortalBody ModuleTag_05
        MaxHealth      = DEFAULT_FORTRESS_HEALTH
    End

    Geometry                   = BOX
    GeometryMajorRadius        = 5.0
    GeometryMinorRadius        = 5.0
    GeometryHeight             = 0.8
    GeometryIsSmall            = No
    Shadow                     = SHADOW_VOLUME
    BuildCompletion            = PLACED_BY_PLAYER
End

ChildObject IsengardFortressExpansionPadSide IsengardFortressExpansionPadCorner

    CommandSet = IsengardFortressExpansionPadSideCommandSet

    Behavior            = FoundationAIUpdate ModuleTag_foundationAI
        BuildVariation = 1
    End
End


Object IsengardFortressCitadel

Draw = W3DFloorDraw ModuleTag_DrawFortressFloor
    ModelName				= FL_ISENGARD
    StartHidden 				= No
    HideIfModelConditions		= AWAITING_CONSTRUCTION
    HideIfModelConditions		= PARTIALLY_CONSTRUCTED
    ForceToBack 				= Yes
    FloorFadeRateOnObjectDeath  = -0.01
End

    SelectPortrait = BPIFortress

    Draw = W3DScriptedModelDraw ModuleTag_Draw
        ExtraPublicBone         = ARROW_01
        ExtraPublicBone         = ARROW_02
        ExtraPublicBone         = ARROW_03
        ExtraPublicBone         = ARROW_04
        ExtraPublicBone         = ARROW_05
        ExtraPublicBone         = ARROW_06
        ExtraPublicBone         = ARROW_07
        ExtraPublicBone         = ARROW_08
        ExtraPublicBone         = ARROW_09
        ExtraPublicBone         = ARROW_10
        ExtraPublicBone         = ARROW_11
        ExtraPublicBone         = ARROW_12
        ExtraPublicBone         = ARROW_13
        ExtraPublicBone         = ARROW_14
        ExtraPublicBone         = ARROW_15
        ExtraPublicBone         = ARROW_16
        ExtraPublicBone         = ARROW_17
        ExtraPublicBone         = ARROW_18
        ExtraPublicBone         = ARROW_19
        ExtraPublicBone         = ARROW_20
        ExtraPublicBone         = ARROW_21
        ExtraPublicBone         = ARROW_22
        ExtraPublicBone         = ARROW_23
        ExtraPublicBone         = ARROW_24
        ExtraPublicBone         = ARROW_25
        ExtraPublicBone         = ARROW_26
        ExtraPublicBone         = ARROW_27
        ExtraPublicBone         = ARROW_28
        ExtraPublicBone         = ARROW_29
        ExtraPublicBone         = ARROW_30
        ExtraPublicBone         = ARROW_31
        ExtraPublicBone         = ARROW_32
        ExtraPublicBone         = B_BANNER
        OkToChangeModelColor    = Yes
        UseStandardModelNames   = Yes
        StaticModelLODMode      = Yes

        DefaultModelConditionState
            Model                = ibfmagfortres
        End

        ModelConditionState  = DAMAGED
            Model         = ibfmagfortres
            Texture        = IBFortress.tga IBFortress_D.tga
        End
        AnimationState = DAMAGED
            EnteringStateFX    = FX_FortressDamaged
        End

        ModelConditionState  = REALLYDAMAGED
            Model         = ibfmagfortres
        End
        AnimationState = REALLYDAMAGED
            Animation    = ReallyDamagedAnimation
                AnimationName        =    ibfmagfortres.ibfmagfortres
                AnimationMode        =    ONCE
            End
            EnteringStateFX    = FX_FortressReallyDamaged
        End

        ModelConditionState  = RUBBLE
            Model         = IBFortress_D3
            ParticleSysBone SmokeLarge01 SmokeBuildingLarge
        End
        AnimationState = RUBBLE
            Animation    = RubbleAnimation
                AnimationName        =    IBFortress_D3S.IBFortress_D3A
                AnimationMode        =    ONCE
            End
            EnteringStateFX    = FX_FortressCollapse
        End

        ModelConditionState  = POST_RUBBLE
            Model         = None
            ParticleSysBone NONE SmokeBuildingMediumRubble
        End

        AnimationState = POST_RUBBLE
        End

        ModelConditionState  = POST_COLLAPSE
            Model         = None
            ParticleSysBone NONE SmokeBuildingMediumRubble
        End
        AnimationState = POST_COLLAPSE
        End

        ModelConditionState = UPGRADE_NUMENOR_STONEWORK
            Model    = ibfmagfortres
            Texture    = IBFortress.tga IBFortress_U.tga
        End

        ModelConditionState = UPGRADE_NUMENOR_STONEWORK SNOW
            Model      = ibfmagfortres
            Texture    = IBFortress.tga IBFortress_U.tga
        End

        ModelConditionState = SNOW
            Model = ibfmagfortres
            Texture    = IBFortress.tga IBFortress_snow.tga
        End
    End

    Draw = W3DScriptedModelDraw ModuleTag_DrawOrcfireMunitions
        ExtraPublicBone         = B_BANNER
        OkToChangeModelColor    = Yes
        StaticModelLODMode        = Yes

        DefaultModelConditionState
            Model    = None
        End

        IdleAnimationState
            StateName        = NoOrcFire
        End


        ModelConditionState = FORTRESS_IMPROVEMENT_1 USER_3 DAMAGED
            Model           = IBFOrcfire_A
            Texture            = IBFortress.tga IBFortress_D.tga
        End

        ModelConditionState = FORTRESS_IMPROVEMENT_1 USER_3 REALLYDAMAGED
            Model           = IBFOrcfire_A
            Texture            = IBFortress.tga IBFortress_D.tga
        End

        ModelConditionState = FORTRESS_IMPROVEMENT_1 USER_3
            Model           = IBFOrcfire_A
        End

        AnimationState = FORTRESS_IMPROVEMENT_1 USER_3
            Animation                    = RiseUp
                AnimationName            = IBFOrcfire_ASK.IBFOrcfire_ABL
                AnimationMode            = ONCE
                AnimationSpeedFactorRange = 8.0 8.0
            End
        End

        ModelConditionState = FORTRESS_IMPROVEMENT_1 DAMAGED
            Model        = IBFOrcfire_D1
            ParticleSysBone     = glowBone01 SmokeDwfFort FollowBone:Yes
            ParticleSysBone     = glowBone02 SmokeDwfFort FollowBone:Yes
            ParticleSysBone     = glowBone03 SmokeDwfFort FollowBone:Yes
            ParticleSysBone     = glowBone04 SmokeDwfFort FollowBone:Yes
            ParticleSysBone     = glowBone05 SmokeDwfFort FollowBone:Yes
        End

        AnimationState    = FORTRESS_IMPROVEMENT_1 DAMAGED
            StateName    = Damaged
        End

        ModelConditionState = FORTRESS_IMPROVEMENT_1 REALLYDAMAGED
            Model        = IBFOrcfire_D2
            ParticleSysBone     = glowBone01 SmokeDwfFort FollowBone:Yes
            ParticleSysBone     = glowBone02 SmokeDwfFort FollowBone:Yes
            ParticleSysBone     = glowBone03 SmokeDwfFort FollowBone:Yes
            ParticleSysBone     = glowBone04 SmokeDwfFort FollowBone:Yes
            ParticleSysBone     = glowBone05 SmokeDwfFort FollowBone:Yes
        End

        AnimationState = FORTRESS_IMPROVEMENT_1 REALLYDAMAGED
            Animation                    = StandingDamaged
                AnimationName            = IBFOrcfire_D2S.IBFOrcfire_D2A
                AnimationMode            = ONCE
            End
        End

        ModelConditionState = FORTRESS_IMPROVEMENT_1 RUBBLE
            Model        = IBFOrcfire_D3
        End

        AnimationState    = FORTRESS_IMPROVEMENT_1 RUBBLE
            Animation    = IBFOrcfire_Rubble
                AnimationName        = IBFOrcfire_D3S.IBFOrcfire_D3A
                AnimationMode        = ONCE
            End
        End

        ModelConditionState = FORTRESS_IMPROVEMENT_1 SNOW
            Model = IBFOrcfire
            Texture    = IBFortress.tga IBFortress_snow.tga
        End

        ModelConditionState = FORTRESS_IMPROVEMENT_1
            Model           = IBFOrcfire
            ParticleSysBone     = glowBone01 SmokeDwfFort FollowBone:Yes
            ParticleSysBone     = glowBone02 SmokeDwfFort FollowBone:Yes
            ParticleSysBone     = glowBone03 SmokeDwfFort FollowBone:Yes
            ParticleSysBone     = glowBone04 SmokeDwfFort FollowBone:Yes
            ParticleSysBone     = glowBone05 SmokeDwfFort FollowBone:Yes
        End
    End

    Draw = W3DScriptedModelDraw ModuleTag_DrawMurderOfCrows
        ExtraPublicBone         = B_BANNER

        DefaultModelConditionState
            Model           = None
        End

        ModelConditionState = FORTRESS_IMPROVEMENT_2
            Model        = Crebain_SKN
        End

        AnimationState    = FORTRESS_IMPROVEMENT_2
            Animation    = WBFBCloud
                AnimationName    = Crebain_SKL.Crebain_IDLB
                AnimationMode    = LOOP
            End
            Flags                = START_FRAME_FIRST
        End
    End


    Draw = W3DScriptedModelDraw ModuleTag_DrawExcavations
        ExtraPublicBone         = B_BANNER

        StaticModelLODMode        = Yes

        DefaultModelConditionState
            Model           = None
        End

        IdleAnimationState
            StateName = NoExcavations
        End


        ModelConditionState = FORTRESS_IMPROVEMENT_3 USER_1 DAMAGED
            Model           = IBFExcav_A
            Texture            = IBFortress.tga IBFortress_D.tga
        End

        ModelConditionState = FORTRESS_IMPROVEMENT_3 USER_1 REALLYDAMAGED
            Model           = IBFExcav_A
            Texture            = IBFortress.tga IBFortress_D.tga
        End

        ModelConditionState = FORTRESS_IMPROVEMENT_3 USER_1 SNOW
            Model = IBFExcav_A
            Texture    = IBFortress.tga IBFortress_snow.tga
        End

        ModelConditionState = FORTRESS_IMPROVEMENT_3 USER_1
            Model           = IBFExcav_A
        End

        AnimationState = FORTRESS_IMPROVEMENT_3 USER_1
            Animation                        = UpAndStill
                AnimationName                = IBFExcav_ASKL.IBFExcav_ABLD
                AnimationMode                = ONCE
                AnimationSpeedFactorRange     = 5.0 5.0
            End
        End


        ModelConditionState = FORTRESS_IMPROVEMENT_3 DAMAGED
            Model        = IBFExcav
            Texture        = IBFortress.tga IBFortress_D.tga
        End

        ModelConditionState = FORTRESS_IMPROVEMENT_3 REALLYDAMAGED
            Model        = IBFExcav
            Texture        = IBFortress.tga IBFortress_D.tga
        End

        ModelConditionState = FORTRESS_IMPROVEMENT_3 RUBBLE
            Model        = IBFExcav_D3
        End

        AnimationState    = FORTRESS_IMPROVEMENT_3 RUBBLE
            Animation    = IBFExcav_Rubble
                AnimationName        = IBFExcav_D3SKL.IBFExcav_D3AN
                AnimationMode        = ONCE
            End
        End


        ModelConditionState = FORTRESS_IMPROVEMENT_3 SNOW
            Model = IBFExcav
            Texture    = IBFortress.tga IBFortress_snow.tga
        End

        ModelConditionState = FORTRESS_IMPROVEMENT_3
            Model           = IBFExcav
        End

        AnimationState = FORTRESS_IMPROVEMENT_3
            Animation                    = UpAndStill
                AnimationName            = IBFExcavSKL.IBFExcavAN
                AnimationMode            = LOOP
            End
        End
    End


    Draw = W3DScriptedModelDraw ModuleTag_DrawExcavationsDestructibles
        ExtraPublicBone         = B_BANNER

        StaticModelLODMode        = Yes

        DefaultModelConditionState
            Model           = None
        End


        ModelConditionState = FORTRESS_IMPROVEMENT_3 USER_1 DAMAGED
            Model           = IBFExcavB_A
            Texture            = IBFortress.tga IBFortress_D.tga
        End

        ModelConditionState = FORTRESS_IMPROVEMENT_3 USER_1 REALLYDAMAGED
            Model           = IBFExcavB_A
            Texture            = IBFortress.tga IBFortress_D.tga
        End

        ModelConditionState = FORTRESS_IMPROVEMENT_3 USER_1
            Model           = IBFExcavB_A
        End

        AnimationState = FORTRESS_IMPROVEMENT_3 USER_1
            Animation                        = UpAndStill
                AnimationName                = IBFExcavB_ASKL.IBFExcavB_ABLD
                AnimationMode                = ONCE
                AnimationSpeedFactorRange     = 5.0 5.0
            End
        End


        ModelConditionState = FORTRESS_IMPROVEMENT_3 DAMAGED
            Model        = IBFExcavB
            Texture        = IBFortress.tga IBFortress_D.tga
        End

        ModelConditionState = FORTRESS_IMPROVEMENT_3 REALLYDAMAGED
            Model        = IBFExcavB
            Texture        = IBFortress.tga IBFortress_D.tga
        End

        ModelConditionState = FORTRESS_IMPROVEMENT_3 RUBBLE
            Model    = IBFExcavB_D3
        End

        AnimationState        = FORTRESS_IMPROVEMENT_3 RUBBLE
            Animation    = Rubble
                AnimationName    = IBFExcavB_D3SK.IBFExcavB_D3AN
                AnimationMode    = ONCE
            End
        End


        ModelConditionState = FORTRESS_IMPROVEMENT_3 SNOW
            Model = IBFExcavB
            Texture    = IBFortress.tga IBFortress_snow.tga
        End

        ModelConditionState = FORTRESS_IMPROVEMENT_3
            Model           = IBFExcavB
        End
    End


    Draw = W3DScriptedModelDraw ModuleTag_DrawBurningForges
        ExtraPublicBone         = B_BANNER

        StaticModelLODMode        = Yes

        DefaultModelConditionState
            Model           = None
        End


        ModelConditionState = FORTRESS_IMPROVEMENT_4 USER_2 DAMAGED
            Model           = IBFBForges_A
            Texture            = IBFortress.tga IBFortress_D.tga
        End

        ModelConditionState = FORTRESS_IMPROVEMENT_4 USER_2 REALLYDAMAGED
            Model           = IBFBForges_A
            Texture            = IBFortress.tga IBFortress_D.tga
        End

        ModelConditionState = FORTRESS_IMPROVEMENT_4 USER_2
            Model           = IBFBForges_A
        End

        ModelConditionState = FORTRESS_IMPROVEMENT_4 USER_2 SNOW
            Model            = IBFBForges_A
            Texture            = IBFortress.tga IBFortress_snow.tga
        End

        AnimationState = FORTRESS_IMPROVEMENT_4 USER_2
            Animation                        = UpAndStill
                AnimationName                = IBFBForges_ASK.IBFBForges_ABL
                AnimationMode                = ONCE
                AnimationSpeedFactorRange     = 5.0 5.0
            End
        End


        ModelConditionState = FORTRESS_IMPROVEMENT_4 DAMAGED
            Model        = IBFBForges
            Texture        = IBFortress.tga IBFortress_D.tga
        End

        ModelConditionState = FORTRESS_IMPROVEMENT_4 REALLYDAMAGED
            Model        = IBFBForges
            Texture        = IBFortress.tga IBFortress_D.tga
        End

        ModelConditionState = FORTRESS_IMPROVEMENT_4 RUBBLE
            Model        = None
        End


        ModelConditionState = FORTRESS_IMPROVEMENT_4 SNOW
            Model = IBFBForges
            Texture    = IBFortress.tga IBFortress_snow.tga
        End

        ModelConditionState = FORTRESS_IMPROVEMENT_4
            Model        = IBFBForges
        End

        AnimationState    = FORTRESS_IMPROVEMENT_4
            Animation    = IBFBForges
                AnimationName    = IBFBForges_SKL.IBFBForges_AN
                AnimationMode    = LOOP_BACKWARDS
                AnimationBlendTime    = 20
            End
        End
    End


    Draw = W3DScriptedModelDraw ModuleTag_DrawBurningForgesDescrutbiles
        ExtraPublicBone         = B_BANNER

        StaticModelLODMode        = Yes

        DefaultModelConditionState
            Model           = None
        End


        ModelConditionState = FORTRESS_IMPROVEMENT_4 USER_2 DAMAGED
            Model           = IBFBForgB_A
            Texture            = IBFortress.tga IBFortress_D.tga
        End

        ModelConditionState = FORTRESS_IMPROVEMENT_4 USER_2 REALLYDAMAGED
            Model           = IBFBForgB_A
            Texture            = IBFortress.tga IBFortress_D.tga
        End

        ModelConditionState = FORTRESS_IMPROVEMENT_4 USER_2 SNOW
            Model       = IBFBForgB_A
            Texture        = IBFortress.tga IBFortress_snow.tga
        End

        ModelConditionState = FORTRESS_IMPROVEMENT_4 USER_2
            Model           = IBFBForgB_A
        End

        AnimationState = FORTRESS_IMPROVEMENT_4 USER_2
            Animation                        = UpAndStill
                AnimationName                = IBFBForgB_ASKL.IBFBForgB_ABLD
                AnimationMode                = ONCE
                AnimationSpeedFactorRange     = 5.0 5.0
            End
        End


        ModelConditionState = FORTRESS_IMPROVEMENT_4 DAMAGED
            Model        = IBFBForgB
            Texture        = IBFortress.tga IBFortress_D.tga
        End

        ModelConditionState = FORTRESS_IMPROVEMENT_4 REALLYDAMAGED
            Model        = IBFBForgB_D2
        End

        AnimationState    = FORTRESS_IMPROVEMENT_4 REALLYDAMAGED
            Animation    = IBFBForgB
                AnimationName    = IBFBForgesB_D2SK.IBFBForgesB_D2AN
                AnimationMode    = ONCE
            End
            Flags                = START_FRAME_FIRST
        End

        ModelConditionState = FORTRESS_IMPROVEMENT_4 RUBBLE
            Model        = IBFBForgB_D3
        End

        AnimationState    = FORTRESS_IMPROVEMENT_4 RUBBLE
            Animation    = IBFBForgB
                AnimationName    = IBFBForgB_D3SK.IBFBForgB_D3AN
                AnimationMode    = ONCE
            End
            Flags                = START_FRAME_FIRST
        End


        ModelConditionState = FORTRESS_IMPROVEMENT_4 SNOW
            Model = IBFBForgB
            Texture    = IBFortress.tga IBFortress_snow.tga
        End

        ModelConditionState = FORTRESS_IMPROVEMENT_4
            Model        = IBFBForgB
        End
    End

    Draw = W3DScriptedModelDraw ModuleTag_DrawForgeGuy
        ExtraPublicBone         = B_BANNER
        AttachToBoneInAnotherModule = PositionBone

        RandomTexture = chss_uk_fa_ha.tga 0 chss_uk_fa.tga

        DefaultModelConditionState
            Model           = None
        End

        ModelConditionState = FORTRESS_IMPROVEMENT_4 USER_2
           Model            = None
        End

        ModelConditionState      = FORTRESS_IMPROVEMENT_4 RUBBLE
            Model        = None
        End

        ModelConditionState = FORTRESS_IMPROVEMENT_4
            Model           = iuurukforg
        End

        AnimationState = FORTRESS_IMPROVEMENT_4
            Animation                = IDLA
                AnimationName        = IBFBForgesU_SKL.IBFBForgesU_IDA
                AnimationMode        = ONCE
                AnimationPriority   = 12
            End
            Animation                = IDLB
                AnimationName        = IBFBForgesU_SKL.IBFBForgesU_IDB
                AnimationMode        = ONCE
                AnimationPriority   = 2
            End
            Flags                    = RESTART_ANIM_WHEN_COMPLETE
        End
    End

    Draw = W3DScriptedModelDraw ModuleTag_DrawWizardsTower
        ExtraPublicBone         = FXBONE
        ExtraPublicBone         = B_BANNER
        OkToChangeModelColor    = Yes
        StaticModelLODMode      = Yes
        UseStandardModelNames   = Yes

        DefaultModelConditionState
            Model               = None
            WeaponLaunchBone    = SECONDARY FXBONE
        End


        ModelConditionState = UPGRADE_FORTRESS_MONUMENT USER_4 DAMAGED
            Model           = ibfmagiert_a
            Texture            = IBFortress.tga IBFortress_D.tga
        End

        ModelConditionState = UPGRADE_FORTRESS_MONUMENT USER_4 REALLYDAMAGED
            Model           = ibfmagiert_a
            Texture            = IBFortress.tga IBFortress_D.tga
        End

        ModelConditionState = UPGRADE_FORTRESS_MONUMENT USER_4
            Model           = ibfmagiert_a
        End

        AnimationState = UPGRADE_FORTRESS_MONUMENT USER_4
            Animation                    = RiseUp
                AnimationName            = ibfmagiert_a.ibfmagiert_a
                AnimationMode            = ONCE
                AnimationSpeedFactorRange = 2.0 2.0
            End
        End


        ModelConditionState = UPGRADE_FORTRESS_MONUMENT UNPACKING
            Model    = ibfmagiert
            ParticleSysBone  = FXBONE WizardTowerStormClouds FollowBone:Yes
        End


        ModelConditionState = UPGRADE_FORTRESS_MONUMENT DAMAGED
            Model        = ibfmagiert
            WeaponLaunchBone    = SECONDARY FXBONE
        End

        AnimationState    = UPGRADE_FORTRESS_MONUMENT DAMAGED
            StateName    = Damaged
        End

        ModelConditionState = UPGRADE_FORTRESS_MONUMENT REALLYDAMAGED
            Model        = ibfmagiert
            WeaponLaunchBone    = SECONDARY FXBONE
        End

        AnimationState = UPGRADE_FORTRESS_MONUMENT REALLYDAMAGED
            Animation                    = UpAndStill
                AnimationName            = ibfmagiert.ibfmagiert
                AnimationMode            = ONCE
            End
        End

        ModelConditionState = UPGRADE_FORTRESS_MONUMENT RUBBLE
            Model        = ibfmagiert
        End

        AnimationState    = UPGRADE_FORTRESS_MONUMENT RUBBLE
            Animation    = IBFWTower_Rubble
                AnimationName        = ibfmagiert.ibfmagiert
                AnimationMode        = ONCE
            End
        End


        ModelConditionState = UPGRADE_FORTRESS_MONUMENT UPGRADE_NUMENOR_STONEWORK
            Model    = ibfmagiert
            Texture    = IBFortress.tga IBFortress_U.tga
        End

        ModelConditionState = UPGRADE_FORTRESS_MONUMENT SNOW
            Model = ibfmagiert
            Texture    = IBFortress.tga IBFortress_snow.tga
        End

        ModelConditionState    = UPGRADE_FORTRESS_MONUMENT
            Model    = ibfmagiert
        End
    End



    DisplayName           = OBJECT:IsengardFortress
    Description           = OBJECT:IsengardFortressDescription

    Side                  = Isengard
    EditorSorting         = STRUCTURE
    ThreatLevel           = 1.0
    CommandPointBonus     = MAIN_FORTRESS_COMMAND_POINT
    MaxSimultaneousOfType = NEW_FORTRESS_RATIO
    BuildCost             = ISENGARD_FORTRESS_BUILDCOST
    BuildTime             = DEFAULT_FORTRESS_BUILDTIME
    BountyValue           = ISENGARD_FORTRESS_BOUNTY_VALUE
    VisionRange           = DEFAULT_FORTRESS_VISION_RANGE
    ShroudClearingRange   = DEFAULT_FORTRESS_SHROUD_CLEAR

    CommandSet            = IsengardFortressCommandSet

    WeaponSet
        Conditions        = None
        Weapon            = PRIMARY EvilFortressArrowTowerBow
        AutoChooseSources = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End

    WeaponSet
        Conditions        = PASSENGER_TYPE_ONE
        Weapon            = PRIMARY EvilFortressArrowTowerBow
        AutoChooseSources = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End

    ArmorSet
        Conditions        = None
        Armor             = DefaultFortressArmor
    End

    ArmorSet
        Conditions = PLAYER_UPGRADE
        Armor      = DefaultFortressArmorUpgraded
    End



    #include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

    EvaEventDieOwner                 = EvaFortressDie

    SoundAmbient            	     = AmbientIsengartBoden

    VoiceSelect                      = IsengardFortressSelect
    VoiceSelectUnderConstruction     = BuildingEvilVoiceSelectUnderConstruction

    SoundOnDamaged                   = BuildingLightDamageStone
    SoundOnReallyDamaged             = BuildingHeavyDamageStone

    UnitSpecificSounds
        UnderConstruction            = BuildingConstructionLoop
        UnderRepairFromRubble        = BuildingConstructionLoop
    End

    CampnessValue = CAMPNESS_FORTRESS

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound:UpgradeIsengardFortressWizardTower    Animation:IBFWTower_AS.IBFWTower_AN    Frames:980
    End


    RadarPriority       = STRUCTURE
    KindOf              = COMMANDCENTER PRELOAD VITAL_FOR_BASE_SURVIVAL STRUCTURE IMMOBILE CASTLE_KEEP MP_COUNT_FOR_VICTORY SELECTABLE FS_FACTORY AUTO_RALLYPOINT MADE_OF_WOOD SCORE DOZER_FACTORY GARRISON GARRISONABLE_UNTIL_DESTROYED TRANSPORT

    Behavior            = GettingBuiltBehavior GetBuiltBehaviorTag
        WorkerName    = MordorWorkerNoSelect
        SpawnTimer    = DEFAULT_STRUCTURE_HEALDELAY
    End

    Behavior = CastleMemberBehavior ModuleTag_CMB
    End

	#include "..\..\..\..\includes\FortressAIHeroRespawnUpgrade_SEE.inc"

    Behavior = QueueProductionExitUpdate QueueProductionModuleTag
        UnitCreatePoint      = X:40.0 Y:0.0 Z:0.0
        NaturalRallyPoint    = X:106.0 Y:0.0 Z:0.0
        ExitDelay            = STANDARD_HERO_EXIT_DELAY
    End

    Body                        = StructureBody ModuleTag_05
        MaxHealth                     = DEFAULT_FORTRESS_HEALTH
        MaxHealthDamaged              = DEFAULT_FORTRESS_HEALTH_DAMAGED
        MaxHealthReallyDamaged        = DEFAULT_FORTRESS_HEALTH_REALLY_DAMAGED
    End

    Behavior                  = StructureCollapseUpdate ModuleTag_06
        MinCollapseDelay        = 000
        MaxCollapseDelay        = 000
        CollapseDamping         = .5
        MaxShudder              = 0.6
        MinBurstDelay           = 250
        MaxBurstDelay           = 800
        BigBurstFrequency       = 4
        FXList                  = INITIAL   FX_FortressCollapse
        DestroyObjectWhenDone   = Yes
        CollapseHeight          = 120
    End

    Behavior = CitadelSlaughterHordeContain ModuleTag_SlaughterMe
	PassengerFilter			= GENERIC_FACTION_SLAUGHTERABLE
	ObjectStatusOfContained		= UNSELECTABLE ENCLOSED
	CashBackPercent			= 200%
	ContainMax			= 99
	AllowEnemiesInside		= No
	AllowAlliesInside		= No
 	AllowNeutralInside		= No
 	AllowOwnPlayerInsideOverride	= Yes
	EnterSound			= GUI_RingReturned
	EntryOffset			= X:125.0 Y:0.0 Z:0.0
	EntryPosition			= X:30.0 Y:0.0 Z:0.0
	ExitOffset			= X:125.0 Y:0.0 Z:0.0
     End

	#include "..\..\..\FortressRingFunc.inc"


    Behavior = CastleUpgrade ModuleTag_PassOutFlamingMunitionsUpgrade
        TriggeredBy    = Upgrade_IsengardFortressOrcfireMunitionsTrigger
        Upgrade        = Upgrade_EvilFortressFlamingMunitions
    End

    Behavior = StatusBitsUpgrade ModuleTag_FakeOut
        TriggeredBy    = Upgrade_EvilFortressFlamingMunitions
    End

    Behavior = ModelConditionUpgrade ModuleTag_ShowMunitions
        TriggeredBy                  = Upgrade_EvilFortressFlamingMunitions
        AddConditionFlags            = FORTRESS_IMPROVEMENT_1
        AddTempConditionFlag         = ModelConditionState:USER_3
        TempConditionTime            = 5.0
        Permanent                    = Yes
    End

    Behavior = AudioLoopUpgrade ModuleTag_OrcFireMunitionsBuildLoop
        TriggeredBy            = Upgrade_EvilFortressFlamingMunitions
        SoundToPlay            = BuildingConstructionLoop
        KillOnDeath            = Yes
        KillAfterMS            = 1800
    End


    Behavior = CastleUpgrade ModuleTag_PassOutIronPlating
        TriggeredBy            = Upgrade_IsengardFortressIronPlatingTrigger
        Upgrade                = Upgrade_IsengardFortressIronPlating
        WallUpgradeRadius    = ISENGARD_FORTRESS_WALL_EFFECTIVE_RADIUS
    End

    Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
        TriggeredBy                = Upgrade_IsengardFortressIronPlating
        AttributeModifier        = IronPlatingKeep_Bonus
    End

    Behavior = ModelConditionUpgrade ModuleTag_ShowTheVines
        TriggeredBy            = Upgrade_IsengardFortressIronPlating
        AddConditionFlags      = UPGRADE_NUMENOR_STONEWORK
        Permanent              = Yes
    End

    Behavior = ArmorUpgrade ModuleTag_ArmorUpgrade
        TriggeredBy             = Upgrade_IsengardFortressIronPlating
    End


    Behavior = CostModifierUpgrade ModuleTag_EnchantedAnvilUpgrades
        LabelForPalantirString    = GUI:UPGRADE_DISCOUNT
        TriggeredBy               = Upgrade_IsengardFortressBurningForges
        UpgradeDiscount           = Yes
        ApplyToTheseUpgrades      = Upgrade_SteelBoltArrows Upgrade_ForgedBlades Upgrade_HeavyArmor Upgrade_BasicTraining Upgrade_IsengardTorches
        Percentage                = -20%
        Percentage                = -40%
        Percentage                = -60%
    End

    Behavior = ModelConditionUpgrade ModuleTag_ShowBurningForges
        TriggeredBy                  = Upgrade_IsengardFortressBurningForges
        AddConditionFlags            = FORTRESS_IMPROVEMENT_4
        AddTempConditionFlag         = ModelConditionState:USER_2
        TempConditionTime            = 6.8
        Permanent                    = Yes
    End

    Behavior = AudioLoopUpgrade ModuleTag_BurningForgesBuildLoop
        TriggeredBy            = Upgrade_IsengardFortressBurningForges
        SoundToPlay            = BuildingConstructionLoop
        KillOnDeath            = Yes
        KillAfterMS            = 4000
    End


    Behavior = CostModifierUpgrade ModuleTag_CostModifier
        LabelForPalantirString    = GUI:STRUCTURE_WALL_DISCOUNT
        TriggeredBy               = Upgrade_IsengardFortressExcavations
        ObjectFilter              = ANY +STRUCTURE +WALL_SEGMENT
        Percentage                = -15%
        Percentage                = -25%
        Percentage                = -35%
    End

    Behavior = ModelConditionUpgrade ModuleTag_ShowExcavations
        TriggeredBy                  = Upgrade_IsengardFortressExcavations
        AddConditionFlags            = FORTRESS_IMPROVEMENT_3
        AddTempConditionFlag         = ModelConditionState:USER_1
        TempConditionTime            = 9.0
        Permanent                    = Yes
    End

    Behavior = ObjectCreationUpgrade CreateExcavationsDummy
        TriggeredBy                     = Upgrade_IsengardFortressExcavations
        Delay                           = 0.0
        ThingToSpawn                    = FortressExcavationsDummy
        DestroyWhenSold                 = Yes
        FadeInTime                      = 600
    End

    Behavior = AudioLoopUpgrade ModuleTag_ExcavationsBuildLoop
        TriggeredBy            = Upgrade_IsengardFortressExcavations
        SoundToPlay            = BuildingConstructionLoop
        KillOnDeath            = Yes
        KillAfterMS            = 5500
    End

    Behavior = ModelConditionUpgrade ModuleTag_ShowMurderOfCrows
        TriggeredBy                  = Upgrade_IsengardFortressMurderOfCrows
        AddConditionFlags            = FORTRESS_IMPROVEMENT_2
        Permanent                    = Yes
    End

    Behavior = AttributeModifierUpgrade ModuleTag_MurderOfCrowsBonus
        AttributeModifier     = IsengardFortressMurderOfCrows_Bonus
        TriggeredBy           = Upgrade_IsengardFortressMurderOfCrows
    End

    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_MurderOfCrowsEnabler
        SpecialPowerTemplate  = SpecialAbilityMurderOfCrows
        TriggeredBy           = Upgrade_IsengardFortressMurderOfCrows
    End

    Behavior = StealthDetectorUpdate StealthDetectorUpdateModuleTag
        DetectionRange        = 800
        DetectionRate         = 500
        CancelOneRingEffect   = Yes
        RequiredUpgrade       = Upgrade_IsengardFortressMurderOfCrows
    End

    Behavior = ModelConditionUpgrade ModuleTag_ShowWizardsTower
        TriggeredBy                  = Upgrade_IsengardFortressWizardsTower
        AddConditionFlags            = UPGRADE_FORTRESS_MONUMENT
        AddTempConditionFlag         = ModelConditionState:USER_4
        TempConditionTime            = 10.0
        Permanent                    = Yes
    End

    Behavior = GeometryUpgrade TowerGeom
        TriggeredBy            = Upgrade_IsengardFortressWizardsTower
        ShowGeometry           = HighTowerGeom
    End

    Behavior = AudioLoopUpgrade ModuleTag_WizardTowerBuildLoop
        TriggeredBy            = Upgrade_IsengardFortressWizardsTower
        SoundToPlay            = BuildingBigConstructionLoop
        KillOnDeath            = Yes
        KillAfterMS            = 4500
    End

    Behavior = MonitorConditionUpdate ModuleTag_CommandSetSwapper012
        WeaponSetFlags            = PASSENGER_TYPE_ONE
        WeaponToggleCommandSet    = IsengardFortressCommandSet_Saruman
    End

    Behavior = AIUpdateInterface ModuleTag_AI
        AILuaEventsList                = FortressFunctions
        AutoAcquireEnemiesWhenIdle     = Yes
        MoodAttackCheckRate            = 250
    End


    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_PalantirEnabler
        SpecialPowerTemplate = SpecialAbilityOrthancPalantir
        TriggeredBy          = Upgrade_IsengardFortressWizardsTower
        RequiresAllTriggers  = Yes
    End

    Behavior                 = OCLSpecialPower ModuleTag_PalantirVision
        SpecialPowerTemplate = SpecialAbilityOrthancPalantir
        OCL                  = SpecialPowerPalantirVision
        CreateLocation       = CREATE_AT_LOCATION
        StartsPaused         = Yes
    End







    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_LightningEnabler
        SpecialPowerTemplate        = SpecialAbilityLightningStrike
        TriggeredBy                 = Upgrade_IsengardFortressWizardsTower
    End

    Behavior = SpecialPowerModule ModuleTag_LightningStrike
        SpecialPowerTemplate        = SpecialAbilityLightningStrike
        UpdateModuleStartsAttack    = Yes
        StartsPaused                = Yes
        InitiateSound               = WizardTowerLightningStrikeRumbleMS
    End

    Behavior = ArrowStormUpdate ModuleTag_ShootLightningBolts
        SpecialPowerTemplate    = SpecialAbilityLightningStrike
        StartAbilityRange       = ISENGARD_WIZARDSTOWER_LIGHTNING_RANGE
        UnpackingVariation      = 1
        CanShootEmptyGround     = Yes
        UnpackTime              = 2500
        PreparationTime         = 1
        PersistentPrepTime      = 500
        PackTime                = 1500
        ApproachRequiresLOS     = No
        AwardXPForTriggering    = 0
        WeaponTemplate  	= WizardTowerLightningWeapon
        TargetRadius    	= ISENGARD_WIZARDSTOWER_LIGHTNING_FIRE_RADIUS
        ShotsPerTarget  	= 1
        ShotsPerBurst   	= 1
        MaxShots        	= ISENGARD_WIZARDSTOWER_LIGHTNING_NUMSHOTS
    End

    Behavior = AutoAbilityBehavior ModuleTag_AutoAbilityLightningBehavior
	SpecialAbility		= SpecialAbilityLightningStrike
	Query			= 20 ANY ENEMIES +INFANTRY +CAVALRY -STRUCTURE -WALL_UPGRADE -WALL_HUB -WALL_SEGMENT -DEFENSIVE_WALL
	MaxScanRange		= ISENGARD_WIZARDSTOWER_LIGHTNING_RANGE
    End





    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_FireEnabler
        SpecialPowerTemplate        = SpecialAbilityWizardsTowerFireStrike
        TriggeredBy                 = Upgrade_Held5RespawnLevel Upgrade_IsengardFortressWizardsTower
        RequiresAllTriggers         = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_FireStrikeStarter
       SpecialPowerTemplate        = SpecialAbilityWizardsTowerFireStrike
       UpdateModuleStartsAttack    = Yes
       StartsPaused                = Yes
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_FireStrikeUpdate
       SpecialPowerTemplate    = SpecialAbilityWizardsTowerFireStrike
       WhichSpecialWeapon      = 1
       SkipContinue            = Yes
       UnpackTime              = 900
       PreparationTime         = 1
       PersistentPrepTime      = 1500
       PackTime                = 1100
       FreezeAfterTriggerDuration = 2500
       AwardXPForTriggering    = 0
       StartAbilityRange       = ISENGARD_WIZARDSTOWER_LIGHTNING_RANGE
       MustFinishAbility       = Yes
       SpecialWeapon           = WizardTowerFireWeapon
    End

    Behavior = AutoAbilityBehavior ModuleTag_AutoAbilityLightningWizardBehavior
	SpecialAbility		= SpecialAbilityWizardsTowerFireStrike
	Query			= 20 ANY ENEMIES +INFANTRY +CAVALRY -STRUCTURE -WALL_UPGRADE -WALL_HUB -WALL_SEGMENT -DEFENSIVE_WALL
	MaxScanRange		= ISENGARD_WIZARDSTOWER_LIGHTNING_RANGE
    End

    Behavior = AISpecialPowerUpdate LightningStrike_AI
        CommandButtonName = Command_IsengardWizardsTowerLightningStrike
        SpecialPowerAIType = AI_SPELLBOOK_ASSIST_BATTLE_DEBUFF
        SpecialPowerRadius = 100
        RandomizeTargetLocation = Yes
    End





    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_ZorndesCaradhrasEnabler
        SpecialPowerTemplate     = SpecialAbilityZorndesCaradhras
        TriggeredBy              = Upgrade_Held7RespawnLevel Upgrade_IsengardFortressWizardsTower
        RequiresAllTriggers      = Yes
    End

    Behavior = OCLSpecialPower ModuleTag_ZorndesCaradhras
        SpecialPowerTemplate     = SpecialAbilityZorndesCaradhras
        OCL                      = OCL_ZorndesCaradhrasEgg
        CreateLocation           = CREATE_AT_LOCATION
        TriggerFX                = FX_Avalanche
        StartsPaused             = Yes
    End


    Behavior = AISpecialPowerUpdate ZorndesCaradhras_AI
        CommandButtonName = Command_SpecialAbilityZorndesCaradhrasNew
        SpecialPowerAIType = AI_SPELLBOOK_ASSIST_BATTLE_DEBUFF
        SpecialPowerRadius = 100
        RandomizeTargetLocation = Yes
    End





    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_StarlightEnabler
        SpecialPowerTemplate        = SpecialAbilitySarumanUeberzeugungskunst
        TriggeredBy                 = Upgrade_Held10RespawnLevel Upgrade_IsengardFortressWizardsTower
        RequiresAllTriggers         = Yes
    End

    Behavior = OCLSpecialPower ModuleTag_Starlight
        StartsPaused                = Yes
        SpecialPowerTemplate        = SpecialAbilitySarumanUeberzeugungskunst
        OCL                         = OCL_UeberzeugenSaruman
        CreateLocation              = CREATE_AT_LOCATION
    End

    Behavior = PassiveAreaEffectBehavior ModuleTag_FeelGoodSaruman
        UpgradeRequired             = Upgrade_IsengardFortressWizardsTower
        EffectRadius                = 1000000000
        PingDelay                   = 2000
        ModifierName                = SarumanGiveUpgrade
        AllowFilter                 = ANY +IsengardSaruman_Mod ALLIES
    End


    Behavior = AutoDepositUpdate AutoDepositModuleTag
        DepositTiming           = GENERIC_KEEP_MONEY_TIME
        DepositAmount           = GENERIC_KEEP_MONEY_AMOUNT
        InitialCaptureBonus     = 0
    End

    Behavior = TerrainResourceBehavior ModuleTag_NewMoneyDeadSpot
        Radius            = GENERIC_KEEP_MONEY_RANGE
        MaxIncome         = 0
        IncomeInterval    = 999999
        HighPriority      = Yes
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSetAI
        TriggeredBy    = Upgrade_ObjectUnderAIControl
        CommandSet     = IsengardFortressCommandSet_AI
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI1
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 320000
        GrantUpgrade = Upgrade_IsengardFortressMurderOfCrows
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI2
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 700000
        GrantUpgrade = Upgrade_IsengardFortressBurningForges
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI3
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 1000000
        GrantUpgrade = Upgrade_IsengardFortressExcavations
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI4
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 1400000
        GrantUpgrade = Upgrade_IsengardFortressOrcfireMunitionsTrigger
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI5
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 1750000
        GrantUpgrade = Upgrade_IsengardFortressIronPlatingTrigger
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI6
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 2100000
        GrantUpgrade = Upgrade_IsengardFortressWizardsTower
    End


    Geometry                  = CYLINDER
    GeometryName              = Geom_Orig
    GeometryMajorRadius       = 70.0
    GeometryHeight            = 55.0
    GeometryOffset            = X:0 Y:0 Z:0


    AdditionalGeometry        = BOX
    GeometryName              = Geom_V2
    GeometryMajorRadius       = 18.0
    GeometryMinorRadius       = 18.0
    GeometryHeight            = 85.0
    GeometryOffset            = X:-40 Y:-45 Z:0

    AdditionalGeometry        = BOX
    GeometryName              = Geom_V2
    GeometryMajorRadius       = 18.0
    GeometryMinorRadius       = 18.0
    GeometryHeight            = 85.0
    GeometryOffset            = X:-40 Y:45 Z:0

    AdditionalGeometry        = BOX
    GeometryName              = Geom_V2
    GeometryMajorRadius       = 18.0
    GeometryMinorRadius       = 18.0
    GeometryHeight            = 85.0
    GeometryOffset            = X:40 Y:-45 Z:0

    AdditionalGeometry        = BOX
    GeometryName              = Geom_V2
    GeometryMajorRadius       = 18.0
    GeometryMinorRadius       = 18.0
    GeometryHeight            = 85.0
    GeometryOffset            = X:40 Y:45 Z:0


    AdditionalGeometry        = BOX
    GeometryName              = Geom_V2
    GeometryMajorRadius       = 15.0
    GeometryMinorRadius       = 20.0
    GeometryHeight            = 70.0
    GeometryOffset            = X:68 Y:0 Z:0

    GeometryIsSmall           = No
    Shadow                    = SHADOW_VOLUME
    BuildCompletion           = PLACED_BY_PLAYER

    AdditionalGeometry        = BOX
    GeometryName              = HighTowerGeom
    GeometryMajorRadius       = 12
    GeometryMinorRadius       = 12
    GeometryHeight            = 150
    GeometryOffset            = X:0 Y:0 Z:0
    GeometryUsedForHealthBox  = No

    GeometryContactPoint = X:-58.348       Y:43           Z:0          Repair
    GeometryContactPoint = X:57.546        Y:-55          Z:0          Repair
    GeometryContactPoint = X:47.546        Y:36.435       Z:0
    GeometryContactPoint = X:-32.763       Y:-46.121      Z:0
    GeometryContactPoint = X:0             Y:0            Z:180        Swoop
End


Object IsengardFortress

    SelectPortrait = BPIFortress

    Draw    = W3DScriptedModelDraw ModuleTag_01

        OkToChangeModelColor    = Yes
        StaticModelLODMode      = Yes

        DefaultModelConditionState
            Model           = None
        End

        IdleAnimationState
        End


        ModelConditionState = WORLD_BUILDER
            Model    = IBFortress
        End


        ModelConditionState = BUILD_PLACEMENT_CURSOR
            Model    = None
        End


        ModelConditionState =  PHANTOM_STRUCTURE
            Model    = IBFortress
        End

        ModelConditionState  = RUBBLE
            Model         = IBFortress_D3
            ParticleSysBone SmokeLarge01 SmokeBuildingLarge
        End
        AnimationState = RUBBLE
            Animation    = RubbleAnimation
                AnimationName        =    IBFortress_D3S.IBFortress_D3A
                AnimationMode        =    ONCE
            End
            EnteringStateFX    = FX_FortressCollapse
        End


        ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED SNOW
            Model               = IBFortress_A
            Texture    = IBFortress.tga IBFortress_snow.tga
        End
        ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Model               = IBFortress_A
        End
        AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Animation           = IBFortress_A
                AnimationName     = IBFortress_ASK.IBFortress_ABL
                AnimationMode     = MANUAL
            End
            ParticleSysBone = NONE BuildingContructDustCastlesB FollowBone:Yes
            ParticleSysBone = NONE FortressIsengard FollowBone:Yes
            Flags                = START_FRAME_FIRST
            StateName            = BeingConstructed
            BeginScript
                CurDrawablePlaySound("GondorBarracksBeginConstruction")
            EndScript
        End
    End

    PlacementViewAngle    = -45

      ArmorSet
        Conditions        = None
        Armor             = DefaultFortressArmor
      End

    Side                = Isengard
    EditorSorting       = STRUCTURE

    MaxSimultaneousOfType = NEW_FORTRESS_RATIO
    BuildCost           = ISENGARD_FORTRESS_BUILDCOST
    BuildTime           = DEFAULT_FORTRESS_BUILDTIME

    DisplayName         = OBJECT:IsengardFortress



    #include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

    VoiceFullyCreated                = EVA:FortressComplete-Builder
    VoiceSelect                        = IsengardFortressSelect
    VoiceSelectUnderConstruction    = BuildingEvilVoiceSelectUnderConstruction

    SoundOnDamaged                    = BuildingLightDamageStone
    SoundOnReallyDamaged            = BuildingHeavyDamageStone

    UnitSpecificSounds
        UnderConstruction        = BuildingBigConstructionLoop

        UnderRepairFromRubble    = BuildingBigConstructionLoop
    End

    ClientBehavior = ModelConditionAudioLoopClientBehavior ModuleTag_PlayCollapseSound
        ModelCondition = REQUIRED:RUBBLE Sound:BuildingSink
    End



    AutoResolveUnitType = AutoResolveUnit_Fortress

        AutoResolveBody = AutoResolve_IsengardFortressBody

        AutoResolveArmor
            Armor = AutoResolve_IsengardFortressArmor
        End

        AutoResolveWeapon
            Weapon = AutoResolve_IsengardFortressWeapon
        End



    RadarPriority       = STRUCTURE
    KindOf              = STRUCTURE SELECTABLE IMMOBILE BASE_FOUNDATION MP_COUNT_FOR_VICTORY BASE_SITE CAN_SEE_THROUGH_STRUCTURE LIVING_WORLD_BUILDING_MIRROR

    Body                        = StructureBody ModuleTag_05
        MaxHealth                     = DEFAULT_FORTRESS_HEALTH
    End

    Behavior = CastleBehavior ModuleTag_castle
        CastleToUnpackForFaction    = Isengard Fortress_Isengard
        CastleToUnpackForFaction    = Men Fortress_Isengard
        CastleToUnpackForFaction    = Arnor Fortress_Isengard
        CastleToUnpackForFaction    = Rohan Fortress_Isengard
        CastleToUnpackForFaction    = Elves Fortress_Isengard
        CastleToUnpackForFaction    = Imladris Fortress_Isengard
        CastleToUnpackForFaction    = Dwarves Fortress_Isengard
        CastleToUnpackForFaction    = Mordor Fortress_Isengard
        CastleToUnpackForFaction    = Wild Fortress_Isengard
        CastleToUnpackForFaction    = Angmar Fortress_Isengard

        FilterValidOwnedEntries = ANY +STRUCTURE +WALK_ON_TOP_OF_WALL +BASE_FOUNDATION +TACTICAL_MARKER

        MaxCastleRadius             = 130.0
        InstantUnpack                = Yes
        KeepDeathKillsEverything    = Yes

        EvaEnemyCastleSightedEvent = EnemyFortressSighted
    End

    Behavior                  = StructureCollapseUpdate ModuleTag_06
        MinCollapseDelay        = 000
        MaxCollapseDelay        = 000
        CollapseDamping         = .5
        MaxShudder              = 0.6
        MinBurstDelay           = 250
        MaxBurstDelay           = 800
        BigBurstFrequency       = 4
        FXList                  = INITIAL   FX_FortressCollapse
        DestroyObjectWhenDone   = Yes
        CollapseHeight          = 120
    End

    Behavior    = GettingBuiltBehavior ModuleTag_GettingBuiltBehavior
        WorkerName    = MordorWorkerNoSelect
        SpawnTimer    = DEFAULT_STRUCTURE_HEALDELAY
    End

    Behavior = AIUpdateInterface ModuleTag_AI
        AILuaEventsList                = FortressFunctions
    End


    Geometry                = CYLINDER
    GeometryName            = Geom_Orig
    GeometryMajorRadius     = 85.0
    GeometryHeight          = 55.0


    AdditionalGeometry      = BOX
    GeometryName            = Plots
    GeometryMajorRadius     = 10.0
    GeometryMinorRadius     = 10.0
    GeometryHeight          = 0.8
    GeometryOffset          = X:71.74 Y:-71.74 Z:0

    AdditionalGeometry      = BOX
    GeometryName            = Plots
    GeometryMajorRadius     = 10.0
    GeometryMinorRadius     = 10.0
    GeometryHeight          = 0.8
    GeometryOffset          = X:0 Y:-101.45 Z:0

    AdditionalGeometry      = BOX
    GeometryName            = Plots
    GeometryMajorRadius     = 10.0
    GeometryMinorRadius     = 10.0
    GeometryHeight          = 0.8
    GeometryOffset          = X:-71.74 Y:-71.74 Z:0

    AdditionalGeometry      = BOX
    GeometryName            = Plots
    GeometryMajorRadius     = 10.0
    GeometryMinorRadius     = 10.0
    GeometryHeight          = 0.8
    GeometryOffset          = X:-101.45 Y:0 Z:0

    AdditionalGeometry      = BOX
    GeometryName            = Plots
    GeometryMajorRadius     = 10.0
    GeometryMinorRadius     = 10.0
    GeometryHeight          = 0.8
    GeometryOffset          = X:-71.74 Y:71.74 Z:0

    AdditionalGeometry      = BOX
    GeometryName            = Plots
    GeometryMajorRadius     = 10.0
    GeometryMinorRadius     = 10.0
    GeometryHeight          = 0.8
    GeometryOffset          = X:0 Y:101.45 Z:0

    AdditionalGeometry      = BOX
    GeometryName            = Plots
    GeometryMajorRadius     = 10.0
    GeometryMinorRadius     = 10.0
    GeometryHeight          = 0.8
    GeometryOffset          = X:71.74 Y:71.74 Z:0

    GeometryIsSmall         = No
    Shadow                  = SHADOW_VOLUME
End


Object FortressExcavationsDummy

    Draw    = W3DScriptedModelDraw ModuleTag_01
        OkToChangeModelColor    = Yes

        DefaultModelConditionState
              Model = None
        End
    End

    ArmorSet
        Conditions        = None
          Armor             = NoArmor
      End

    Side                = Isengard
    EditorSorting       = STRUCTURE
    BuildTime            = 10.0


    #include "..\..\..\Includes\StandardBuildingEvaEvents.inc"
    CampnessValue = 0


    RadarPriority = STRUCTURE
    KindOf = STRUCTURE IMMOBILE NOT_AUTOACQUIRABLE UNATTACKABLE BASE_SITE CAN_SEE_THROUGH_STRUCTURE

    Body = HighlanderBody ModuleTag_02
        MaxHealth      = 1.0
    End

    Behavior = SlavedUpdate ModuleTag_Slave
        DieOnMastersDeath = Yes
    End


    Geometry                  = BOX
    GeometryMajorRadius       = 82
    GeometryMinorRadius       = 82
    GeometryHeight            = 10

    GeometryIsSmall           = No
    Shadow                    = SHADOW_VOLUME
End

