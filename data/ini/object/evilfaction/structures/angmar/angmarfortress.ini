Object AngmarFortressCenterGeneric

    SelectPortrait = KUFortressPortrait

    Draw = W3DScriptedModelDraw ModuleTag_01

        DefaultModelConditionState
              Model = None
        End

        ModelConditionState = WORLD_BUILDER
            Model = NBasePin
        End
    End

    Side             = Angmar
    EditorSorting    = STRUCTURE
    KindOf           = IMMOBILE BASE_FOUNDATION CASTLE_CENTER

    Behavior = CastleBehavior ModuleTag_castle
        FilterValidOwnedEntries = ANY +STRUCTURE +WALK_ON_TOP_OF_WALL +BASE_FOUNDATION +TACTICAL_MARKER
    End
End


Object AngmarFortressExpansionPadCorner

    SelectPortrait = KUFortressBuildPlot

    Draw = W3DFloorDraw DrawFloorBase
        ModelName = KBFoundation
    End

    Draw = W3DScriptedModelDraw ModuleTag_DrawMain
        DefaultModelConditionState
            Model = WBFoundationP
        End

        ModelConditionState = CONSTRUCTION_COMPLETE
            Model = None
        End
    End

    DisplayName         = OBJECT:AngmarBuildingFoundation
    Side                = Angmar
    EditorSorting       = STRUCTURE
    ThreatLevel         = 1.0

    BuildCost           = 1
    BuildTime           = 5.0
    VisionRange         = 0.0
    ShroudClearingRange = 0

    CommandSet = AngmarFortressExpansionPadCornerCommandSet

    VoiceSelect = Gui_PlotSelect2

    KindOf              = STRUCTURE SELECTABLE IMMOBILE BASE_FOUNDATION UNATTACKABLE MP_COUNT_FOR_VICTORY NO_COLLIDE DO_NOT_CLASSIFY EXPANSION_PAD

    Behavior            = FoundationAIUpdate ModuleTag_foundationAI
        BuildVariation = 1
    End

    Behavior = CastleMemberBehavior ModuleTag_CMB
    End

    Body                = ImmortalBody ModuleTag_05
        MaxHealth         = DEFAULT_FORTRESS_HEALTH
    End

    Geometry                = CYLINDER
    GeometryMajorRadius        = 15.0
    GeometryMinorRadius        = 15.0
    GeometryHeight            = 0.8
    GeometryIsSmall            = No
    Shadow                    = NONE
    BuildCompletion            = PLACED_BY_PLAYER
End

ChildObject AngmarFortressExpansionPadSide AngmarFortressExpansionPadCorner

    CommandSet = AngmarFortressExpansionPadSideCommandSet

    Behavior            = FoundationAIUpdate ModuleTag_foundationAI
        BuildVariation = 1
    End
End


Object  AngmarWallHubSmallExpansion

      SelectPortrait = KUHubFortPortrait

    Draw = W3DScriptedModelDraw ModuleTag_Draw
        OkToChangeModelColor  = Yes
        UseStandardModelNames = Yes

        DefaultModelConditionState
            Model = KBHTow
        End

        AnimationState = BUILD_PLACEMENT_CURSOR
            BeginScript
                   CurDrawableHideSubObject("IceWall")
            EndScript
        End


        AnimationState = PHANTOM_STRUCTURE
            BeginScript
                CurDrawableHideSubObject("IceWall")
               EndScript
        End

        IdleAnimationState
            StateName = STATE_None
            BeginScript
                   CurDrawableHideSubObject("IceWall")
            EndScript
        End


        ModelConditionState = UPGRADE_NUMENOR_STONEWORK ACTIVELY_BEING_CONSTRUCTED
            Model        = KBHTow_A
            Texture     = KBFortressB.tga KBFortressB_Ice.tga
            Texture        = KBFortressB_NRM.tga KBFortressBNRM_Ice.tga
        End

        ModelConditionState = SNOW ACTIVELY_BEING_CONSTRUCTED
            Model    = KBHTow_A
            Texture = KBFortressB.tga KBFortressB_Snow.tga
        End

        ModelConditionState = ACTIVELY_BEING_CONSTRUCTED
            Model            = KBHTow_A
        End

        AnimationState = ACTIVELY_BEING_CONSTRUCTED
            Animation            = KBHTow_A
                AnimationName        = KBHTow_ASKL.KBHTow_ABLD
                AnimationMode        = MANUAL
            End
            ParticleSysBone = NONE AngBuildingContructDustExp
            ParticleSysBone = NONE AngBuildingContructDust2
            ParticleSysBone = NONE ExpAngmar
            ParticleSysBone = NONE ExpAngmar2

            BeginScript
                CurDrawablePlaySound("GondorBarracksBeginConstruction")
                   CurDrawableHideSubObject("IceWall")
            EndScript
        End

        ModelConditionState = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Model = KKBHTow_A
        End

        AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Animation           = KBHTow_A
                AnimationName     = KBHTow_ASKL.KBHTow_ABLD
                AnimationMode     = ONCE
            End
            BeginScript

                   CurDrawableHideSubObject("IceWall")
            EndScript
        End


        ModelConditionState  = DAMAGED
            Model         = KBHTow_D1
        End
        AnimationState = DAMAGED
            EnteringStateFX    = FX_FortressDamaged
        End

        ModelConditionState  = REALLYDAMAGED
            Model       = KBHTow_D2
        End

        AnimationState = REALLYDAMAGED
              Animation                = RubbleAnimation
                AnimationName        = KBHTow_D2SKL.KBHTow_D2AN
                AnimationMode        = ONCE
              End
            EnteringStateFX    = FX_FortressReallyDamaged
        End

        ModelConditionState  = RUBBLE
            Model         = KBHTow_D3
        End

        AnimationState = RUBBLE
              Animation                = RubbleAnimation
                AnimationName        = KBHTow_D3SKL.KBHTow_D3AN
                AnimationMode        = ONCE
              End
              EnteringStateFX    = FX_FortressCollapse
        End


        ModelConditionState = UPGRADE_NUMENOR_STONEWORK
            Model        = KBHTow
            Texture     = KBFortressB.tga KBFortressB_Ice.tga
            Texture        = KBFortressB_NRM.tga KBFortressBNRM_Ice.tga
        End


        ModelConditionState = SNOW
            Model    = KBHTow
            Texture = KBFortressB.tga KBFortressB_Snow.tga
        End
    End


    Draw = W3DFloorDraw ModuleTag_DrawFloor
        StaticModelLODMode = Yes
         ModelName = KBHTow_bib
         WeatherTexture        = SNOWY KBHTow_bib_snow.tga
        HideIfModelConditions    =    AWAITING_CONSTRUCTION
          HideIfModelConditions    =    PARTIALLY_CONSTRUCTED
    End


    DisplayName         = OBJECT:AngmarCastleWallHubExpansion
    Description         = OBJECT:IsengardFortressDescription
    Side                = Angmar
    EditorSorting       = STRUCTURE
    ThreatLevel = 1.0

    BuildCost           = DWARVEN_WALLHUB_SMALL_BUILDCOST
    BuildTime           = DWARVEN_WALLHUB_SMALL_BUILDTIME
    VisionRange         = DEFAULT_FORTRESS_VISION_RANGE
    ShroudClearingRange = DEFAULT_FORTRESS_SHROUD_CLEAR

    CommandSet = AngmarCastleWallHubSmallCommandSet

    ArmorSet
        Conditions        = None
        Armor             = DwarvenWallArmor
    End



    #include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

    VoiceSelect                    = NeutralWallHubSelect

    SoundOnDamaged                = BuildingLightDamageStone
    SoundOnReallyDamaged        = BuildingHeavyDamageStone

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound:StatueHeroicBuildStoneDebris2 Animation:DBGFWHUB_A.DBGFWHUB_A Frames:120
        AnimationSound = Sound:StatueHeroicBuildStoneDebris1 Animation:DBGFWHUB_A.DBGFWHUB_A Frames:135
    End

    UnitSpecificSounds
        UnderConstruction            = BuildingConstructionLoop

        UnderRepairFromRubble        = BuildingConstructionLoop
    End


    CampnessValue = CAMPNESS_FORTRESS_EXPANSION


    RadarPriority       = STRUCTURE

    KindOf  = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE NEED_BASE_FOUNDATION FS_BASE_DEFENSE MADE_OF_STONE WALL_HUB

    Behavior            = GettingBuiltBehavior ModuleTag_04
        WorkerName                    = AngmarWorkerNoSelect
        SpawnTimer    = DEFAULT_STRUCTURE_HEALDELAY
    End

    Body                = StructureBody ModuleTag_05
        MaxHealth         = 1500.0
    End

    Behavior = CastleMemberBehavior ModuleTag_CMB
    End

    Behavior = WallHubBehavior ModuleTag_Build_A_Span
        Options                            = OPTION_ONE

        StaggeredBuildFactor = STANDARD_WALL_STAGGERED_BUILD_FACTOR

        MaxBuildoutDistance = DEFAULT_FORTRESS_WALL_EFFECTIVE_RADIUS


        SegmentTemplateName                = AngmarWallSegmentSmall
        SegmentTemplateName                = AngmarWallSegmentSmall
        SegmentTemplateName                = AngmarWallSegmentSmall
        SegmentTemplateName                = AngmarWallSegmentSmall
        SegmentTemplateName                = AngmarWallSegmentSmall
        SegmentTemplateName                = AngmarWallSegmentSmall
        SegmentTemplateName                = AngmarWallSegmentSmall
        SegmentTemplateName                = AngmarWallSegmentSmall
        SegmentTemplateName                = AngmarWallHubSmall

        BuilderRadius = 20

        HubCapTemplateName                = AngmarWallHubSmall
        DefaultSegmentTemplateName        = AngmarWallSegmentSmall

        CliffCapTemplateName            = AngmarWallCliffCap




    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowIceWalls
        TriggeredBy        = Upgrade_AngmarFortressIceWalls
        ShowSubObjects    = IceWall
    End

    Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
        TriggeredBy                = Upgrade_AngmarFortressIceWalls
        AttributeModifier        = AngmarStoneworkExpansion_Bonus
    End
    Behavior = ModelConditionUpgrade ModuleTag_ShowTheStones
        TriggeredBy            = Upgrade_AngmarFortressIceWalls
        AddConditionFlags    = UPGRADE_NUMENOR_STONEWORK
        Permanent            = Yes
    End


    Behavior = StructureCollapseUpdate ModuleTag_Collapse
        MinCollapseDelay        = 000
        MaxCollapseDelay        = 000
        CollapseDamping         = .5
        MaxShudder              = 0.6
        MinBurstDelay           = 250
        MaxBurstDelay           = 800
        BigBurstFrequency       = 4
        FXList                  = INITIAL   FX_StructureMediumCollapse
        FXList                  = ALMOST_FINAL  FX_StructureAlmostCollapse
        DestroyObjectWhenDone    = Yes
        CollapseHeight            = 120
    End

    Behavior = TerrainResourceBehavior ModuleTag_NewMoneyDeadSpot
        Radius            = 100
        MaxIncome        = 0
        IncomeInterval    = 999999
        HighPriority    = Yes
        Visible = No
    End

    GeometryIsSmall        = No

    Geometry            = CYLINDER
    GeometryMajorRadius    = 25.0
    GeometryHeight        = 60.0

    AdditionalGeometry    = BOX
    GeometryMajorRadius    = 20.0
    GeometryMinorRadius    = 10.0
    GeometryHeight        = 50.0
    GeometryOffset        = X:-20 Y:0 Z:0


    GeometryContactPoint = X:35        Y:0        Z:0            Repair
    GeometryContactPoint     = X:22.954        Y:15.951    Z:0
    GeometryContactPoint     = X:5.435        Y:-23.279    Z:0
    GeometryContactPoint    = X:-0.459        Y:-0.275    Z:116.828    Swoop

    Shadow                    = SHADOW_VOLUME
    BuildCompletion            = PLACED_BY_PLAYER
End



Object AngmarFortressCitadel

Draw = W3DFloorDraw ModuleTag_DrawFortressFloor
    ModelName				= FL_ANGMAR
    StartHidden 				= No
    HideIfModelConditions		= AWAITING_CONSTRUCTION
    HideIfModelConditions		= PARTIALLY_CONSTRUCTED
    ForceToBack 				= Yes
    FloorFadeRateOnObjectDeath  = -0.01
End



    SelectPortrait         = KUFortressPortrait
    ButtonImage            = KUFortressIcon




    Draw = W3DScriptedModelDraw ModuleTag_MainDraw
        ExtraPublicBone = ARROW_01
        ExtraPublicBone = ARROW_02
        ExtraPublicBone = ARROW_03
        ExtraPublicBone = ARROW_04
        ExtraPublicBone = ARROW_05
        ExtraPublicBone = ARROW_06
        ExtraPublicBone = ARROW_07
        ExtraPublicBone = ARROW_08
        ExtraPublicBone = ARROW_09
        ExtraPublicBone = ARROW_10
        ExtraPublicBone = ARROW_11
        ExtraPublicBone = ARROW_12
        ExtraPublicBone = ARROW_13
        ExtraPublicBone = ARROW_14
        ExtraPublicBone = ARROW_15
        ExtraPublicBone = ARROW_16
        ExtraPublicBone = ARROW_17
        ExtraPublicBone = ARROW_18
        ExtraPublicBone = ARROW_19
        ExtraPublicBone = ARROW_20
        ExtraPublicBone = ARROW_21
        ExtraPublicBone = ARROW_22
        ExtraPublicBone = ARROW_23
        ExtraPublicBone = ARROW_24
        ExtraPublicBone = ARROW_25
        ExtraPublicBone = ARROW_26
        ExtraPublicBone = ARROW_27
        ExtraPublicBone = ARROW_28

        OkToChangeModelColor    = Yes
        StaticModelLODMode        = Yes

        DefaultModelConditionState
            Model                = KBFortress
            WeaponLaunchBone    = PRIMARY        ARROW_
            WeaponLaunchBone    = SECONDARY        BARRELOUT1
            WeaponLaunchBone    = TERTIARY        BARRELOUT2
            WeaponLaunchBone    = QUATERNARY        BARRELOUT3
            WeaponLaunchBone    = QUINARY        BARRELOUT4
        End


        AnimationState = BUILD_PLACEMENT_CURSOR
            BeginScript
            CurDrawableHideSubObject("IceM1_1")
            CurDrawableHideSubObject("IceM1_2")
            CurDrawableHideSubObject("IceM3_1")
            CurDrawableHideSubObject("IceM3_2")
            CurDrawableHideSubObject("IceMunMist_01D2")
            CurDrawableHideSubObject("IceMunMist_03AD2")
            CurDrawableHideSubObject("IceMunMist_03BD2")
                CurDrawableHideSubObject("IceMunitions01")
                CurDrawableHideSubObject("IceMunitions02")
                CurDrawableHideSubObject("IceMunitions03")
                CurDrawableHideSubObject("IceMunitions04")
                CurDrawableHideSubObject("IceMunMist_01")
                CurDrawableHideSubObject("IceMunMist_02")
                CurDrawableHideSubObject("IceMunMist_03")
                CurDrawableHideSubObject("IceMunMist_04")
                   CurDrawableHideSubObject("IceWall")
                   CurDrawableHideSubObject("N_Window")
                   CurDrawableHideSubObject("DBFBANNER")
                   CurDrawableHideSubObject("DBFSKEGS")
                   CurDrawableHideSubObject("MBFDPF")
            EndScript
        End


        AnimationState = PHANTOM_STRUCTURE
            BeginScript
            CurDrawableHideSubObject("IceM1_1")
            CurDrawableHideSubObject("IceM1_2")
            CurDrawableHideSubObject("IceM3_1")
            CurDrawableHideSubObject("IceM3_2")
            CurDrawableHideSubObject("IceMunMist_01D2")
            CurDrawableHideSubObject("IceMunMist_03AD2")
            CurDrawableHideSubObject("IceMunMist_03BD2")
                CurDrawableHideSubObject("IceMunitions01")
                CurDrawableHideSubObject("IceMunitions02")
                CurDrawableHideSubObject("IceMunitions03")
                CurDrawableHideSubObject("IceMunitions04")
                CurDrawableHideSubObject("IceMunMist_01")
                CurDrawableHideSubObject("IceMunMist_02")
                CurDrawableHideSubObject("IceMunMist_03")
                CurDrawableHideSubObject("IceMunMist_04")
                CurDrawableHideSubObject("IceWall")
                   CurDrawableHideSubObject("N_Window")
                   CurDrawableHideSubObject("DBFBANNER")
                   CurDrawableHideSubObject("DBFSKEGS")
                   CurDrawableHideSubObject("MBFDPF")
               EndScript
        End


        IdleAnimationState
            StateName            =  STATE_Idle
            BeginScript
            CurDrawableHideSubObject("IceM1_1")
            CurDrawableHideSubObject("IceM1_2")
            CurDrawableHideSubObject("IceM3_1")
            CurDrawableHideSubObject("IceM3_2")
            CurDrawableHideSubObject("IceMunMist_01D2")
            CurDrawableHideSubObject("IceMunMist_03AD2")
            CurDrawableHideSubObject("IceMunMist_03BD2")
                CurDrawableHideSubObject("IceMunitions01")
                CurDrawableHideSubObject("IceMunitions02")
                CurDrawableHideSubObject("IceMunitions03")
                CurDrawableHideSubObject("IceMunitions04")
                CurDrawableHideSubObject("IceMunMist_01")
                CurDrawableHideSubObject("IceMunMist_02")
                CurDrawableHideSubObject("IceMunMist_03")
                CurDrawableHideSubObject("IceMunMist_04")
                CurDrawableHideSubObject("IceWall")
                   CurDrawableHideSubObject("N_Window")
                   CurDrawableHideSubObject("DBFBANNER")
                   CurDrawableHideSubObject("DBFSKEGS")
                   CurDrawableHideSubObject("MBFDPF")
               EndScript
                End




        ModelConditionState  = DAMAGED
            Model        = KBFortres_D1
            Texture        = KBFortress.tga KBFortress_D1.tga
        End

        AnimationState = DAMAGED
            EnteringStateFX    = FX_FortressDamaged
        End

        ModelConditionState  = REALLYDAMAGED
            Model            = KBFortres_D2
        End

        AnimationState    = REALLYDAMAGED
            Animation    = Fortress_ReallyDamaged
                AnimationName        = KBFortres_D2SKL.KBFortres_D2AN
                AnimationMode        = ONCE
            End
            EnteringStateFX    = FX_FortressReallyDamaged
        End

        ModelConditionState  = RUBBLE
            Model            = KBFortres_D3
        End

        AnimationState    = RUBBLE
            Animation    = Fortress_ReallyDamaged
                AnimationName        = KBFortres_D3SKL.KBFortres_D3AN
                AnimationMode        = ONCE
            End
            EnteringStateFX    = FX_FortressCollapse
        End


        ModelConditionState = UPGRADE_NUMENOR_STONEWORK
            Model        = KBFortress
            Texture        = KBFortress.tga KBFortress_Ice.tga
            Texture        = KBFortress_NRM.tga KBFortressNRM_Ice.tga
        End


        ModelConditionState = SNOW
            Model    = KBFortress
            Texture = KBFortress.tga KBFortress_Snow.tga
        End
    End



    Draw = W3DScriptedModelDraw ModuleTag_HouseOfHealingDraw
        OkToChangeModelColor    = Yes
        StaticModelLODMode        = Yes

        DefaultModelConditionState
            Model           = NONE
        End


        ModelConditionState = UPGRADE_HOUSE_OF_HEALING USER_3 DAMAGED
            Model        = KBFHoLa_D1
        End

        ModelConditionState = UPGRADE_HOUSE_OF_HEALING USER_3 REALLYDAMAGED
            Model        = KBFHoLa_D2

        End

        ModelConditionState = UPGRADE_HOUSE_OF_HEALING USER_3 UPGRADE_NUMENOR_STONEWORK
            Model        = KBFHoLa_A

        End
        ModelConditionState = UPGRADE_HOUSE_OF_HEALING USER_3 SNOW
            Model        = KBFHoLa_A
            Texture        = KBFortressX.tga KBFortressX_Snow.tga
        End
        ModelConditionState = UPGRADE_HOUSE_OF_HEALING USER_3
            Model        = KBFHoLa_A
        End
        AnimationState = UPGRADE_HOUSE_OF_HEALING USER_3
            Animation                    = RiseUp
                AnimationName                = KBFHoLa_ASKL.KBFHoLa_ABLD
                AnimationMode                = ONCE
                AnimationSpeedFactorRange    = 5.0 5.0
            End
        End


        ModelConditionState        = UPGRADE_HOUSE_OF_HEALING DAMAGED
            Model        = KBFHoLa_D1

        End

        ModelConditionState        = UPGRADE_HOUSE_OF_HEALING REALLYDAMAGED
            Model        = KBFHoLa_D2

        End

        AnimationState            = UPGRADE_HOUSE_OF_HEALING REALLYDAMAGED
            Animation        = ReallyDamaged
                AnimationName    = GBFHeal_D2SKL.GBFHeal_D2AN
                AnimationMode   = ONCE
            End
        End

        ModelConditionState        = UPGRADE_HOUSE_OF_HEALING RUBBLE
            Model        = KBFHoLa_D3

        End

        AnimationState            = UPGRADE_HOUSE_OF_HEALING RUBBLE
            Animation            = Destroyed
                AnimationName    = KBFHoLa_D3SKL.KBFHoLa_D3AN
                AnimationMode   = ONCE
            End
        End


        ModelConditionState = UPGRADE_NUMENOR_STONEWORK UPGRADE_HOUSE_OF_HEALING
            Model        = KBFHoLa


        End


        ModelConditionState = SNOW UPGRADE_HOUSE_OF_HEALING
            Model            = KBFHoLa
            Texture            = KBFortressX.tga KBFortressX_Snow.tga
        End


        ModelConditionState = UPGRADE_HOUSE_OF_HEALING
            Model           = KBFHoLa
        End
        End

            Behavior                  = BuildingBehavior BuildingModuleTag
                NightWindowName         = N_Window


    End




    Draw = W3DScriptedModelDraw ModuleTag_SanctumDraw
        OkToChangeModelColor    = Yes
        StaticModelLODMode    = Yes

        DefaultModelConditionState
            Model           = None
                    WeaponLaunchBone    = SECONDARY EYEBONE
        End

        IdleAnimationState
            StateName    = NoTower
        End

        ModelConditionState    = UPGRADE_IVORY_TOWER DAMAGED UNPACKING
            Model        = KBFSanctum_D1

            ParticleSysBone  = EYEBONE01 AngSanctumCharge FollowBone:Yes
            ParticleSysBone  = EYEBONE01 AngSanctumCharge02 FollowBone:Yes
            ParticleSysBone  = EYEBONE AngSanctumCharge03 FollowBone:Yes
            ParticleSysBone  = EYEBONE AngSanctumCharge04 FollowBone:Yes
        End

        ModelConditionState        = UPGRADE_IVORY_TOWER REALLYDAMAGED UNPACKING
            Model        = KBFSanctum_D2
            ParticleSysBone  = EYEBONE01 AngSanctumCharge FollowBone:Yes
            ParticleSysBone  = EYEBONE01 AngSanctumCharge02 FollowBone:Yes
            ParticleSysBone  = EYEBONE AngSanctumCharge03 FollowBone:Yes
            ParticleSysBone  = EYEBONE AngSanctumCharge04 FollowBone:Yes
        End



        ModelConditionState = UPGRADE_IVORY_TOWER UNPACKING
            Model    = KBFSanctum
            ParticleSysBone  = EYEBONE01 AngSanctumCharge FollowBone:Yes
            ParticleSysBone  = EYEBONE01 AngSanctumCharge02 FollowBone:Yes
            ParticleSysBone  = EYEBONE AngSanctumCharge03 FollowBone:Yes
            ParticleSysBone  = EYEBONE AngSanctumCharge04 FollowBone:Yes
        End


        ModelConditionState = UPGRADE_IVORY_TOWER USER_2 DAMAGED
            Model           = KBFSanctum_A
            Texture        = KBFortressX.tga KBFortressX_D1.tga
        End

        ModelConditionState = UPGRADE_IVORY_TOWER USER_2 REALLYDAMAGED
            Model           = KBFSanctum_A
            Texture        = KBFortressX.tga KBFortressX_D1.tga
        End

        ModelConditionState = UPGRADE_IVORY_TOWER USER_2
            Model           = KBFSanctum_A
        End


        AnimationState = UPGRADE_IVORY_TOWER USER_2
            Animation                    = RiseUp
                AnimationName                = KBFSanctum_ASKL.KBFSanctum_ABLD
                AnimationMode                = ONCE
                AnimationSpeedFactorRange    = 8.0 8.0
            End
        End



        ModelConditionState    = UPGRADE_IVORY_TOWER DAMAGED
            Model        = KBFSanctum_D1

        End

        ModelConditionState        = UPGRADE_IVORY_TOWER REALLYDAMAGED
            Model        = KBFSanctum_D2
        End

        AnimationState            = UPGRADE_IVORY_TOWER REALLYDAMAGED
            Animation            = ReallyDamaged
                AnimationName    = KBFSanct_D2SKL.KBFSanct_D2AN
                AnimationMode   = ONCE
            End
        End

        ModelConditionState        = UPGRADE_IVORY_TOWER RUBBLE
            Model        = KBFSanctum_D3
        End

        AnimationState            = UPGRADE_IVORY_TOWER RUBBLE
            Animation            = Destroyed
                AnimationName    = KBFSanct_D3SKL.KBFSanct_D3AN
                AnimationMode   = ONCE
            End
        End



        ModelConditionState = SNOW UPGRADE_IVORY_TOWER
            Model            = KBFSanctum
            Texture            = KBFortressX.tga KBFortressX_Snow.tga
        End

        ModelConditionState = UPGRADE_IVORY_TOWER
            Model           = KBFSanctum
        End




        AnimationState = UPGRADE_IVORY_TOWER
            StateName    = DefaultTowerState
        End

    End



    Draw = W3DScriptedModelDraw ModuleTag_DrawDoor

        DefaultModelConditionState
            Model = KBFDoor_CLS
        End


        AnimationState = BUILD_PLACEMENT_CURSOR
            BeginScript
                CurDrawableHideSubObject("IceDoorR")
                   CurDrawableHideSubObject("IceDoorL")

            EndScript
        End


        AnimationState = PHANTOM_STRUCTURE
            BeginScript
                CurDrawableHideSubObject("IceDoorR")
                   CurDrawableHideSubObject("IceDoorL")
               EndScript
        End


        IdleAnimationState
            StateName            =  STATE_Idle
            BeginScript
                CurDrawableHideSubObject("IceDoorR")
                   CurDrawableHideSubObject("IceDoorL")
               EndScript
                End


        ModelConditionState   = DAMAGED DOOR_1_WAITING_OPEN
            Model        = KBFDoor_OPD1
            Texture        = KBFortress.tga KBFortress_D1.tga
        End

        ModelConditionState   = REALLYDAMAGED DOOR_1_WAITING_OPEN
            Model        = KBFDoor_OPD1
            Texture        = KBFortress.tga KBFortress_D1.tga
        End

        ModelConditionState = DAMAGED
            Model        = KBFDoor_CLSD1
            Texture        = KBFortress.tga KBFortress_D1.tga
        End

        ModelConditionState = REALLYDAMAGED
            Model        = KBFDoor_CLSD1
            Texture        = KBFortress.tga KBFortress_D1.tga
        End

        ModelConditionState = RUBBLE
            Model        = None
        End


        ModelConditionState   = DOOR_1_OPENING
            Model               = KBFDoor_CLS
        End

        AnimationState        =    DOOR_1_OPENING
        Animation    =    KBFDoor_OPAN
                AnimationName   =    KBFDoor_SKL.KBFDoor_OPAN
                AnimationMode   =    ONCE
                AnimationBlendTime = 0
            End
            Flags            =    START_FRAME_FIRST
        End


        ModelConditionState   = DOOR_1_CLOSING
            Model               = KBFDoor_OP
                ParticleSysBone      = NONE trollCageDust
            End

           AnimationState        =    DOOR_1_CLOSING
        Animation           =    KBFDoor_CLSAN
                AnimationName   =    KBFDoor_SKL.KBFDoor_CLSAN
                AnimationMode   =    ONCE
                AnimationBlendTime = 0
            End
            Flags        =    START_FRAME_FIRST
        End


        ModelConditionState   = DOOR_1_WAITING_OPEN
            Model               = KBFDoor_OP

        End

        AnimationState    = DOOR_1_WAITING_OPEN
        Animation       = KBFDoor_OP
                AnimationName   =    KBFDoor_SKL.KBFDoor_OP
                AnimationMode   =    ONCE
                AnimationBlendTime = 0
            End
            Flags      =  START_FRAME_FIRST
        End

        ModelConditionState  = POST_RUBBLE
            Model         = None
        End

        ModelConditionState  = POST_COLLAPSE
            Model         = None
        End

    End



    Draw = W3DScriptedModelDraw ModuleTag_DrawMist

        DefaultModelConditionState
            Model                = None
        End

        ModelConditionState   = UPGRADE_NUMENOR_STONEWORK
            Model                = None
            ParticleSysBone        = NONE IceWallMist
            ParticleSysBone        = NONE IceWallMist02
        End
    End


    Draw = W3DScriptedModelDraw ModuleTag_DrawStoned
        DefaultModelConditionState
            Model        = None
        End

        ModelConditionState = STONED
            Model           = None
            ParticleSysBone = None UnterwandernSwampCloud
            ParticleSysBone = None UnterwandernSwampCloud02
            ParticleSysBone = None UnterwandernTaintLightShafts
        End
    End

    Draw = W3DFloorDraw ModuleTag_DrawFloor
        ModelName            = DBFortress_Bib
        WeatherTexture       = SNOWY GBWall_Bib_Snow.tga
    End


    DisplayName         = OBJECT:AngmarFortress
    Description         = OBJECT:AngmarFortressDescription
    Side                = Angmar
    EditorSorting       = STRUCTURE
    ThreatLevel          = 1.0
    CommandPointBonus    = MAIN_FORTRESS_COMMAND_POINT
    MaxSimultaneousOfType = NEW_FORTRESS_RATIO
    BuildCost           = 5000
    BuildTime           = DEFAULT_FORTRESS_BUILDTIME
    VisionRange         = DEFAULT_FORTRESS_VISION_RANGE
    ShroudClearingRange = DEFAULT_FORTRESS_SHROUD_CLEAR

    CommandSet            = AngmarFortressCommandSet

    WeaponSet
        Conditions        = None
        Weapon            = PRIMARY AngmarFortressBattleTowerBow
        AutoChooseSources = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End

    ArmorSet
        Conditions = None
        Armor      = DefaultFortressArmor
    End

    ArmorSet
        Conditions = PLAYER_UPGRADE
        Armor      = DefaultFortressArmorUpgraded
    End

    ArmorSet
        Conditions = PLAYER_UPGRADE_2
        Armor      = DefaultFortressArmorUpgraded_Sanctum
    End

    ArmorSet
        Conditions = PLAYER_UPGRADE PLAYER_UPGRADE_2
        Armor      = DefaultFortressArmorFullyUpgraded_Sanctum
    End





    #include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

    EvaEventDieOwner                 = EvaFortressDie

    VoiceSelect                        = MordorFortressSelect

    SoundOnDamaged                    = BuildingLightDamageStone
    SoundOnReallyDamaged            = BuildingHeavyDamageStone

    VoiceSelectUnderConstruction    = BuildingEvilVoiceSelectUnderConstruction

    UnitSpecificSounds
        UnderConstruction            = BuildingBigConstructionLoop
        UnderRepairFromDamage    = BuildingBigConstructionLoop
        UnderRepairFromRubble        = BuildingBigConstructionLoop
    End

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound:StatueHeroicBuildStoneDebris2 Animation:DBFGCAP_A.DBFGCAP_A Frames:116
        AnimationSound = Sound:StatueHeroicBuildStoneDebris1 Animation:DBFGCAP_A.DBFGCAP_A Frames:130
    End

    CampnessValue = CAMPNESS_FORTRESS



    RadarPriority       = STRUCTURE
     KindOf                = PRELOAD COMMANDCENTER VITAL_FOR_BASE_SURVIVAL STRUCTURE IMMOBILE CASTLE_KEEP MP_COUNT_FOR_VICTORY SELECTABLE FS_FACTORY AUTO_RALLYPOINT MADE_OF_WOOD SCORE DOZER_FACTORY

    Behavior            = GettingBuiltBehavior ModuleTag_GettingBuiltBehavior
        WorkerName    = AngmarWorkerNoSelect
        SpawnTimer    = DEFAULT_STRUCTURE_HEALDELAY
    End

     Behavior = CastleMemberBehavior ModuleTag_CMB
        BeingBuiltSound = BuildingBigConstructionLoop
     End

	#include "..\..\..\..\includes\FortressAIHeroRespawnUpgrade_SEE.inc"

    Behavior = QueueProductionExitUpdate ModuleTag_QueuePEU
        UnitCreatePoint        = X:57.0 Y:0.0 Z:0.0
        NaturalRallyPoint    = X:109.0 Y:0.0 Z:0.0
        ExitDelay            = STANDARD_HERO_EXIT_DELAY
    End

    Body                = StructureBody ModuleTag_05
        MaxHealth                    = DEFAULT_FORTRESS_HEALTH
        MaxHealthDamaged              = DEFAULT_FORTRESS_HEALTH_DAMAGED
        MaxHealthReallyDamaged           = DEFAULT_FORTRESS_HEALTH_REALLY_DAMAGED
    End

    Behavior                  = StructureCollapseUpdate ModuleTag_08
        MinCollapseDelay        = 000
        MaxCollapseDelay        = 000
        CollapseDamping         = .5
        MaxShudder              = 0.6
        MinBurstDelay           = 250
        MaxBurstDelay           = 800
        BigBurstFrequency       = 4
        FXList                  = INITIAL   FX_StructureMediumCollapseNoSound
        FXList                  = ALMOST_FINAL  FX_StructureAlmostCollapse
        DestroyObjectWhenDone    = Yes
        CollapseHeight            = 155
    End

    Behavior = CitadelSlaughterHordeContain ModuleTag_SlaughterMe
	PassengerFilter			= GENERIC_FACTION_SLAUGHTERABLE
	ObjectStatusOfContained		= UNSELECTABLE ENCLOSED
	CashBackPercent			= 200%
	ContainMax			= 99
	AllowEnemiesInside		= No
	AllowAlliesInside		= No
 	AllowNeutralInside		= No
 	AllowOwnPlayerInsideOverride	= Yes
	EnterSound			= GUI_RingReturned
	EntryOffset			= X:125.0 Y:0.0 Z:0.0
	EntryPosition			= X:30.0 Y:0.0 Z:0.0
	ExitOffset			= X:125.0 Y:0.0 Z:0.0
     End

	#include "..\..\..\FortressRingFunc.inc"


    Behavior = SubObjectsUpgrade ModuleTag_HideAll
        TriggeredBy       = Upgrade_StructureLevel1
        HideSubObjects    = IceWall IceDoorR IceDoorL MBFDPF IceMunitions01 IceMunitions02 IceMunitions03 IceMunitions04 IceMunMist_01 IceMunMist_02 IceMunMist_03 IceMunMist_04 IceM1_1 IceM1_2 IceM3_1 IceM3_2 IceMunMist_01D2 IceMunMist_03AD2 IceMunMist_03BD2
    End


    Behavior = ObjectCreationUpgrade CreateTheMoat
        TriggeredBy        = Upgrade_AngmarFortressSpikes
        Delay            = 0.0
        ThingToSpawn    = AngmarFortressSpikes
        DestroyWhenSold    = Yes
        FadeInTime        = 600
    End


    Behavior = CastleUpgrade ModuleTag_PassOutAngmarStoneworkUpgrade
        TriggeredBy    = Upgrade_AngmarFortressIceWallsTrigger
        Upgrade        = Upgrade_AngmarFortressIceWalls
        WallUpgradeRadius = ANGMAR_FORTRESS_WALL_EFFECTIVE_RADIUS
    End

    Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
        TriggeredBy                = Upgrade_AngmarFortressIceWalls
        AttributeModifier        = AngmarStoneworkKeep_Bonus
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowIceWalls
        TriggeredBy        = Upgrade_AngmarFortressIceWalls
        ShowSubObjects    = IceDoorR IceDoorL IceWall
    End

    Behavior = ModelConditionUpgrade ModuleTag_ShowTheStones
        TriggeredBy            = Upgrade_AngmarFortressIceWalls
        AddConditionFlags    = UPGRADE_NUMENOR_STONEWORK
        Permanent            = Yes
    End

    Behavior = ArmorUpgrade ModuleTag_ArmorUpgrade
        TriggeredBy             = Upgrade_AngmarFortressIceWalls
    End


    Behavior = ModelConditionUpgrade ModuleTag_ShowFlamingMunitions
        TriggeredBy               = Upgrade_AngmarFortressIceMunitions
        AddConditionFlags          = FORTRESS_IMPROVEMENT_1
        TempConditionTime         = 8.0
    End
	
    Behavior = CastleUpgrade ModuleTag_PassOutFlamingMunitionsUpgrade
        TriggeredBy    = Upgrade_AngmarFortressIceMunitionsTrigger
        Upgrade        = Upgrade_AngmarFortressIceMunitions
    End

    Behavior = AudioLoopUpgrade ModuleTag_FlamingMunitionsBuildLoop
        TriggeredBy            = Upgrade_AngmarFortressIceMunitions
        SoundToPlay            = BuildingConstructionLoop
        KillOnDeath             = Yes
        KillAfterMS             = 3500
        RequiresAllTriggers      = Yes
    End

    Behavior = WeaponSetUpgrade ModuleTag_FlamingAttack
        TriggeredBy            = Upgrade_AngmarFortressIceMunitions
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowIceMunitions
        TriggeredBy        = Upgrade_AngmarFortressIceMunitions
        ShowSubObjects    = IceMunitions01 IceMunitions02 IceMunitions03 IceMunitions04 IceMunMist_01 IceMunMist_02 IceMunMist_03 IceMunMist_04 IceM1_1 IceM1_2 IceM3_1 IceM3_2 IceMunMist_01D2 IceMunMist_03AD2 IceMunMist_03BD2
    End

    Behavior = StatusBitsUpgrade ModuleTag_FakeOut
        TriggeredBy    = Upgrade_AngmarFortressIceMunitions
    End
	
    Behavior = CastleUpgrade ModuleTag_PassOutIceMunition
        TriggeredBy    = Upgrade_AngmarFortressIceMunitionsTrigger
        Upgrade        = Upgrade_AngmarFortressIceMunitions
        WallUpgradeRadius = ANGMAR_FORTRESS_WALL_EFFECTIVE_RADIUS
    End






    Behavior = AttributeModifierAuraUpdate ModuleTag_BannerLeadership
        StartsActive       = No
        BonusName          = Upgrade_AngmarFortressBanners
        TriggeredBy        = Upgrade_MenFortressBanners
        RefreshDelay       = 2000
        Range              = 300
        ObjectFilter       = GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
    End

    Behavior = CostModifierUpgrade ModuleTag_EnchantedUpgrades
        LabelForPalantirString  = GUI:UPGRADE_DISCOUNTHEXER
        TriggeredBy             = Upgrade_AngmarFortressBanners
        UpgradeDiscount         = Yes
        ApplyToTheseUpgrades    = Upgrade_AngmarSoulFreeze Upgrade_AngmarCorpseRain Upgrade_AngmarWellOfSouls
        Percentage              = -20%
    End

    Behavior = CostModifierUpgrade ModuleTag_CostModifier
        LabelForPalantirString  = GUI:HERO_DISCOUNT
        TriggeredBy             = Upgrade_AngmarFortressBanners
        ObjectFilter            = ANY +HERO
        Percentage              = -10%
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowBanners
        TriggeredBy        	= Upgrade_AngmarFortressBanners
        ShowSubObjects     	= KBTorches MBFDPF
    End

    Behavior = ObjectCreationUpgrade CreateTheDiscount
        TriggeredBy        	= Upgrade_AngmarFortressBanners
        Delay              	= 0.0
        ThingToSpawn       	= DiscountHeroObjectAngmar
        FadeInTime         	= 100
    End


    Behavior = ModelConditionUpgrade ModuleTag_ShowHouseOfLamentation
        TriggeredBy                = Upgrade_AngmarFortressHouseOfLamentation
        AddConditionFlags        = UPGRADE_HOUSE_OF_HEALING
        AddTempConditionFlag    = ModelConditionState:USER_3
        TempConditionTime        = 7.0
        Permanent            = Yes
    End

    Behavior = SpecialPowerModule ModuleTag_HouseOfLamentationUpdate
        SpecialPowerTemplate        = SpecialAbilityFakeLeadership
        UpdateModuleStartsAttack    = Yes
    End

    Behavior = AttributeModifierAuraUpdate ModuleTag_HouseOfLamentation
        StartsActive            = No
        BonusName            = DeathMaskModifier
        TriggeredBy            = Upgrade_AngmarFortressHouseOfLamentation
        RefreshDelay            = 2000
        Range                = ANGMAR_FORTRESS_DEATH_MASK_RANGE
        TargetEnemy            = Yes
        ObjectFilter            = ANY +INFANTRY +CAVALRY -STRUCTURE -BASE_FOUNDATION +HERO +HORDE -DunkelelbOpferbringerUnsichtbarFake -AngmarDireWolf_Slaved
    End


    Behavior = AudioLoopUpgrade ModuleTag_HouseOfHealingBuildLoop
        TriggeredBy            = Upgrade_AngmarFortressHouseOfLamentation
        SoundToPlay            = BuildingConstructionLoop
        KillOnDeath         = Yes
        KillAfterMS            = 5000
    End

    Behavior = CastleUpgrade ModuleTag_PassOutHouseOfHealingUpgrade
        TriggeredBy    = Upgrade_AngmarFortressHouseOfLamentation
        Upgrade        = Upgrade_AngmarFortressHouseOfLamentation
    End


    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_SanctumEnabler
        SpecialPowerTemplate    = SpecialAbilityWitchkingSanctumFrostball
        TriggeredBy                = Upgrade_AngmarFortressSanctumReady
    End

    Behavior = AudioLoopUpgrade ModuleTag_SanctumBuildLoop

        TriggeredBy            = Upgrade_AngmarFortressSanctum

        SoundToPlay            = BuildingBigConstructionLoop
        KillOnDeath         = Yes
        KillAfterMS            = 5200

    End

    Behavior = SpecialPowerModule ModuleTag_SanctumStarter
        SpecialPowerTemplate      = SpecialAbilityWitchkingSanctumFrostball
        UpdateModuleStartsAttack  = Yes
        StartsPaused                = Yes
        InitiateSound            = GorgorothSpireFireballBuildUpMS
    End
    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_SanctumWeaponFireUpdate
        SpecialPowerTemplate    = SpecialAbilityWitchkingSanctumFrostball
        WhichSpecialWeapon        = 2

        UnpackTime              = 3000
        PackTime                = 1500

        SpecialWeapon            = AngmarSanctumWeapon
        TriggerSound            = GorgorothSpireFireballLaunchMS
    End

    Behavior = AutoAbilityBehavior ModuleTag_AutoAbilityLightningBehavior
        SpecialAbility                = SpecialAbilityWitchkingSanctumFrostball
    End

    Behavior = AISpecialPowerUpdate FrostBall_AI
        CommandButtonName = Command_FireWeaponAngmarFortressSanctumFrostball
        SpecialPowerAIType = AI_SPELLBOOK_ASSIST_BATTLE_DEBUFF
        SpecialPowerRadius = 100
        RandomizeTargetLocation = Yes
    End

    Behavior = ModelConditionUpgrade ModuleTag_ShowTheTower
        TriggeredBy              = Upgrade_AngmarFortressSanctum
        AddConditionFlags        = UPGRADE_IVORY_TOWER
        AddTempConditionFlag     = ModelConditionState:USER_2
        TempConditionTime        = 10.0
        Permanent                = Yes
    End

    Behavior = ObjectCreationUpgrade CatapultReady
        TriggeredBy         = Upgrade_AngmarFortressSanctum
        Delay               = 3000
        GrantUpgrade        = Upgrade_AngmarFortressSanctumReady
    End

    Behavior = GeometryUpgrade TowerGeom
        TriggeredBy         = Upgrade_AngmarFortressSanctum
        ShowGeometry        = HighTowerGeom
    End


    Behavior = AIUpdateInterface ModuleTag_AI
        AILuaEventsList                = FortressFunctions
        AutoAcquireEnemiesWhenIdle     = Yes
        MoodAttackCheckRate            = 250
    End





    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_SummonPortalEnabler
        SpecialPowerTemplate         = SpellSummonUnderworldPortal
        TriggeredBy                  = Upgrade_GlobalFirstAgeSpell
    End

    Behavior = OCLSpecialPower ModuleTag_SummonPortal
        SpecialPowerTemplate         = SpellSummonUnderworldPortal
        OCL                          = OCL_SummonUnderworldPortal
        CreateLocation               = CREATE_AT_LOCATION
        StartsPaused                 = Yes
    End

    Behavior = AISpecialPowerUpdate SummonPortal_AI
        CommandButtonName  = Command_SummonUnderworldPortal
        SpecialPowerAIType = AI_SPELLBOOK_ASSIST_BATTLE_DEBUFF
        SpecialPowerRadius = 1000
        RandomizeTargetLocation = Yes
    End





    Behavior = AttributeModifierAuraUpdate ModuleTag_SchwarzeGarde
        StartsActive   = No
        BonusName      = SchwarzeGardeFortressModifier
        TriggeredBy    = Upgrade_AngmarSchwarzeGarde
        RefreshDelay   = 2000
        Range          = 1000000
        ObjectFilter   = ANY +HERO -INFANTRY -CAVALRY -STRUCTURE -BASE_FOUNDATION -HORDE -DOZER ALLIES
    End





    Behavior = AttributeModifierAuraUpdate ModuleTag_FortressSanctumModifier
        StartsActive   = No
        BonusName      = SanctumBarracksModifier
        TriggeredBy    = Upgrade_AngmarFortressSanctum
        RefreshDelay   = 2000
        Range          = 1000000
	    TargetEnemy	= No
        ObjectFilter   = NONE +AngmarBarracks ALLIES
    End

    Behavior = ArmorUpgrade ArmorUpgradeModuleTag
        TriggeredBy             = Upgrade_AngmarFortressSanctum
    End





    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_MachtEnabler
        SpecialPowerTemplate         = SpecialAbilityFortressMachtdesHK
        TriggeredBy                  = Upgrade_AngmarFortressSanctumReady
    End

    Behavior = SpecialPowerModule ModuleTag_MachtStarter
        SpecialPowerTemplate     = SpecialAbilityFortressMachtdesHK
        UpdateModuleStartsAttack = Yes
        StartsPaused             = Yes
        InitiateSound            = AngWitchkingVoiceModeMorgulCorruption
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_MachtUpdate
        SpecialPowerTemplate     = SpecialAbilityFortressMachtdesHK
        SkipContinue             = Yes
        UnpackTime               = 1100
        PreparationTime          = 1
        PersistentPrepTime       = 500
        PackTime                 = 500
        MustFinishAbility        = Yes
        AwardXPForTriggering     = 0
        StartAbilityRange        = 100000
        SpecialWeapon            = FortressMachtHKWeapon
        WhichSpecialWeapon       = 2
    End





    Behavior = CommandSetUpgrade ModuleTag_CommandSetGolfimbulFix
        TriggeredBy         = Upgrade_AngmarDieVerdammtenTrigger Upgrade_AngmarHexerdesZwielichtsTrigger Upgrade_AngmarGefalleneDunedainTrigger
        CommandSet          = AngmarFortressAllUpgradesCommandSet
	RequiresAllTriggers = Yes
    End


    Behavior = AutoDepositUpdate AutoDepositModuleTag
        DepositTiming           = GENERIC_KEEP_MONEY_TIME
        DepositAmount           = GENERIC_KEEP_MONEY_AMOUNT
        InitialCaptureBonus     = 0
    End

    Behavior = TerrainResourceBehavior ModuleTag_NewMoneyDeadSpot
        Radius            = GENERIC_KEEP_MONEY_RANGE
        MaxIncome        = 0
        IncomeInterval    = 999999
        HighPriority    = Yes
        Visible = No
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI1
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 320000
        GrantUpgrade = Upgrade_AngmarFortressBanners
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI2
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 700000
        GrantUpgrade = Upgrade_AngmarFortressSpikes
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI3
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 1000000
        GrantUpgrade = Upgrade_AngmarFortressIceMunitionsTrigger
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI4
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 1400000
        GrantUpgrade = Upgrade_AngmarFortressHouseOfLamentation
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI5
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 1700000
        GrantUpgrade = Upgrade_AngmarFortressIceWallsTrigger
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI6A
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 750000
        GrantUpgrade = Upgrade_AngmarDieVerdammtenTrigger
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI6B
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 820000
        GrantUpgrade = Upgrade_AngmarHexerdesZwielichtsTrigger
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI6C
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 900000
        GrantUpgrade = Upgrade_AngmarGefalleneDunedainTrigger
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamA7A
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 920000
        GrantUpgrade = Upgrade_AngmarGefalleneDunedain
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI7B
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 830000
        GrantUpgrade = Upgrade_AngmarHexerdesZwielichts
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI7C
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 760000
        GrantUpgrade = Upgrade_AngmarDieVerdammten
    End

    Geometry                  = CYLINDER
    GeometryMajorRadius       = 84
    GeometryHeight            = 60

    AdditionalGeometry        = CYLINDER
    GeometryName              = Spike1
    GeometryMajorRadius       = 18
    GeometryHeight            = 150
    GeometryOffset            = X:56 Y:56 Z:0

    AdditionalGeometry        = CYLINDER
    GeometryName              = Spike2
    GeometryMajorRadius       = 18
    GeometryHeight            = 150
    GeometryOffset            = X:56 Y:-56 Z:0

    AdditionalGeometry        = CYLINDER
    GeometryName              = Spike3
    GeometryMajorRadius       = 18
    GeometryHeight            = 150
    GeometryOffset            = X:-56 Y:56 Z:0

    AdditionalGeometry        = CYLINDER
    GeometryName              = Spike4
    GeometryMajorRadius       = 18
    GeometryHeight            = 150
    GeometryOffset            = X:-56 Y:-56 Z:0


    AdditionalGeometry        = CYLINDER
    GeometryName              = HighTowerGeom
    GeometryMajorRadius       = 15
    GeometryHeight            = 150
    GeometryOffset            = X:0 Y:0 Z:0
    GeometryUsedForHealthBox  = No

    GeometryIsSmall           = No
    Shadow                    = SHADOW_VOLUME
    BuildCompletion           = PLACED_BY_PLAYER

    GeometryContactPoint = X:-104     Y:79      Z:0          Repair
    GeometryContactPoint = X:41       Y:-42     Z:0
    GeometryContactPoint = X:41       Y:-42     Z:45
    GeometryContactPoint = X:-41      Y:-42     Z:45
    GeometryContactPoint = X:-41      Y:-42     Z:0
    GeometryContactPoint = X:-80      Y:0       Z:0
    GeometryContactPoint = X:-80      Y:0       Z:45
    GeometryContactPoint = X:-41      Y:42      Z:45
    GeometryContactPoint = X:-41      Y:42      Z:0
    GeometryContactPoint = X:41       Y:42      Z:0
    GeometryContactPoint = X:41       Y:42      Z:45
    GeometryContactPoint = X:80       Y:0       Z:45
    GeometryContactPoint = X:80       Y:0       Z:0
    GeometryContactPoint = X:0        Y:0       Z:180        Swoop
End



Object AngmarFortress

    SelectPortrait = KUFortressPortrait

    Draw   = W3DScriptedModelDraw ModuleTag_01
        OkToChangeModelColor    = Yes
        StaticModelLODMode        = Yes

        DefaultModelConditionState
            Model           = None
        End

        IdleAnimationState
        End


        ModelConditionState = WORLD_BUILDER
            Model    = KBFortress
        End


        ModelConditionState = BUILD_PLACEMENT_CURSOR
            Model    = None
        End


        ModelConditionState =  PHANTOM_STRUCTURE
            Model    = KBFortress
        End


        AnimationState = BUILD_PLACEMENT_CURSOR
            BeginScript
                CurDrawableHideSubObject("IceMunitions01")
                CurDrawableHideSubObject("IceMunitions02")
                CurDrawableHideSubObject("IceMunitions03")
                CurDrawableHideSubObject("IceMunitions04")
                CurDrawableHideSubObject("IceMunMist_01")
                CurDrawableHideSubObject("IceMunMist_02")
                CurDrawableHideSubObject("IceMunMist_03")
                CurDrawableHideSubObject("IceMunMist_04")
                CurDrawableHideSubObject("IceWall")
                   CurDrawableHideSubObject("N_Window")
                   CurDrawableHideSubObject("DBFBANNER")
                   CurDrawableHideSubObject("DBFSKEGS")
                   CurDrawableHideSubObject("MBFDPF")
            EndScript
        End


        AnimationState = PHANTOM_STRUCTURE
            BeginScript
                CurDrawableHideSubObject("IceMunitions01")
                CurDrawableHideSubObject("IceMunitions02")
                CurDrawableHideSubObject("IceMunitions03")
                CurDrawableHideSubObject("IceMunitions04")
                CurDrawableHideSubObject("IceMunMist_01")
                CurDrawableHideSubObject("IceMunMist_02")
                CurDrawableHideSubObject("IceMunMist_03")
                CurDrawableHideSubObject("IceMunMist_04")
                   CurDrawableHideSubObject("IceWall")
                CurDrawableHideSubObject("N_Window")
                   CurDrawableHideSubObject("DBFBANNER")
                   CurDrawableHideSubObject("DBFSKEGS")
                   CurDrawableHideSubObject("MBFDPF")
            EndScript
        End

        ModelConditionState  = RUBBLE
            Model            = KBFortres_D3
        End

        AnimationState    = RUBBLE
            Animation    = Fortress_ReallyDamaged
                AnimationName        = KBFortres_D3SKL.KBFortres_D3AN
                AnimationMode        = ONCE
            End
            EnteringStateFX    = FX_FortressCollapse
            BeginScript
                CurDrawableHideSubObject("IceMunitions01")
                CurDrawableHideSubObject("IceMunitions02")
                CurDrawableHideSubObject("IceMunitions03")
                CurDrawableHideSubObject("IceMunitions04")
                CurDrawableHideSubObject("IceMunMist_01")
                CurDrawableHideSubObject("IceMunMist_02")
                CurDrawableHideSubObject("IceMunMist_03")
                CurDrawableHideSubObject("IceMunMist_04")
                   CurDrawableHideSubObject("IceWall")
                CurDrawableHideSubObject("N_Window")
                   CurDrawableHideSubObject("DBFBANNER")
                   CurDrawableHideSubObject("DBFSKEGS")
                   CurDrawableHideSubObject("MBFDPF")
            EndScript
        End

        ModelConditionState = SNOW ACTIVELY_BEING_CONSTRUCTED
            Model    = KBFortress_A
            Texture = KBFortress.tga KBFortress_Snow.tga
        End

        ModelConditionState = ACTIVELY_BEING_CONSTRUCTED
            Model            = KBFortress_A
        End

        AnimationState = ACTIVELY_BEING_CONSTRUCTED
            Animation                    = UpAndStill
                AnimationName            = KBFortress_ASKL.KBFortress_ABLD
                AnimationMode            = MANUAL
            End
            ParticleSysBone = NONE AngBuildingContructDustCastles FollowBone:Yes
            ParticleSysBone = NONE AngBuildingContructDustCastles2 FollowBone:Yes
            ParticleSysBone = NONE ExpAngmarFortress FollowBone:Yes
            ParticleSysBone = NONE ExpAngmarFortress2 FollowBone:Yes
            StateName        = BeingConstructed
            BeginScript
                CurDrawablePlaySound("GondorBarracksBeginConstruction")
                CurDrawableHideSubObject("IceMunitions01")
                CurDrawableHideSubObject("IceMunitions02")
                CurDrawableHideSubObject("IceMunitions03")
                CurDrawableHideSubObject("IceMunitions04")
                CurDrawableHideSubObject("IceMunMist_01")
                CurDrawableHideSubObject("IceMunMist_02")
                CurDrawableHideSubObject("IceMunMist_03")
                CurDrawableHideSubObject("IceMunMist_04")
                   CurDrawableHideSubObject("IceWall")
                   CurDrawableHideSubObject("N_Window")
                CurDrawableHideSubObject("DBFBANNER")
                CurDrawableHideSubObject("DBFSKEGS")
                   CurDrawableHideSubObject("MBFDPF")
            EndScript
        End
    End

    PlacementViewAngle    = -45

    ArmorSet
        Conditions      = None
        Armor           = DefaultFortressArmor
        DamageFX        = EmptyDamageFX
    End

    Side                = Angmar
    EditorSorting       = STRUCTURE
    MaxSimultaneousOfType = NEW_FORTRESS_RATIO

    BuildCost           = DWARVEN_FORTRESS_BUILDCOST
    BuildTime           = DEFAULT_FORTRESS_BUILDTIME


    AutoResolveUnitType = AutoResolveUnit_Fortress

        AutoResolveBody = AutoResolve_DwarvenFortressBody

        AutoResolveArmor
            Armor = AutoResolve_DwarvenFortressArmor
        End

        AutoResolveWeapon
            Weapon = AutoResolve_DwarvenFortressWeapon
        End

    DisplayName         = OBJECT:AngmarFortress



    #include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

    VoiceSelect                        = MordorFortressSelect

    SoundOnDamaged                    = BuildingLightDamageStone
    SoundOnReallyDamaged            = BuildingHeavyDamageStone

    VoiceSelectUnderConstruction    = BuildingEvilVoiceSelectUnderConstruction
    VoiceFullyCreated                = EVA:FortressComplete-Builder

    UnitSpecificSounds
        UnderConstruction            = BuildingBigConstructionLoop

        UnderRepairFromRubble        = BuildingBigConstructionLoop
    End

    ClientBehavior = ModelConditionAudioLoopClientBehavior ModuleTag_PlayCollapseSound
        ModelCondition = REQUIRED:RUBBLE Sound:BuildingSink
    End


    RadarPriority       = STRUCTURE
    KindOf              = STRUCTURE SELECTABLE IMMOBILE BASE_FOUNDATION MP_COUNT_FOR_VICTORY BASE_SITE CAN_SEE_THROUGH_STRUCTURE LIVING_WORLD_BUILDING_MIRROR

    Body                = StructureBody ModuleTag_05
        MaxHealth                    = DEFAULT_FORTRESS_HEALTH
    End

    Behavior = CastleBehavior ModuleTag_castle
        CastleToUnpackForFaction    = Angmar Fortress_Angmar
        CastleToUnpackForFaction    = Men Fortress_Angmar
        CastleToUnpackForFaction    = Arnor Fortress_Angmar
        CastleToUnpackForFaction    = Rohan Fortress_Angmar
        CastleToUnpackForFaction    = Elves Fortress_Angmar
        CastleToUnpackForFaction    = Imladris Fortress_Angmar
        CastleToUnpackForFaction    = Dwarves Fortress_Angmar
        CastleToUnpackForFaction    = Mordor Fortress_Angmar
        CastleToUnpackForFaction    = Isengard Fortress_Angmar
        CastleToUnpackForFaction    = Wild Fortress_Angmar

        FilterValidOwnedEntries        = ANY +STRUCTURE +WALK_ON_TOP_OF_WALL +BASE_FOUNDATION +TACTICAL_MARKER

        MaxCastleRadius             = 140.0
        InstantUnpack                = Yes
        KeepDeathKillsEverything    = Yes
        UnpackDelayTime                = 0.0

        EvaEnemyCastleSightedEvent = EnemyFortressSighted
    End

    Behavior = StructureCollapseUpdate ModuleTag_Collapse
        MinCollapseDelay        = 000
        MaxCollapseDelay        = 000
        CollapseDamping         = .5
        MaxShudder              = 0.6
        MinBurstDelay           = 250
        MaxBurstDelay           = 800
        BigBurstFrequency       = 4
        FXList                  = INITIAL   FX_StructureMediumCollapse
        FXList                  = ALMOST_FINAL  FX_StructureAlmostCollapse
        DestroyObjectWhenDone    = Yes
        CollapseHeight            = 120
    End

    Behavior            = GettingBuiltBehavior ModuleTag_GettingBuiltBehavior
        WorkerName    = AngmarWorkerNoSelect
        SpawnTimer    = DEFAULT_STRUCTURE_HEALDELAY
    End

    Behavior = AIUpdateInterface ModuleTag_AI
        AILuaEventsList        =    FortressFunctions
    End


    Geometry                  = CYLINDER
    GeometryMajorRadius       = 84
    GeometryHeight            = 60

    AdditionalGeometry        = CYLINDER
    GeometryName            = Spike1
    GeometryMajorRadius       = 18
    GeometryHeight            = 150
    GeometryOffset            = X:56 Y:56 Z:0

    AdditionalGeometry        = CYLINDER
    GeometryName            = Spike2
    GeometryMajorRadius       = 18
    GeometryHeight            = 150
    GeometryOffset            = X:56 Y:-56 Z:0

    AdditionalGeometry        = CYLINDER
    GeometryName            = Spike3
    GeometryMajorRadius       = 18
    GeometryHeight            = 150
    GeometryOffset            = X:-56 Y:56 Z:0

    AdditionalGeometry        = CYLINDER
    GeometryName            = Spike4
    GeometryMajorRadius       = 18
    GeometryHeight            = 150
    GeometryOffset            = X:-56 Y:-56 Z:0


    AdditionalGeometry        = CYLINDER
    GeometryName            = HighTowerGeom
    GeometryMajorRadius       = 15
    GeometryHeight            = 150
    GeometryOffset            = X:0 Y:0 Z:0
    GeometryUsedForHealthBox = No


    AdditionalGeometry        = BOX
    GeometryName            = Plots
    GeometryMajorRadius        = 10.0
    GeometryMinorRadius        = 10.0
    GeometryHeight            = 0.8
    GeometryOffset            = X:77.0 Y:77.0 Z:0

    AdditionalGeometry        = BOX
    GeometryName            = Plots
    GeometryMajorRadius        = 10.0
    GeometryMinorRadius        = 10.0
    GeometryHeight            = 0.8
    GeometryOffset            = X:77.0 Y:-77.0 Z:0

    AdditionalGeometry        = BOX
    GeometryName            = Plots
    GeometryMajorRadius        = 10.0
    GeometryMinorRadius        = 10.0
    GeometryHeight            = 0.8
    GeometryOffset            = X:-77.0 Y:-77.0 Z:0

    AdditionalGeometry        = BOX
    GeometryName            = Plots
    GeometryMajorRadius        = 10.0
    GeometryMinorRadius        = 10.0
    GeometryHeight            = 0.8
    GeometryOffset            = X:-77.0 Y:77.0 Z:0

    AdditionalGeometry        = BOX
    GeometryName            = Plots
    GeometryMajorRadius        = 10.0
    GeometryMinorRadius        = 10.0
    GeometryHeight            = 0.8
    GeometryOffset            = X:-110 Y:0.0 Z:0

    AdditionalGeometry        = BOX
    GeometryName            = Plots
    GeometryMajorRadius        = 10.0
    GeometryMinorRadius        = 10.0
    GeometryHeight            = 0.8
    GeometryOffset            = X:0.0 Y:-110.0 Z:0

    AdditionalGeometry        = BOX
    GeometryName            = Plots
    GeometryMajorRadius        = 10.0
    GeometryMinorRadius        = 10.0
    GeometryHeight            = 0.8
    GeometryOffset            = X:0.0 Y:110.0 Z:0


    GeometryIsSmall            = No
    Shadow                    = SHADOW_VOLUME

    GeometryContactPoint = X:-104    Y:79    Z:0            Repair
End


ChildObject    AngmarFortressDarkEye AngmarFortress
End


Object AngmarFortressSpikes

    Draw    = W3DScriptedModelDraw ModuleTag_01
        OkToChangeModelColor    = Yes

        DefaultModelConditionState
            Model           = KBFSpike
        End
    End

    ArmorSet
        Conditions        = None
        Armor             = NoArmor
    End

    Side                = Angmar
    EditorSorting       = STRUCTURE
    BuildTime           = 10.0


    #include "..\..\..\Includes\StandardBuildingEvaEvents.inc"
    CampnessValue = 0


    RadarPriority       = STRUCTURE
    KindOf              = STRUCTURE IMMOBILE NOT_AUTOACQUIRABLE UNATTACKABLE BASE_SITE CAN_SEE_THROUGH_STRUCTURE

    Body = HighlanderBody ModuleTag_02
        MaxHealth      = 1.0
    End

    Behavior = SlavedUpdate ModuleTag_Slave
        DieOnMastersDeath = Yes
    End

    Behavior = FireWeaponUpdate ModuleTag_WeaponFiring
        FireWeaponNugget
            WeaponName = SpikeMoatRadiusWeapon
            Offset = X:0 Y:0 Z:0
            FireDelay = 0
            OneShot = No
        End
    End

    Geometry                = CYLINDER
    GeometryMajorRadius     = 50
    GeometryHeight          = 5

    GeometryIsSmall         = No
    Shadow                  = SHADOW_VOLUME
End