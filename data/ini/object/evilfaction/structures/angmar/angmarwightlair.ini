Object AngmarBarrowWightLair_Player

    SelectPortrait = BRAngmarKapelle

    Draw = W3DScriptedModelDraw ModuleTag_Draw

        RandomTexture = extemple_runesblue.tga  0 extemple_runes.tga

        DefaultModelConditionState
            Model = kbchapele
        End


    AnimationState = BUILD_PLACEMENT_CURSOR
        BeginScript
                   CurDrawableHideSubObject("V2")
                   CurDrawableHideSubObject("V3")
                   CurDrawableHideSubObject("V4")
                   CurDrawableHideSubObject("V5")
                   CurDrawableHideSubObject("FIREAROWTIP")
                   CurDrawableHideSubObject("FIREAROWTIP01")
                   CurDrawableHideSubObject("FIREAROWTIP02")
                   CurDrawableHideSubObject("FIREAROWTIP03")
                   CurDrawableHideSubObject("FIREAROWTIP04")
                   CurDrawableHideSubObject("FIREAROWTIP05")
                   CurDrawableHideSubObject("FIREAROWTIP06")
        EndScript
    End


    AnimationState = PHANTOM_STRUCTURE
        BeginScript
                   CurDrawableHideSubObject("V2")
                   CurDrawableHideSubObject("V3")
                   CurDrawableHideSubObject("V4")
                   CurDrawableHideSubObject("V5")
                   CurDrawableHideSubObject("FIREAROWTIP")
                   CurDrawableHideSubObject("FIREAROWTIP01")
                   CurDrawableHideSubObject("FIREAROWTIP02")
                   CurDrawableHideSubObject("FIREAROWTIP03")
                   CurDrawableHideSubObject("FIREAROWTIP04")
                   CurDrawableHideSubObject("FIREAROWTIP05")
                   CurDrawableHideSubObject("FIREAROWTIP06")
        EndScript
    End

    ModelConditionState  = SNOW JUST_BUILT
            Model            = kbchapele_a
            Texture            = kbhall.tga kbhall_snow.tga
            Texture            = kbfortressb.tga kbfortressb_snow.tga
            Texture            = kbtemple.tga kbtemple_snow.tga
    End

    ModelConditionState  = JUST_BUILT
              Model               = kbchapele_a
    End

    AnimationState            = JUST_BUILT
        Animation
            AnimationName        = kbchapele_a.kbchapele_a
            AnimationMode        = ONCE
            AnimationBlendTime    = 0
        End
        BeginScript
            CurDrawableHideSubObject("WND_MESH_H01")
        EndScript
    End



        ModelConditionState = SNOW AWAITING_CONSTRUCTION
            Model            = kbchapele_a
            Texture            = kbhall.tga kbhall_snow.tga
            Texture            = kbfortressb.tga kbfortressb_snow.tga
            Texture            = kbtemple.tga kbtemple_snow.tga
        End
        ModelConditionState   = AWAITING_CONSTRUCTION
              Model               = kbchapele_a
        End
        AnimationState        = AWAITING_CONSTRUCTION
              Animation           = kbchapele_a
                AnimationName     = kbchapele_a.kbchapele_a
                AnimationMode     = MANUAL
              End
              Flags                  = START_FRAME_FIRST
        BeginScript
            CurDrawableHideSubObject("WND_MESH_H01")
        EndScript
        End

        ModelConditionState = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED SNOW
            Model            = kbchapele_a
        ParticleSysBone = NONE AngBuildingContructDust FollowBone:Yes
        ParticleSysBone = NONE AngBuildingContructDust2B FollowBone:Yes
        ParticleSysBone = NONE ExpAngmarB FollowBone:Yes
        ParticleSysBone = NONE ExpAngmar2B FollowBone:Yes
            Texture            = kbhall.tga kbhall_snow.tga
            Texture            = kbfortressb.tga kbfortressb_snow.tga
            Texture            = kbtemple.tga kbtemple_snow.tga
        End
        ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
          Model               = kbchapele_a
        ParticleSysBone = NONE AngBuildingContructDust FollowBone:Yes
        ParticleSysBone = NONE AngBuildingContructDust2B FollowBone:Yes
        ParticleSysBone = NONE ExpAngmarB FollowBone:Yes
        ParticleSysBone = NONE ExpAngmar2B FollowBone:Yes

        End
        AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
              Animation           = kbchapele_a
                AnimationName     = kbchapele_a.kbchapele_a
                AnimationMode     = MANUAL
              End
            Flags                = START_FRAME_FIRST
            StateName            = BeingConstructed
             BeginScript




            CurDrawableHideSubObject("WND_MESH_H01")
         EndScript
        End



        ModelConditionState  = DAMAGED
            Model         = kbchapele
        End
        AnimationState = DAMAGED
            EnteringStateFX    = FX_BuildingDamaged
        End

        ModelConditionState  = REALLYDAMAGED
            Model         = kbchapele
        End

        AnimationState = REALLYDAMAGED
            EnteringStateFX    = FX_BuildingReallyDamaged
        End

        ModelConditionState  = COLLAPSING
            Model         = kbchapel_D3
        End

        AnimationState = COLLAPSING
              Animation                =    RubbleAnimation
                AnimationName        =     kbchapel_D3.kbchapel_D3
                AnimationMode        =    ONCE
              End
              EnteringStateFX    = FX_StructureMediumCollapse
        End

        ModelConditionState  = RUBBLE
            Model         = None
        End

        ModelConditionState  = POST_RUBBLE
            Model         = NONE
            ParticleSysBone NONE SmokeBuildingMediumRubble
        End

        AnimationState = POST_RUBBLE
        End

        ModelConditionState  = POST_COLLAPSE
        Model         = None
            ParticleSysBone NONE SmokeBuildingMediumRubble
        End

        AnimationState = POST_COLLAPSE
        End

        ModelConditionState = SNOW
            Model            = kbchapele
            Texture            = kbhall.tga kbhall_snow.tga
            Texture            = kbfortressb.tga kbfortressb_snow.tga
            Texture            = kbtemple.tga kbtemple_snow.tga
        End

        ModelConditionState = USER_8
            Model            = kbchapele
            Texture            = kbhall.tga kbhall_snow.tga
            Texture            = kbfortressb.tga kbfortressb_snow.tga
            Texture            = kbtemple.tga kbtemple_snow.tga
        End
    End

    Draw = W3DScriptedModelDraw ModuleTag_FX
        DefaultModelConditionState
            Model = None
        End
    End



    DisplayName            = OBJECT:BarrowWightLair
    Description            = OBJECT:AngmarBarrowWightLairDescription
    Side                   = Angmar
    IsTrainable            = Yes
    EditorSorting          = STRUCTURE
    ThreatLevel            = 1.0
    PlacementViewAngle     = -45
    RefundValue             = 250
    BuildCost               = 500
    BuildTime               = 35
    BountyValue             = 80
    VisionRange             = 160
    ShroudClearingRange     = 180
    CommandSet              = AngmarGrabunholdLairCommandSet
    MaxSimultaneousOfType   = 1

  ArmorSet
    Conditions        = None
    Armor             = FactoryArmor
  End



    VoiceSelect             = BarrowWightBuildingSelect
    VoiceFullyCreated       = EVA:GenericBuildingComplete-Builder

    SoundAmbient            = BarrowWightLairAmbienceMS
    SoundOnDamaged          = BuildingLightDamageStone
    SoundOnReallyDamaged    = BuildingHeavyDamageStone


    RadarPriority       = STRUCTURE
    KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE FS_FACTORY AUTO_RALLYPOINT MP_COUNT_FOR_VICTORY NEED_BASE_FOUNDATION ATTACK_NEEDS_LINE_OF_SIGHT CAN_ATTACK MADE_OF_STONE LIVING_WORLD_BUILDING_MIRROR GARRISONABLE_UNTIL_DESTROYED GARRISON

  Behavior            = GettingBuiltBehavior ModuleTag_04
    WorkerName        = AngmarWorkerNoSelect
    SpawnTimer        = DEFAULT_STRUCTURE_HEALDELAY
  End

    Body                       = StructureBody ModuleTag_05
        MaxHealth              = 3500
        MaxHealthDamaged       = 1000
        MaxHealthReallyDamaged = 400
    End

    Behavior = AIUpdateInterface ModuleTag_SoWeCanUseWeapon
        AutoAcquireEnemiesWhenIdle = Yes
        MoodAttackCheckRate        = 250
        AILuaEventsList            = AngmarStructuresFunctions
    End

    Behavior = GrantUpgradeCreate ModuleTag_EnableHK
        UpgradeToGrant      = Upgrade_AngmarStructureWightlairBuild
        GiveOnBuildComplete = Yes
    End


    Behavior = TunnelContain ModuleTag_Contain
        ObjectStatusOfContained         = UNSELECTABLE ENCLOSED
        ContainMax                      = 5
        DamagePercentToUnits            = 0%
        PassengerFilter                 = NONE +BarrowWight_Summoned +BarrowWight +AngmarKarsh_mod_SummonedLvl1 +AngmarKarshSB_SummonedLvl1 +AngmarKarsh_mod_SummonedLvl3 +AngmarKarshSB_SummonedLvl3 +AngmarKarsh_mod_SummonedLvl5 +AngmarKarshSB_SummonedLvl5 +AngmarKarsh_mod_SummonedLvl7 +AngmarKarshSB_SummonedLvl7 +AngmarKarsh_mod_SummonedLvl10 +AngmarKarshSB_SummonedLvl10 +AngmarGrabunholdLvl2 +AngmarGrabunholdLvl3 +AngmarGrabunholdLvl4 +AngmarGrabunholdLvl5 +AngmarGrabunhold
        AllowEnemiesInside              = No
        AllowAlliesInside               = No
        AllowNeutralInside              = No
        AllowOwnPlayerInsideOverride    = Yes
        NumberOfExitPaths               = 1
        PassengerBonePrefix             = PassengerBone:ARROW_ KindOf:INFANTRY
        EntryPosition                   = X:0.0 Y:0.0 Z:0.0
        EntryOffset                     = X:0.0 Y:0.0 Z:0.0
        ExitOffset                      = X:0.0 Y:0.0 Z:0.0
        EnterSound                      = RuinedTowerEnterSound
        KillPassengersOnDeath           = No
        ShowPips                        = No
        ExitDelay                       = 0
    End


    Behavior = QueueProductionExitUpdate ModuleTag_11
        UnitCreatePoint      = X:0.0 Y:0.0 Z:0.0
        NaturalRallyPoint    = X:70.0 Y:0.0 Z:0.0
        ExitDelay            = 250
    End


    Behavior = SubObjectsUpgrade ModuleTag_HideAll
        TriggeredBy        = Upgrade_StructureLevel1
        ShowSubObjects    = PMBONES01
        HideSubObjects    = V2 V3 V4 V5 FIREAROWTIP FIREAROWTIP01 FIREAROWTIP03 FIREAROWTIP04 FIREAROWTIP05 FIREAROWTIP06
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowWalls
        TriggeredBy        = Upgrade_BarrowWightLairLevel2
        ShowSubObjects    = V2
        HideSubObjects    = V3 V4 V5
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowFlagsAndTower
        TriggeredBy        = Upgrade_BarrowWightLairLevel3
        ShowSubObjects    = V2 V3
        HideSubObjects    = V4 V5
    End

      Behavior = SubObjectsUpgrade ModuleTag_Pyres
        TriggeredBy        = Upgrade_BarrowWightLairLevel4
        ShowSubObjects    = V2 V3 V4
        HideSubObjects    = V5
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowEverything
        TriggeredBy        = Upgrade_BarrowWightLairLevel5
        ShowSubObjects    = V2 V3 V4 V5 FIREAROWTIP FIREAROWTIP01 FIREAROWTIP03 FIREAROWTIP04 FIREAROWTIP05 FIREAROWTIP06
    End

    Behavior = SpawnBehavior ModuleTag_SpawnFighters5
        TriggeredBy          = Upgrade_BarrowWightLairLevel5
        SpawnNumber          = 3
        InitialBurst         = 1
        SpawnTemplateName    = BarrowWight_Slaved
        SpawnReplaceDelay    = 30000
        CanReclaimOrphans    = Yes
    End

    Behavior = LevelUpUpgrade ModuleTag_SchurfmineLevel2
        TriggeredBy       = Upgrade_BarrowWightLairLevel2
        LevelsToGain      = 1
        LevelCap          = 2
    End

    Behavior = LevelUpUpgrade ModuleTag_SchurfmineLevel3
        TriggeredBy       = Upgrade_BarrowWightLairLevel3
        LevelsToGain      = 1
        LevelCap          = 3
    End

    Behavior = LevelUpUpgrade ModuleTag_SchurfmineLevel4
        TriggeredBy       = Upgrade_BarrowWightLairLevel4
        LevelsToGain      = 1
        LevelCap          = 4
    End

    Behavior = LevelUpUpgrade ModuleTag_SchurfmineLevel5
        TriggeredBy       = Upgrade_BarrowWightLairLevel5
        LevelsToGain      = 1
        LevelCap          = 5
    End

    Behavior = CommandSetUpgrade ModueTag_Level2CommandSet
        TriggeredBy    = Upgrade_BarrowWightLairLevel2
        ConflictsWith  = Upgrade_BarrowWightLairLevel3
        CommandSet     = AngmarGrabunholdLairCommandSet2
    End

    Behavior = CommandSetUpgrade ModueTag_Level3CommandSet
        TriggeredBy    = Upgrade_BarrowWightLairLevel3
        ConflictsWith  = Upgrade_BarrowWightLairLevel4
        CommandSet     = AngmarGrabunholdLairCommandSet3
    End

    Behavior = CommandSetUpgrade ModueTag_Level4CommandSet
        TriggeredBy    = Upgrade_BarrowWightLairLevel4
        ConflictsWith  = Upgrade_BarrowWightLairLevel5
        CommandSet     = AngmarGrabunholdLairCommandSet4
    End

    Behavior = CommandSetUpgrade ModueTag_Level5CommandSet
        TriggeredBy    = Upgrade_BarrowWightLairLevel5
        CommandSet     = AngmarGrabunholdLairCommandSet5
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI1
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 280000
        GrantUpgrade = Upgrade_BarrowWightLairLevel2
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI2
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 350000
        GrantUpgrade = Upgrade_BarrowWightLairLevel3
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI3
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 480000
        GrantUpgrade = Upgrade_BarrowWightLairLevel4
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI4
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 650000
        GrantUpgrade = Upgrade_BarrowWightLairLevel5
    End


    Behavior = OCLSpecialPower ModuleTag_OCLSpecialPowerKarshSummonLvl1
        SpecialPowerTemplate    = SpecialAbilityKarshSummonLvl1
        OCL                     = OCL_KarshSummonLvl1
        TriggerFX               = FX_DurbutzBlutigesAntreiben
        CreateLocation          = CREATE_AT_LOCATION
        StartsPaused            = No
        AvailableAtStart        = Yes
    End

    Behavior = OCLSpecialPower ModuleTag_OCLSpecialPowerKarshSummonLvl3
        SpecialPowerTemplate    = SpecialAbilityKarshSummonLvl3
        OCL                     = OCL_KarshSummonLvl3
        TriggerFX               = FX_DurbutzBlutigesAntreiben
        CreateLocation          = CREATE_AT_LOCATION
        StartsPaused            = No
        AvailableAtStart        = Yes
    End

    Behavior = OCLSpecialPower ModuleTag_OCLSpecialPowerKarshSummonLvl5
        SpecialPowerTemplate    = SpecialAbilityKarshSummonLvl5
        OCL                     = OCL_KarshSummonLvl5
        TriggerFX               = FX_DurbutzBlutigesAntreiben
        CreateLocation          = CREATE_AT_LOCATION
        StartsPaused            = No
        AvailableAtStart        = Yes
    End

    Behavior = OCLSpecialPower ModuleTag_OCLSpecialPowerKarshSummonLvl7
        SpecialPowerTemplate    = SpecialAbilityKarshSummonLvl7
        OCL                     = OCL_KarshSummonLvl7
        TriggerFX               = FX_DurbutzBlutigesAntreiben
        CreateLocation          = CREATE_AT_LOCATION
        StartsPaused            = No
        AvailableAtStart        = Yes
    End

    Behavior = OCLSpecialPower ModuleTag_OCLSpecialPowerKarshSummonLvl10
        SpecialPowerTemplate    = SpecialAbilityKarshSummonLvl10
        OCL                     = OCL_KarshSummonLvl10
        TriggerFX               = FX_DurbutzBlutigesAntreiben
        CreateLocation          = CREATE_AT_LOCATION
        StartsPaused            = No
        AvailableAtStart        = Yes
    End


    Behavior = AttributeModifierAuraUpdate ModuleTag_DreadVisage
        StartsActive      = Yes
        BonusName         = GenericDebuff
        RefreshDelay      = 2000
        Range             = DWARVEN_STATUE_AOE_RADIUS
        TargetEnemy       = Yes
        AntiCategory      = LEADERSHIP STRUCTURE
        ObjectFilter      = GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
    End

    Behavior = RadiateFearUpdate ModuleTag_DreadVisageFear
        InitiallyActive         = Yes
        WhichSpecialPower       = 1
        GenerateTerror          = No
        GenerateFear            = Yes
        EmotionPulseRadius      = DWARVEN_STATUE_AOE_RADIUS
        EmotionPulseInterval    = 1000
    End

    Behavior = StructureCollapseUpdate ModuleTag_Collapse
        MinCollapseDelay        = 000
        MaxCollapseDelay        = 000
        CollapseDamping         = .5
        MaxShudder              = 0.6
        MinBurstDelay           = 250
        MaxBurstDelay           = 800
        BigBurstFrequency       = 4
        FXList                  = INITIAL   FX_StructureMediumCollapse
        FXList                  = ALMOST_FINAL  FX_StructureAlmostCollapse
        DestroyObjectWhenDone   = Yes
        CollapseHeight          = 120
    End


    Behavior = ProductionUpdate ProductionUpdateModuleTag
        GiveNoXP                    = Yes
        NumDoorAnimations           = 0
    End

    Behavior = FireWeaponUpdate FireWeaponUpdateModuleTag
        FireWeaponNugget
            WeaponName = AngmarStructureRingWeapon
            FireDelay = 0
            OneShot = No
        End
    End

    Geometry                = CYLINDER
      GeometryMajorRadius        = 40.0
    GeometryMinorRadius        = 40.0
    GeometryHeight            = 42.0
    GeometryOffset            = X:0.6 Y:12.0 Z:0

    GeometryIsSmall        = No
    Shadow                = SHADOW_VOLUME
    BuildCompletion        = PLACED_BY_PLAYER
End

ChildObject AngmarBarrowWightLair_Player_Independant AngmarBarrowWightLair_Player

    SelectPortrait = BPCWightLair

    Draw = W3DScriptedModelDraw ModuleTag_Draw

        DefaultModelConditionState
            Model = kbgrufteingang
        End

    ModelConditionState  = SNOW JUST_BUILT
            Model            = kbgrufteina
            Texture            = NBWightLairS.tga NBWightLairS_Snow.tga
            Texture            = NBWightLairS2_Snow.tga NBWightLairS2.tga
    End

    ModelConditionState  = JUST_BUILT
              Model               = kbgrufteina
    End

    AnimationState            = JUST_BUILT
        Animation
            AnimationName        = kbgrufteina.kbgrufteina
            AnimationMode        = ONCE
            AnimationBlendTime    = 0
            AnimationSpeedFactorRange = 10.10 10.10
        End
    End



        ModelConditionState = SNOW AWAITING_CONSTRUCTION
            Model            = kbgrufteina
            Texture            = NBWightLairS.tga NBWightLairS_Snow.tga
            Texture            = NBWightLairS2_Snow.tga NBWightLairS2.tga
        End
        ModelConditionState   = AWAITING_CONSTRUCTION
              Model               = kbgrufteina
        End
        AnimationState        = AWAITING_CONSTRUCTION
              Animation           = kbgrufteina
                AnimationName     = kbgrufteina.kbgrufteina
                AnimationMode     = MANUAL
              End
              Flags                  = START_FRAME_FIRST
        End

        ModelConditionState = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED SNOW
            Model            = kbgrufteina
        ParticleSysBone = NONE AngBuildingContructDust FollowBone:Yes
        ParticleSysBone = NONE AngBuildingContructDust2B FollowBone:Yes
        ParticleSysBone = NONE ExpAngmarB FollowBone:Yes
        ParticleSysBone = NONE ExpAngmar2B FollowBone:Yes
            Texture            = NBWightLairS.tga NBWightLairS_Snow.tga
            Texture            = NBWightLairS2_Snow.tga NBWightLairS2.tga
        End
        ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
          Model               = kbgrufteina
        ParticleSysBone = NONE AngBuildingContructDust FollowBone:Yes
        ParticleSysBone = NONE AngBuildingContructDust2B FollowBone:Yes
        ParticleSysBone = NONE ExpAngmarB FollowBone:Yes
        ParticleSysBone = NONE ExpAngmar2B FollowBone:Yes

        End
        AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
              Animation           = kbgrufteina
                AnimationName     = kbgrufteina.kbgrufteina
                AnimationMode     = MANUAL
              End
            Flags                = START_FRAME_FIRST
            StateName            = BeingConstructed
        End



        ModelConditionState  = DAMAGED
            Model         = kbgrufteingang
        End
        AnimationState = DAMAGED
            EnteringStateFX    = FX_BuildingDamaged
        End

        ModelConditionState  = REALLYDAMAGED
            Model         = kbgrufteingang
        End

        AnimationState = REALLYDAMAGED
              Animation                =    RubbleAnimation
                AnimationName        =     kbgrufteingang.kbgrufteingang
                AnimationMode        =    ONCE
              End
            EnteringStateFX    = FX_BuildingReallyDamaged
        End

        ModelConditionState  = COLLAPSING
            Model         = kbgrufteingang
        End

        AnimationState = COLLAPSING
              Animation                =    RubbleAnimation
                AnimationName        =     kbgrufteingang.kbgrufteingang
                AnimationMode        =    ONCE
              End
              EnteringStateFX    = FX_StructureMediumCollapse
        End

        ModelConditionState  = RUBBLE
            Model         = None
        End

        ModelConditionState  = POST_RUBBLE
            Model         = NONE
            ParticleSysBone NONE SmokeBuildingMediumRubble
        End

        AnimationState = POST_RUBBLE
        End

        ModelConditionState  = POST_COLLAPSE
        Model         = None
            ParticleSysBone NONE SmokeBuildingMediumRubble
        End

        AnimationState = POST_COLLAPSE
        End

        ModelConditionState = SNOW
            Model            = kbgrufteingang
            Texture            = NBWightLairS.tga NBWightLairS_Snow.tga
            Texture            = NBWightLairS2_Snow.tga NBWightLairS2.tga
        End

        ModelConditionState = USER_8
            Model            = kbgrufteingang
            Texture            = NBWightLairS.tga NBWightLairS_Snow.tga
            Texture            = NBWightLairS2_Snow.tga NBWightLairS2.tga
        End
    End

    Draw = W3DFloorDraw ModuleTag_DrawFloor
        StaticModelLODMode = Yes
        ModelName = None
    End

    Draw = W3DScriptedModelDraw ModuleTag_FX
        DefaultModelConditionState
            Model = None
        End
    End

    Behavior = QueueProductionExitUpdate ModuleTag_11
       UnitCreatePoint       = X:0.0 Y:0.0 Z:0.0
        NaturalRallyPoint    = X:80.0 Y:80.0 Z:0.0
        ExitDelay            = 250
    End



    VoiceSelect             = NoSound
    VoiceFullyCreated       = NoSound

    CampnessValue           = CAMPNESS_SUMMONED
    Description             = OBJECT:AngmarBarrowWightLairDescriptionSummon

    CommandSet              = AngmarGrabunholdLairCommandSet_Summoned

    Geometry                = CYLINDER
    GeometryMajorRadius     = 40.0
    GeometryMinorRadius     = 40.0
    GeometryHeight          = 42.0
    GeometryOffset          = X:0.6 Y:12.0 Z:0

    GeometryIsSmall         = No
    Shadow                  = SHADOW_VOLUME
    BuildCompletion         = PLACED_BY_PLAYER
End

Object AngmarBarrowWightLair

    SelectPortrait = BRAngmarKapelle


    Draw = W3DScriptedModelDraw ModuleTag_Draw

        DefaultModelConditionState
            Model = kbchapele
        End

    AnimationState = BUILD_PLACEMENT_CURSOR
        BeginScript
                   CurDrawableHideSubObject("V2")
                   CurDrawableHideSubObject("V3")
                   CurDrawableHideSubObject("V4")
                   CurDrawableHideSubObject("V5")
                   CurDrawableHideSubObject("FIREAROWTIP")
                   CurDrawableHideSubObject("FIREAROWTIP01")
                   CurDrawableHideSubObject("FIREAROWTIP02")
                   CurDrawableHideSubObject("FIREAROWTIP03")
                   CurDrawableHideSubObject("FIREAROWTIP04")
                   CurDrawableHideSubObject("FIREAROWTIP05")
                   CurDrawableHideSubObject("FIREAROWTIP06")
        EndScript
    End


    AnimationState = PHANTOM_STRUCTURE
        BeginScript
                   CurDrawableHideSubObject("V2")
                   CurDrawableHideSubObject("V3")
                   CurDrawableHideSubObject("V4")
                   CurDrawableHideSubObject("V5")
                   CurDrawableHideSubObject("FIREAROWTIP")
                   CurDrawableHideSubObject("FIREAROWTIP01")
                   CurDrawableHideSubObject("FIREAROWTIP02")
                   CurDrawableHideSubObject("FIREAROWTIP03")
                   CurDrawableHideSubObject("FIREAROWTIP04")
                   CurDrawableHideSubObject("FIREAROWTIP05")
                   CurDrawableHideSubObject("FIREAROWTIP06")
        EndScript
    End

    ModelConditionState  = SNOW JUST_BUILT
            Model            = kbchapele_a
            Texture            = kbhall.tga kbhall_snow.tga
            Texture            = kbfortressb.tga kbfortressb_snow.tga
            Texture            = kbtemple.tga kbtemple_snow.tga
    End

    ModelConditionState  = JUST_BUILT
              Model               = kbchapele_a
    End

    AnimationState            = JUST_BUILT
        Animation
            AnimationName        = kbchapele_a.kbchapele_a
            AnimationMode        = ONCE
            AnimationBlendTime    = 0
        End
        BeginScript
            CurDrawableHideSubObject("WND_MESH_H01")
        EndScript
    End



        ModelConditionState = SNOW AWAITING_CONSTRUCTION
            Model            = kbchapele_a
            Texture            = kbhall.tga kbhall_snow.tga
            Texture            = kbfortressb.tga kbfortressb_snow.tga
            Texture            = kbtemple.tga kbtemple_snow.tga
        End
        ModelConditionState   = AWAITING_CONSTRUCTION
              Model               = kbchapele_a
        End
        AnimationState        = AWAITING_CONSTRUCTION
              Animation           = kbchapele_a
                AnimationName     = kbchapele_a.kbchapele_a
                AnimationMode     = MANUAL
              End
              Flags                  = START_FRAME_FIRST
        BeginScript
            CurDrawableHideSubObject("WND_MESH_H01")
        EndScript
        End

        ModelConditionState = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED SNOW
            Model            = kbchapele_a
        ParticleSysBone = NONE AngBuildingContructDust FollowBone:Yes
        ParticleSysBone = NONE AngBuildingContructDust2B FollowBone:Yes
        ParticleSysBone = NONE ExpAngmarB FollowBone:Yes
        ParticleSysBone = NONE ExpAngmar2B FollowBone:Yes
            Texture            = kbhall.tga kbhall_snow.tga
            Texture            = kbfortressb.tga kbfortressb_snow.tga
            Texture            = kbtemple.tga kbtemple_snow.tga
        End
        ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
          Model               = kbchapele_a
        ParticleSysBone = NONE AngBuildingContructDust FollowBone:Yes
        ParticleSysBone = NONE AngBuildingContructDust2B FollowBone:Yes
        ParticleSysBone = NONE ExpAngmarB FollowBone:Yes
        ParticleSysBone = NONE ExpAngmar2B FollowBone:Yes

        End
        AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
              Animation           = kbchapele_a
                AnimationName     = kbchapele_a.kbchapele_a
                AnimationMode     = MANUAL
              End
            Flags                = START_FRAME_FIRST
            StateName            = BeingConstructed
             BeginScript




            CurDrawableHideSubObject("WND_MESH_H01")
         EndScript
        End



        ModelConditionState  = DAMAGED
            Model         = kbchapele
        End
        AnimationState = DAMAGED
            EnteringStateFX    = FX_BuildingDamaged
        End

        ModelConditionState  = REALLYDAMAGED
            Model         = kbchapele
        End

        AnimationState = REALLYDAMAGED
            EnteringStateFX    = FX_BuildingReallyDamaged
        End

        ModelConditionState  = COLLAPSING
            Model         = kbchapel_D3
        End

        AnimationState = COLLAPSING
              Animation                =    RubbleAnimation
                AnimationName        =     kbchapel_D3.kbchapel_D3
                AnimationMode        =    ONCE
              End
              EnteringStateFX    = FX_StructureMediumCollapse
        End

        ModelConditionState  = RUBBLE
            Model         = None
        End

        ModelConditionState  = POST_RUBBLE
            Model         = NONE
            ParticleSysBone NONE SmokeBuildingMediumRubble
        End

        AnimationState = POST_RUBBLE
        End

        ModelConditionState  = POST_COLLAPSE
        Model         = None
            ParticleSysBone NONE SmokeBuildingMediumRubble
        End

        AnimationState = POST_COLLAPSE
        End

        ModelConditionState = SNOW
            Model            = kbchapele
            Texture            = kbhall.tga kbhall_snow.tga
            Texture            = kbfortressb.tga kbfortressb_snow.tga
            Texture            = kbtemple.tga kbtemple_snow.tga
        End

        ModelConditionState = USER_8
            Model            = kbchapele
            Texture            = kbhall.tga kbhall_snow.tga
            Texture            = kbfortressb.tga kbfortressb_snow.tga
            Texture            = kbtemple.tga kbtemple_snow.tga
        End
    End








    Draw = W3DScriptedModelDraw ModuleTag_FX
        DefaultModelConditionState
            Model = None

        End
    End



    DisplayName            = OBJECT:BarrowWightLair
    Description            = OBJECT:AngmarBarrowWightLairDescription
    Side                   = Angmar
    IsTrainable            = Yes
    EditorSorting          = STRUCTURE
    ThreatLevel            = 1.0
    PlacementViewAngle     = -45
    BuildCost               = 500
    BuildTime               = 35
    BountyValue             = 80
    VisionRange             = 160
    ShroudClearingRange     = 180
    CommandSet             = AngmarGrabunholdLairCommandSet_AI

  ArmorSet
    Conditions        = None
    Armor             = FactoryArmor

  End



    VoiceSelect             = BarrowWightBuildingSelect
    VoiceFullyCreated       = EVA:GenericBuildingComplete-Builder

    SoundAmbient            = BarrowWightLairAmbienceMS
    SoundOnDamaged          = BuildingLightDamageStone
    SoundOnReallyDamaged    = BuildingHeavyDamageStone



    RadarPriority       = STRUCTURE
    KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE FS_FACTORY AUTO_RALLYPOINT MP_COUNT_FOR_VICTORY NEED_BASE_FOUNDATION ATTACK_NEEDS_LINE_OF_SIGHT CAN_ATTACK MADE_OF_STONE LIVING_WORLD_BUILDING_MIRROR GARRISONABLE_UNTIL_DESTROYED GARRISON

  Behavior            = GettingBuiltBehavior ModuleTag_04
    WorkerName        = AngmarWorkerNoSelect
    SpawnTimer        = DEFAULT_STRUCTURE_HEALDELAY
  End


    Body                       = StructureBody ModuleTag_05
        MaxHealth              = 1800
        MaxHealthDamaged       = 1000
        MaxHealthReallyDamaged = 400
    End


    Behavior = AIUpdateInterface ModuleTag_SoWeCanUseWeapon
        AutoAcquireEnemiesWhenIdle = Yes
        MoodAttackCheckRate        = 250
        AILuaEventsList            = AngmarStructuresFunctions
    End


    Behavior = GrantUpgradeCreate ModuleTag_EnableHK
        UpgradeToGrant      = Upgrade_AngmarStructureWightlairBuild
        GiveOnBuildComplete = Yes
    End


    Behavior = TunnelContain ModuleTag_Contain
        ObjectStatusOfContained         = UNSELECTABLE ENCLOSED
        ContainMax                      = 5
        DamagePercentToUnits            = 0%
        PassengerFilter                 = NONE +BarrowWight_Summoned +BarrowWight +AngmarKarsh_mod_SummonedLvl1 +AngmarKarshSB_SummonedLvl1 +AngmarKarsh_mod_SummonedLvl3 +AngmarKarshSB_SummonedLvl3 +AngmarKarsh_mod_SummonedLvl5 +AngmarKarshSB_SummonedLvl5 +AngmarKarsh_mod_SummonedLvl7 +AngmarKarshSB_SummonedLvl7 +AngmarKarsh_mod_SummonedLvl10 +AngmarKarshSB_SummonedLvl10 +AngmarGrabunholdLvl2 +AngmarGrabunholdLvl3 +AngmarGrabunholdLvl4 +AngmarGrabunholdLvl5 +AngmarGrabunhold
        AllowEnemiesInside              = No
        AllowAlliesInside               = No
        AllowNeutralInside              = No
        AllowOwnPlayerInsideOverride    = Yes
        NumberOfExitPaths               = 1
        PassengerBonePrefix             = PassengerBone:ARROW_ KindOf:INFANTRY
        EntryPosition                   = X:0.0 Y:0.0 Z:0.0
        EntryOffset                     = X:0.0 Y:0.0 Z:0.0
        ExitOffset                      = X:0.0 Y:0.0 Z:0.0
        EnterSound                      = RuinedTowerEnterSound
        KillPassengersOnDeath           = No
        ShowPips                        = No
        ExitDelay                       = 0
    End


    Behavior = QueueProductionExitUpdate ModuleTag_11
        UnitCreatePoint      = X:0.0 Y:0.0 Z:0.0
        NaturalRallyPoint    = X:70.0 Y:0.0 Z:0.0
        ExitDelay            = 250
    End


    Behavior = SubObjectsUpgrade ModuleTag_HideAll
        TriggeredBy        = Upgrade_StructureLevel1
        ShowSubObjects    = PMBONES01
        HideSubObjects    = V2 V3 V4 V5 FIREAROWTIP FIREAROWTIP01 FIREAROWTIP03 FIREAROWTIP04 FIREAROWTIP05 FIREAROWTIP06
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowWalls
        TriggeredBy        = Upgrade_BarrowWightLairLevel2
        ShowSubObjects    = V2
        HideSubObjects    = V3 V4 V5
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowFlagsAndTower
        TriggeredBy        = Upgrade_BarrowWightLairLevel3
        ShowSubObjects    = V2 V3
        HideSubObjects    = V4 V5
    End

      Behavior = SubObjectsUpgrade ModuleTag_Pyres
        TriggeredBy        = Upgrade_BarrowWightLairLevel4
        ShowSubObjects    = V2 V3 V4
        HideSubObjects    = V5
    End

    Behavior = SubObjectsUpgrade ModuleTag_ShowEverything
        TriggeredBy        = Upgrade_BarrowWightLairLevel5
        ShowSubObjects    = V2 V3 V4 V5 FIREAROWTIP FIREAROWTIP01 FIREAROWTIP03 FIREAROWTIP04 FIREAROWTIP05 FIREAROWTIP06
    End

    Behavior = LevelUpUpgrade ModuleTag_SchurfmineLevel2
        TriggeredBy       = Upgrade_BarrowWightLairLevel2
        LevelsToGain      = 1
        LevelCap          = 2
    End

    Behavior = LevelUpUpgrade ModuleTag_SchurfmineLevel3
        TriggeredBy       = Upgrade_BarrowWightLairLevel3
        LevelsToGain      = 1
        LevelCap          = 3
    End

    Behavior = LevelUpUpgrade ModuleTag_SchurfmineLevel4
        TriggeredBy       = Upgrade_BarrowWightLairLevel4
        LevelsToGain      = 1
        LevelCap          = 4
    End

    Behavior = LevelUpUpgrade ModuleTag_SchurfmineLevel5
        TriggeredBy       = Upgrade_BarrowWightLairLevel5
        LevelsToGain      = 1
        LevelCap          = 5
    End

    Behavior = CommandSetUpgrade ModueTag_Level2CommandSet
        TriggeredBy    = Upgrade_BarrowWightLairLevel2
        ConflictsWith  = Upgrade_BarrowWightLairLevel3
        CommandSet     = AngmarGrabunholdLairCommandSet2_AI
    End

    Behavior = CommandSetUpgrade ModueTag_Level3CommandSet
        TriggeredBy    = Upgrade_BarrowWightLairLevel3
        ConflictsWith  = Upgrade_BarrowWightLairLevel4
        CommandSet     = AngmarGrabunholdLairCommandSet3_AI
    End

    Behavior = CommandSetUpgrade ModueTag_Level4CommandSet
        TriggeredBy    = Upgrade_BarrowWightLairLevel4
        ConflictsWith  = Upgrade_BarrowWightLairLevel5
        CommandSet     = AngmarGrabunholdLairCommandSet4_AI
    End

    Behavior = CommandSetUpgrade ModueTag_Level5CommandSet
        TriggeredBy    = Upgrade_BarrowWightLairLevel5
        CommandSet     = AngmarGrabunholdLairCommandSet5_AI
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI1
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 280000
        GrantUpgrade = Upgrade_BarrowWightLairLevel2
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI2
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 350000
        GrantUpgrade = Upgrade_BarrowWightLairLevel3
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI3
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 480000
        GrantUpgrade = Upgrade_BarrowWightLairLevel4
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI4
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 650000
        GrantUpgrade = Upgrade_BarrowWightLairLevel5
    End

    Behavior = AttributeModifierAuraUpdate ModuleTag_DreadVisage
        StartsActive      = Yes
        BonusName         = GenericDebuff
        RefreshDelay      = 2000
        Range             = DWARVEN_STATUE_AOE_RADIUS
        TargetEnemy       = Yes
        AntiCategory      = LEADERSHIP STRUCTURE
        ObjectFilter      = GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
    End

    Behavior = RadiateFearUpdate ModuleTag_DreadVisageFear
        InitiallyActive         = Yes
        WhichSpecialPower       = 1
        GenerateTerror          = No
        GenerateFear            = Yes
        EmotionPulseRadius      = DWARVEN_STATUE_AOE_RADIUS
        EmotionPulseInterval    = 1000
    End

    Behavior = StructureCollapseUpdate ModuleTag_Collapse
        MinCollapseDelay        = 000
        MaxCollapseDelay        = 000
        CollapseDamping         = .5
        MaxShudder              = 0.6
        MinBurstDelay           = 250
        MaxBurstDelay           = 800
        BigBurstFrequency       = 4
        FXList                  = INITIAL   FX_StructureMediumCollapse
        FXList                  = ALMOST_FINAL  FX_StructureAlmostCollapse
        DestroyObjectWhenDone    = Yes
        CollapseHeight            = 120
    End


    Behavior = ProductionUpdate ProductionUpdateModuleTag
         GiveNoXP                    = Yes
        NumDoorAnimations            = 0
    End


    Behavior = FireWeaponUpdate FireWeaponUpdateModuleTag
        FireWeaponNugget
            WeaponName = AngmarStructureRingWeapon
            FireDelay = 0
            OneShot = No
        End
    End

    Geometry                = CYLINDER
      GeometryMajorRadius        = 40.0
    GeometryMinorRadius        = 40.0
    GeometryHeight            = 42.0
    GeometryOffset            = X:0.6 Y:12.0 Z:0

    GeometryIsSmall        = No
    Shadow                = SHADOW_VOLUME
    BuildCompletion        = PLACED_BY_PLAYER
End

