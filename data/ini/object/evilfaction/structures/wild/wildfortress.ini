Object WildFortressCenterGeneric

    SelectPortrait = BPWFortress

    Draw = W3DScriptedModelDraw ModuleTag_01

        DefaultModelConditionState
              Model = None
        End

        ModelConditionState = WORLD_BUILDER
            Model = NBasePin
        End
    End

    Side            = Wild
    EditorSorting    = STRUCTURE
    KindOf            = IMMOBILE BASE_FOUNDATION CASTLE_CENTER

    Behavior = CastleBehavior ModuleTag_castle
        FilterValidOwnedEntries = ANY +STRUCTURE +WALK_ON_TOP_OF_WALL +BASE_FOUNDATION +TACTICAL_MARKER
    End
End


Object WildFortressExpansionPadCorner

    SelectPortrait = BPWFortress_BuildPlot

    Draw = W3DFloorDraw DrawFloorBase
        ModelName = WBFoundation
    End


    Draw = W3DScriptedModelDraw ModuleTag_DrawMain
        DefaultModelConditionState
            Model = WBFoundationP
        End

        ModelConditionState = CONSTRUCTION_COMPLETE
            Model = None
        End
    End


    DisplayName         = OBJECT:WildBuildingFoundation
    Side                = Wild
    EditorSorting       = STRUCTURE
    ThreatLevel         = 1.0

    BuildCost           = 1
    BuildTime           = 5.0
    VisionRange         = 0.0
    ShroudClearingRange = 0

    CommandSet = WildFortressExpansionPadCornerCommandSet

    VoiceSelect = Gui_PlotSelect2


    KindOf              = STRUCTURE SELECTABLE IMMOBILE BASE_FOUNDATION UNATTACKABLE MP_COUNT_FOR_VICTORY NO_COLLIDE DO_NOT_CLASSIFY EXPANSION_PAD

    Behavior        = FoundationAIUpdate ModuleTag_foundationAI
        BuildVariation    = 2
    End

    Behavior = CastleMemberBehavior ModuleTag_CMB
    End

    Body                = ImmortalBody ModuleTag_05
        MaxHealth         = DEFAULT_FORTRESS_HEALTH
    End

    Geometry                = BOX
    GeometryMajorRadius        = 5.0
    GeometryMinorRadius        = 5.0
    GeometryHeight            = 0.8
    GeometryIsSmall            = No
    Shadow                    = SHADOW_VOLUME
    BuildCompletion            = PLACED_BY_PLAYER
End




ChildObject WildFortressExpansionPadSide WildFortressExpansionPadCorner

    CommandSet = WildFortressExpansionPadSideCommandSet

    Behavior            = FoundationAIUpdate ModuleTag_foundationAI
        BuildVariation = 1
    End
End




Object WildFortressCitadel

Draw = W3DFloorDraw ModuleTag_DrawFortressFloor
    ModelName				= FL_MMOUNTAINS
    StartHidden 				= No
    HideIfModelConditions		= AWAITING_CONSTRUCTION
    HideIfModelConditions		= PARTIALLY_CONSTRUCTED
    ForceToBack 				= Yes
    FloorFadeRateOnObjectDeath  = -0.01
End

    SelectPortrait    = BPWFortress
    ButtonImage        = BWFortress

    Draw = W3DScriptedModelDraw ModuleTag_Draw
        ExtraPublicBone         = ARROW_01
        ExtraPublicBone         = ARROW_02
        ExtraPublicBone         = ARROW_03
        ExtraPublicBone         = ARROW_04
        ExtraPublicBone         = ARROW_05
        ExtraPublicBone         = ARROW_06
        ExtraPublicBone         = ARROW_07
        ExtraPublicBone         = ARROW_08
        ExtraPublicBone         = ARROW_09
        ExtraPublicBone         = ARROW_10
        ExtraPublicBone         = ARROW_11
        ExtraPublicBone         = ARROW_12
        ExtraPublicBone         = ARROW_13
        ExtraPublicBone         = ARROW_14
        ExtraPublicBone         = ARROW_15
        ExtraPublicBone         = ARROW_16
        ExtraPublicBone         = ARROW_17
        ExtraPublicBone         = ARROW_18
        ExtraPublicBone         = ARROW_19
        ExtraPublicBone         = ARROW_20
        ExtraPublicBone         = ARROW_21
        ExtraPublicBone         = ARROW_22
        ExtraPublicBone         = ARROW_23
        ExtraPublicBone         = ARROW_24
        ExtraPublicBone         = ARROW_25
        ExtraPublicBone         = ARROW_26
        ExtraPublicBone         = ARROW_27
        ExtraPublicBone         = ARROW_28
        ExtraPublicBone         = ARROW_29
        ExtraPublicBone         = ARROW_30
        ExtraPublicBone         = ARROW_31
        ExtraPublicBone         = ARROW_32
        OkToChangeModelColor    = Yes
        UseStandardModelNames    = Yes
        StaticModelLODMode        = Yes

        DefaultModelConditionState
            Model                = WBFortress
            WeaponLaunchBone    = PRIMARY ARROW_
        End


        ModelConditionState  = DAMAGED
            Model        = WBFortress
            Texture        = WBFortress.tga WBFortress_D.tga
        End

        AnimationState = DAMAGED
            EnteringStateFX    = FX_FortressDamaged
        End

        ModelConditionState  = REALLYDAMAGED
            Model            = WBFortress_D2
        End

        AnimationState    = REALLYDAMAGED
            Animation    = Fortress_ReallyDamaged
                AnimationName        = WBFortress_D2S.WBFortress_D2A
                AnimationMode        = ONCE
            End
            EnteringStateFX    = FX_FortressReallyDamaged
        End

        ModelConditionState  = RUBBLE
            Model            = WBFortress_D3
        End

        AnimationState    = RUBBLE
            Animation    = Fortress_ReallyDamaged
                AnimationName        = WBFortress_D3S.WBFortress_D3A
                AnimationMode        = ONCE
            End
            EnteringStateFX    = FX_StructureMediumCollapse
        End

        ModelConditionState  = POST_RUBBLE
            Model         = None
            ParticleSysBone NONE SmokeBuildingMediumRubble
        End

        AnimationState = POST_RUBBLE
        End

        ModelConditionState  = POST_COLLAPSE
            Model         = None
            ParticleSysBone NONE SmokeBuildingMediumRubble
        End

        AnimationState = POST_COLLAPSE
        End

        ModelConditionState = UPGRADE_NUMENOR_STONEWORK
            Model    = WBFortress
            Texture    = WBFortress.tga WBFortress_U.tga
            Texture    = WBFortress_nrm.tga WBFortress_update_nrm.tga
        End

        ModelConditionState = SNOW
            Model            = WBFortress
            Texture            = WBFortress.tga WBFortress_snow.tga
        End
    End



    Draw = W3DScriptedModelDraw ModuleTag_IvoryTowerDraw
        OkToChangeModelColor    = Yes
        StaticModelLODMode        = Yes

        DefaultModelConditionState
            Model           = None
        End


        ModelConditionState = UPGRADE_FORTRESS_MONUMENT USER_1 DAMAGED
            Model        = WBFGThrone_A
            Texture        = WBFortress.tga WBFortress_D.tga
        End

        ModelConditionState = UPGRADE_FORTRESS_MONUMENT USER_1 REALLYDAMAGED
            Model        = WBFGThrone_A
            Texture        = WBFortress.tga WBFortress_D.tga
        End

        ModelConditionState = UPGRADE_FORTRESS_MONUMENT USER_1 SNOW
            Model           = WBFGThrone_A
            Texture            = WBFortress.tga WBFortress_snow.tga
        End

        ModelConditionState = UPGRADE_FORTRESS_MONUMENT USER_1
            Model           = WBFGThrone_A
        End

        AnimationState = UPGRADE_FORTRESS_MONUMENT USER_1
            Animation                        = RiseUp
                AnimationName                = WBFGThrone_ASK.WBFGThrone_ABL
                AnimationMode                = ONCE
                AnimationSpeedFactorRange    = 12.0 12.0
            End
            ParticleSysBone     = NONE BuildingContructDustCastles
        End


        ModelConditionState  = UPGRADE_FORTRESS_MONUMENT DAMAGED
            Model        = WBFGThrone
            Texture        = WBFortress.tga WBFortress_D.tga
        End

        ModelConditionState  = UPGRADE_FORTRESS_MONUMENT REALLYDAMAGED
            Model            = WBFGThrone_D2
        End

        AnimationState    = UPGRADE_FORTRESS_MONUMENT REALLYDAMAGED
            Animation    = DrakeNest_ReallyDamaged
                AnimationName        = WBFGThrone_D2S.WBFGThrone_D2A
                AnimationMode        = ONCE
            End
            EnteringStateFX    = FX_BuildingReallyDamaged
        End

        ModelConditionState  = UPGRADE_FORTRESS_MONUMENT RUBBLE
            Model            = WBFGThrone_D3
        End

        AnimationState    = UPGRADE_FORTRESS_MONUMENT RUBBLE
            Animation    = DrakeNest_ReallyDamaged
                AnimationName        = WBFGThrone_D3S.WBFGThrone_D3A
                AnimationMode        = ONCE
            End
        End


        ModelConditionState = SNOW UPGRADE_FORTRESS_MONUMENT
            Model            = WBFGThrone
            Texture            = WBFortress.tga WBFortress_snow.tga
        End

        ModelConditionState = UPGRADE_FORTRESS_MONUMENT
            Model    = WBFGThrone
            ParticleSysBone FXMouth WildNestFire FollowBone:Yes
            ParticleSysBone FXEye01 WildNestEye FollowBone:Yes
            ParticleSysBone FXEye02 WildNestEye FollowBone:Yes
            ParticleSysBone B_DRAKE WildFortGlow FollowBone:Yes
            ParticleSysBone B_DRAKE WildFortEmbers FollowBone:Yes
        End
    End


    Draw = W3DScriptedModelDraw ModuleTag_DrawDrake

        AttachToBoneInAnotherModule = B_Drake
        StaticModelLODMode            = Yes

        DefaultModelConditionState
            Model           = None
        End

        ModelConditionState = USER_1
            Model            = None
        End

        ModelConditionState = UPGRADE_FORTRESS_MONUMENT
            Model        = None
        End

        IdleAnimationState
            StateName        = NoDrake
        End

        AnimationState = UPGRADE_FORTRESS_MONUMENT FORTRESS_MONUMENT_CREATURE_AVAILABLE
            Animation                    = HanginOut
                AnimationName            = WUFireDrk_SKL.WUFireDrk_FILDA
                AnimationMode            = LOOP
                AnimationBlendTime        = 0
            End
            BeginScript
                Prev = CurDrawablePrevAnimationState()
                if Prev ~= "HanginOut" and Prev ~= "TRANS_DrakeComeOut" then CurDrawableSetTransitionAnimState("TRANS_DrakeComeOut") end
            EndScript
        End

        TransitionState                        = TRANS_DrakeComeOut
            Animation                        = ComeOut
                AnimationName                = WUFireDrk_SKL.WUFireDrk_FBLDA
                AnimationMode                = ONCE
                AnimationSpeedFactorRange    = 0.5 0.5
                AnimationBlendTime            = 0
            End
        End

        AnimationState = UPGRADE_FORTRESS_MONUMENT FORTRESS_MONUMENT_CREATURE_UNAVAILABLE
            StateName                        = BackInside
            Animation                        = BackInside
                AnimationName                = WUFireDrk_SKL.WUFireDrk_FBLDA
                AnimationMode                = ONCE_BACKWARDS
                AnimationSpeedFactorRange    = 0.5 0.5
            End
        End
    End


    Draw = W3DScriptedModelDraw ModuleTag_DrawBatCloud

        StaticModelLODMode        = Yes

        DefaultModelConditionState
            Model           = None
        End

        ModelConditionState = FORTRESS_IMPROVEMENT_1
            Model        = Bats_SKN
        End

        AnimationState    = FORTRESS_IMPROVEMENT_1
            Animation    = WBFBCloud
                AnimationName    = Bats_SKL.Bats_IDLB
                AnimationMode    = LOOP
            End
            Flags                = START_FRAME_FIRST
        End
    End


    Draw = W3DScriptedModelDraw ModuleTag_DrawFireArrows
        OkToChangeModelColor    = Yes
        StaticModelLODMode        = Yes

        DefaultModelConditionState
            Model    = None
        End

        ModelConditionState    = FORTRESS_IMPROVEMENT_2
            Model = WBFFire
            ParticleSysBone     = Smoke01 SmokeDwfFort FollowBone:Yes
            ParticleSysBone     = Smoke02 SmokeDwfFort FollowBone:Yes
            ParticleSysBone     = Smoke03 SmokeDwfFort FollowBone:Yes
            ParticleSysBone     = Smoke04 SmokeDwfFort FollowBone:Yes
        End
    End


    Draw = W3DScriptedModelDraw ModuleTag_DrawSpines
        OkToChangeModelColor    = Yes
        StaticModelLODMode        = Yes

        DefaultModelConditionState
            Model    = None
        End

        IdleAnimationState
            StateName        = NoSpines
        End


        ModelConditionState = FORTRESS_IMPROVEMENT_4 USER_2 DAMAGED
            Model           = WBFRSpin_A
            Texture            = WBFortress.tga WBFortress_D.tga
        End

        ModelConditionState = FORTRESS_IMPROVEMENT_4 USER_2 REALLYDAMAGED
            Model           = WBFRSpin_A
            Texture            = WBFortress.tga WBFortress_D.tga
        End

        ModelConditionState = FORTRESS_IMPROVEMENT_4 USER_2
            Model           = WBFRSpin_A
        End

        AnimationState = FORTRESS_IMPROVEMENT_4 USER_2
            Animation                    = RiseUp
                AnimationName            = WBFRSpin_ASKL.WBFRSpin_ABLD
                AnimationMode            = ONCE
                AnimationSpeedFactorRange = 10.0 10.0
            End
        End


        ModelConditionState  = FORTRESS_IMPROVEMENT_4 DAMAGED
            Model        = WBFRSpin
            Texture        = WBFortress.tga WBFortress_D.tga
        End

        ModelConditionState  = FORTRESS_IMPROVEMENT_4 REALLYDAMAGED
            Model            = WBFRSpin_D2
            ParticleSysBone     = NONE WildSpikesTwinkle FollowBone:Yes
        End

        AnimationState    = FORTRESS_IMPROVEMENT_4 REALLYDAMAGED
            Animation    = Spines_ReallyDamaged
                AnimationName        = WBFRSpin_D2SKL.WBFRSpin_D2AN
                AnimationMode        = ONCE
            End
            EnteringStateFX    = FX_BuildingReallyDamaged
        End

        ModelConditionState  = FORTRESS_IMPROVEMENT_4 RUBBLE
            Model            = WBFRSpin_D3
            ParticleSysBone     = NONE WildSpikesTwinkle FollowBone:Yes
        End

        AnimationState    = FORTRESS_IMPROVEMENT_4 RUBBLE
            Animation    = Spines_ReallyDamaged
                AnimationName        = WBFRSpin_D3SKL.WBFRSpin_D3AN
                AnimationMode        = ONCE
            End
        End


        ModelConditionState = FORTRESS_IMPROVEMENT_4
            Model    = WBFRSpin
        End
        AnimationState = FORTRESS_IMPROVEMENT_4
            ParticleSysBone     = NONE WildSpikesTwinkle FollowBone:Yes
        End
    End


    Draw = W3DScriptedModelDraw ModuleTag_DrawDoor

        DefaultModelConditionState
            Model = WBFDoor
        End


        ModelConditionState   = DAMAGED DOOR_1_WAITING_OPEN
            Model        = WBFDoor_DRO
            Texture        = WBFortress.tga WBFortress_D.tga
        End

        ModelConditionState   = REALLYDAMAGED DOOR_1_WAITING_OPEN
            Model        = WBFDoor_DRO
            Texture        = WBFortress.tga WBFortress_D.tga
        End

        ModelConditionState = DAMAGED
            Model        = WBFDoor
            Texture        = WBFortress.tga WBFortress_D.tga
        End

        ModelConditionState = REALLYDAMAGED
            Model        = WBFDoor
            Texture        = WBFortress.tga WBFortress_D.tga
        End

        ModelConditionState = RUBBLE
            Model        = WBFDoor_D3
        End

        AnimationState    = RUBBLE
            Animation    = Door_ReallyDamaged
                AnimationName        = WBFDoor_D3.WBFDoor_D3
                AnimationMode        = ONCE
                AnimationBlendTime    = 50
            End
        End


        AnimationState            =    DOOR_1_OPENING
            Animation           =    WBFDoor_AO
                AnimationName   =    WBFDoorSKL.WBFDoor_AO
                AnimationMode   =    ONCE
                AnimationBlendTime = 0
            End

        End

           AnimationState            =    DOOR_1_CLOSING
            Animation           =    WBFDoor_AC
                AnimationName   =    WBFDoorSKL.WBFDoor_AC
                AnimationMode   =    ONCE
                AnimationBlendTime = 0
            End

        End

        ModelConditionState   = DOOR_1_WAITING_OPEN
            Model                = WBFDoor_DRO

        End


        AnimationState            =    DOOR_1_WAITING_OPEN
        End

        ModelConditionState  = POST_RUBBLE
            Model         = None
        End

        ModelConditionState  = POST_COLLAPSE
            Model         = None
        End
    End

    Draw = W3DFloorDraw ModuleTag_DrawFloor
        ModelName            = WBFortress_Bib
        WeatherTexture        = SNOWY WBFortress_Bib_Snow.tga
    End


      DisplayName             = OBJECT:WildFortress
      Description             = OBJECT:WildFortressDescription

      Side                    = Wild
      EditorSorting           = STRUCTURE
      ThreatLevel             = 1.0
      CommandPointBonus       = MAIN_FORTRESS_COMMAND_POINT

      CommandSet              = WildFortressCommandSet
      BuildCost               = WILD_FORTRESS_BUILDCOST
      BuildTime               = DEFAULT_FORTRESS_BUILDTIME
      BountyValue             = WILD_FORTRESS_BOUNTY_VALUE
      VisionRange             = DEFAULT_FORTRESS_VISION_RANGE
      ShroudClearingRange     = DEFAULT_FORTRESS_SHROUD_CLEAR
      MaxSimultaneousOfType   = NEW_FORTRESS_RATIO

    WeaponSet
        Weapon                = PRIMARY EvilNebelbergeFortressArrowTowerBow
        AutoChooseSources     = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End

    ArmorSet
        Conditions        = None
        Armor             = DefaultFortressArmor
    End

    ArmorSet
        Conditions = PLAYER_UPGRADE
        Armor      = DefaultFortressArmorUpgraded
    End



    #include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

    EvaEventDieOwner                   = EvaFortressDie

    VoiceSelect                        = WildFortressSelect
    VoiceSelectUnderConstruction       = BuildingEvilVoiceSelectUnderConstruction

    SoundOnDamaged                     = BuildingLightDamageStone
    SoundOnReallyDamaged               = BuildingHeavyDamageStone

    UnitSpecificSounds
        UnderConstruction              = BuildingBigConstructionLoop
        UnderRepairFromRubble          = BuildingBigConstructionLoop
    End

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound:UpgradeMordorFortressGorgonothSpire    Animation:WBFGThrone_ASK.WBFGThrone_ABL        Frames:3950
    End

    CampnessValue = CAMPNESS_FORTRESS


    RadarPriority       = STRUCTURE
    KindOf                = PRELOAD COMMANDCENTER VITAL_FOR_BASE_SURVIVAL STRUCTURE IMMOBILE CASTLE_KEEP MP_COUNT_FOR_VICTORY SELECTABLE FS_FACTORY AUTO_RALLYPOINT MADE_OF_WOOD SCORE DOZER_FACTORY

    Behavior            = GettingBuiltBehavior GetBuiltBehaviorTag
        WorkerName          = WildWorkerNoSelect
        SpawnTimer    = DEFAULT_STRUCTURE_HEALDELAY
    End

    Behavior = CastleMemberBehavior ModuleTag_CMB
    End

    Body                        = StructureBody ModuleTag_05
        MaxHealth                     = DEFAULT_FORTRESS_HEALTH
        MaxHealthDamaged              = DEFAULT_FORTRESS_HEALTH_DAMAGED
        MaxHealthReallyDamaged           = DEFAULT_FORTRESS_HEALTH_REALLY_DAMAGED

    End

    Behavior                  = BuildingBehavior BuildingModuleTag
    End

    Behavior                  = StructureCollapseUpdate ModuleTag_06
        MinCollapseDelay        = 000
        MaxCollapseDelay        = 000
        CollapseDamping         = .5
        MaxShudder              = 0.6
        MinBurstDelay           = 250
        MaxBurstDelay           = 800
        BigBurstFrequency       = 4
        FXList                  = INITIAL   FX_FortressCollapse
        DestroyObjectWhenDone   = Yes
        CollapseHeight          = 120
    End

	#include "..\..\..\..\includes\FortressAIHeroRespawnUpgrade_SEE.inc"

    Behavior = QueueProductionExitUpdate QueueProductionModuleTag
        UnitCreatePoint        = X:14.8616 Y:-0.1480 Z:0.0
        NaturalRallyPoint    = X:80.0 Y:-0.1480 Z:0.0
        ExitDelay            = STANDARD_HERO_EXIT_DELAY
    End

    Behavior = ModelConditionUpgrade ModuleTag_ShowTheTower
        TriggeredBy                = Upgrade_WildFortressDragonNest
        RequiresAllTriggers        = Yes
        AddConditionFlags        = UPGRADE_FORTRESS_MONUMENT
        AddTempConditionFlag    = ModelConditionState:USER_1
        TempConditionTime        = 12.0
        Permanent                = Yes
    End

    Behavior = GeometryUpgrade TowerGeom
        TriggeredBy            = Upgrade_WildFortressDragonNest
        ShowGeometry        = HighTowerGeom
    End

    Behavior = ModelConditionUpgrade ModuleTag_AnimateNestDrake
        TriggeredBy                = Upgrade_DragonNestFireDrakeButtonEnable
        AddConditionFlags        = FORTRESS_MONUMENT_CREATURE_AVAILABLE
        RemoveConditionFlags    = FORTRESS_MONUMENT_CREATURE_UNAVAILABLE
        Permanent                = Yes
    End

    Behavior = ModelConditionUpgrade ModuleTag_HideNestDrake
        TriggeredBy                = Upgrade_HasDragonNestFireDrake
        AddConditionFlags        = FORTRESS_MONUMENT_CREATURE_UNAVAILABLE
        RemoveConditionFlags    = FORTRESS_MONUMENT_CREATURE_AVAILABLE
        Permanent                = Yes
    End


    Behavior = GrantUpgradeCreate ModuleTag_ActLikeAnOldUpgrade
        UpgradeToGrant        = Upgrade_DragonNestFireDrakeButtonEnable
        GiveOnBuildComplete = Yes
    End

    Behavior = AudioLoopUpgrade ModuleTag_DragonNestBuildLoop

        TriggeredBy            = Upgrade_WildFortressDragonNest

        SoundToPlay            = BuildingBigConstructionLoop
        KillOnDeath         = Yes
        KillAfterMS            = 10000

    End

    Behavior = ObjectCreationUpgrade MaketheDrake
        TriggeredBy                = Upgrade_HasDragonNestFireDrake
        Delay                    = 0.0

        RemoveUpgrade            = Upgrade_DragonNestFireDrakeButtonEnable
        ThingToSpawn            = WildFortressFireDrake
        UseBuildingProduction    = Yes
    End
    Behavior = SlaveWatcherBehavior WatchTheDrake
        RemoveUpgrade        =    Upgrade_HasDragonNestFireDrake
        GrantUpgrade        =    Upgrade_DragonNestFireDrakeButtonEnable
        LetSlaveLive        = Yes
    End


    Behavior = CostModifierUpgrade ModuleTag_CostModifierDrogoth
        LabelForPalantirString    = GUI:HERO_DISCOUNT
        TriggeredBy               = Upgrade_WildFortressDragonNest
        ObjectFilter              = NONE +Drogoth
        Percentage                = -0%
        Percentage                = -10%
        Percentage                = -20%
    End


    Behavior      = SpawnUnitBehavior ModuleTag_allowMeToBuildDrakeFromCitadel
        UnitName        = WildFortressFireDrake
     End


    Behavior = ModelConditionUpgrade ModuleTag_ShowTheBatCloud
        TriggeredBy                = Upgrade_WildFortressBatCloud
        RequiresAllTriggers        = Yes
        AddConditionFlags        = FORTRESS_IMPROVEMENT_1
        Permanent                = Yes
    End

    Behavior = AttributeModifierUpgrade ModuleTag_BatCloudBonus
        AttributeModifier    = WildFortressBatCloudBonus
        TriggeredBy            = Upgrade_WildFortressBatCloud
    End

    Behavior = StealthDetectorUpdate StealthDetectorUpdateModuleTag
        DetectionRange        = 800
        DetectionRate        = 500
        CancelOneRingEffect = Yes
        RequiredUpgrade        = Upgrade_WildFortressBatCloud
    End

    Behavior = CastleUpgrade ModuleTag_PassOutFlamingMunitionsUpgrade
        TriggeredBy    = Upgrade_WildFortressFireArrowsTrigger
        Upgrade        = Upgrade_EvilFortressFlamingMunitions
    End

    Behavior = StatusBitsUpgrade ModuleTag_FakeOut
        TriggeredBy    = Upgrade_EvilFortressFlamingMunitions
    End

    Behavior = ModelConditionUpgrade ModuleTag_ShowMunitions
        TriggeredBy                = Upgrade_EvilFortressFlamingMunitions
        AddConditionFlags        = FORTRESS_IMPROVEMENT_2
        Permanent                = Yes
    End

    Behavior = CastleUpgrade ModuleTag_PassOutWebCocoonUpgrade
        TriggeredBy    = Upgrade_WildFortressWebCocoonTrigger
        Upgrade        = Upgrade_WildFortressWebCocoon
    End

    Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
        TriggeredBy                = Upgrade_WildFortressWebCocoon
        AttributeModifier          = WebCocoonKeep_Bonus
    End

    Behavior = ArmorUpgrade ModuleTag_ArmorUpgrade
        TriggeredBy                = Upgrade_WildFortressWebCocoon
    End

    Behavior = ModelConditionUpgrade ModuleTag_ShowWebCocoon
        TriggeredBy                = Upgrade_WildFortressWebCocoon
        AddConditionFlags          = UPGRADE_NUMENOR_STONEWORK
        Permanent                  = Yes
    End

    Behavior = CitadelSlaughterHordeContain ModuleTag_SlaughterMe
	PassengerFilter			= GENERIC_FACTION_SLAUGHTERABLE
	ObjectStatusOfContained		= UNSELECTABLE ENCLOSED
	CashBackPercent			= 200%
	ContainMax			= 99
	AllowEnemiesInside		= No
	AllowAlliesInside		= No
 	AllowNeutralInside		= No
 	AllowOwnPlayerInsideOverride	= Yes
	EnterSound			= GUI_RingReturned
	EntryOffset			= X:125.0 Y:0.0 Z:0.0
	EntryPosition			= X:30.0 Y:0.0 Z:0.0
	ExitOffset			= X:125.0 Y:0.0 Z:0.0
     End

	#include "..\..\..\FortressRingFunc.inc"




    Behavior = ModelConditionUpgrade ModuleTag_ShowRazorSpines
        TriggeredBy                = Upgrade_WildFortressRazorSpines
        AddConditionFlags        = FORTRESS_IMPROVEMENT_4
        AddTempConditionFlag    = ModelConditionState:USER_2
        TempConditionTime        = 5.0
        Permanent                = Yes
    End

    Behavior = DamageFieldUpdate ModuleTag_RazorSpinesWeapon
        Radius            = 100
	ObjectFilter      = ALL -IsengardExplosiveMine -IsengardExplosiveMine_Summoned -IsengardDeployedExplosiveMine -IsengardExplosivePileOfLeaves -IsengardDeployedExplosiveMineSpellbook ENEMIES
        RequiredUpgrade   = Upgrade_WildFortressRazorSpines

        FireWeaponNugget
            WeaponName        = RazorSpinesBasicWeapon
            FireDelay        = 0
            OneShot            = No
        End
    End

    Behavior = AIUpdateInterface ModuleTag_AI
        AILuaEventsList                = FortressFunctions
        AutoAcquireEnemiesWhenIdle     = Yes
        MoodAttackCheckRate            = 250
    End


    Behavior = AutoDepositUpdate AutoDepositModuleTag
        DepositTiming           = GENERIC_KEEP_MONEY_TIME
        DepositAmount           = GENERIC_KEEP_MONEY_AMOUNT
        InitialCaptureBonus     = 0
    End

    Behavior = TerrainResourceBehavior ModuleTag_NewMoneyDeadSpot
        Radius            = GENERIC_KEEP_MONEY_RANGE
        MaxIncome         = 0
        IncomeInterval    = 999999
        HighPriority      = Yes
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSetKrone1
        TriggeredBy         = Upgrade_GreatGoblinCrown
        CommandSet          = WildFortressCommandSetKing
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSetKrone2
        TriggeredBy         = Upgrade_DurbutzCrown
        CommandSet          = WildFortressCommandSetKing
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSetKrone3
        TriggeredBy         = Upgrade_GorkilCrown
        CommandSet          = WildFortressCommandSetKing
    End

    Behavior = FireWeaponUpdate ModuleTag_WeaponFiring
        FireWeaponNugget
            WeaponName = BolgKingWeapon
            Offset = X:0 Y:0 Z:0
            FireDelay = 0
            OneShot = No
        End
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSet_AI
        TriggeredBy         = Upgrade_ObjectUnderAIControl
        CommandSet          = WildFortressCommandSet_AI
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSet_GreatGoblinAI
        TriggeredBy         = Upgrade_GreatGoblinCrown Upgrade_ObjectUnderAIControl
	RequiresAllTriggers = Yes
        CommandSet          = WildFortressCommandSet_AIGreatGoblin
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSet_DurburtzAI
        TriggeredBy         = Upgrade_DurbutzCrown Upgrade_ObjectUnderAIControl
	RequiresAllTriggers = Yes
        CommandSet          = WildFortressCommandSet_AIDurbutz
    End

    Behavior = CommandSetUpgrade ModuleTag_CommandSet_GorkilAI
        TriggeredBy         = Upgrade_GorkilCrown Upgrade_ObjectUnderAIControl
	RequiresAllTriggers = Yes
        CommandSet          = WildFortressCommandSet_AIGorkil
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI1
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 120000
        GrantUpgrade = Upgrade_WildFortressBatCloud
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI2
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 700000
        GrantUpgrade = Upgrade_WildFortressRazorSpines
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI3
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 1000000
        GrantUpgrade = Upgrade_WildFortressFireArrowsTrigger
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI4
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 1400000
        GrantUpgrade = Upgrade_WildFortressWebCocoonTrigger
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI5
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 1700000
        GrantUpgrade = Upgrade_WildFortressDragonNest
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI6A
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 450000
        GrantUpgrade = Upgrade_GorkilCrown
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI6B
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 520000
        GrantUpgrade = Upgrade_DurbutzCrown
    End

    Behavior = ObjectCreationUpgrade ModuleTag_IamAI6C
        TriggeredBy  = Upgrade_EasyAISinglePlayer Upgrade_EasyAIMultiPlayer Upgrade_MediumAISinglePlayer Upgrade_MediumAIMultiPlayer Upgrade_HardAISinglePlayer Upgrade_HardAIMultiPlayer Upgrade_BrutalAISinglePlayer Upgrade_BrutalAIMultiPlayer
        Delay        = 680000
        GrantUpgrade = Upgrade_GreatGoblinCrown
    End


    Geometry                  = BOX
    GeometryName              = Geom_Orig
    GeometryMajorRadius       = 50.0
    GeometryMinorRadius       = 48.0
    GeometryHeight            = 50.0
    GeometryOffset            = X:5 Y:0 Z:0


    AdditionalGeometry        = CYLINDER
    GeometryName              = Geom_V2
    GeometryMajorRadius       = 16.0
    GeometryHeight            = 58.0
    GeometryOffset            = X:43 Y:-46 Z:50

    AdditionalGeometry        = CYLINDER
    GeometryName              = Geom_V2
    GeometryMajorRadius       = 16.0
    GeometryHeight            = 58.0
    GeometryOffset            = X:-43 Y:46 Z:50

    AdditionalGeometry        = CYLINDER
    GeometryName              = Geom_V2
    GeometryMajorRadius       = 16.0
    GeometryMinorRadius       = 16.0
    GeometryHeight            = 58.0
    GeometryOffset            = X:43 Y:46 Z:50

    AdditionalGeometry        = CYLINDER
    GeometryName              = Geom_V2
    GeometryMajorRadius       = 16.0
    GeometryHeight            = 58.0
    GeometryOffset            = X:-43 Y:-46 Z:50

    AdditionalGeometry        = BOX
    GeometryName              = HighTowerGeom
    GeometryMajorRadius       = 12
    GeometryMinorRadius       = 12
    GeometryHeight            = 150
    GeometryOffset            = X:0 Y:0 Z:0
    GeometryUsedForHealthBox  = No

    GeometryIsSmall           = No
    Shadow                    = SHADOW_VOLUME
    BuildCompletion           = PLACED_BY_PLAYER

    GeometryContactPoint = X:-48.348       Y:26.9        Z:0          Repair
    GeometryContactPoint = X:47.546        Y:-38.677     Z:0          Repair
    GeometryContactPoint = X:47.546        Y:36.435      Z:0
    GeometryContactPoint = X:-32.763       Y:-46.121     Z:0
    GeometryContactPoint = X:0             Y:0           Z:180        Swoop
End



Object WildFortress

    SelectPortrait = BPWFortress

    Draw = W3DScriptedModelDraw ModuleTag_01

        OkToChangeModelColor    = Yes
        StaticModelLODMode        = Yes

        DefaultModelConditionState
            Model           = None
        End

        IdleAnimationState
        End


        ModelConditionState = WORLD_BUILDER
            Model    = WBFortress
        End


        ModelConditionState = BUILD_PLACEMENT_CURSOR
            Model    = None
        End


        ModelConditionState =  PHANTOM_STRUCTURE
            Model    = WBFortress
        End

        ModelConditionState  = RUBBLE
            Model            = WBFortress_D3
        End

        AnimationState    = RUBBLE
            Animation    = Fortress_ReallyDamaged
                AnimationName        = WBFortress_D3S.WBFortress_D3A
                AnimationMode        = ONCE
            End
            EnteringStateFX    = FX_StructureMediumCollapse
        End


        ModelConditionState = ACTIVELY_BEING_CONSTRUCTED SNOW
            Model            = WBFortress_A
            Texture            = WBFortress.tga WBFortress_snow.tga
        End

        ModelConditionState = ACTIVELY_BEING_CONSTRUCTED
            Model            = WBFortress_A
        End

        AnimationState = ACTIVELY_BEING_CONSTRUCTED
            Animation                    = UpAndStill
                AnimationName            = WBFortress_ASK.WBFortress_ABL
                AnimationMode            = MANUAL
            End
            ParticleSysBone = NONE BuildingContructDustCastlesB
            ParticleSysBone = NONE FortressWild
            StateName = BeingConstructed
            BeginScript
                CurDrawablePlaySound("GondorBarracksBeginConstruction")
            EndScript
        End
    End


    Draw = W3DScriptedModelDraw ModuleTag_DrawDoor
        DefaultModelConditionState
            Model = None
        End

        ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Model               = WBFDoor_A
        End

        AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
            Animation           = DBFDoor_DRA
                AnimationName     = WBFDoor_A.WBFDoor_A
                AnimationMode     = MANUAL
            End
            Flags                  = START_FRAME_FIRST
        End
    End

      ArmorSet
        Conditions        = None
          Armor             = DefaultFortressArmor

      End

    Side                = Wild
    EditorSorting       = STRUCTURE

    PlacementViewAngle = -45
    MaxSimultaneousOfType = NEW_FORTRESS_RATIO
    BuildCost           = WILD_FORTRESS_BUILDCOST
    BuildTime           = DEFAULT_FORTRESS_BUILDTIME

    DisplayName             = OBJECT:WildFortress



    AutoResolveUnitType = AutoResolveUnit_Fortress

        AutoResolveBody = AutoResolve_WildFortressBody

        AutoResolveArmor
            Armor = AutoResolve_WildFortressArmor
        End

        AutoResolveWeapon
            Weapon = AutoResolve_WildFortressWeapon
        End



    #include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

    VoiceFullyCreated                = EVA:FortressComplete-Builder
    VoiceSelect                        = WildFortressSelect
    VoiceSelectUnderConstruction    = BuildingEvilVoiceSelectUnderConstruction

    SoundOnDamaged                    = BuildingLightDamageStone
    SoundOnReallyDamaged            = BuildingHeavyDamageStone

    UnitSpecificSounds
        UnderConstruction            = BuildingBigConstructionLoop

        UnderRepairFromRubble        = BuildingBigConstructionLoop
    End

    ClientBehavior = ModelConditionAudioLoopClientBehavior ModuleTag_PlayCollapseSound
        ModelCondition = REQUIRED:RUBBLE Sound:BuildingSink
    End

    CampnessValue = CAMPNESS_FORTRESS


    RadarPriority       = STRUCTURE
    KindOf              = STRUCTURE SELECTABLE IMMOBILE BASE_FOUNDATION MP_COUNT_FOR_VICTORY BASE_SITE CAN_SEE_THROUGH_STRUCTURE LIVING_WORLD_BUILDING_MIRROR

    Body                        = StructureBody ModuleTag_05
        MaxHealth                     = DEFAULT_FORTRESS_HEALTH
    End

    Behavior = CastleBehavior ModuleTag_castle
        CastleToUnpackForFaction    = Wild Fortress_Wild
        CastleToUnpackForFaction    = Men Fortress_Wild
        CastleToUnpackForFaction    = Arnor Fortress_Wild
        CastleToUnpackForFaction    = Rohan Fortress_Wild
        CastleToUnpackForFaction    = Elves Fortress_Wild
        CastleToUnpackForFaction    = Imladris Fortress_Wild
        CastleToUnpackForFaction    = Dwarves Fortress_Wild
        CastleToUnpackForFaction    = Mordor Fortress_Wild
        CastleToUnpackForFaction    = Isengard Fortress_Wild
        CastleToUnpackForFaction    = Angmar Fortress_Wild


        FilterValidOwnedEntries = ANY +STRUCTURE +WALK_ON_TOP_OF_WALL +BASE_FOUNDATION +TACTICAL_MARKER

        MaxCastleRadius             = 130.0
        InstantUnpack                = Yes
        KeepDeathKillsEverything    = Yes

        EvaEnemyCastleSightedEvent = EnemyFortressSighted
    End

    Behavior                  = StructureCollapseUpdate ModuleTag_06
        MinCollapseDelay        = 000
        MaxCollapseDelay        = 000
        CollapseDamping         = .5
        MaxShudder              = 0.6
        MinBurstDelay           = 250
        MaxBurstDelay           = 800
        BigBurstFrequency       = 4
        FXList                  = INITIAL   FX_FortressCollapse

        DestroyObjectWhenDone    = Yes
        CollapseHeight            = 120
    End



    Behavior    = GettingBuiltBehavior ModuleTag_GettingBuiltBehavior
        WorkerName    = WildWorkerNoSelect
        SpawnTimer    = DEFAULT_STRUCTURE_HEALDELAY
    End

    Behavior = AIUpdateInterface ModuleTag_AI
        AILuaEventsList                = FortressFunctions
    End


    Geometry                = BOX
    GeometryName            = Geom_Orig
      GeometryMajorRadius        = 65.0
    GeometryMinorRadius        = 63.0
    GeometryHeight            = 50.0
    GeometryOffset            = X:5 Y:0 Z:0


    AdditionalGeometry        = BOX
    GeometryName            = Plots
    GeometryMajorRadius        = 10.0
    GeometryMinorRadius        = 10.0
    GeometryHeight            = 0.8
    GeometryOffset            = X:76.0 Y:-76.0 Z:0

    AdditionalGeometry        = BOX
    GeometryName            = Plots
    GeometryMajorRadius        = 10.0
    GeometryMinorRadius        = 10.0
    GeometryHeight            = 0.8
    GeometryOffset            = X:0 Y:-92.48 Z:0

    AdditionalGeometry        = BOX
    GeometryName            = Plots
    GeometryMajorRadius        = 10.0
    GeometryMinorRadius        = 10.0
    GeometryHeight            = 0.8
    GeometryOffset            = X:-76.0 Y:-76.0 Z:0

    AdditionalGeometry        = BOX
    GeometryName            = Plots
    GeometryMajorRadius        = 10.0
    GeometryMinorRadius        = 10.0
    GeometryHeight            = 0.8
    GeometryOffset            = X:-92.48 Y:0 Z:0

    AdditionalGeometry        = BOX
    GeometryName            = Plots
    GeometryMajorRadius        = 10.0
    GeometryMinorRadius        = 10.0
    GeometryHeight            = 0.8
    GeometryOffset            = X:-76.0 Y:76.0 Z:0

    AdditionalGeometry        = BOX
    GeometryName            = Plots
    GeometryMajorRadius        = 10.0
    GeometryMinorRadius        = 10.0
    GeometryHeight            = 0.8
    GeometryOffset            = X:0 Y:92.48 Z:0

    AdditionalGeometry        = BOX
    GeometryName            = Plots
    GeometryMajorRadius        = 10.0
    GeometryMinorRadius        = 10.0
    GeometryHeight            = 0.8
    GeometryOffset            = X:76.0 Y:76.0 Z:0

    GeometryIsSmall         = No
    Shadow                    = SHADOW_VOLUME

    GeometryContactPoint = X:-55    Y:55        Z:0            Repair
    GeometryContactPoint = X:55        Y:-55    Z:0            Repair
    GeometryContactPoint = X:47.546        Y:36.435    Z:0
    GeometryContactPoint = X:-32.763    Y:-46.121    Z:0
    GeometryContactPoint = X:26.753        Y:26.753    Z:67.933    Swoop
End



ChildObject WildFortress_BlueMountains_1 WildFortress

    Behavior = CastleBehavior ModuleTag_castle
          CastleToUnpackForFaction    = Wild Fortress_Wild
        CastleToUnpackForFaction    = Mordor Fortress_Wild
        CastleToUnpackForFaction    = Isengard Fortress_Wild
        CastleToUnpackForFaction    = Men Fortress_Wild
        CastleToUnpackForFaction    = Elves Fortress_Wild
        CastleToUnpackForFaction    = Dwarves Fortress_Wild

        FilterValidOwnedEntries = ANY +STRUCTURE +WALK_ON_TOP_OF_WALL +BASE_FOUNDATION +TACTICAL_MARKER
        MaxCastleRadius         = 130.
        FadeTime            = 2.0
        InstantUnpack            = Yes
        KeepDeathKillsEverything    = Yes
        EvaEnemyCastleSightedEvent     = EnemyFortressSighted
        PreBuiltList             = WildArrowDenExpansion -2
        PreBuiltList             = WildArrowDenExpansion -2
        PreBuiltList             = WildArrowDenExpansion -2
        PreBuiltList            = WildSpiderHolesExpansion -2
        PreBuiltList             = WildGiantSentryExpansion -2
    End
End

